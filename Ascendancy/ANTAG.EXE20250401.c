/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Watcom C++
*/

#include <math.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn sub_10000(); // weak
// void __usercall Q_BATCON_CPP_sub_10010(PANE *pane@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<ecx>, int a5@<edi>);
void __fastcall Q_BATCON_CPP_sub_10668(PANE *pane, char *a2, int powerState, int a4);
int __fastcall sub_10878(_DWORD *, int, int, int);
int __fastcall sub_10A14(int, int);
void __fastcall __spoils<> Q_WndBC_sub_10A3C(P_WndBC a1);
T_TypeA2 *__fastcall sub_10A80(T_TypeA2 *, char);
void __fastcall __spoils<> Q_WndBC_sub_10AC4(P_WndBC a1);
int __fastcall sub_10B24(int, unsigned __int16, LONG, int *);
void __fastcall sub_11870(int a1, int a2);
int __fastcall sub_11BA4(int);
int __fastcall sub_12140(int);
void __fastcall sub_12238(int, int);
void __fastcall sub_1229C(int, int);
unsigned int __fastcall sub_12368(int, int);
void __fastcall sub_1240C(int, int);
char *__fastcall sub_12440(char *result);
int __fastcall sub_12480(float *, float *, float);
unsigned int __fastcall sub_12618(int);
void __fastcall sub_12674(int);
// int __usercall sub_126F8@<eax>(int@<eax>, int@<edx>, int@<ebp>);
int __fastcall sub_12AE4(int a1, P_Ship a2);
void __fastcall sub_12B4C(int, int);
unsigned int __fastcall sub_12C98(int, int, int);
unsigned int __fastcall sub_12E88(int);
// int __usercall sub_12F7C@<eax>(int@<eax>, int ebp0@<ebp>);
unsigned int __fastcall sub_13370(int, int, int);
unsigned int __fastcall sub_136C4(int);
unsigned int __fastcall sub_1380C(int);
void __fastcall sub_139E0(int, int);
void __fastcall sub_13A28(int, int);
void __fastcall sub_13AD8(int, int);
void __fastcall __spoils<> Q_Vector3DCopy_sub_13BC0(P_Vector3D dst, P_Vector3D src);
void __fastcall __spoils<> Q_Vector3DCtor_sub_13BF0(P_Vector3D a1);
unsigned int __fastcall sub_13C10(int);
unsigned int __fastcall sub_14224(int);
int __fastcall sub_142D8(int);
int __fastcall sub_14490(int);
unsigned int __fastcall sub_145C0(int);
unsigned int __fastcall sub_147CC(int);
unsigned int __fastcall sub_14B18(int, int, int);
unsigned int __fastcall sub_15078(int);
unsigned int __fastcall sub_15164(int);
unsigned int __fastcall sub_152E4(int, int, int, int);
void __fastcall sub_15630(int, int);
void __fastcall sub_156C0(int a1, int a2, unsigned __int16 shpNum);
void __fastcall __spoils<> sub_1577C(int);
void __fastcall __spoils<> sub_15788(int result);
int __fastcall sub_15794(int result, int);
int __fastcall sub_157B4(const void *, const void *); // idb
void __fastcall sub_157EC(size_t *);
char *__fastcall sub_15808(int, int, int);
int __fastcall sub_15948(int, int);
void __fastcall __spoils<> sub_15D20(int);
void __fastcall __spoils<> sub_15D2C(int result);
int __fastcall sub_15D38(int result, const void *);
int __fastcall sub_15D74(int result, int);
int __fastcall sub_15DA4(int result, int, unsigned __int16);
// void __usercall sub_15E1C(int *a1@<eax>, int a2@<edx>, int a3@<esi>);
void __fastcall __spoils<> Q_Wnd4BMCtor_sub_15ED4(P_Wnd4BM);
P_Wnd4BM __fastcall Q_Wnd4BMDtor_sub_1604C(P_Wnd4BM, char);
int __fastcall sub_16120(P_Wnd4BM a1);
int __fastcall sub_16348(P_Wnd4BM a1, unsigned __int16 message, LONG param1, signed int param2);
void __fastcall sub_16D6C(T_Wnd4BM *a1, int a2, int a3, int a4);
void __fastcall sub_16FC0(int, int edx0, int, int);
void __fastcall sub_171D0(int, int, int);
char *__fastcall sub_17204(int, int, int);
void __fastcall sub_17260(int result);
void __fastcall sub_172B0(T_Wnd4BM *);
int __fastcall sub_173F4(int, int, int, int);
int __fastcall sub_17430(int);
void __fastcall sub_17E50(P_Wnd4BM a1, int a2);
float *__fastcall sub_17E88(float *result, int);
void __fastcall sub_17F54(P_Wnd4BM a1);
void __fastcall sub_17FF0(P_Wnd4BM a1);
void __fastcall sub_181F0(P_Wnd4BM a1);
void __fastcall sub_1826C(P_Wnd4BM a1, int a2, unsigned __int16 a3, unsigned __int16 a4);
void __fastcall sub_182B8(P_Wnd4BM a1, int a2);
unsigned int __fastcall sub_18370(P_Wnd4BM a1);
int __fastcall sub_185CC(int);
void __fastcall sub_186B8(P_Wnd4BM a1, int a2, int a3);
int __fastcall sub_187EC(P_Wnd4BM a1);
void __fastcall sub_18C2C(P_Wnd4BM a1, int a2);
// void __usercall sub_18CA8(int a1@<eax>, int a2@<edx>, int a3@<esi>);
void __fastcall sub_1936C(int);
int __fastcall sub_19AE8(int);
void __fastcall sub_19E2C(P_Wnd4BM a1, P_FileInfo pfi, int read);
void *__fastcall sub_1A9C0(void *result);
void __fastcall __spoils<edx> Q_DestructVectors_sub_1A9E0(P_Vector3D a1);
void *__fastcall sub_1AA00(void *result);
void *__fastcall Q_NC_sub_1AA20(void *result);
void __fastcall sub_1AA40(P_Type16 a1, P_Type16 a2);
T_Vector3D *__fastcall sub_1AA90(int);
_DWORD *__fastcall sub_1AAC0(_DWORD *result);
void __fastcall __spoils<> sub_1ABE0(P_Type16 a1);
void __fastcall Q_Vector3D_FromInt_sub_1AC70(P_Vector3D a1, int x, int y, int z);
void __fastcall Q_Vector3D_Clear_sub_1ACA0(P_Vector3D a1);
void __fastcall __spoils<> sub_1ACC0(int);
void __fastcall __spoils<> sub_1ACE8(int a1);
void __fastcall __spoils<> sub_1ACF4(P_Type13 a1);
void __fastcall Q_CACHE_CPP_ShapeCache_sub_1AD1C(P_Type13 a1, int a2);
int __fastcall Q_CACHE_CPP_sub_1ADAC(P_Type13 a1, const char *filename);
int __fastcall sub_1AEB0(P_Type13 pt13, unsigned __int16 a2, const char *a3);
int __fastcall sub_1B000(unsigned int, unsigned __int16);
void *__fastcall Q_CACHE_CPP_GetShapeTable_sub_1B084(unsigned int, int);
int __fastcall sub_1B270(T_Type13 *a1, const char *filename, int a3);
int __fastcall sub_1B2DC(unsigned int, int);
int __fastcall sub_1B354(unsigned int, unsigned __int16);
_DWORD *__fastcall sub_1B498(_DWORD *result);
_DWORD *__fastcall sub_1B4D0(_DWORD *);
void __fastcall __spoils<> sub_1B4F0(P_Wnd9RW1 a1);
void __fastcall __spoils<> Q_Ret_sub_1B66C();
_DWORD *__fastcall Q_NC_sub_1B670(_DWORD *, int, int, int, int, int, int, int);
// void __userpurge sub_1B808(P_Wnd9RW1 a1@<eax>, float a2, float a3, float a4, int a5);
void __fastcall sub_1B834(P_Wnd9RW1 a1, int a2);
float *__fastcall sub_1B864(int, int, int, int);
float *__fastcall sub_1B958(int, float *, int, int);
void __fastcall Q_NC_sub_1BA90(float *, int, int, int, int);
void __fastcall Q_NC_sub_1BAB0(int, int, int, int, float degrees);
void __fastcall sub_1BAF0(P_Wnd9RW1, float);
FILE *__fastcall Q_OpenFile_sub_1BB10(const char *aFName, fpos_t *endOffset);
void __fastcall __spoils<> Q_InitFileInfo_sub_1BB78(P_FileInfo a1);
void __fastcall __spoils<> Q_CloseFileAndDelete_sub_1BBC8(P_FileInfo a1);
BOOL __fastcall Q_OpenFile_sub_1BBFC(P_FileInfo a1, const char *aFName, int aOFlags, int preload);
BOOL __fastcall Q_OpenFile_sub_1BCA8(T_FileInfo *, const char *);
BOOL __fastcall Q_CFILE_CPP_OpenFile_sub_1BCBC(T_FileInfo *a1, int aOFlags);
int __fastcall Q_CloseFile_sub_1BE00(P_FileInfo a1);
int __fastcall Q_GetFileLength_sub_1BE28(P_FileInfo a1);
int __fastcall Q_GetFilePos_sub_1BEA0(P_FileInfo a1);
int __fastcall sub_1BECC(int *, int offset, int);
int __fastcall Q_SetFilePos_sub_1BF0C(P_FileInfo a1, int offset);
void *__fastcall Q_CfileLoad_sub_1BF1C(T_FileInfo *, void *);
int __fastcall Q_ReadFile_sub_1BF94(P_FileInfo a1, void *aBuf, unsigned int aReadLen);
unsigned int __fastcall sub_1BFD4(int *, void *buf, unsigned int, unsigned int, int);
unsigned int __fastcall Q_CFILE_CPP_dos_write_sub_1C098(int *phandle, void *buf, unsigned int size);
void __fastcall Q_CFILE_CPP_IndexOneCob_sub_1C278(P_CobFiles a1, char *CobFileName);
void __fastcall Q_CobFilesLoad_sub_1C3C4(P_CobFiles a1);
void Q_AtExitFunc_sub_1C410(void); // idb
int __fastcall main(int argc, char *argv[]);
void Q_Proc_sub_1CC94();
int Q_CORN_CPP_StaticTxtLoad_sub_1CD3C();
char *__fastcall Q_CORN_CPP_StaticTxtRead_sub_1CEA8(int aTextIndex);
T_Game *sub_1CEF0();
void __fastcall sub_1CF14(unsigned __int8 a1);
void __fastcall Q_StarCtor_sub_1CF40(P_Star pStar);
T_Lane *__fastcall sub_1CF68(T_Star *, T_Star *);
__int16 __fastcall sub_1D234(P_Star pStar, P_Planet pPlanet, WORD raceIndex);
unsigned int __fastcall sub_1D3E8(P_Star pStar, P_Ship pShip, int a3);
unsigned int __fastcall sub_1D538(P_Location a1, P_Ship pShip);
int __fastcall sub_1D654(__int16 *, T_Star *, void *);
void __fastcall sub_1D734(int, int);
int __fastcall sub_1D794(P_Location pLocation, P_Ship *pShip);
unsigned int __fastcall sub_1D834(P_Star pStar, __int16 raceIndex);
void __fastcall Q_ReadWriteStar_sub_1D920(P_Star pStar, P_FileInfo pfi, int read);
int __fastcall sub_1DA04(int, int);
int __fastcall sub_1DA4C(T_Star *, __int16, int, int);
int __fastcall sub_1DB70(T_Star *, __int16, int *, int);
void __fastcall __spoils<> Q_GameCtor_sub_1DE64(P_Game pGame);
void __fastcall Q_GameDtor_sub_1E03C(P_Game a1);
void __fastcall sub_1E094(P_Game pGame);
void __fastcall sub_1E10C(P_Game pGame, __int16 stars, __int16 races, unsigned __int8 a4);
void __fastcall sub_1E150(P_Game pGame, __int16 sectors);
int __fastcall sub_1E2A0(P_Game a1, __int16 stars);
P_Game __fastcall sub_1E70C(P_Game pGame, __int16 races, unsigned __int8 a3);
char __fastcall sub_1EE08(P_Game pGame, char a2);
__int16 __fastcall sub_1EEA4(P_Game pGame);
void __fastcall sub_1EFC0(P_Game a1);
unsigned int __fastcall sub_1F038(P_Game a1);
int __fastcall sub_1F404(P_Game pGame);
int sub_1F91C();
int __fastcall sub_1FB34(P_Game a1);
void __fastcall sub_1FD18(P_Game a1, int a2);
int __fastcall sub_1FD90(int, int, int);
int __fastcall sub_1FDF0(int, int, int, int);
int __fastcall sub_1FFE0(P_Game a1, int a2);
void __fastcall sub_2016C(P_Game a1, int a2, __int16 a3);
void __fastcall sub_201D8(P_Game a1);
T_Lane *__fastcall sub_205A0(P_Game, T_Star *, T_Star *);
P_Ship __fastcall sub_20684(P_Game pGame, __int16 raceIndex);
void __fastcall sub_20720(P_Game pGame, P_Ship pShip);
char __fastcall sub_207A0(P_Game a1);
T_Star *__fastcall sub_20B3C(P_Game pGame);
char __fastcall sub_20C94(P_Game pGame, int a2, int a3, int a4);
P_Game __fastcall sub_2106C(P_Game result);
void __fastcall sub_21170(P_Game a1);
void __fastcall sub_211EC(P_Game pGame, P_Star pStar, int a3);
void __fastcall sub_21314(P_Game a1);
void __fastcall Q_SaveGam_sub_21374(P_Game pGame, P_FileInfo pfi);
void __fastcall Q_LoadGam_sub_21AA0(P_Game pGame, P_FileInfo pfi);
WORD __fastcall sub_220CC(P_Game);
void __fastcall __spoils<edx> sub_22260(void *result);
void __fastcall __spoils<edx> sub_22280(void *);
void __fastcall __spoils<edx> sub_222A0(void *result);
void __fastcall __spoils<edx> sub_222C0(void *);
void __fastcall __spoils<edx> sub_222E0(void *);
void __fastcall __spoils<edx> sub_22300(void *result);
void __fastcall __spoils<edx> sub_22320(void *result);
P_Lane __fastcall sub_22360(P_Lane result);
void __fastcall __spoils<> Q_SectorCtor_sub_223B0(P_Sector pSector);
void __fastcall __spoils<> sub_223E0(P_Type09 a1);
void __fastcall __spoils<> Q_PlanetCtor_sub_22400(P_Planet pPlanet);
int __fastcall sub_22430(const void *, const void *); // idb
void __fastcall Q_Proc_sub_22468();
P_Wnd2COSW __fastcall Q_Wnd2COSWCtor_sub_224A4(P_Wnd2COSW);
char *__fastcall Q_Wnd2COSWDtor_sub_22588(char *, char);
unsigned int __fastcall Q_COSWND_CPP_sub_22644(P_Wnd2COSW a1, const char *starShapes, const char *shipShapes);
LONG *__fastcall sub_2280C(P_Wnd2COSW a1);
void __fastcall sub_23BF0(int, int);
int __fastcall sub_23FD4(int);
void __fastcall sub_24154(float *, int, float);
void __fastcall sub_24198(int, int, int, int);
void __fastcall sub_2422C(int, int, int, int);
int __fastcall sub_24948(int result, int, int);
int __fastcall sub_24BE0(int);
int __fastcall sub_24D30(int, int, int, int);
void __fastcall sub_24FCC(P_Wnd2COSW a1, P_FileInfo pfi, int read);
void __fastcall __spoils<> sub_254A4(int);
void __fastcall __spoils<> sub_254B0(int result);
int __fastcall sub_254BC(int result, int);
void __fastcall sub_254DC(size_t *);
void __fastcall sub_254F8(int *, int);
void __fastcall __spoils<> sub_25BF8(P_TypeA2 a1);
T_TypeA2 *__fastcall sub_25C08(T_TypeA2 *, char);
void __fastcall sub_25C4C(unsigned int, int);
void __fastcall __spoils<> Q_WndRSWCtor_sub_25CB8(P_WndRSW result);
T_TypeA2 *__fastcall Q_WndRSWDtor_sub_25CD4(P_WndRSW a1, char a2);
void __fastcall sub_25D18(int result, LONG);
int __fastcall sub_25FB4(int result);
unsigned int __fastcall sub_26000(int, __int16, __int16, LONG);
void sub_26140();
char *__fastcall sub_26150(char *result);
int Q_StopSystems_sub_26160();
void Q_debugbreak_sub_26194();
void __fastcall __noreturn Q_AssertLogBreakExit_sub_26198(int ignore, const char *sourcefile, int line);
void __fastcall Q_AssertLogBreakExit_sub_261A8(int ignore, const char *sourcefile, int line);
int __fastcall sub_261B8(int result, const char *, int);
__int64 __cdecl sub_2620C(char *format, char);
void __noreturn Q_debugbreak_exit_sub_2624C();
void __fastcall __spoils<edx,ebx> Q_RegisterData_sub_2625C(void *aData, int a2, char *name);
void __fastcall sub_2627C(void *pdata);
void *__fastcall Q_Allocate_sub_2628C(size_t, int, char *);
void *__fastcall sub_262B0(size_t num, size_t size, int a3, char *name);
void __fastcall sub_262CC(void *ptr);
void sub_262F0();
void sub_26314();
void sub_2631C();
void Q_Null_sub_26328();
void Q_StopMouse_sub_2632C();
int Q_StartMouse_sub_2633C();
void __fastcall Q_ProcessKeyboard_sub_26360();
void __fastcall Q_ProcessMouse_sub_264B4();
int __fastcall Q_ProcessInput_sub_2656C();
void __fastcall sub_265A8(int);
void __fastcall __spoils<> Q_Wnd23EWCtor_sub_267A0(P_Wnd23EW a1);
void __fastcall __spoils<> Q_Wnd23EWDtor_sub_267BC(P_Wnd23EW a1, char a2);
void __fastcall __spoils<> Q_WndEW_sub_26800(P_Wnd23EW result);
void __fastcall sub_26874(P_Wnd23EW a1, P_GameEvent pGameEvent);
unsigned int __fastcall sub_270F4(int, __int16, LONG, LONG);
void __fastcall __spoils<> Q_A2_sub_2712C(T_TypeA2 *a1);
T_TypeA2 *__fastcall sub_2713C(T_TypeA2 *, char);
unsigned int __fastcall sub_27184(T_TypeA2 *, __int16, LONG, LONG);
__int64 __fastcall sub_271FC(int);
void __fastcall __spoils<> Q_A2_sub_27BF8(P_TypeA2 a1);
T_TypeA2 *__fastcall sub_27C08(T_TypeA2 *, char);
unsigned int __fastcall sub_27C50(T_TypeA2 *, __int16, LONG, LONG);
void __fastcall sub_27D18(int, int, int, int);
void __cdecl callback_fn();
int __fastcall sub_28C4C(__int16 *, __int16 *);
int __fastcall Q_NC_sub_28C58(int result, __int16);
void __fastcall __spoils<> sub_28C74(P_Type2 a1);
void __fastcall __spoils<> sub_28DA4(P_Type2 a1);
UBYTE *__fastcall sub_28EB4(int, const char *, int, int, int);
int __fastcall sub_29038(int, size_t, unsigned int, int, int, int);
unsigned int __fastcall Q_NC_sub_291F8(int);
unsigned int __fastcall Q_NC_sub_2936C(int);
unsigned int __fastcall sub_296B4(int, int, int, int);
void __fastcall sub_29B24(_DWORD *);
unsigned __int16 __fastcall sub_29C6C(int, _WORD *);
int __fastcall sub_29D54(int, unsigned __int8 *);
void __fastcall sub_29F58(int, const void *);
void __fastcall Q_NC_sub_29FF8(int, _WORD *);
FILE *__fastcall sub_2A1DC(int, const char *);
void __fastcall sub_2AA88(int);
int __fastcall Q_FLIC_CPP_StartTimer_sub_2AC84(int, ULONG hertz);
void __fastcall __spoils<> sub_2AD08(P_Type2 a1);
__int16 __cdecl sub_2AD40(unsigned __int16 *, int, LONG y);
int __cdecl Q_NC_sub_2AE48(unsigned __int16);
__int16 Q_NC_sub_2AE69();
void __fastcall __spoils<> Q_Wnd1FLICCtor_sub_2AE80(P_Wnd1FLIC a1);
P_Wnd1FLIC __fastcall Q_Wnd1FLICDtor_sub_2AEB0(P_Wnd1FLIC, char);
UBYTE *__fastcall sub_2AF04(int, const char *);
int __fastcall sub_2AF3C(int);
unsigned int __fastcall sub_2AFF0(int, __int16, LONG, LONG);
void __fastcall __spoils<> sub_2B2C0(P_Font a1);
void __fastcall __spoils<> sub_2B2E0(P_Font a1);
MACRO_VFX_BOOL __fastcall sub_2B2FC(P_Font, const char *aFName);
MACRO_VFX_BOOL __fastcall sub_2B360(void **data, const char *aFName);
void __fastcall sub_2B3E0(P_Font pFont, int x1, int y1, int x2, int y2);
int __fastcall sub_2B3F4(int, char *s2, char *s1, int);
int __fastcall sub_2B4F4(_DWORD *, char *string);
LONG __fastcall Q_FONT_CPP_GetFontHeight_sub_2B594(P_Font a1);
int __fastcall sub_2B5BC(int *, char *);
void __fastcall Q_FONT_CPP_sub_2B610(_DWORD *, LONG, LONG, char *, int, int, __int16);
void __fastcall Q_NC_sub_2B804(LONG *, int);
LONG __fastcall Q_NC_sub_2B838(int, __int16, __int16);
int __fastcall sub_2B8A8(P_Font a1, int a2, int a3, const char *text, __int16 a5, __int16 a6, __int16 a7, int a8);
void sub_2BB50();
void __fastcall sub_2BB74(PANE *pane, LONG a2, LONG y1, LONG x1, LONG y0, unsigned __int8 a6, int a7);
void __fastcall Q_GSYSTEM_CPP_sub_2BC40(PANE *pane, void *shape_table, LONG shape_number, int *hotX, int *hotY);
void __fastcall sub_2BCF4(int, unsigned __int8);
void __fastcall sub_2BD04(P_Type6, char, char *);
void __fastcall Q_Type6Ctor_sub_2BD4C(P_Type6 a1);
T_Type6 *__fastcall Q_Type6Dtor_sub_2BD7C(T_Type6 *);
unsigned int __fastcall sub_2BD88(P_Type6 a1, const char *a2, const char *a3);
unsigned int __fastcall Q_GSYSTEM_CPP_sub_2BFDC(P_Type6 a1, int a2, int a3, int a4);
void __fastcall Q_AllocateHazeTables_sub_2C08C(P_Type6 a1, unsigned __int16 numTables);
int __fastcall Q_LoadHazeTables_sub_2C0C0(P_Type6 a1, const char *a2, unsigned __int16 num);
unsigned int __fastcall Q_LoadPal_sub_2C158(P_Type6 a1, const char *aFName, int a3, unsigned __int16 a4);
int __fastcall sub_2C1E0(int, unsigned __int16, unsigned __int16, unsigned int);
void __fastcall Q_PaletteSet_sub_2C224(P_Type6 a1, unsigned __int16 from, __int16 count, RGB *palette);
void __fastcall Q_NC_sub_2C264(T_Type6 *);
void __fastcall Q_NC_sub_2C280(P_Type6, signed __int16, __int16);
void __fastcall Q_PaletteGet_sub_2C2B0(P_Type6 a1, unsigned __int16 from, __int16 count, RGB *palette);
void __fastcall sub_2C2F8(T_Type6 *, char *);
void __fastcall sub_2C418(P_Type6 a1, int a2, __int16 a3);
void __fastcall sub_2C4C0(P_Type6 a1, int a2, int a3);
void __fastcall Q_NC_sub_2C5C0(T_Type6 *);
void __fastcall Q_FadePalette_sub_2C5E4(P_Type6, char);
void __fastcall sub_2C670(int, int, int, char *);
void __fastcall Q_StopVideoSystem_sub_2C6CC(P_Type6 a1);
void __fastcall Q_GSYSTEM_CPP_PreloadMouseShp_sub_2C744(P_Type6 a1, char *a2, int a3, int a4);
void __fastcall Q_GSYSTEM_CPP_sub_2C7D0(T_Type6 *a1, int a2, int a3);
void __fastcall __spoils<> Q_A2Ctor_sub_2C830(P_TypeA2 a1);
P_TypeA2 __fastcall Q_A2Dtor_sub_2C848(P_TypeA2, char);
void __fastcall __spoils<> Q_A1_sub_2C8E4(P_TypeA1 a1);
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_2C978(P_TypeA1 a1);
unsigned int __fastcall Q_GWINDOW_CPP_LinkChild_sub_2C990(P_TypeA1 a1, P_TypeA1 a2);
unsigned int __fastcall sub_2CA0C(P_TypeA1 a1, P_TypeA1 a2, int a3);
int __fastcall Q_NC_sub_2CA58(int);
_DWORD *__fastcall sub_2CA78(_DWORD *result, __int16, __int16);
void __fastcall sub_2CD24(unsigned int, int);
void __fastcall sub_2CF28(unsigned int);
unsigned int __fastcall sub_2D0F4(unsigned int, int);
void __fastcall sub_2D218(_DWORD *);
void __fastcall sub_2D258(P_TypeA2 a1, __int16 a2);
int Q_GWINDOW_CPP_LoadGwshareTxt_sub_2D2CC();
int __fastcall sub_2D334(const char *);
char *__fastcall sub_2D3D0(int);
unsigned int __fastcall sub_2D400(int, int);
void __fastcall __spoils<> Q_A4_sub_2D464(P_TypeA4TogWnd a1);
T_TypeA2 *__fastcall sub_2D480(T_TypeA2 *, char);
void __fastcall __spoils<> Q_A4_sub_2D4C4(P_TypeA4TogWnd result);
unsigned int __fastcall sub_2D4D0(_DWORD *, __int16, LONG, LONG);
void __fastcall sub_2D528(int, int);
void __fastcall sub_2D79C(int);
int __fastcall sub_2D99C(int, unsigned int count, int);
void __fastcall __spoils<> Q_A3_sub_2D9C4(P_TypeA3 a1);
T_TypeA2 *__fastcall sub_2D9FC(T_TypeA2 *, char);
void __fastcall __spoils<> Q_A1_sub_2DA60(P_TypeA1 result);
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_2DA68(P_TypeA1 a1);
MACRO_VFX_BOOL __fastcall sub_2DA80(P_TypeA3, __int16 numControls);
unsigned int __fastcall sub_2DAC8(P_TypeA3 a1, __int16 a2, __int16 a3, WORD *a4);
int __fastcall sub_2DB54(int result, __int16, __int16);
int __fastcall sub_2DBE4(int, int, int);
int __fastcall sub_2DCA0(int result, __int16);
int __fastcall Q_NC_sub_2DD2C(int, __int16, __int16);
int __fastcall sub_2DD70(int);
unsigned int __fastcall sub_2DDB8(int, __int16);
unsigned int __fastcall sub_2DE68(T_TypeA3 *, __int16, LONG, LONG);
// void __usercall sub_2E084(int@<eax>, __int16@<si>);
int __fastcall sub_2E1B4(int, unsigned int count, int);
int __fastcall sub_2E208(_DWORD *, const char *, int, int);
void __fastcall __spoils<> Q_Wnd10LBCtor_sub_2E248(T_Wnd10LB *);
T_TypeA2 *__fastcall sub_2E264(T_TypeA2 *, char);
void __fastcall Q_A10_sub_2E2B8(P_Wnd10LB);
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_2E3BC(P_TypeA1 a1);
unsigned int __fastcall sub_2E3D4(T_Wnd10LB *, __int16, signed int, signed int);
void __fastcall sub_2E6C0(int);
void __fastcall sub_2E868(int, int);
void __fastcall sub_2E9CC(P_Wnd10LB a1, char a2);
int __fastcall sub_2EA8C(int, const char *, __int16, int);
unsigned int __fastcall sub_2EC50(int, unsigned __int16, int);
int __fastcall sub_2ECA4(int, unsigned __int16);
int __fastcall sub_2ECDC(int result, unsigned __int16);
int __fastcall sub_2ED14(int, unsigned __int16);
LONG __fastcall sub_2ED4C(P_Wnd10LB);
void __fastcall sub_2EDC8(int, unsigned int, unsigned int);
void __fastcall sub_2F090(int, unsigned int, unsigned int, __int16);
void __fastcall Q_A10_SetProc_sub_2F1C8(P_Wnd10LB result, void *a2);
int __fastcall sub_2F1D8(int result, int);
void __fastcall sub_2F1E0(int);
int __fastcall sub_2F228(int, size_t, int);
void __fastcall sub_2F2B4(int);
void __fastcall __spoils<> Q_WndNT_sub_2F2F4(P_WndNT result);
T_TypeA2 *__fastcall sub_2F30C(T_TypeA2 *, char);
void __fastcall sub_2F354(int);
int __fastcall sub_2F414(int);
unsigned int __fastcall sub_2F420(T_TypeA2 *, __int16, LONG, LONG);
unsigned int __fastcall sub_2F424(T_TypeA2 *, __int16, LONG, LONG);
unsigned int __fastcall sub_2F478(T_TypeA2 *, __int16, LONG, LONG);
T_TypeA2 *__fastcall sub_2F48C(T_TypeA2 *);
T_TypeA2 *__fastcall sub_2F4A8(T_TypeA2 *, char);
int __fastcall sub_2F4EC(int result);
void __fastcall sub_2F540(int);
unsigned int __fastcall sub_2F6B0(int, __int16, char, unsigned int);
int __fastcall sub_2F8A4(int, int);
// char __usercall sub_2F8F8@<al>(int@<eax>, __int16@<dx>, char@<bl>, int@<edi>);
int __fastcall sub_2F9A4(int, const char *, __int16);
void __fastcall __spoils<> Q_A3_sub_2FA18(P_TypeA3 a1);
T_TypeA2 *__fastcall sub_2FA34(T_TypeA2 *, char);
void __fastcall __spoils<> Q_A3_sub_2FA78(P_TypeA3 result);
void __fastcall sub_2FA98(int);
void __fastcall sub_2FBA4(int, int);
int __fastcall sub_2FC3C(int);
void __fastcall __spoils<> Q_A2_sub_2FC50(P_TypeA2 a1);
T_TypeA2 *__fastcall sub_2FC68(T_TypeA2 *, char);
void __fastcall Q_ShowHelpTopic_sub_2FCB0(P_Wnd20HW a1, char *helpfile, char *helptopic);
unsigned int __fastcall sub_2FD68(int, __int16, LONG, LONG);
void __fastcall Q_HELPWIN_CPP_FgetsLine_sub_2FE58(FILE *fp, char *line);
int __fastcall sub_2FEB8(P_Wnd20HW a1);
void __fastcall sub_30774(int);
int __fastcall sub_30A90(T_Type5 *, int edx0, int, int);
int __fastcall sub_31158(_DWORD *, int, int, int);
void __fastcall __spoils<> Q_WndLW_sub_31200(P_WndLW result);
T_TypeA2 *__fastcall sub_3121C(T_TypeA2 *, char);
unsigned int __fastcall sub_31268(int, unsigned __int16, LONG, LONG);
void __fastcall sub_3160C(int);
void __fastcall sub_316A8(int, int);
int __fastcall sub_317D0(int);
int __fastcall sub_318A0(unsigned __int16, unsigned __int8);
char __fastcall sub_31934(int a1);
int __fastcall sub_31A34(unsigned __int16, char);
int sub_31B08();
int __fastcall sub_31C18(int result, int);
void __fastcall Q_AppendRomanNum_sub_31E60(char *a1, int number);
int __fastcall sub_31FB0(_DWORD *, const char *, int, int);
void __fastcall __spoils<> Q_WndNW_sub_3201C(P_WndNW a1);
T_TypeA2 *__fastcall sub_32038(T_TypeA2 *, char);
void __fastcall __spoils<> Q_WndNW_sub_3207C(P_WndNW result);
unsigned int __fastcall sub_320B8(int, __int16, LONG, LONG);
void __fastcall sub_32414(int);
void *__fastcall sub_32658(int);
int __fastcall sub_32714(int, int, __int16);
int __fastcall sub_32800(int, int);
__int64 __fastcall sub_32A1C(int);
__int64 __fastcall sub_32A48(int, int, __int16, int, int);
__int64 __fastcall sub_32B44(int, int, __int16);
__int64 __fastcall sub_32BDC(int, char);
__int64 __fastcall sub_32C14(int, char);
char *__fastcall sub_32C48(int, char, int, int);
int __fastcall sub_32E84(int, int, int, int);
int __fastcall sub_32FD8(int, FILE *, int);
void __fastcall sub_330DC(T_Type5 *, unsigned __int8 *);
void __fastcall __spoils<> Q_WndIW_sub_33598(P_WndIW a1);
T_TypeA2 *__fastcall sub_335B4(T_TypeA2 *, char);
void __fastcall __spoils<> Q_WndIW_sub_335F8(P_WndIW result);
unsigned int __fastcall sub_33604(int, __int16, LONG, LONG);
void __fastcall sub_33674(int);
void __fastcall __spoils<> Q_WndAW_sub_33830(P_WndAW a1);
T_TypeA2 *__fastcall sub_33840(T_TypeA2 *, char);
void __fastcall Q_ShowHelpTopicAbil_sub_33884(P_Wnd20HW a1, char *a2, int a3, int a4);
unsigned int __fastcall sub_338DC(int, __int16, LONG, LONG);
void __fastcall sub_33A68(int);
UWORD __fastcall Q_PLANET_CPP_sub_33AF0(P_Planet pPlanet, unsigned __int16 size, unsigned __int16 type, int *a4);
void __fastcall Q_PLANET_CPP_LoadPlanItemTxt_sub_33D30();
int __fastcall sub_3407C(P_Planet a1);
int __fastcall sub_3420C(T_Planet *a1);
unsigned int __fastcall sub_34368(P_Planet a1, unsigned __int8 planetItemIndex, unsigned __int16 a3);
void __fastcall sub_34774(P_Planet a1, unsigned __int8 a2, int a3, int a4);
int __fastcall sub_347CC(P_Planet a1, unsigned __int8 planetItemIndex);
UWORD __fastcall sub_34A44(T_Planet *, _DWORD *, _DWORD *, _DWORD *);
int __fastcall sub_34AE4(P_Planet a1, unsigned __int8 planetItemIndex, int a3);
unsigned int __fastcall sub_34B0C(P_Planet pPlanet, int edx0, UBYTE bl0, unsigned __int8 cl0);
void __fastcall sub_34E70(P_Planet);
void __fastcall sub_352E0(P_Planet pPlanet);
__int16 __fastcall Q_GetPlanetItemCost_sub_3583C(P_Planet pPlanet, unsigned __int16 a2, unsigned __int8 planetItemIndex);
int __fastcall Q_GetDaysToCompletePlanetItem_sub_358BC(P_Planet pPlanet);
int __fastcall sub_358F0(P_Planet a1);
UWORD __fastcall sub_35930(P_Planet a1, char a2);
int __fastcall sub_35968(P_Planet a1, int a2, int a3);
unsigned int __fastcall sub_35A00(P_Planet a1, unsigned __int16 a2);
P_Ship __fastcall Q_PLANET_CPP_GetShip_sub_35A70(P_Planet pPlanet, unsigned __int16);
unsigned __int16 __fastcall sub_35B04(int, unsigned __int16, int);
unsigned int __fastcall sub_35BB4(T_Planet *, int);
unsigned int __fastcall sub_35C38(T_Planet *, T_Ship *);
char __fastcall sub_35DA4(P_Planet a1);
char __fastcall sub_35E24(P_Planet a1);
int __fastcall sub_35ED8(T_Planet *);
int __fastcall sub_35FE0(P_Planet a1);
int __fastcall sub_36050(P_Planet a1);
int __fastcall sub_360D8(P_Planet a1);
int __fastcall sub_36158(P_Planet a1);
int __fastcall sub_361B8(T_Planet *);
unsigned int __fastcall sub_3623C(T_Planet *);
void __fastcall sub_362C8(P_Planet, T_Vector3D *);
unsigned int __fastcall sub_362E0(P_Planet);
void __fastcall sub_3636C(int, int);
int __fastcall sub_363B0(T_Planet *);
int __fastcall sub_364B4(T_Planet *, __int16);
void __fastcall sub_366C8(P_Planet a1, char a2, _DWORD *a3, _DWORD *a4, _DWORD *a5);
int __fastcall sub_3676C(T_Planet *, int);
void __fastcall sub_36A5C(T_Planet *a1, int a2, __int16 a3);
MACRO_VFX_BOOL __fastcall Q_TryInvadePlanet_sub_36CD4(P_Planet pPlanet, unsigned __int16 dx0, int *a3);
void __fastcall sub_37040(P_Planet pPlanet);
void __fastcall Q_ReadWritePlanet_sub_370B8(P_Planet pPlanet, P_FileInfo pfi, int read);
void __fastcall __spoils<> Q_WndPW_sub_372B0(P_WndPW a1);
P_TypeA2 __fastcall sub_372CC(P_TypeA2, char);
void __fastcall Q_WndPW_sub_37310(P_WndPW a1);
int __fastcall sub_37380(int, int);
int __fastcall sub_373E0(int, int);
int __fastcall sub_3745C(T_Type5 *, unsigned __int8 *, int, int);
void __fastcall sub_37568(int, unsigned __int16, int, unsigned int);
void __fastcall sub_384B0(int);
char __fastcall sub_39390(int, unsigned __int8, __int16 *, _WORD *);
__int16 __fastcall sub_393F4(int, unsigned __int16, _WORD *, _WORD *);
char *__fastcall sub_394BC(int);
int __fastcall sub_395C4(int, unsigned int count, int);
void __fastcall __spoils<> Q_A2_sub_395EC(P_TypeA2 result);
T_TypeA2 *__fastcall sub_395FC(T_TypeA2 *, char);
unsigned int __fastcall sub_39644(T_TypeA2 *, __int16, LONG, LONG);
void __fastcall sub_396F0(int, int);
void __fastcall __spoils<> Q_Wnd14PSWCtor_sub_39D80(P_Wnd14PSW a1);
T_TypeA2 *__fastcall sub_39D9C(T_TypeA2 *, char);
void __fastcall Q_CachePlanetTexts_sub_39DE0();
unsigned int __fastcall sub_39E3C(int eax0, __int16 dx0, LONG, LONG);
void __fastcall sub_3A6BC(int);
void __fastcall Q_RaceCtor_sub_3B120(P_Race pRace);
void __fastcall sub_3B188(P_Race pRace);
int __fastcall sub_3B1FC(P_Race a1, UBYTE a2, __int16 a3);
char __fastcall sub_3B220(P_Race a1, int a2, int a3, int a4);
char __fastcall Q_NC_sub_3B38C(unsigned __int8 *);
int __fastcall sub_3B56C(P_Race pRace, P_Location pLocation);
void __fastcall sub_3B5B8(unsigned __int8 *eax0);
unsigned int __fastcall sub_3C12C(unsigned __int8 *, _DWORD *);
char __fastcall sub_3C1C0(unsigned __int8 *, int *, int);
int __fastcall sub_3C2E8(unsigned __int8 *, int *, int);
void __fastcall Q_NC_sub_3C4EC(P_Star pStar, int a2);
char __fastcall sub_3C670(_BYTE *);
int __fastcall sub_3C968(int);
int __fastcall sub_3CB60(P_Race pRace, P_Planet pPlanet, unsigned __int8 a3);
unsigned int __fastcall Q_NC_sub_3CC90(_BYTE *, unsigned __int8);
unsigned int __fastcall sub_3CCE4(P_Race pRace, P_Planet pPlanet);
void __fastcall sub_3D8F0(int a1, P_Planet pPlanet);
unsigned int __fastcall sub_3E020(int eax0, P_Planet, unsigned __int8 bl0);
int __fastcall sub_3E1CC(int eax0, P_Planet);
unsigned int __fastcall sub_3E520(int a1, P_Planet a2);
int __fastcall sub_3E800(_BYTE *, unsigned __int16 *);
__int16 __fastcall sub_3EA7C(_BYTE *);
char __fastcall sub_3EBDC(unsigned __int8 *pPlanet, T_Ship *);
int __fastcall sub_3EFE0(P_Race pRace);
__int16 __fastcall sub_3F060(unsigned __int8 *, P_Ship pShip, int, unsigned __int8);
unsigned int __fastcall sub_3F324(int, char, char, char, int, char, _DWORD *, unsigned __int8);
unsigned int __fastcall sub_3F3F8(unsigned __int8 *, char, char, char, char, char, _DWORD *, unsigned __int8);
unsigned int __fastcall sub_3F784(int, char, char, char, char, char, _DWORD *, unsigned __int8);
unsigned int __fastcall sub_3FBAC(int, char, char, char, char, char, _DWORD *, unsigned __int8);
int __fastcall sub_40084(int, _DWORD *, int, char);
T_Ship *__fastcall sub_40144(P_Race pRace, P_Planet pPlanet);
int __fastcall Q_CompareShipsByDayBuilt_sub_40218(P_Ship *ppShip1, P_Ship *ppShip2); // idb
int __fastcall Q_Race_GetShipsNum_sub_40224(P_Race pRace, P_Ship *ppShip, int *totalSize);
int __fastcall Q_Race_GetPlanetsNum_sub_402E0(P_Race pRace);
int __fastcall sub_403C0(unsigned __int8 *, int);
int __fastcall sub_40590(P_Race pRace);
unsigned int __fastcall sub_405F4(_BYTE *);
int __fastcall Q_Race_GetTechsNum_sub_40664(P_Race ppRace);
int __fastcall sub_406C4(P_Race pRace, P_Star pStar, int a3);
// int __userpurge sub_41268@<eax>(unsigned __int8 *eax0@<eax>, __int16@<dx>, int@<ecx>, int@<ebx>, char *@<ebp>, int, __int16, int, int, int, int, int);
unsigned int __fastcall sub_43184(int, int, int);
char __fastcall sub_43374(P_Race pRace, int a2);
unsigned int __fastcall sub_433E0(P_Race pRace, WORD a2, P_Star pStar);
int __fastcall sub_434E4(char *, int);
int __fastcall sub_43B7C(P_Race pRace, __int16 a2);
void __fastcall Q_ReadWriteRace_sub_43BDC(P_Race pRace, P_FileInfo fi, int read);
int __fastcall Q_RACENEG_CPP_sub_43C80(P_Race a1);
unsigned int __fastcall sub_44024(_BYTE *, char);
T_Race *__fastcall sub_44080(unsigned __int8 *);
int __fastcall sub_44238(int, __int16, _BYTE *, __int16);
char __fastcall sub_44434(unsigned __int8 *, __int16, _DWORD *);
int __fastcall sub_44A2C(_BYTE *, int, char, _BYTE *);
char __fastcall sub_44BCC(int, __int16 *, char, int, int *);
void __fastcall sub_450B0(unsigned __int8 *, __int16, char, char, int, int);
// int __usercall sub_45848@<eax>(unsigned __int8 *@<eax>, int@<edx>, int@<ebx>, __int16 *@<edi>);
int __fastcall sub_45958(unsigned __int8 *, char, __int16 *, _DWORD *);
int __fastcall sub_45A0C(_BYTE *, int, int, __int16);
unsigned int __fastcall sub_45A54(P_Race pRace, P_Star pStar, P_Ship pShip);
unsigned int __fastcall sub_45D50(P_Race a1, P_Star a2, P_Ship a3);
unsigned int __fastcall sub_45E64(_BYTE *, __int16);
void __fastcall sub_45F60(_BYTE *, __int16, int);
unsigned int __fastcall sub_46034(_BYTE *, __int16);
void __fastcall sub_46130(_BYTE *, __int16, int);
unsigned int __fastcall sub_46208(_BYTE *, __int16);
int __fastcall sub_46304(_BYTE *, __int16, int);
void sub_46470();
void __fastcall __spoils<eax,edx> Q_RESEARCH_CPP_LoadResTreeTxt_sub_46480(P_ResTree pResTree, const char *fname);
int __fastcall sub_466FC(P_ResTree pResTree);
void __fastcall Q_CheckAllTechForShip_sub_468BC(P_ResTree pResTree);
MACRO_VFX_BOOL __fastcall Q_HasAllTechForShip_sub_46900(P_ResTree pResTree, char);
unsigned int __fastcall sub_4694C(int, unsigned __int16, __int16);
int __fastcall sub_469F0(int, unsigned __int16);
__int16 __fastcall sub_46A94(unsigned __int16 *, unsigned __int16, void *);
void __fastcall Q_ReadWriteResTree_sub_46BB0(P_ResTree a1, P_FileInfo a2, int read);
void __fastcall __spoils<> Q_ResTreeCtor_sub_46C10(P_ResTree a1);
int __fastcall Q_GetTurnsToComplete_sub_46C20(int cost, int done, int production);
void __fastcall __spoils<edx> Q_Wnd9RWDtor_sub_46C48(P_Wnd9RW, char);
int __fastcall sub_46CAC(P_Wnd9RW a1);
int __fastcall sub_47088(int);
unsigned int __fastcall sub_47224(int, unsigned __int16, LONG, unsigned int);
int __fastcall sub_47A64(const void *, const void *); // idb
void __fastcall sub_47ABC(int);
int __fastcall sub_48B14(int, unsigned int count, int);
void __fastcall __spoils<> Q_Wnd9RWCtor_sub_48B40(P_Wnd9RW a1);
void __fastcall __spoils<> Q_ShipCtor_sub_48B90(P_Ship pShip);
int __cdecl Q_ShipDtor_sub_48C58();
void __fastcall sub_48C5C(P_Ship pShip, char hullSize);
void Q_SHIP_CPP_LoadGizmosTxt_sub_48C84();
void __fastcall sub_48EAC(P_Ship pShip);
void __fastcall sub_49148(P_Ship pShip, char hullSize);
unsigned int __fastcall sub_492AC(_DWORD *, char, int);
MACRO_VFX_BOOL __fastcall Q_Ship_RemoveGizmo_sub_492F8(P_Ship pShip, int hullCellIndex);
int __fastcall sub_49328(int a1, char a2);
int __fastcall sub_4937C(P_Ship pShip, char gizmoIndex);
unsigned int __fastcall sub_493BC(P_Ship pShip, char);
void __fastcall sub_49494(int, float *);
unsigned int __fastcall sub_4960C(int, int);
unsigned int __fastcall sub_49648(T_Ship *, __int16 **);
void __fastcall sub_496BC(P_Ship a1, P_Vector3D pVector);
void __fastcall sub_496E0(P_Ship pShip);
void __fastcall sub_49828(P_Ship pShip);
void __fastcall sub_49940(P_Ship pShip);
void __fastcall sub_49A40(int a1, int a2);
T_Gizmo *__fastcall sub_49A8C(int, char *);
int __fastcall sub_49B3C(P_Ship pShip, int a2);
int __fastcall sub_49B68(int, int);
int __fastcall sub_49CC4(P_Ship pShip, int a2);
int __fastcall sub_4A0D0(P_Ship pShip, int a2);
int __fastcall Q_ShipGetGizmosCost_sub_4A144(P_Ship pShip);
int __fastcall sub_4A18C(P_Ship pShip);
int __fastcall sub_4A1CC(T_Ship *, __int16);
char __fastcall sub_4A36C(P_Ship a1, char a2, WORD raceIndex);
int __fastcall sub_4A404(int, char);
P_HullCell __fastcall sub_4A480(P_Ship pShip, unsigned __int16 a2, int a3);
MACRO_VFX_BOOL __fastcall Q_ShipHasGizmo_sub_4A534(P_Ship pShip, BYTE);
unsigned int __fastcall sub_4A564(int);
void __fastcall sub_4A5B8(P_Ship pShip);
void __fastcall sub_4A6AC(P_Ship pShip);
int __fastcall sub_4A8CC(P_Ship pShip);
int __fastcall sub_4A8FC(P_Ship pShip);
int __fastcall sub_4A988(P_Ship pShip);
int __fastcall sub_4AA78(int, int);
int __fastcall sub_4AAEC(int, int);
void __fastcall Q_ReadWriteShip_sub_4AE8C(P_Ship pShip, P_FileInfo pfi, int read);
void __fastcall Q_Type17Copy_sub_4B5C0(P_HullCell dst, P_HullCell src);
char *__fastcall Q_ShipCopy_sub_4B5E0(P_Ship, P_Ship);
int __fastcall sub_4B780(int result, int);
int __fastcall sub_4B7A0(int, int, int, __int16);
int __fastcall sub_4B944(P_Ship a1, int a2);
int __fastcall sub_4C7FC(P_Ship a1, int a2);
int __fastcall sub_4CAB8(P_Ship a1, int a2);
int __fastcall sub_4CDF8(P_Ship a1, int a2);
void sub_4D700();
int __fastcall sub_4D724(T_Type5 *, int, LONG, int);
unsigned int __fastcall sub_4D7A8(int, int, int);
P_Wnd8SW __fastcall sub_4D92C(P_Wnd8SW a1);
int __fastcall sub_4DA08(int a1, char a2, int a3, int a4);
void __fastcall __spoils<> sub_4DA5C(P_Wnd8SW result);
int __fastcall sub_4DA7C(int, int, int, int);
char __fastcall sub_4DD14(int);
unsigned int __fastcall sub_4DDB0(P_Wnd8SW a1, __int16 a2, int a3, int a4);
int __fastcall sub_4E644(int result, char, int, int);
unsigned int __fastcall sub_4E69C(int);
void __fastcall sub_4E758(_DWORD *);
int __fastcall sub_4EE00(int);
char *sub_4EE50();
P_SoundSystem __fastcall sub_4EE74(P_SoundSystem);
T_SoundSystem *__fastcall sub_4EF94(T_SoundSystem *a1);
LONG __fastcall Q_StartSoundSystem_sub_4EFB0(T_SoundSystem *, int aDIG, int aMDI);
HMDIDRIVER __fastcall sub_4F088(char *path, char *, char *, char *);
int __fastcall sub_4F184(P_SoundSystem a1, int a2);
void __fastcall sub_4F32C(P_SoundSystem a1, __int16 a2, int a3);
void __fastcall sub_4F45C(P_SoundSystem a1, __int16 a2);
void __fastcall sub_4F4D4(int, __int16);
HDIGDRIVER __fastcall sub_4F534(_DWORD *, char *, char *);
int __fastcall Q_AllocateSamples_sub_4F5E8(P_SoundSystem a1, int a2);
unsigned int __fastcall Q_LoadMusic_sub_4F65C(P_SoundSystem a1, const char *aMusicFName);
MACRO_VFX_BOOL __fastcall sub_4F8CC(P_SoundSystem, __int16 track, int setpos);
void __fastcall Q_StopSample_sub_4FA1C(P_SoundSystem a1);
void __fastcall sub_4FAB4(int);
void __fastcall Q_StartSample_sub_4FB90(P_SoundSystem a1, __int16 a2);
void __fastcall Q_StopSoundSystem_sub_4FE8C(P_SoundSystem a1);
void __fastcall Q_SetNoSound_sub_4FF08(P_SoundSystem a1);
void __fastcall sub_4FF1C(P_SoundSystem a1);
void __fastcall sub_4FF28(P_SoundSystem a1);
void __fastcall Q_SetVolume_sub_4FF4C(P_SoundSystem a1, char a2);
int __fastcall sub_4FF94(P_SoundSystem a1);
char *__fastcall sub_50140(P_SoundSystem, __int16);
UWORD __fastcall sub_50530(T_Type5 *a1, P_Planet pPlanet, int a3, int a4);
void __fastcall sub_50D70(PPANE pPANE, P_Ship pShip, int a3, int a4);
void __fastcall sub_51610(T_Type5 *, LONG, int, int);
void __fastcall __spoils<> Q_WndSWCtor_sub_51674(P_WndSW a1);
T_TypeA2 *__fastcall Q_WndSWDtor_sub_51690(T_TypeA2 *, char);
void __fastcall __spoils<> Q_A11_sub_516D4(P_TypeA11 result);
void __fastcall sub_516E0(_DWORD *);
unsigned int __fastcall sub_51894(int, __int16, __int16, LONG);
void __fastcall __spoils<> Q_WndFWCtor_sub_51B64(P_WndFW a1);
T_TypeA2 *__fastcall Q_WndFWDtor_sub_51B80(T_TypeA2 *, char);
void __fastcall sub_51BC4(_DWORD *);
unsigned int __fastcall sub_51D24(int, __int16, LONG, LONG);
void __fastcall __spoils<> Q_WndNGCtor_sub_520EC(P_WndNG a1);
T_TypeA2 *__fastcall Q_WndNGDtor_sub_52108(T_TypeA2 *, char);
void __fastcall Q_WndNG_sub_5214C(P_WndNG result);
int __fastcall sub_52174(int);
void __fastcall sub_521C0(int, int edx0);
unsigned int sub_526D8();
int __fastcall sub_52714(int);
unsigned int __fastcall sub_5294C(int, __int16 dx0, LONG, LONG);
void __fastcall Q_NormVector3D_sub_53000(T_Vector3D *a1);
void __fastcall sub_53054(float *, float);
unsigned int __fastcall sub_53078(_DWORD *);
double __fastcall sub_5309C(float *, float *);
float *__fastcall sub_53114(float *result, float *);
P_Vector3D __fastcall sub_5323C(P_Vector3D result, float a2);
void __fastcall Q_RotateVectorY_sub_532AC(T_Vector3D *vector, float degrees);
float *__fastcall sub_53318(float *result, float);
float *__fastcall sub_53384(float *result, float *, float *);
void __fastcall sub_533D4(P_Vector3D a1, float a2, int a3, int a4, int a5, int a6);
void __fastcall sub_53440(T_Vector3D *pVector);
void __fastcall sub_5353C(float *, int, int, int, int);
void __fastcall sub_53564(float *, int, int, int, int);
// void __userpurge sub_5358C(P_Wnd9RW1 a1@<eax>, float a2);
void __fastcall sub_535B4(P_Wnd9RW1 a1, float a2);
// void __userpurge sub_535E4(P_Wnd9RW1 a1@<eax>, float degrees);
void __fastcall sub_53644(float *, int, int, int);
void __fastcall sub_53754(float *, int, int, int);
void __fastcall sub_53864(P_Matrix a1);
float *__fastcall sub_53B08(float *result, float *, float *, float *);
int __cdecl sub_53D22(int);
void sub_53DC0();
void __cdecl Q_Timer_sub_53DE4();
int Q_CheckFreeMemory_sub_53DEC();
void __fastcall Q_WINMGR_CPP_sub_53E38(PANE *pane, LONG hotX, LONG hotY, __int16 a4);
void __fastcall sub_53EB8(PANE *pane, void *shape_table, LONG shape_number, LONG hotX, LONG hotY, __int16 a6);
void __fastcall sub_53F40(T_Type5 *, void *, LONG, LONG, int, char);
void __fastcall Q_LoadGam_sub_53FB0(const char *fname);
T_FileInfo *__fastcall Q_SaveGam_sub_54048(const char *fname);
LONG __fastcall sub_54208(PANE *source);
LONG __fastcall Q_WINMGR_CPP_sub_542B0(PANE *target);
void __fastcall __spoils<> Q_WinMgrCtor_sub_54344(P_WinMgr a1);
void __fastcall Q_WinMgrDtor_sub_54374(P_WinMgr pWinMgr);
T_Type4 *__fastcall sub_54448(P_WinMgr);
unsigned int __fastcall Q_WINMGR_CPP_StartTimer_sub_545EC(P_WinMgr a1);
void __fastcall sub_54664(P_WinMgr a1);
int __fastcall sub_5469C(P_WinMgr pWinMgr);
unsigned int __fastcall sub_54D64(P_WinMgr a1);
void __fastcall sub_5508C(P_WinMgr);
void __fastcall sub_55214(T_WinMgr *, LONG x1, LONG y1, LONG x2, int y2);
void __fastcall sub_55274(P_WinMgr a1, int x1, int y1, int x2, int y2);
void __fastcall sub_552CC(P_WinMgr a1, PANE *a2);
int __fastcall sub_552F8(P_WinMgr a1, P_TypeA2 a2, int a3);
LONG __fastcall sub_55554(int, _DWORD *);
void __fastcall sub_55618(P_WinMgr a1);
void __fastcall Q_ShowMsgBox_sub_556CC(P_WinMgr a1, char *a2);
const char *__fastcall sub_557D4(T_WinMgr *eax0, char *s2, const char *, __int16);
MACRO_VFX_BOOL __fastcall Q_AddGameEvent_sub_55AEC(P_WinMgr pWinMgr, int eventId, void *p1, void *p2);
void __fastcall sub_55B74(P_WinMgr pWinMgr);
void __fastcall sub_55E80(P_WinMgr pWinMgr);
void __fastcall sub_56400(T_WinMgr *, int, __int16, int, int, int);
void __fastcall sub_564C0(T_WinMgr *, int, __int16);
int __fastcall sub_56528(int, int, __int16);
unsigned int __fastcall sub_56564(int, int, __int16, int);
int __fastcall sub_56694(T_WinMgr *);
void __fastcall sub_56728(P_WinMgr a1, int hwnd, int f, WORD msg, int p1, int p2);
void __fastcall sub_567BC(P_WinMgr a1, int a2, __int16 a3);
void __fastcall sub_56824(T_WinMgr *);
P_WinMgr __fastcall sub_5691C(P_WinMgr result);
int __fastcall sub_56B60(P_WinMgr a1, __int16 a2, int a3, int a4);
void __fastcall sub_56BE8(P_WinMgr pWinMgr, __int16 a2, int a3, int a4, int a5);
int __fastcall sub_56D30(P_WinMgr pWinMgr, int wndIndex, WORD message, int param1, int param2);
T_TypeA2 *__fastcall sub_56D70(T_WinMgr *, char *, __int16, int, int);
T_TypeA2 *__fastcall Q_FindWnd_sub_56DA8(P_WinMgr pWinMgr, char *name, _WORD *index);
T_TypeA2 *__fastcall sub_56E18(P_WinMgr, char *s1, __int16, _WORD *);
P_WinMgr __fastcall sub_56E9C(P_WinMgr a1, WORD a2, int a3);
int __fastcall sub_570AC(P_WinMgr a1, int a2);
int __fastcall Q_WINMGR_CPP_RegisterWindow_sub_571B8(P_WinMgr a1, P_TypeA1 a2);
unsigned int __fastcall sub_57220(P_WinMgr a1, int index, __int16 state);
unsigned int __fastcall sub_57310(P_WinMgr a1, int a2, __int16 a3, int a4);
unsigned int __fastcall sub_5748C(P_WinMgr a1, __int16 stateNumber, __int16 a3);
void __fastcall Q_SetProc1_sub_574F0(P_WinMgr a1, __int16 index, void *proc);
void __fastcall Q_SetProc2_sub_57510(P_WinMgr a1, __int16 index, void *proc);
void __fastcall sub_57530(P_WinMgr a1, int wndIndex, int a3);
void __fastcall sub_575BC(P_WinMgr);
void __fastcall Q_WINMGR_CPP_LoadWindowsTxt_sub_57670(P_WinMgr pType3, const char *fname);
void __fastcall Q_LoadAscendCfg_sub_59828(P_WinMgr);
T_FileInfo *__fastcall Q_SaveAscendCfg_sub_5989C(P_WinMgr a1);
int __fastcall sub_59908(int result);
void __fastcall sub_59934(P_WinMgr a1, int toTxt);
unsigned int __fastcall sub_59988(P_WinMgr, char *, int);
P_WinMgr __fastcall sub_59A54(P_WinMgr a1);
void __fastcall sub_59B80(T_WinMgr *);
void __fastcall sub_59C80(P_WinMgr a1, int hwnd, WORD eventType, WORD msg, int p1, int p2, int f);
unsigned int __fastcall sub_59CFC(P_WinMgr a1, const char *a2);
void __fastcall Q_WINMGR_CPP_WriteWinEventBin_sub_59DE0(P_WinMgr a1);
void __fastcall Q_WINMGR_CPP_WinEventBinToTxt_sub_59E88(P_WinMgr a1, char *binname, char *txtname);
void __fastcall Q_WINMGR_CPP_sub_5A094(P_WinMgr a1, void *aData, int a3, char *name);
void __fastcall Q_WINMGR_CPP_sub_5A144(P_WinMgr a1, void *pdata);
char *__fastcall sub_5A194(int, int, _DWORD *, _DWORD *);
void __fastcall sub_5A270(T_WinMgr *a1, int a2, int a3, int a4);
void __fastcall Q_WinMgr_CallProc6_sub_5A294(P_WinMgr a1, P_FileInfo pfi, int read);
void __fastcall Q_Proc_sub_5A320(__int16);
int __fastcall sub_5A47C(T_Type5 *, const char *, int, int);
LONG __fastcall sub_5A4E4(_DWORD *, LONG, int, int);
void __fastcall __spoils<> Q_Wnd13DBGWNDCtor_sub_5A594(P_Wnd13DBGWND a1);
T_TypeA2 *__fastcall Q_Wnd13DBGWNDDtor_sub_5A5AC(T_TypeA2 *, char);
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_5A5F4(P_TypeA1 a1);
unsigned int __fastcall sub_5A60C(int, __int16, __int16, LONG);
void __fastcall sub_5AA08(int);
int __fastcall sub_5AB04(const char **, const char **);
void __fastcall sub_5AB2C(int, int);
int __fastcall sub_5AE68(int, int);
unsigned int __fastcall sub_5AF30(int, int);
int __fastcall sub_5B200(int, int);
int __fastcall sub_5B244(int result, int);
T_TypeA2 *__fastcall sub_5B2B0(T_TypeA2 *, char);
T_TypeA2 *__fastcall sub_5B2F0(T_TypeA2 *result);
T_TypeA2 *__fastcall sub_5B300(T_TypeA2 *, char);
T_TypeA2 *__fastcall sub_5B340(T_TypeA2 *result);
BOOL __fastcall sub_5B50C(_DWORD *, _DWORD *);
PANE_LIST *__fastcall sub_5B617(size_t);
unsigned int __fastcall sub_5B71C(PPANE_LIST a1);
unsigned int __fastcall sub_5B7C2(_DWORD *a1, int a2, int x1, int y1, int x2, int y2);
unsigned int __fastcall sub_5BA38(PPANE_LIST a1);
int __fastcall sub_5BAC0(_DWORD *, int);
char *__fastcall sub_5BBE4(void **, char *, int);
void __fastcall sub_5BDDC(void *);
// BYTE *__cdecl VFX_driver_name(void *VFXScanDLL);
// LONG __cdecl VFX_register_driver(void *DLLbase);
// LONG __cdecl VFX_pixel_write(PANE *pane, LONG x, LONG y, ULONG color);
// LONG __cdecl VFX_pixel_read(PANE *pane, LONG x, LONG y);
// LONG __cdecl VFX_line_draw(PANE *pane, LONG x0, LONG y0, LONG x1, LONG y1, LONG mode, LONG parm);
// void __cdecl VFX_shape_draw(PANE *pane, void *shape_table, LONG shape_number, LONG hotX, LONG hotY);
// void __cdecl VFX_shape_lookaside(UBYTE *table);
// void __cdecl VFX_shape_translate_draw(PANE *pane, void *shape_table, LONG shape_number, LONG hotX, LONG hotY);
// void __cdecl VFX_shape_transform(PANE *pane, void *shape_table, LONG shape_number, LONG hotX, LONG hotY, void *buffer, LONG rot, LONG x_scale, LONG y_scale, LONG flags);
// void __cdecl VFX_shape_visible_rectangle(void *shape_table, LONG shape_number, LONG hotX, LONG hotY, LONG mirror, RECT *rectangle);
// LONG __cdecl VFX_pane_wipe(PANE *pane, LONG color);
// LONG __cdecl VFX_pane_copy(PANE *source, LONG sx, LONG sy, PANE *target, LONG tx, LONG ty, LONG fill);
// void __cdecl VFX_ellipse_draw(PANE *pane, LONG xc, LONG yc, LONG width, LONG height, LONG color);
// void __cdecl VFX_ellipse_fill(PANE *pane, LONG xc, LONG yc, LONG width, LONG height, LONG color);
// LONG __cdecl VFX_font_height(VFX_FONT *font);
// LONG __cdecl VFX_character_width(void *font, LONG character);
// LONG __cdecl VFX_character_draw(PANE *pane, LONG x, LONG y, void *font, LONG character, UBYTE *color_translate);
// void __cdecl VFX_string_draw(PANE *pane, LONG x, LONG y, void *font, char *string, UBYTE *color_translate);
// LONG __cdecl VFX_GIF_draw(PANE *pane, UBYTE *GIF_buffer, void *GIF_scratch);
// LONG __cdecl VFX_shape_resolution(void *shape_table, LONG shape_num);
// LONG __cdecl VFX_shape_count(void *shape_table);
// void __cdecl VFX_window_fade(WINDOW *buffer, RGB *palette, LONG intervals);
// int __cdecl sub_61800(_DWORD *, int, int);
// LONG __cdecl sub_62DA5(WINDOW *, int, int, int);
// void MOUSE_show(void);
// void MOUSE_hide(void);
// void __fastcall MOUSE_set_pointer(void *table, LONG shape);
// void __fastcall MOUSE_status(LONG *mx, LONG *my, LONG *ml, LONG *mr, LONG *mc);
// void __fastcall MOUSE_force_move(LONG new_x, LONG new_y);
// void __fastcall MOUSE_pane_list_refresh(PANE_LIST *list);
// LONG __fastcall MOUSE_init(LONG xsize, LONG ysize);
// void MOUSE_shutdown(void);
// void *__cdecl DLL_load(void *source, ULONG flags, void *dll);
// void __cdecl AIL_startup();
// void __cdecl AIL_shutdown();
// HTIMER __cdecl AIL_register_timer(AILTIMERCB callback_fn);
// void __cdecl AIL_set_timer_frequency(HTIMER timer, ULONG hertz);
// void __cdecl AIL_start_timer(HTIMER timer);
// void __cdecl AIL_stop_timer(HTIMER timer);
// void __cdecl AIL_release_timer_handle(HTIMER timer);
// LONG __cdecl AIL_install_DIG_INI();
// HDIGDRIVER __cdecl AIL_install_DIG_driver_file(BYTE *filename, IO_PARMS *IO);
// HSAMPLE __cdecl AIL_allocate_sample_handle(HDIGDRIVER dig);
// void __cdecl AIL_init_sample(HSAMPLE S);
// void __cdecl AIL_set_sample_address(HSAMPLE S, void *start, ULONG len);
// void __cdecl AIL_set_sample_type(HSAMPLE S, LONG format, ULONG flags);
// void __cdecl AIL_start_sample(HSAMPLE S);
// void __cdecl AIL_stop_sample(HSAMPLE S);
// void __cdecl AIL_set_sample_playback_rate(HSAMPLE S, LONG playback_rate);
// void __cdecl AIL_set_sample_volume(HSAMPLE S, LONG volume);
// void __cdecl AIL_set_sample_loop_count(HSAMPLE S, LONG loop_count);
// ULONG __cdecl AIL_sample_status(HSAMPLE S);
// LONG __cdecl AIL_minimum_sample_buffer_size(HDIGDRIVER dig, LONG playback_rate, LONG format);
// LONG __cdecl AIL_sample_buffer_ready(HSAMPLE S);
// void __cdecl AIL_load_sample_buffer(HSAMPLE S, ULONG buff_num, void *buffer, ULONG len);
// LONG __cdecl AIL_install_MDI_INI();
// HMDIDRIVER __cdecl AIL_install_MDI_driver_file(BYTE *filename, IO_PARMS *IO);
// HSEQUENCE __cdecl AIL_allocate_sequence_handle(HMDIDRIVER mdi);
// void __cdecl AIL_start_sequence(HSEQUENCE S);
// void __cdecl AIL_stop_sequence(HSEQUENCE S);
// void __cdecl AIL_end_sequence(HSEQUENCE S);
// ULONG __cdecl AIL_sequence_status(HSEQUENCE S);
// void __cdecl AIL_set_GTL_filename_prefix(BYTE *prefix);
// __int16 UVB_sub_7501C();
// FILE *__usercall UVB_sub_75098@<eax>(int@<eax>, int@<edx>, int@<ecx>, int@<ebx>, char *, int);
// int sprintf(char *s, const char *format, ...);
// char *__fastcall _wcpp_2_dtor_array_store_(void *a1, rt_type_sig_clss *a2);
// void __fastcall operator delete[](void *); weak
// void __fastcall operator delete(void *); weak
// int __fastcall strcmp(const char *s1, const char *s2);
// double __fastcall sqrt(double x);
// void _CHP();
// void __fastcall __spoils<edx> memset(void *s, int c, size_t n);
// void __fastcall qsort(void *base, size_t nmemb, size_t size, int (__fastcall *compar)(const void *, const void *));
// void __fastcall __spoils<edx,ebx> _wcpp_2_ctor_array_(void *array, unsigned int count, rt_type_sig_clss *sig);
// int sscanf(const char *s, const char *format, ...);
// int __fastcall fclose(FILE *fp);
// double __fastcall cos(double x);
// double __fastcall sin(double x);
// double __fastcall tan(double x);
// void *__fastcall operator new[](size_t size);
// void __fastcall __spoils<edx,ebx> _wcpp_2_dtor_array_(void *array, int count, rt_type_sig_clss *a3);
// int __fastcall stricmp(const char *s1, const char *s2);
// FILE *__fastcall fdopen(int handle, const char *mode);
// int __fastcall fgetpos(FILE *fp, fpos_t *pos);
// char *__fastcall strncpy(char *s1, const char *s2, size_t n);
// int __fastcall filelength(int handle);
// int open(const char *path, int oflag, ...);
// int __fastcall lseek(int handle, int offset, int origin);
// int __fastcall close(int handle);
// int __fastcall tell(int handle);
// volatile int *__fastcall _get_errno_ptr();
// int __fastcall read(int handle, void *buf, unsigned int len);
// unsigned int __usercall dos_write@<eax>(int handle@<eax>, const void *buf@<ebx>, unsigned int count@<edx>, unsigned int *bytes);
// void __fastcall _assert(int, char *, char *, int);
// int __fastcall write(int handle, const void *buf, unsigned int len);
// FILE *__fastcall fopen(const char *filename, const char *mode);
// int fscanf(FILE *fp, const char *format, ...);
// clock_t clock(void);
// int printf(const char *format, ...);
// int __fastcall atexit(void (*func)(void));
// int getch(void);
// void __fastcall exit(int status);
// int heapchk(void);
// time_t __fastcall time(time_t *timer);
// int rand(void);
// void __fastcall srand(unsigned int seed);
// int __fastcall access(const char *path, int mode);
// char *__fastcall fgets(char *s, int n, FILE *fp);
// _DWORD *__fastcall _wcpp_2_mod_register_(_DWORD *result);
// int fprintf(FILE *fp, const char *format, ...);
// int __fastcall vsprintf(char *s, const char *format, __va_list arg);
// void *__fastcall malloc(size_t size);
// void *__fastcall calloc(size_t n, size_t size);
// void __fastcall free(void *ptr);
// int __fastcall strnicmp(const char *s1, const char *s2, size_t n);
// int __fastcall atoi(const char *nptr);
// char *__fastcall strdup(const char *string);
// void __fastcall delay(unsigned int milliseconds);
// unsigned int __fastcall dos_getftime(int handle, unsigned __int16 *date, unsigned __int16 *time);
// int __fastcall strncmp(const char *s1, const char *s2, size_t n);
// double __fastcall pow(double x, double y);
// _DWORD __stdcall _wcpp_2_assign_array_(_DWORD); weak
// void *__fastcall _wcpp_2_copy_array_(void *arrayd, void *arrays, int count, rt_type_sig_clss *sig);
// double __fastcall acos(double x);
// void *__fastcall operator new(size_t size);
// char *__fastcall strupr(char *string);
// int __fastcall heapwalk(struct _heapinfo *entry);
// void *__fastcall memmove(void *s1, const void *s2, size_t n);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_1829D; // weak
_UNKNOWN loc_21D90; // weak
_UNKNOWN loc_21D96; // weak
_UNKNOWN loc_21DB2; // weak
_UNKNOWN loc_24D98; // weak
_UNKNOWN loc_24D9B; // weak
_UNKNOWN loc_24D9E; // weak
_UNKNOWN loc_24DA4; // weak
_UNKNOWN loc_24DAA; // weak
_UNKNOWN loc_24DAD; // weak
_UNKNOWN loc_27281; // weak
_UNKNOWN loc_27C93; // weak
_UNKNOWN loc_30700; // weak
_UNKNOWN loc_32DCD; // weak
_UNKNOWN loc_32DDA; // weak
_UNKNOWN loc_493DC; // weak
__int16 word_53CEA = 0; // weak
__int16 word_53D02 = 0; // weak
__int16 word_53D06 = 0; // weak
__int16 word_53D0A = 0; // weak
__int16 DMPI_real_mode_segment_base_word_53D0C = 0; // weak
__int16 word_53D0E = 0; // weak
int DMPI_selector_dword_53D1C = 0; // weak
char aInvalidOrder[14] = "INVALID ORDER"; // weak
char asc_91762[2] = "\\"; // weak
char aVfxscanDll[13] = "\\VFXSCAN.DLL"; // weak
char aTsv[5] = ".tsv"; // weak
char aBin[5] = ".bin"; // weak
char aPlayerDip[11] = "PLAYER.DIP"; // weak
double dbl_91DD9 = 4000000.0; // weak
_UNKNOWN unk_920AA; // weak
_UNKNOWN unk_92696; // weak
char asc_929AC[2] = "\\"; // weak
char asc_92A57[2] = "\\"; // weak
_UNKNOWN unk_92C97; // weak
char aTxt[5] = ".txt"; // weak
_UNKNOWN unk_959A4; // weak
int (*off_959B8[2])() = { &sub_10A80, &sub_2CA78 }; // weak
rt_type_sig_clss C_Vector3D =
{
  0,
  &Q_Vector3DCtor_sub_13BF0,
  &Q_Vector3DCopy_sub_13BC0,
  &Q_Vector3DDtor_sub_13BE0,
  12,
  ""
}; // idb
rt_type_sig_clss C_Wnd4BM =
{
  0,
  &Q_Wnd4BMCtor_sub_15ED4,
  &_wcpp_2_undefed_cdtor_,
  &Q_Wnd4BMDtor_sub_1604C,
  20558,
  ""
};
rt_type_sig_clss C_Type16 = { 0, &sub_1ABE0, &sub_1AA40, &sub_1ABD0, 36, "" }; // idb
T_Procs Wnd4BM_Procs =
{
  &Q_Wnd4BMDtor_sub_1604C,
  &sub_2CA78,
  &sub_16348,
  &sub_18CA8,
  &sub_2CF28,
  &sub_19E2C
};
rt_type_sig_clss C_Type09 = { 0, &sub_223E0, &_wcpp_2_undefed_cdtor_, &sub_223D0, 414, "" };
rt_type_sig_clss C_Sector =
{
  0,
  &Q_SectorCtor_sub_223B0,
  &_wcpp_2_undefed_cdtor_,
  &Q_SectorDtor_sub_223A0,
  13,
  ""
};
rt_type_sig_clss C_Ship =
{
  0,
  &Q_ShipCtor_sub_48B90,
  &Q_ShipCopy_sub_4B5E0,
  &Q_ShipDtor_sub_48C58,
  354,
  ""
};
rt_type_sig_clss C_Planet =
{
  0,
  &Q_PlanetCtor_sub_22400,
  &_wcpp_2_undefed_cdtor_,
  &Q_PlanetDtor_sub_22340,
  123,
  ""
};
rt_type_sig_clss C_Lane = { 0, &sub_22360, &_wcpp_2_undefed_cdtor_, &sub_22350, 39, "" };
rt_type_sig_clss C_Race =
{
  0,
  &Q_RaceCtor_sub_3B120,
  &_wcpp_2_undefed_cdtor_,
  &Q_RaceDtor_3B184,
  494,
  ""
};
rt_type_sig_clss C_Star = { 0, &Q_StarCtor_sub_1CF40, &_wcpp_2_undefed_cdtor_, &Q_StarDtor_1CF64, 96, "" };
rt_type_sig_clss C_WndRSW =
{
  0,
  &Q_WndRSWCtor_sub_25CB8,
  &_wcpp_2_undefed_cdtor_,
  &Q_WndRSWDtor_sub_25CD4,
  177,
  ""
};
_UNKNOWN unk_95B48; // weak
rt_type_sig_clss C_Wnd2COSW =
{
  0,
  &Q_Wnd2COSWCtor_sub_224A4,
  &_wcpp_2_undefed_cdtor_,
  &Q_Wnd2COSWDtor_sub_22588,
  1430,
  ""
};
int (*off_95B84[5])() = { &Q_WndRSWDtor_sub_25CD4, &sub_2CA78, &sub_26000, &sub_25D18, &sub_25FB4 }; // weak
int (*off_95B9C[2])() = { &sub_25C08, &sub_2CA78 }; // weak
T_Procs Wnd2COSW_Procs =
{
  &Q_Wnd2COSWDtor_sub_22588,
  &sub_2CA78,
  &frame_is_wrong_sub_228A4,
  &sub_23BF0,
  &sub_2CF28,
  &sub_24FCC
};
_UNKNOWN unk_95C04; // weak
_UNKNOWN unk_95C18; // weak
rt_type_sig_clss C_Wnd23EW =
{
  0,
  &Q_Wnd23EWCtor_sub_267A0,
  &_wcpp_2_undefed_cdtor_,
  &Q_Wnd23EWDtor_sub_267BC,
  3507,
  ""
};
int (*off_95C40[5])() = { &sub_27C08, &sub_2CA78, &sub_27C50, &sub_27D18, &sub_2CF28 }; // weak
int (*off_95C58[5])() = { &sub_2713C, &sub_2CA78, &sub_27184, &sub_271FC, &sub_2CF28 }; // weak
T_Procs Wnd23EW_Procs =
{
  &Q_Wnd23EWDtor_sub_267BC,
  &sub_2CA78,
  &sub_270F4,
  &sub_27124,
  &sub_2CF28,
  &locret_2D460
};
rt_type_sig_clss C_Wnd1FLIC =
{
  0,
  &Q_Wnd1FLICCtor_sub_2AE80,
  &_wcpp_2_undefed_cdtor_,
  &Q_Wnd1FLICDtor_sub_2AEB0,
  2569,
  ""
};
int (*off_95CB4[3])() = { &Q_Wnd1FLICDtor_sub_2AEB0, &sub_2CA78, &sub_2AFF0 }; // weak
_UNKNOWN unk_95D04; // weak
_UNKNOWN unk_95D18; // weak
_UNKNOWN unk_95D2C; // weak
rt_type_sig_clss stru_95D40 = { 0, &Q_Wnd10LBCtor_sub_2E248, &_wcpp_2_undefed_cdtor_, &sub_2E264, 2306, "" };
_UNKNOWN unk_95D54; // weak
_UNKNOWN unk_95D68; // weak
rt_type_sig_clss C_A2 =
{
  0,
  &Q_A2Ctor_sub_2C830,
  &_wcpp_2_undefed_cdtor_,
  &Q_A2Dtor_sub_2C848,
  171,
  ""
};
int (*off_95D90[5])() = { &sub_2FA34, &sub_2CA78, &sub_2F420, &sub_2FA98, &sub_2CF28 }; // weak
int (*off_95DA8[4])() = { &sub_2F4A8, &sub_2CA78, &sub_2F6B0, &sub_2F540 }; // weak
int (*off_95DC0[5])() = { &sub_2F30C, &sub_2CA78, &sub_2F478, &sub_2F354, &sub_2F414 }; // weak
int (*off_95DD8[5])() = { &sub_2E264, &sub_2CA78, &sub_2E3D4, &sub_2E6C0, &sub_2CF28 }; // weak
int (*off_95DF0[5])() = { &sub_2D9FC, &sub_2DB54, &sub_2DE68, &sub_2E084, &sub_2CF28 }; // weak
int (*off_95E08[5])() = { &sub_2D480, &sub_2CA78, &sub_2D4D0, &sub_2D528, &sub_2D79C }; // weak
int (*off_95E20[2])() = { &Q_A2Dtor_sub_2C848, &sub_2CA78 }; // weak
_UNKNOWN unk_95E40; // weak
int (*off_95E54[5])() = { &sub_2FC68, &sub_2CA78, &sub_2FD68, &sub_30774, &sub_2CF28 }; // weak
_UNKNOWN unk_95E74; // weak
int (*off_95E88[5])() = { &sub_3121C, &sub_2CA78, &sub_31268, &sub_3160C, &sub_2CF28 }; // weak
_UNKNOWN unk_95EB0; // weak
_UNKNOWN unk_95EC4; // weak
_UNKNOWN unk_95ED8; // weak
int (*off_95EEC[2])() = { &sub_33840, &sub_2CA78 }; // weak
int (*off_95F04[5])() = { &sub_335B4, &sub_2CA78, &sub_33604, &sub_33674, &sub_2CF28 }; // weak
int (*off_95F1C[2])() = { &sub_32038, &sub_2CA78 }; // weak
_UNKNOWN unk_95F44; // weak
_UNKNOWN unk_95F58; // weak
int (*off_95F6C[5])() = { &sub_395FC, &sub_2CA78, &sub_39644, &sub_396F0, &sub_2CF28 }; // weak
int (*off_95F84[5])() = { &sub_372CC, &sub_2CA78, &sub_37568, &sub_384B0, &sub_2CF28 }; // weak
rt_type_sig_clss C_Wnd14PSW = { 0, &Q_Wnd14PSWCtor_sub_39D80, &_wcpp_2_undefed_cdtor_, &sub_39D9C, 173, "" };
int (*off_95FB8[5])() = { &sub_39D9C, &sub_2CA78, &sub_39E3C, &sub_3A6BC, &sub_2CF28 }; // weak
rt_type_sig_clss C_Wnd9RW =
{
  0,
  &Q_Wnd9RWCtor_sub_48B40,
  &_wcpp_2_undefed_cdtor_,
  &Q_Wnd9RWDtor_sub_46C48,
  2525,
  ""
};
int (*off_96018[5])() = { &Q_Wnd9RWDtor_sub_46C48, &sub_2CA78, &sub_47224, &sub_47ABC, &sub_2CF28 }; // weak
rt_type_sig_clss C_HullCell =
{
  0,
  &_wcpp_2_undefed_cdtor_,
  &Q_Type17Copy_sub_4B5C0,
  &_wcpp_2_undefed_cdtor_,
  7,
  ""
};
_UNKNOWN unk_96068; // weak
int (*off_9607C[2])() = { &sub_4DA08, &sub_2CA78 }; // weak
rt_type_sig_clss C_WndNG =
{
  0,
  &Q_WndNGCtor_sub_520EC,
  &_wcpp_2_undefed_cdtor_,
  &Q_WndNGDtor_sub_52108,
  189,
  ""
};
rt_type_sig_clss C_WndFW =
{
  0,
  &Q_WndFWCtor_sub_51B64,
  &_wcpp_2_undefed_cdtor_,
  &Q_WndFWDtor_sub_51B80,
  177,
  ""
};
rt_type_sig_clss C_WndSW =
{
  0,
  &Q_WndSWCtor_sub_51674,
  &_wcpp_2_undefed_cdtor_,
  &Q_WndSWDtor_sub_51690,
  177,
  ""
};
int (*off_960F8[5])() = { &Q_WndNGDtor_sub_52108, &sub_2CA78, &sub_5294C, &sub_521C0, &sub_2CF28 }; // weak
int (*off_96110[5])() = { &Q_WndFWDtor_sub_51B80, &sub_2CA78, &sub_51D24, &sub_51BC4, &sub_2CF28 }; // weak
int (*off_96128[5])() = { &Q_WndSWDtor_sub_51690, &sub_2CA78, &sub_51894, &sub_516E0, &sub_2CF28 }; // weak
rt_type_sig_clss C_Wnd13DBGWND =
{
  0,
  &Q_Wnd13DBGWNDCtor_sub_5A594,
  &_wcpp_2_undefed_cdtor_,
  &Q_Wnd13DBGWNDDtor_sub_5A5AC,
  192,
  ""
};
_UNKNOWN unk_96184; // weak
_UNKNOWN unk_96198; // weak
int (*off_961AC[5])() = { &Q_Wnd13DBGWNDDtor_sub_5A5AC, &sub_2CA78, &sub_5A60C, &sub_5AA08, &sub_2CF28 }; // weak
int (*off_961C4[2])() = { &sub_5B2B0, &sub_2CA78 }; // weak
int (*off_961DC[2])() = { &sub_5B300, &sub_2CA78 }; // weak
char aDataRacea03Haz[17] = "DATA\\RACEA03.HAZ"; // weak
int off_964E0 = 592479; // idb
_DWORD dword_964E4 = 0; // weak
int dword_964EC = 0; // weak
__int16 word_964F0[5] = { 10, 25, 40, 55, 70 };
__int16 word_964FA[13] = { 30, 30, 30, 30, 20, 20, 20, 20, 20, 20, 15, 15, 15 };
__int16 word_96514[13] = { 16, 4, 6, 4, 8, 13, 11, 8, 5, 6, 2, 9, 8 };
__int16 word_9652E[13] = { 6, 6, 6, 6, 4, 4, 4, 4, 4, 4, 3, 3, 3 };
int dword_96548[21] = { 4, 4, 3, 4, 3, 4, 3, 3, 4, 3, 3, 3, 4, 4, 4, 3, 4, 3, 2, 3, 3 }; // weak
int dword_9659C[21] = { 5, 1, 1, 6, 3, 2, 8, 6, 4, 4, 10, 2, 7, 8, 9, 7, 3, 5, 3, 7, 9 }; // weak
char byte_965F8[5] = { '\x05', '\x05', '\x05', '\x0E', '\x0E' }; // weak
int dword_965FD = -33549042; // weak
_DWORD dword_96654[5] = { 0, 0, 0, 0, 0 }; // weak
char s[] = "Thank you for playing Ascendancy."; // idb
_DWORD dword_96768 = 0; // weak
int dword_96770 = 0; // weak
int Q_GameLoop_dword_96774 = -1; // weak
char byte_96778 = '\xF3'; // weak
char byte_96779[7] = { '\x13', '\x17', '\x1B', '\x1F', '#', '\'', '+' }; // weak
_DWORD dword_96780 = 0; // weak
int dword_96788 = 0; // weak
char V_Romans100[10][5] =
{
  { '\0', '\0', '\0', '\0', '\0' },
  "C",
  "CC",
  "CCC",
  "CD",
  "D",
  "DC",
  "DCC",
  "DCCC",
  "CM"
};
char V_Romans10[10][5] =
{
  { '\0', '\0', '\0', '\0', '\0' },
  "X",
  "XX",
  "XXX",
  "XL",
  "L",
  "LX",
  "LXX",
  "LXXX",
  "XC"
};
char V_Romans1[10][5] =
{
  { '\0', '\0', '\0', '\0', '\0' },
  "I",
  "II",
  "III",
  "IV",
  "V",
  "VI",
  "VII",
  "VIII",
  "IX"
};
__int16 word_9682E[5] = { 207, 297, 252, 207, 297 }; // weak
__int16 word_96838[4] = { 358, 358, 403, 442 }; // weak
int dword_96840 = -65094; // weak
int V_PlanItem50 = 100; // weak
char *off_96850[5] = { "PLRES", "PLIND", "PLPRO", "PLPOP", "PLBUILD" }; // weak
_DWORD dword_96864[2] = { 50397184, 33686273 }; // weak
_UNKNOWN unk_9686C; // weak
_UNKNOWN unk_968A8; // weak
char V_RaceIndexMask = '\x01'; // weak
char byte_968DD = '\xFF'; // weak
__int16 word_968E8[21] =
{
  0,
  0,
  0,
  0,
  0,
  60,
  100,
  62,
  77,
  90,
  150,
  140,
  63,
  66,
  72,
  0,
  92,
  100,
  0,
  89,
  68
}; // weak
_UNKNOWN unk_96912; // weak
_UNKNOWN unk_96918; // weak
_UNKNOWN unk_9691E; // weak
_UNKNOWN unk_9696C; // weak
_UNKNOWN unk_96994; // weak
__int16 V_HullCells[5] = { 0, 5, 10, 15, 25 };
char byte_969A8[] = { '\0' }; // weak
char byte_969B8[16] =
{
  '\x02',
  '\x03',
  '\x03',
  '\x03',
  '\x03',
  '\x03',
  '\x03',
  '\x04',
  '\x05',
  '\x05',
  '\x05',
  '\x05',
  '\x03',
  '\x01',
  '\0',
  '\0'
}; // weak
char byte_969C8[16] =
{
  '\x03',
  '\a',
  '\a',
  '\a',
  '\a',
  '\a',
  '\a',
  '\x0F',
  '\x1F',
  '\x1F',
  '\x1F',
  '\x1F',
  '\a',
  '\x01',
  '\0',
  '\0'
}; // weak
_DWORD dword_969D8[4] = { 70, 170, 240, 410 }; // weak
_DWORD dword_96AC0 = 0; // weak
int dword_96AC8 = 0; // weak
int dword_96ACC = -1; // weak
int dword_96AD0 = -1; // weak
_UNKNOWN unk_96AD4; // weak
_DWORD dword_96B08 = 0; // weak
int dword_96B10 = 0; // weak
int word_96B2A = -1; // idb
int word_96B2C = 65535; // idb
_UNKNOWN unk_96B30; // weak
__int16 word_96B6C = 6166; // weak
int word_96B6E = -1; // idb
int word_96B70 = -1; // idb
int word_96B72 = 1048575; // idb
_DWORD dword_96B74[5] = { 15, 25, 50, 75, 100 }; // weak
int dword_96B88 = 5; // weak
_DWORD dword_96B8C = 0; // weak
int dword_96B94 = 0; // weak
int dword_96BAC = -1; // weak
__int16 word_96BB0 = -1; // weak
int dword_96BB4 = -1; // weak
int dword_96BB8 = -1; // weak
int dword_96BBC = 1065353216; // weak
int dword_96BC0 = -1; // weak
__int16 word_96BC4[8] = { 243, 19, 27, 31, 23, 39, 35, 15 }; // weak
VFX_DESC *(__cdecl *VFX_describe_driver)() = NULL;
void (__cdecl *VFX_init_driver)() = NULL;
void (__cdecl *VFX_shutdown_driver)() = NULL;
void (__cdecl *VFX_area_wipe)(LONG x0, LONG y0, LONG x1, LONG y1, LONG color) = NULL;
void (__cdecl *VFX_wait_vblank_leading)() = NULL;
void (__cdecl *VFX_window_read)(WINDOW *destination, LONG x0, LONG y0, LONG x1, LONG y1) = NULL;
void (__cdecl *VFX_DAC_read)(LONG color_number, RGB *triplet) = NULL;
void (__cdecl *VFX_DAC_write)(LONG color_number, RGB *triplet) = NULL;
void (__cdecl *VFX_pane_refresh)(PANE *target, LONG x0, LONG y0, LONG x1, LONG y1) = NULL;
void (__cdecl *VFX_line_address)(LONG x, LONG y, UBYTE **addr, ULONG *nbytes) = NULL;
void (__fastcall *MEM_free)(void *ptr) = &free;
int dword_9A234 = 0; // weak
int dword_9A238 = 0; // weak
PANE stru_9A23C = { NULL, 0, 0, 0, 0 }; // idb
int V_CobFilesLoaded = 0; // weak
T_CobFiles V_CobFiles =
{
  {
    {
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0'
    },
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    {  }
  }
};
int dword_A0CF8; // weak
int V_NougatLfExists_dword_A0CFC; // weak
MACRO_VFX_BOOL V_FlashPopExists;
T_StaticStrings V_StaticStrings_dword_A0D04;
T_Game V_Game;
__int16 word_D845C; // weak
char byte_D8460[100]; // weak
T_Name20 V_StarTypeTexts_D84C4[13];
_UNKNOWN unk_D85C8; // weak
__int16 word_D85CA[13]; // weak
PANE stru_D85E4; // idb
T_Keyboard V_Keyboard;
T_Mouse V_Mouse;
int dword_D8650; // weak
T_Type6 V_Type6_stru_D8654;
UBYTE V_BigBuffer[94816]; // weak
__int16 word_FFE9E[]; // weak
__int16 word_FFEA0[7]; // weak
__int16 word_FFEAE[7]; // weak
__int16 word_FFEBC[7]; // weak
__int16 word_FFECA[7]; // weak
int word_FFED8; // idb
int word_FFEDA; // idb
int word_FFEDC; // idb
int word_FFEDE; // idb
int word_FFEE0; // idb
int word_FFEE2; // idb
int word_FFEE6; // idb
__int16 word_FFEE8; // weak
int word_FFEEA; // idb
__int16 word_FFEEC; // weak
__int16 word_FFEEE; // weak
__int16 word_FFEF0; // weak
int word_FFEF2; // idb
int word_FFEF4; // idb
int word_FFEF6; // idb
int word_FFEF8; // idb
_UNKNOWN unk_FFF04; // weak
int dword_100302; // weak
int dword_100308; // weak
WINDOW V_Window1; // idb
void *buf; // idb
int dword_100324; // weak
int dword_100328; // weak
void *dword_10032C; // idb
__int16 word_100330; // weak
__int16 word_100332; // weak
char byte_100334; // weak
char byte_100335; // weak
int dword_100338; // weak
int dword_10033C; // weak
char byte_100340[16]; // weak
__int16 word_100350; // weak
_UNKNOWN unk_100744; // weak
_UNKNOWN unk_100EC4; // weak
char byte_101DC4[16]; // weak
_UNKNOWN unk_101DD4; // weak
_UNKNOWN unk_102554; // weak
_UNKNOWN unk_103454; // weak
__int16 word_103F94; // weak
T_PlanetItems V_PlanetItems;
T_PlanetCfg V_PlanetCfg;
int dword_10467C; // weak
char *dword_104680; // idb
_UNKNOWN unk_104684; // weak
char *dword_104688[5];
char *dword_10469C[11];
int dword_1046E8[100]; // weak
int dword_104878[100]; // weak
int dword_104A08[100]; // weak
int dword_104B98[]; // weak
int dword_104BC0[9]; // weak
__int16 word_104BE8; // weak
UBYTE V_RaceIndex;
int dword_104BEC[100]; // weak
int dword_104D7C[99]; // weak
int dword_104F09; // weak
int dword_104F6D; // weak
int dword_104FD1; // weak
int dword_105035; // weak
int dword_10509C; // weak
int dword_1050A0; // weak
T_Name20 V_SpecNames[21];
int V_Day1; // weak
int V_Day2; // weak
int V_Day3; // weak
int V_ResTreeTxtLoaded; // weak
T_ResTree V_ResTree;
__int16 word_106FB4[7]; // weak
int dword_106FC2; // weak
int dword_106FCC; // weak
int dword_106FD0; // weak
int dword_106FD4; // weak
int dword_106FD8; // weak
int dword_106FDC; // weak
char byte_106FE0[56]; // weak
__int16 word_107018; // weak
int dword_10701C; // weak
T_Gizmos V_Gizmos;
T_Name20 V_HullNames[4];
T_Ship stru_108FE8;
T_SoundSystem V_SoundSystem;
_UNKNOWN unk_109DF8; // weak
int dword_10AE60; // weak
int dword_10AE64; // weak
int dword_10AE68; // weak
int dword_10AE6C; // weak
T_WinMgr WinMgr;
int dword_132B10; // weak
int dword_132B14; // weak
int dword_132B18; // weak
int dword_132B1C; // weak
char byte_132B20[20]; // weak
int dword_132B34; // weak
char byte_132B38[32]; // weak
int V_Timer_dword_132B58; // weak
int dword_132B5C; // weak
int dword_132B60; // weak
int dword_132B64; // weak


//----- (00010000) --------------------------------------------------------
void __noreturn sub_10000()
{
  while ( 1 )
  {
    __debugbreak();
  }
}
// 10000: using guessed type void __noreturn sub_10000();

//----- (00010010) --------------------------------------------------------
void __usercall Q_BATCON_CPP_sub_10010(PANE *pane@<eax>, int a2@<edx>, int a3@<ebx>, int a4@<ecx>, int a5@<edi>)
{
  void *ShapeTable_sub_1B084; // eax
  void *v7; // ebp
  LONG v8; // edi
  int v9; // ecx
  unsigned __int16 v10; // dx
  void *v11; // esi
  int raceIndex; // eax
  PANE *v13; // esi
  void *v14; // ebp
  int v15; // esi
  int v16; // kr04_4
  int Unknown_18; // eax
  int v18; // kr0C_4
  int v19; // kr1C_4
  int v20; // kr2C_4
  int v21; // esi
  int v22; // esi
  int v23; // kr14_4
  int v24; // kr24_4
  int v25; // kr34_4
  __int16 v26; // si
  int v27; // edx
  int v28; // ebx
  LONG v29; // [esp-4h] [ebp-90h]
  PANE v30; // [esp+0h] [ebp-8Ch] BYREF
  int v31[5]; // [esp+14h] [ebp-78h]
  int v32[2]; // [esp+28h] [ebp-64h]
  LONG v33[2]; // [esp+30h] [ebp-5Ch]
  int v34[2]; // [esp+38h] [ebp-54h]
  int hotX; // [esp+40h] [ebp-4Ch] BYREF
  int hotY; // [esp+44h] [ebp-48h] BYREF
  int v37; // [esp+48h] [ebp-44h]
  int v38; // [esp+4Ch] [ebp-40h]
  int v39; // [esp+50h] [ebp-3Ch]
  int v40; // [esp+54h] [ebp-38h]
  int v41; // [esp+58h] [ebp-34h]
  P_Ship v42; // [esp+5Ch] [ebp-30h]
  LONG x1; // [esp+60h] [ebp-2Ch]
  int v44; // [esp+64h] [ebp-28h]
  int v45; // [esp+68h] [ebp-24h]
  int v46; // [esp+6Ch] [ebp-20h]
  LONG shape_number; // [esp+70h] [ebp-1Ch]
  LONG v48; // [esp+74h] [ebp-18h]
  PANE *panea; // [esp+78h] [ebp-14h]
  int v50; // [esp+7Ch] [ebp-10h]

  panea = pane;
  v41 = 0;
  if ( a4 )
  {
    VFX_pane_wipe(pane, 0x96);
    v41 = 0x96;
  }
  if ( a3 < 0 )
  {
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEDA);
    v7 = ShapeTable_sub_1B084;
    if ( !ShapeTable_sub_1B084 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x46);
    }
    v8 = 5 * *(unsigned __int16 *)(a2 + 0x16) + *(unsigned __int16 *)(a2 + 0x14);
    Q_GSYSTEM_CPP_sub_2BC40(panea, ShapeTable_sub_1B084, v8, &hotX, &hotY);
    v37 = a2;
    VFX_shape_draw(panea, v7, v8, hotX, hotY);
    v9 = *(unsigned __int8 *)(a2 + 0x57);
    v38 = 0xF3;
    if ( v9 != 0xFF )
    {
      Q_WINMGR_CPP_sub_53E38(panea, 2, 4, v9);
      v38 = 4 * V_Game.races[*(unsigned __int8 *)(a2 + 0x57)].Unknown_02 + 0x13;
    }
    WinMgr.SmallFont.pane = *panea;
    sub_2B8A8(&WinMgr.SmallFont, 0x12, 7, (const char *)(v37 + 0x24), 0, v38, 0xFF, 0);
    return;
  }
  v10 = word_FFEBC[*(__int16 *)(a2 + 0x56)];
  v42 = (P_Ship)a2;
  v11 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, v10);
  if ( !v11 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x5C);
  }
  raceIndex = v42->raceIndex;
  v39 = 0;
  if ( raceIndex == V_RaceIndex || sub_4AAEC((int)v42, V_RaceIndex) > 0 )
  {
    v39 = 0xFFFFFFFF;
  }
  Q_GSYSTEM_CPP_sub_2BC40(panea, v11, v42->hullSize, &hotX, &hotY);
  if ( v39 != 0xFFFFFFFF )
  {
    goto LABEL_25;
  }
  if ( v42->Unknown_88 > 0 )
  {
    if ( 4 * v42->hullStrength < v42->Unknown_98 || v42->hullStrength < 5 )
    {
      VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[8]);
      VFX_shape_translate_draw(panea, v11, v42->hullSize, hotX, hotY);
      goto LABEL_26;
    }
    if ( !V_Game.races[v42->raceIndex].Unknown_01 )
    {
      VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[3]);
      VFX_shape_translate_draw(panea, v11, v42->hullSize, hotX, hotY);
      goto LABEL_26;
    }
    if ( V_Game.races[v42->raceIndex].Unknown_01 != 0xD )
    {
      VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[6]);
      VFX_shape_translate_draw(panea, v11, v42->hullSize, hotX, hotY);
      goto LABEL_26;
    }
LABEL_25:
    VFX_shape_draw(panea, v11, v42->hullSize, hotX, hotY);
    goto LABEL_26;
  }
  VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[0x16]);
  VFX_shape_translate_draw(panea, v11, v42->hullSize, hotX, hotY);
LABEL_26:
  v13 = panea;
  Q_WINMGR_CPP_sub_53E38(panea, 2, 4, v42->raceIndex);
  WinMgr.SmallFont.pane = *v13;
  sub_2B8A8(&WinMgr.SmallFont, 0x12, 7, v42->name, 0, 0xF, 0xFF, 0);
  v14 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEE6);
  if ( !v14 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0xA4);
  }
  if ( v39 == 0xFFFFFFFF )
  {
    v15 = 0;
    v40 = sub_4A8CC(v42);
    v16 = 0;
    do
    {
      if ( v15 >= v40 )
      {
        break;
      }
      ++v15;
      sub_53EB8(panea, v14, 0, 5 * v16++ + 0x12, 0x11, v42->raceIndex);
    }
    while ( v15 < 0xA );
    v31[0] = v42->Unknown_0;
    v31[1] = v42->Unknown_4;
    v31[2] = v42->Unknown_10;
    v31[3] = v42->Unknown_20;
    v48 = 0x1F;
    Unknown_18 = v42->Unknown_18;
    v45 = 0;
    v31[4] = Unknown_18;
    v44 = 0;
    v30 = *panea;
    v18 = 0;
    v19 = 0;
    v20 = 0;
    do
    {
      v30.x1 = v30.x0 + 1;
      v21 = *(int *)((char *)v31 + v44);
      if ( v21 > 0 )
      {
        v30.x1 += 8 * v21 / 4;
      }
      v22 = 0;
      shape_number = v45 + 1;
      do
      {
        ++v22;
        VFX_shape_draw(&v30, v14, shape_number, a5 + 8 * v20++, v48);
      }
      while ( v22 < 0xF );
      ++v45;
      ++v18;
      ++v19;
    }
    while ( v45 < 5 );
    v32[0] = v42->hullStrength;
    v32[1] = v42->Unknown_88;
    v34[0] = v42->Unknown_98;
    v46 = 0;
    v34[1] = sub_4A8FC(v42);
    v33[0] = 2;
    v33[1] = 5;
    x1 = 0x82;
    v23 = 0;
    v24 = 0;
    v25 = 0;
    do
    {
      v27 = *(int *)((char *)v34 + v46);
      if ( v27 > 0 )
      {
        v28 = *(int *)((char *)v32 + v46);
        if ( v28 >= 0 )
        {
          if ( v28 > v27 )
          {
            *(int *)((char *)v32 + v46) = *(int *)((char *)v34 + v46);
          }
          v26 = 0;
          v50 = v46;
        }
        else
        {
          *(int *)((char *)v32 + v46) = 0;
          v26 = 0;
          v50 = v46;
        }
        while ( v26 < 9 )
        {
          v29 = 8 * v26++ + 9;
          VFX_shape_draw(panea, v14, *(LONG *)((char *)v33 + v50), 0x7C, v29);
        }
        sub_2BB74(panea, 8 * v23 + 0x7C, 8, x1, 0x50 - 0x48 * *(int *)((char *)v32 + v50) / *(int *)((char *)v34 + v50), v41, 0xFFFFFFFF);
      }
      ++v23;
      ++v24;
      ++v25;
    }
    while ( v46 != 8 );
  }
}
// FFEBC: using guessed type __int16 word_FFEBC[7];

//----- (00010668) --------------------------------------------------------
void __fastcall Q_BATCON_CPP_sub_10668(PANE *pane, char *a2, int powerState, int a4)
{
  void *shapeTable; // edi
  char *v6; // esi
  UBYTE Unknown_02; // al
  int v8; // eax
  char *text; // eax
  char s[68]; // [esp+0h] [ebp-60h] BYREF
  LONG hotY; // [esp+50h] [ebp-10h] BYREF
  LONG hotX; // [esp+54h] [ebp-Ch] BYREF
  int ps; // [esp+58h] [ebp-8h]
  char *shapeNumber; // [esp+5Ch] [ebp-4h]

  shapeNumber = a2;
  ps = powerState;
  shapeTable = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFED8);
  if ( !shapeTable )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0xEA);
  }
  v6 = shapeNumber;
  if ( a4 && !ps && (V_Gizmos[*shapeNumber].flags & 0x80) == 0 )
  {
    VFX_pane_wipe(pane, 0x96);
  }
  if ( *shapeNumber == (char)0xFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0xFB);
  }
  Q_GSYSTEM_CPP_sub_2BC40(pane, shapeTable, *shapeNumber, &hotX, &hotY);
  if ( ps == 2 || ps == 3 )
  {
    VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[7]);
    VFX_shape_translate_draw(pane, shapeTable, *v6, hotX, hotY);
  }
  else
  {
    VFX_shape_draw(pane, shapeTable, *v6, hotX, hotY);
  }
  if ( *(_DWORD *)(v6 + 3) )
  {
    if ( (V_Gizmos[*v6].flags & 0x20) != 0 )
    {
      sub_2BB74(pane, 1, 1, pane->x1 - pane->x0 - 1, pane->y1 - pane->y0 - 1, 4 * V_Game.races[V_RaceIndex].Unknown_02 + 0x13, 0);
    }
  }
  sprintf(s, "%s", V_Gizmos[*v6].name);
  Unknown_02 = V_Game.races[V_RaceIndex].Unknown_02;
  WinMgr.SmallFont.pane = *pane;
  sub_2B8A8(&WinMgr.SmallFont, 5, 2, s, 0, 4 * Unknown_02 + 0x13, 0xFF, 0);
  if ( ps == 2 )
  {
    v8 = 0;                                            // 0: "(depleted)"
  }
  else
  {
    if ( ps != 3 )
    {
      return;
    }
    v8 = 1;                                            // 1: "(insufficient power)"
  }
  text = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v8);
  WinMgr.SmallFont.pane = *pane;
  sub_2B8A8(&WinMgr.SmallFont, 5, 0xC, text, 0, 0xF, 0xFF, 0);
}

//----- (00010878) --------------------------------------------------------
int __fastcall sub_10878(_DWORD *a1, int a2, int a3, int a4)
{
  void *ShapeTable_sub_1B084; // edi
  UBYTE Unknown_02; // al
  int result; // eax
  __int16 v8; // dx
  char *sub_1CEA8; // eax
  char s[80]; // [esp+0h] [ebp-68h] BYREF
  LONG hotX; // [esp+50h] [ebp-18h] BYREF
  LONG hotY; // [esp+54h] [ebp-14h] BYREF
  int v13; // [esp+58h] [ebp-10h]

  v13 = a3;
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEDC);
  if ( !ShapeTable_sub_1B084 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x122);
  }
  if ( a4 && !v13 )
  {
    VFX_pane_wipe((PANE *)a1, 0x96);
  }
  Q_GSYSTEM_CPP_sub_2BC40((PANE *)a1, ShapeTable_sub_1B084, *(unsigned __int8 *)(a2 + 1), &hotX, &hotY);
  if ( v13 == 1 )
  {
    VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[7]);
    VFX_shape_translate_draw((PANE *)a1, ShapeTable_sub_1B084, *(unsigned __int8 *)(a2 + 1), hotX, hotY);
  }
  else
  {
    VFX_shape_draw((PANE *)a1, ShapeTable_sub_1B084, *(unsigned __int8 *)(a2 + 1), hotX, hotY);
  }
  sprintf(s, "%s", V_PlanetItems.item[*(unsigned __int8 *)(a2 + 1)].name);
  Unknown_02 = V_Game.races[V_RaceIndex].Unknown_02;
  WinMgr.SmallFont.pane = *(PANE *)a1;
  result = sub_2B8A8(&WinMgr.SmallFont, 5, 2, s, 0, 4 * Unknown_02 + 0x13, 0xFF, 0);
  if ( v13 == 1 )
  {
    v8 = 4 * V_Game.races[V_RaceIndex].Unknown_02;
    sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0); // 0: "(depleted)"
    WinMgr.SmallFont.pane = *(PANE *)a1;
    return sub_2B8A8(&WinMgr.SmallFont, 5, 0xC, sub_1CEA8, 0, v8 + 0x13, 0xFF, 0);
  }
  return result;
}

//----- (00010A14) --------------------------------------------------------
int __fastcall sub_10A14(int a1, int a2)
{
  int v2; // ecx
  int v3; // esi
  int result; // eax

  v2 = *(_DWORD *)(a1 + 4);
  v3 = *(_DWORD *)(a2 + 4);
  result = 0xFFFFFFFF;
  if ( v2 > v3 )
  {
    return 1;
  }
  if ( v2 == v3 )
  {
    return 0;
  }
  return result;
}

//----- (00010A3C) --------------------------------------------------------
void __fastcall __spoils<> Q_WndBC_sub_10A3C(P_WndBC a1)
{
  Q_A2Ctor_sub_2C830(&a1->a2);
  a1->j2 = 0;
  a1->j3 = 0;
  a1->j4 = 0;
  a1->a2.procs = (P_Procs)off_959B8;
  Q_WndBC_sub_10AC4(a1);
}
// 959B8: using guessed type int (*off_959B8[2])();

//----- (00010A80) --------------------------------------------------------
T_TypeA2 *__fastcall sub_10A80(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_959A4);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_959B8;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 959B8: using guessed type int (*off_959B8[2])();

//----- (00010AC4) --------------------------------------------------------
void __fastcall __spoils<> Q_WndBC_sub_10AC4(P_WndBC a1)
{
  a1->b = 0;
  a1->c = 0;
  a1->d = 0;
  a1->e = 0;
  a1->f = 0;
  a1->g = 0;
  a1->i = 0;
}

//----- (00010B24) --------------------------------------------------------
int __fastcall sub_10B24(int a1, unsigned __int16 a2, LONG a3, int *a4)
{
  int result; // eax
  T_TypeA2 *Wnd_sub_56DA8; // eax
  T_TypeA2 *v9; // eax
  P_Star pCurStar; // ebx
  int v11; // eax
  __int16 i; // ax
  int v13; // edx
  int v14; // edx
  int v15; // eax
  char v16; // al
  unsigned __int8 v17; // al
  int v18; // ecx
  char v19; // bh
  int v20; // edx
  _DWORD *v21; // edi
  int v22; // eax
  int v23; // edx
  int v24; // eax
  int v25; // ebx
  char v26; // al
  int v27; // eax
  int v28; // edx
  T_Ship *v29; // eax
  int v30; // eax
  char *v31; // eax
  char *v32; // esi
  T_Gizmo *v33; // eax
  int v34; // edx
  int v35; // edx
  int v36; // eax
  int v37; // edx
  char *v38; // eax
  int v39; // ebx
  char v40; // cl
  int *v41; // ecx
  int v42; // [esp-4h] [ebp-9Ch]
  char v43; // [esp+0h] [ebp-98h] BYREF
  int v44; // [esp+1h] [ebp-97h]
  char v45; // [esp+5h] [ebp-93h]
  int *v46; // [esp+6h] [ebp-92h]
  int v47; // [esp+Ah] [ebp-8Eh]
  int v48; // [esp+Eh] [ebp-8Ah]
  int v49; // [esp+12h] [ebp-86h]
  int v50; // [esp+16h] [ebp-82h]
  int v51; // [esp+1Ah] [ebp-7Eh]
  int v52; // [esp+1Eh] [ebp-7Ah]
  int v53; // [esp+22h] [ebp-76h]
  char v54; // [esp+28h] [ebp-70h]
  int v55; // [esp+29h] [ebp-6Fh]
  char v56; // [esp+2Dh] [ebp-6Bh]
  int v57; // [esp+2Eh] [ebp-6Ah]
  int v58; // [esp+32h] [ebp-66h]
  int v59; // [esp+36h] [ebp-62h]
  int v60; // [esp+3Ah] [ebp-5Eh]
  int v61; // [esp+3Eh] [ebp-5Ah]
  int v62; // [esp+42h] [ebp-56h]
  int v63; // [esp+46h] [ebp-52h]
  int v64; // [esp+4Ah] [ebp-4Eh]
  char v65; // [esp+50h] [ebp-48h]
  int v66; // [esp+51h] [ebp-47h]
  char v67; // [esp+55h] [ebp-43h]
  int *v68; // [esp+56h] [ebp-42h]
  int v69; // [esp+5Ah] [ebp-3Eh]
  int v70; // [esp+5Eh] [ebp-3Ah]
  int v71; // [esp+62h] [ebp-36h]
  int v72; // [esp+66h] [ebp-32h]
  int v73; // [esp+6Ah] [ebp-2Eh]
  int v74; // [esp+6Eh] [ebp-2Ah]
  int v75; // [esp+72h] [ebp-26h]
  int v76; // [esp+78h] [ebp-20h]
  int *v77; // [esp+7Ch] [ebp-1Ch]
  int v78; // [esp+80h] [ebp-18h]
  LONG v79; // [esp+84h] [ebp-14h]
  char v80; // [esp+88h] [ebp-10h]

  v79 = a3;
  if ( a2 < 0x327u )
  {
    if ( a2 >= 0x322u )
    {
      if ( a2 > 0x322u )
      {
        if ( a2 < 0x325u )
        {
          if ( a2 != 0x324 )
          {
            return sub_2F424((T_TypeA2 *)a1, a2, v79, (LONG)a4);
          }
          if ( *(_BYTE *)(a1 + 0xB9) != 1 )
          {
            *(_BYTE *)(a1 + 0xB9) = 1;
            sub_12140(a1);
            (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
          }
          return 0xFFFFFFFF;
        }
        else if ( a2 <= 0x325u )
        {
          if ( *(_BYTE *)(a1 + 0xB9) != 4 )
          {
            *(_BYTE *)(a1 + 0xB9) = 4;
            sub_12140(a1);
            (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
          }
          return 0xFFFFFFFF;
        }
        else
        {
          *(_DWORD *)(a1 + 0xBF) = 0;
          if ( !a3 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x2E1);
          }
          if ( !a4 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x2E2);
          }
          if ( *(_WORD *)(a1 + 0xD4) )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x2E4);
          }
          v40 = *(_BYTE *)(a1 + 0xAB);
          if ( v40 == 3 )
          {
            v47 = 0;
            v48 = 0;
            v49 = 0;
            v51 = 0;
            v52 = 0;
            v50 = 0;
            v43 = 2;
            *(_BYTE *)(*(_DWORD *)(a1 + 0xAC) + 0x5D) = 0;
            v41 = a4;
            if ( *(_BYTE *)(a1 + 0xB0) )
            {
              v43 = 1;
              v44 = *(_DWORD *)(a1 + 0xB1);
              v45 = 0;
              v46 = *(int **)(a1 + 0xAC);
            }
            else
            {
              v43 = 0;
              v80 = v79;
              switch ( (_BYTE)v79 )
              {
                case 5:
                  v45 = 3;
                  v47 = *a4;
                  v48 = a4[1];
                  v49 = a4[2];
                  *(_DWORD *)(a1 + 0xC8) = *a4;
                  v41 = (int *)(a1 + 0xC8);
                  *(_DWORD *)(a1 + 0xCC) = a4[1];
                  *(_DWORD *)(a1 + 0xD0) = a4[2];
                  *(_BYTE *)(*(_DWORD *)(a1 + 0xAC) + 0x5D) = 7;
                  *(_DWORD *)(*(_DWORD *)(a1 + 0xAC) + 0x5E) = 0;
                  break;
                case 2:
                  v46 = a4;
                  v45 = 1;
                  *(_BYTE *)(*(_DWORD *)(a1 + 0xAC) + 0x5D) = 3;
                  *(_DWORD *)(*(_DWORD *)(a1 + 0xAC) + 0x5E) = a4;
                  break;
                case 4:
                  v45 = 2;
                  v46 = a4;
                  *(_BYTE *)(*(_DWORD *)(a1 + 0xAC) + 0x5D) = 1;
                  v22 = *a4;
                  if ( (P_Star)*a4 == V_Game.pCurStar )
                  {
                    v22 = a4[1];
                  }
                  *(_DWORD *)(*(_DWORD *)(a1 + 0xAC) + 0x5E) = v22;
                  break;
              }
              v23 = *(_DWORD *)(a1 + 0xAC);
              *(_BYTE *)(v23 + 0x62) = v43;
              *(_DWORD *)(v23 + 0x63) = v44;
              *(_BYTE *)(v23 + 0x67) = v45;
              *(_DWORD *)(v23 + 0x68) = v46;
              *(_DWORD *)(v23 + 0x6C) = v47;
              *(_DWORD *)(v23 + 0x70) = v48;
              *(_DWORD *)(v23 + 0x74) = v49;
              *(_DWORD *)(v23 + 0x78) = v50;
              *(_DWORD *)(v23 + 0x7C) = v51;
              *(_DWORD *)(v23 + 0x80) = v52;
              *(_DWORD *)(v23 + 0x84) = v53;
              sub_49B3C(*(P_Ship *)(a1 + 0xAC), 0);
              v24 = *(_DWORD *)(a1 + 0xAC);
              if ( (*(_BYTE *)(v24 + 0x84) & 8) == 0 )
              {
                *(_DWORD *)(a1 + 0xBF) = v24;
                *(_DWORD *)(a1 + 0xC4) = v41;
                *(_BYTE *)(a1 + 0xC3) = v80;
              }
            }
          }
          else if ( v40 == 2 )
          {
            if ( *(_BYTE *)(a1 + 0xB0) != 2 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x33B);
            }
            if ( (_BYTE)v79 != 3 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x33C);
            }
          }
          *(_BYTE *)(a1 + 0xB9) = 1;
          sub_12140(a1);
          *(_BYTE *)(a1 + 0xB0) = 0;
          v25 = *(_DWORD *)(a1 + 0xA7);
          *(_DWORD *)(a1 + 0xB1) = 0;
          (*(void (__fastcall **)(int, _DWORD))(v25 + 0xC))(a1, 0);
          sub_12674(*(_DWORD *)(a1 + 0xBB));
          return 0;
        }
      }
      v18 = 0;
      v19 = *(_BYTE *)(a1 + 0xAB);
      *(_DWORD *)(a1 + 0xBF) = 0;
      if ( v19 == 3 && (_BYTE)v79 )
      {
        v69 = 0;
        v70 = 0;
        v71 = 0;
        *(_DWORD *)(&v43 + 0xFFFFFFF6 + 0x70) = 0;
        *(_DWORD *)(&v43 + 0xFFFFFFF6 + 0x74) = 0;
        *(_DWORD *)(&v43 + 0xFFFFFFF6 + 0x78) = 0;
        v65 = 1;
        v66 = *(_DWORD *)(a1 + 0xB1);
        v67 = 5;
        if ( (unsigned __int8)v79 < 3u )
        {
          if ( (_BYTE)v79 == 2 )
          {
            v67 = 1;
            v68 = a4;
          }
        }
        else if ( (unsigned __int8)v79 <= 3u )
        {
          v68 = a4;
          v67 = 0;
        }
        else if ( (_BYTE)v79 == 4 && *(_BYTE *)(a1 + 0xB0) == 1 )
        {
          v68 = a4;
          v67 = 2;
        }
        v20 = *(_DWORD *)(a1 + 0xAC);
        *(_BYTE *)(v20 + 0x62) = v65;
        *(_DWORD *)(v20 + 0x63) = v66;
        *(_BYTE *)(v20 + 0x67) = v67;
        *(_DWORD *)(v20 + 0x68) = v68;
        *(_DWORD *)(v20 + 0x6C) = v69;
        *(_DWORD *)(v20 + 0x70) = v70;
        *(_DWORD *)(v20 + 0x74) = v71;
        *(_DWORD *)(v20 + 0x78) = v72;
        *(_DWORD *)(v20 + 0x7C) = v73;
        *(_DWORD *)(v20 + 0x80) = v74;
        *(_DWORD *)(v20 + 0x84) = v75;
        sub_49B3C(*(P_Ship *)(a1 + 0xAC), 0);
        if ( (*(_BYTE *)(*(_DWORD *)(a1 + 0xAC) + 0x84) & 1) == 0 )
        {
          return v18;
        }
      }
      else
      {
        if ( *(_BYTE *)(a1 + 0xAB) != 2 )
        {
          return v18;
        }
        if ( (_BYTE)v79 != 3 )
        {
          return v18;
        }
        v77 = a4;
        v21 = (_DWORD *)(*(_DWORD *)(a1 + 0xAC) + 0x6B);
        v76 = *(_DWORD *)(a1 + 0xB1);
        *v21 = v76;
        v21[1] = v77;
        v21[2] = v78;
        sub_3676C(*(T_Planet **)(a1 + 0xAC), 0);
        if ( (*(_BYTE *)(*(_DWORD *)(a1 + 0xAC) + 0x73) & 1) == 0 )
        {
          return v18;
        }
      }
      return 0xFFFFFFFF;
    }
    if ( a2 < 0xDu )
    {
      if ( a2 != 1 )
      {
        return sub_2F424((T_TypeA2 *)a1, a2, v79, (LONG)a4);
      }
      Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&WinMgr, "BatModeWnd", 0);
      *(_DWORD *)(a1 + 0xBB) = Wnd_sub_56DA8;
      if ( !Wnd_sub_56DA8 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x184);
      }
      v9 = Q_FindWnd_sub_56DA8(&WinMgr, "BatListWnd", 0);
      *(_DWORD *)(a1 + 0xB5) = v9;
      if ( !v9 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x187);
      }
      *(_DWORD *)(*(_DWORD *)(a1 + 0xB5) + 0xAB) = 0;
      sub_2E9CC(*(P_Wnd10LB *)(a1 + 0xB5), 0);
      *(_BYTE *)(*(_DWORD *)(a1 + 0xB5) + 0xC5) = 0;
      sub_2ED4C(*(P_Wnd10LB *)(a1 + 0xB5));
      *(_DWORD *)(a1 + 0x39) = 0xFFFFFFFF;
      pCurStar = V_Game.pCurStar;
      *(_DWORD *)(a1 + 0x35) = 0xFFFFFFFF;
      *(_DWORD *)(a1 + 0xBF) = 0;
      sub_1D734((int)pCurStar, a1 + 0xDA);
      *(_WORD *)(a1 + 0xD4) = 0;
      *(_DWORD *)(a1 + 0x104) = 0;
      *(_DWORD *)(a1 + 0xD6) = v11;
      if ( ((1 << V_RaceIndex) & ((unsigned __int8)pCurStar->Unknown_15 | pCurStar->racesBits)) != 0 )
      {
        *(_BYTE *)(a1 + 0xB9) = 1;
      }
      else
      {
        *(_BYTE *)(a1 + 0xB9) = 4;
      }
      *(_BYTE *)(a1 + 0xBA) = 0;
      for ( i = 0; ; ++i )
      {
        v13 = i;
        if ( i >= *(_DWORD *)(a1 + 0xD6) )
        {
          break;
        }
        *(_DWORD *)(a1 + 4 * v13 + 0xE8) = 0xFFFFFFFF;
      }
      sub_2D258((P_TypeA2)a1, a2);
      sub_12140(a1);
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
      return 0;
    }
    if ( a2 <= 0xDu )
    {
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
      return 0;
    }
    if ( a2 != 0x320 )
    {
      return sub_2F424((T_TypeA2 *)a1, a2, v79, (LONG)a4);
    }
    *(_BYTE *)(a1 + 0xB0) = 0;
    v16 = v79;
    *(_DWORD *)(a1 + 0xB1) = 0;
    *(_BYTE *)(a1 + 0xAB) = v16;
    v17 = *(_BYTE *)(a1 + 0xAB);
    *(_DWORD *)(a1 + 0xAC) = a4;
    if ( v17 < 2u )
    {
      if ( !v17 )
      {
        *(_BYTE *)(a1 + 0xB9) = 1;
        goto LABEL_55;
      }
    }
    else
    {
      if ( v17 <= 2u )
      {
        *(_BYTE *)(a1 + 0xB9) = 3;
        goto LABEL_55;
      }
      if ( v17 == 3 )
      {
        *(_BYTE *)(a1 + 0xB9) = 2;
        goto LABEL_55;
      }
    }
    Q_AssertLogBreakExit_sub_261A8(0, "..\\batcon.cpp", 0x263);
LABEL_55:
    sub_12140(a1);
    (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
    return 0xFFFFFFFF;
  }
  if ( a2 <= 0x327u )
  {
    if ( *(_BYTE *)(*(_DWORD *)(a1 + 0xBB) + 0xB7) != 4
      && ((1 << V_RaceIndex) & (V_Game.pCurStar->racesBits | (unsigned __int8)V_Game.pCurStar->Unknown_15)) != 0
      && !*(_DWORD *)(a1 + 0x104)
      && !*(_WORD *)(a1 + 0xD4) )
    {
      sub_1229C(a1, 0xFFFFFFFF);
      return 0;
    }
    return 0;
  }
  if ( a2 < 0x32Bu )
  {
    if ( a2 < 0x329u )
    {
      if ( *(_BYTE *)(*(_DWORD *)(a1 + 0xBB) + 0xB7) != 4
        && ((1 << V_RaceIndex) & ((unsigned __int8)V_Game.pCurStar->Unknown_15 | V_Game.pCurStar->racesBits)) != 0
        && !*(_DWORD *)(a1 + 0x104)
        && !*(_WORD *)(a1 + 0xD4) )
      {
        *(_WORD *)(a1 + 0xD4) = 0xFFFF;
        *(_DWORD *)(a1 + 0x104) = 0xFFFFFFFF;
        sub_1229C(a1, 0xFFFFFFFF);
        return 0;
      }
    }
    else
    {
      if ( a2 > 0x329u )
      {
        if ( *(_BYTE *)(a1 + 0xBA) )
        {
          *(_BYTE *)(a1 + 0xBA) = 0;
          sub_11BA4(a1);
        }
        return 0xFFFFFFFF;
      }
      if ( *(_BYTE *)(*(_DWORD *)(a1 + 0xBB) + 0xB7) != 4 )
      {
        v14 = *(_DWORD *)(a1 + 0xBF);
        if ( v14 )
        {
          if ( *(_BYTE *)(v14 + 0x58) == 4 && V_Game.pCurStar == *(P_Star *)(*(_DWORD *)(a1 + 0xBF) + 0x59) )
          {
            *(_BYTE *)(a1 + 0xAB) = 3;
            *(_BYTE *)(a1 + 0xB0) = 0;
            v15 = *(_DWORD *)(a1 + 0xBF);
            *(_DWORD *)(a1 + 0xB1) = 0;
            *(_DWORD *)(a1 + 0xAC) = v15;
            (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 8))();
            return 0;
          }
        }
      }
    }
    return 0;
  }
  if ( a2 <= 0x32Bu )
  {
    if ( *(_BYTE *)(a1 + 0xBA) != 1 )
    {
      *(_BYTE *)(a1 + 0xBA) = 1;
      sub_11BA4(a1);
    }
    return 0xFFFFFFFF;
  }
  if ( a2 < 0x32Du )
  {
    if ( *(_BYTE *)(a1 + 0xBA) != 4 )
    {
      *(_BYTE *)(a1 + 0xBA) = 4;
      sub_11BA4(a1);
    }
    return 0xFFFFFFFF;
  }
  if ( a2 <= 0x32Du )
  {
    if ( *(_BYTE *)(a1 + 0xBA) != 5 )
    {
      *(_BYTE *)(a1 + 0xBA) = 5;
      sub_11BA4(a1);
    }
    return 0xFFFFFFFF;
  }
  if ( a2 < 0x1C01u )
  {
    return sub_2F424((T_TypeA2 *)a1, a2, v79, (LONG)a4);
  }
  if ( a2 <= 0x1C01u )
  {
    if ( *(_BYTE *)(*(_DWORD *)(a1 + 0xBB) + 0xB7) != 4 )
    {
      v26 = *(_BYTE *)(a1 + 0xB9) - 1;
      *(_DWORD *)(a1 + 0xBF) = 0;
      switch ( v26 )
      {
        case 0:
        case 3:
          if ( a4 == (int *)4 )
          {
            if ( sub_2ECA4(*(_DWORD *)(a1 + 0xB5), v79) >= 0 )
            {
              *(_BYTE *)(a1 + 0xAB) = 3;
              *(_BYTE *)(a1 + 0xB9) = 2;
            }
            else
            {
              *(_BYTE *)(a1 + 0xAB) = 2;
              *(_BYTE *)(a1 + 0xB9) = 3;
            }
            sub_12140(a1);
            v27 = sub_2ED14(*(_DWORD *)(a1 + 0xB5), v79);
            v42 = 0;
            v28 = *(_DWORD *)(a1 + 0xBB);
            *(_DWORD *)(a1 + 0xAC) = v27;
            sub_56D30(&WinMgr, *(_DWORD *)(v28 + 0x41), 0x53, 0, v42);
            (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
            result = 0xFFFFFFFF;
          }
          else
          {
            v29 = (T_Ship *)sub_2ED14(*(_DWORD *)(a1 + 0xB5), v79);
            v30 = sub_12AE4(*(_DWORD *)(a1 + 0xBB), v29);
            if ( !v30 )
            {
              return 0xFFFFFFFF;
            }
            sub_17E88(*(float **)(a1 + 0xBB), v30);
            sub_18C2C(*(P_Wnd4BM *)(a1 + 0xBB), 0);
            result = 0xFFFFFFFF;
          }
          break;
        case 1:
          if ( sub_2ECA4(*(_DWORD *)(a1 + 0xB5), v79) )
          {
            return 0xFFFFFFFF;
          }
          v31 = (char *)sub_2ED14(*(_DWORD *)(a1 + 0xB5), v79);
          v32 = v31;
          if ( *v31 == (char)0xFF )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x39C);
          }
          v33 = &V_Gizmos[*v31];
          if ( (v33->flags & 0x80) != 0 )
          {
            return 0xFFFFFFFF;
          }
          v34 = v33->flags & 0x20;
          if ( (_BYTE)v34 )
          {
            sub_49A8C(*(_DWORD *)(a1 + 0xAC), v32);
          }
          else
          {
            *(_BYTE *)(a1 + 0xB0) = 1;
            *(_DWORD *)(a1 + 0xB1) = v32;
            if ( (v33->flags & 0x40) != 0 )
            {
              v58 = v34;
              v59 = v34;
              v60 = v34;
              v61 = v34;
              v62 = v34;
              v63 = v34;
              v54 = 1;
              v55 = *(_DWORD *)(a1 + 0xB1);
              v56 = 5;
              v35 = *(_DWORD *)(a1 + 0xAC) + 0x62;
              *(_BYTE *)v35 = 1;
              *(_DWORD *)(v35 + 1) = v55;
              *(_BYTE *)(v35 + 5) = v56;
              *(_DWORD *)(v35 + 6) = v57;
              *(_DWORD *)(v35 + 0xA) = v58;
              *(_DWORD *)(v35 + 0xE) = v59;
              *(_DWORD *)(v35 + 0x12) = v60;
              *(_DWORD *)(v35 + 0x16) = v61;
              *(_DWORD *)(v35 + 0x1A) = v62;
              *(_DWORD *)(v35 + 0x1E) = v63;
              *(_DWORD *)(v35 + 0x22) = v64;
              *(_BYTE *)(a1 + 0xB0) = 0;
              *(_DWORD *)(a1 + 0xB1) = 0;
              *(_BYTE *)(a1 + 0xB9) = 1;
              sub_12140(a1);
              sub_12674(*(_DWORD *)(a1 + 0xBB));
            }
            else
            {
              sub_56D30(&WinMgr, *(_DWORD *)(*(_DWORD *)(a1 + 0xBB) + 0x41), 0x51, 0, v34);
            }
          }
          (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
          return 0xFFFFFFFF;
        case 2:
          if ( sub_2ECA4(*(_DWORD *)(a1 + 0xB5), v79) )
          {
            return 0xFFFFFFFF;
          }
          v36 = sub_2ED14(*(_DWORD *)(a1 + 0xB5), v79);
          v42 = 0;
          *(_BYTE *)(a1 + 0xB0) = 2;
          v37 = *(_DWORD *)(a1 + 0xBB);
          *(_DWORD *)(a1 + 0xB1) = v36;
          sub_56D30(&WinMgr, *(_DWORD *)(v37 + 0x41), 0x51, 0, v42);
          return 0xFFFFFFFF;
        default:
          return 0xFFFFFFFF;
      }
      return result;
    }
    return 0;
  }
  if ( a2 != 0x1C02 )
  {
    return sub_2F424((T_TypeA2 *)a1, a2, v79, (LONG)a4);
  }
  switch ( *(_BYTE *)(a1 + 0xB9) )
  {
    case 2:
      v38 = (char *)sub_2ED14(*(_DWORD *)(a1 + 0xB5), v79);
      sub_56B60(&WinMgr, 5, *v38, 4);
      result = 0xFFFFFFFF;
      break;
    case 3:
      v39 = *(unsigned __int8 *)(sub_2ED14(*(_DWORD *)(a1 + 0xB5), v79) + 1);
      sub_56B60(&WinMgr, 5, v39, 5);
      goto LABEL_122;
    default:
LABEL_122:
      result = 0xFFFFFFFF;
      break;
  }
  return result;
}
// 10C71: variable 'v11' is possibly undefined

//----- (00011870) --------------------------------------------------------
void __fastcall sub_11870(int a1, int a2)
{
  LONG v3; // esi
  char v4; // ah
  int v5; // edx
  int v6; // ebx
  void *ShapeTable_sub_1B084; // eax
  char v8; // bl
  void *v9; // eax
  __int16 v10; // ax
  UBYTE racesBits; // cl
  int type; // [esp-20h] [ebp-A0h]
  char s[40]; // [esp+0h] [ebp-80h] BYREF
  PANE pane3; // [esp+28h] [ebp-58h] BYREF
  PANE pane2; // [esp+3Ch] [ebp-44h] BYREF
  PANE pane1; // [esp+50h] [ebp-30h] BYREF
  __int16 v17; // [esp+64h] [ebp-1Ch]
  __int16 v18; // [esp+68h] [ebp-18h]

  if ( a2 != 0x1C01 )
  {
    sub_11BA4(a1);
  }
  pane1.window = *(WINDOW **)(a1 + 4);
  pane1.x0 = 466;
  pane1.y0 = 0;
  pane1.x1 = 639;
  pane1.y1 = 141;
  VFX_pane_wipe(&pane1, 0);
  v3 = 0xA;
  v4 = *(_BYTE *)(a1 + 0xB9);
  if ( v4 == 2 || v4 == 3 )
  {
    pane3 = *(PANE *)(*(_DWORD *)(a1 + 0xB5) + 4);
    pane3.y0 = 7;
    pane3.y1 = *(unsigned __int16 *)(*(_DWORD *)(a1 + 0xB5) + 0x8C9) + 8;
    if ( *(_BYTE *)(a1 + 0xB9) == 2 )
    {
      v5 = *(_DWORD *)(a1 + 0xAC);
      v6 = 0;
      v3 = 0xB;
    }
    else
    {
      v6 = 0xFFFFFFFF;
      v5 = *(_DWORD *)(a1 + 0xAC);
      v3 = 0x13;
    }
    Q_BATCON_CPP_sub_10010(&pane3, v5, v6, 0, (int)&pane2);
  }
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 0x18));
  VFX_shape_draw(&pane1, ShapeTable_sub_1B084, v3, 0, 0);
  sub_2D218((_DWORD *)a1);
  sub_552CC(&WinMgr, &pane1);
  v8 = *(_BYTE *)(a1 + 0xB9);
  if ( v8 == 1 || v8 == 4 )
  {
    pane2.window = *(WINDOW **)(a1 + 4);
    pane2.x0 = 0x1DA;
    pane2.y0 = 7;
    pane2.x1 = 0x278;
    pane2.y1 = 0x25;
    type = V_Game.pCurStar->type;
    v9 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(*(_DWORD *)(a1 + 0xBB) + 0x19C8));
    VFX_shape_transform(&pane2, v9, type, 0xF, 0xF, V_BigBuffer, 0, 0x3333, 0x3333, 0);
    v10 = 0;
    v18 = 0xF3;
    v17 = 0xFFFF;
    if ( V_Game.racesNum > 0 )
    {
      while ( 1 )
      {
        if ( V_Game.races[v10].Unknown_03 != 0xFFFFFFFF )
        {
          racesBits = V_Game.pCurStar->racesBits;
          if ( racesBits )
          {
            if ( ((1 << v10) | racesBits) == 1 << v10 || V_Game.pCurStar == V_Game.races[v10].star && ((1 << v10) & racesBits) != 0 )
            {
              break;
            }
          }
        }
        if ( ++v10 >= V_Game.racesNum )
        {
          goto LABEL_20;
        }
      }
      v17 = v10;
    }
LABEL_20:
    if ( v17 != 0xFFFFFFFF )
    {
      v18 = 4 * V_Game.races[v10].Unknown_02 + 0x13;
      Q_WINMGR_CPP_sub_53E38(&pane2, 0x8D, 3, v10);
    }
    sprintf(s, "%s", V_Game.pCurStar->name);
    WinMgr.LargeFont.pane = pane2;
    sub_2B8A8(&WinMgr.LargeFont, 0x28, 5, s, 0, v18, 0xFF, 0x6C);
    sprintf(s, "%s", V_StarTypeTexts_D84C4[V_Game.pCurStar->type]);
    WinMgr.SmallFont.pane = pane2;
    sub_2B8A8(&WinMgr.SmallFont, 0x28, 0x12, s, 0, 0xF3, 0xFF, 0x6C);
    sub_552CC(&WinMgr, &pane2);
  }
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// 11870: using guessed type _DWORD pane3[2];

//----- (00011BA4) --------------------------------------------------------
int __fastcall sub_11BA4(int a1)
{
  int v2; // ebp
  P_Ship v3; // edi
  unsigned __int16 v4; // ax
  WORD i; // di
  int v6; // edx
  unsigned __int16 v7; // ax
  int v9; // kr04_4
  int v10; // kr08_4
  int v11; // ebx
  BYTE cat; // ah
  int v13; // ebp
  BYTE v14; // al
  T_Gizmo *v15; // ebp
  unsigned __int16 v16; // dx
  T_Planet *v17; // edi
  int v18; // edx
  int v19; // ebp
  __int16 v20; // di
  int v21; // ebp
  int v22; // edx
  unsigned __int16 v23; // ax
  WORD k; // di
  int v25; // edx
  unsigned __int16 v26; // ax
  P_Ship ships[107]; // [esp+0h] [ebp-39Ch] BYREF
  int v28[107]; // [esp+1ACh] [ebp-1F0h] BYREF
  int v29; // [esp+358h] [ebp-44h]
  int v30; // [esp+35Ch] [ebp-40h]
  int a3; // [esp+360h] [ebp-3Ch] BYREF
  int a4; // [esp+364h] [ebp-38h] BYREF
  int v33; // [esp+368h] [ebp-34h] BYREF
  int result_4; // [esp+36Ch] [ebp-30h]
  int v35; // [esp+370h] [ebp-2Ch]
  int v36; // [esp+374h] [ebp-28h]
  int v37; // [esp+378h] [ebp-24h]
  __int16 v38; // [esp+37Ch] [ebp-20h]
  __int16 j; // [esp+380h] [ebp-1Ch]

  sub_2ED4C(*(P_Wnd10LB *)(a1 + 0xB5));
  switch ( *(_BYTE *)(a1 + 0xB9) )
  {
    case 1:
      *(_WORD *)(*(_DWORD *)(a1 + 0xB5) + 0x8C9) = 0x54;
      Q_A10_SetProc_sub_2F1C8(*(P_Wnd10LB *)(a1 + 0xB5), Q_BATCON_CPP_sub_10010);
      v38 = 0;
      v2 = sub_1D794((P_Location)V_Game.pCurStar, ships);
      while ( v38 < v2 )
      {
        v3 = ships[v38];
        if ( v3->locationType == ASCEND_LOCATION_TYPE_STAR )
        {
          if ( v3->raceIndex >= 7 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x4AC);
          }
          if ( v3->raceIndex == V_RaceIndex )
          {
            v4 = sub_2EA8C(*(_DWORD *)(a1 + 0xB5), (const char *)ships[v38], 0xFFFFFFFF, 0);
            sub_2EC50(*(_DWORD *)(a1 + 0xB5), v4, v38);
          }
        }
        ++v38;
      }
      for ( i = 0; i < V_Game.pCurStar->planetsNum; ++i )
      {
        v6 = V_Game.pCurStar->Unknown_46[i];
        if ( *(_BYTE *)(v6 + 0x57) == V_RaceIndex )
        {
          v7 = sub_2EA8C(*(_DWORD *)(a1 + 0xB5), (const char *)v6, 0xFFFFFFFF, 0);
          sub_2EC50(*(_DWORD *)(a1 + 0xB5), v7, i | 0x80000000);
        }
      }
      goto LABEL_15;
    case 2:
      if ( *(_BYTE *)(a1 + 0xAB) != 3 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x4D8);
      }
      if ( !*(_DWORD *)(a1 + 0xAC) )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x4D9);
      }
      *(_WORD *)(*(_DWORD *)(a1 + 0xB5) + 0x8C9) = 0x54;
      Q_A10_SetProc_sub_2F1C8(*(P_Wnd10LB *)(a1 + 0xB5), Q_BATCON_CPP_sub_10668);
      result_4 = *(_DWORD *)(a1 + 0xAC);
      v30 = *(_DWORD *)(result_4 + 0x88);
      if ( *(_WORD *)(result_4 + 0x56) == V_RaceIndex || sub_4AAEC(result_4, V_RaceIndex) == 2 )
      {
        LOWORD(v37) = 0;
        v9 = result_4 + 0xAB;
        v10 = 0;
        while ( (__int16)v37 < *(_DWORD *)(result_4 + 0x15A) )
        {
          if ( *(_BYTE *)(v9 + 7 * v10) != 0xFF )
          {
            if ( (v13 = *(char *)(v9 + 7 * v10), v14 = V_Gizmos[v13].cat, v15 = &V_Gizmos[v13], v14 == *(_BYTE *)(a1 + 0xBA))
              && (v15->flags & 0x80) == 0
              || *(_BYTE *)(a1 + 0xBA) == 4 && (v15->flags & 0x80) != 0 )
            {
              v16 = sub_2EA8C(*(_DWORD *)(a1 + 0xB5), (const char *)(v9 + 7 * v10), 0xFFFFFFFF, 0);
              v29 = *(__int16 *)(result_4 + 0x56);
              v11 = 0;
              if ( V_RaceIndex == v29 )
              {
                if ( (v15->flags & 0x20) == 0 )
                {
                  if ( !v15->numUses || *(_WORD *)(v9 + 7 * v10 + 1) )
                  {
                    if ( v30 < v15->power )
                    {
                      v11 = 3;
                    }
                  }
                  else
                  {
                    v11 = 2;
                  }
                }
              }
              else
              {
                v11 = 1;
              }
              if ( (v15->flags & 0x80) != 0 )
              {
                v11 = *(char *)(v9 + 7 * v10) + 0x1F4;
              }
              cat = v15->cat;
              if ( cat == 2 )
              {
                v11 = *(char *)(v9 + 7 * v10) + 0x258;
              }
              else if ( cat == 4 )
              {
                v11 = *(char *)(v9 + 7 * v10) + 0x2BC;
              }
              sub_2EC50(*(_DWORD *)(a1 + 0xB5), v16, v11);
            }
          }
          LOWORD(v37) = v37 + 1;
          ++v10;
        }
      }
      goto LABEL_15;
    case 3:
      *(_WORD *)(*(_DWORD *)(a1 + 0xB5) + 0x8C9) = 0x54;
      Q_A10_SetProc_sub_2F1C8(*(P_Wnd10LB *)(a1 + 0xB5), sub_10878);
      v17 = *(T_Planet **)(a1 + 0xAC);
      if ( *(_BYTE *)(a1 + 0xAB) != 2 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x51F);
      }
      if ( !v17 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x520);
      }
      if ( V_RaceIndex == v17->raceIndex )
      {
        for ( j = 0; j < (int)v17->word1A; ++j )
        {
          v18 = (int)v17->pUnknown_10 + 4 * j;
          v35 = 4 * j;
          v19 = 0;
          if ( (*(_WORD *)(v18 + 2) & 1) != 0 && (V_PlanetItems.item[*(unsigned __int8 *)(v18 + 1)].flags & 4) != 0 )
          {
            v36 = sub_2EA8C(*(_DWORD *)(a1 + 0xB5), (const char *)v18, 0xFFFFFFFF, 0);
            sub_366C8(v17, *((_BYTE *)v17->pUnknown_10 + v35 + 1), &a3, &a4, &v33);
            if ( v33 && !((int)*(unsigned __int16 *)((char *)v17->pUnknown_10 + v35 + 2) >> 8) )
            {
              v19 = 1;
            }
            sub_2EC50(*(_DWORD *)(a1 + 0xB5), v36, v19);
          }
        }
      }
      goto LABEL_15;
    case 4:
      *(_WORD *)(*(_DWORD *)(a1 + 0xB5) + 0x8C9) = 0x54;
      Q_A10_SetProc_sub_2F1C8(*(P_Wnd10LB *)(a1 + 0xB5), Q_BATCON_CPP_sub_10010);
      v20 = 0;
      v21 = sub_1D794((P_Location)V_Game.pCurStar, (P_Ship *)v28);
      while ( v20 < v21 )
      {
        v22 = v28[v20];
        if ( *(_BYTE *)(v22 + 0x58) == 4 && *(_WORD *)(v22 + 0x56) != V_RaceIndex )
        {
          v23 = sub_2EA8C(*(_DWORD *)(a1 + 0xB5), (const char *)v22, 0xFFFFFFFF, 0);
          sub_2EC50(*(_DWORD *)(a1 + 0xB5), v23, v20);
        }
        ++v20;
      }
      for ( k = 0; k < V_Game.pCurStar->planetsNum; ++k )
      {
        v25 = V_Game.pCurStar->Unknown_46[k];
        if ( V_RaceIndex != *(_BYTE *)(v25 + 0x57) )
        {
          v26 = sub_2EA8C(*(_DWORD *)(a1 + 0xB5), (const char *)v25, 0xFFFFFFFF, 0);
          sub_2EC50(*(_DWORD *)(a1 + 0xB5), v26, k | 0x80000000);
        }
      }
LABEL_15:
      sub_2F1D8(*(_DWORD *)(a1 + 0xB5), (int)sub_10A14);
      sub_2F1E0(*(_DWORD *)(a1 + 0xB5));
      break;
    default:
      return (*(int (**)(void))(*(_DWORD *)(*(_DWORD *)(a1 + 0xB5) + 0xA7) + 0xC))();
  }
  return (*(int (**)(void))(*(_DWORD *)(*(_DWORD *)(a1 + 0xB5) + 0xA7) + 0xC))();
}
// 11BA4: using guessed type int var_1F0[107];

//----- (00012140) --------------------------------------------------------
int __fastcall sub_12140(int a1)
{
  __int16 i; // si
  unsigned int v3; // edx
  char v4; // ah
  __int16 j; // bx
  int v6; // eax
  int result; // eax
  int v8; // eax
  unsigned int v9; // [esp+4h] [ebp-1Ch]

  for ( i = 0; i < *(__int16 *)(a1 + 0x6B); ++i )
  {
    if ( !strcmp((const char *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * i) + 0x20), "My^Items") )
    {
      break;
    }
  }
  if ( i >= *(__int16 *)(a1 + 0x6B) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x58C);
  }
  v3 = 0xFFFFFFFF;
  v4 = *(_BYTE *)(a1 + 0xB9);
  v9 = 0;
  if ( v4 == 2 )
  {
    v3 = 0;
  }
  else if ( v4 == 3 )
  {
    v9 = 0xFFFFFFFF;
  }
  for ( j = 0; ; ++j )
  {
    result = j;
    if ( j >= 9 )
    {
      break;
    }
    if ( v9 )
    {
      v6 = i + j;
      *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * v6) + 0x35) = 0;
      *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * v6) + 0x39) = 0;
    }
    else
    {
      v8 = i + j;
      if ( j >= 5 )
      {
        *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * v8) + 0x35) = ~v3;
        *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * v8) + 0x39) = ~v3;
      }
      else
      {
        *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * v8) + 0x35) = v3;
        *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * v8) + 0x39) = v3;
      }
    }
  }
  return result;
}

//----- (00012238) --------------------------------------------------------
void __fastcall sub_12238(int a1, int a2)
{
  if ( *(_BYTE *)(a1 + 0xAB) == 3 )
  {
    sub_49B3C(*(P_Ship *)(a1 + 0xAC), 1);
  }
  else if ( *(_BYTE *)(a1 + 0xAB) == 2 )
  {
    sub_3676C(*(T_Planet **)(a1 + 0xAC), 1);
  }
  *(_BYTE *)(a1 + 0xAB) = 0;
  *(_DWORD *)(a1 + 0xAC) = 0;
  if ( a2 == 0xFFFFFFFF )
  {
    sub_11BA4(a1);
  }
  sub_1229C(a1, a2);
}

//----- (0001229C) --------------------------------------------------------
void __fastcall sub_1229C(int a1, int a2)
{
  T_Star *pCurStar; // esi
  _BYTE v4[5]; // [esp+0h] [ebp-1Ch] BYREF

  pCurStar = V_Game.pCurStar;
  while ( (__int16)++*(_WORD *)(a1 + 0xD4) < *(_DWORD *)(a1 + 0xD6) || sub_12368(a1, a2) )
  {
    v4[0] = 0;
    *(_DWORD *)(a1 + 4 * *(__int16 *)(a1 + 0xD4) + 0xE8) = sub_406C4(
                                                             &V_Game.races[*(__int16 *)(a1 + 2 * *(__int16 *)(a1 + 0xD4) + 0xDA)],
                                                             pCurStar,
                                                             (int)v4);
    if ( v4[0] )
    {
      *(_DWORD *)(a1 + 0xAB) = *(_DWORD *)v4;
      *(_BYTE *)(a1 + 0xAF) = v4[4];
      if ( v4[0] == 3 )
      {
        sub_49B3C(*(P_Ship *)&v4[1], 0);
      }
      else
      {
        sub_3676C(*(T_Planet **)&v4[1], 0);
      }
      if ( a2 == 0xFFFFFFFF )
      {
        sub_12674(*(_DWORD *)(a1 + 0xBB));
      }
      else
      {
        sub_12238(a1, a2);
      }
      return;
    }
  }
}

//----- (00012368) --------------------------------------------------------
unsigned int __fastcall sub_12368(int a1, int a2)
{
  P_Star pCurStar; // esi
  unsigned int v4; // edi
  __int16 i; // ax
  P_Star v6; // eax
  __int16 v7; // cx
  int v8; // eax
  T_Race *v9; // eax

  pCurStar = V_Game.pCurStar;
  v4 = 0;
  if ( *(_DWORD *)(a1 + 0x104) == 0xFFFFFFFF )
  {
    for ( i = 0; i < *(_DWORD *)(a1 + 0xD6); ++i )
    {
      if ( *(_DWORD *)(a1 + 4 * i + 0xE8) == 0xFFFFFFFF )
      {
        v4 = 0xFFFFFFFF;
        break;
      }
    }
  }
  v6 = V_Game.pCurStar;
  *(_DWORD *)(a1 + 0x104) = v4;
  sub_1D734((int)v6, a1 + 0xDA);
  *(_WORD *)(a1 + 0xD4) = 0;
  v7 = 0;
  *(_DWORD *)(a1 + 0xD6) = v8;
  while ( v7 < *(_DWORD *)(a1 + 0xD6) )
  {
    v9 = &V_Game.races[*(__int16 *)(a1 + 2 * v7++ + 0xDA)];
    sub_3B56C(v9, (P_Location)pCurStar);
  }
  if ( a2 == 0xFFFFFFFF )
  {
    (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
  }
  return v4;
}
// 123C0: variable 'v8' is possibly undefined

//----- (0001240C) --------------------------------------------------------
void __fastcall sub_1240C(int a1, int a2)
{
  sub_2FBA4(a1, a2);
  Q_WINMGR_CPP_sub_53E38((PANE *)(a1 + 4), 3, 3, V_RaceIndex);
}

//----- (00012440) --------------------------------------------------------
char *__fastcall sub_12440(char *result)
{
  *(_DWORD *)(result + 0xA) = 0;
  *(_DWORD *)(result + 0xE) = 0;
  *(_DWORD *)(result + 0x12) = 0;
  *(_DWORD *)(result + 0x1A) = 0;
  *(_DWORD *)(result + 0x1E) = 0;
  *(_DWORD *)(result + 0x16) = 0;
  return result;
}

//----- (00012480) --------------------------------------------------------
int __fastcall sub_12480(float *a1, float *a2, float a3)
{
  double v6; // st7
  double v7; // st7
  float v9; // [esp+8h] [ebp-80h] BYREF
  float v10; // [esp+Ch] [ebp-7Ch]
  float v11; // [esp+10h] [ebp-78h]
  float v12; // [esp+14h] [ebp-74h] BYREF
  float v13; // [esp+18h] [ebp-70h]
  float v14; // [esp+1Ch] [ebp-6Ch]
  int v15[3]; // [esp+20h] [ebp-68h] BYREF
  float v16; // [esp+2Ch] [ebp-5Ch]
  int v17; // [esp+30h] [ebp-58h]
  int v18; // [esp+34h] [ebp-54h]
  float v19; // [esp+38h] [ebp-50h]
  float v20; // [esp+3Ch] [ebp-4Ch]
  float v21; // [esp+40h] [ebp-48h]
  int v22[3]; // [esp+44h] [ebp-44h] BYREF
  float v23; // [esp+50h] [ebp-38h]
  float v24; // [esp+54h] [ebp-34h]
  float v25; // [esp+58h] [ebp-30h]
  float v26; // [esp+5Ch] [ebp-2Ch]
  int v27; // [esp+60h] [ebp-28h]
  int v28; // [esp+64h] [ebp-24h]
  int *v29; // [esp+68h] [ebp-20h]
  float *v30; // [esp+6Ch] [ebp-1Ch]
  int *v31; // [esp+70h] [ebp-18h]
  float *v32; // [esp+74h] [ebp-14h]
  float v33; // [esp+7Ch] [ebp-Ch]

  v30 = &v12;
  v23 = 0.0;
  v24 = 0.0;
  v25 = 0.0;
  v23 = *a2 - *a1;
  v24 = a2[1] - a1[1];
  v25 = a2[2] - a1[2];
  v12 = v23;
  v13 = v24;
  v14 = v25;
  v33 = sqrt(v24 * v24 + v23 * v23 + v25 * v25);
  if ( a3 >= (double)v33 )
  {
    *a1 = *a2;
    a1[1] = a2[1];
    a1[2] = a2[2];
    return 0xFFFFFFFF;
  }
  else
  {
    v26 = v12 * a3;
    *(float *)&v27 = v13 * a3;
    *(float *)&v28 = a3 * v14;
    v6 = 1.0 / v33;
    v29 = v22;
    *(float *)v22 = v26;
    v22[1] = v27;
    v22[2] = v28;
    v16 = v26 * v6;
    v31 = v15;
    *(float *)&v17 = *(float *)&v27 * v6;
    *(float *)v15 = v16;
    v19 = 0.0;
    v15[1] = v17;
    *(float *)&v18 = v6 * *(float *)&v28;
    v20 = 0.0;
    v15[2] = v18;
    v21 = 0.0;
    v32 = &v9;
    v19 = *a1 + v16;
    v20 = a1[1] + *(float *)&v17;
    v7 = a1[2];
    v9 = v19;
    v21 = v7 + *(float *)&v18;
    v10 = v20;
    v11 = v21;
    *a1 = v19;
    a1[1] = v10;
    a1[2] = v11;
    return 0;
  }
}

//----- (00012618) --------------------------------------------------------
unsigned int __fastcall sub_12618(int a1)
{
  int v2; // esi
  void *ShapeTable_sub_1B084; // eax
  unsigned int v4; // ebp
  LONG v5; // esi
  unsigned __int16 v7; // [esp+0h] [ebp-1Ch]

  v7 = *(_WORD *)(a1 + 5);
  v2 = *(_DWORD *)(a1 + 7);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, v7);
  v4 = 0;
  v5 = v2 + 1;
  if ( v5 >= VFX_shape_count(ShapeTable_sub_1B084) )
  {
    v4 = 0xFFFFFFFF;
    LOWORD(v5) = 0;
  }
  sub_156C0(a1, v7, v5);
  return v4;
}

//----- (00012674) --------------------------------------------------------
void __fastcall sub_12674(int a1)
{
  *(_BYTE *)(a1 + 0x4F37) = 0xFF;
  *(_DWORD *)(a1 + 0xB3) = 0;
  *(_WORD *)(a1 + 0x5034) = 0;
  *(_BYTE *)(a1 + 0xB7) = 4;
  sub_56400(&WinMgr, *(_DWORD *)(a1 + 0x41), 0x52, 0, 0, 0);
}

//----- (000126F8) --------------------------------------------------------
int __usercall sub_126F8@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ebp>)
{
  unsigned int v4; // edi
  int v5; // edx
  char v6; // al
  char v7; // bl
  int v8; // edx
  char v9; // al
  int v10; // ebx
  int v11; // kr04_4
  int v12; // ebx
  int v13; // kr0C_4
  __int64 v14; // rax
  int v15; // edx
  int v16; // kr14_4

  v4 = 0;
  if ( *(_BYTE *)(a1 + 0x4F37) != 0xFF )
  {
    goto LABEL_42;
  }
  sub_187EC((P_Wnd4BM)a1);
  sub_18C2C((P_Wnd4BM)a1, 0);
  v5 = *(_DWORD *)(a1 + 0xAB);
  *(_DWORD *)(a1 + 0x4F38) = 0;
  v6 = 0;
  v7 = *(_BYTE *)(v5 + 0xAB);
  if ( v7 != 3 )
  {
    if ( v7 != 2 )
    {
      goto LABEL_41;
    }
    v6 = 0x34;
    if ( *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v5 + 0x63) + 0x6B) + 1) == 0x11 )
    {
      *(_BYTE *)(a1 + 0x4F37) = 3;
      goto LABEL_41;
    }
    goto LABEL_40;
  }
  v8 = *(_DWORD *)(v5 + 0xAC);
  v7 = *(_BYTE *)(v8 + 0x62);
  if ( v7 )
  {
    if ( v7 != 1 )
    {
      goto LABEL_41;
    }
    v6 = **(_BYTE **)(v8 + 0x63);
    switch ( v6 )
    {
      case '4':
        *(_BYTE *)(a1 + 0x4F37) = 3;
        goto LABEL_41;
      case '7':
        *(_BYTE *)(a1 + 0x4F37) = 4;
        goto LABEL_41;
      case ' ':
        *(_BYTE *)(a1 + 0x4F37) = 5;
        goto LABEL_41;
      case '8':
      case 'J':
        *(_BYTE *)(a1 + 0x4F37) = 6;
        goto LABEL_41;
      case ':':
        *(_BYTE *)(a1 + 0x4F37) = 7;
        goto LABEL_41;
      case '.':
        *(_BYTE *)(a1 + 0x4F37) = 8;
        goto LABEL_41;
      case '<':
        *(_BYTE *)(a1 + 0x4F37) = 9;
        goto LABEL_41;
      case ';':
      case 'D':
        *(_BYTE *)(a1 + 0x4F37) = 0xA;
        goto LABEL_41;
      case '-':
        *(_BYTE *)(a1 + 0x4F37) = 0xB;
        goto LABEL_41;
      case '(':
      case '\'':
        *(_BYTE *)(a1 + 0x4F37) = 0xC;
        goto LABEL_41;
      case '$':
        *(_BYTE *)(a1 + 0x4F37) = 0xD;
        goto LABEL_41;
      case 'H':
        *(_BYTE *)(a1 + 0x4F37) = 0xE;
        goto LABEL_41;
      case '&':
        *(_BYTE *)(a1 + 0x4F37) = 0xF;
        goto LABEL_41;
    }
    if ( (V_Gizmos[v6].flags & 0x40) == 0 )
    {
      *(_BYTE *)(a1 + 0x4F37) = 2;
      goto LABEL_41;
    }
LABEL_40:
    *(_BYTE *)(a1 + 0x4F37) = v7;
    goto LABEL_41;
  }
  *(_BYTE *)(a1 + 0x4F37) = 0;
LABEL_41:
  Q_CACHE_CPP_GetShapeTable_sub_1B084(
    (unsigned int)&WinMgr.t13,
    *(unsigned __int16 *)(a1 + 2 * *(__int16 *)(a1 + 4 * v6 + 0x1A92) + 0x19C6));
  Q_CACHE_CPP_GetShapeTable_sub_1B084(
    (unsigned int)&WinMgr.t13,
    *(unsigned __int16 *)(a1 + 2 * *(__int16 *)(a1 + 4 * v9 + 0x1A94) + 0x19C6));
  sub_50140(&V_SoundSystem, *(_WORD *)(a1 + 4 * v9 + 0x1BCE));
  a2 = *(__int16 *)(a1 + 4 * v9 + 0x1BD0);
  sub_50140(&V_SoundSystem, a2);
LABEL_42:
  v10 = 0;
  v11 = 0;
  while ( v10 < *(__int16 *)(a1 + 0x5034) )
  {
    a2 = *(_DWORD *)(a1 + 4 * v11 + 0x4F44);
    sub_12B4C(a1, a2);
    ++v10;
    ++v11;
  }
  switch ( *(_BYTE *)(a1 + 0x4F37) )
  {
    case 0xFF:
      v4 = 0xFFFFFFFF;
      break;
    case 0:
      v4 = sub_12C98(a1, a2, v10);
      break;
    case 1:
      v4 = sub_12E88(a1);
      break;
    case 2:
      v4 = sub_12F7C(a1, a3);
      break;
    case 3:
      v4 = sub_13370(a1, a2, v10);
      break;
    case 4:
      v4 = sub_136C4(a1);
      break;
    case 5:
      v4 = sub_1380C(a1);
      break;
    case 6:
      v4 = sub_13C10(a1);
      break;
    case 7:
      v4 = sub_14224(a1);
      break;
    case 8:
      v4 = sub_142D8(a1);
      break;
    case 9:
      v4 = sub_14490(a1);
      break;
    case 0xA:
      v4 = sub_145C0(a1);
      break;
    case 0xB:
      v4 = sub_147CC(a1);
      break;
    case 0xC:
      v4 = sub_14B18(a1, a2, v10);
      break;
    case 0xD:
      v4 = sub_15078(a1);
      break;
    case 0xE:
      v4 = sub_15164(a1);
      break;
    case 0xF:
      v4 = sub_152E4(a1, a2, v10, a1);
      break;
    default:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\batfx.cpp", 0xF8);
      break;
  }
  if ( *(_DWORD *)(a1 + 0x5036) == 0xFFFFFFFF )
  {
    v4 = 0xFFFFFFFF;
    *(_DWORD *)(a1 + 0x5036) = 0;
  }
  sub_18C2C((P_Wnd4BM)a1, 1);
  v12 = 0;
  v13 = 0;
  while ( v12 < *(__int16 *)(a1 + 0x5034) )
  {
    sub_12B4C(a1, *(_DWORD *)(a1 + 4 * v13 + 0x4F44));
    ++v12;
    ++v13;
  }
  LODWORD(v14) = (*(int (__fastcall **)(int, int))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 1);
  ++*(_DWORD *)(a1 + 0x4F38);
  if ( v4 == 0xFFFFFFFF )
  {
    v15 = *(_DWORD *)(a1 + 0x41);
    *(_BYTE *)(a1 + 0xB7) = 0;
    sub_564C0(&WinMgr, v15, 0x52);
    sub_12238(*(_DWORD *)(a1 + 0xAB), 0xFFFFFFFF);
    sub_187EC((P_Wnd4BM)a1);
    sub_18C2C((P_Wnd4BM)a1, 0);
    *(_BYTE *)(a1 + 0x4F37) = 0xFF;
    v14 = (unsigned int)a1;
    v16 = 0;
    while ( SHIDWORD(v14) < *(__int16 *)(a1 + 0x5034) )
    {
      ++HIDWORD(v14);
      *(_BYTE *)(*(_DWORD *)(a1 + 4 * v16++ + 0x4F44) + 0x33) &= 1u;
    }
  }
  return v14;
}

//----- (00012AE4) --------------------------------------------------------
int __fastcall sub_12AE4(int a1, P_Ship a2)
{
  int v4; // edi
  int v5; // edx
  int v6; // kr04_4
  int v7; // eax

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x122);
  }
  v4 = 0;
  v5 = 0;
  if ( *(int *)(a1 + 0x1D32) > 0 )
  {
    v7 = *(_DWORD *)(a1 + 0x1D2A);
    v6 = 0;
    while ( a2 != *(P_Ship *)(v7 + 0x35 * v6 + 1) )
    {
      ++v5;
      ++v6;
      if ( v5 >= *(_DWORD *)(a1 + 0x1D32) )
      {
        goto LABEL_10;
      }
    }
    v4 = v7;
  }
LABEL_10:
  if ( !v4 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x12F);
  }
  return v4;
}

//----- (00012B4C) --------------------------------------------------------
void __fastcall sub_12B4C(int a1, int a2)
{
  int v2; // ebx
  int v3; // esi
  int v4; // ecx
  LONG v5; // eax
  int v6; // eax
  LONG v7; // ebx
  double v8; // st7
  double v9; // st6
  double v10; // st5
  int v11; // [esp+Ch] [ebp-18h]

  if ( *(_BYTE *)a2 == 8 )
  {
    v2 = *(_DWORD *)(a2 + 1);
    if ( *(_WORD *)(a2 + 0x27) >= *(_WORD *)(v2 + 0x27) )
    {
      v3 = *(_DWORD *)(a1 + 8);
      stru_9A23C.x0 = v3 + *(__int16 *)(v2 + 0x27);
      v4 = *(__int16 *)(a2 + 0x27);
    }
    else
    {
      v3 = *(__int16 *)(v2 + 0x27);
      stru_9A23C.x0 = *(_DWORD *)(a1 + 8) + *(__int16 *)(a2 + 0x27);
      v4 = *(_DWORD *)(a1 + 8);
    }
    stru_9A23C.x1 = v3 + v4;
    if ( *(_WORD *)(a2 + 0x29) >= *(_WORD *)(v2 + 0x29) )
    {
      v6 = *(_DWORD *)(a1 + 0xC);
      v7 = *(__int16 *)(v2 + 0x29) + v6;
      v5 = *(__int16 *)(a2 + 0x29) + v6;
      stru_9A23C.y0 = v7;
    }
    else
    {
      stru_9A23C.y0 = *(__int16 *)(a2 + 0x29) + *(_DWORD *)(a1 + 0xC);
      v5 = *(__int16 *)(v2 + 0x29) + *(_DWORD *)(a1 + 0xC);
    }
    stru_9A23C.y1 = v5;
  }
  else
  {
    v11 = *(__int16 *)(a2 + 0x29) + *(_DWORD *)(a1 + 0xC);
    v8 = (double)*(unsigned int *)(a2 + 0xF) * 0.0000152587890625;
    v9 = (double)(*(__int16 *)(a2 + 0x27) + *(_DWORD *)(a1 + 8));
    stru_9A23C.x0 = (int)((double)*(__int16 *)(a2 + 0x13) * v8 + v9);
    v10 = (double)v11;
    stru_9A23C.y0 = (int)((double)*(__int16 *)(a2 + 0x15) * v8 + v10);
    stru_9A23C.x1 = (int)(v9 + (double)*(__int16 *)(a2 + 0x17) * v8);
    stru_9A23C.y1 = (int)(v8 * (double)*(__int16 *)(a2 + 0x19) + v10);
  }
  sub_552CC(&WinMgr, &stru_9A23C);
}

//----- (00012C98) --------------------------------------------------------
unsigned int __fastcall sub_12C98(int a1, int a2, int a3)
{
  int v4; // edi
  unsigned int v5; // ebp
  char v6; // ah
  int v7; // edi
  int v8; // edi
  char v9; // dl
  int v10; // eax
  int v11; // eax
  int v13; // edi
  void *ShapeTable_sub_1B084; // eax
  int v15; // edi
  int v16; // ecx
  unsigned __int16 v17; // [esp+0h] [ebp-1Ch]

  v4 = *(_DWORD *)(a1 + 0xAB);
  v5 = 0;
  v6 = *(_BYTE *)(v4 + 0xAB);
  v7 = v4 + 0xAB;
  if ( v6 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x16B);
  }
  v8 = *(_DWORD *)(v7 + 1);
  v9 = *(_BYTE *)(v8 + 0x67);
  if ( v9 != 3 && v9 != 1 && v9 != 2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x171);
  }
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 1;
    v10 = sub_12AE4(a1, (P_Ship)v8);
    *(_DWORD *)(a1 + 0x4F44) = v10;
    *(_BYTE *)(v10 + 0x33) = 0x12;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(_DWORD *)(a1 + 0x4F80) = *(_DWORD *)(v8 + 0x9E);
    *(_DWORD *)(a1 + 0x4F84) = *(_DWORD *)(v8 + 0xA2);
    *(_DWORD *)(a1 + 0x4F88) = *(_DWORD *)(v8 + 0xA6);
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    if ( *(_DWORD *)(v8 + 0x94) )
    {
      if ( *(_DWORD *)(v8 + 0x88) )
      {
        Q_StartSample_sub_4FB90(&V_SoundSystem, 7);
      }
    }
  }
  if ( *(_DWORD *)(a1 + 0x4F3C) )
  {
    v17 = 7;
    if ( (*(_BYTE *)(*(_DWORD *)(v8 + 0x68) + 0x23) & 1) != 0 )
    {
      v17 = 8;
    }
    v13 = *(_DWORD *)(a1 + 0x4F3C);
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 2 * v17 + 0x19C6));
    v15 = v13 >> 2;
    v16 = VFX_shape_count(ShapeTable_sub_1B084) - 1;
    if ( v15 <= v16 || v15 > 2 * v16 )
    {
      if ( v15 > 2 * v16 )
      {
        v5 = 0xFFFFFFFF;
        LOWORD(v15) = 0;
      }
    }
    else
    {
      LOWORD(v15) = 2 * v16 - v15;
    }
    sub_1826C((P_Wnd4BM)a1, *(_DWORD *)(a1 + 0x4F48), v17, v15);
    ++*(_DWORD *)(a1 + 0x4F3C);
  }
  else if ( sub_12480((float *)(a1 + 0x4F80), (float *)(v8 + 0x78), 20.0) == 0xFFFFFFFF )
  {
    if ( (*(_BYTE *)(v8 + 0x84) & 8) == 0 || *(_BYTE *)(v8 + 0x67) != 2 || sub_4960C(v8, *(_DWORD *)(v8 + 0x68)) != 0xFFFFFFFF )
    {
      return 0xFFFFFFFF;
    }
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) |= 8u;
    *(_WORD *)(a1 + 0x5034) = 2;
    v11 = sub_12AE4(a1, *(P_Ship *)(v8 + 0x68));
    *(_DWORD *)(a1 + 0x4F3C) = 1;
    *(_DWORD *)(a1 + 0x4F48) = v11;
  }
  return v5;
}

//----- (00012E88) --------------------------------------------------------
unsigned int __fastcall sub_12E88(int a1)
{
  int v2; // ebp
  int v3; // edi
  char v4; // ah
  int v5; // ebp
  int v6; // eax
  char v7; // bl
  int v8; // edx

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = 0;
  v4 = *(_BYTE *)(v2 + 0xAB);
  v5 = v2 + 0xAB;
  if ( v4 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x1BA);
  }
  v6 = *(_DWORD *)(v5 + 1);
  v7 = **(_BYTE **)(v6 + 0x63);
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    v8 = *(_DWORD *)(a1 + 0x1D2A);
    *(_WORD *)(a1 + 0x5034) = 1;
    *(_DWORD *)(a1 + 0x4F44) = v8 + 0x35;
    *(_BYTE *)(v8 + 0x35) = 7;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) = 0x12;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(_DWORD *)(a1 + 0x4F80) = *(_DWORD *)(v6 + 0x9E);
    *(_DWORD *)(a1 + 0x4F84) = *(_DWORD *)(v6 + 0xA2);
    *(float *)(a1 + 0x4F88) = *(float *)(v6 + 0xA6);
    sub_1826C((P_Wnd4BM)a1, *(_DWORD *)(a1 + 0x4F44), *(_WORD *)(a1 + 4 * v7 + 0x1A92), 0);
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v7 + 0x1BCE));
  }
  if ( (*(_BYTE *)(a1 + 0x4F38) & 3) == 0 && sub_12618(*(_DWORD *)(a1 + 0x4F44)) == 0xFFFFFFFF )
  {
    return 0xFFFFFFFF;
  }
  return v3;
}

//----- (00012F7C) --------------------------------------------------------
int __usercall sub_12F7C@<eax>(int a1@<eax>, int ebp0@<ebp>)
{
  int v3; // edx
  char v4; // bl
  int v5; // ebp
  int v6; // ebp
  int *v7; // edi
  int v8; // ebp
  char v9; // al
  char v10; // cl
  int v11; // eax
  int v12; // edi
  __int16 v14; // di
  unsigned __int16 v15; // ax
  _BYTE *v16; // eax
  char v17; // bl
  int v18; // eax
  float x_4; // [esp+4h] [ebp-7Ch]
  float v20; // [esp+8h] [ebp-78h] BYREF
  _DWORD *a2; // [esp+Ch] [ebp-74h]
  _DWORD *a3; // [esp+10h] [ebp-70h]
  _DWORD *a4; // [esp+14h] [ebp-6Ch]
  float v24; // [esp+18h] [ebp-68h]
  float v25; // [esp+1Ch] [ebp-64h]
  int v26[3]; // [esp+20h] [ebp-60h] BYREF
  float v27; // [esp+2Ch] [ebp-54h]
  int v28; // [esp+30h] [ebp-50h]
  int v29; // [esp+34h] [ebp-4Ch]
  int v30; // [esp+38h] [ebp-48h] BYREF
  __int64 result; // [esp+3Ch] [ebp-44h] BYREF
  _DWORD v32[2]; // [esp+48h] [ebp-38h] BYREF
  int v33; // [esp+50h] [ebp-30h]
  float v34; // [esp+54h] [ebp-2Ch]
  int v35; // [esp+58h] [ebp-28h]
  int v36; // [esp+5Ch] [ebp-24h]
  _BYTE *v37; // [esp+60h] [ebp-20h]
  char v38; // [esp+64h] [ebp-1Ch]

  v33 = 0;
  v3 = *(_DWORD *)(a1 + 0xAB) + 0xAB;
  *(float *)&a4 = 0.0;
  v24 = 0.0;
  v25 = 0.0;
  v20 = 0.0;
  *(float *)&a2 = 0.0;
  *(float *)&a3 = 0.0;
  v32[0] = 0;
  v4 = *(_BYTE *)v3;
  v38 = 0;
  if ( v4 == 3 )
  {
    v5 = *(_DWORD *)(v3 + 1);
    a4 = *(_DWORD **)(v5 + 0x9E);
    v24 = *(float *)(v5 + 0xA2);
    v25 = *(float *)(v5 + 0xA6);
    v20 = *(float *)(v5 + 0x78);
    a2 = *(_DWORD **)(v5 + 0x7C);
    a3 = *(_DWORD **)(v5 + 0x80);
    v36 = **(char **)(v5 + 0x63);
    v35 = *(_DWORD *)(v5 + 0x84);
    v38 = *(_BYTE *)(v5 + 0x67);
    ebp0 = *(_DWORD *)(v5 + 0x68);
    v32[0] = V_Gizmos[v36].range;
  }
  else if ( v4 == 2 )
  {
    v6 = *(_DWORD *)(v3 + 1);
    a4 = *(_DWORD **)v6;
    v24 = *(float *)(v6 + 4);
    v7 = (int *)(v6 + 0x6B);
    v25 = *(float *)(v6 + 8);
    v8 = *(_DWORD *)(v6 + 0x6F);
    v20 = *(float *)(v8 + 0x9E);
    a2 = *(_DWORD **)(v8 + 0xA2);
    a3 = *(_DWORD **)(v8 + 0xA6);
    v35 = v7[2];
    ebp0 = v7[1];
    v9 = *(_BYTE *)(*v7 + 1);
    HIDWORD(result) = *(_DWORD *)(v3 + 1);
    sub_366C8((P_Planet)HIDWORD(result), v9, v32, &v30, &result);
    v10 = *(_BYTE *)(*v7 + 1);
    switch ( v10 )
    {
      case 0x1C:
        v36 = 0x4C;
        break;
      case 0x1D:
        v36 = 0x4D;
        break;
      case 0x1E:
        v36 = 0x4E;
        break;
    }
  }
  else
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\batfx.cpp", 0x20E);
  }
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 2;
    v11 = *(_DWORD *)(a1 + 0x1D2A);
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    *(_DWORD *)(a1 + 0x4F44) = v11 + 0x35;
    *(_BYTE *)(v11 + 0x35) = 7;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) = 0x12;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(float *)(a1 + 0x4F80) = *(float *)&a4;
    *(float *)(a1 + 0x4F84) = v24;
    v12 = v36;
    *(float *)(a1 + 0x4F88) = v25;
    sub_1826C((P_Wnd4BM)a1, *(_DWORD *)(a1 + 0x4F44), *(_WORD *)(a1 + 4 * v12 + 0x1A92), 0);
    *(_DWORD *)(a1 + 0x4F48) = sub_12AE4(a1, (P_Ship)ebp0);
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v12 + 0x1BCE));
  }
  if ( *(_DWORD *)(a1 + 0x4F3C) )
  {
    v14 = 1;
    v34 = 1.0;
    v15 = 4;
    if ( (v35 & 4) != 0 || v36 == 0x3D )
    {
      v16 = *(_BYTE **)(a1 + 0x4F48);
      if ( *v16 == 2 )
      {
        LOWORD(v16) = *(char *)(ebp0 + 0xAA);
        v37 = v16;
        v34 = (double)(__int16)v16 * 0.3333333333333333 + 1.0;
      }
      v14 = 5;
      v17 = v36;
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) |= 8u;
      v15 = (char)(((v17 & 1) == 0) + 5);
      if ( v36 != 0x3D )
      {
        goto LABEL_29;
      }
      v18 = 0x3D;
    }
    else
    {
      if ( (v35 & 2) == 0 && (v35 & 0x10) == 0 && v38 != 1 && v38 != 2 )
      {
        goto LABEL_29;
      }
      v18 = v36;
    }
    v14 = *(_WORD *)(a1 + 4 * v18 + 0x1BD0);
    v15 = *(_WORD *)(a1 + 4 * v18 + 0x1A94);
LABEL_29:
    if ( *(_DWORD *)(a1 + 0x4F3C) == 1 )
    {
      sub_1826C((P_Wnd4BM)a1, *(_DWORD *)(a1 + 0x4F44), v15, 0);
      Q_StartSample_sub_4FB90(&V_SoundSystem, v14);
      *(_DWORD *)(a1 + 0x4F3C) = 2;
    }
    if ( (*(_BYTE *)(a1 + 0x4F38) & 3) == 0 && sub_12618(*(_DWORD *)(a1 + 0x4F44)) == 0xFFFFFFFF )
    {
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) |= 8u;
      v33 = 0xFFFFFFFF;
    }
    *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) = v34;
    return v33;
  }
  v27 = v20 - *(float *)&a4;
  v32[1] = v26;
  *(float *)&v28 = *(float *)&a2 - v24;
  *(float *)&v29 = *(float *)&a3 - v25;
  *(float *)v26 = v27;
  v26[1] = v28;
  v26[2] = v29;
  x_4 = sqrt(*(float *)&v28 * *(float *)&v28 + v27 * v27 + *(float *)&v29 * *(float *)&v29) * 0.015625 + 20.0;
  if ( sub_12480((float *)(a1 + 0x4F80), &v20, x_4) != 0xFFFFFFFF )
  {
    sub_12618(*(_DWORD *)(a1 + 0x4F44));
    return v33;
  }
  *(_DWORD *)(a1 + 0x4F3C) = 1;
  return v33;
}

//----- (00013370) --------------------------------------------------------
unsigned int __fastcall sub_13370(int a1, int a2, int a3)
{
  int v4; // ebp
  int v5; // eax
  int v6; // esi
  char v7; // dl
  int v8; // edi
  int v9; // ebx
  int v10; // eax
  int v11; // eax
  int v12; // eax
  double v13; // st7
  double v14; // st7
  float v16; // [esp+8h] [ebp-6Ch] BYREF
  float v17; // [esp+Ch] [ebp-68h]
  float v18; // [esp+10h] [ebp-64h]
  float v19; // [esp+14h] [ebp-60h]
  float v20; // [esp+18h] [ebp-5Ch]
  float v21; // [esp+1Ch] [ebp-58h]
  float v22; // [esp+20h] [ebp-54h] BYREF
  float v23; // [esp+24h] [ebp-50h]
  float v24; // [esp+28h] [ebp-4Ch]
  float v25; // [esp+2Ch] [ebp-48h]
  float v26; // [esp+30h] [ebp-44h]
  float v27; // [esp+34h] [ebp-40h]
  float v28; // [esp+38h] [ebp-3Ch]
  float v29; // [esp+3Ch] [ebp-38h]
  float v30; // [esp+40h] [ebp-34h]
  int v31; // [esp+44h] [ebp-30h]
  float *v32; // [esp+48h] [ebp-2Ch]
  float *v33; // [esp+4Ch] [ebp-28h]
  float v34; // [esp+50h] [ebp-24h]
  int v35; // [esp+54h] [ebp-20h]
  float v36; // [esp+58h] [ebp-1Ch]

  v4 = 0;
  v5 = *(_DWORD *)(a1 + 0xAB) + 0xAB;
  v25 = 0.0;
  v26 = 0.0;
  v27 = 0.0;
  v6 = 0;
  v7 = *(_BYTE *)v5;
  v35 = 0;
  if ( v7 == 3 )
  {
    v8 = *(_DWORD *)(v5 + 1);
    if ( *(_BYTE *)(v8 + 0x67) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x27D);
    }
    v6 = *(_DWORD *)(v8 + 0x68);
    v35 = sub_12AE4(a1, *(P_Ship *)(v5 + 1));
    v25 = *(float *)(v8 + 0x9E);
    v26 = *(float *)(v8 + 0xA2);
    v27 = *(float *)(v8 + 0xA6);
    v31 = 0x20 * V_Gizmos[0x34].special1;
    v34 = (float)(0x20 * V_Gizmos[0x34].special1);
  }
  else if ( v7 == 2 )
  {
    v9 = *(_DWORD *)(v5 + 1);
    v6 = *(_DWORD *)(v9 + 0x6F);
    v35 = sub_12AE4(a1, (P_Ship)v9);
    v25 = *(float *)v9;
    v26 = *(float *)(v9 + 4);
    v27 = *(float *)(v9 + 8);
    v34 = 3200.0;
  }
  else
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\batfx.cpp", 0x28E);
  }
  sub_12AE4(a1, (P_Ship)v6);
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 2;
    v10 = *(_DWORD *)(a1 + 0x1D2A);
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    *(_DWORD *)(a1 + 0x4F44) = v10 + 0x35;
    *(_BYTE *)(v10 + 0x35) = 8;
    *(_DWORD *)(*(_DWORD *)(a1 + 0x4F44) + 1) = v35;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) |= 0x12u;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(float *)(a1 + 0x4F80) = v25;
    *(float *)(a1 + 0x4F84) = v26;
    *(float *)(a1 + 0x4F88) = v27;
    v11 = sub_12AE4(a1, (P_Ship)v6);
    *(_DWORD *)(a1 + 0x4F48) = v11;
    *(_BYTE *)(v11 + 0x33) = 0x12;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x34) = 1;
    *(_DWORD *)(a1 + 0x4F8C) = *(_DWORD *)(v6 + 0x9E);
    *(_DWORD *)(a1 + 0x4F90) = *(_DWORD *)(v6 + 0xA2);
    *(_DWORD *)(a1 + 0x4F94) = *(_DWORD *)(v6 + 0xA6);
    Q_StartSample_sub_4FB90(&V_SoundSystem, 1);
  }
  v12 = *(_DWORD *)(a1 + 0x4F3C);
  if ( !v12 )
  {
    if ( sub_12480((float *)(a1 + 0x4F80), (float *)(a1 + 0x4F8C), 40.0) == 0xFFFFFFFF )
    {
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) |= 2u;
      v19 = 0.0;
      v20 = 0.0;
      v21 = 0.0;
      v32 = &v22;
      v19 = *(float *)(a1 + 0x4F8C) - v25;
      v20 = *(float *)(a1 + 0x4F90) - v26;
      v21 = *(float *)(a1 + 0x4F94) - v27;
      v22 = v19;
      v23 = v20;
      v24 = v21;
      v13 = sqrt(v20 * v20 + v19 * v19 + v21 * v21);
      v14 = v13 - v34;
      v36 = v14;
      if ( v14 < 1280.0 )
      {
        v36 = 1280.0;
      }
      sub_53054(&v22, v36);
      v33 = &v16;
      v28 = v25 + v22;
      v16 = v28;
      v29 = v26 + v23;
      v17 = v29;
      v30 = v27 + v24;
      v18 = v30;
      *(float *)(a1 + 0x4F98) = v28;
      *(float *)(a1 + 0x4F9C) = v17;
      *(float *)(a1 + 0x4FA0) = v18;
      *(_DWORD *)(a1 + 0x4F3C) = 1;
      return 0;
    }
    return v4;
  }
  if ( v12 != 1 )
  {
    return 0xFFFFFFFF;
  }
  if ( sub_12480((float *)(a1 + 0x4F8C), (float *)(a1 + 0x4F98), 4.0) == 0xFFFFFFFF )
  {
    *(_DWORD *)(a1 + 0x4F3C) = 2;
  }
  *(_DWORD *)(a1 + 0x4F80) = *(_DWORD *)(a1 + 0x4F8C);
  *(float *)(a1 + 0x4F84) = *(float *)(a1 + 0x4F90);
  *(_DWORD *)(a1 + 0x4F88) = *(_DWORD *)(a1 + 0x4F94);
  return 0;
}

//----- (000136C4) --------------------------------------------------------
unsigned int __fastcall sub_136C4(int a1)
{
  int v2; // edi
  int v3; // esi
  char v4; // ah
  int v5; // edi
  int v6; // ebx
  int v7; // edi
  int v8; // eax
  int v9; // eax
  int v10; // ebx
  int v12; // [esp+0h] [ebp-24h]
  int v13; // [esp+4h] [ebp-20h]
  int v14; // [esp+8h] [ebp-1Ch]

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = 0;
  v4 = *(_BYTE *)(v2 + 0xAB);
  v5 = v2 + 0xAB;
  if ( v4 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x2D8);
  }
  v6 = *(_DWORD *)(v5 + 1);
  v7 = *(_DWORD *)(v6 + 0x68);
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 2;
    v8 = sub_12AE4(a1, (P_Ship)v6);
    *(_DWORD *)(a1 + 0x4F44) = v8;
    *(_BYTE *)(v8 + 0x33) = 0x14;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(_DWORD *)(a1 + 0x4F80) = *(_DWORD *)(v6 + 0x9E);
    *(_DWORD *)(a1 + 0x4F84) = *(_DWORD *)(v6 + 0xA2);
    *(_DWORD *)(a1 + 0x4F88) = *(_DWORD *)(v6 + 0xA6);
    v9 = sub_12AE4(a1, (P_Ship)v7);
    *(_DWORD *)(a1 + 0x4F48) = v9;
    *(_BYTE *)(v9 + 0x33) = 0x14;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x34) = 1;
    *(_DWORD *)(a1 + 0x4F8C) = *(_DWORD *)(v7 + 0x9E);
    *(_DWORD *)(a1 + 0x4F90) = *(_DWORD *)(v7 + 0xA2);
    *(_DWORD *)(a1 + 0x4F94) = *(_DWORD *)(v7 + 0xA6);
  }
  v10 = *(_DWORD *)(a1 + 0x4F38);
  if ( v10 == 0x14 )
  {
    v12 = *(_DWORD *)(a1 + 0x4F8C);
    v13 = *(_DWORD *)(a1 + 0x4F90);
    v14 = *(_DWORD *)(a1 + 0x4F94);
    *(_DWORD *)(a1 + 0x4F8C) = *(_DWORD *)(a1 + 0x4F80);
    *(_DWORD *)(a1 + 0x4F90) = *(_DWORD *)(a1 + 0x4F84);
    *(_DWORD *)(a1 + 0x4F94) = *(_DWORD *)(a1 + 0x4F88);
    *(_DWORD *)(a1 + 0x4F80) = v12;
    *(_DWORD *)(a1 + 0x4F84) = v13;
    *(_DWORD *)(a1 + 0x4F88) = v14;
  }
  else if ( v10 == 0x29 )
  {
    return 0xFFFFFFFF;
  }
  return v3;
}

//----- (0001380C) --------------------------------------------------------
unsigned int __fastcall sub_1380C(int a1)
{
  int v2; // ecx
  int v3; // edi
  char v4; // ah
  int v5; // ecx
  int v6; // eax
  T_Ship *v7; // ebp
  int v8; // edx
  int v9; // eax
  int v10; // eax
  double v11; // st7
  int v12; // eax
  int v13; // edx
  int v14; // ebx
  _BYTE *v15; // eax
  int v17[3]; // [esp+0h] [ebp-30h] BYREF
  int v18; // [esp+Ch] [ebp-24h]
  int v19; // [esp+10h] [ebp-20h]
  char v20; // [esp+14h] [ebp-1Ch]

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = 0;
  v4 = *(_BYTE *)(v2 + 0xAB);
  v5 = v2 + 0xAB;
  if ( v4 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x30D);
  }
  v6 = *(_DWORD *)(v5 + 1);
  v19 = v6;
  if ( *(_BYTE *)(v6 + 0x67) != 2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x312);
  }
  v7 = *(T_Ship **)(v6 + 0x68);
  v17[0] = *(_DWORD *)(v6 + 0x78);
  v17[1] = *(_DWORD *)(v6 + 0x7C);
  v17[2] = *(_DWORD *)(v6 + 0x80);
  v8 = *(_DWORD *)(a1 + 0x4F38);
  v20 = **(_BYTE **)(v6 + 0x63);
  if ( !v8 )
  {
    *(_WORD *)(a1 + 0x5034) = 2;
    v9 = *(_DWORD *)(a1 + 0x1D2A);
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    *(_DWORD *)(a1 + 0x4F44) = v9 + 0x35;
    *(_BYTE *)(v9 + 0x35) = 7;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) = 0x12;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    v10 = v19 + 0x9E;
    *(float *)(a1 + 0x4F80) = *(float *)(v19 + 0x9E);
    *(_DWORD *)(a1 + 0x4F84) = *(_DWORD *)(v10 + 4);
    v11 = *(float *)(v10 + 8);
    v12 = 4 * v20;
    *(float *)(a1 + 0x4F88) = v11;
    v18 = a1 + v12;
    sub_1826C((P_Wnd4BM)a1, *(_DWORD *)(a1 + 0x4F44), *(_WORD *)(a1 + v12 + 0x1A92), 0);
    v13 = v18;
    *(_DWORD *)(a1 + 0x4F48) = sub_12AE4(a1, v7);
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(v13 + 0x1BCE));
  }
  v14 = *(_DWORD *)(a1 + 0x4F3C);
  if ( v14 )
  {
    *(_DWORD *)(a1 + 0x4F3C) = v14 + 1;
    if ( v14 + 1 > 0x14 )
    {
      return 0xFFFFFFFF;
    }
  }
  else if ( sub_12480((float *)(a1 + 0x4F80), (float *)v17, 40.0) == 0xFFFFFFFF )
  {
    v15 = *(_BYTE **)(a1 + 0x4F44);
    *(_DWORD *)(a1 + 0x4F3C) = 1;
    *v15 = 0xFF;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) |= 4u;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v20 + 0x1BD0));
  }
  return v3;
}

//----- (000139E0) --------------------------------------------------------
void __fastcall sub_139E0(int a1, int a2)
{
  switch ( *(_BYTE *)(a1 + 0x4F37) )
  {
    case 4:
      sub_13A28(a1, a2);
      break;
    case 5:
      sub_13AD8(a1, a2);
      break;
    case 7:
    case 0xA:
    case 0xC:
    case 0xD:
    case 0xE:
      sub_15630(a1, a2);
      break;
    default:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\batfx.cpp", 0x362);
      break;
  }
}

//----- (00013A28) --------------------------------------------------------
void __fastcall sub_13A28(int a1, int a2)
{
  double v3; // st7
  void *ShapeTable_sub_1B084; // eax
  LONG v5; // [esp-20h] [ebp-3Ch]
  LONG v6; // [esp-1Ch] [ebp-38h]
  LONG v7; // [esp-18h] [ebp-34h]
  LONG v8; // [esp-Ch] [ebp-28h]
  float v9; // [esp+8h] [ebp-14h]

  if ( *(_BYTE *)a2 != 2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x36B);
  }
  if ( *(int *)(a1 + 0x4F38) >= 0x14 )
  {
    v3 = (double)*(int *)(a1 + 0x4F38) + -20.0;
  }
  else
  {
    v3 = 20.0 - (double)*(int *)(a1 + 0x4F38);
  }
  v9 = v3 * 0.05;
  v8 = (int)((double)*(int *)(a2 + 0xF) * v9);
  v7 = *(__int16 *)(a2 + 0x29);
  v6 = *(__int16 *)(a2 + 0x27);
  v5 = *(_DWORD *)(a2 + 7);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a2 + 5));
  VFX_shape_transform((PANE *)(a1 + 4), ShapeTable_sub_1B084, v5, v6, v7, V_BigBuffer, 0, v8, v8, 0);
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (00013AD8) --------------------------------------------------------
void __fastcall sub_13AD8(int a1, int a2)
{
  void *ShapeTable_sub_1B084; // eax
  LONG v4; // [esp-20h] [ebp-44h]
  LONG v5; // [esp-1Ch] [ebp-40h]
  LONG v6; // [esp-18h] [ebp-3Ch]
  LONG v7; // [esp-8h] [ebp-2Ch]
  LONG width; // [esp+10h] [ebp-14h]
  int widtha; // [esp+10h] [ebp-14h]

  width = *(_DWORD *)(a1 + 0x4F3C);
  if ( width > 0xA )
  {
    width = 0x14 - width;
    sub_1826C((P_Wnd4BM)a1, a2, *(_WORD *)(a1 + 0x1B14), 2u);
  }
  v7 = *(_DWORD *)(a2 + 0xF);
  v6 = *(__int16 *)(a2 + 0x29);
  v5 = *(__int16 *)(a2 + 0x27);
  v4 = *(_DWORD *)(a2 + 7);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a2 + 5));
  VFX_shape_transform((PANE *)(a1 + 4), ShapeTable_sub_1B084, v4, v5, v6, V_BigBuffer, 0, v7, v7, 0);
  widtha = (int)((double)*(unsigned int *)(a2 + 0xF)
               * 0.0000152587890625
               * (double)((*(__int16 *)(a2 + 0x17) - *(__int16 *)(a2 + 0x13)) * width)
               * 0.050000001);
  VFX_ellipse_fill((PANE *)(a1 + 4), *(__int16 *)(a2 + 0x27), *(__int16 *)(a2 + 0x29), widtha, widtha, 0x96);
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (00013BC0) --------------------------------------------------------
void __fastcall __spoils<> Q_Vector3DCopy_sub_13BC0(P_Vector3D dst, P_Vector3D src)
{
  *dst = *src;
}

//----- (00013BF0) --------------------------------------------------------
void __fastcall __spoils<> Q_Vector3DCtor_sub_13BF0(P_Vector3D a1)
{
  a1->x = 0.0;
  a1->y = 0.0;
  a1->z = 0.0;
}

//----- (00013C10) --------------------------------------------------------
unsigned int __fastcall sub_13C10(int a1)
{
  int v2; // ecx
  char v3; // ah
  int v4; // ecx
  int v5; // ecx
  P_Ship v6; // ebp
  char v7; // al
  char v8; // bl
  int v9; // edi
  _BYTE *v10; // eax
  int v11; // kr0C_4
  P_Ship pShip; // edx
  int v13; // eax
  P_Ship v14; // ecx
  float *v15; // edx
  int v16; // eax
  T_Vector3D *p_vector; // edx
  int v18; // ebp
  int v19; // eax
  int v21; // eax
  double special1; // st7
  double v23; // st7
  int v24; // edi
  int v25; // ebx
  int v26; // kr04_4
  int v27; // edx
  int v28; // edx
  double v29; // st7
  double v30; // st7
  int v31; // edx
  P_Ship ships[107]; // [esp+8h] [ebp-238h] BYREF
  float v33; // [esp+1B4h] [ebp-8Ch]
  float v34; // [esp+1B8h] [ebp-88h]
  float v35; // [esp+1BCh] [ebp-84h]
  float v36; // [esp+1C0h] [ebp-80h]
  float v37; // [esp+1C4h] [ebp-7Ch]
  float v38; // [esp+1C8h] [ebp-78h]
  float v39; // [esp+1CCh] [ebp-74h] BYREF
  float v40; // [esp+1D0h] [ebp-70h]
  float v41; // [esp+1D4h] [ebp-6Ch]
  float v42; // [esp+1D8h] [ebp-68h] BYREF
  float v43; // [esp+1DCh] [ebp-64h]
  float v44; // [esp+1E0h] [ebp-60h]
  float x; // [esp+1E4h] [ebp-5Ch]
  float y; // [esp+1E8h] [ebp-58h]
  float z; // [esp+1ECh] [ebp-54h]
  float *v48; // [esp+1F0h] [ebp-50h]
  int v49; // [esp+1F4h] [ebp-4Ch]
  float v50; // [esp+1F8h] [ebp-48h]
  float *v51; // [esp+1FCh] [ebp-44h]
  int v52; // [esp+200h] [ebp-40h]
  float v53; // [esp+204h] [ebp-3Ch]
  int v54; // [esp+208h] [ebp-38h]
  int v55; // [esp+20Ch] [ebp-34h]
  int v56; // [esp+210h] [ebp-30h]
  float v57; // [esp+214h] [ebp-2Ch]
  float v58; // [esp+218h] [ebp-28h]
  float v59; // [esp+21Ch] [ebp-24h]
  int v60; // [esp+220h] [ebp-20h]
  char v61; // [esp+224h] [ebp-1Ch]

  v2 = *(_DWORD *)(a1 + 0xAB);
  v52 = 0;
  v3 = *(_BYTE *)(v2 + 0xAB);
  v4 = v2 + 0xAB;
  if ( v3 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x31);
  }
  v5 = *(_DWORD *)(v4 + 1);
  v6 = 0;
  v7 = **(_BYTE **)(v5 + 0x63);
  v54 = 1;
  v61 = v7;
  if ( v7 == 0x4A )
  {
    if ( *(_BYTE *)(v5 + 0x67) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x3A);
    }
    v6 = *(P_Ship *)(v5 + 0x68);
    v54 = 2;
  }
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    v8 = v61;
    v9 = sub_1D794(*(P_Location *)(v5 + 0x59), ships);
    *(_WORD *)(a1 + 0x5034) = 1;
    if ( v8 == 0x4A )
    {
      *(_WORD *)(a1 + 0x5034) = 2;
      *(_DWORD *)(a1 + 0x4F44) = sub_12AE4(a1, v6);
      v10 = (_BYTE *)(*(_DWORD *)(a1 + 0x1D2A) + 0x35);
      *(_DWORD *)(a1 + 0x4F48) = v10;
      *v10 = 7;
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) = 0x12;
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x34) = 1;
      *(_DWORD *)(a1 + 0x4F8C) = *(_DWORD *)(v5 + 0x9E);
      *(_DWORD *)(a1 + 0x4F90) = *(_DWORD *)(v5 + 0xA2);
      *(_DWORD *)(a1 + 0x4F94) = *(_DWORD *)(v5 + 0xA6);
      sub_1826C((P_Wnd4BM)a1, *(_DWORD *)(a1 + 0x4F48), *(_WORD *)(a1 + 4 * v61 + 0x1A92), 0);
      if ( v9 <= 0 )
      {
        goto LABEL_18;
      }
    }
    else
    {
      *(_DWORD *)(a1 + 0x4F44) = sub_12AE4(a1, *(P_Ship *)(v5 + 0x59));
      if ( v9 <= 0 )
      {
LABEL_18:
        v16 = v61;
        *(_DWORD *)(a1 + 0x4F3C) = 0;
        Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v16 + 0x1BCE));
        goto LABEL_19;
      }
    }
    v55 = a1 + 0x4F80;
    v56 = 4 * v9;
    v11 = 0;
    do
    {
      if ( *(__int16 *)(a1 + 0x5034) >= 0xF )
      {
        break;
      }
      pShip = ships[v11];
      if ( pShip->locationType == 4 && pShip != v6 )
      {
        v13 = sub_12AE4(a1, pShip);
        *(_BYTE *)(v13 + 0x33) |= 0x12u;
        *(_BYTE *)(v13 + 0x34) = *(_BYTE *)(a1 + 0x5034);
        v14 = ships[v11];
        v15 = (float *)(a1 + 0x4F80 + 0xC * *(char *)(v13 + 0x34));
        *v15 = v14->vector.x;
        v15[1] = v14->vector.y;
        v15[2] = v14->vector.z;
        LOWORD(v15) = *(_WORD *)(a1 + 0x5034);
        *(_WORD *)(a1 + 0x5034) = (_WORD)v15 + 1;
        *(_DWORD *)(a1 + 4 * (__int16)v15 + 0x4F44) = v13;
      }
      ++v11;
    }
    while ( 4 * v11 < v56 );
    goto LABEL_18;
  }
LABEL_19:
  p_vector = &v6->vector;
  v18 = *(_DWORD *)(a1 + 0x4F3C);
  if ( v18 )
  {
    if ( v18 == 1 )
    {
      *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) = *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) + 0.039999999;
      v19 = *(_DWORD *)(a1 + 0x4F44);
      dword_9A234 = 0;
      if ( *(float *)(v19 + 0xB) >= 2.0 )
      {
        *(_DWORD *)(a1 + 0x4F3C) = 2;
        return v52;
      }
    }
    else if ( v18 == 2 )
    {
      x = 0.0;
      y = 0.0;
      z = 0.0;
      if ( v61 == 0x4A )
      {
        x = p_vector->x;
        y = p_vector->y;
        z = p_vector->z;
      }
      v21 = v61;
      special1 = (double)V_Gizmos[v21].special1;
      v60 = 0x20 * V_Gizmos[v21].special2;
      v53 = special1;
      v50 = (float)v60;
      v23 = v53 - *(float *)&dword_9A234;
      v57 = v23;
      if ( v23 > 0.2 )
      {
        v57 = 0.2;
      }
      v24 = a1 + 0x4F80;
      v49 = 0xFFFFFFFF;
      v25 = v54;
      *(float *)&dword_9A234 = *(float *)&dword_9A234 + v57;
      v26 = 0;
      while ( v25 < *(__int16 *)(a1 + 0x5034) )
      {
        v28 = *(char *)(*(_DWORD *)(a1 + 4 * v54 + 4 * v26 + 0x4F44) + 0x34);
        v48 = &v39;
        v33 = 0.0;
        v34 = 0.0;
        v35 = 0.0;
        v33 = *(float *)(v24 + 0xC * v28) - x;
        v34 = *(float *)(v24 + 0xC * v28 + 4) - y;
        v35 = *(float *)(v24 + 0xC * v28 + 8) - z;
        v39 = v33;
        v40 = v34;
        v41 = v35;
        v29 = sqrt(v34 * v34 + v33 * v33 + v35 * v35);
        v58 = v29;
        if ( v29 > v50 )
        {
          v30 = v58 - v57 * 32.0;
          v59 = v30;
          if ( v30 >= v50 )
          {
            v49 = 0;
          }
          else
          {
            v59 = v50;
          }
          v27 = 0xC * v28;
          sub_53054(&v39, v59);
          v51 = &v42;
          v36 = x + v39;
          v42 = v36;
          v37 = y + v40;
          v43 = v37;
          v38 = z + v41;
          v44 = v38;
          *(float *)(v27 + v24) = v36;
          *(float *)(v27 + v24 + 4) = v43;
          *(float *)(v27 + v24 + 8) = v44;
        }
        ++v25;
        ++v26;
      }
      if ( *(float *)&dword_9A234 >= (double)v53 || v49 == 0xFFFFFFFF )
      {
        *(_DWORD *)(a1 + 0x4F3C) = 3;
        return v52;
      }
    }
    else
    {
      *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) = *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) + -0.039999999;
      v31 = *(_DWORD *)(a1 + 0x4F44);
      if ( *(float *)(v31 + 0xB) <= 1.0 )
      {
        *(_DWORD *)(v31 + 0xB) = 0x3F800000;
        return 0xFFFFFFFF;
      }
    }
  }
  else
  {
    if ( v61 == 0x4A )
    {
      if ( sub_12480((float *)(a1 + 0x4F8C), &p_vector->x, 10.0) != 0xFFFFFFFF )
      {
        sub_12618(*(_DWORD *)(a1 + 0x4F48));
        return v52;
      }
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) |= 8u;
    }
    *(_DWORD *)(a1 + 0x4F3C) = 1;
  }
  return v52;
}
// 9A234: using guessed type int dword_9A234;

//----- (00014224) --------------------------------------------------------
unsigned int __fastcall sub_14224(int a1)
{
  int v2; // edi
  int v3; // esi
  char v4; // ah
  int v5; // edi
  T_Ship *v6; // edx
  signed __int8 gizmoIndex; // bl
  int v8; // eax
  int v9; // eax

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = 0;
  v4 = *(_BYTE *)(v2 + 0xAB);
  v5 = v2 + 0xAB;
  if ( v4 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0xCC);
  }
  v6 = *(T_Ship **)(v5 + 1);
  gizmoIndex = v6->pHullCell->gizmoIndex;
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 1;
    v8 = sub_12AE4(a1, v6);
    *(_DWORD *)(a1 + 0x4F44) = v8;
    *(_BYTE *)(v8 + 0x33) |= 4u;
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    *(_DWORD *)(a1 + 0x4F40) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * gizmoIndex + 0x1BCE));
  }
  v9 = *(_DWORD *)(a1 + 0x4F38);
  *(_DWORD *)(a1 + 0x4F40) += v9 & 1;
  if ( v9 == 0x24 )
  {
    return 0xFFFFFFFF;
  }
  return v3;
}

//----- (000142D8) --------------------------------------------------------
int __fastcall sub_142D8(int a1)
{
  int v2; // esi
  char v3; // ah
  int v4; // esi
  int v5; // ebx
  int v6; // edx
  int v7; // eax
  double v8; // st7
  int v9; // edx
  double v10; // st7
  double v11; // st6
  float v13; // [esp+8h] [ebp-40h] BYREF
  float v14; // [esp+Ch] [ebp-3Ch]
  float v15; // [esp+10h] [ebp-38h]
  float v16; // [esp+14h] [ebp-34h]
  float v17; // [esp+18h] [ebp-30h]
  float v18; // [esp+1Ch] [ebp-2Ch]
  float *v19; // [esp+20h] [ebp-28h]
  float v20; // [esp+24h] [ebp-24h]
  float v21; // [esp+28h] [ebp-20h]
  float v22; // [esp+2Ch] [ebp-1Ch]
  char v23; // [esp+30h] [ebp-18h]

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = *(_BYTE *)(v2 + 0xAB);
  v4 = v2 + 0xAB;
  if ( v3 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0xF5);
  }
  v5 = *(_DWORD *)(v4 + 1);
  v6 = *(_DWORD *)(a1 + 0x4F38);
  v23 = **(_BYTE **)(v5 + 0x63);
  if ( !v6 )
  {
    *(_WORD *)(a1 + 0x5034) = 1;
    v7 = sub_12AE4(a1, (P_Ship)v5);
    *(_DWORD *)(a1 + 0x4F44) = v7;
    *(_BYTE *)(v7 + 0x33) |= 0x12u;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(float *)(a1 + 0x4F80) = *(float *)(v5 + 0x9E);
    *(_DWORD *)(a1 + 0x4F84) = *(_DWORD *)(v5 + 0xA2);
    *(_DWORD *)(a1 + 0x4F88) = *(_DWORD *)(v5 + 0xA6);
    v16 = 0.0;
    v17 = 0.0;
    v18 = 0.0;
    v19 = &v13;
    v16 = -*(float *)(v5 + 0x9E);
    v17 = -*(float *)(v5 + 0xA2);
    v8 = -*(float *)(v5 + 0xA6);
    v13 = v16;
    v18 = v8;
    v14 = v17;
    v15 = v18;
    *(float *)(a1 + 0x4F8C) = v16;
    *(float *)(a1 + 0x4F90) = v14;
    *(float *)(a1 + 0x4F94) = v15;
    v9 = v23;
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v9 + 0x1BCE));
  }
  v10 = *(float *)(a1 + 0x4F90) * *(float *)(a1 + 0x4F90) + *(float *)(a1 + 0x4F8C) * *(float *)(a1 + 0x4F8C);
  v11 = *(float *)(a1 + 0x4F94) * *(float *)(a1 + 0x4F94);
  v22 = 0.0;
  v21 = sqrt(v10 + v11);
  v20 = sqrt(
          *(float *)(a1 + 0x4F84) * *(float *)(a1 + 0x4F84)
        + *(float *)(a1 + 0x4F80) * *(float *)(a1 + 0x4F80)
        + *(float *)(a1 + 0x4F88) * *(float *)(a1 + 0x4F88));
  if ( v21 > 1.0 )
  {
    v22 = (v21 - v20) * 96.0 / v21;
  }
  if ( v22 < 3.2 )
  {
    v22 = 3.2;
  }
  return sub_12480((float *)(a1 + 0x4F80), (float *)(a1 + 0x4F8C), v22);
}

//----- (00014490) --------------------------------------------------------
int __fastcall sub_14490(int a1)
{
  int v2; // esi
  char v3; // ah
  int v4; // esi
  int v5; // esi
  _DWORD *v6; // ebx
  int v7; // eax
  float v9; // [esp+0h] [ebp-1Ch]
  char v10; // [esp+4h] [ebp-18h]

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = *(_BYTE *)(v2 + 0xAB);
  v4 = v2 + 0xAB;
  if ( v3 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x127);
  }
  v5 = *(_DWORD *)(v4 + 1);
  if ( *(_BYTE *)(v5 + 0x67) != 2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x12B);
  }
  v6 = *(_DWORD **)(v5 + 0x68);
  v10 = **(_BYTE **)(v5 + 0x63);
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 1;
    v7 = sub_12AE4(a1, (P_Ship)v5);
    *(_DWORD *)(a1 + 0x4F44) = v7;
    *(_BYTE *)(v7 + 0x33) |= 0x12u;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(_DWORD *)(a1 + 0x4F80) = *(_DWORD *)(v5 + 0x9E);
    *(_DWORD *)(a1 + 0x4F84) = *(_DWORD *)(v5 + 0xA2);
    *(_DWORD *)(a1 + 0x4F88) = *(_DWORD *)(v5 + 0xA6);
    *(_DWORD *)(a1 + 0x4F8C) = v6[5];
    *(_DWORD *)(a1 + 0x4F90) = v6[6];
    *(_DWORD *)(a1 + 0x4F94) = v6[7];
    if ( *(_DWORD *)(v5 + 0x59) == *v6 )
    {
      *(_DWORD *)(a1 + 0x4F8C) = v6[2];
      *(_DWORD *)(a1 + 0x4F90) = v6[3];
      *(_DWORD *)(a1 + 0x4F94) = v6[4];
    }
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v10 + 0x1BCE));
  }
  v9 = (double)*(int *)(a1 + 0x4F38) * 3.2;
  return sub_12480((float *)(a1 + 0x4F80), (float *)(a1 + 0x4F8C), v9);
}

//----- (000145C0) --------------------------------------------------------
unsigned int __fastcall sub_145C0(int a1)
{
  int v2; // ecx
  char v3; // ah
  int v4; // ecx
  int v5; // ecx
  T_Ship *v6; // edi
  char v7; // bl
  int v8; // eax
  _BYTE *v9; // eax
  int v10; // eax
  int v11; // eax
  int v12; // edi
  int v14; // ebx
  int v15; // [esp+0h] [ebp-1Ch]

  v2 = *(_DWORD *)(a1 + 0xAB);
  v15 = 0;
  v3 = *(_BYTE *)(v2 + 0xAB);
  v4 = v2 + 0xAB;
  if ( v3 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x158);
  }
  v5 = *(_DWORD *)(v4 + 1);
  if ( *(_BYTE *)(v5 + 0x67) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x15C);
  }
  v6 = *(T_Ship **)(v5 + 0x68);
  v7 = **(_BYTE **)(v5 + 0x63);
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 3;
    v8 = sub_12AE4(a1, (P_Ship)v5);
    *(_DWORD *)(a1 + 0x4F44) = v8;
    *(_BYTE *)(v8 + 0x33) |= 4u;
    v9 = (_BYTE *)(*(_DWORD *)(a1 + 0x1D2A) + 0x35);
    *(_DWORD *)(a1 + 0x4F48) = v9;
    *v9 = 7;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) = 0x1A;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x34) = 1;
    *(_DWORD *)(a1 + 0x4F8C) = *(_DWORD *)(v5 + 0x9E);
    *(_DWORD *)(a1 + 0x4F90) = *(_DWORD *)(v5 + 0xA2);
    *(_DWORD *)(a1 + 0x4F94) = *(_DWORD *)(v5 + 0xA6);
    sub_1826C((P_Wnd4BM)a1, *(_DWORD *)(a1 + 0x4F48), *(_WORD *)(a1 + 4 * v7 + 0x1A92), 0);
    v10 = sub_12AE4(a1, v6);
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    *(_DWORD *)(a1 + 0x4F40) = 0;
    *(_DWORD *)(a1 + 0x4F4C) = v10;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v7 + 0x1BCE));
  }
  v11 = *(_DWORD *)(a1 + 0x4F3C);
  if ( !v11 )
  {
    v12 = (*(_DWORD *)(a1 + 0x4F38) & 1) + *(_DWORD *)(a1 + 0x4F40);
    *(_DWORD *)(a1 + 0x4F40) = v12;
    if ( v12 == 0x12 )
    {
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) &= ~4u;
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) &= ~8u;
      *(_DWORD *)(a1 + 0x4F3C) = 1;
      *(_DWORD *)(a1 + 0x4F40) = 0;
    }
    return v15;
  }
  if ( v11 != 1 )
  {
    v14 = (*(_DWORD *)(a1 + 0x4F38) & 1) + *(_DWORD *)(a1 + 0x4F40);
    *(_DWORD *)(a1 + 0x4F40) = v14;
    if ( v14 == 0x12 )
    {
      return 0xFFFFFFFF;
    }
    return v15;
  }
  if ( sub_12480((float *)(a1 + 0x4F8C), &v6->vector.x, 20.0) == 0xFFFFFFFF )
  {
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) |= 8u;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F4C) + 0x33) |= 4u;
    *(_DWORD *)(a1 + 0x4F3C) = 2;
  }
  else
  {
    sub_12618(*(_DWORD *)(a1 + 0x4F48));
  }
  return 0;
}

//----- (000147CC) --------------------------------------------------------
unsigned int __fastcall sub_147CC(int a1)
{
  int v2; // edi
  char v3; // ah
  int v4; // edi
  int v5; // ecx
  int v6; // edx
  int v7; // ebp
  int v8; // eax
  int v9; // eax
  double v10; // st7
  double v11; // st7
  int v12; // edx
  float *v13; // edx
  double v14; // st7
  float v16; // [esp+4h] [ebp-84h]
  int v17[3]; // [esp+8h] [ebp-80h] BYREF
  float v18; // [esp+14h] [ebp-74h] BYREF
  float v19; // [esp+18h] [ebp-70h]
  float v20; // [esp+1Ch] [ebp-6Ch]
  float v21; // [esp+20h] [ebp-68h] BYREF
  float v22; // [esp+24h] [ebp-64h]
  float v23; // [esp+28h] [ebp-60h]
  float v24; // [esp+2Ch] [ebp-5Ch]
  float v25; // [esp+30h] [ebp-58h]
  float v26; // [esp+34h] [ebp-54h]
  float v27; // [esp+38h] [ebp-50h]
  float v28; // [esp+3Ch] [ebp-4Ch]
  float v29; // [esp+40h] [ebp-48h]
  float v30; // [esp+44h] [ebp-44h]
  float v31; // [esp+48h] [ebp-40h]
  float v32; // [esp+4Ch] [ebp-3Ch]
  float *v33; // [esp+50h] [ebp-38h]
  int *v34; // [esp+54h] [ebp-34h]
  T_Gizmo *v35; // [esp+58h] [ebp-30h]
  int v36; // [esp+5Ch] [ebp-2Ch]
  int v37; // [esp+60h] [ebp-28h]
  float v38; // [esp+64h] [ebp-24h]
  float *v39; // [esp+68h] [ebp-20h]
  int v40; // [esp+6Ch] [ebp-1Ch]

  v2 = *(_DWORD *)(a1 + 0xAB);
  v37 = 0;
  v3 = *(_BYTE *)(v2 + 0xAB);
  v4 = v2 + 0xAB;
  if ( v3 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x1AC);
  }
  v5 = *(_DWORD *)(v4 + 1);
  if ( *(_BYTE *)(v5 + 0x67) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x1B0);
  }
  v6 = **(char **)(v5 + 0x63);
  v35 = &V_Gizmos[v6];
  v7 = *(_DWORD *)(v5 + 0x68);
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    v8 = *(_DWORD *)(a1 + 0x1D2A);
    *(_WORD *)(a1 + 0x5034) = 2;
    *(_DWORD *)(a1 + 0x4F44) = v8 + 0x35;
    *(_BYTE *)(v8 + 0x35) = 7;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) |= 0x12u;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(float *)(a1 + 0x4F80) = *(float *)(v5 + 0x9E);
    *(float *)(a1 + 0x4F84) = *(float *)(v5 + 0xA2);
    *(float *)(a1 + 0x4F88) = *(float *)(v5 + 0xA6);
    v36 = a1 + 4 * v6;
    sub_1826C((P_Wnd4BM)a1, *(_DWORD *)(a1 + 0x4F44), *(_WORD *)(v36 + 0x1A92), 0);
    v9 = sub_12AE4(a1, (P_Ship)v7);
    *(_DWORD *)(a1 + 0x4F48) = v9;
    *(_BYTE *)(v9 + 0x33) |= 0x12u;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x34) = 1;
    *(float *)(a1 + 0x4F8C) = *(float *)(v7 + 0x9E);
    *(_DWORD *)(a1 + 0x4F90) = *(_DWORD *)(v7 + 0xA2);
    *(_DWORD *)(a1 + 0x4F94) = *(_DWORD *)(v7 + 0xA6);
    v39 = &v18;
    v30 = 0.0;
    v31 = 0.0;
    v32 = 0.0;
    v30 = *(float *)(a1 + 0x4F8C) - *(float *)(a1 + 0x4F80);
    v31 = *(float *)(a1 + 0x4F90) - *(float *)(a1 + 0x4F84);
    v10 = *(float *)(a1 + 0x4F94) - *(float *)(a1 + 0x4F88);
    v18 = v30;
    v32 = v10;
    v19 = v31;
    v20 = v32;
    *(float *)(a1 + 0x4F98) = v30;
    *(float *)(a1 + 0x4F9C) = v19;
    *(float *)(a1 + 0x4FA0) = v20;
    v40 = 0x20 * v35->special1;
    v16 = (float)v40;
    sub_53054((float *)(a1 + 0x4F98), v16);
    v24 = 0.0;
    v25 = 0.0;
    v26 = 0.0;
    v33 = &v21;
    v24 = *(float *)(a1 + 0x4F8C) + *(float *)(a1 + 0x4F98);
    v25 = *(float *)(a1 + 0x4F90) + *(float *)(a1 + 0x4F9C);
    v11 = *(float *)(a1 + 0x4F94) + *(float *)(a1 + 0x4FA0);
    v21 = v24;
    v26 = v11;
    v22 = v25;
    v23 = v26;
    *(float *)(a1 + 0x4F98) = v24;
    *(float *)(a1 + 0x4F9C) = v22;
    *(float *)(a1 + 0x4FA0) = v23;
    v12 = v36;
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(v12 + 0x1BCE));
  }
  v13 = (float *)(a1 + 0x4F8C);
  if ( *(_DWORD *)(a1 + 0x4F3C) )
  {
    v34 = v17;
    v27 = 0.0;
    v28 = 0.0;
    v29 = 0.0;
    v27 = *(float *)(a1 + 0x4F98) - *v13;
    v28 = *(float *)(a1 + 0x4F9C) - *(float *)(a1 + 0x4F90);
    v29 = *(float *)(a1 + 0x4FA0) - *(float *)(a1 + 0x4F94);
    *(float *)v17 = v27;
    *(float *)&v17[1] = v28;
    *(float *)&v17[2] = v29;
    v14 = sqrt(v28 * v28 + v27 * v27 + v29 * v29) * 0.050000001;
    v38 = v14;
    if ( v14 >= 3.2 )
    {
      if ( v38 > 50.0 )
      {
        v38 = 50.0;
      }
    }
    else
    {
      v38 = 3.2;
    }
    if ( sub_12480((float *)(a1 + 0x4F8C), (float *)(a1 + 0x4F98), v38) == 0xFFFFFFFF )
    {
      return 0xFFFFFFFF;
    }
  }
  else
  {
    sub_12618(*(_DWORD *)(a1 + 0x4F44));
    if ( sub_12480((float *)(a1 + 0x4F80), v13, 50.0) == 0xFFFFFFFF )
    {
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) |= 8u;
      *(_DWORD *)(a1 + 0x4F3C) = 1;
    }
  }
  return v37;
}

//----- (00014B18) --------------------------------------------------------
unsigned int __fastcall sub_14B18(int a1, int a2, int a3)
{
  int v4; // ecx
  char v5; // ah
  int v6; // ecx
  int v7; // ecx
  T_Ship *v8; // ebp
  int v9; // edi
  _BYTE *v10; // eax
  char v11; // bl
  int v12; // kr04_4
  T_Ship *v13; // edx
  int v14; // eax
  char *v15; // ecx
  float *v16; // edx
  char v17; // bh
  int v18; // eax
  T_Vector3D *p_vector; // edx
  int v20; // ebp
  int v21; // eax
  int v23; // edi
  int v24; // ecx
  int v25; // kr0C_4
  int v26; // edx
  int v27; // edx
  double v28; // st7
  int v29; // ecx
  float v30; // [esp+4h] [ebp-228h]
  void *v31[107]; // [esp+8h] [ebp-224h] BYREF
  float v32; // [esp+1B4h] [ebp-78h]
  float v33; // [esp+1B8h] [ebp-74h]
  float v34; // [esp+1BCh] [ebp-70h]
  float v35; // [esp+1C0h] [ebp-6Ch]
  float v36; // [esp+1C4h] [ebp-68h]
  float v37; // [esp+1C8h] [ebp-64h]
  float v38; // [esp+1CCh] [ebp-60h] BYREF
  float v39; // [esp+1D0h] [ebp-5Ch]
  float v40; // [esp+1D4h] [ebp-58h]
  float v41; // [esp+1D8h] [ebp-54h] BYREF
  float v42; // [esp+1DCh] [ebp-50h]
  float v43; // [esp+1E0h] [ebp-4Ch]
  float x; // [esp+1E4h] [ebp-48h]
  float y; // [esp+1E8h] [ebp-44h]
  float z; // [esp+1ECh] [ebp-40h]
  int v47; // [esp+1F0h] [ebp-3Ch]
  float *v48; // [esp+1F4h] [ebp-38h]
  float special1; // [esp+1F8h] [ebp-34h]
  float *v50; // [esp+1FCh] [ebp-30h]
  int v51; // [esp+200h] [ebp-2Ch]
  int v52; // [esp+204h] [ebp-28h]
  int v53; // [esp+208h] [ebp-24h]
  float v54; // [esp+20Ch] [ebp-20h]
  char v55; // [esp+210h] [ebp-1Ch]

  v4 = *(_DWORD *)(a1 + 0xAB);
  v51 = 0;
  v5 = *(_BYTE *)(v4 + 0xAB);
  v6 = v4 + 0xAB;
  if ( v5 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x1F9);
  }
  v7 = *(_DWORD *)(v6 + 1);
  v8 = (T_Ship *)v7;
  v55 = **(_BYTE **)(v7 + 0x63);
  if ( v55 == 0x28 )
  {
    if ( *(_BYTE *)(v7 + 0x67) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x201);
    }
    v8 = *(T_Ship **)(v7 + 0x68);
  }
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    v9 = sub_1D794(*(P_Location *)(v7 + 0x59), (P_Ship *)v31);
    *(_WORD *)(a1 + 0x5034) = 2;
    *(_DWORD *)(a1 + 0x4F44) = sub_12AE4(a1, v8);
    v10 = (_BYTE *)(*(_DWORD *)(a1 + 0x1D2A) + 0x35);
    *(_DWORD *)(a1 + 0x4F48) = v10;
    v11 = v55;
    *v10 = 0xFF;
    if ( v11 == 0x28 )
    {
      **(_BYTE **)(a1 + 0x4F48) = 7;
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) = 0x12;
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x34) = 1;
      *(_DWORD *)(a1 + 0x4F8C) = *(_DWORD *)(v7 + 0x9E);
      *(_DWORD *)(a1 + 0x4F90) = *(_DWORD *)(v7 + 0xA2);
      *(_DWORD *)(a1 + 0x4F94) = *(_DWORD *)(v7 + 0xA6);
      sub_1826C((P_Wnd4BM)a1, *(_DWORD *)(a1 + 0x4F48), *(_WORD *)(a1 + 4 * v55 + 0x1A92), 0);
    }
    if ( v9 > 0 )
    {
      v47 = a1 + 0x4F80;
      v53 = 4 * v9;
      v12 = 0;
      do
      {
        if ( *(__int16 *)(a1 + 0x5034) >= 0xF )
        {
          break;
        }
        v13 = (T_Ship *)v31[v12];
        if ( v13->locationType == 4 && v13 != v8 )
        {
          v14 = sub_12AE4(a1, v13);
          *(_BYTE *)(v14 + 0x33) |= 0x12u;
          *(_BYTE *)(v14 + 0x34) = *(_BYTE *)(a1 + 0x5034);
          v15 = (char *)v31[v12];
          v16 = (float *)(a1 + 0x4F80 + 0xC * *(char *)(v14 + 0x34));
          *v16 = *(float *)(v15 + 0x9E);
          v16[1] = *(float *)(v15 + 0xA2);
          v16[2] = *(float *)(v15 + 0xA6);
          LOWORD(v16) = *(_WORD *)(a1 + 0x5034);
          *(_WORD *)(a1 + 0x5034) = (_WORD)v16 + 1;
          *(_DWORD *)(a1 + 4 * (__int16)v16 + 0x4F44) = v14;
        }
        ++v12;
      }
      while ( 4 * v12 < v53 );
    }
    v17 = v55;
    *(_DWORD *)(a1 + 0x4F3C) = 1;
    if ( v17 == 0x28 )
    {
      *(_DWORD *)(a1 + 0x4F3C) = 0;
    }
    v18 = v55;
    *(_DWORD *)(a1 + 0x4F40) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v18 + 0x1BCE));
    dword_9A238 = 0;
  }
  p_vector = &v8->vector;
  v20 = *(_DWORD *)(a1 + 0x4F3C);
  if ( v20 )
  {
    if ( v20 == 1 )
    {
      v21 = *(_DWORD *)(a1 + 0x4F44);
      *(_DWORD *)(a1 + 0x4F40) += *(_DWORD *)(a1 + 0x4F38) & 1;
      *(_BYTE *)(v21 + 0x33) |= 4u;
      if ( *(_DWORD *)(a1 + 0x4F40) == 9 )
      {
        *(_DWORD *)(a1 + 0x4F3C) = 2;
        return v51;
      }
    }
    else if ( v20 == 2 )
    {
      x = p_vector->x;
      y = p_vector->y;
      z = p_vector->z;
      v23 = a1 + 0x4F80;
      v24 = 2;
      special1 = (float)V_Gizmos[v55].special1;
      v52 = 0xFFFFFFFF;
      *(float *)&dword_9A238 = *(float *)&dword_9A238 + 0.2;
      v25 = 0;
      while ( v24 < *(__int16 *)(a1 + 0x5034) )
      {
        v27 = *(char *)(*(_DWORD *)(a1 + 8 + 4 * v25 + 0x4F44) + 0x34);
        v48 = &v38;
        v32 = 0.0;
        v33 = 0.0;
        v34 = 0.0;
        v32 = *(float *)(v23 + 0xC * v27) - x;
        v33 = *(float *)(v23 + 0xC * v27 + 4) - y;
        v34 = *(float *)(v23 + 0xC * v27 + 8) - z;
        v38 = v32;
        v39 = v33;
        v40 = v34;
        v28 = sqrt(v33 * v33 + v32 * v32 + v34 * v34) * 0.03125 + 0.2;
        v54 = v28;
        if ( v28 < special1 )
        {
          v52 = 0;
        }
        else
        {
          v54 = special1;
        }
        v26 = 0xC * v27;
        v30 = v54 * 32.0;
        sub_53054(&v38, v30);
        v50 = &v41;
        v35 = x + v38;
        v41 = v35;
        v36 = y + v39;
        v42 = v36;
        v37 = z + v40;
        v43 = v37;
        *(float *)(v26 + v23) = v35;
        *(float *)(v26 + v23 + 4) = v42;
        ++v24;
        *(float *)(v26 + v23 + 8) = v43;
        ++v25;
      }
      if ( *(float *)&dword_9A238 >= (double)special1 || v52 == 0xFFFFFFFF )
      {
        *(_DWORD *)(a1 + 0x4F3C) = 3;
        return v51;
      }
    }
    else
    {
      v29 = (*(_DWORD *)(a1 + 0x4F38) & 1) + *(_DWORD *)(a1 + 0x4F40);
      *(_DWORD *)(a1 + 0x4F40) = v29;
      if ( v29 == 0x12 )
      {
        return 0xFFFFFFFF;
      }
    }
  }
  else
  {
    sub_12618(*(_DWORD *)(a1 + 0x4F48));
    if ( sub_12480((float *)(a1 + 0x4F8C), &p_vector->x, 10.0) == 0xFFFFFFFF )
    {
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) |= 8u;
      *(_DWORD *)(a1 + 0x4F3C) = 1;
    }
  }
  return v51;
}
// 9A238: using guessed type int dword_9A238;
// 14B18: using guessed type P_Ship var_224[107];

//----- (00015078) --------------------------------------------------------
unsigned int __fastcall sub_15078(int a1)
{
  int v2; // edi
  int v3; // esi
  char v4; // ah
  int v5; // edi
  T_Ship *v6; // edx
  signed __int8 gizmoIndex; // bl
  int v8; // eax

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = 0;
  v4 = *(_BYTE *)(v2 + 0xAB);
  v5 = v2 + 0xAB;
  if ( v4 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x283);
  }
  v6 = *(T_Ship **)(v5 + 1);
  gizmoIndex = v6->pHullCell->gizmoIndex;
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 1;
    v8 = sub_12AE4(a1, v6);
    *(_DWORD *)(a1 + 0x4F44) = v8;
    *(_BYTE *)(v8 + 0x33) |= 4u;
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    *(_DWORD *)(a1 + 0x4F40) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * gizmoIndex + 0x1BCE));
  }
  if ( *(_DWORD *)(a1 + 0x4F3C) )
  {
    *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) = *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) + -0.039999999;
    if ( *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) < 0.04 )
    {
      return 0xFFFFFFFF;
    }
  }
  else
  {
    *(_DWORD *)(a1 + 0x4F40) += (*(_BYTE *)(a1 + 0x4F38) & 3) == 0;
    if ( *(_DWORD *)(a1 + 0x4F40) == 9 )
    {
      *(_DWORD *)(a1 + 0x4F3C) = 1;
    }
  }
  return v3;
}

//----- (00015164) --------------------------------------------------------
unsigned int __fastcall sub_15164(int a1)
{
  int v2; // ecx
  unsigned int v3; // edi
  char v4; // ah
  int v5; // ecx
  int v6; // ebx
  int v7; // eax
  _BYTE *v8; // eax
  int v9; // ebp
  int v10; // edx

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = 0;
  v4 = *(_BYTE *)(v2 + 0xAB);
  v5 = v2 + 0xAB;
  if ( v4 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x2B5);
  }
  v6 = *(_DWORD *)(v5 + 1);
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 2;
    v7 = sub_12AE4(a1, (P_Ship)v6);
    *(_DWORD *)(a1 + 0x4F44) = v7;
    *(_BYTE *)(v7 + 0x33) |= 4u;
    v8 = (_BYTE *)(*(_DWORD *)(a1 + 0x1D2A) + 0x35);
    *(_DWORD *)(a1 + 0x4F48) = v8;
    *v8 = 0xFF;
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    *(_DWORD *)(a1 + 0x4F40) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 0x1CEE));
  }
  v9 = *(_DWORD *)(a1 + 0x4F3C);
  if ( v9 )
  {
    if ( v9 == 1 )
    {
      if ( (*(_BYTE *)(a1 + 0x4F38) & 3) == 0 && sub_12618(*(_DWORD *)(a1 + 0x4F48)) == 0xFFFFFFFF )
      {
        v3 = 0xFFFFFFFF;
      }
      *(_DWORD *)(*(_DWORD *)(a1 + 0x4F48) + 0xB) = 0x40A00000;
    }
  }
  else
  {
    v10 = (*(_DWORD *)(a1 + 0x4F38) & 1) + *(_DWORD *)(a1 + 0x4F40);
    *(_DWORD *)(a1 + 0x4F40) = v10;
    if ( v10 == 9 )
    {
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) |= 8u;
      **(_BYTE **)(a1 + 0x4F48) = 7;
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) |= 0x10u;
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x34) = 1;
      *(float *)(a1 + 0x4F8C) = *(float *)(v6 + 0x9E);
      *(_DWORD *)(a1 + 0x4F90) = *(_DWORD *)(v6 + 0xA2);
      *(_DWORD *)(a1 + 0x4F94) = *(_DWORD *)(v6 + 0xA6);
      sub_1826C((P_Wnd4BM)a1, *(_DWORD *)(a1 + 0x4F48), *(_WORD *)(a1 + 0x1BB2), 0);
      *(_DWORD *)(*(_DWORD *)(a1 + 0x4F48) + 0xB) = 0x40A00000;
      *(_DWORD *)(a1 + 0x4F3C) = 1;
      return 0;
    }
  }
  return v3;
}

//----- (000152E4) --------------------------------------------------------
unsigned int __fastcall sub_152E4(int a1, int a2, int a3, int a4)
{
  int v5; // esi
  char v6; // ah
  int v7; // esi
  int v8; // ebx
  _BYTE *v9; // eax
  int v10; // edx
  int v11; // eax
  int v12; // esi
  int v13; // edx
  int v14; // kr04_4
  int v15; // eax
  int v16; // ebp
  int v17; // kr00_4
  int v18; // edx
  int v19; // ebx
  char *v20; // ebx
  _BYTE *v21; // eax
  int v23; // eax
  unsigned __int16 v24; // si
  char v25; // al
  int v26; // eax
  void *v27[107]; // [esp+0h] [ebp-1DCh] BYREF
  T_Gizmo *v28; // [esp+1ACh] [ebp-30h]
  int v29; // [esp+1B0h] [ebp-2Ch]
  int v30; // [esp+1B4h] [ebp-28h]
  int v31; // [esp+1B8h] [ebp-24h]
  int v32; // [esp+1BCh] [ebp-20h]
  char v33; // [esp+1C0h] [ebp-1Ch]

  v5 = *(_DWORD *)(a1 + 0xAB);
  v29 = 0;
  v6 = *(_BYTE *)(v5 + 0xAB);
  v7 = v5 + 0xAB;
  if ( v6 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x2FA);
  }
  v30 = *(_DWORD *)(v7 + 1);
  v8 = *(_DWORD *)(a1 + 0x4F38);
  v33 = 0x26;
  v28 = &V_Gizmos[0x26];
  if ( !v8 )
  {
    *(_WORD *)(a1 + 0x5034) = 1;
    v9 = *(_BYTE **)(a1 + 0x1D2A);
    *(_DWORD *)(a1 + 0x4F44) = v9;
    *v9 = 0xFF;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) |= 0x12u;
    v10 = v30 + 0x9E;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(_DWORD *)(a1 + 0x4F80) = *(_DWORD *)v10;
    *(_DWORD *)(a1 + 0x4F84) = *(_DWORD *)(v10 + 4);
    *(float *)(a1 + 0x4F88) = *(float *)(v10 + 8);
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 0x1C66));
  }
  if ( **(_BYTE **)(a1 + 0x4F44) == 0xFF )
  {
    v11 = sub_1D794(*(P_Location *)(v30 + 0x59), (P_Ship *)v27);
    v12 = (unsigned __int8)*(_DWORD *)(a1 + 0x4F3C);
    v13 = v11;
    if ( v12 < v11 )
    {
      v15 = v12;
      v16 = *(__int16 *)(v30 + 0x56);
      v31 = 4 * v13;
      v17 = 4 * v12;
      v14 = 0;
      while ( 1 )
      {
        v18 = *(int *)((char *)&v27[v14] + v17);
        v19 = *(__int16 *)(v18 + 0x56);
        if ( *(_BYTE *)(v18 + 0x58) == 4 && v16 != v19 && V_Game.races[v16].Unknown_1C0[v19] == 2 )
        {
          break;
        }
        ++v12;
        ++v14;
        if ( v17 + 4 * v14 >= v31 )
        {
          goto LABEL_15;
        }
      }
      *(_WORD *)(a1 + 0x5034) = 2;
      v20 = (char *)v27[v15];
      *(_DWORD *)(a1 + 0x4F8C) = *(_DWORD *)(v20 + 0x9E);
      *(_DWORD *)(a1 + 0x4F90) = *(_DWORD *)(v20 + 0xA2);
      *(_DWORD *)(a1 + 0x4F94) = *(_DWORD *)(v20 + 0xA6);
      **(_BYTE **)(a1 + 0x4F44) = 7;
      *(_DWORD *)(a1 + 0x4F48) = sub_12AE4(a1, (P_Ship)v27[v15]);
      sub_1826C((P_Wnd4BM)a1, *(_DWORD *)(a1 + 0x4F44), *(_WORD *)(a1 + 4 * v33 + 0x1A92), 0);
      *(_DWORD *)(a1 + 0x4F3C) = v12 + 1;
    }
LABEL_15:
    if ( **(_BYTE **)(a1 + 0x4F44) == 0xFF )
    {
      v29 = 0xFFFFFFFF;
    }
  }
  v21 = *(_BYTE **)(a1 + 0x4F44);
  if ( *v21 == 0xFF )
  {
    return 0xFFFFFFFF;
  }
  if ( (*(_BYTE *)(a1 + 0x4F3D) & 1) != 0 )
  {
    if ( (*(_BYTE *)(a1 + 0x4F38) & 3) == 0 && sub_12618((int)v21) == 0xFFFFFFFF )
    {
      **(_BYTE **)(a1 + 0x4F44) = 0xFF;
      *(_DWORD *)(a1 + 0x4F3C) = (unsigned __int8)*(_DWORD *)(a1 + 0x4F3C);
      return v29;
    }
  }
  else
  {
    sub_12618((int)v21);
    if ( sub_12480((float *)(a1 + 0x4F80), (float *)(a1 + 0x4F8C), 50.0) == 0xFFFFFFFF )
    {
      v23 = *(_DWORD *)(a1 + 0x4F48);
      LOWORD(v32) = 1;
      v24 = 4;
      v25 = sub_4B7A0(*(_DWORD *)(v23 + 1), 0, v28->special1, *(_WORD *)(v30 + 0x56));
      if ( (v25 & 4) != 0 )
      {
        v26 = *(_DWORD *)(a1 + 0x4F48);
        LOWORD(v32) = 5;
        v24 = 5;
        *(_BYTE *)(v26 + 0x33) |= 8u;
      }
      else if ( (v25 & 2) != 0 )
      {
        v24 = *(_WORD *)(a1 + 4 * v33 + 0x1A94);
        LOWORD(v32) = *(_WORD *)(a1 + 4 * v33 + 0x1BD0);
      }
      sub_1826C((P_Wnd4BM)a1, *(_DWORD *)(a1 + 0x4F44), v24, 0);
      Q_StartSample_sub_4FB90(&V_SoundSystem, v32);
      *(_BYTE *)(a1 + 0x4F3D) |= 1u;
    }
  }
  return v29;
}
// 152E4: using guessed type P_Ship var_1DC[107];

//----- (00015630) --------------------------------------------------------
void __fastcall sub_15630(int a1, int a2)
{
  int v3; // eax
  void *ShapeTable_sub_1B084; // eax
  LONG v5; // [esp-20h] [ebp-30h]
  LONG v6; // [esp-1Ch] [ebp-2Ch]
  LONG v7; // [esp-18h] [ebp-28h]
  LONG v8; // [esp-8h] [ebp-18h]

  v3 = *(_DWORD *)(a1 + 0x4F40);
  if ( v3 > 9 )
  {
    v3 = 0x12 - v3;
  }
  if ( v3 >= 0 )
  {
    if ( v3 > 9 )
    {
      v3 = 9;
    }
  }
  else
  {
    v3 = 0;
  }
  VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[v3 + 0xB]);
  v8 = *(_DWORD *)(a2 + 0xF);
  v7 = *(__int16 *)(a2 + 0x29);
  v6 = *(__int16 *)(a2 + 0x27);
  v5 = *(_DWORD *)(a2 + 7);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a2 + 5));
  VFX_shape_transform((PANE *)(a1 + 4), ShapeTable_sub_1B084, v5, v6, v7, V_BigBuffer, 0, v8, v8, 1);
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (000156C0) --------------------------------------------------------
void __fastcall sub_156C0(int a1, int a2, unsigned __int16 shpNum)
{
  void *ShapeTable_sub_1B084; // ebp
  RECT rect; // [esp+0h] [ebp-24h] BYREF
  int v6; // [esp+10h] [ebp-14h]

  v6 = a2;
  *(_DWORD *)(a1 + 0xB) = 0x3F800000;
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v6);
  if ( shpNum >= VFX_shape_count(ShapeTable_sub_1B084) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x38);
  }
  VFX_shape_visible_rectangle(ShapeTable_sub_1B084, shpNum, 0, 0, 0, &rect);
  if ( rect.x0 > 1000000 || rect.x0 < -1000000 )
  {
    memset(&rect, 0, sizeof(rect));
  }
  *(_WORD *)(a1 + 0x13) = rect.x0;
  *(_WORD *)(a1 + 0x15) = rect.y0;
  *(_WORD *)(a1 + 0x17) = rect.x1;
  *(_WORD *)(a1 + 0x19) = rect.y1;
  *(_WORD *)(a1 + 5) = v6;
  *(_DWORD *)(a1 + 7) = shpNum;
}

//----- (0001577C) --------------------------------------------------------
void __fastcall __spoils<> sub_1577C(int a1)
{
  sub_15788(a1);
}

//----- (00015788) --------------------------------------------------------
void __fastcall __spoils<> sub_15788(int result)
{
  *(_DWORD *)(result + 0x800) = 0;
}

//----- (00015794) --------------------------------------------------------
int __fastcall sub_15794(int result, int a2)
{
  int v2; // ebx

  v2 = *(_DWORD *)(result + 0x800);
  if ( v2 < 0x200 )
  {
    if ( a2 )
    {
      *(_DWORD *)(result + 4 * v2) = a2;
      ++*(_DWORD *)(result + 0x800);
    }
  }
  return result;
}

//----- (000157B4) --------------------------------------------------------
int __fastcall sub_157B4(const void *a1, const void *a2)
{
  int v2; // edx
  float v4; // [esp+0h] [ebp-8h]
  float v5; // [esp+4h] [ebp-4h]

  v5 = *(float *)(*(_DWORD *)a1 + 0x2F);
  v4 = *(float *)(*(_DWORD *)a2 + 0x2F);
  v2 = 0;
  if ( v5 > (double)v4 )
  {
    return 0xFFFFFFFF;
  }
  if ( v5 < (double)v4 )
  {
    return 1;
  }
  return v2;
}

//----- (000157EC) --------------------------------------------------------
void __fastcall sub_157EC(size_t *a1)
{
  qsort(a1, a1[0x200], 4u, sub_157B4);
}

//----- (00015808) --------------------------------------------------------
char *__fastcall sub_15808(int a1, int a2, int a3)
{
  int i; // edi
  int v4; // ecx
  float v6; // [esp+Ch] [ebp-24h]
  float v7; // [esp+10h] [ebp-20h]
  float v8; // [esp+18h] [ebp-18h]
  float v9; // [esp+1Ch] [ebp-14h]
  float v10; // [esp+20h] [ebp-10h]

  for ( i = *(_DWORD *)(a1 + 0x800) - 1; (i & 0x8000u) == 0; LOWORD(i) = i - 1 )
  {
    if ( !(a1 + 4 * i) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x9E);
    }
    v4 = *(_DWORD *)(a1 + 4 * i);
    if ( *(char *)v4 >= 9 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0xA2);
    }
    if ( *(_BYTE *)v4 == 5 )
    {
      if ( (*(__int16 *)(v4 + 0x27) - a2) * (*(__int16 *)(v4 + 0x27) - a2) + (*(__int16 *)(v4 + 0x29) - a3) * (*(__int16 *)(v4 + 0x29) - a3) < 0x50 )
      {
        return *(char **)(a1 + 4 * i);
      }
    }
    else if ( *(_BYTE *)v4 != 4 )
    {
      v7 = (double)*(unsigned int *)(v4 + 0xF) * 0.000015258789;
      v6 = (float)*(__int16 *)(v4 + 0x27);
      v8 = (float)a2;
      if ( (double)*(__int16 *)(v4 + 0x13) * v7 + v6 <= v8 )
      {
        v10 = (float)*(__int16 *)(v4 + 0x29);
        v9 = (float)a3;
        if ( (double)*(__int16 *)(v4 + 0x15) * v7 + v10 <= v9
          && (double)*(__int16 *)(v4 + 0x17) * v7 + v6 >= v8
          && (double)*(__int16 *)(v4 + 0x19) * v7 + v10 >= v9 )
        {
          return *(char **)(a1 + 4 * i);
        }
      }
    }
  }
  return 0;
}

//----- (00015948) --------------------------------------------------------
int __fastcall sub_15948(int a1, int a2)
{
  PANE *v2; // ebp
  int i; // kr04_4
  unsigned int v4; // eax
  LONG v5; // eax
  int v6; // edx
  int v7; // edi
  __int64 v8; // rax
  double v9; // st7
  void *ShapeTable_sub_1B084; // eax
  double v11; // st6
  int result; // eax
  _BYTE *v13; // esi
  LONG v14; // [esp-20h] [ebp-88h]
  LONG v15; // [esp-1Ch] [ebp-84h]
  LONG v16; // [esp-18h] [ebp-80h]
  LONG v17; // [esp-8h] [ebp-70h]
  int v18; // [esp-4h] [ebp-6Ch]
  int v20; // [esp+Ch] [ebp-5Ch]
  int v21; // [esp+18h] [ebp-50h]
  float v23; // [esp+20h] [ebp-48h]
  int v24; // [esp+24h] [ebp-44h]
  int v26; // [esp+30h] [ebp-38h]
  __int16 v27; // [esp+40h] [ebp-28h]
  int v28; // [esp+4Ah] [ebp-1Eh]

  v27 = 0;
  v2 = (PANE *)(a2 + 4);
  for ( i = 0; ; ++i )
  {
    result = v27;
    if ( v27 >= *(_DWORD *)(a1 + 0x800) )
    {
      break;
    }
    v13 = *(_BYTE **)a1;
    if ( (**(_BYTE **)a1 != 4 || *(_DWORD *)(a2 + 0x504A)) && *v13 != 0xFF )
    {
      if ( *(_DWORD *)(v13 + 0x23) && (*(_DWORD *)(a2 + 0x5042) || *v13 == 6) && (v13[0x33] & 2) == 0 )
      {
        v4 = 0xFFFFFFFF;
      }
      else
      {
        v4 = 0;
      }
      if ( v4 )
      {
        v5 = 0x72;
        if ( *(_DWORD *)(v13 + 0x1F) )
        {
          v5 = 0x90;
        }
        if ( *v13 == 6 && *(_BYTE *)(a2 + 0xB7) == 3 )
        {
          v5 = 0xF3;
        }
        VFX_line_draw(v2, *(__int16 *)(v13 + 0x2B), *(__int16 *)(v13 + 0x2D), *(__int16 *)(v13 + 0x27), *(__int16 *)(v13 + 0x29), 0, v5);
      }
      if ( (v13[0x33] & 8) == 0 )
      {
        if ( (v13[0x33] & 4) != 0 )
        {
          sub_139E0(a2, (int)v13);
        }
        else
        {
          v6 = *(unsigned __int16 *)(v13 + 5);
          if ( (unsigned __int16)v6 != 0xFFFF )
          {
            if ( *v13 == 8 )
            {
              v26 = v13[0x33] & 4;
              v7 = *(_DWORD *)(v13 + 1);
              v24 = v26;
              v8 = *(__int16 *)(v13 + 0x27) - *(__int16 *)(v7 + 0x27);
              v20 = (HIDWORD(v8) ^ v8) - HIDWORD(v8);
              if ( v20 )
              {
                v9 = 2.5 / (double)(2 * v20);
                v26 = (int)((double)v20 * v9 + 0.5);
                v24 = (int)(v9 * (double)v20 + 0.5);
              }
              VFX_line_draw(
                v2,
                v26 + *(__int16 *)(v13 + 0x27),
                v24 + *(__int16 *)(v13 + 0x29),
                v26 + *(__int16 *)(v7 + 0x27),
                v24 + *(__int16 *)(v7 + 0x29),
                0,
                0x6A);
              VFX_line_draw(
                v2,
                *(__int16 *)(v13 + 0x27) - v26,
                *(__int16 *)(v13 + 0x29) - v24,
                *(__int16 *)(v7 + 0x27) - v26,
                *(__int16 *)(v7 + 0x29) - v24,
                0,
                0x6A);
              VFX_line_draw(
                v2,
                *(__int16 *)(v13 + 0x27),
                *(__int16 *)(v13 + 0x29),
                *(__int16 *)(v7 + 0x27),
                *(__int16 *)(v7 + 0x29),
                0,
                0x6D);
            }
            else
            {
              v18 = v13[0x33] & 4;
              v17 = *(_DWORD *)(v13 + 0xF);
              v16 = *(__int16 *)(v13 + 0x29);
              v15 = *(__int16 *)(v13 + 0x27);
              v14 = *(_DWORD *)(v13 + 7);
              ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, v6);
              VFX_shape_transform(v2, ShapeTable_sub_1B084, v14, v15, v16, V_BigBuffer, v18, v17, v17, v18);
            }
          }
        }
      }
      v23 = (double)*(unsigned int *)(v13 + 0xF) * 0.000015258789;
      if ( *v13 == 1 && sub_361B8(*(T_Planet **)(v13 + 1)) == 0xFFFFFFFF )
      {
        v21 = (int)((double)*(__int16 *)(v13 + 0x17) * v23 + 2.0);
        VFX_ellipse_draw(
          v2,
          *(__int16 *)(v13 + 0x27),
          *(__int16 *)(v13 + 0x29),
          (__int16)v21,
          (__int16)v21,
          4 * V_Game.races[*(unsigned __int8 *)(*(_DWORD *)(v13 + 1) + 0x57)].Unknown_02 + 0x13);
      }
      if ( v13 == *(_BYTE **)(a2 + 0xB3) )
      {
        v11 = (double)*(__int16 *)(v13 + 0x27);
        HIWORD(v28) = (int)((double)*(__int16 *)(v13 + 0x13) * v23 + v11);
        sub_2BB74(
          v2,
          v28 >> 0x10,
          (__int16)(int)((double)*(__int16 *)(v13 + 0x15) * v23 + (double)*(__int16 *)(v13 + 0x29)),
          (__int16)(int)(v11 + (double)*(__int16 *)(v13 + 0x17) * v23),
          (__int16)(int)(v23 * (double)*(__int16 *)(v13 + 0x19) + (double)*(__int16 *)(v13 + 0x29)),
          0xF3u,
          0);
      }
    }
    ++v27;
  }
  return result;
}
// 15C73: variable 'v28' is possibly undefined
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (00015D20) --------------------------------------------------------
void __fastcall __spoils<> sub_15D20(int a1)
{
  sub_15D2C(a1);
}

//----- (00015D2C) --------------------------------------------------------
void __fastcall __spoils<> sub_15D2C(int result)
{
  *(_DWORD *)(result + 0x1900) = 0;
}

//----- (00015D38) --------------------------------------------------------
int __fastcall sub_15D38(int result, const void *a2)
{
  int v2; // ebx
  int v4; // edx

  v2 = result;
  v4 = *(_DWORD *)(result + 0x1900);
  if ( v4 < 0x40 )
  {
    result = 0x64 * v4;
    qmemcpy((void *)(v2 + 0x64 * v4), a2, 0x64u);
    ++*(_DWORD *)(v2 + 0x1900);
  }
  return result;
}

//----- (00015D74) --------------------------------------------------------
int __fastcall sub_15D74(int result, int a2)
{
  int v2; // esi
  int i; // ecx

  v2 = result;
  for ( i = 0; i < *(_DWORD *)(v2 + 0x1900); ++i )
  {
    result = sub_15DA4(v2, a2, i);
  }
  return result;
}

//----- (00015DA4) --------------------------------------------------------
int __fastcall sub_15DA4(int result, int a2, unsigned __int16 a3)
{
  int v3; // ecx
  int v4; // eax

  if ( a3 < *(int *)(result + 0x1900) )
  {
    v3 = *(_DWORD *)(result + 0x64 * a3 + 0x60);
    if ( v3 < 0 || v3 >= 7 )
    {
      v4 = 0;
    }
    else
    {
      v4 = V_Game.races[v3].Unknown_02 + 1;
    }
    return sub_62DA5((WINDOW *)(a2 + 4), 4, v4 + 0x64 * a3, (v4 << 8) + 0x1F00 + *(_DWORD *)(a2 + 0x19BE));
  }
  return result;
}

//----- (00015E1C) --------------------------------------------------------
void __usercall sub_15E1C(int *a1@<eax>, int a2@<edx>, int a3@<esi>)
{
  int v4; // kr04_4
  int i; // kr0C_4
  int v6; // eax
  int v7; // edi
  int v9; // [esp+4h] [ebp-20h]
  int parm; // [esp+Ch] [ebp-18h]

  v9 = 0;
  v4 = 0;
  for ( i = 0; v9 < a1[0x640]; ++v4 )
  {
    v6 = a1[0x19 * v4 + 0x18];
    if ( v6 < 0 || v6 >= 7 )
    {
      parm = 0x6D;
    }
    else
    {
      parm = 4 * V_Game.races[v6].Unknown_02 + 0x13;
    }
    v7 = 0;
    do
    {
      ++v7;
      VFX_line_draw(
        (PANE *)(a2 + 4),
        *(_DWORD *)(a3 + 0x18 * i),
        *(_DWORD *)(a3 + 0x18 * i + 4),
        a1[0x19 * v4 + 6 * (v7 & 3)],
        a1[0x19 * v4 + 1 + 6 * (v7 & 3)],
        0,
        parm);
      ++i;
    }
    while ( v7 < 4 );
    ++v9;
  }
  JUMPOUT(0x15ED0);
}
// 15ECF: control flows out of bounds to 15ED0

//----- (00015ED4) --------------------------------------------------------
void __fastcall __spoils<> Q_Wnd4BMCtor_sub_15ED4(P_Wnd4BM a1)
{
  Q_A2Ctor_sub_2C830(&a1->a);
  _wcpp_2_ctor_array_(a1->vectors1, 100u, &C_Vector3D);
  _wcpp_2_ctor_array_(a1->someFloats, 100u, &C_Type16);
  _wcpp_2_ctor_array_(a1->vectors2, 100u, &C_Vector3D);
  a1->Unknown_1D0A[0] = 0;
  a1->Unknown_1D0A[1] = 0;
  a1->Unknown_1D0A[2] = 0;
  a1->Unknown_1D22 = 0;
  a1->Unknown_1D26 = 0;
  a1->Unknown_1D1E = 0;
  sub_1577C((int)a1->Unknown_1D36);
  sub_1577C((int)a1->Unknown_253A);
  sub_1577C((int)a1->Unknown_2D3E);
  sub_15D20((int)a1->Unknown_3542);
  sub_1B4F0(&a1->Wnd9RW1);
  a1->vector_4EDE.x = 0.0;
  a1->vector_4EDE.y = 0.0;
  a1->vector_4EDE.z = 0.0;
  a1->matrix_4EEA.vector1.x = 0.0;
  a1->matrix_4EEA.vector1.y = 0.0;
  a1->matrix_4EEA.vector1.z = 0.0;
  a1->matrix_4EEA.vector2.x = 0.0;
  a1->matrix_4EEA.vector2.y = 0.0;
  a1->matrix_4EEA.vector2.z = 0.0;
  a1->matrix_4EEA.vector3.x = 0.0;
  a1->matrix_4EEA.vector3.y = 0.0;
  a1->matrix_4EEA.vector3.z = 0.0;
  a1->matrix_4EEA.vector1.y = 0.0;
  a1->matrix_4EEA.vector1.z = 0.0;
  a1->matrix_4EEA.vector1.x = 1.0;
  a1->matrix_4EEA.vector2.x = 0.0;
  a1->matrix_4EEA.vector2.y = 1.0;
  a1->matrix_4EEA.vector2.z = 0.0;
  a1->matrix_4EEA.vector3.x = 0.0;
  a1->matrix_4EEA.vector3.y = 0.0;
  a1->matrix_4EEA.vector3.z = 1.0;
  _wcpp_2_ctor_array_(a1->vectors3, 15u, &C_Vector3D);
  a1->a.procs = &Wnd4BM_Procs;
  sub_16120(a1);
}

//----- (0001604C) --------------------------------------------------------
P_Wnd4BM __fastcall Q_Wnd4BMDtor_sub_1604C(P_Wnd4BM a1, char a2)
{
  char *v4; // eax
  void *Unknown_19BE; // edx
  char *v7; // eax
  T_Vector3D *v8; // eax
  P_TypeA2 v9; // eax
  P_TypeA2 v10; // ebx

  if ( (a2 & 4) != 0 )
  {
    v4 = _wcpp_2_dtor_array_store_(a1, &C_Wnd4BM);
    operator delete[](v4);
    return a1;
  }
  else
  {
    Unknown_19BE = a1->Unknown_19BE;
    a1->a.procs = &Wnd4BM_Procs;
    if ( Unknown_19BE )
    {
      sub_2627C(Unknown_19BE);
    }
    operator delete[](a1->Unknown_19BE);
    v7 = (char *)sub_1A9C0(a1->vectors3) + 0xFFFFFEC6;
    Q_Ret_sub_1B66C();
    sub_15D2C((int)(v7 + 0xFFFFE6FC));
    sub_15788((int)(v7 + 0xFFFFDEF8));
    sub_15788((int)(v7 + 0xFFFFD6F4));
    sub_15788((int)(v7 + 0xFFFFCEF0));
    Q_DestructVectors_sub_1A9E0((P_Vector3D)(v7 + 0xFFFFC6C8));
    v8 = (T_Vector3D *)((char *)sub_1AA00(v7 + 0xFFFFB728) + 0xFFFFFB50);
    Q_DestructVectors_sub_1A9E0(v8);
    v9 = Q_A2Dtor_sub_2C848((P_TypeA2)((char *)&v8[0xFFFFFFF0].x + 2), 1);
    v10 = v9;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v9);
    }
    return (P_Wnd4BM)v10;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (00016120) --------------------------------------------------------
int __fastcall sub_16120(P_Wnd4BM a1)
{
  int i; // kr04_4
  FILE *fp; // eax
  FILE *fp_; // ecx
  int v5; // eax
  int v6; // edi
  int k; // kr0C_4
  int j; // kr14_4
  char s[200]; // [esp+0h] [ebp-12Ch] BYREF
  char bufc[60]; // [esp+C8h] [ebp-64h] BYREF
  int bufi1; // [esp+104h] [ebp-28h] BYREF
  int bufi2; // [esp+108h] [ebp-24h] BYREF
  int bufi3; // [esp+10Ch] [ebp-20h] BYREF
  int bufi4; // [esp+110h] [ebp-1Ch] BYREF

  a1->Unknown_AB = 0;
  a1->Unknown_1D2A = 0;
  a1->Unknown_19BE = 0;
  for ( i = 0; i != 0x64; ++i )
  {
    a1->Unknown_137E[i] = 0;
  }
  a1->Unknown_1D1E = 0;
  a1->Unknown_1D22 = 0;
  a1->Unknown_1D26 = 0;
  a1->Unknown_B3 = 0;
  a1->Unknown_AF = 0;
  a1->Unknown_B7 = 0;
  a1->backgroundColor = 0;
  a1->cursorShape = 2;
  a1->Unknown_BC = 0xFFFF;
  a1->Unknown_4F2F = 0;
  a1->Unknown_4F33 = 0;
  a1->Unknown_503A = 0xFFFFFFFF;
  a1->Unknown_5042 = 0xFFFFFFFF;
  a1->Unknown_5046 = 0xFFFFFFFF;
  a1->Unknown_504A = 0xFFFFFFFF;
  fp = Q_OpenFile_sub_1BB10("batfx.txt", 0);
  fp_ = fp;
  if ( !fp )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x1E4);
  }
  Q_HELPWIN_CPP_FgetsLine_sub_2FE58(fp, s);
  // // here are the names
  // 81
  sscanf(s, "%d", &bufi1);
  v5 = bufi1;
  a1->batfxNamesNum = bufi1;
  if ( v5 >= 100 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x1EA);
  }
  v6 = 0;
  // SHP files
  if ( a1->batfxNamesNum > 0 )
  {
    k = 0;
    do
    {
      Q_HELPWIN_CPP_FgetsLine_sub_2FE58(fp_, s);
      sscanf(s, "%s", bufc);
      a1->Unknown_19C6[k] = sub_1B270(&WinMgr.t13, bufc, 0xFFFFFFFF);
      ++v6;
      ++k;
    }
    while ( v6 < a1->batfxNamesNum );
  }
  // // here are the gizmo vals
  // // shape1 shape2 sfx1 sfx2

  // // sfx #s refer to list in
  // // soundfx.txt
  for ( j = 0; j != 0x4F; ++j )
  {
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(fp_, s);
    sscanf(s, "%d %d %d %d", &bufi1, &bufi2, &bufi3, &bufi4);
    a1->gvShape[j].shape1 = bufi1;
    a1->gvShape[j].shape2 = bufi2;
    a1->gvSfx[j].sfx1 = bufi3;
    a1->gvSfx[j].sfx2 = bufi4;
  }
  return fclose(fp_);
}
// 16120: using guessed type char bufc[60];

//----- (00016348) --------------------------------------------------------
int __fastcall sub_16348(P_Wnd4BM a1, unsigned __int16 message, LONG param1, signed int param2)
{
  int result; // eax
  int index; // edx
  char v8; // ah
  int v9; // ebx
  int v10; // edx
  int v11; // edx
  T_Wnd4BM *v12; // eax
  int v13; // edx
  int Unknown_AB; // edx
  LONG x0; // ebx
  signed int y0; // esi
  int v18; // edi
  int v19; // ecx
  char Unknown_B7; // ah
  char *Unknown_AF; // edx
  char v22; // bl
  char v23; // al
  LONG v24; // edi
  int v25; // eax
  char Unknown_4F2F; // ah
  char v27; // ch
  char v28; // bl
  char v29; // dl
  char v30; // bl
  int v31; // edx
  char v32; // cl
  int v33; // edx
  int v34; // ecx
  int v35; // eax
  int v36; // edx
  int v37; // ebx
  int Unknown_B3; // eax
  int v39; // eax
  int v40; // [esp-4h] [ebp-24h]
  int v41; // [esp-4h] [ebp-24h]
  _BYTE v42[5]; // [esp+8h] [ebp-18h]

  if ( message < 0x3Au )
  {
    if ( message >= 6u )
    {
      if ( message <= 6u )
      {
        sub_5A270(&WinMgr, 0, 0, 0);
        sub_567BC(&WinMgr, a1->a.a1.index, 8);
        return 0xFFFFFFFF;
      }
      if ( message < 0xDu )
      {
        if ( message <= 7u )
        {
          if ( !WinMgr.wnds[dword_96BAC].a2 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x3B7);
          }
          sub_17260((int)a1);
          sub_56728(&WinMgr, a1->a.a1.index, 4, 8, 0, 0);
          return 0xFFFFFFFF;
        }
        if ( message != 8 )
        {
          return sub_2F424(&a1->a, message, param1, param2);
        }
        if ( a1->Unknown_B7 != 4 )
        {
          x0 = a1->a.a1.pane.x0;
          if ( param1 < x0 || param1 > a1->a.a1.pane.x1 || (y0 = a1->a.a1.pane.y0, param2 < y0) || param2 > a1->a.a1.pane.y1 )
          {
            a1->Unknown_AF = 0;
            a1->Unknown_1D0A[1] = 0x49742400;
            sub_18C2C(a1, 0);
            return 0;
          }
          if ( !a1->Unknown_4F2F )
          {
            v18 = param2 - y0;
            v19 = param1 - x0;
            sub_17204((int)a1, param1 - x0, v18);
            if ( !a1->Unknown_AF )
            {
              Unknown_B7 = a1->Unknown_B7;
              if ( Unknown_B7 == 2 )
              {
                sub_16FC0((int)a1, v19, v18, v19);
              }
              else if ( Unknown_B7 == 3 )
              {
                sub_171D0((int)a1, v19, v18);
              }
            }
            sub_18C2C(a1, 0);
            if ( a1->Unknown_B7 == 1 )
            {
              Unknown_AF = (char *)a1->Unknown_AF;
              if ( Unknown_AF )
              {
                v22 = *Unknown_AF;
                v23 = 0;
                if ( *Unknown_AF == 2 )
                {
                  v23 = 3;
                }
                else if ( v22 == 3 )
                {
                  v23 = 4;
                }
                else if ( v22 == 1 )
                {
                  v23 = 2;
                }
                v24 = 0x6B;
                if ( sub_56D30(&WinMgr, *(_DWORD *)(a1->Unknown_AB + 0x41), 0x322, v23, *(_DWORD *)(a1->Unknown_AF + 1)) == 0xFFFFFFFF )
                {
                  v24 = 0xF3;
                }
                VFX_line_draw(
                  &a1->a.a1.pane,
                  *(__int16 *)(a1->Unknown_B3 + 0x27),
                  *(__int16 *)(a1->Unknown_B3 + 0x29),
                  *(__int16 *)(a1->Unknown_AF + 0x27),
                  *(__int16 *)(a1->Unknown_AF + 0x29),
                  0,
                  v24);
                return 0;
              }
            }
          }
        }
      }
      else
      {
        if ( message > 0xDu )
        {
          if ( message < 0x32u || message > 0x33u && (message < 0x36u || message > 0x37u) )
          {
            return sub_2F424(&a1->a, message, param1, param2);
          }
          if ( a1->a.a1.j != 0xFFFFFFFF )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x2E5);
          }
          v25 = 0;
          if ( message == 0x32 )
          {
            Unknown_4F2F = a1->Unknown_4F2F;
            if ( (Unknown_4F2F & 1) != 0 )
            {
              if ( (Unknown_4F2F & 2) != 0 )
              {
                LOBYTE(a1->Unknown_4F2F) = Unknown_4F2F & 0xFD;
              }
              else
              {
                LOBYTE(a1->Unknown_4F2F) = Unknown_4F2F & 0xFE;
                sub_18C2C(a1, 0);
              }
            }
            else
            {
              LOBYTE(a1->Unknown_4F2F) = Unknown_4F2F & 0xFC | 1;
            }
            v25 = 3;
          }
          if ( message == 0x33 )
          {
            v27 = a1->Unknown_4F2F;
            if ( (v27 & 1) != 0 )
            {
              if ( (v27 & 2) != 0 )
              {
                LOBYTE(a1->Unknown_4F2F) = v27 & 0xFE;
                sub_18C2C(a1, 0);
              }
              else
              {
                LOBYTE(a1->Unknown_4F2F) = v27 | 2;
              }
            }
            else
            {
              LOBYTE(a1->Unknown_4F2F) = v27 | 3;
            }
            v25 = 3;
          }
          if ( message == 0x36 )
          {
            v28 = a1->Unknown_4F2F;
            if ( (v28 & 4) != 0 )
            {
              if ( (v28 & 8) != 0 )
              {
                LOBYTE(a1->Unknown_4F2F) = v28 & 0xF7;
              }
              else
              {
                LOBYTE(a1->Unknown_4F2F) = v28 & 0xFB;
              }
            }
            else
            {
              LOBYTE(a1->Unknown_4F2F) = v28 & 0xF3 | 4;
            }
            v25 = 0xC;
          }
          if ( message == 0x37 )
          {
            v29 = a1->Unknown_4F2F;
            if ( (v29 & 4) != 0 )
            {
              if ( (v29 & 8) != 0 )
              {
                LOBYTE(a1->Unknown_4F2F) = v29 & 0xFB;
              }
              else
              {
                LOBYTE(a1->Unknown_4F2F) = v29 | 8;
              }
            }
            else
            {
              LOBYTE(a1->Unknown_4F2F) = v29 | 0xC;
            }
            v25 = 0xC;
          }
          if ( param1 == 4 )
          {
            sub_56728(&WinMgr, a1->a.a1.index, 1, 0x3B, v25, 0);
          }
          return 0xFFFFFFFF;
        }
        if ( a1->Unknown_B7 != 4 )
        {
          sub_187EC(a1);
          sub_18C2C(a1, 0);
          return 0;
        }
      }
      return 0;
    }
    if ( message < 3u )
    {
      if ( !message )
      {
        return sub_2F424(&a1->a, message, param1, param2);
      }
      if ( message <= 1u )
      {
        a1->Unknown_AB = (int)Q_FindWnd_sub_56DA8(&WinMgr, "BatControlWnd", 0);
        index = a1->a.a1.index;
        sub_56400(&WinMgr, index, 0x3A, 0, 0, 0);
        sub_186B8(a1, index, param1);
        sub_2F424(&a1->a, message, param1, param2);
        a1->Unknown_4F2F = 0;
        return 0;
      }
      else
      {
        if ( a1->Unknown_B7 == 4 )
        {
          sub_12238(a1->Unknown_AB, 0);
        }
        sub_564C0(&WinMgr, a1->a.a1.index, 0xFFFFFFFF);
        sub_185CC((int)a1);
        sub_2F424(&a1->a, message, param1, param2);
        return 0;
      }
    }
    if ( message <= 3u )
    {
      if ( (unsigned int)param2 < 0xD )
      {
        if ( param2 != 0xC )
        {
          return 0;
        }
        if ( WinMgr.j > 0.1 )
        {
          WinMgr.j = WinMgr.j * 0.8;
          return 0;
        }
      }
      else if ( (unsigned int)param2 <= 0xD )
      {
        if ( WinMgr.j < 10.0 )
        {
          WinMgr.j = WinMgr.j * 1.25;
          return 0;
        }
      }
      else if ( (unsigned int)param2 >= 0x1C )
      {
        if ( (unsigned int)param2 > 0x1C && param2 != 0x39 )
        {
          return 0;
        }
        if ( a1->Unknown_B7 == 4 )
        {
          *(_DWORD *)&a1->Unknown_4F80[2] = 0xFFFFFFFF;
        }
      }
      return 0;
    }
    if ( message > 4u )
    {
      if ( a1->Unknown_B7 == 4 )
      {
        result = 0xFFFFFFFF;
        *(_DWORD *)&a1->Unknown_4F80[2] = 0xFFFFFFFF;
        return result;
      }
      if ( param1 >= a1->a.a1.pane.x0 && param1 <= a1->a.a1.pane.x1 && param2 >= a1->a.a1.pane.y0 && param2 <= a1->a.a1.pane.y1 )
      {
        Q_StartSample_sub_4FB90(&V_SoundSystem, 0);
        if ( a1->Unknown_AF )
        {
          sub_16D6C(a1, param1, param2, 0);
        }
        else if ( a1->Unknown_B3 )
        {
          v41 = a1->Unknown_AF;
          Unknown_AB = a1->Unknown_AB;
          a1->Unknown_B3 = 0;
          sub_56D30(&WinMgr, *(_DWORD *)(Unknown_AB + 0x41), 0x320, 0, v41);
          a1->Unknown_B7 = 0;
        }
        sub_18C2C(a1, 0);
        sub_17260((int)a1);
        return 0xFFFFFFFF;
      }
      return 0;
    }
    if ( a1->Unknown_B7 == 4 )
    {
      return 0xFFFFFFFF;
    }
    if ( param1 < a1->a.a1.pane.x0 || param1 > a1->a.a1.pane.x1 || param2 < a1->a.a1.pane.y0 || param2 > a1->a.a1.pane.y1 )
    {
      return 0;
    }
    Q_StartSample_sub_4FB90(&V_SoundSystem, 0);
    if ( a1->Unknown_AF )
    {
      sub_16D6C(a1, param1, param2, 1);
    }
    else
    {
      v8 = a1->Unknown_B7;
      if ( v8 == 2 )
      {
        if ( (unsigned __int16)a1->Unknown_BC == 0xFFFF )
        {
          a1->Unknown_B7 = 0;
        }
        else
        {
          v9 = param2 - a1->a.a1.pane.y0;
          v10 = param1 - a1->a.a1.pane.x0;
          a1->Unknown_B7 = 3;
          sub_171D0((int)a1, v10, v9);
        }
      }
      else
      {
        if ( v8 == 3 )
        {
          v11 = a1->Unknown_AB;
          a1->Unknown_B7 = 0;
          sub_56D30(&WinMgr, *(_DWORD *)(v11 + 0x41), 0x326, 5, (int)a1->Unknown_1D0A);
          a1->Unknown_B3 = 0;
          sub_187EC(a1);
          v12 = a1;
LABEL_43:
          sub_18C2C(v12, 0);
          return 0xFFFFFFFF;
        }
        if ( v8 )
        {
          return 0xFFFFFFFF;
        }
        v40 = a1->Unknown_AF;
        v13 = a1->Unknown_AB;
        a1->Unknown_B3 = 0;
        sub_56D30(&WinMgr, *(_DWORD *)(v13 + 0x41), 0x320, 0, v40);
      }
    }
    v12 = a1;
    goto LABEL_43;
  }
  if ( message <= 0x3Au )
  {
    v30 = a1->Unknown_4F2F;
    if ( (v30 & 1) != 0 )
    {
      if ( (v30 & 2) != 0 )
      {
        v31 = 2;
      }
      else
      {
        v31 = -2u;
      }
      sub_17E50(a1, v31);
    }
    v32 = a1->Unknown_4F2F;
    if ( (v32 & 4) != 0 )
    {
      if ( (v32 & 8) != 0 )
      {
        v33 = 10;
      }
      else
      {
        v33 = -10;
      }
      sub_182B8(a1, v33);
    }
    if ( (a1->Unknown_4F2F & 5) != 0 )
    {
      goto LABEL_123;
    }
    return 0;
  }
  if ( message < 0x4Cu )
  {
    if ( message >= 0x47u )
    {
      if ( message <= 0x47u )
      {
        a1->Unknown_4F2F = 0;
        sub_17F54(a1);
        sub_18C2C(a1, 0);
        return 0xFFFFFFFF;
      }
      else
      {
        if ( message < 0x4Au )
        {
          return sub_2F424(&a1->a, message, param1, param2);
        }
        if ( message <= 0x4Au )
        {
          a1->Unknown_503A = ~a1->Unknown_503A;
          sub_18C2C(a1, 0);
        }
        return 0;
      }
    }
    if ( message <= 0x3Bu )
    {
      a1->Unknown_4F2F &= ~param1;
      if ( (param1 & 1) != 0 )
      {
        sub_18C2C(a1, 0);
      }
      sub_567BC(&WinMgr, a1->a.a1.index, 0x3B);
      return 0xFFFFFFFF;
    }
    if ( message != 0x46 )
    {
      return sub_2F424(&a1->a, message, param1, param2);
    }
    return 0;
  }
  if ( message <= 0x4Cu )
  {
    v34 = ~a1->Unknown_5042;
    a1->Unknown_5046 = v34;
    a1->Unknown_5042 = v34;
    sub_18C2C(a1, 0);
    return 0;
  }
  if ( message < 0x52u )
  {
    if ( message < 0x50u )
    {
      return sub_2F424(&a1->a, message, param1, param2);
    }
    if ( message > 0x50u )
    {
      a1->Unknown_B7 = 1;
      return 0;
    }
    if ( param1 >= 1 && V_Game.pCurStar->planetsNum >= param1 )
    {
      V_Game.pCurPlanet = *(P_Planet *)&V_Game.pCurStar->Unknown_2C[4 * param1 + 0x16];
      sub_56B60(&WinMgr, 1, 0x11, 1);
      return 0;
    }
    return 0;
  }
  if ( message <= 0x52u )
  {
    sub_126F8((int)a1, param1, (int)a1);
    return 0;
  }
  if ( message <= 0x53u )
  {
    *(_DWORD *)v42 = *(_DWORD *)(a1->Unknown_AB + 0xAB);
    if ( !v42[0] )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x39A);
    }
    v42[4] = *(_BYTE *)(a1->Unknown_AB + 0xAF);
    v35 = sub_12AE4((int)a1, *(P_Ship *)&v42[1]);
    a1->Unknown_B3 = v35;
    v36 = *(__int16 *)(v35 + 0x27);
    if ( v36 < 0
      || (v37 = *(__int16 *)(v35 + 0x29), v37 < 0)
      || v36 > a1->a.a1.pane.x1 - a1->a.a1.pane.x0
      || v37 > a1->a.a1.pane.y1 - a1->a.a1.pane.y0 )
    {
      sub_17E88((float *)&a1->a.a1.magic12345678, a1->Unknown_B3);
    }
    Unknown_B3 = a1->Unknown_B3;
    if ( *(_BYTE *)Unknown_B3 == 2 )
    {
      v39 = *(_DWORD *)(Unknown_B3 + 1);
      if ( *(_WORD *)(v39 + 0x56) == V_RaceIndex && *(int *)(v39 + 0x88) > 0 )
      {
        a1->Unknown_B7 = 2;
      }
    }
LABEL_123:
    sub_18C2C(a1, 0);
    return 0;
  }
  if ( message != 0x54 )
  {
    return sub_2F424(&a1->a, message, param1, param2);
  }
  sub_172B0(a1);
  return 0;
}
// 96BAC: using guessed type int dword_96BAC;

//----- (00016D6C) --------------------------------------------------------
void __fastcall sub_16D6C(T_Wnd4BM *a1, int a2, int a3, int a4)
{
  unsigned int v5; // ebp
  char v6; // bh
  char v7; // al
  int v8; // edi
  int Unknown_AF; // eax
  char v10; // dl
  int v11; // eax
  char Unknown_B7; // ch
  int Unknown_B3; // ebx
  char v14; // bh
  int v15; // eax
  int Unknown_AB; // edx
  char v17; // al
  char v18; // ah

  if ( !a1->Unknown_AF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x3D7);
  }
  v5 = 0;
  if ( !a4 )
  {
    sub_17E88((float *)&a1->a.a1.magic12345678, a1->Unknown_AF);
    goto LABEL_32;
  }
  if ( a1->Unknown_B7 == 1 )
  {
    v6 = *(_BYTE *)a1->Unknown_AF;
    v7 = 0;
    switch ( v6 )
    {
      case 2:
        v7 = 3;
        break;
      case 1:
        v7 = 2;
        break;
      case 3:
        v7 = 4;
        break;
    }
    v8 = v7;
    if ( sub_56D30(&WinMgr, *(_DWORD *)(a1->Unknown_AB + 0x41), 0x322, v7, *(_DWORD *)(a1->Unknown_AF + 1)) == 0xFFFFFFFF )
    {
      a1->Unknown_B7 = 0;
      sub_56D30(&WinMgr, *(_DWORD *)(a1->Unknown_AB + 0x41), 0x326, v8, *(_DWORD *)(a1->Unknown_AF + 1));
      a1->Unknown_B3 = 0;
    }
  }
  else
  {
    Unknown_AF = a1->Unknown_AF;
    v10 = *(_BYTE *)Unknown_AF;
    if ( *(_BYTE *)Unknown_AF != 2 )
    {
      if ( v10 == 1 )
      {
        Unknown_B7 = a1->Unknown_B7;
        if ( Unknown_B7 != 2 && Unknown_B7 != 3 )
        {
          Unknown_B3 = a1->Unknown_B3;
          if ( Unknown_AF != Unknown_B3 || Unknown_B7 )
          {
            v5 = 0xFFFFFFFF;
            a1->Unknown_B3 = a1->Unknown_AF;
          }
          else
          {
            V_Game.pCurPlanet = *(P_Planet *)(Unknown_B3 + 1);
            a1->Unknown_AF = 0;
            sub_56B60(&WinMgr, 1, 0x11, 1);
          }
          goto LABEL_32;
        }
        a1->Unknown_B7 = 0;
        sub_56D30(&WinMgr, *(_DWORD *)(a1->Unknown_AB + 0x41), 0x326, 2, *(_DWORD *)(a1->Unknown_AF + 1));
      }
      else
      {
        if ( v10 != 3 )
        {
          goto LABEL_32;
        }
        v14 = a1->Unknown_B7;
        v15 = *(_DWORD *)(Unknown_AF + 1);
        if ( v14 != 2 && v14 != 3 )
        {
          goto LABEL_32;
        }
        Unknown_AB = a1->Unknown_AB;
        a1->Unknown_B7 = 0;
        sub_56D30(&WinMgr, *(_DWORD *)(Unknown_AB + 0x41), 0x326, 4, v15);
      }
      sub_187EC(a1);
      sub_18C2C(a1, 0);
      goto LABEL_32;
    }
    if ( !a1->Unknown_B7 )
    {
      a1->Unknown_B3 = Unknown_AF;
      v11 = *(_DWORD *)(Unknown_AF + 1);
      v5 = 0xFFFFFFFF;
      if ( *(_WORD *)(v11 + 0x56) == V_RaceIndex && *(int *)(v11 + 0x88) > 0 )
      {
        a1->Unknown_B7 = 2;
      }
    }
  }
LABEL_32:
  if ( v5 == 0xFFFFFFFF )
  {
    v17 = 0;
    v18 = *(_BYTE *)a1->Unknown_B3;
    if ( v18 == 2 )
    {
      v17 = 3;
    }
    else if ( v18 == 1 )
    {
      v17 = 2;
    }
    sub_56D30(&WinMgr, *(_DWORD *)(a1->Unknown_AB + 0x41), 0x320, v17, *(_DWORD *)(a1->Unknown_B3 + 1));
  }
  sub_17260((int)a1);
}

//----- (00016FC0) --------------------------------------------------------
void __fastcall sub_16FC0(int a1, int edx0, int a3, int a4)
{
  int v5; // eax
  double v6; // st7
  float a2; // [esp+0h] [ebp-90h]
  float v8; // [esp+4h] [ebp-8Ch]
  int v9; // [esp+8h] [ebp-88h]
  int v10; // [esp+Ch] [ebp-84h]
  float v11; // [esp+10h] [ebp-80h] BYREF
  float v12; // [esp+14h] [ebp-7Ch]
  float v13; // [esp+18h] [ebp-78h]
  float v14; // [esp+1Ch] [ebp-74h] BYREF
  float v15; // [esp+20h] [ebp-70h]
  float v16; // [esp+24h] [ebp-6Ch]
  float v17; // [esp+28h] [ebp-68h]
  float v18; // [esp+2Ch] [ebp-64h]
  int v19; // [esp+30h] [ebp-60h]
  T_Vector3D result; // [esp+34h] [ebp-5Ch] BYREF
  float v21; // [esp+40h] [ebp-50h]
  float v22; // [esp+44h] [ebp-4Ch]
  float v23; // [esp+48h] [ebp-48h]
  int v24[3]; // [esp+4Ch] [ebp-44h] BYREF
  int v25[3]; // [esp+58h] [ebp-38h] BYREF
  float v26; // [esp+64h] [ebp-2Ch] BYREF
  float v27; // [esp+68h] [ebp-28h]
  float v28; // [esp+6Ch] [ebp-24h]
  int v29; // [esp+70h] [ebp-20h]
  int v30; // [esp+74h] [ebp-1Ch]
  int *v31; // [esp+78h] [ebp-18h]
  float v32; // [esp+7Ch] [ebp-14h]
  int *v33; // [esp+80h] [ebp-10h]
  float *v34; // [esp+84h] [ebp-Ch]
  float v35; // [esp+88h] [ebp-8h]

  v29 = edx0 - *(__int16 *)(a1 + 0x4F22);
  v5 = *(__int16 *)(a1 + 0x4F24);
  result.x = (float)v29;
  v31 = v24;
  v30 = v5 - a3;
  result.y = 0.0;
  result.z = (float)(v5 - a3);
  v32 = *(float *)(a1 + 0x4F16);
  v17 = result.x * v32;
  v18 = 0.0 * v32;
  *(float *)v24 = v17;
  *(float *)&v19 = result.z * v32;
  *(float *)&v24[1] = v18;
  result.x = v17 * 0.00125;
  v24[2] = v19;
  result.y = v18;
  result.z = *(float *)&v19 * 0.0020000001;
  v11 = *(float *)(a1 + 0x4E5E);
  v12 = *(float *)(a1 + 0x4E62);
  v13 = *(float *)(a1 + 0x4E66);
  v12 = 0.0;
  v26 = 0.0;
  v28 = 1.0;
  v27 = 0.0;
  v35 = sub_5309C(&v11, &v26);
  v8 = v12 * v28 - v13 * v27;
  *(float *)&v9 = v13 * v26 - v11 * v28;
  v33 = v25;
  *(float *)v25 = v8;
  v25[1] = v9;
  *(float *)&v10 = v11 * v27 - v12 * v26;
  v25[2] = v10;
  if ( *(float *)&v9 >= 0.0 )
  {
    a2 = -v35;
    Q_RotateVectorY_sub_532AC(&result, a2);
  }
  else
  {
    Q_RotateVectorY_sub_532AC(&result, v35);
  }
  v34 = &v14;
  v21 = 0.0;
  v22 = 0.0;
  v23 = 0.0;
  v21 = result.x + *(float *)(a1 + 0x1D1E);
  v22 = result.y + *(float *)(a1 + 0x1D22);
  v6 = result.z + *(float *)(a1 + 0x1D26);
  v14 = v21;
  v23 = v6;
  v15 = v22;
  v16 = v23;
  *(float *)(a1 + 0x1D0A) = v21;
  *(float *)(a1 + 0x1D0E) = v15;
  *(float *)(a1 + 0x1D12) = v16;
  sub_53440((T_Vector3D *)(a1 + 0x1D0A));
}

//----- (000171D0) --------------------------------------------------------
void __fastcall sub_171D0(int a1, int a2, int a3)
{
  *(float *)(a1 + 0x1D0E) = (double)(a3 - 0xF0) * *(float *)(a1 + 0x4F16) * 0.00125 + *(float *)(a1 + 0x1D22);
  sub_53440((T_Vector3D *)(a1 + 0x1D0A));
}

//----- (00017204) --------------------------------------------------------
char *__fastcall sub_17204(int a1, int a2, int a3)
{
  char *result; // eax

  result = sub_15808(a1 + 0x1D36, a2, a3);
  *(_DWORD *)(a1 + 0xAF) = result;
  if ( !result )
  {
    result = sub_15808(a1 + 0x253A, a2, a3);
    *(_DWORD *)(a1 + 0xAF) = result;
  }
  if ( !*(_DWORD *)(a1 + 0xAF) )
  {
    result = sub_15808(a1 + 0x2D3E, a2, a3);
    *(_DWORD *)(a1 + 0xAF) = result;
  }
  return result;
}

//----- (00017260) --------------------------------------------------------
void __fastcall sub_17260(int result)
{
  if ( *(_DWORD *)WinMgr.z1aa == *(_DWORD *)(result + 0x41) )
  {
    sub_5A270(&WinMgr, *(_DWORD *)(result + 0xB8) + 0xF, 0, 0);
  }
}

//----- (000172B0) --------------------------------------------------------
void __fastcall sub_172B0(T_Wnd4BM *a1)
{
  _BYTE *Unknown_B3; // edx
  int v3; // eax
  char *v4; // esi
  int v5; // edi
  int v6; // eax
  int v7; // eax
  int v8; // eax
  P_Wnd20HW Wnd_sub_56DA8; // ecx
  int v10; // kr04_4
  int v11; // kr08_4
  int v12; // kr0C_4
  char v13; // al
  char v14; // al
  int v15; // eax
  int Unknown_AB; // edx
  char s[176]; // [esp+0h] [ebp-B0h] BYREF

  Unknown_B3 = (_BYTE *)a1->Unknown_B3;
  if ( Unknown_B3 )
  {
    v3 = a1->Unknown_B3;
    v4 = 0;
    v5 = 0;
    if ( *Unknown_B3 == 2 && (v6 = *(_DWORD *)(v3 + 1), *(_WORD *)(v6 + 0x56) == V_RaceIndex) )
    {
      v4 = "abanship";
      v5 = v6 + 0x34;
    }
    else
    {
      v7 = a1->Unknown_B3;
      if ( *(_BYTE *)v7 == 1 )
      {
        v8 = *(_DWORD *)(v7 + 1);
        if ( V_RaceIndex == *(_BYTE *)(v8 + 0x57) )
        {
          v4 = "abanplan";
          v5 = v8 + 0x24;
        }
      }
    }
    if ( v4 )
    {
      Wnd_sub_56DA8 = (P_Wnd20HW)Q_FindWnd_sub_56DA8(&WinMgr, "HELPWINDOW", 0);
      Q_ShowHelpTopic_sub_2FCB0(Wnd_sub_56DA8, "help.txt", v4);
      sprintf(s, *(const char **)&Wnd_sub_56DA8->Unknown_C95[5], v5);
      v10 = 0;
      v11 = *(_DWORD *)&Wnd_sub_56DA8->Unknown_C95[5];
      v12 = 0;
      do
      {
        v13 = s[2 * v10];
        *(_BYTE *)(v11 + 2 * v12) = v13;
        if ( !v13 )
        {
          break;
        }
        v14 = s[2 * v10 + 1];
        *(_BYTE *)(v11 + 2 * v12 + 1) = v14;
        ++v10;
        ++v12;
      }
      while ( v14 );
      if ( sub_552F8(&WinMgr, &Wnd_sub_56DA8->a2, 0) )
      {
        v15 = a1->Unknown_B3;
        if ( *(_BYTE *)v15 == 2 )
        {
          sub_49940(*(P_Ship *)(v15 + 1));
        }
        else
        {
          sub_37040(*(P_Planet *)(v15 + 1));
        }
        a1->Unknown_B3 = 0;
        Unknown_AB = a1->Unknown_AB;
        a1->Unknown_B7 = 0;
        sub_56D30(&WinMgr, *(_DWORD *)(Unknown_AB + 0x41), 0x320, 0, 0);
        sub_187EC(a1);
        sub_18C2C(a1, 0);
      }
    }
  }
}
// 172B0: using guessed type char s[176];

//----- (000173F4) --------------------------------------------------------
int __fastcall sub_173F4(int a1, int a2, int a3, int a4)
{
  sub_1B958(a1 + 0x4E46, (float *)(a1 + 0x1D1E), a1, a4);
  return sub_17430(a1);
}

//----- (00017430) --------------------------------------------------------
int __fastcall sub_17430(int eax0)
{
  int v2; // esi
  int v3; // kr08_4
  int result; // eax
  double v5; // st7
  int v6; // ebx
  int v7; // kr10_4
  char v8; // dl
  char v9; // bh
  float z; // eax
  int v11; // eax
  int v12; // edx
  int v13; // eax
  double v14; // st7
  char v15; // al
  double v16; // st7
  float *v17; // edx
  float v18; // eax
  int v19; // eax
  T_Vector3D *v20; // ebx
  int v21; // edx
  double v22; // st7
  int v23; // eax
  int v24[3]; // [esp+0h] [ebp-180h]
  int v25[24]; // [esp+14h] [ebp-16Ch] BYREF
  int v26; // [esp+74h] [ebp-10Ch]
  T_Vector3D vectors[4]; // [esp+78h] [ebp-108h] BYREF
  T_Vector3D v28; // [esp+A8h] [ebp-D8h] BYREF
  T_Vector3D v29; // [esp+B4h] [ebp-CCh] BYREF
  float v30; // [esp+C0h] [ebp-C0h]
  float v31; // [esp+C4h] [ebp-BCh]
  int v32; // [esp+C8h] [ebp-B8h]
  T_Vector3D a1; // [esp+CCh] [ebp-B4h] BYREF
  T_Vector3D v34[2]; // [esp+D8h] [ebp-A8h] BYREF
  T_Vector3D v35; // [esp+F0h] [ebp-90h] BYREF
  T_Vector3D v36; // [esp+FCh] [ebp-84h] BYREF
  float v37; // [esp+108h] [ebp-78h] BYREF
  float v38; // [esp+10Ch] [ebp-74h]
  int v39; // [esp+110h] [ebp-70h]
  __int64 v40; // [esp+114h] [ebp-6Ch]
  float v41; // [esp+11Ch] [ebp-64h]
  float *v42; // [esp+120h] [ebp-60h]
  T_Vector3D *v43; // [esp+124h] [ebp-5Ch]
  int v44; // [esp+128h] [ebp-58h]
  T_Vector3D *v45; // [esp+12Ch] [ebp-54h]
  int v46; // [esp+130h] [ebp-50h]
  T_Vector3D *v47; // [esp+134h] [ebp-4Ch]
  int v48; // [esp+138h] [ebp-48h]
  int v49; // [esp+13Ch] [ebp-44h]
  int v50; // [esp+140h] [ebp-40h]
  float *v51; // [esp+144h] [ebp-3Ch]
  int v52; // [esp+148h] [ebp-38h]
  float v53; // [esp+14Ch] [ebp-34h]
  int v54; // [esp+150h] [ebp-30h]
  float v55; // [esp+154h] [ebp-2Ch]
  float *v56; // [esp+158h] [ebp-28h]
  float v57; // [esp+15Ch] [ebp-24h]
  int v58; // [esp+160h] [ebp-20h] BYREF
  __int16 v59[14]; // [esp+164h] [ebp-1Ch] BYREF

  v2 = *(_DWORD *)(eax0 + 0x1D2A);
  memset(v34, 0, 0xC);
  memset(&v35, 0, sizeof(v35));
  memset(&a1, 0, sizeof(a1));
  _wcpp_2_ctor_array_(vectors, 4u, &C_Vector3D);
  memset(&v35, 0, sizeof(v35));
  sub_53384(&v35.x, (float *)(eax0 + 0x4E86), &v34[0].x);
  vectors[0].x = 16.0;
  vectors[0].z = 16.0;
  vectors[1].x = 16.0;
  v35 = v34[0];
  vectors[3].z = 16.0;
  vectors[0].y = 0.0;
  vectors[1].y = 0.0;
  vectors[2].y = 0.0;
  vectors[1].z = -16.0;
  vectors[2].x = -16.0;
  vectors[2].z = -16.0;
  vectors[3].x = -16.0;
  vectors[3].y = 0.0;
  v47 = &v28;
  v3 = 0;
  do
  {
    sub_53384(&vectors[v3].x, (float *)(eax0 + 0x4E86), &v34[0].x);
    v42 = &v37;
    v30 = v34[0].x - v35.x;
    v37 = v30;
    v31 = v34[0].y - v35.y;
    v38 = v31;
    *(float *)&v32 = v34[0].z - v35.z;
    v39 = v32;
    vectors[v3].x = v30;
    vectors[v3].y = v38;
    result = v39;
    *(&v26 + 3 * v3++ + 3) = v39;
  }
  while ( &vectors[v3] != v47 );
  v5 = *(float *)(eax0 + 0x4F2A) * 0.5;
  v6 = *(_DWORD *)(eax0 + 0x1D32);
  v46 = 0;
  v53 = v5;
  if ( v6 > 0 )
  {
    v48 = eax0 + 0x1D36;
    v50 = eax0 + 0x253A;
    v54 = eax0 + 0x3542;
    v52 = eax0 + 0x2D3E;
    v51 = (float *)(eax0 + 0x4E46);
    v56 = (float *)(eax0 + 0x1D1E);
    v49 = eax0 + 0x4F80;
    v7 = 0;
    do
    {
      if ( *(_BYTE *)(v2 + 0x35 * v7) != 6
        || ((v8 = *(_BYTE *)(eax0 + 0xB7), v8 == 2) || v8 == 3) && !*(_DWORD *)(eax0 + 0xAF) && *(_DWORD *)(eax0 + 0x1D0E) != 0x49742400 )
      {
        if ( *(_BYTE *)(v2 + 0x35 * v7) != 0xFF )
        {
          v9 = *(_BYTE *)(v2 + 0x35 * v7);
          *(_DWORD *)(v2 + 0x35 * v7 + 0x1B) = 0xFFFFFFFF;
          if ( v9 == 4 )
          {
            v34[0] = *(T_Vector3D *)(*(_DWORD *)(v2 + 0x35 * v7 + 1) + 1);
            sub_53114(&v34[0].x, v51);
            if ( v34[0].z > 0.0 )
            {
              sub_533D4(v34, *(float *)(eax0 + 0x4E6E), *(__int16 *)(eax0 + 0x4F22), *(__int16 *)(eax0 + 0x4F24), (int)v59, (int)&v58);
              *(_WORD *)(v2 + 0x35 * v7 + 0x27) = v59[0];
              *(_WORD *)(v2 + 0x35 * v7 + 0x29) = v58;
              z = v34[0].z;
              *(_DWORD *)(v2 + 0x35 * v7 + 0x1B) = 0;
              *(_DWORD *)(v2 + 0x35 * v7 + 0x23) = 0;
              *(float *)(v2 + 0x35 * v7 + 0x2F) = z;
              v11 = v52;
              *(_DWORD *)(v2 + 0x35 * v7 + 0xF) = sub_10000;
              sub_15794(v11, v2 + 0x35 * v7);
            }
          }
          else
          {
            v13 = *(_BYTE *)(v2 + 0x35 * v7 + 0x33) & 0x10;
            v44 = 0xFFFFFFFF;
            if ( v13 )
            {
              a1 = *(T_Vector3D *)(0xC * *(char *)(v2 + 0x35 * v7 + 0x34) + v49);
            }
            else
            {
              switch ( *(_BYTE *)(v2 + 0x35 * v7) )
              {
                case 0:
                  memset(&a1, 0, sizeof(a1));
                  break;
                case 1:
                  a1 = *(T_Vector3D *)*(_DWORD *)(v2 + 0x35 * v7 + 1);
                  break;
                case 2:
                  a1 = *(T_Vector3D *)(*(_DWORD *)(v2 + 0x35 * v7 + 1) + 0x9E);
                  v44 = *(__int16 *)(*(_DWORD *)(v2 + 0x35 * v7 + 1) + 0x56);
                  break;
                case 3:
                  v17 = *(float **)(v2 + 0x35 * v7 + 1);
                  if ( (*(_BYTE *)(v2 + 0x35 * v7 + 0x33) & 1) != 0 )
                  {
                    a1.x = v17[2];
                    a1.y = v17[3];
                    v18 = v17[4];
                  }
                  else
                  {
                    a1.x = v17[5];
                    a1.y = v17[6];
                    v18 = v17[7];
                  }
                  a1.z = v18;
                  break;
                case 6:
                  a1 = *(T_Vector3D *)(eax0 + 0x1D0A);
                  sub_53440(&a1);
                  break;
                default:
                  Q_AssertLogBreakExit_sub_261A8(0, "..\\batmode.cpp", 0x53E);
                  break;
              }
            }
            v35 = a1;
            sub_53384(&v35.x, (float *)(eax0 + 0x4E86), &v34[0].x);
            v35.y = *(float *)(eax0 + 0x1D22);
            v43 = &v29;
            memset(&v34[1], 0, sizeof(T_Vector3D));
            v34[1].x = v35.x - *v56;
            v34[1].y = v35.y - v56[1];
            v34[1].z = v35.z - v56[2];
            v29 = v34[1];
            v35 = v34[1];
            v14 = sqrt(v34[1].y * v34[1].y + v34[1].x * v34[1].x + v34[1].z * v34[1].z);
            *(_DWORD *)(v2 + 0x35 * v7 + 0x23) = (v14 >= v53) - 1;
            if ( v34[0].z > (double)*(float *)(eax0 + 0x4E72) && v34[0].z < (double)*(float *)(eax0 + 0x4E76) )
            {
              sub_533D4(v34, *(float *)(eax0 + 0x4E6E), *(__int16 *)(eax0 + 0x4F22), *(__int16 *)(eax0 + 0x4F24), (int)v59, (int)&v58);
              *(_WORD *)(v2 + 0x35 * v7 + 0x27) = v59[0];
              *(_WORD *)(v2 + 0x35 * v7 + 0x29) = v58;
              *(float *)(v2 + 0x35 * v7 + 0x2F) = v34[0].z;
              v15 = *(_BYTE *)(v2 + 0x35 * v7);
              *(_DWORD *)(v2 + 0x35 * v7 + 0x1B) = 0;
              if ( v15 == 7 )
              {
                *(float *)(v2 + 0x35 * v7 + 0x2F) = *(float *)(v2 + 0x35 * v7 + 0x2F) + -1.0;
              }
              v16 = *(float *)(eax0 + 0x4F1A) * 16384.0;
              v57 = 131072.0;
              v55 = v16;
              if ( *(float *)(v2 + 0x35 * v7 + 0x2F) >= (double)*(float *)(eax0 + 0x4E72) )
              {
                v57 = v55 / *(float *)(v2 + 0x35 * v7 + 0x2F);
              }
              if ( v57 >= 16384.0 )
              {
                if ( v57 > 131072.0 )
                {
                  v57 = 131072.0;
                }
              }
              else
              {
                v57 = 16384.0;
              }
              v40 = (__int64)(v57 * *(float *)(v2 + 0x35 * v7 + 0xB));
              *(_DWORD *)(v2 + 0x35 * v7 + 0xF) = v40;
              v19 = *(_DWORD *)(v2 + 0x35 * v7 + 0x23);
              v41 = *(float *)(eax0 + 0x4F16) * 0.125 + *(float *)(eax0 + 0x1D22);
              if ( v19 )
              {
                if ( (*(_BYTE *)(v2 + 0x35 * v7 + 0x33) & 2) == 0 )
                {
                  v35.x = a1.x;
                  v35.z = a1.z;
                  v35.y = v41;
                  sub_53384(&v35.x, (float *)(eax0 + 0x4E86), &v34[0].x);
                  v35 = v34[0];
                  sub_533D4(v34, *(float *)(eax0 + 0x4E6E), *(__int16 *)(eax0 + 0x4F22), *(__int16 *)(eax0 + 0x4F24), (int)v59, (int)&v58);
                  *(_WORD *)(v2 + 0x35 * v7 + 0x2B) = v59[0];
                  v20 = vectors;
                  v21 = 0;
                  *(_WORD *)(v2 + 0x35 * v7 + 0x2D) = v58;
                  do
                  {
                    v45 = &v36;
                    memset(&v28, 0, sizeof(v28));
                    v28.x = v35.x + v20->x;
                    v28.y = v35.y + v20->y;
                    v22 = v35.z + v20->z;
                    v36 = v28;
                    v28.z = v22;
                    v34[0] = v28;
                    sub_533D4(v34, *(float *)(eax0 + 0x4E6E), *(__int16 *)(eax0 + 0x4F22), *(__int16 *)(eax0 + 0x4F24), (int)v59, (int)&v58);
                    v25[v21] = v59[0];
                    ++v20;
                    v24[v21 + 6] = (__int16)v58;
                    v21 += 6;
                  }
                  while ( v21 != 0x18 );
                  v26 = v44;
                  sub_15D38(v54, v25);
                  if ( *(_BYTE *)(v2 + 0x35 * v7) == 6 )
                  {
                    *(_WORD *)(eax0 + 0xBC) = *(_WORD *)(eax0 + 0x4E42) - 1;
                  }
                }
              }
              if ( a1.y - v41 > 0.0 )
              {
                v23 = v50;
                *(_DWORD *)(v2 + 0x35 * v7 + 0x1F) = 0;
              }
              else
              {
                v23 = v48;
                *(_DWORD *)(v2 + 0x35 * v7 + 0x1F) = 0xFFFFFFFF;
              }
              sub_15794(v23, v2 + 0x35 * v7);
            }
          }
        }
      }
      result = v46 + 1;
      v12 = *(_DWORD *)(eax0 + 0x1D32);
      v46 = result;
      ++v7;
    }
    while ( result < v12 );
  }
  return result;
}
// 10000: using guessed type void __noreturn sub_10000();
// 17430: using guessed type __int16 var_1C[14];

//----- (00017E50) --------------------------------------------------------
void __fastcall sub_17E50(P_Wnd4BM a1, int a2)
{
  float v2; // [esp+0h] [ebp-8h]

  v2 = (double)a2 * WinMgr.j;
  sub_1BAF0(&a1->Wnd9RW1, v2);
}

//----- (00017E88) --------------------------------------------------------
float *__fastcall sub_17E88(float *result, int a2)
{
  int v2; // ecx
  float *v3; // ecx
  int v4; // ecx
  double v5; // st7
  int v6; // ecx

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x5BD);
  }
  switch ( *(_BYTE *)a2 )
  {
    case 0:
      *(float *)((char *)result + 0x1D1E) = 0.0;
      *(float *)((char *)result + 0x1D22) = 0.0;
      *(float *)((char *)result + 0x1D26) = 0.0;
      break;
    case 1:
      v3 = *(float **)(a2 + 1);
      *(float *)((char *)result + 0x1D1E) = *v3;
      *(float *)((char *)result + 0x1D22) = v3[1];
      *(float *)((char *)result + 0x1D26) = v3[2];
      break;
    case 2:
      v2 = *(_DWORD *)(a2 + 1);
      *(float *)((char *)result + 0x1D1E) = *(float *)(v2 + 0x9E);
      *(float *)((char *)result + 0x1D22) = *(float *)(v2 + 0xA2);
      *(float *)((char *)result + 0x1D26) = *(float *)(v2 + 0xA6);
      break;
    case 3:
      v4 = *(_DWORD *)(a2 + 1);
      if ( V_Game.pCurStar == *(P_Star *)v4 )
      {
        v5 = *(float *)(v4 + 8);
        v6 = v4 + 8;
      }
      else
      {
        v5 = *(float *)(v4 + 0x14);
        v6 = v4 + 0x14;
      }
      *(float *)((char *)result + 0x1D1E) = v5;
      *(float *)((char *)result + 0x1D22) = *(float *)(v6 + 4);
      *(float *)((char *)result + 0x1D26) = *(float *)(v6 + 8);
      break;
    default:
      return result;
  }
  return result;
}

//----- (00017F54) --------------------------------------------------------
void __fastcall sub_17F54(P_Wnd4BM a1)
{
  a1->Unknown_1D1E = 0;
  a1->Unknown_1D22 = 0;
  a1->Unknown_1D26 = 0;
  a1->Unknown_4F16 = a1->Unknown_4F1A;
  a1->Wnd9RW1.vector_34 = a1->vector_4EDE;
  a1->Wnd9RW1.matrix_00 = a1->matrix_4EEA;
  sub_181F0(a1);
}

//----- (00017FF0) --------------------------------------------------------
void __fastcall sub_17FF0(P_Wnd4BM a1)
{
  double v2; // st6
  double v3; // st7
  float a2; // [esp+0h] [ebp-3Ch]
  int x_4; // [esp+Ch] [ebp-30h]
  float x_4a; // [esp+Ch] [ebp-30h]
  double v7; // [esp+10h] [ebp-2Ch]

  a1->Unknown_1D1E = 0;
  LODWORD(a1->Unknown_4F26) = 0x23;
  v2 = (double)SLODWORD(a1->Unknown_4F26) * 0.017453292;
  a1->Unknown_1D22 = 0;
  a1->Unknown_1D26 = 0;
  v7 = *(float *)&a1->Unknown_4F1E;
  v3 = v7 / tan(v2 * 0.5);
  x_4 = a1->Unknown_4F22;
  a1->Unknown_4F16 = v3;
  a1->Unknown_4F1A = v3;
  a2 = (float)SLODWORD(a1->Unknown_4F26);
  sub_1B808(&a1->Wnd9RW1, a2, 1.0, 100000.0, x_4);
  a1->vector_4EDE.z = a1->Wnd9RW1.Unknown_28;
  HIBYTE(a1->vector_4EDE.z) ^= 0x80u;
  a1->vector_4EDE.y = a1->vector_4EDE.z * 0.33333334;
  x_4a = a1->Unknown_4F16;
  a1->vector_4EDE.x = 0.0;
  sub_53054(&a1->vector_4EDE.x, x_4a);
  a1->Wnd9RW1.matrix_00.vector1.x = 1.0;
  a1->Wnd9RW1.matrix_00.vector1.y = 0.0;
  a1->Wnd9RW1.matrix_00.vector1.z = 0.0;
  a1->Wnd9RW1.matrix_00.vector2.x = 0.0;
  a1->Wnd9RW1.matrix_00.vector2.y = 1.0;
  a1->Wnd9RW1.matrix_00.vector2.z = 0.0;
  a1->Wnd9RW1.matrix_00.vector3.x = 0.0;
  a1->Wnd9RW1.matrix_00.vector3.y = 0.0;
  a1->Wnd9RW1.matrix_00.vector3.z = 1.0;
  a1->matrix_4EEA = a1->Wnd9RW1.matrix_00;
  a1->matrix_4EEA.vector3.x = -a1->vector_4EDE.x;
  a1->matrix_4EEA.vector3.y = -a1->vector_4EDE.y;
  a1->matrix_4EEA.vector3.z = -a1->vector_4EDE.z;
  sub_53864(&a1->matrix_4EEA);
  a1->Wnd9RW1.matrix_00 = a1->matrix_4EEA;
  a1->Wnd9RW1.vector_34 = a1->vector_4EDE;
  sub_181F0(a1);
}

//----- (000181F0) --------------------------------------------------------
void __fastcall sub_181F0(P_Wnd4BM a1)
{
  a1->Unknown_4F2A = tan((double)SLODWORD(a1->Unknown_4F26) * 0.017453292 * 0.5);
  a1->Unknown_4F2A = a1->Unknown_4F16 * a1->Unknown_4F2A * 2.0;
  a1->Unknown_4F12 = a1->Unknown_4F1A * 0.5 + a1->Unknown_4F16;
  a1->Unknown_4F0E = a1->Unknown_4F16 - a1->Unknown_4F2A * 0.5;
}

//----- (0001826C) --------------------------------------------------------
void __fastcall sub_1826C(P_Wnd4BM a1, int a2, unsigned __int16 a3, unsigned __int16 a4)
{
  if ( a3 >= a1->batfxNamesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x62B);
  }
  sub_156C0(a2, (unsigned __int16)a1->Unknown_19C6[a3], a4);
}

//----- (000182B8) --------------------------------------------------------
void __fastcall sub_182B8(P_Wnd4BM a1, int a2)
{
  double v3; // st7
  double v4; // st7
  float Unknown_28; // eax
  float v6; // [esp+4h] [ebp-8h]
  float v7; // [esp+4h] [ebp-8h]
  float v8; // [esp+4h] [ebp-8h]

  v3 = (double)a2;
  v6 = v3;
  if ( v3 <= 50.0 )
  {
    if ( v6 < -50.0 )
    {
      v6 = -50.0;
    }
  }
  else
  {
    v6 = 50.0;
  }
  v7 = v6 * 0.0099999998 * WinMgr.j;
  v8 = v7 + 1.0;
  v4 = a1->Unknown_4F16 * v8;
  a1->Unknown_4F16 = v4;
  if ( v4 < a1->Wnd9RW1.Unknown_28 )
  {
    Unknown_28 = a1->Wnd9RW1.Unknown_28;
LABEL_9:
    a1->Unknown_4F16 = Unknown_28;
    goto LABEL_10;
  }
  if ( a1->Unknown_4F16 > (double)a1->Unknown_4F1A )
  {
    Unknown_28 = a1->Unknown_4F1A;
    goto LABEL_9;
  }
LABEL_10:
  sub_53054(&a1->Wnd9RW1.vector_34.x, a1->Unknown_4F16);
  sub_181F0(a1);
}

//----- (00018370) --------------------------------------------------------
unsigned int __fastcall sub_18370(P_Wnd4BM a1)
{
  __int16 v2; // ax
  __int16 y0; // cx
  __int16 v4; // bx
  __int16 y1; // ax
  void *v6; // eax
  void *v7; // eax
  char *Unknown_19BE; // ebp
  int v9; // kr04_4
  int v10; // kr0C_4
  T_FileInfo v12; // [esp+0h] [ebp-144h] BYREF
  char v13[20]; // [esp+114h] [ebp-30h] BYREF
  _WORD v14[10]; // [esp+12Ch] [ebp-18h] BYREF
  int v15; // [esp+140h] [ebp-4h]

  v2 = LOWORD(a1->a.a1.pane.x1) - LOWORD(a1->a.a1.pane.x0);
  y0 = a1->a.a1.pane.y0;
  a1->Unknown_4F22 = v2;
  v4 = v2;
  y1 = a1->a.a1.pane.y1;
  a1->Unknown_4F22 = v4 >> 1;
  a1->Unknown_4F24 = (__int16)(y1 - y0) >> 1;
  a1->Unknown_1D1E = 0;
  a1->Unknown_1D22 = 0;
  a1->Unknown_1D26 = 0;
  if ( a1->Unknown_1D2A )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x65E);
  }
  if ( a1->Unknown_19BE )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x65F);
  }
  a1->Unknown_1D2E = 0x80;
  v6 = operator new[](0x35 * a1->Unknown_1D2E);
  Q_RegisterData_sub_2625C(v6, 1, "BATDISPLAYITEMS");
  a1->Unknown_1D2A = v6;
  if ( !v6 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x669);
  }
  a1->Unknown_19C2 = 0x27;
  v7 = operator new[](a1->Unknown_19C2 << 8);
  Q_RegisterData_sub_2625C(v7, 1, "BATHAZE");
  a1->Unknown_19BE = v7;
  if ( !v7 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x66F);
  }
  Unknown_19BE = (char *)a1->Unknown_19BE;
  Q_InitFileInfo_sub_1BB78(&v12);
  v15 = 0;
  v9 = 0;
  do
  {
    sprintf(&v13[4], "DATA\\BLACK%.2d.HAZ", v15);
    if ( Q_OpenFile_sub_1BBFC(&v12, &v13[4], 0x200, 0) )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\batmode.cpp", 0x67B);
    }
    Q_CfileLoad_sub_1BF1C(&v12, &Unknown_19BE[0x100 * v9]);
    ++v15;
    ++v9;
  }
  while ( v15 < 0x1F );
  if ( Q_OpenFile_sub_1BBFC(&v12, "DATA\\SLANE03.HAZ", 0x200, 0) )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\batmode.cpp", 0x680);
  }
  Q_CfileLoad_sub_1BF1C(&v12, Unknown_19BE);
  v15 = 0x41;
  strcpy((char *)v14, "DATA\\RACEA03.HAZ");
  HIBYTE(v14[8]) = aDataRacea03Haz[0x11];
  v14[9] = *(_WORD *)&aDataRacea03Haz[0x12];
  v10 = 0;
  do
  {
    HIBYTE(v14[4]) = v15;
    ++v10;
    if ( Q_OpenFile_sub_1BBFC(&v12, (const char *)v14, 0x200, 0) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x68A);
    }
    Q_CfileLoad_sub_1BF1C(&v12, &Unknown_19BE[0x100 * v10]);
    ++v15;
  }
  while ( v15 < 0x48 );
  Q_CloseFileAndDelete_sub_1BBC8(&v12);
  return 0xFFFFFFFF;
}

//----- (000185CC) --------------------------------------------------------
int __fastcall sub_185CC(int a1)
{
  int index; // esi
  int v3; // edx
  int v4; // edi
  int v5; // eax
  int v6; // edx
  int result; // eax

  index = V_Game.pCurStar->index;
  if ( index >= 0x64 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x697);
  }
  v3 = a1 + 0xBE;
  v4 = 0xC * index;
  *(_DWORD *)(v3 + v4) = *(_DWORD *)(a1 + 0x4E7A);
  *(_DWORD *)(v3 + v4 + 4) = *(_DWORD *)(a1 + 0x4E7E);
  *(_DWORD *)(v3 + v4 + 8) = *(_DWORD *)(a1 + 0x4E82);
  v5 = 0x24 * index + a1 + 0x56E;
  *(float *)v5 = *(float *)(a1 + 0x4E46);
  *(float *)(v5 + 4) = *(float *)(a1 + 0x4E4A);
  *(_DWORD *)(v5 + 8) = *(_DWORD *)(a1 + 0x4E4E);
  *(_DWORD *)(v5 + 0xC) = *(_DWORD *)(a1 + 0x4E52);
  *(_DWORD *)(v5 + 0x10) = *(_DWORD *)(a1 + 0x4E56);
  *(_DWORD *)(v5 + 0x14) = *(_DWORD *)(a1 + 0x4E5A);
  *(_DWORD *)(v5 + 0x18) = *(_DWORD *)(a1 + 0x4E5E);
  *(_DWORD *)(v5 + 0x1C) = *(_DWORD *)(a1 + 0x4E62);
  v6 = a1 + 0x150E;
  *(float *)(v5 + 0x20) = *(float *)(a1 + 0x4E66);
  result = a1 + 0x1D1E;
  *(_DWORD *)(v6 + v4) = *(_DWORD *)(a1 + 0x1D1E);
  *(_DWORD *)(v6 + v4 + 4) = *(_DWORD *)(a1 + 0x1D22);
  *(_DWORD *)(v6 + v4 + 8) = *(_DWORD *)(a1 + 0x1D26);
  *(_DWORD *)(a1 + 0x4F2F) = 0;
  *(_BYTE *)(a1 + 0xB7) = 0;
  *(_DWORD *)(a1 + 0xB3) = 0;
  return result;
}

//----- (000186B8) --------------------------------------------------------
void __fastcall sub_186B8(P_Wnd4BM a1, int a2, int a3)
{
  int index; // esi
  T_Vector3D *v5; // ebx

  sub_187EC(a1);
  index = V_Game.pCurStar->index;
  if ( index >= 0x64 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x6AE);
  }
  if ( a1->Unknown_137E[index] )
  {
    a1->Wnd9RW1.vector_34 = a1->vectors1[index];
    v5 = (T_Vector3D *)&a1->someFloats[index];
    a1->Wnd9RW1.matrix_00.vector1.x = v5->x;
    a1->Wnd9RW1.matrix_00.vector1.y = v5->y;
    a1->Wnd9RW1.matrix_00.vector1.z = v5->z;
    a1->Wnd9RW1.matrix_00.vector2 = v5[1];
    a1->Wnd9RW1.matrix_00.vector3 = v5[2];
    a1->Unknown_1D1E = LODWORD(a1->vectors2[index].x);
    a1->Unknown_1D22 = LODWORD(a1->vectors2[index].y);
    a1->Unknown_1D26 = LODWORD(a1->vectors2[index].z);
    a1->Unknown_4F16 = sqrt(
                         a1->Wnd9RW1.vector_34.y * a1->Wnd9RW1.vector_34.y
                       + a1->Wnd9RW1.vector_34.x * a1->Wnd9RW1.vector_34.x
                       + a1->Wnd9RW1.vector_34.z * a1->Wnd9RW1.vector_34.z);
    sub_181F0(a1);
  }
  else
  {
    sub_17FF0(a1);
    a1->Unknown_137E[index] = 0xFFFFFFFF;
  }
  sub_18C2C(a1, 0);
}

//----- (000187EC) --------------------------------------------------------
int __fastcall sub_187EC(P_Wnd4BM a1)
{
  __int16 i; // si
  int v3; // eax
  char *Unknown_1D2A; // esi
  __int16 v5; // ax
  int v6; // esi
  char *v7; // kr00_4
  int v8; // kr04_4
  unsigned __int16 *pCurStar; // eax
  int v10; // ecx
  int v11; // kr0C_4
  int v12; // ebx
  int v13; // eax
  signed __int16 v14; // cx
  float *v15; // eax
  int v16; // kr14_4
  float v17; // eax
  int v18; // ebp
  P_Star v19; // eax
  int v20; // ebp
  unsigned __int16 v21; // ax
  __int16 v22; // cx
  int v23; // ebp
  int v24; // kr1C_4
  int v25; // eax
  __int16 v26; // bx
  int result; // eax
  int v28; // ecx
  double x; // [esp+0h] [ebp-1ECh]
  int v30[107]; // [esp+8h] [ebp-1E4h] BYREF
  float v31; // [esp+1B4h] [ebp-38h]
  float v32; // [esp+1B8h] [ebp-34h]
  float v33; // [esp+1BCh] [ebp-30h]
  int v34; // [esp+1C0h] [ebp-2Ch]
  int v35; // [esp+1C4h] [ebp-28h]
  int v36; // [esp+1C8h] [ebp-24h]
  int v37; // [esp+1CCh] [ebp-20h]
  int v38; // [esp+1D0h] [ebp-1Ch]

  for ( i = 0; i < a1->Unknown_1D2E; ++i )
  {
    v3 = 0x35 * i;
    *((_BYTE *)a1->Unknown_1D2A + v3 + 0x33) = 0;
  }
  Unknown_1D2A = (char *)a1->Unknown_1D2A;
  a1->Unknown_1D32 = 0;
  *Unknown_1D2A = 6;
  a1->Unknown_1D0A[3] = (int)Unknown_1D2A;
  *(_WORD *)(Unknown_1D2A + 5) = 0xFFFF;
  v5 = 0;
  ++a1->Unknown_1D32;
  v7 = Unknown_1D2A + 0x35;
  v6 = (int)(Unknown_1D2A + 0x35);
  v8 = 0;
  while ( v5 < 1 )
  {
    v7[0x35 * v8] = 0xFF;
    ++v5;
    ++a1->Unknown_1D32;
    ++v8;
  }
  *(_BYTE *)v6 = 0;
  pCurStar = (unsigned __int16 *)V_Game.pCurStar;
  *(_DWORD *)(v6 + 1) = V_Game.pCurStar;
  sub_1826C(a1, v6, 1u, *pCurStar);
  v10 = a1->Unknown_1D32 + 1;
  LOWORD(v37) = 0;
  a1->Unknown_1D32 = v10;
  v11 = 0;
  while ( (__int16)v37 < V_Game.pCurStar->planetsNum )
  {
    if ( a1->Unknown_1D32 >= a1->Unknown_1D2E )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x6FC);
    }
    v13 = V_Game.pCurStar->Unknown_46[(__int16)v37];
    *(_BYTE *)(v6 + 0x35 * v11 + 0x35) = 1;
    *(_DWORD *)(v6 + 0x35 * v11 + 0x35 + 1) = v13;
    v14 = *(_WORD *)(v13 + 0x14) + 5 * *(_WORD *)(v13 + 0x16);
    ++v11;
    if ( v14 >= 0x37 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x706);
    }
    sub_1826C(a1, v6 + 0x35 * v11, 0, v14);
    v12 = a1->Unknown_1D32 + 1;
    LOWORD(v37) = v37 + 1;
    a1->Unknown_1D32 = v12;
  }
  v15 = *(float **)(v6 + 1);
  x = v15[1] * v15[1] + *v15 * *v15 + v15[2] * v15[2];
  LOWORD(v38) = 0;
  *(float *)&a1->Unknown_4F1E = sqrt(x);
  v16 = 0;
  while ( 1 )
  {
    v19 = V_Game.pCurStar;
    if ( (__int16)v38 >= V_Game.pCurStar->Unknown_44 )
    {
      break;
    }
    if ( a1->Unknown_1D32 >= a1->Unknown_1D2E )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x716);
    }
    v20 = *(_DWORD *)&V_Game.pCurStar->Unknown_2C[4 * (__int16)v38];
    *(_BYTE *)(v6 + 0x35 * v16 + 0x35) = 3;
    *(_DWORD *)(v6 + 0x35 * v16 + 0x35 + 1) = v20;
    v21 = (*(_BYTE *)(v20 + 0x23) & 1) != 0;
    ++v16;
    if ( (*(_BYTE *)(v20 + 0x23) & 2) != 0 )
    {
      v21 += 2;
    }
    sub_1826C(a1, v6 + 0x35 * v16, 2u, v21);
    v31 = 0.0;
    v32 = 0.0;
    v33 = 0.0;
    if ( V_Game.pCurStar == *(P_Star *)v20 )
    {
      *(_BYTE *)(v6 + 0x35 * v16 + 0x33) |= 1u;
      v31 = *(float *)(v20 + 8);
      v32 = *(float *)(v20 + 0xC);
      v17 = *(float *)(v20 + 0x10);
    }
    else
    {
      *(_BYTE *)(v6 + 0x35 * v16 + 0x33) &= ~1u;
      v31 = *(float *)(v20 + 0x14);
      v32 = *(float *)(v20 + 0x18);
      v17 = *(float *)(v20 + 0x1C);
    }
    v33 = v17;
    *(float *)&v34 = sqrt(v32 * v32 + v31 * v31 + v17 * v17);
    if ( *(float *)&a1->Unknown_4F1E < (double)*(float *)&v34 )
    {
      a1->Unknown_4F1E = v34;
    }
    v18 = a1->Unknown_1D32 + 1;
    LOWORD(v38) = v38 + 1;
    a1->Unknown_1D32 = v18;
  }
  v22 = 0;
  *(float *)&a1->Unknown_4F1E = *(float *)&a1->Unknown_4F1E + 32.0;
  v35 = sub_1D794((P_Location)v19, (P_Ship *)v30);
  while ( v22 < v35 )
  {
    v23 = v30[v22];
    if ( *(_BYTE *)(v23 + 0x58) == 4 )
    {
      if ( a1->Unknown_1D32 >= a1->Unknown_1D2E )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x750);
      }
      *(_DWORD *)(v6 + 0x36) = v23;
      *(_BYTE *)(v6 + 0x35) = 2;
      sub_156C0(v6 + 0x35, (unsigned __int16)word_FFEBC[*(__int16 *)(v23 + 0x56)], *(char *)(v23 + 0xAA));
      v6 += 0x35;
      ++a1->Unknown_1D32;
    }
    ++v22;
  }
  LOWORD(v36) = 0;
  if ( V_Game.sectorsNum > 0 )
  {
    v24 = 0;
    do
    {
      if ( a1->Unknown_1D32 >= a1->Unknown_1D2E )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x761);
      }
      v25 = (__int16)v36;
      *(_BYTE *)(v6 + 0x35 * v24 + 0x35) = 4;
      *(_DWORD *)(v6 + 0x35 * v24 + 0x35 + 1) = &V_Game.sectors[v25];
      sub_1826C(a1, v6 + 0x35 * v24 + 0x35, 3u, V_Game.sectors[v25].n);
      v26 = v36;
      ++a1->Unknown_1D32;
      LOWORD(v36) = v26 + 1;
      ++v24;
    }
    while ( (__int16)(v26 + 1) < V_Game.sectorsNum );
  }
  for ( result = 0; (__int16)result < a1->Unknown_1D32; ++result )
  {
    v28 = 0x35 * (__int16)result;
    *((_BYTE *)a1->Unknown_1D2A + v28 + 0x33) &= ~4u;
  }
  return result;
}
// FFEBC: using guessed type __int16 word_FFEBC[7];
// 187EC: using guessed type int var_1E4[107];

//----- (00018C2C) --------------------------------------------------------
void __fastcall sub_18C2C(P_Wnd4BM a1, int a2)
{
  int *Unknown_1D36; // ecx

  Unknown_1D36 = a1->Unknown_1D36;
  sub_15788((int)a1->Unknown_1D36);
  sub_15788((int)a1->Unknown_253A);
  sub_15788((int)a1->Unknown_2D3E);
  sub_15D2C((int)a1->Unknown_3542);
  sub_173F4((int)a1, (int)a1->Unknown_253A, (int)a1, (int)a1->Unknown_1D36);
  sub_157EC((size_t *)Unknown_1D36);
  sub_157EC((size_t *)a1->Unknown_253A);
  if ( !a2 )
  {
    ((void (__fastcall *)(P_Wnd4BM, _DWORD))a1->a.procs->proc4)(a1, 0);
  }
}

//----- (00018CA8) --------------------------------------------------------
void __usercall sub_18CA8(int a1@<eax>, int a2@<edx>, int a3@<esi>)
{
  char v4; // ah
  int v5; // eax
  char *v6; // eax
  int v7; // ebx
  int v8; // edx
  int v9; // edx
  __int16 v10; // bx
  int v11; // edx
  int v12; // kr18_4
  int v13; // kr58_4
  char v14; // al
  char v15; // al
  int v16; // edx
  const char *v17; // ecx
  int v18; // ebx
  char *v19; // eax
  int v20; // eax
  char *v21; // eax
  int v22; // edx
  int v23; // kr20_4
  char *v24; // kr5C_4
  int v25; // kr60_4
  char v26; // al
  char v27; // al
  __int16 v28; // dx
  int v29; // ebx
  char *v30; // esi
  char *v31; // eax
  int v32; // kr28_4
  char *v33; // kr64_4
  int v34; // kr68_4
  char v35; // al
  char v36; // al
  char *v37; // kr2C_4
  int v38; // kr30_4
  int v39; // kr70_4
  char v40; // al
  char v41; // al
  char *v42; // kr34_4
  int v43; // kr38_4
  int v44; // kr78_4
  char v45; // al
  char v46; // al
  int v47; // eax
  int v48; // ebx
  char *v49; // esi
  int v50; // kr40_4
  char *v51; // kr7C_4
  int v52; // kr80_4
  char v53; // al
  char v54; // al
  int v55; // kr44_4
  int v56; // kr48_4
  char *v57; // kr84_4
  int v58; // kr88_4
  char v59; // al
  char v60; // al
  char *sub_1CEA8; // kr4C_4
  int v62; // kr50_4
  int v63; // kr90_4
  char v64; // al
  char v65; // al
  int v66; // eax
  char v67; // dl
  const char *v68; // ecx
  __int16 v69; // [esp-Ch] [ebp-184h]
  int v70; // [esp-4h] [ebp-17Ch]
  char *v71; // [esp-4h] [ebp-17Ch]
  _DWORD v72[50]; // [esp+0h] [ebp-178h] BYREF
  char v73[60]; // [esp+C8h] [ebp-B0h] BYREF
  char v74[40]; // [esp+118h] [ebp-60h] BYREF
  char v75[12]; // [esp+154h] [ebp-24h] BYREF
  int v76; // [esp+174h] [ebp-4h]

  if ( !a2 )
  {
    stru_9A23C = *(PANE *)(a1 + 4);
    a3 = a1 + 0x18;
  }
  VFX_pane_wipe((PANE *)(a1 + 4), *(unsigned __int8 *)(a1 + 0x4F2E));
  sub_15948(a1 + 0x2D3E, a1);
  sub_19AE8(a1);
  sub_15948(a1 + 0x253A, a1);
  if ( *(_DWORD *)(a1 + 0x5046) )
  {
    sub_15D74(a1 + 0x3542, a1);
  }
  if ( !*(_DWORD *)(a1 + 0xAF) )
  {
    v4 = *(_BYTE *)(a1 + 0xB7);
    if ( v4 == 2 || v4 == 3 )
    {
      sub_15DA4(a1 + 0x3542, a1, *(_WORD *)(a1 + 0xBC));
    }
  }
  if ( *(_DWORD *)(a1 + 0x503A) && (*(_BYTE *)(a1 + 0x4F2F) & 1) == 0 )
  {
    sub_1936C(a1);
  }
  if ( *(_DWORD *)(a1 + 0x5046) )
  {
    sub_15E1C((int *)(a1 + 0x3542), a1, a3);
  }
  sub_15948(a1 + 0x1D36, a1);
  Q_WINMGR_CPP_sub_53E38((PANE *)(a1 + 4), 3, 3, V_RaceIndex);
  if ( !WinMgr.wnds[dword_96BAC].a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x7AC);
  }
  v5 = *(_DWORD *)(a1 + 0xAF);
  v76 = 0;
  if ( v5 )
  {
    sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(2); // 2: "Unknown"
    v62 = 0;
    v63 = 0;
    do
    {
      v64 = sub_1CEA8[2 * v62];
      v74[2 * v63] = v64;
      if ( !v64 )
      {
        break;
      }
      v65 = sub_1CEA8[2 * v62 + 1];
      v74[2 * v63 + 1] = v65;
      ++v62;
      ++v63;
    }
    while ( v65 );
    v66 = *(_DWORD *)(a1 + 0xAF);
    v28 = 0xF3;
    switch ( *(_BYTE *)v66 )
    {
      case 0:
        v70 = *(_DWORD *)(v66 + 1) + 0x1C;
        v6 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(3);    // 3: "Sun %s"
        sprintf(v74, v6, v70);
        break;
      case 1:
        v18 = *(_DWORD *)(v66 + 1);
        v19 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(4);   // 4: "Planet %s"
        sprintf(v74, v19, v18 + 0x24);
        v20 = *(unsigned __int8 *)(v18 + 0x57);
        if ( v20 != 0xFF )
        {
          v71 = V_SpecNames[V_Game.races[v20].Unknown_01];
          v21 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(5); // 5: "\nOwned by %s"
          sprintf(v75, v21, v71);
          v22 = 0;
          v23 = 0;
          v24 = &v74[strlen(v74)];
          v25 = 0;
          do
          {
            v26 = v75[2 * v23];
            v24[2 * v25] = v26;
            if ( !v26 )
            {
              break;
            }
            v27 = v75[2 * v23 + 1];
            v24[2 * v25 + 1] = v27;
            ++v23;
            ++v25;
          }
          while ( v27 );
          LOBYTE(v22) = *(_BYTE *)(v18 + 0x57);
          v28 = 4 * V_Game.races[v22].Unknown_02 + 0x13;
        }
        break;
      case 2:
        v76 = *(_DWORD *)(v66 + 1);
        v29 = v76;
        sprintf(v74, "%s %s", V_SpecNames[V_Game.races[*(__int16 *)(v76 + 0x56)].Unknown_01], (const char *)(v76 + 0x34));
        if ( *(_WORD *)(v29 + 0x56) == V_RaceIndex && *(_BYTE *)(v29 + 0x5D) )
        {
          v30 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(6); // 6: "\nMoving to Star Lane"
          v31 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(7); // 7: "\nMoving to Planet"
          if ( *(_BYTE *)(v29 + 0x5D) != 1 )
          {
            v30 = v31;
          }
          v32 = 0;
          v33 = &v74[strlen(v74)];
          v34 = 0;
          do
          {
            v35 = v30[2 * v32];
            v33[2 * v34] = v35;
            if ( !v35 )
            {
              break;
            }
            v36 = v30[2 * v32 + 1];
            v33[2 * v34 + 1] = v36;
            ++v32;
            ++v34;
          }
          while ( v36 );
        }
        v28 = 4 * V_Game.races[*(__int16 *)(v29 + 0x56)].Unknown_02 + 0x13;
        break;
      case 3:
        v37 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(8);   // 8: "Star Lane"
        v38 = 0;
        v39 = 0;
        do
        {
          v40 = v37[2 * v38];
          v74[2 * v39] = v40;
          if ( !v40 )
          {
            break;
          }
          v41 = v37[2 * v38 + 1];
          v74[2 * v39 + 1] = v41;
          ++v38;
          ++v39;
        }
        while ( v41 );
        if ( (*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(a1 + 0xAF) + 1) + 0x23) & 1) != 0 )
        {
          v42 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(9); // 9: "Red Link"
          v43 = 0;
          v44 = 0;
          do
          {
            v45 = v42[2 * v43];
            v74[2 * v44] = v45;
            if ( !v45 )
            {
              break;
            }
            v46 = v42[2 * v43 + 1];
            v74[2 * v44 + 1] = v46;
            ++v43;
            ++v44;
          }
          while ( v46 );
        }
        v47 = *(_DWORD *)(a1 + 0xAF);
        if ( (*(_BYTE *)(v47 + 0x33) & 1) != 0 )
        {
          v48 = *(_DWORD *)(*(_DWORD *)(v47 + 1) + 4);
        }
        else
        {
          v48 = **(_DWORD **)(v47 + 1);
        }
        if ( ((1 << V_RaceIndex) & *(unsigned __int8 *)(v48 + 0x17)) != 0 )
        {
          v49 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xA);// 10: " to "
          v50 = 0;
          v51 = &v74[strlen(v74)];
          v52 = 0;
          do
          {
            v53 = v49[2 * v50];
            v51[2 * v52] = v53;
            if ( !v53 )
            {
              break;
            }
            v54 = v49[2 * v50 + 1];
            v51[2 * v52 + 1] = v54;
            ++v50;
            ++v52;
          }
          while ( v54 );
          v55 = v48 + 0x1C;
          v56 = 0;
          v57 = &v74[strlen(v74)];
          v58 = 0;
          do
          {
            v59 = *(_BYTE *)(v55 + 2 * v56);
            v57[2 * v58] = v59;
            if ( !v59 )
            {
              break;
            }
            v60 = *(_BYTE *)(v55 + 2 * v56 + 1);
            v57[2 * v58 + 1] = v60;
            ++v56;
            ++v58;
          }
          while ( v60 );
        }
        break;
      default:
        break;
    }
    v69 = v28;
    v7 = *(_DWORD *)(a1 + 0x14) - 0x1E;
    v8 = *(_DWORD *)(a1 + 0x10) - 0xC8;
    WinMgr.LargeFont.pane = V_Type6_stru_D8654.pane;
    sub_2B8A8(&WinMgr.LargeFont, v8, v7, v74, 0, v69, 0xFF, 0);
  }
  v9 = v76;
  sub_17260(a1);
  if ( v9 )
  {
    v10 = V_NougatLfExists_dword_A0CFC;
    if ( V_NougatLfExists_dword_A0CFC == TRUE )
    {
      sprintf(v73, "%s %s", V_SpecNames[V_Game.races[*(__int16 *)(v9 + 0x56)].Unknown_01], (const char *)(v9 + 0x34));
      WinMgr.SmallFont.pane = V_Type6_stru_D8654.pane;
      sub_2B8A8(&WinMgr.SmallFont, 0xFA, 0xA, v73, 0, v10, v10, 0);
      sprintf(v73, "POWER %d MOVES %d INTEGRITY %d", *(_DWORD *)(v76 + 0x88), *(_DWORD *)(v76 + 0x94), *(_DWORD *)(v76 + 0x8C));
      WinMgr.SmallFont.pane = V_Type6_stru_D8654.pane;
      sub_2B8A8(&WinMgr.SmallFont, 0xFA, 0x14, v73, 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
      qmemcpy(v72, "SONothing", sizeof(v72));
      v11 = v76;
      v12 = 0;
      v13 = 0;
      do
      {
        v14 = aInvalidOrder[2 * v12];
        v73[2 * v13] = v14;
        if ( !v14 )
        {
          break;
        }
        v15 = aInvalidOrder[2 * v12 + 1];
        v73[2 * v13 + 1] = v15;
        ++v12;
        ++v13;
      }
      while ( v15 );
      v16 = *(char *)(v11 + 0x5D);
      if ( v16 >= 0 && *(char *)(v76 + 0x5D) <= 7 )
      {
        v17 = (const char *)&v72[5 * v16];
      }
      else
      {
        v17 = v73;
      }
      WinMgr.SmallFont.pane = V_Type6_stru_D8654.pane;
      sub_2B8A8(&WinMgr.SmallFont, 0xFA, 0x1E, v17, 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
      v67 = *(_BYTE *)(v76 + 0x5D);
      if ( v67 == 1 )
      {
        v68 = (const char *)(*(_DWORD *)(v76 + 0x5E) + 0x1C);
LABEL_68:
        WinMgr.SmallFont.pane = V_Type6_stru_D8654.pane;
        sub_2B8A8(&WinMgr.SmallFont, 0x140, 0x1E, v68, 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
        goto LABEL_69;
      }
      if ( v67 == 2 )
      {
        v68 = (const char *)(*(_DWORD *)(v76 + 0x5E) + 0x24);
        goto LABEL_68;
      }
    }
  }
LABEL_69:
  sub_552CC(&WinMgr, &stru_9A23C);
}
// 96BAC: using guessed type int dword_96BAC;
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// 18CA8: using guessed type char var_60[40];
// 18CA8: using guessed type char var_B0[60];
// 18CA8: using guessed type char var_24[12];

//----- (0001936C) --------------------------------------------------------
void __fastcall sub_1936C(int a1)
{
  double v2; // st7
  int v3; // edx
  double v4; // st7
  int v5; // ebp
  float *v6; // edi
  double v7; // st7
  double v8; // st7
  float *v9; // edx
  int v10; // ecx
  int v11; // ebx
  int v12; // ebp
  float *v13; // edi
  double v14; // st7
  double v15; // st7
  float *v16; // edx
  int v17; // ecx
  int v18; // ebx
  int v19[3]; // [esp+8h] [ebp-110h] BYREF
  float v20; // [esp+14h] [ebp-104h]
  float v21; // [esp+18h] [ebp-100h]
  float v22; // [esp+1Ch] [ebp-FCh]
  float v23; // [esp+20h] [ebp-F8h]
  float v24; // [esp+24h] [ebp-F4h]
  float v25; // [esp+28h] [ebp-F0h]
  float v26; // [esp+2Ch] [ebp-ECh]
  float v27; // [esp+30h] [ebp-E8h]
  float v28; // [esp+34h] [ebp-E4h]
  T_Vector3D v29; // [esp+38h] [ebp-E0h] BYREF
  float v30; // [esp+44h] [ebp-D4h] BYREF
  float v31; // [esp+48h] [ebp-D0h]
  float v32; // [esp+4Ch] [ebp-CCh]
  float v33; // [esp+50h] [ebp-C8h] BYREF
  float v34; // [esp+54h] [ebp-C4h]
  float v35; // [esp+58h] [ebp-C0h]
  int v36[3]; // [esp+5Ch] [ebp-BCh] BYREF
  float v37; // [esp+68h] [ebp-B0h]
  float v38; // [esp+6Ch] [ebp-ACh]
  float v39; // [esp+70h] [ebp-A8h]
  int v40[3]; // [esp+74h] [ebp-A4h] BYREF
  int v41[3]; // [esp+80h] [ebp-98h] BYREF
  float v42; // [esp+8Ch] [ebp-8Ch]
  int *v43; // [esp+90h] [ebp-88h]
  int *v44; // [esp+94h] [ebp-84h]
  int v45; // [esp+98h] [ebp-80h]
  float v46; // [esp+9Ch] [ebp-7Ch]
  int *v47; // [esp+A0h] [ebp-78h]
  int *v48; // [esp+A4h] [ebp-74h]
  int v49; // [esp+A8h] [ebp-70h]
  PANE *v50; // [esp+ACh] [ebp-6Ch]
  PANE *pane; // [esp+B0h] [ebp-68h]
  int v52; // [esp+B4h] [ebp-64h]
  float *v53; // [esp+B8h] [ebp-60h]
  float *v54; // [esp+BCh] [ebp-5Ch]
  LONG parm; // [esp+C0h] [ebp-58h]
  int v56; // [esp+C4h] [ebp-54h]
  float v57; // [esp+C8h] [ebp-50h]
  int v58; // [esp+CCh] [ebp-4Ch]
  int v59; // [esp+D0h] [ebp-48h]
  int v60; // [esp+D4h] [ebp-44h]
  int v61; // [esp+D8h] [ebp-40h]
  float v62; // [esp+DCh] [ebp-3Ch]
  float v63; // [esp+E0h] [ebp-38h]
  float v64; // [esp+E4h] [ebp-34h]
  float v65; // [esp+E8h] [ebp-30h]
  float v66; // [esp+ECh] [ebp-2Ch]
  int v67; // [esp+F0h] [ebp-28h] BYREF
  int v68; // [esp+F4h] [ebp-24h] BYREF
  int v69; // [esp+F8h] [ebp-20h] BYREF
  __int16 v70[14]; // [esp+FCh] [ebp-1Ch] BYREF

  v30 = 0.0;
  v31 = 0.0;
  v32 = 0.0;
  v33 = 0.0;
  v34 = 0.0;
  v35 = 0.0;
  memset(&v29, 0, sizeof(v29));
  v2 = *(float *)(a1 + 0x4F2A) * 0.5;
  v57 = v2;
  v57 = v2 * v57;
  v45 = (int)(*(float *)(a1 + 0x4F2A) * 0.03125);
  v58 = v45 + 2;
  v45 = (int)(*(float *)(a1 + 0x4F2A) * 0.0062500001);
  v49 = 0x20 * (v58 / 2) + 0x10;
  v3 = (v45 + 2) / 2;
  v52 = 0x68;
  parm = 0x61;
  v59 = 0xA0 * v3 + 0x10;
  if ( v59 > v49 )
  {
    v59 = 0xA0 * v3 - 0x90;
  }
  v4 = *(float *)(a1 + 0x4F2A);
  v60 = 0xFFFFFFFF;
  v56 = 0;
  if ( v4 < 960.0 )
  {
    v56 = 0xFFFFFFFF;
  }
  v5 = 0;
  v64 = *(float *)(a1 + 0x4F16) * 0.125;
  v66 = (float)v49;
  if ( v58 > 0 )
  {
    v6 = (float *)(a1 + 0x1D1E);
    pane = (PANE *)(a1 + 4);
    v53 = (float *)(a1 + 0x4E86);
    do
    {
      if ( (double)v59 == v66 )
      {
        v60 = v5;
      }
      v62 = v57 - v66 * v66;
      if ( v62 > 0.0 )
      {
        v62 = sqrt(v62);
        v30 = v66;
        v31 = v64;
        v37 = 0.0;
        v32 = v62;
        v33 = v66;
        v42 = -v62;
        v34 = v64;
        v38 = 0.0;
        v35 = v42;
        v39 = 0.0;
        v44 = v36;
        v37 = v66 + *v6;
        v38 = v64 + *(float *)(a1 + 0x1D22);
        v7 = v62 + *(float *)(a1 + 0x1D26);
        *(float *)v36 = v37;
        v39 = v7;
        *(float *)&v36[1] = v38;
        *(float *)&v36[2] = v39;
        v30 = v37;
        v26 = 0.0;
        v31 = v38;
        v27 = 0.0;
        v32 = v39;
        v28 = 0.0;
        v43 = v40;
        v26 = v66 + *v6;
        v27 = v64 + *(float *)(a1 + 0x1D22);
        v8 = v42 + *(float *)(a1 + 0x1D26);
        *(float *)v40 = v26;
        v28 = v8;
        *(float *)&v40[1] = v27;
        *(float *)&v40[2] = v28;
        v33 = v26;
        v34 = v27;
        v35 = v28;
        sub_53384(&v30, v53, &v29.x);
        v9 = v53;
        sub_533D4(&v29, *(float *)(a1 + 0x4E6E), *(__int16 *)(a1 + 0x4F22), *(__int16 *)(a1 + 0x4F24), (int)&v68, (int)&v69);
        sub_53384(&v33, v9, &v29.x);
        v10 = v60;
        v11 = 0xFFFFFFFF;
        sub_533D4(&v29, *(float *)(a1 + 0x4E6E), *(__int16 *)(a1 + 0x4F22), *(__int16 *)(a1 + 0x4F24), (int)v70, (int)&v67);
        if ( v10 < 0 || (v5 - v10) % 5 )
        {
          if ( v56 )
          {
            v11 = v52;
          }
        }
        else
        {
          v11 = parm;
        }
        if ( v11 != 0xFFFFFFFF )
        {
          VFX_line_draw(pane, (__int16)v68, (__int16)v69, v70[0], (__int16)v67, 0, v11);
        }
      }
      ++v5;
      v66 = v66 + -32.0;
    }
    while ( v5 < v58 );
  }
  v65 = (float)v49;
  v12 = 0;
  v61 = 0xFFFFFFFF;
  if ( v58 > 0 )
  {
    v13 = (float *)(a1 + 0x1D1E);
    v50 = (PANE *)(a1 + 4);
    v54 = (float *)(a1 + 0x4E86);
    do
    {
      if ( (double)v59 == v65 )
      {
        v61 = v12;
      }
      v63 = v57 - v65 * v65;
      if ( v63 > 0.0 )
      {
        v63 = sqrt(v63);
        v30 = v63;
        v31 = v64;
        v46 = -v63;
        v32 = v65;
        v33 = v46;
        v34 = v64;
        v35 = v65;
        v47 = v41;
        v23 = 0.0;
        v24 = 0.0;
        v25 = 0.0;
        v23 = v63 + *v13;
        v24 = v64 + *(float *)(a1 + 0x1D22);
        v14 = v65 + *(float *)(a1 + 0x1D26);
        *(float *)v41 = v23;
        v25 = v14;
        *(float *)&v41[1] = v24;
        *(float *)&v41[2] = v25;
        v30 = v23;
        v20 = 0.0;
        v31 = v24;
        v21 = 0.0;
        v32 = v25;
        v22 = 0.0;
        v48 = v19;
        v20 = v46 + *v13;
        v21 = v64 + *(float *)(a1 + 0x1D22);
        v15 = v65 + *(float *)(a1 + 0x1D26);
        *(float *)v19 = v20;
        v22 = v15;
        *(float *)&v19[1] = v21;
        *(float *)&v19[2] = v22;
        v33 = v20;
        v34 = v21;
        v35 = v22;
        sub_53384(&v30, v54, &v29.x);
        v16 = v54;
        sub_533D4(&v29, *(float *)(a1 + 0x4E6E), *(__int16 *)(a1 + 0x4F22), *(__int16 *)(a1 + 0x4F24), (int)&v68, (int)&v69);
        sub_53384(&v33, v16, &v29.x);
        v17 = v61;
        v18 = 0xFFFFFFFF;
        sub_533D4(&v29, *(float *)(a1 + 0x4E6E), *(__int16 *)(a1 + 0x4F22), *(__int16 *)(a1 + 0x4F24), (int)v70, (int)&v67);
        if ( v17 < 0 || (v12 - v17) % 5 )
        {
          if ( v56 )
          {
            v18 = v52;
          }
        }
        else
        {
          v18 = parm;
        }
        if ( v18 != 0xFFFFFFFF )
        {
          VFX_line_draw(v50, (__int16)v68, (__int16)v69, v70[0], (__int16)v67, 0, v18);
        }
      }
      ++v12;
      v65 = v65 + -32.0;
    }
    while ( v12 < v58 );
  }
}
// 1936C: using guessed type __int16 var_1C[14];

//----- (00019AE8) --------------------------------------------------------
int __fastcall sub_19AE8(int a1)
{
  int v1; // ebp
  int v2; // kr04_4
  int v3; // kr0C_4
  int v4; // kr10_4
  int v5; // kr18_4
  int i; // kr20_4
  __int16 v7; // ax
  int result; // eax
  double v9; // st7
  __int16 type; // bx
  float v11[100]; // [esp+8h] [ebp-384h]
  char v12[200]; // [esp+198h] [ebp-1F4h] BYREF
  char v13[212]; // [esp+260h] [ebp-12Ch] BYREF
  T_Vector3D v14; // [esp+334h] [ebp-58h] BYREF
  T_Vector3D v; // [esp+340h] [ebp-4Ch] BYREF
  T_Vector3D *v16; // [esp+34Ch] [ebp-40h]
  float *v17; // [esp+350h] [ebp-3Ch]
  PANE *pane; // [esp+354h] [ebp-38h]
  T_TypeA2 *a2; // [esp+358h] [ebp-34h]
  int v20; // [esp+35Ch] [ebp-30h]
  int v21; // [esp+360h] [ebp-2Ch]
  int v22; // [esp+364h] [ebp-28h]
  int v23; // [esp+368h] [ebp-24h]
  int v24; // [esp+36Ch] [ebp-20h]
  __int16 v25; // [esp+370h] [ebp-1Ch]

  v22 = a1;
  memset(&v, 0, sizeof(v));
  a2 = WinMgr.wnds[dword_96BAC].a2;
  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x8E7);
  }
  pane = (PANE *)(v22 + 4);
  v1 = 0;
  v17 = (float *)(v22 + 0x4E46);
  v21 = (int)v13;
  v23 = 0;
  v20 = (int)v12;
  v2 = 0;
  v3 = 0;
  v4 = 0;
  v5 = 0;
  for ( i = 0; ; ++i )
  {
    result = V_Game.starsNum;
    if ( v1 >= V_Game.starsNum )
    {
      break;
    }
    v = V_Game.stars[v3].v;
    v16 = &v14;
    memset(&v13[0xC8], 0, 0xC);
    *(float *)&v13[0xC8] = v.x - V_Game.pCurStar->v.x;
    *(float *)&v13[0xCC] = v.y - V_Game.pCurStar->v.y;
    v9 = v.z - V_Game.pCurStar->v.z;
    v14 = *(T_Vector3D *)&v13[0xC8];
    *(float *)&v13[0xD0] = v9;
    v = *(T_Vector3D *)&v13[0xC8];
    v11[v2] = 0.0;
    if ( !sub_53078(&v) )
    {
      sub_53114(&v.x, v17);
      v11[v2] = v.z;
      if ( v11[v2] > 0.0 )
      {
        sub_533D4(&v, *(float *)(v22 + 0x4E6E), *(__int16 *)(v22 + 0x4F22), *(__int16 *)(v22 + 0x4F24), v21, v20);
        type = V_Game.stars[v1].type;
        v24 = (int)(sqrt(v.y * v.y + v.x * v.x + v.z * v.z) + -440.0);
        v25 = v24;
        v7 = 3;
        if ( (__int16)v24 <= 0xDC )
        {
          if ( v25 <= 0 )
          {
            if ( v25 > (int)0xFFFFFF24 )
            {
              v7 = 2;
            }
          }
          else
          {
            v7 = 1;
          }
        }
        else
        {
          v7 = 0;
        }
        VFX_shape_draw(pane, (void *)a2[1].a1.magic12345678, v7 + 4 * type, *(__int16 *)&v13[v23], *(__int16 *)&v12[v23]);
      }
    }
    ++v1;
    ++v2;
    ++v3;
    ++v4;
    ++v5;
  }
  return result;
}
// 96BAC: using guessed type int dword_96BAC;
// 19AE8: using guessed type float var_384[100];

//----- (00019E2C) --------------------------------------------------------
void __fastcall sub_19E2C(P_Wnd4BM a1, P_FileInfo pfi, int read)
{
  T_Vector3D *v4; // edi
  int *v5; // edx
  T_Wnd9RW1 *v6; // edx
  T_Wnd9RW1 *v7; // edx
  T_Wnd9RW1 *v8; // edx
  int v9; // edx
  int *v10; // edx
  int *v11; // edx
  T_Vector3D *v12; // edx
  T_Vector3D v13[100]; // [esp+0h] [ebp-3460h] BYREF
  char v14[3600]; // [esp+4B0h] [ebp-2FB0h] BYREF
  char v15[400]; // [esp+12C0h] [ebp-21A0h] BYREF
  T_Vector3D v16[100]; // [esp+1450h] [ebp-2010h] BYREF
  int v17; // [esp+1900h] [ebp-1B60h]
  int v18; // [esp+1904h] [ebp-1B5Ch]
  int v19; // [esp+1908h] [ebp-1B58h]
  T_Wnd9RW1 v20; // [esp+190Ch] [ebp-1B54h] BYREF
  float x; // [esp+19A4h] [ebp-1ABCh]
  float y; // [esp+19A8h] [ebp-1AB8h]
  float z; // [esp+19ACh] [ebp-1AB4h]
  T_Vector3D vector1; // [esp+19B0h] [ebp-1AB0h] BYREF
  T_Vector3D v25; // [esp+19BCh] [ebp-1AA4h] BYREF
  T_Vector3D v26; // [esp+19C8h] [ebp-1A98h] BYREF
  float Unknown_4F0E; // [esp+19D4h] [ebp-1A8Ch]
  float Unknown_4F12; // [esp+19D8h] [ebp-1A88h]
  float Unknown_4F16; // [esp+19DCh] [ebp-1A84h]
  float Unknown_4F1A; // [esp+19E0h] [ebp-1A80h]
  int Unknown_4F1E; // [esp+19E4h] [ebp-1A7Ch]
  __int16 Unknown_4F22; // [esp+19E8h] [ebp-1A78h]
  __int16 Unknown_4F24; // [esp+19EAh] [ebp-1A76h]
  float Unknown_4F26; // [esp+19ECh] [ebp-1A74h]
  float Unknown_4F2A; // [esp+19F0h] [ebp-1A70h]
  int Unknown_503A; // [esp+19F4h] [ebp-1A6Ch]
  int Unknown_503E; // [esp+19F8h] [ebp-1A68h]
  int Unknown_5042; // [esp+19FCh] [ebp-1A64h]
  int Unknown_5046; // [esp+1A00h] [ebp-1A60h]
  int Unknown_504A; // [esp+1A04h] [ebp-1A5Ch]
  T_Vector3D vectors1[100]; // [esp+1A08h] [ebp-1A58h] BYREF
  T_Type16 type16s[100]; // [esp+1EB8h] [ebp-15A8h] BYREF
  char v43[400]; // [esp+2CC8h] [ebp-798h] BYREF
  T_Vector3D vectors2[100]; // [esp+2E58h] [ebp-608h] BYREF
  int v45; // [esp+3308h] [ebp-158h]
  int v46; // [esp+330Ch] [ebp-154h]
  int v47; // [esp+3310h] [ebp-150h]
  T_Wnd9RW1 v48; // [esp+3314h] [ebp-14Ch] BYREF
  float v49; // [esp+33ACh] [ebp-B4h]
  float v50; // [esp+33B0h] [ebp-B0h]
  float v51; // [esp+33B4h] [ebp-ACh]
  T_Vector3D v52; // [esp+33B8h] [ebp-A8h] BYREF
  T_Vector3D v53; // [esp+33C4h] [ebp-9Ch] BYREF
  T_Vector3D v54; // [esp+33D0h] [ebp-90h] BYREF
  float v55; // [esp+33DCh] [ebp-84h]
  float v56; // [esp+33E0h] [ebp-80h]
  float v57; // [esp+33E4h] [ebp-7Ch]
  float v58; // [esp+33E8h] [ebp-78h]
  int v59; // [esp+33ECh] [ebp-74h]
  int v60; // [esp+33F0h] [ebp-70h]
  float v61; // [esp+33F4h] [ebp-6Ch]
  float v62; // [esp+33F8h] [ebp-68h]
  int v63; // [esp+33FCh] [ebp-64h]
  int v64; // [esp+3400h] [ebp-60h]
  int v65; // [esp+3404h] [ebp-5Ch]
  int v66; // [esp+3408h] [ebp-58h]
  int v67; // [esp+340Ch] [ebp-54h]
  T_FileInfo *pfi_; // [esp+3410h] [ebp-50h]
  T_Type16 *someFloats; // [esp+3414h] [ebp-4Ch]
  int *Unknown_137E; // [esp+3418h] [ebp-48h]
  T_Vector3D *v71; // [esp+341Ch] [ebp-44h]
  int *p_Unknown_80; // [esp+3420h] [ebp-40h]
  int *p_Unknown_8C; // [esp+3424h] [ebp-3Ch]
  T_Vector3D *p_vector2; // [esp+3428h] [ebp-38h]
  T_Vector3D *p_vector3; // [esp+342Ch] [ebp-34h]
  T_Vector3D *p_vector_34; // [esp+3430h] [ebp-30h]
  T_Vector3D *v77; // [esp+3434h] [ebp-2Ch]
  T_Vector3D *v78; // [esp+3438h] [ebp-28h]
  T_Matrix *p_matrix_4EEA; // [esp+343Ch] [ebp-24h]
  T_Vector3D *p_vector_4EDE; // [esp+3440h] [ebp-20h]
  int p_Unknown_74; // [esp+3444h] [ebp-1Ch]
  int *p_Unknown_1D1E; // [esp+3448h] [ebp-18h]
  T_Wnd9RW1 *p_Wnd9RW1; // [esp+344Ch] [ebp-14h]

  pfi_ = pfi;
  p_matrix_4EEA = &a1->matrix_4EEA;
  p_vector_4EDE = &a1->vector_4EDE;
  p_Wnd9RW1 = &a1->Wnd9RW1;
  p_Unknown_1D1E = &a1->Unknown_1D1E;
  v71 = a1->vectors2;
  Unknown_137E = a1->Unknown_137E;
  v4 = a1->vectors1;
  someFloats = a1->someFloats;
  p_vector3 = &a1->matrix_4EEA.vector3;
  p_vector2 = &a1->matrix_4EEA.vector2;
  p_Unknown_74 = (int)&a1->Wnd9RW1.Unknown_74;
  p_vector_34 = &a1->Wnd9RW1.vector_34;
  v77 = &a1->Wnd9RW1.matrix_00.vector3;
  v78 = &a1->Wnd9RW1.matrix_00.vector2;
  p_Unknown_8C = &a1->Wnd9RW1.Unknown_8C;
  p_Unknown_80 = &a1->Wnd9RW1.Unknown_80;
  if ( read == TRUE )
  {
    _wcpp_2_ctor_array_(vectors1, 100u, &C_Vector3D);
    _wcpp_2_ctor_array_(type16s, 100u, &C_Type16);
    _wcpp_2_ctor_array_(vectors2, 100u, &C_Vector3D);
    v45 = 0;
    v46 = 0;
    v47 = 0;
    sub_1B4F0(&v48);
    v50 = 0.0;
    v51 = 0.0;
    v49 = 0.0;
    Q_Vector3D_Clear_sub_1ACA0(&v52);
    Q_Vector3D_Clear_sub_1ACA0(&v53);
    Q_Vector3D_Clear_sub_1ACA0(&v54);
    Q_Vector3D_FromInt_sub_1AC70(&v52, 1, 0, 0);
    Q_Vector3D_FromInt_sub_1AC70(&v53, 0, 1, 0);
    Q_Vector3D_FromInt_sub_1AC70(&v54, 0, 0, 1);
    Q_ReadFile_sub_1BF94(pfi_, vectors1, 0x1A08u);
    qmemcpy(v4, vectors1, 0x4B0u);
    qmemcpy(someFloats, type16s, 0xE10u);
    qmemcpy(Unknown_137E, v43, 0x190u);
    v5 = p_Unknown_1D1E;
    qmemcpy(v71, vectors2, 0x4B0u);
    *v5 = v45;
    v5[1] = v46;
    v5[2] = v47;
    v6 = p_Wnd9RW1;
    p_Wnd9RW1->matrix_00.vector1.x = v48.matrix_00.vector1.x;
    v6->matrix_00.vector1.y = v48.matrix_00.vector1.y;
    v6->matrix_00.vector1.z = v48.matrix_00.vector1.z;
    *v78 = v48.matrix_00.vector2;
    *v77 = v48.matrix_00.vector3;
    v7 = p_Wnd9RW1;
    p_Wnd9RW1->Unknown_24 = v48.Unknown_24;
    v7->Unknown_28 = v48.Unknown_28;
    v7->Unknown_2C = v48.Unknown_2C;
    v7->Unknown_30 = v48.Unknown_30;
    *p_vector_34 = v48.vector_34;
    v8 = p_Wnd9RW1;
    p_Wnd9RW1->Unknown_40 = v48.Unknown_40;
    v8->Unknown_44 = v48.Unknown_44;
    v8->Unknown_48 = v48.Unknown_48;
    v8->Unknown_4C = v48.Unknown_4C;
    v8->Unknown_50 = v48.Unknown_50;
    v8->Unknown_54 = v48.Unknown_54;
    v8->Unknown_58 = v48.Unknown_58;
    v8->Unknown_5C = v48.Unknown_5C;
    v8->Unknown_60 = v48.Unknown_60;
    v8->Unknown_64 = v48.Unknown_64;
    v8->Unknown_68 = v48.Unknown_68;
    v8->Unknown_6C = v48.Unknown_6C;
    v8->Unknown_70 = v48.Unknown_70;
    v9 = p_Unknown_74;
    *(float *)p_Unknown_74 = v48.Unknown_74;
    *(_DWORD *)(v9 + 4) = v48.Unknown_78;
    *(_DWORD *)(v9 + 8) = v48.Unknown_7C;
    v10 = p_Unknown_80;
    *p_Unknown_80 = v48.Unknown_80;
    v10[1] = LODWORD(v48.Unknown_84);
    v10[2] = v48.Unknown_88;
    v11 = p_Unknown_8C;
    *p_Unknown_8C = v48.Unknown_8C;
    v11[1] = v48.Unknown_90;
    v11[2] = LODWORD(v48.Unknown_94);
    v12 = p_vector_4EDE;
    p_vector_4EDE->x = v49;
    v12->y = v50;
    v12->z = v51;
    p_matrix_4EEA->vector1 = v52;
    *p_vector2 = v53;
    *p_vector3 = v54;
    a1->Unknown_4F0E = v55;
    a1->Unknown_4F12 = v56;
    a1->Unknown_4F16 = v57;
    a1->Unknown_4F1A = v58;
    a1->Unknown_4F1E = v59;
    *(_DWORD *)&a1->Unknown_4F22 = v60;
    a1->Unknown_4F26 = v61;
    a1->Unknown_4F2A = v62;
    a1->Unknown_503A = v63;
    a1->Unknown_503E = v64;
    a1->Unknown_5042 = v65;
    a1->Unknown_5046 = v66;
    a1->Unknown_504A = v67;
    Q_Ret_sub_1B66C();
    Q_DestructVectors_sub_1A9E0(vectors2);
    sub_1AA00(type16s);
    Q_DestructVectors_sub_1A9E0(vectors1);
  }
  else
  {
    _wcpp_2_ctor_array_(v13, 0x64u, &C_Vector3D);
    _wcpp_2_ctor_array_(v14, 0x64u, &C_Type16);
    _wcpp_2_ctor_array_(v16, 0x64u, &C_Vector3D);
    v17 = 0;
    v18 = 0;
    v19 = 0;
    sub_1B4F0(&v20);
    y = 0.0;
    z = 0.0;
    x = 0.0;
    Q_Vector3D_Clear_sub_1ACA0(&vector1);
    Q_Vector3D_Clear_sub_1ACA0(&v25);
    Q_Vector3D_Clear_sub_1ACA0(&v26);
    Q_Vector3D_FromInt_sub_1AC70(&vector1, 1, 0, 0);
    Q_Vector3D_FromInt_sub_1AC70(&v25, 0, 1, 0);
    Q_Vector3D_FromInt_sub_1AC70(&v26, 0, 0, 1);
    qmemcpy(v13, v4, sizeof(v13));
    qmemcpy(v14, someFloats, sizeof(v14));
    qmemcpy(v15, Unknown_137E, sizeof(v15));
    qmemcpy(v16, v71, sizeof(v16));
    v17 = *p_Unknown_1D1E;
    v18 = p_Unknown_1D1E[1];
    v19 = p_Unknown_1D1E[2];
    v20.matrix_00.vector1.x = p_Wnd9RW1->matrix_00.vector1.x;
    v20.matrix_00.vector1.y = p_Wnd9RW1->matrix_00.vector1.y;
    v20.matrix_00.vector1.z = p_Wnd9RW1->matrix_00.vector1.z;
    v20.matrix_00.vector2 = *v78;
    v20.matrix_00.vector3 = *v77;
    v20.Unknown_24 = p_Wnd9RW1->Unknown_24;
    v20.Unknown_28 = p_Wnd9RW1->Unknown_28;
    v20.Unknown_2C = p_Wnd9RW1->Unknown_2C;
    v20.Unknown_30 = p_Wnd9RW1->Unknown_30;
    v20.vector_34 = *p_vector_34;
    v20.Unknown_40 = p_Wnd9RW1->Unknown_40;
    v20.Unknown_44 = p_Wnd9RW1->Unknown_44;
    v20.Unknown_48 = p_Wnd9RW1->Unknown_48;
    v20.Unknown_4C = p_Wnd9RW1->Unknown_4C;
    v20.Unknown_50 = p_Wnd9RW1->Unknown_50;
    v20.Unknown_54 = p_Wnd9RW1->Unknown_54;
    v20.Unknown_58 = p_Wnd9RW1->Unknown_58;
    v20.Unknown_5C = p_Wnd9RW1->Unknown_5C;
    v20.Unknown_60 = p_Wnd9RW1->Unknown_60;
    v20.Unknown_64 = p_Wnd9RW1->Unknown_64;
    v20.Unknown_68 = p_Wnd9RW1->Unknown_68;
    v20.Unknown_6C = p_Wnd9RW1->Unknown_6C;
    v20.Unknown_70 = p_Wnd9RW1->Unknown_70;
    v20.Unknown_74 = *(float *)p_Unknown_74;
    v20.Unknown_78 = *(_DWORD *)(p_Unknown_74 + 4);
    v20.Unknown_7C = *(_DWORD *)(p_Unknown_74 + 8);
    v20.Unknown_80 = *p_Unknown_80;
    LODWORD(v20.Unknown_84) = p_Unknown_80[1];
    v20.Unknown_88 = p_Unknown_80[2];
    v20.Unknown_8C = *p_Unknown_8C;
    v20.Unknown_90 = p_Unknown_8C[1];
    LODWORD(v20.Unknown_94) = p_Unknown_8C[2];
    x = p_vector_4EDE->x;
    y = p_vector_4EDE->y;
    z = p_vector_4EDE->z;
    vector1 = p_matrix_4EEA->vector1;
    v25 = *p_vector2;
    v26 = *p_vector3;
    Unknown_4F0E = a1->Unknown_4F0E;
    Unknown_4F12 = a1->Unknown_4F12;
    Unknown_4F16 = a1->Unknown_4F16;
    Unknown_4F1A = a1->Unknown_4F1A;
    Unknown_4F1E = a1->Unknown_4F1E;
    Unknown_4F22 = a1->Unknown_4F22;
    Unknown_4F24 = a1->Unknown_4F24;
    Unknown_4F26 = a1->Unknown_4F26;
    Unknown_4F2A = a1->Unknown_4F2A;
    Unknown_503A = a1->Unknown_503A;
    Unknown_503E = a1->Unknown_503E;
    Unknown_5042 = a1->Unknown_5042;
    Unknown_5046 = a1->Unknown_5046;
    Unknown_504A = a1->Unknown_504A;
    Q_CFILE_CPP_dos_write_sub_1C098(&pfi_->fh, v13, 0x1A08u);
    Q_Ret_sub_1B66C();
    Q_DestructVectors_sub_1A9E0(v16);
    sub_1AA00(v14);
    Q_DestructVectors_sub_1A9E0(v13);
  }
}

//----- (0001A9C0) --------------------------------------------------------
void *__fastcall sub_1A9C0(void *result)
{
  _wcpp_2_dtor_array_(result, 0xF, &C_Vector3D);
  return result;
}

//----- (0001A9E0) --------------------------------------------------------
void __fastcall __spoils<edx> Q_DestructVectors_sub_1A9E0(P_Vector3D a1)
{
  _wcpp_2_dtor_array_(a1, 100, &C_Vector3D);
}

//----- (0001AA00) --------------------------------------------------------
void *__fastcall sub_1AA00(void *result)
{
  _wcpp_2_dtor_array_(result, 100, &C_Type16);
  return result;
}

//----- (0001AA20) --------------------------------------------------------
void *__fastcall Q_NC_sub_1AA20(void *result)
{
  _wcpp_2_dtor_array_(result, 4, &C_Vector3D);
  return result;
}

//----- (0001AA40) --------------------------------------------------------
void __fastcall sub_1AA40(P_Type16 a1, P_Type16 a2)
{
  *a1 = *a2;
}

//----- (0001AA90) --------------------------------------------------------
T_Vector3D *__fastcall sub_1AA90(int a1)
{
  T_Vector3D *result; // eax

  Q_Ret_sub_1B66C();
  Q_DestructVectors_sub_1A9E0((P_Vector3D)(a1 + 0x1450));
  result = (T_Vector3D *)((char *)sub_1AA00((void *)(a1 + 0x4B0)) + 0xFFFFFB50);
  Q_DestructVectors_sub_1A9E0(result);
  return result;
}

//----- (0001AAC0) --------------------------------------------------------
_DWORD *__fastcall sub_1AAC0(_DWORD *result)
{
  _wcpp_2_ctor_array_(result, 0x64u, &C_Vector3D);
  _wcpp_2_ctor_array_(result + 0x12C, 0x64u, &C_Type16);
  _wcpp_2_ctor_array_(result + 0x514, 0x64u, &C_Vector3D);
  result[0x640] = 0;
  result[0x641] = 0;
  result[0x642] = 0;
  sub_1B4F0((P_Wnd9RW1)(result + 0x643));
  result[0x669] = 0;
  result[0x66A] = 0;
  result[0x66B] = 0;
  result[0x66C] = 0;
  result[0x66D] = 0;
  result[0x66E] = 0;
  result[0x66F] = 0;
  result[0x670] = 0;
  result[0x671] = 0;
  result[0x672] = 0;
  result[0x673] = 0;
  result[0x674] = 0;
  result[0x66D] = 0;
  result[0x66E] = 0;
  result[0x66C] = 0x3F800000;
  result[0x66F] = 0;
  result[0x670] = 0x3F800000;
  result[0x671] = 0;
  result[0x672] = 0;
  result[0x673] = 0;
  result[0x674] = 0x3F800000;
  return result;
}

//----- (0001ABE0) --------------------------------------------------------
void __fastcall __spoils<> sub_1ABE0(P_Type16 a1)
{
  a1->Unknown_00 = 0.0;
  a1->Unknown_04 = 0.0;
  a1->Unknown_08 = 0.0;
  a1->Unknown_0C = 0.0;
  a1->Unknown_10 = 0.0;
  a1->Unknown_14 = 0.0;
  a1->Unknown_18 = 0.0;
  a1->Unknown_1C = 0.0;
  a1->Unknown_20 = 0.0;
  a1->Unknown_04 = 0.0;
  a1->Unknown_08 = 0.0;
  a1->Unknown_00 = 1.0;
  a1->Unknown_0C = 0.0;
  a1->Unknown_10 = 1.0;
  a1->Unknown_14 = 0.0;
  a1->Unknown_18 = 0.0;
  a1->Unknown_1C = 0.0;
  a1->Unknown_20 = 1.0;
}

//----- (0001AC70) --------------------------------------------------------
void __fastcall Q_Vector3D_FromInt_sub_1AC70(P_Vector3D a1, int x, int y, int z)
{
  a1->x = (float)x;
  a1->y = (float)y;
  a1->z = (float)z;
}

//----- (0001ACA0) --------------------------------------------------------
void __fastcall Q_Vector3D_Clear_sub_1ACA0(P_Vector3D a1)
{
  a1->x = 0.0;
  a1->y = 0.0;
  a1->z = 0.0;
}

//----- (0001ACC0) --------------------------------------------------------
void __fastcall __spoils<> sub_1ACC0(int a1)
{
  *(_DWORD *)(a1 + 0x2EE4) = 0;
  *(_DWORD *)(a1 + 0x2EE8) = 0;
  *(_WORD *)(a1 + 0x2EE0) = 0;
  *(_WORD *)(a1 + 0x2EE2) = 0;
  sub_1ACE8(a1);
}

//----- (0001ACE8) --------------------------------------------------------
void __fastcall __spoils<> sub_1ACE8(int a1)
{
  *(_DWORD *)(a1 + 0x2EEC) = 0xFFFFFFFF;
}

//----- (0001ACF4) --------------------------------------------------------
void __fastcall __spoils<> sub_1ACF4(P_Type13 a1)
{
  sub_262CC(a1->pShapeCache);
  a1->pShapeCache = 0;
  a1->size = 0;
}

//----- (0001AD1C) --------------------------------------------------------
void __fastcall Q_CACHE_CPP_ShapeCache_sub_1AD1C(P_Type13 a1, int a2)
{
  void *v3; // eax
  int v4; // kr04_4
  int v5; // kr0C_4
  int size; // [esp+0h] [ebp-4h]

  size = a2 + 3;
  LOBYTE(size) = (a2 + 3) & 0xFC;
  v3 = operator new[](size);
  Q_RegisterData_sub_2625C(v3, 5, "SHAPE CACHE");
  a1->pShapeCache = v3;
  if ( !v3 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0x41);
  }
  a1->a = 0;
  a1->b = 0;
  a1->size = size;
  v4 = 0;
  v5 = 0;
  do
  {
    a1->z1[v4] = 0;
    a1->name[v5][0] = 0;
    a1->z2[v4++] = 0;
    ++v5;
  }
  while ( v4 != 0xC8 );
}

//----- (0001ADAC) --------------------------------------------------------
int __fastcall Q_CACHE_CPP_sub_1ADAC(P_Type13 a1, const char *filename)
{
  int len; // kr04_4
  int i; // edx
  int j; // kr08_4
  int v7; // kr10_4
  char *v8; // kr14_4
  int v9; // kr18_4
  char v10; // al
  char v11; // al

  if ( !a1->pShapeCache )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cache.cpp", 0x53);
  }
  len = strlen(filename) + 1;
  if ( len - 1 <= 0 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0x59);
  }
  if ( len - 1 >= 50 )
  {
    sub_2620C("Cache filename too long: %s", (char)filename);
    sub_261B8(0, "..\\cache.cpp", 0x5B);
  }
  if ( a1->a >= 200 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0x5C);
  }
  i = 0;
  for ( j = 0; a1->name[j][0]; ++j )
  {
    if ( ++i >= 200 )
    {
      return 0xFFFF;
    }
  }
  v7 = 0;
  v8 = a1->name[i];
  v9 = 0;
  do
  {
    v10 = filename[2 * v7];
    v8[2 * v9] = v10;
    if ( !v10 )
    {
      break;
    }
    v11 = filename[2 * v7 + 1];
    v8[2 * v9 + 1] = v11;
    ++v7;
    ++v9;
  }
  while ( v11 );
  ++a1->a;
  return i;
}

//----- (0001AEB0) --------------------------------------------------------
int __fastcall sub_1AEB0(P_Type13 pt13, unsigned __int16 a2, const char *a3)
{
  unsigned int v4; // kr04_4
  int v5; // eax
  int result; // eax
  int v7; // kr08_4
  char *v8; // kr0C_4
  int v9; // kr10_4
  char v10; // al
  char v11; // al

  if ( !pt13->pShapeCache )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cache.cpp", 0x70);
  }
  v4 = strlen(a3) + 1;
  if ( (int)(v4 - 1) <= 0 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0x74);
  }
  if ( (int)(v4 - 1) >= 0x32 )
  {
    sub_2620C("Cache filename too long: %s", (char)a3);
    sub_261B8(0, "..\\cache.cpp", 0x76);
  }
  if ( pt13->a >= 0xC8 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0x77);
  }
  if ( a2 >= 0xC8u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cache.cpp", 0x78);
  }
  v5 = a2;
  if ( pt13->name[v5][0] )
  {
    if ( !stricmp(a3, pt13->name[v5]) )
    {
      return 0xFFFFFFFF;
    }
    sub_1B000((unsigned int)pt13, a2);
  }
  v7 = 0;
  v8 = pt13->name[a2];
  v9 = 0;
  do
  {
    v10 = a3[2 * v7];
    v8[2 * v9] = v10;
    if ( !v10 )
    {
      break;
    }
    v11 = a3[2 * v7 + 1];
    v8[2 * v9 + 1] = v11;
    ++v7;
    ++v9;
  }
  while ( v11 );
  result = 0xFFFFFFFF;
  ++pt13->a;
  return result;
}

//----- (0001B000) --------------------------------------------------------
int __fastcall sub_1B000(unsigned int a1, unsigned __int16 a2)
{
  int result; // eax

  if ( a2 >= 0xC8u )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0x95);
  }
  if ( !*(_BYTE *)(a1 + 0x32 * a2 + 0x7D0) )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0x96);
  }
  sub_1B354(a1, a2);
  result = 0x19 * a2;
  *(_BYTE *)(a1 + 0x32 * a2 + 0x7D0) = 0;
  --*(_WORD *)(a1 + 0x2EE0);
  return result;
}

//----- (0001B084) --------------------------------------------------------
void *__fastcall Q_CACHE_CPP_GetShapeTable_sub_1B084(unsigned int a1, int a2)
{
  unsigned __int16 v3; // di
  int FileLength_sub_1BE28; // eax
  int v5; // ecx
  void *v6; // edx
  int v8; // eax
  int i; // kr04_4
  int j; // kr0C_4
  int v11; // ebx
  T_FileInfo v12; // [esp+0h] [ebp-12Ch] BYREF

  v3 = a2;
  if ( !*(_DWORD *)(a1 + 0x2EEC) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cache.cpp", 0xA2);
  }
  if ( (unsigned __int16)a2 >= 0xC8u )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0xA6);
  }
  if ( !*(_BYTE *)(a1 + 0x32 * (unsigned __int16)a2 + 0x7D0) )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0xA7);
  }
  HIWORD(a2) = 0;
  if ( *(_DWORD *)(a1 + 4 * (unsigned __int16)a2) )
  {
    v8 = 0;
    for ( i = 0; v8 < *(__int16 *)(a1 + 0x2EE2) && (_WORD)a2 != *(_WORD *)(a1 + 2 * i + 0x640); ++i )
    {
      ++v8;
    }
    for ( j = 0; ; ++j )
    {
      v11 = *(__int16 *)(a1 + 0x2EE2);
      if ( v8 >= v11 )
      {
        break;
      }
      *(_WORD *)(a1 + 2 * (v8 + 1) + 2 * j + 2 + 0x63E) = *(_WORD *)(a1 + 2 * (v8 + 1) + 2 * j + 2 + 0x640);
      ++v8;
    }
    *(_WORD *)(a1 + 2 * v11 + 0x63E) = a2;
    return *(void **)(a1 + 4 * (unsigned __int16)a2);
  }
  else
  {
    Q_InitFileInfo_sub_1BB78(&v12);
    Q_OpenFile_sub_1BBFC(&v12, (const char *)(0x32 * a2 + a1 + 0x7D0), 0x200, 0);
    FileLength_sub_1BE28 = Q_GetFileLength_sub_1BE28(&v12);
    v5 = FileLength_sub_1BE28 + 3;
    LOBYTE(v5) = (FileLength_sub_1BE28 + 3) & 0xFC;
    if ( v5 >= *(_DWORD *)(a1 + 0x2EE8) )
    {
      sub_2620C("Single item too big for cache: %s, %d", 0x32 * a2 + a1 - 0x30);
      sub_261B8(0, "..\\cache.cpp", 0xB8);
    }
    *(_DWORD *)(a1 + 4 * v3) = sub_1B2DC(a1, v5);
    v6 = *(void **)(a1 + 4 * v3);
    *(_DWORD *)(a1 + 4 * v3 + 0x320) = v5;
    if ( !Q_CfileLoad_sub_1BF1C(&v12, v6) )
    {
      sub_2620C("Cache unable to load file: %s", 0x32 * v3 + a1 - 0x30);
      sub_261B8(0, "..\\cache.cpp", 0xC0);
    }
    *(_WORD *)(a1 + 2 * (__int16)(*(_WORD *)(a1 + 0x2EE2))++ + 0x640) = v3;
    Q_CloseFileAndDelete_sub_1BBC8(&v12);
    return *(void **)(a1 + 4 * v3);
  }
}

//----- (0001B270) --------------------------------------------------------
int __fastcall sub_1B270(T_Type13 *a1, const char *filename, int a3)
{
  int j; // ecx
  T_Name50 *name; // kr00_4
  int i; // kr04_4
  int v8; // [esp+0h] [ebp-14h]

  j = 0;
  v8 = 0xFFFF;
  name = a1->name;
  i = 0;
  while ( j < a1->a )
  {
    if ( !stricmp(filename, name[i]) )
    {
      v8 = j;
      break;
    }
    ++j;
    ++i;
  }
  if ( a3 == TRUE && (unsigned __int16)v8 == 0xFFFF )
  {
    return Q_CACHE_CPP_sub_1ADAC(a1, filename);
  }
  return v8;
}

//----- (0001B2DC) --------------------------------------------------------
int __fastcall sub_1B2DC(unsigned int a1, int a2)
{
  int v4; // esi
  int i; // kr04_4
  int v6; // edi
  int result; // eax
  int j; // esi
  unsigned __int16 v9; // dx

  v4 = 0;
  for ( i = 0; i != 0xC8; ++i )
  {
    v4 += *(_DWORD *)(a1 + 4 * i + 0x320);
  }
  v6 = 0;
  result = v4 + *(_DWORD *)(a1 + 0x2EE4);
  for ( j = *(_DWORD *)(a1 + 0x2EE8) - v4; j <= a2; result = sub_1B354(a1, v9) )
  {
    if ( v6 >= *(__int16 *)(a1 + 0x2EE0) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\cache.cpp", 0xFF);
    }
    v9 = *(_WORD *)(a1 + 0x640);
    j += *(_DWORD *)(a1 + 4 * v9 + 0x320);
    ++v6;
  }
  return result;
}

//----- (0001B354) --------------------------------------------------------
int __fastcall sub_1B354(unsigned int a1, unsigned __int16 a2)
{
  int v4; // edx
  int i; // kr04_4
  void *v6; // edx
  int v7; // ebx
  int j; // kr0C_4
  signed int v9; // eax
  int k; // kr14_4
  int v11; // kr1C_4
  unsigned int v12; // [esp+0h] [ebp-20h]
  int v13; // [esp+4h] [ebp-1Ch]
  int v14; // [esp+4h] [ebp-1Ch]

  if ( a2 >= 0xC8u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cache.cpp", 0x10D);
  }
  if ( !*(_DWORD *)(a1 + 4 * a2) )
  {
    return 0;
  }
  v4 = 0;
  for ( i = 0; i != 0xC8; ++i )
  {
    v4 += *(_DWORD *)(a1 + 4 * i + 0x320);
  }
  v13 = v4 + *(_DWORD *)(a1 + 0x2EE4);
  v12 = 4 * a2 + a1;
  v6 = *(void **)v12;
  v7 = *(_DWORD *)(v12 + 0x320);
  qmemcpy(*(void **)v12, (const void *)(*(_DWORD *)v12 + v7), v13 - (*(_DWORD *)v12 + v7));
  *(_DWORD *)v12 = 0;
  *(_DWORD *)(v12 + 0x320) = 0;
  for ( j = 0; j != 0xC8; ++j )
  {
    if ( (unsigned int)v6 < *(_DWORD *)(a1 + 4 * j) )
    {
      *(_DWORD *)(a1 + 4 * j) -= v7;
    }
  }
  v9 = (a1 + 0x320) ^ a1;
  v14 = v13 - v7;
  --*(_WORD *)(a1 + 0x2EE2);
  for ( k = 0; v9 < *(__int16 *)(a1 + 0x2EE2) && a2 != *(_WORD *)(a1 + 2 * k + 0x640); ++k )
  {
    ++v9;
  }
  v11 = 0;
  while ( v9 < *(__int16 *)(a1 + 0x2EE2) )
  {
    *(_WORD *)(a1 + 2 * (v9 + 1) + 2 * v11 + 2 + 0x63E) = *(_WORD *)(a1 + 2 * (v9 + 1) + 2 * v11 + 2 + 0x640);
    ++v9;
    ++v11;
  }
  return v14;
}

//----- (0001B498) --------------------------------------------------------
_DWORD *__fastcall sub_1B498(_DWORD *result)
{
  int v1; // edx
  int v2; // kr04_4

  v1 = 0;
  v2 = 0;
  while ( v1 < *((__int16 *)result + 0x1770) )
  {
    result[v2] = 0;
    ++v1;
    result[v2++ + 0xC8] = 0;
  }
  *((_WORD *)result + 0x1771) = 0;
  return result;
}

//----- (0001B4D0) --------------------------------------------------------
_DWORD *__fastcall sub_1B4D0(_DWORD *a1)
{
  _DWORD *result; // eax

  result = sub_1B498(a1);
  a1[0xBBB] = 0;
  return result;
}

//----- (0001B4F0) --------------------------------------------------------
void __fastcall __spoils<> sub_1B4F0(P_Wnd9RW1 a1)
{
  a1->matrix_00.vector1.x = 0.0;
  a1->matrix_00.vector1.y = 0.0;
  a1->matrix_00.vector1.z = 0.0;
  a1->matrix_00.vector2.x = 0.0;
  a1->matrix_00.vector2.y = 0.0;
  a1->matrix_00.vector2.z = 0.0;
  a1->matrix_00.vector3.x = 0.0;
  a1->matrix_00.vector3.y = 0.0;
  a1->matrix_00.vector3.z = 0.0;
  a1->matrix_00.vector1.y = 0.0;
  a1->matrix_00.vector1.z = 0.0;
  a1->matrix_00.vector1.x = 1.0;
  a1->matrix_00.vector2.x = 0.0;
  a1->matrix_00.vector2.y = 1.0;
  a1->matrix_00.vector2.z = 0.0;
  a1->matrix_00.vector3.x = 0.0;
  a1->matrix_00.vector3.y = 0.0;
  a1->matrix_00.vector3.z = 1.0;
  a1->vector_34.x = 0.0;
  a1->vector_34.y = 0.0;
  a1->vector_34.z = 0.0;
  a1->Unknown_68 = 1.0;
  a1->Unknown_6C = 0;
  a1->Unknown_54 = a1->Unknown_68;
  a1->Unknown_40 = a1->Unknown_54;
  a1->Unknown_64 = a1->Unknown_6C;
  a1->Unknown_60 = a1->Unknown_64;
  a1->Unknown_5C = a1->Unknown_60;
  a1->Unknown_58 = a1->Unknown_5C;
  a1->Unknown_50 = a1->Unknown_58;
  a1->Unknown_4C = a1->Unknown_50;
  a1->Unknown_48 = a1->Unknown_4C;
  a1->Unknown_44 = a1->Unknown_48;
  a1->Unknown_74 = 0.0;
  a1->Unknown_78 = 0;
  a1->Unknown_7C = 0;
  a1->Unknown_80 = 0;
  a1->Unknown_84 = 0.0;
  a1->Unknown_88 = 0;
  a1->Unknown_90 = 0;
  a1->Unknown_94 = 0.0;
  a1->Unknown_8C = 0;
  a1->Unknown_74 = 1.0;
  a1->Unknown_78 = 0;
  a1->Unknown_7C = 0;
  a1->Unknown_80 = 0;
  a1->Unknown_84 = 1.0;
  a1->Unknown_88 = 0;
  a1->Unknown_8C = 0;
  a1->Unknown_90 = 0;
  a1->Unknown_94 = 1.0;
}

//----- (0001B670) --------------------------------------------------------
_DWORD *__fastcall Q_NC_sub_1B670(_DWORD *a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8)
{
  *a1 = 0;
  a1[1] = 0;
  a1[2] = 0;
  a1[3] = 0;
  a1[4] = 0;
  a1[5] = 0;
  a1[6] = 0;
  a1[7] = 0;
  a1[8] = 0;
  a1[1] = 0;
  a1[2] = 0;
  *a1 = 0x3F800000;
  a1[3] = 0;
  a1[4] = 0x3F800000;
  a1[5] = 0;
  a1[6] = 0;
  a1[7] = 0;
  a1[8] = 0x3F800000;
  a1[0xD] = 0;
  a1[0xE] = 0;
  a1[0xF] = 0;
  a1[0x1A] = 0x3F800000;
  a1[0x1B] = 0;
  a1[0x15] = a1[0x1A];
  a1[0x10] = a1[0x15];
  a1[0x19] = a1[0x1B];
  a1[0x18] = a1[0x19];
  a1[0x17] = a1[0x18];
  a1[0x16] = a1[0x17];
  a1[0x14] = a1[0x16];
  a1[0x13] = a1[0x14];
  a1[0x12] = a1[0x13];
  a1[0x11] = a1[0x12];
  a1[0x1D] = 0;
  a1[0x1E] = 0;
  a1[0x1F] = 0;
  a1[0x20] = 0;
  a1[0x21] = 0;
  a1[0x22] = 0;
  a1[0x24] = 0;
  a1[0x25] = 0;
  a1[0x23] = 0;
  a1[0x1D] = 0x3F800000;
  a1[0x1E] = 0;
  a1[0x1F] = 0;
  a1[0x20] = 0;
  a1[0x21] = 0x3F800000;
  a1[0x22] = 0;
  a1[0x23] = 0;
  a1[0x24] = 0;
  a1[0x25] = 0x3F800000;
  sub_1B808((P_Wnd9RW1)a1, *(float *)&a5, *(float *)&a6, *(float *)&a7, a8);
  return a1;
}

//----- (0001B808) --------------------------------------------------------
void __userpurge sub_1B808(P_Wnd9RW1 a1@<eax>, float a2, float a3, float a4, int a5)
{
  a1->Unknown_24 = a2;
  a1->Unknown_2C = a3;
  a1->Unknown_30 = a4;
  a1->Unknown_70 = 1.0;
  sub_1B834(a1, a5);
}

//----- (0001B834) --------------------------------------------------------
void __fastcall sub_1B834(P_Wnd9RW1 a1, int a2)
{
  a1->Unknown_28 = (double)a2 / tan(a1->Unknown_24 * 0.017453292 * 0.5);
}

//----- (0001B864) --------------------------------------------------------
float *__fastcall sub_1B864(int a1, int a2, int a3, int a4)
{
  double v4; // st7
  int v6[9]; // [esp+0h] [ebp-70h] BYREF
  int v7[9]; // [esp+24h] [ebp-4Ch] BYREF
  float v8; // [esp+48h] [ebp-28h]
  float v9; // [esp+4Ch] [ebp-24h]
  float v10; // [esp+50h] [ebp-20h]
  int v11[7]; // [esp+54h] [ebp-1Ch] BYREF

  v11[3] = (int)v11;
  v8 = 0.0;
  v9 = 0.0;
  v10 = 0.0;
  v8 = -*(float *)(a1 + 0x34);
  v9 = -*(float *)(a1 + 0x38);
  v4 = -*(float *)(a1 + 0x3C);
  *(float *)v11 = v8;
  v10 = v4;
  *(float *)&v11[1] = v9;
  *(float *)&v11[2] = v10;
  v6[0] = *(_DWORD *)(a1 + 0x74);
  v6[1] = *(_DWORD *)(a1 + 0x78);
  v6[2] = *(_DWORD *)(a1 + 0x7C);
  v6[3] = *(_DWORD *)(a1 + 0x80);
  v6[4] = *(_DWORD *)(a1 + 0x84);
  v6[5] = *(_DWORD *)(a1 + 0x88);
  v6[6] = *(_DWORD *)(a1 + 0x8C);
  v6[7] = *(_DWORD *)(a1 + 0x90);
  v6[8] = *(_DWORD *)(a1 + 0x94);
  v7[0] = *(_DWORD *)a1;
  v7[1] = *(_DWORD *)(a1 + 4);
  v7[2] = *(_DWORD *)(a1 + 8);
  v7[3] = *(_DWORD *)(a1 + 0xC);
  v7[4] = *(_DWORD *)(a1 + 0x10);
  v7[5] = *(_DWORD *)(a1 + 0x14);
  v7[6] = *(_DWORD *)(a1 + 0x18);
  v7[7] = *(_DWORD *)(a1 + 0x1C);
  v7[8] = *(_DWORD *)(a1 + 0x20);
  return sub_53B08((float *)(a1 + 0x40), (float *)v7, (float *)v6, (float *)v11);
}

//----- (0001B958) --------------------------------------------------------
float *__fastcall sub_1B958(int a1, float *a2, int a3, int a4)
{
  int v5[9]; // [esp+0h] [ebp-88h] BYREF
  int v6[9]; // [esp+24h] [ebp-64h] BYREF
  int v7[3]; // [esp+48h] [ebp-40h] BYREF
  float v8; // [esp+54h] [ebp-34h]
  int v9; // [esp+58h] [ebp-30h]
  int v10; // [esp+5Ch] [ebp-2Ch]
  float v11; // [esp+60h] [ebp-28h]
  float v12; // [esp+64h] [ebp-24h]
  float v13; // [esp+68h] [ebp-20h]
  int v14[7]; // [esp+6Ch] [ebp-1Ch] BYREF

  v14[3] = (int)v7;
  v11 = 0.0;
  v12 = 0.0;
  v13 = 0.0;
  v11 = *a2 + *(float *)(a1 + 0x34);
  v12 = a2[1] + *(float *)(a1 + 0x38);
  v13 = a2[2] + *(float *)(a1 + 0x3C);
  *(float *)v7 = v11;
  v8 = -v11;
  *(float *)&v7[1] = v12;
  *(float *)&v9 = -v12;
  *(float *)&v7[2] = v13;
  v14[4] = (int)v14;
  *(float *)v14 = v8;
  *(float *)&v10 = -v13;
  v14[1] = v9;
  v14[2] = v10;
  v6[0] = *(_DWORD *)(a1 + 0x74);
  v6[1] = *(_DWORD *)(a1 + 0x78);
  v6[2] = *(_DWORD *)(a1 + 0x7C);
  v6[3] = *(_DWORD *)(a1 + 0x80);
  v6[4] = *(_DWORD *)(a1 + 0x84);
  v6[5] = *(_DWORD *)(a1 + 0x88);
  v6[6] = *(_DWORD *)(a1 + 0x8C);
  v6[7] = *(_DWORD *)(a1 + 0x90);
  v6[8] = *(_DWORD *)(a1 + 0x94);
  v5[0] = *(_DWORD *)a1;
  v5[1] = *(_DWORD *)(a1 + 4);
  v5[2] = *(_DWORD *)(a1 + 8);
  v5[3] = *(_DWORD *)(a1 + 0xC);
  v5[4] = *(_DWORD *)(a1 + 0x10);
  v5[5] = *(_DWORD *)(a1 + 0x14);
  v5[6] = *(_DWORD *)(a1 + 0x18);
  v5[7] = *(_DWORD *)(a1 + 0x1C);
  v5[8] = *(_DWORD *)(a1 + 0x20);
  return sub_53B08((float *)(a1 + 0x40), (float *)v5, (float *)v6, (float *)v14);
}

//----- (0001BA90) --------------------------------------------------------
void __fastcall Q_NC_sub_1BA90(float *a1, int a2, int a3, int a4, int a5)
{
  sub_5323C((P_Vector3D)(a1 + 0xD), *(float *)&a5);
  sub_5353C(a1, (int)a1, a3, a4, a5);
}

//----- (0001BAB0) --------------------------------------------------------
void __fastcall Q_NC_sub_1BAB0(int a1, int a2, int a3, int a4, float degrees)
{
  Q_RotateVectorY_sub_532AC((T_Vector3D *)(a1 + 0x34), degrees);
  sub_53564((float *)a1, a1, a3, a4, SLODWORD(degrees));
}

//----- (0001BAF0) --------------------------------------------------------
void __fastcall sub_1BAF0(P_Wnd9RW1 a1, float a2)
{
  Q_RotateVectorY_sub_532AC(&a1->vector_34, a2);
  sub_535E4(a1, a2);
}

//----- (0001BB10) --------------------------------------------------------
FILE *__fastcall Q_OpenFile_sub_1BB10(const char *aFName, fpos_t *endOffset)
{
  FILE *v2; // eax
  FILE *v3; // edi
  T_FileInfo v1; // [esp+0h] [ebp-128h] BYREF

  Q_InitFileInfo_sub_1BB78(&v1);
  Q_OpenFile_sub_1BBFC(&v1, aFName, O_TEXT, FALSE);
  v2 = fdopen(v1.fh, "r");
  v3 = v2;
  if ( endOffset )
  {
    fgetpos(v2, endOffset);
    *endOffset += Q_GetFileLength_sub_1BE28(&v1);
  }
  v1.fh = 0xFFFFFFFF;
  Q_CloseFileAndDelete_sub_1BBC8(&v1);
  return v3;
}
// 1BB10: using guessed type T_FileInfo v1;

//----- (0001BB78) --------------------------------------------------------
void __fastcall __spoils<> Q_InitFileInfo_sub_1BB78(P_FileInfo a1)
{
  if ( !V_CobFilesLoaded )
  {
    Q_CobFilesLoad_sub_1C3C4(&V_CobFiles);
    V_CobFilesLoaded = TRUE;
  }
  a1->fh = 0xFFFFFFFF;
  a1->fname[0] = 0;
  a1->d = 0;
  a1->e = 0;
  a1->index = 0xFFFFFFFF;
}
// 9A250: using guessed type int V_CobFilesLoaded;

//----- (0001BBC8) --------------------------------------------------------
void __fastcall __spoils<> Q_CloseFileAndDelete_sub_1BBC8(P_FileInfo a1)
{
  Q_CloseFile_sub_1BE00(a1);
  if ( a1->e == 0xFFFFFFFF && a1->d )
  {
    sub_2627C(a1->d);
  }
  operator delete[](a1->d);
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);

//----- (0001BBFC) --------------------------------------------------------
BOOL __fastcall Q_OpenFile_sub_1BBFC(P_FileInfo a1, const char *aFName, int aOFlags, int preload)
{
  BOOL result; // eax
  int len; // eax
  unsigned int v7; // ecx
  void *pData; // eax

  if ( a1->fh != 0xFFFFFFFF )
  {
    Q_CloseFile_sub_1BE00(a1);
  }
  a1->e = 0;
  strncpy(a1->fname, aFName, 0x100u);
  a1->fname[0xFF] = 0;
  result = Q_CFILE_CPP_OpenFile_sub_1BCBC(a1, aOFlags);
  if ( !result )
  {
    if ( preload == TRUE )
    {
      len = filelength(a1->fh);
      v7 = len;
      if ( len > 0 )
      {
        pData = operator new[](len);
        Q_RegisterData_sub_2625C(pData, 1, "CFILE PRELOAD");
        a1->d = pData;
        if ( pData )
        {
          if ( !Q_ReadFile_sub_1BF94(a1, pData, v7) )
          {
            a1->e = 0xFFFFFFFF;
            return 0;
          }
          sub_2627C(a1->d);
          operator delete[](a1->d);
          a1->d = 0;
        }
      }
    }
    return 0;
  }
  return result;
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);

//----- (0001BCA8) --------------------------------------------------------
BOOL __fastcall Q_OpenFile_sub_1BCA8(T_FileInfo *a1, const char *a2)
{
  return Q_OpenFile_sub_1BBFC(a1, a2, O_CREAT|O_WRONLY, 0);
}

//----- (0001BCBC) --------------------------------------------------------
BOOL __fastcall Q_CFILE_CPP_OpenFile_sub_1BCBC(T_FileInfo *a1, int aOFlags)
{
  int fh; // eax MAPDST
  int cindex_1; // edi
  int findex; // ecx
  int v5; // kr04_4
  int cindex; // esi
  MACRO_VFX_BOOL found; // [esp+0h] [ebp-20h]
  int oflag; // [esp+4h] [ebp-1Ch]

  oflag = aOFlags;
  if ( a1->fh != 0xFFFFFFFF )
  {
    Q_CloseFile_sub_1BE00(a1);
  }
  if ( (aOFlags & O_CREAT) != 0 )
  {
    LOWORD(oflag) = aOFlags | O_BINARY|O_TRUNC;
    fh = open(a1->fname, oflag, S_IREADWRITE);
LABEL_19:
    a1->fh = fh;
    goto LABEL_20;
  }
  found = FALSE;
  if ( (aOFlags & (O_RDWR|O_WRONLY)) == 0 )
  {
    cindex_1 = 0;
    findex = 0;
    if ( V_CobFiles.totalfiles > 0 )
    {
      cindex = 0;
      v5 = 0;
      while ( 1 )
      {
        if ( findex == V_CobFiles.nextcobstart[cindex] )
        {
          ++cindex;
          ++cindex_1;
        }
        if ( !stricmp(a1->fname, V_CobFiles.fnames[v5]) )
        {
          break;
        }
        ++findex;
        ++v5;
        if ( findex >= V_CobFiles.totalfiles )
        {
          goto LABEL_17;
        }
      }
      a1->index = findex;
      fh = open(V_CobFiles.cobnames[cindex_1], aOFlags);
      a1->fh = fh;
      if ( fh == 0xFFFFFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\cfile.cpp", 0xC4);
      }
      lseek(a1->fh, V_CobFiles.foffsets[findex], SEEK_SET);
      found = TRUE;
    }
  }
LABEL_17:
  if ( found == FALSE )
  {
    fh = open(a1->fname, aOFlags);
    goto LABEL_19;
  }
LABEL_20:
  a1->d4 = oflag;
  return a1->fh == 0xFFFFFFFF;
}

//----- (0001BE00) --------------------------------------------------------
int __fastcall Q_CloseFile_sub_1BE00(P_FileInfo a1)
{
  int v3; // ebx

  if ( a1->fh == 0xFFFFFFFF )
  {
    return 0;
  }
  v3 = close(a1->fh);
  if ( !v3 )
  {
    a1->fh = 0xFFFFFFFF;
  }
  return v3;
}

//----- (0001BE28) --------------------------------------------------------
int __fastcall Q_GetFileLength_sub_1BE28(P_FileInfo a1)
{
  int index; // ecx
  int offset; // esi
  int v4; // kr04_4

  if ( a1->fh == 0xFFFFFFFF )
  {
    return 0xFFFFFFFF;
  }
  index = a1->index;
  if ( index == 0xFFFFFFFF )
  {
    // A separate file
    return filelength(a1->fh);
  }
  offset = V_CobFiles.foffsets[index + 1];
  if ( V_CobFiles.totalcobs > 0 )
  {
    v4 = 0;
    do
    {
      if ( V_CobFiles.nextcobstart[v4] - 1 == a1->index )
      {
        offset = V_CobFiles.coblengths[v4];
      }
      ++v4;
    }
    while ( 4 * v4 < 4 * V_CobFiles.totalcobs );
  }
  return offset - V_CobFiles.foffsets[index];
}

//----- (0001BEA0) --------------------------------------------------------
int __fastcall Q_GetFilePos_sub_1BEA0(P_FileInfo a1)
{
  int fpos; // eax
  int v3; // ebx
  int index; // ecx

  fpos = tell(a1->fh);
  v3 = fpos;
  if ( fpos != 0xFFFFFFFF )
  {
    index = a1->index;
    if ( index != 0xFFFFFFFF )
    {
      return fpos - V_CobFiles.foffsets[index];
    }
  }
  return v3;
}

//----- (0001BECC) --------------------------------------------------------
int __fastcall sub_1BECC(int *a1, int offset, int a3)
{
  if ( a1[0x44] && a3 != 0xFFFFFFFF )
  {
    return offset + a1[0x43];
  }
  else
  {
    return lseek(*a1, offset + V_CobFiles.foffsets[a1[0x42]], 0);
  }
}

//----- (0001BF0C) --------------------------------------------------------
int __fastcall Q_SetFilePos_sub_1BF0C(P_FileInfo a1, int offset)
{
  return lseek(a1->fh, offset, SEEK_CUR);
}

//----- (0001BF1C) --------------------------------------------------------
void *__fastcall Q_CfileLoad_sub_1BF1C(T_FileInfo *a1, void *a2)
{
  void *v3; // ecx
  int FileLength_sub_1BE28; // eax
  unsigned int v5; // edi
  unsigned int v6; // ebp
  void *result; // eax

  v3 = a2;
  if ( a1->fh != 0xFFFFFFFF )
  {
    FileLength_sub_1BE28 = Q_GetFileLength_sub_1BE28(a1);
    v5 = FileLength_sub_1BE28;
    v6 = 0;
    if ( FileLength_sub_1BE28 > 0 )
    {
      if ( !a2 )
      {
        result = operator new[](FileLength_sub_1BE28);
        Q_RegisterData_sub_2625C(result, 5, "CFILE LOAD");
        v3 = result;
        if ( !result )
        {
          return result;
        }
        v6 = 0xFFFFFFFF;
      }
      if ( Q_ReadFile_sub_1BF94(a1, v3, v5) == v5 )
      {
        return v3;
      }
      if ( v6 == 0xFFFFFFFF )
      {
        sub_2627C(v3);
      }
      operator delete[](v3);
      _get_errno_ptr();
    }
  }
  return 0;
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);

//----- (0001BF94) --------------------------------------------------------
int __fastcall Q_ReadFile_sub_1BF94(P_FileInfo a1, void *aBuf, unsigned int aReadLen)
{
  int index; // esi
  int pos; // esi
  unsigned int filelength; // eax

  index = a1->index;
  if ( index != 0xFFFFFFFF )
  {
    pos = tell(a1->fh) - V_CobFiles.foffsets[index];
    filelength = Q_GetFileLength_sub_1BE28(a1);
    if ( pos + aReadLen > filelength )
    {
      aReadLen = filelength - pos;
    }
  }
  return read(a1->fh, aBuf, aReadLen);
}

//----- (0001BFD4) --------------------------------------------------------
unsigned int __fastcall sub_1BFD4(int *a1, void *buf, unsigned int a3, unsigned int a4, int a5)
{
  unsigned int v7; // ebp
  void *v8; // ebx
  unsigned int v9; // edx
  unsigned int result; // eax
  unsigned int i; // ecx
  unsigned int v13; // [esp+4h] [ebp-1Ch]
  unsigned int len; // [esp+Ch] [ebp-14h]
  int v16; // [esp+10h] [ebp-10h]

  v7 = 0;
  len = a3 / a4;
  v16 = 0;
  v13 = a4 - 1;
  if ( a4 == 1 )
  {
LABEL_9:
    result = read(*a1, buf, a3 - v16);
    if ( result != 0xFFFFFFFF )
    {
      v16 += result;
      ((void (*)(void))a5)();
      return v16;
    }
  }
  else
  {
    while ( 1 )
    {
      result = read(*a1, buf, len);
      if ( result == 0xFFFFFFFF )
      {
        break;
      }
      v16 += result;
      if ( result < len )
      {
        for ( i = v7; i < a4; ++i )
        {
          ((void (__fastcall *)(unsigned int, unsigned int, _DWORD, unsigned int))a5)(a4, i, 0, i + 1);
        }
        return v16;
      }
      v8 = buf;
      v9 = v7++;
      buf = (char *)buf + result;
      ((void (__fastcall *)(unsigned int, unsigned int, void *, unsigned int))a5)(a4, v9, v8, v13);
      if ( v7 >= v13 )
      {
        goto LABEL_9;
      }
    }
  }
  return result;
}

//----- (0001C098) --------------------------------------------------------
unsigned int __fastcall Q_CFILE_CPP_dos_write_sub_1C098(int *phandle, void *buf, unsigned int size)
{
  unsigned int size_1; // edi
  unsigned int chunksize; // esi
  int handle; // eax
  unsigned int result; // eax
  unsigned int byteswritten; // [esp+0h] [ebp-20h] BYREF
  int *phandle_1; // [esp+4h] [ebp-1Ch]
  unsigned int v10; // [esp+8h] [ebp-18h]
  unsigned int v11; // [esp+Ch] [ebp-14h]

  phandle_1 = phandle;
  size_1 = size;
  if ( !size )
  {
    return v10;
  }
  while ( 1 )
  {
    chunksize = size_1 <= 0xFFF0 ? size_1 : 0xFFF0;
    handle = *phandle_1;
    v11 = chunksize;
    result = dos_write(handle, buf, chunksize, &byteswritten);
    v10 = result;
    if ( result )
    {
      break;
    }
    if ( chunksize != byteswritten )
    {
      _assert(0, "chunksize==byteswritten", "..\\cfile.cpp", 0x244);
    }
    buf = (char *)buf + v11;
    size_1 -= v11;
    if ( !size_1 )
    {
      return v10;
    }
  }
  return result;
}

//----- (0001C278) --------------------------------------------------------
void __fastcall Q_CFILE_CPP_IndexOneCob_sub_1C278(P_CobFiles a1, char *CobFileName)
{
  int totalcobs; // ebx
  int fh; // edi MAPDST
  int totalfiles; // edx
  int firstfileindex; // esi
  int filesInCob; // [esp+0h] [ebp-18h] BYREF

  if ( a1->totalcobs >= 5 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cfile.cpp", 0x28C);
  }
  totalcobs = a1->totalcobs;
  if ( totalcobs < 5 )
  {
    strncpy(a1->cobnames[totalcobs], CobFileName, 50u);
    fh = open(CobFileName, O_BINARY);
    if ( fh != 0xFFFFFFFF )
    {
      a1->coblengths[a1->totalcobs] = filelength(fh);
      read(fh, &filesInCob, 4u);
      if ( 500 - a1->totalfiles < filesInCob )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\cfile.cpp", 0x2A0);
      }
      totalfiles = a1->totalfiles;
      if ( 500 - totalfiles >= filesInCob )
      {
        read(fh, a1->fnames[totalfiles], 50 * filesInCob);
        read(fh, &a1->foffsets[a1->totalfiles], 4 * filesInCob);
        close(fh);
        firstfileindex = filesInCob + a1->totalfiles;
        a1->nextcobstart[a1->totalcobs] = firstfileindex;
        a1->totalfiles = firstfileindex;
        ++a1->totalcobs;
      }
    }
  }
}

//----- (0001C3C4) --------------------------------------------------------
void __fastcall Q_CobFilesLoad_sub_1C3C4(P_CobFiles a1)
{
  FILE *v2; // ecx
  char v3[100]; // [esp+0h] [ebp-64h] BYREF

  v2 = fopen("cob.cfg", "r");
  if ( v2 )
  {
    while ( fscanf(v2, "%s", v3) != 0xFFFFFFFF )
    {
      Q_CFILE_CPP_IndexOneCob_sub_1C278(a1, v3);
    }
    fclose(v2);
  }
}
// 1C3C4: using guessed type char anonymous_0[100];

//----- (0001C410) --------------------------------------------------------
void Q_AtExitFunc_sub_1C410(void)
{
  Q_StopSystems_sub_26160();
  UVB_sub_7501C();
}

//----- (0001C424) --------------------------------------------------------
int __fastcall main(int argc, char *argv[])
{
  clock_t v3; // edx
  char *sub_1CEA8; // kr00_4
  int v5; // kr04_4
  int v6; // kr24_4
  char v7; // al
  char v8; // al
  char *v9; // eax
  int v10; // eax
  int v11; // edx
  char *v12; // eax
  char *v13; // eax
  BOOL v14; // edx
  char *v15; // kr08_4
  int v16; // kr0C_4
  int v17; // kr2C_4
  char v18; // al
  char v19; // al
  int v20; // eax
  char *v21; // eax
  UBYTE *v22; // ebx
  int v23; // ebx
  FILE *fp; // eax MAPDST
  char *v25; // edx
  char *v27; // kr10_4
  int v28; // kr14_4
  int v29; // kr34_4
  char v30; // al
  char v31; // al
  unsigned int v32; // eax
  FILE *v34; // edi
  int i; // esi
  int v36; // kr1C_4
  int result; // eax
  int v38; // [esp-4h] [ebp-574h]
  int v39; // [esp-4h] [ebp-574h]
  T_Palette black_palette; // [esp+0h] [ebp-570h] BYREF
  T_FileInfo v1Type1; // [esp+300h] [ebp-270h] BYREF
  T_FileInfo v1; // [esp+418h] [ebp-158h] BYREF
  char tmp; // [esp+530h] [ebp-40h] BYREF
  int stars; // [esp+544h] [ebp-2Ch] BYREF
  __int16 num; // [esp+548h] [ebp-28h] BYREF
  int races; // [esp+54Ch] [ebp-24h] BYREF
  unsigned int seed; // [esp+550h] [ebp-20h] BYREF
  MACRO_VFX_BOOL forceUNIVBE; // [esp+554h] [ebp-1Ch]
  char **__attribute__((__org_arrdim(0,0))) v48; // [esp+558h] [ebp-18h]

  v48 = argv;
  v3 = clock();
  printf("\nAscendancy\nCopyright (c) 1995 The Logic Factory, Inc.\nAll rights reserved\n");
  while ( clock() - v3 < 0xFA )
  {
    ;
  }
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xAB);// 171: "Thank you for playing Ascendancy."
  v5 = 0;
  v6 = 0;
  do
  {
    v7 = sub_1CEA8[2 * v5];
    s[2 * v6] = v7;
    if ( !v7 )
    {
      break;
    }
    v8 = sub_1CEA8[2 * v5 + 1];
    s[2 * v6 + 1] = v8;
    ++v5;
    ++v6;
  }
  while ( v8 );
  atexit(Q_AtExitFunc_sub_1C410);
  if ( argc > 1 && *v48[1] == 'v' )
  {
    v38 = off_964E0;
    v9 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xAC);     // 172: "\n\nAscendancy version %s\n\n"
    printf(v9, v38);
    getch();
  }
  forceUNIVBE = FALSE;
  if ( argc > 1 && *v48[1] == 'u' )
  {
    forceUNIVBE = TRUE;
  }
  v10 = Q_CheckFreeMemory_sub_53DEC();
  v11 = v10;
  if ( argc > 1 && *v48[1] == 'm' )
  {
    v39 = v10;
    v12 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xAD);    // 173: "\n\nFree memory: %ld\n\n"
    printf(v12, v39);
    getch();
  }
  if ( v11 < 0x300000 )
  {
    v13 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xAE);    // 174: "Your computer does not have enough free extended memory to run\n
                                                       // Ascendancy.  You will need an additional %ldK bytes of free extended memory."
    sprintf("Thank you for playing Ascendancy.", v13, (0x300000 - v11) / 0x400 + 1);
    exit(1);
  }
  Q_InitFileInfo_sub_1BB78(&v1Type1);
  v14 = Q_OpenFile_sub_1BBFC(&v1Type1, "data\\theme00.raw", O_BINARY, 0);
  Q_CloseFile_sub_1BE00(&v1Type1);
  if ( v14 )
  {
    v15 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xAF);    // 175: "Please place the Ascendancy CD in your CDROM drive."
    v16 = 0;
    v17 = 0;
    do
    {
      v18 = v15[2 * v16];
      s[2 * v17] = v18;
      if ( !v18 )
      {
        break;
      }
      v19 = v15[2 * v16 + 1];
      s[2 * v17 + 1] = v19;
      ++v16;
      ++v17;
    }
    while ( v19 );
    exit(1);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v1Type1);
  v20 = sub_53D22(0x101);
  if ( (!v20 || forceUNIVBE == TRUE) && !UVB_sub_75098(v20, 0, 0, O_BINARY, ".\\", 1) )
  {
    v21 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xB0);    // 176: "\n\nAscendancy was unable to find VESA support for your\n
                                                       // video card.  To configure the VESA driver that comes with\n
                                                       // Ascendancy, run the UVCONFIG program in this directory, and\n
                                                       // then try running Ascendancy again.  If this solution does\n
                                                       // not work, you may have to install the VESA driver supplied\n
                                                       // with your video card.  Consult your video card documentation\n
                                                       // for further information."
    printf(v21);
    s[0] = 0;
    exit(1);
  }
  if ( !sub_2BD88(&V_Type6_stru_D8654, "DATA", "VESA480.DLL") )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\corn.cpp", 0x9B);
  }
  VFX_area_wipe(0, 0, 639, 479, 0);
  Q_LoadPal_sub_2C158(&V_Type6_stru_D8654, "data\\logo.pal", 0, 256u);
  memset(black_palette, 0, sizeof(black_palette));
  Q_PaletteSet_sub_2C224(&V_Type6_stru_D8654, 0, 256, black_palette);
  Q_InitFileInfo_sub_1BB78(&v1);
  Q_OpenFile_sub_1BBFC(&v1, "data\\logo.gif", O_BINARY, 0);
  v22 = &V_BigBuffer[Q_GetFileLength_sub_1BE28(&v1)];
  Q_CfileLoad_sub_1BF1C(&v1, V_BigBuffer);
  VFX_GIF_draw(&V_Type6_stru_D8654.pane, V_BigBuffer, v22);
  VFX_pane_refresh(&V_Type6_stru_D8654.pane, 0, 0, 0x27F, 0x1DF);
  VFX_window_fade(&V_Type6_stru_D8654.window, V_Type6_stru_D8654.palette2, 25);
  v23 = FALSE;
  if ( Q_StartSoundSystem_sub_4EFB0(&V_SoundSystem, TRUE, FALSE) )
  {
    if ( V_SoundSystem.DIG_installed == TRUE && !Q_LoadMusic_sub_4F65C(&V_SoundSystem, "music.txt") )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0xBB);
    }
  }
  else
  {
    Q_SetNoSound_sub_4FF08(&V_SoundSystem);
  }
  fp = fopen("nougat.lf", "r");
  if ( fp )
  {
    V_NougatLfExists_dword_A0CFC = TRUE;
    fclose(fp);
  }
  v25 = "r";
  fp = fopen("flash.pop", "r");
  if ( fp )
  {
    V_FlashPopExists = TRUE;
    fclose(fp);
  }
  if ( heapchk() )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0xD8);
  }
  if ( Q_WINMGR_CPP_StartTimer_sub_545EC(&WinMgr) != 0xFFFFFFFF )
  {
    v23 = 0xE1;
    v25 = "..\\corn.cpp";
    Q_AssertLogBreakExit_sub_261A8(0, "..\\corn.cpp", 0xE1);
  }
  if ( heapchk() )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0xE3);
  }
  if ( !Q_StartMouse_sub_2633C() )
  {
    v27 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xB1);    // 177: "Ascendancy could not find a mouse driver.  Please make sure your\n
                                                       // mouse driver is loaded, and then run Ascendancy again."
    v28 = 0;
    v29 = 0;
    do
    {
      v30 = v27[2 * v28];
      s[2 * v29] = v30;
      if ( !v30 )
      {
        break;
      }
      v31 = v27[2 * v28 + 1];
      s[2 * v29 + 1] = v31;
      ++v28;
      ++v29;
    }
    while ( v31 );
    exit(1);
  }
  Q_GSYSTEM_CPP_PreloadMouseShp_sub_2C744(&V_Type6_stru_D8654, v25, v23, 0);
  if ( heapchk() )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0xEE);
  }
  v32 = time(0);
  srand(v32);
  sub_1CF14(0);
  fp = fopen("cosmos.txt", "r");
  v34 = fp;
  if ( fp )
  {
    fscanf(fp, "%s %d %s %d %s %d", &tmp, &stars, &tmp, &races, &tmp, &seed);
    i = 0;
    if ( seed != -1u )
    {
      srand(seed);
    }
    sub_1E10C(&V_Game, stars, races, 0);
    sub_1F404(&V_Game);
    v36 = 0;
    while ( fscanf(v34, "%d", &num) != 0xFFFFFFFF && i < races )
    {
      ++i;
      *((_BYTE *)&V_StaticStrings_dword_A0D04 + 0x1EE * v36++ + 0x226F) = num;
    }
    fclose(v34);
  }
  else
  {
    sub_1E10C(&V_Game, 50, 7, 0);
    sub_1F404(&V_Game);
  }
  sub_1EE08(&V_Game, 0);
  if ( access("resume.gam", 0) )
  {
    sub_1F038(&V_Game);
  }
  WinMgr.window = (WINDOW *)&V_Type6_stru_D8654;
  sub_575BC(&WinMgr);
  if ( heapchk() )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0x11F);
  }
  sub_1EEA4(&V_Game);
  Q_SetProc1_sub_574F0(&WinMgr, 0, Q_Proc_sub_1CC94);
  Q_SetProc1_sub_574F0(&WinMgr, 1, Q_Proc_sub_5A320);
  Q_SetProc2_sub_57510(&WinMgr, 1, Q_Proc_sub_22468);
  Q_SetProc1_sub_574F0(&WinMgr, 2, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&WinMgr, 3, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&WinMgr, 4, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&WinMgr, 7, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&WinMgr, 8, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&WinMgr, 9, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&WinMgr, 0xA, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&WinMgr, 0xC, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&WinMgr, 0xD, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&WinMgr, 0xE, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&WinMgr, 0xF, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&WinMgr, 0x10, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&WinMgr, 0x12, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&WinMgr, 0x14, Q_Proc_sub_5A320);
  Q_LoadAscendCfg_sub_59828(&WinMgr);
  VFX_window_fade(&V_Type6_stru_D8654.window, black_palette, 0x32);
  dword_132B60 = 0xFFFFFFFF;
  VFX_area_wipe(0, 0, 0x27F, 0x1DF, 0);
  Q_LoadPal_sub_2C158(&V_Type6_stru_D8654, "DATA\\game.pal", 0, 0x100u);
  Q_PaletteSet_sub_2C224(&V_Type6_stru_D8654, 0, 0x100, black_palette);
  sub_56E9C(&WinMgr, 0, 0xFFFFFFFF);
  if ( heapchk() )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0x146);
  }
  if ( argc == 4 && sub_59988(&WinMgr, v48[3], 0) != 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\corn.cpp", 0x14C);
  }
  MOUSE_show();
  // Main game loop
  while ( Q_GameLoop_dword_96774 == TRUE )
  {
    if ( WinMgr.bbb == 0xFFFFFFFF )
    {
      sub_59B80(&WinMgr);
    }
    else
    {
      Q_ProcessInput_sub_2656C();
    }
    sub_5469C(&WinMgr);
    sub_5508C(&WinMgr);
    if ( WinMgr.bbb )
    {
      sub_59A54(&WinMgr);
    }
  }
  Q_SaveAscendCfg_sub_5989C(&WinMgr);
  Q_SaveGam_sub_54048("resume.gam");
  result = (int)&v1;
  Q_CloseFileAndDelete_sub_1BBC8(&v1);
  return result;
}
// 1CC7C: returning address of temporary local variable '%v1'
// 96774: using guessed type int Q_GameLoop_dword_96774;
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// 132B60: using guessed type int dword_132B60;

//----- (0001CC94) --------------------------------------------------------
void Q_Proc_sub_1CC94()
{
  void *v0; // edi
  UBYTE *v1; // esi
  T_FileInfo v2; // [esp+0h] [ebp-128h] BYREF

  v0 = sub_262B0(0x502Eu, 1u, 1, "GIF SCRATCH");
  Q_InitFileInfo_sub_1BB78(&v2);
  Q_OpenFile_sub_1BBFC(&v2, "DATA\\0OPENING.GIF", O_BINARY, 0);
  v1 = (UBYTE *)Q_CfileLoad_sub_1BF1C(&v2, 0);
  if ( !v1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0x180);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v2);
  if ( v0 )
  {
    VFX_GIF_draw(&V_Type6_stru_D8654.pane, v1, v0);
    sub_552CC(&WinMgr, 0);
  }
  sub_2627C(v1);
  operator delete(v1);
  sub_262CC(v0);
}
// 1CCF9: conditional instruction was optimized away because esi.4!=0
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (0001CD3C) --------------------------------------------------------
int Q_CORN_CPP_StaticTxtLoad_sub_1CD3C()
{
  FILE *fp; // edi
  char *pText; // esi
  char *pLetter; // ecx
  unsigned int v3; // ebp
  char letter; // dl
  int count; // eax
  char v6; // bh
  char line[201]; // [esp+1h] [ebp-E5h] BYREF
  int endOfFile; // [esp+CAh] [ebp-1Ch]

  fp = Q_OpenFile_sub_1BB10("static.txt", 0);
  if ( !fp )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0x1A0);
  }
  pText = V_StaticStrings_dword_A0D04.buffer;
  V_StaticStrings_dword_A0D04.count = 0;
  endOfFile = 0;
  do
  {
    if ( V_StaticStrings_dword_A0D04.count >= 200 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0x1AE);
    }
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(fp, &line[1]);
    if ( !stricmp(&line[1], "end\n") )
    {
      endOfFile = 0xFFFFFFFF;
      continue;
    }
    if ( line[1] == '"' )
    {
      pLetter = &line[1];
      v3 = 0;
      V_StaticStrings_dword_A0D04.index[V_StaticStrings_dword_A0D04.count] = pText;
      do
      {
        ++pLetter;
        if ( pText - V_StaticStrings_dword_A0D04.buffer >= 8000 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0x1C6);
        }
        letter = *pLetter;
        if ( *pLetter == '"' )
        {
          v3 = 0xFFFFFFFF;
          count = V_StaticStrings_dword_A0D04.count;
          *pText++ = 0;
          V_StaticStrings_dword_A0D04.count = count + 1;
        }
        else if ( letter != '\n' )
        {
          if ( letter )
          {
            if ( letter != '\\' )
            {
              *pText++ = letter;
              continue;
            }
            v6 = *++pLetter;
            if ( v6 == 'n' )
            {
              *pText++ = '\n';
              continue;
            }
            if ( v6 )
            {
              *pText++ = v6;
              continue;
            }
          }
          pLetter = line;
          fgets(&line[1], 200, fp);
        }
      }
      while ( !v3 );
    }
  }
  while ( !endOfFile );
  V_StaticStrings_dword_A0D04.loaded = 0xFFFFFFFF;
  return fclose(fp);
}

//----- (0001CEA8) --------------------------------------------------------
char *__fastcall Q_CORN_CPP_StaticTxtRead_sub_1CEA8(int aTextIndex)
{
  if ( !V_StaticStrings_dword_A0D04.loaded )
  {
    Q_CORN_CPP_StaticTxtLoad_sub_1CD3C();
  }
  if ( aTextIndex < 0 || aTextIndex >= V_StaticStrings_dword_A0D04.count )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0x1F3);
  }
  return V_StaticStrings_dword_A0D04.index[aTextIndex];
}

//----- (0001CEF0) --------------------------------------------------------
T_Game *sub_1CEF0()
{
  T_Game *result; // eax

  _wcpp_2_mod_register_(&dword_964E4);
  result = &V_Game;
  Q_GameCtor_sub_1DE64(&V_Game);
  dword_964EC = 1;
  return result;
}
// 964E4: using guessed type _DWORD dword_964E4;
// 964EC: using guessed type int dword_964EC;

//----- (0001CF14) --------------------------------------------------------
void __fastcall sub_1CF14(unsigned __int8 a1)
{
  unsigned __int8 v1; // dh
  char v2; // dl

  if ( a1 == 0xFF )
  {
    v1 = 0;
    v2 = 0xFF;
  }
  else
  {
    v1 = a1;
    v2 = 1 << a1;
  }
  V_RaceIndex = v1;
  V_RaceIndexMask = v2;
}
// 968DC: using guessed type char byte_968DC;

//----- (0001CF40) --------------------------------------------------------
void __fastcall Q_StarCtor_sub_1CF40(P_Star pStar)
{
  pStar->v.x = 0.0;
  pStar->v.y = 0.0;
  pStar->v.z = 0.0;
}

//----- (0001CF68) --------------------------------------------------------
T_Lane *__fastcall sub_1CF68(T_Star *a1, T_Star *a2)
{
  int Unknown_44; // eax
  int v5; // eax
  T_Lane *v6; // ebx
  T_Lane *v7; // eax
  T_Lane *v8; // edx
  double v9; // st7
  int v11[3]; // [esp+8h] [ebp-A4h] BYREF
  int v12[3]; // [esp+14h] [ebp-98h] BYREF
  float v13; // [esp+20h] [ebp-8Ch]
  float v14; // [esp+24h] [ebp-88h]
  float v15; // [esp+28h] [ebp-84h]
  float v16; // [esp+2Ch] [ebp-80h]
  int v17; // [esp+30h] [ebp-7Ch]
  int v18; // [esp+34h] [ebp-78h]
  float v19; // [esp+38h] [ebp-74h]
  float v20; // [esp+3Ch] [ebp-70h]
  float v21; // [esp+40h] [ebp-6Ch]
  float x; // [esp+44h] [ebp-68h]
  float y; // [esp+48h] [ebp-64h]
  float z; // [esp+4Ch] [ebp-60h]
  float v25; // [esp+50h] [ebp-5Ch]
  float v26; // [esp+54h] [ebp-58h]
  float v27; // [esp+58h] [ebp-54h]
  float v28; // [esp+5Ch] [ebp-50h] BYREF
  float v29; // [esp+60h] [ebp-4Ch]
  float v30; // [esp+64h] [ebp-48h]
  int v31[3]; // [esp+68h] [ebp-44h] BYREF
  float v32; // [esp+74h] [ebp-38h]
  int v33; // [esp+78h] [ebp-34h]
  int v34; // [esp+7Ch] [ebp-30h]
  int *v35; // [esp+80h] [ebp-2Ch]
  int *v36; // [esp+88h] [ebp-24h]
  int *v37; // [esp+8Ch] [ebp-20h]
  float *v38; // [esp+90h] [ebp-1Ch]
  float v39; // [esp+98h] [ebp-14h]

  Unknown_44 = a1->Unknown_44;
  if ( Unknown_44 < 0 || Unknown_44 >= 6 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x7F);
  }
  v5 = a2->Unknown_44;
  if ( v5 < 0 || v5 >= 6 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x81);
  }
  v6 = 0;
  if ( a1->Unknown_44 != word_9652E[a1->type] && a2->Unknown_44 != word_9652E[a2->type] )
  {
    v7 = sub_205A0(&V_Game, a1, a2);
    v8 = v7;
    v6 = v7;
    if ( v7 )
    {
      *(_DWORD *)&a1->Unknown_2C[4 * a1->Unknown_44++] = v7;
      *(_DWORD *)&a2->Unknown_2C[4 * a2->Unknown_44++] = v7;
      v19 = 0.0;
      v20 = 0.0;
      v21 = 0.0;
      x = a2->v.x;
      y = a2->v.y;
      z = a2->v.z;
      v13 = 0.0;
      v14 = 0.0;
      v15 = 0.0;
      v35 = v11;
      v13 = x - a1->v.x;
      v14 = y - a1->v.y;
      v15 = z - a1->v.z;
      *(float *)v11 = v13;
      *(float *)&v11[1] = v14;
      *(float *)&v11[2] = v15;
      x = v13;
      y = v14;
      z = v15;
      v9 = sqrt(v14 * v14 + v13 * v13 + v15 * v15);
      v36 = v12;
      v32 = x * (1.0 / v9);
      *(float *)v12 = v32;
      *(float *)&v33 = y * (1.0 / v9);
      v12[1] = v33;
      *(float *)&v34 = 1.0 / v9 * z;
      v12[2] = v34;
      v39 = v9 * 0.0011363636;
      x = v32;
      y = *(float *)&v33;
      v39 = v39 * 1000.0 + 2000.0;
      z = *(float *)&v34;
      v16 = v32 * v39;
      v37 = v31;
      *(float *)&v17 = *(float *)&v33 * v39;
      *(float *)v31 = v16;
      *(float *)&v18 = *(float *)&v34 * v39;
      v31[1] = v17;
      v31[2] = v18;
      v19 = v16;
      v20 = *(float *)&v17;
      v21 = *(float *)&v18;
      v8->vector1.x = v16;
      v8->vector1.y = v20;
      v8->vector1.z = v21;
      v25 = -v19;
      v38 = &v28;
      v26 = -v20;
      v28 = v25;
      v27 = -v21;
      v29 = v26;
      v30 = v27;
      v8->vector2.x = v25;
      v8->vector2.y = v29;
      v8->vector2.z = v30;
    }
  }
  return v6;
}

//----- (0001D234) --------------------------------------------------------
__int16 __fastcall sub_1D234(P_Star pStar, P_Planet pPlanet, WORD raceIndex)
{
  int word52; // eax
  WORD planetsNum; // bx
  __int16 v7; // ax
  P_Star star; // ebx
  int racesBits; // edx
  UBYTE buildingPlanetItemIndex; // bh
  P_Ship vpShip; // eax
  __int16 v13; // [esp+2h] [ebp-10h]

  if ( !pPlanet )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xB3);
  }
  if ( raceIndex >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xB4);
  }
  if ( pPlanet->raceIndex == raceIndex )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xB5);
  }
  if ( pPlanet->raceIndex == 0xFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xB7);
  }
  v13 = pPlanet->raceIndex;
  word52 = pPlanet->raceIndex;
  if ( word52 != 0xFF )
  {
    if ( raceIndex == 0xFFFFFFFF )
    {
      pPlanet->raceIndex = 0xFF;
    }
    else
    {
      pPlanet->raceIndex = raceIndex;
      pStar->racesBits |= 1 << raceIndex;
    }
    planetsNum = pStar->planetsNum;
    v7 = 0;
    pStar->racesBits &= ~(1 << v13);
    if ( planetsNum > 0 )
    {
      while ( *(unsigned __int8 *)(pStar->Unknown_46[v7] + 0x57) != v13 )
      {
        if ( ++v7 >= pStar->planetsNum )
        {
          goto LABEL_18;
        }
      }
      pStar->racesBits |= 1 << v13;
    }
LABEL_18:
    LOWORD(word52) = v13;
    star = V_Game.races[v13].star;
    if ( pStar == star )
    {
      racesBits = star->racesBits;
      word52 = 1 << v13;
      if ( ((1 << v13) & racesBits) == 0 )
      {
        pStar->racesBits = racesBits & 0x7F;
      }
    }
  }
  buildingPlanetItemIndex = pPlanet->buildingPlanetItemIndex;
  if ( buildingPlanetItemIndex != 0xFF )
  {
    if ( buildingPlanetItemIndex == 0x17 )
    {
      vpShip = Q_PLANET_CPP_GetShip_sub_35A70(pPlanet, pPlanet->word52);
      if ( v13 != vpShip->raceIndex )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xE0);
      }
      sub_49940(vpShip);
    }
    word52 = pPlanet->word52;
    if ( (unsigned __int16)word52 != 0xFFFF && pPlanet->buildingPlanetItemIndex != 0x23 )
    {
      *((_BYTE *)pPlanet->pUnknown_10 + 4 * word52 + 1) = 0xFF;
      word52 = pPlanet->word52;
      *((_WORD *)pPlanet->pUnknown_10 + 2 * word52 + 1) = 0;
    }
    pPlanet->buildingPlanetItemIndex = 0xFF;
    pPlanet->buildingProgress = 0;
    pPlanet->word52 = 0xFFFF;
  }
  return word52;
}

//----- (0001D3E8) --------------------------------------------------------
unsigned int __fastcall sub_1D3E8(P_Star pStar, P_Ship pShip, int a3)
{
  UBYTE locationType; // ah
  P_Lane vpLane; // eax
  int i; // edx
  int v8; // eax
  T_Vector3D vector; // [esp+0h] [ebp-1Ch] BYREF
  int v11; // [esp+Ch] [ebp-10h]

  if ( a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xFD);
  }
  locationType = pShip->locationType;
  if ( locationType == ASCEND_LOCATION_TYPE_LANE )
  {
    vpLane = pShip->pLocation.pLane;
    memset(&vector, 0, sizeof(vector));
    if ( pStar == vpLane->pStar1 )
    {
      vector = vpLane->vector1;
    }
    else if ( pStar == vpLane->pStar2 )
    {
      vector = vpLane->vector2;
    }
    else
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\cosmos.cpp", 0x10A);
    }
    vector.y = vector.y + -200.0;
    vector.z = (double)(rand() % 200) + vector.z;
    v11 = rand() % 200;
    vector.x = (double)v11 + vector.x;
    sub_496BC(pShip, &vector);
    pShip->locationType = ASCEND_LOCATION_TYPE_STAR;
  }
  else if ( locationType != ASCEND_LOCATION_TYPE_STAR )
  {
    goto LABEL_12;
  }
  pShip->pLocation.pStar = pStar;
LABEL_12:
  pStar->Unknown_15 |= 1 << LOBYTE(pShip->raceIndex);
  pStar->Unknown_17 |= 1 << LOBYTE(pShip->raceIndex);
  for ( i = 0; (__int16)i < pStar->Unknown_44; ++i )
  {
    v8 = *(_DWORD *)&pStar->Unknown_2C[4 * (__int16)i];
    *(_BYTE *)(v8 + 0x20) |= 1 << LOBYTE(pShip->raceIndex);
    *(_BYTE *)(*(_DWORD *)v8 + 0x16) |= 1 << LOBYTE(pShip->raceIndex);
    *(_BYTE *)(*(_DWORD *)(v8 + 4) + 0x16) |= 1 << LOBYTE(pShip->raceIndex);
  }
  return 0xFFFFFFFF;
}

//----- (0001D538) --------------------------------------------------------
unsigned int __fastcall sub_1D538(P_Location a1, P_Ship pShip)
{
  UBYTE locationType; // ah
  int starIndex; // edx
  int v6; // esi
  unsigned int v7; // ebp
  __int16 i; // dx
  P_Ship v9; // eax
  P_Ship ships[107]; // [esp+0h] [ebp-1C4h] BYREF
  __int16 raceIndex; // [esp+1ACh] [ebp-18h]

  raceIndex = pShip->raceIndex;
  if ( raceIndex < 0 || raceIndex >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x139);
  }
  locationType = pShip->locationType;
  if ( (locationType == ASCEND_LOCATION_TYPE_PLANET || locationType == ASCEND_LOCATION_TYPE_1 || locationType == ASCEND_LOCATION_TYPE_2)
    && !sub_35C38(pShip->pLocation.pPlanet, pShip) )
  {
    starIndex = pShip->pLocation.pPlanet->starIndex;
    pShip->locationType = ASCEND_LOCATION_TYPE_STAR;
    pShip->pLocation.pStar = &V_Game.stars[starIndex];
  }
  if ( pShip->locationType != ASCEND_LOCATION_TYPE_STAR || a1.pPlanet != pShip->pLocation.pPlanet )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x149);
  }
  v6 = sub_1D794(a1, ships);
  if ( v6 <= 0 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cosmos.cpp", 0x14E);
  }
  v7 = 0xFFFFFFFF;
  for ( i = 0; i < v6; ++i )
  {
    v9 = ships[i];
    if ( v9->raceIndex == raceIndex && v9 != pShip && v9->locationType != ASCEND_LOCATION_TYPE_1 )
    {
      v7 = 0;
      break;
    }
  }
  if ( v7 == 0xFFFFFFFF )
  {
    HIBYTE(a1.pPlanet->size) &= ~(1 << raceIndex);
  }
  return 0xFFFFFFFF;
}

//----- (0001D654) --------------------------------------------------------
int __fastcall sub_1D654(__int16 *a1, T_Star *a2, void *a3)
{
  int result; // eax
  __int16 v5; // si
  T_Ship *v6; // ecx
  int v7[107]; // [esp+0h] [ebp-1C4h] BYREF
  int v8; // [esp+1ACh] [ebp-18h]
  void *v9; // [esp+1B0h] [ebp-14h]

  v9 = a3;
  if ( !a2 || !a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x16C);
  }
  result = sub_1D794((P_Location)a1, (P_Ship *)v7);
  v5 = 0;
  v8 = result;
  while ( v5 < v8 )
  {
    v6 = (T_Ship *)v7[v5];
    result = v6->raceIndex;
    if ( result == V_RaceIndex )
    {
      sub_1D538((P_Location)a1, v6);
      v6->pLocation.pPlanet = (P_Planet)v9;
      v6->locationType = 5;
      result = sub_1D3E8(a2, v6, 0);
    }
    ++v5;
  }
  return result;
}
// 1D654: could not find valid save-restore pair for ebx
// 1D654: using guessed type int var_1C4[107];

//----- (0001D734) --------------------------------------------------------
void __fastcall sub_1D734(int a1, int a2)
{
  int v3; // ebx
  WORD v4; // ax
  int v5; // edx
  int v6; // ecx
  unsigned __int8 v7; // [esp+0h] [ebp-14h]

  v3 = 0;
  v7 = *(_BYTE *)(a1 + 0x14) | *(_BYTE *)(a1 + 0x15);
  v4 = 0;
  if ( V_Game.racesNum > 0 )
  {
    v5 = 0;
    do
    {
      if ( (v7 & (unsigned __int8)(1 << v4)) != 0 )
      {
        v6 = v5;
        ++v3;
        v5 += 2;
        *(_WORD *)(v6 + a2) = v4;
      }
      ++v4;
    }
    while ( v4 < V_Game.racesNum );
  }
  JUMPOUT(0x1D78B);
}
// 1D789: control flows out of bounds to 1D78B

//----- (0001D794) --------------------------------------------------------
int __fastcall sub_1D794(P_Location pLocation, P_Ship *pShip)
{
  P_Ship *v2; // ebx
  int v3; // edi
  int v4; // esi
  __int16 v5; // dx
  int v6; // kr04_4
  UBYTE locationType; // cl

  v2 = pShip;
  v3 = 0;
  v4 = 0;
  v5 = 0;
  v6 = 0;
  while ( v5 < 107 && v4 < V_Game.shipsNum )
  {
    if ( V_Game.ships[v6].raceIndex != 0xFFFFFFFF )
    {
      if ( ((locationType = V_Game.ships[v6].locationType, ++v4, locationType == ASCEND_LOCATION_TYPE_PLANET)
         || locationType == ASCEND_LOCATION_TYPE_1
         || locationType == ASCEND_LOCATION_TYPE_2)
        && &V_Game.stars[V_Game.ships[v6].pLocation.pPlanet->starIndex] == pLocation.pStar
        || V_Game.ships[v6].locationType == ASCEND_LOCATION_TYPE_STAR && pLocation.pStar == V_Game.ships[v6].pLocation.pStar )
      {
        if ( pShip )
        {
          *v2 = &V_Game.ships[v6];
        }
        ++v2;
        ++v3;
      }
    }
    ++v5;
    ++v6;
  }
  return v3;
}

//----- (0001D834) --------------------------------------------------------
unsigned int __fastcall sub_1D834(P_Star pStar, __int16 raceIndex)
{
  __int16 v3; // di
  int i; // kr04_4
  int raceIndexa; // eax
  __int16 v6; // dx
  WORD v9; // [esp+6h] [ebp-18h]

  v3 = 0;
  v9 = 0;
  for ( i = 0; ; ++i )
  {
    if ( v3 >= 0x6B || v9 >= V_Game.shipsNum )
    {
      return 0;
    }
    raceIndexa = V_Game.ships[i].raceIndex;
    if ( raceIndexa != 0xFFFFFFFF )
    {
      ++v9;
      if ( V_Game.ships[i].locationType == 5
        && (V_Game.races[raceIndex].Unknown_1C0[raceIndexa] == 2 || raceIndexa == V_RaceIndex || raceIndex == V_Game.ships[i].raceIndex) )
      {
        v6 = 0;
        if ( pStar->Unknown_44 > 0 )
        {
          break;
        }
      }
    }
LABEL_2:
    ++v3;
  }
  while ( V_Game.ships[i].pLocation.pPlanet != *(P_Planet *)&pStar->Unknown_2C[4 * v6]
       || (pStar != **(P_Star **)&pStar->Unknown_2C[4 * v6] || (LODWORD(V_Game.ships[i].vector.y) & 0x7FFFFFFF) != 0)
       && (pStar != *(P_Star *)(*(_DWORD *)&pStar->Unknown_2C[4 * v6] + 4) || LODWORD(V_Game.ships[i].vector.y) != 0x3F800000) )
  {
    if ( ++v6 >= pStar->Unknown_44 )
    {
      goto LABEL_2;
    }
  }
  return 0xFFFFFFFF;
}

//----- (0001D920) --------------------------------------------------------
void __fastcall Q_ReadWriteStar_sub_1D920(P_Star pStar, P_FileInfo pfi, int read)
{
  int z2; // eax
  T_Star vStar; // [esp+0h] [ebp-70h] BYREF

  if ( read == TRUE )
  {
    Q_StarCtor_sub_1CF40(&vStar);
    Q_ReadFile_sub_1BF94(pfi, &vStar, sizeof(T_Star));
    pStar->type = vStar.type;
    pStar->index = vStar.index;
    pStar->Unknown_6 = vStar.Unknown_6;
    pStar->v = vStar.v;
    pStar->racesBits = vStar.racesBits;
    pStar->Unknown_15 = vStar.Unknown_15;
    pStar->Unknown_16 = vStar.Unknown_16;
    pStar->Unknown_17 = vStar.Unknown_17;
    pStar->Unknown_18 = vStar.Unknown_18;
    *(_DWORD *)pStar->name = *(_DWORD *)vStar.name;
    *(_DWORD *)&pStar->name[4] = *(_DWORD *)&vStar.name[4];
    *(_DWORD *)&pStar->name[8] = *(_DWORD *)&vStar.name[8];
    *(_DWORD *)&pStar->name[0xC] = *(_DWORD *)&vStar.name[0xC];
    qmemcpy(pStar->Unknown_2C, vStar.Unknown_2C, sizeof(pStar->Unknown_2C));
    pStar->Unknown_44 = vStar.Unknown_44;
    pStar->Unknown_46[0] = vStar.Unknown_46[0];
    pStar->Unknown_46[1] = vStar.Unknown_46[1];
    pStar->Unknown_46[2] = vStar.Unknown_46[2];
    pStar->Unknown_46[3] = vStar.Unknown_46[3];
    pStar->Unknown_46[4] = vStar.Unknown_46[4];
    pStar->planetsNum = vStar.planetsNum;
    z2 = vStar.z2;
    pStar->Unknown_44 = 0;
    pStar->z2 = z2;
    pStar->planetsNum = 0;
  }
  else
  {
    Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, pStar, 0x60u);
  }
}

//----- (0001DA04) --------------------------------------------------------
int __fastcall sub_1DA04(int a1, int a2)
{
  int result; // eax

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x21A);
  }
  result = *(__int16 *)(a2 + 4);
  LOWORD(result) = (unsigned __int8)V_Game.z10000[0x64 * *(__int16 *)(a1 + 4) + result];
  return result;
}

//----- (0001DA4C) --------------------------------------------------------
int __fastcall sub_1DA4C(T_Star *a1, __int16 a2, int a3, int a4)
{
  int v5; // ebx
  int v6; // edi
  int *Unknown_46; // kr00_4
  int v8; // kr04_4
  int v9; // eax
  int v10; // kr0C_4
  P_Star star; // ecx

  if ( a2 > V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x248);
  }
  if ( a4 >= 0x6B )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x249);
  }
  v5 = 0;
  if ( ((1 << a2) & (unsigned __int8)a1->Unknown_16) == 0 )
  {
    return 0x2BC;
  }
  v6 = 0;
  Unknown_46 = a1->Unknown_46;
  v8 = 0;
  while ( v6 < a1->planetsNum )
  {
    if ( *(unsigned __int8 *)(Unknown_46[v8] + 0x57) != a2 )
    {
      v5 += sub_364B4((T_Planet *)Unknown_46[v8], a2);
    }
    ++v6;
    ++v8;
  }
  v9 = 0;
  v10 = 0;
  while ( v9 < V_Game.racesNum )
  {
    if ( v9 != a2 )
    {
      star = V_Game.races[v10].star;
      if ( a1 == star && (star->racesBits & 0x80) != 0 && V_Game.races[a2].Unknown_1C0[v9] == 2 )
      {
        v5 = 3 * v5 + 0xC8;
      }
    }
    ++v9;
    ++v10;
  }
  if ( !a1->racesBits )
  {
    v5 *= 2;
  }
  if ( v5 < 0 )
  {
    v5 = 0;
  }
  if ( ((1 << a2) & (unsigned __int8)a1->Unknown_17) == 0 )
  {
    return 4 * v5 + 0x12C;
  }
  return v5;
}

//----- (0001DB70) --------------------------------------------------------
int __fastcall sub_1DB70(T_Star *a1, __int16 a2, int *a3, int a4)
{
  char Unknown_15; // al
  int v7; // eax
  int v8; // kr04_4
  char *v9; // ecx
  int v10; // ebp
  int v11; // kr0C_4
  P_Ship v12; // ecx
  int v13; // ebp
  int *Unknown_46; // kr10_4
  int v15; // kr14_4
  int v16; // edx
  int v17; // edx
  int v18; // ebx
  T_Planet *v19; // eax
  void *v21[107]; // [esp+0h] [ebp-1D4h] BYREF
  P_Ship *v22; // [esp+1ACh] [ebp-28h]
  int v23; // [esp+1B0h] [ebp-24h]
  int v24; // [esp+1B4h] [ebp-20h]
  int v25; // [esp+1B8h] [ebp-1Ch]
  int v26; // [esp+1BCh] [ebp-18h]
  int *v27; // [esp+1C0h] [ebp-14h]
  float v28; // [esp+1C4h] [ebp-10h]

  v27 = a3;
  v26 = a4;
  if ( a2 > V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x2BD);
  }
  v23 = 0;
  if ( ((1 << a2) & (unsigned __int8)a1->Unknown_16) != 0 && ((1 << a2) & a1->racesBits) != 0 )
  {
    Unknown_15 = a1->Unknown_15;
    v28 = 0.0;
    if ( Unknown_15 )
    {
      if ( v27 && v26 >= 0 )
      {
        v10 = 0;
        if ( v26 > 0 )
        {
          v22 = (P_Ship *)v27;
          v11 = 0;
          do
          {
            v12 = *v22;
            if ( !*v22 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x2F1);
            }
            if ( (v12->locationType == 4 && a1 == v12->pLocation.pStar
               || v12->locationType == 3 && a1->index == v12->pLocation.pPlanet->starIndex)
              && a2 != v12->raceIndex
              && V_Game.races[a2].Unknown_1C0[v12->raceIndex] == 2 )
            {
              v24 = sub_4A988(*v22);
              v28 = (double)v24 + v28;
            }
            ++v10;
            ++v11;
          }
          while ( v10 < v26 );
        }
      }
      else
      {
        v7 = sub_1D794((P_Location)a1, (P_Ship *)v21);
        if ( v7 > 0 )
        {
          v25 = 4 * v7;
          v8 = 0;
          do
          {
            v9 = (char *)v21[v8];
            if ( !v9 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x2D6);
            }
            if ( (v9[0x58] == 4 && a1 == *(T_Star **)(v9 + 0x59) || v9[0x58] == 3 && a1->index == *(_WORD *)(*(_DWORD *)(v9 + 0x59) + 0xC))
              && a2 != *((_WORD *)v9 + 0x2B)
              && V_Game.races[a2].Unknown_1C0[*((__int16 *)v9 + 0x2B)] == 2 )
            {
              v24 = sub_4A988((P_Ship)v21[v8]);
              v28 = (double)v24 + v28;
            }
            ++v8;
          }
          while ( 4 * v8 < v25 );
        }
      }
      v28 = v28 * 4.0 * 0.0099999998;
    }
    if ( v28 > 0.0 )
    {
      v13 = 0;
      Unknown_46 = a1->Unknown_46;
      v15 = 0;
      while ( v13 < a1->planetsNum )
      {
        if ( *(unsigned __int8 *)(Unknown_46[v15] + 0x57) == a2 )
        {
          v16 = v23;
          v17 = sub_363B0((T_Planet *)Unknown_46[v15]) + v16;
          v18 = v17 - 0xA * sub_360D8((P_Planet)Unknown_46[v15]);
          v19 = (T_Planet *)Unknown_46[v15];
          v23 = v17;
          v23 = v18 - 5 * sub_36158(v19);
        }
        ++v13;
        ++v15;
      }
      if ( a1 == V_Game.races[a2].star )
      {
        v23 += 20000;
      }
      v23 = (int)((double)v23 * v28);
    }
    if ( v23 < 0 )
    {
      v23 = 0;
    }
  }
  return 5 * v23;
}
// 1DB70: using guessed type P_Ship var_1D4[107];

//----- (0001DE64) --------------------------------------------------------
void __fastcall __spoils<> Q_GameCtor_sub_1DE64(P_Game pGame)
{
  _wcpp_2_ctor_array_(pGame->races, 7u, &C_Race);
  _wcpp_2_ctor_array_(pGame->stars, 100u, &C_Star);
  _wcpp_2_ctor_array_(pGame->lanes, 148u, &C_Lane);
  _wcpp_2_ctor_array_(pGame->planets, 500u, &C_Planet);
  _wcpp_2_ctor_array_(pGame->ships, 107u, &C_Ship);
  _wcpp_2_ctor_array_(pGame->sectors, 9u, &C_Sector);
  _wcpp_2_ctor_array_(&pGame->t10, 24u, &C_Type09);
  sub_1E094(pGame);
}

//----- (0001E03C) --------------------------------------------------------
void __fastcall Q_GameDtor_sub_1E03C(P_Game a1)
{
  sub_222C0(&a1->t10);
  sub_222E0(a1->sectors);
  sub_222A0(a1->ships);
  sub_22300(a1->planets);
  sub_22320(a1->lanes);
  sub_22280(a1->stars);
  sub_22260(a1->races);
}

//----- (0001E094) --------------------------------------------------------
void __fastcall sub_1E094(P_Game pGame)
{
  T_Name20 *v2; // edx
  int v3; // ebx
  _BYTE *v4; // edi
  char *text; // esi
  char v6; // al
  char v7; // al

  v2 = V_StarTypeTexts_D84C4;
  v3 = 0xB2;                                           // 178: "Blue Giant"
  do
  {
    v4 = v2;
    text = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v3);
    do
    {
      v6 = *text;
      *v4 = *text;
      if ( !v6 )
      {
        break;
      }
      v7 = text[1];
      text += 2;
      v4[1] = v7;
      v4 += 2;
    }
    while ( v7 );
    ++v2;
    ++v3;
  }
  while ( v2 != (T_Name20 *)V_StarTypeTexts_D84C4[13] );
  pGame->starsNum = 0;
  pGame->lanesNum = 0;
  pGame->racesNum = 0;
  pGame->shipsNum = 0;
  pGame->Unknown_D8A[0x2A] = 1;
}

//----- (0001E10C) --------------------------------------------------------
void __fastcall sub_1E10C(P_Game pGame, __int16 stars, __int16 races, unsigned __int8 a4)
{
  *(_WORD *)pGame->z1 = 0;
  dword_96B88 = 0x20;
  sub_1E2A0(pGame, stars);
  sub_1E150(pGame, 9);
  sub_1EFC0(pGame);
  sub_1E70C(pGame, races, a4);
}
// 96B88: using guessed type int dword_96B88;

//----- (0001E150) --------------------------------------------------------
void __fastcall sub_1E150(P_Game pGame, __int16 sectors)
{
  int v3; // ebx
  int i; // ecx
  int angle0; // edi
  T_Vector3D *p_v; // kr00_4
  int iii; // kr04_4
  P_Game v8; // kr08_4
  int ii; // kr0C_4
  float degrees; // [esp+0h] [ebp-44h]
  T_Vector3D vector; // [esp+10h] [ebp-34h] BYREF
  int angle2; // [esp+1Ch] [ebp-28h]
  int angle1; // [esp+20h] [ebp-24h]
  int v14; // [esp+24h] [ebp-20h]
  int v15; // [esp+28h] [ebp-1Ch]
  __int16 sectors_1; // [esp+2Ch] [ebp-18h]

  sectors_1 = sectors;
  if ( sectors > 9 )
  {
    sectors_1 = 9;
  }
  v3 = sectors_1;
  pGame->sectorsNum = 0;
  memset(&vector, 0, sizeof(vector));
  v14 = 360 / v3;
  angle1 = 3 * (360 / v3) / 4;
  i = 0;
  angle0 = 0;
  angle2 = angle1 / 2;
  p_v = &pGame->sectors[0].v;
  iii = 0;
  v8 = pGame;
  ii = 0;
  while ( i < sectors_1 )
  {
    v8->sectors[ii].n = i;
    vector.x = 1000.0;
    vector.y = 300.0;
    vector.z = 0.0;
    v15 = angle0 + rand() % angle1 - angle2;
    degrees = (float)v15;
    Q_RotateVectorY_sub_532AC(&vector, degrees);
    v15 = rand() % 600 - 300;
    vector.y = (double)v15 + vector.y;
    *(float *)((char *)&p_v->x + 0xD * iii) = vector.x;
    *(float *)((char *)&p_v->y + 0xD * iii) = vector.y;
    *(float *)((char *)&p_v->z + 0xD * iii) = vector.z;
    ++i;
    angle0 += v14;
    ++pGame->sectorsNum;
    ++iii;
    ++ii;
  }
}

//----- (0001E2A0) --------------------------------------------------------
int __fastcall sub_1E2A0(P_Game a1, __int16 stars)
{
  __int16 k; // bx
  FILE *v3; // ebp
  __int16 i; // ax
  int v5; // edx
  P_Game v6; // eax
  P_Game v7; // edx
  int v8; // kr04_4
  int v9; // ecx
  __int16 v10; // ax
  char *v11; // edx
  char *v12; // edi
  char *v13; // esi
  int v14; // ebx
  char v15; // al
  char v16; // al
  int v17; // ebx
  char *v18; // edi
  char *v19; // esi
  char v20; // al
  char v21; // al
  double v22; // st7
  __int16 v23; // bx
  __int16 v24; // si
  __int16 j; // dx
  __int16 v26; // cx
  P_Game v27; // edx
  __int16 starsNum; // si
  char *v30; // [esp-4h] [ebp-82Ch]
  T_Name20 names[100]; // [esp+0h] [ebp-828h] BYREF
  float z; // [esp+7D0h] [ebp-58h] BYREF
  T_Vector3D vector; // [esp+7D4h] [ebp-54h]
  fpos_t endOffset; // [esp+7E0h] [ebp-48h]
  float pos; // [esp+7E4h] [ebp-44h]
  T_Vector3D vec1; // [esp+7E8h] [ebp-40h] BYREF
  int end; // [esp+7F4h] [ebp-34h] BYREF
  _DWORD v1[2]; // [esp+7F8h] [ebp-30h] BYREF
  int v39; // [esp+800h] [ebp-28h]
  float *v40; // [esp+804h] [ebp-24h]
  FILE *fp; // [esp+808h] [ebp-20h]
  P_Game v42; // [esp+80Ch] [ebp-1Ch]
  int v43; // [esp+810h] [ebp-18h]
  int v44; // [esp+814h] [ebp-14h]
  char *v45; // [esp+818h] [ebp-10h]
  int v46; // [esp+81Ch] [ebp-Ch]
  float v47; // [esp+820h] [ebp-8h]
  __int16 v48; // [esp+824h] [ebp-4h]

  v42 = a1;
  memset(&vec1, 0, sizeof(vec1));
  v43 = 0;
  k = 0;
  fp = Q_OpenFile_sub_1BB10("names.txt", &end);
  v47 = 440.0;
  v3 = fp;
  while ( k < 100 )
  {
    fgetpos(fp, v1);
    if ( end > v1[0] )
    {
      fscanf(v3, "%s", names[k]);
    }
    else
    {
      sprintf(names[k], "XM%02d", k);
    }
    ++k;
  }
  fclose(fp);
  v46 = 100;
  v42->starsNum = stars;
  v44 = stars / 2;
  for ( i = 0; i < 13; ++i )
  {
    v5 = word_96514[i];
    v43 += v5;
  }
  v6 = v42;
  v42->planetsNum = 0;
  v7 = v42;
  v6->Word_18245 = 0;
  v7->day = 0;
  v7->pCurStar = v6->stars;
  v7->pCurPlanet = v7->planets;
  v48 = 0;
  if ( v42->starsNum > 0 )
  {
    v1[1] = v6->stars;
    v45 = names[v46];
    v8 = 0;
    do
    {
      v9 = v48;
      *((_BYTE *)&v3->_bufsize + 8 * v8) = 0;
      *((_BYTE *)&v3->_bufsize + 8 * v8 + 1) = 0;
      *((_BYTE *)&v3->_bufsize + 8 * v8 + 2) = 0;
      *((_BYTE *)&v3->_bufsize + 8 * v8 + 3) = 0;
      *((_WORD *)&v3[2]._handle + 4 * v8) = 0;
      *((_WORD *)&v3->_cnt + 4 * v8 + 1) = 0xFFFF;
      v10 = v48;
      *((_WORD *)&v3[3]._flag + 4 * v8) = 0;
      *((_WORD *)&v3->_cnt + 4 * v8) = v10;
      v11 = names[rand() % v46];
      v12 = (char *)&v3[1]._ptr + 8 * v8 + 2;
      v13 = v11;
      v14 = v46;
      v30 = v12;
      do
      {
        v15 = *v13;
        *v12 = *v13;
        if ( !v15 )
        {
          break;
        }
        v16 = v13[1];
        v13 += 2;
        v12[1] = v16;
        v12 += 2;
      }
      while ( v16 );
      v17 = v14 - 1;
      v18 = v11;
      v19 = v45 + 0xFFFFFFEC;
      v45 += 0xFFFFFFEC;
      v30 = v11;
      do
      {
        v20 = *v19;
        *v18 = *v19;
        if ( !v20 )
        {
          break;
        }
        v21 = v19[1];
        v19 += 2;
        v18[1] = v21;
        v18 += 2;
      }
      while ( v21 );
      v46 = v17;
      if ( v9 > v44 )
      {
        v22 = v47 + -75.0;
        v47 = v22;
        if ( v22 < 50.0 )
        {
          v47 = 50.0;
        }
        v44 += (v42->starsNum - v48) / 2;
      }
      *((_DWORD *)&v3->_ptr + 2 * v8) = 0xC;
      v23 = 0;
      v24 = rand() % v43 + 1;
      for ( j = 0; j < 0xD; ++j )
      {
        v23 += word_96514[j];
        if ( v24 <= v23 )
        {
          *((_DWORD *)&v3->_ptr + 2 * v8) = j;
          break;
        }
      }
      v39 = rand() % 1000 - 500;
      vec1.x = (float)v39;
      v39 = rand() % 1000 - 500;
      vec1.y = (float)v39;
      v39 = rand() % 1000 - 500;
      vec1.z = (float)v39;
      Q_NormVector3D_sub_53000(&vec1);
      v40 = &z;
      vector.z = vec1.x * v47;
      z = vector.z;
      *(float *)&endOffset = vec1.y * v47;
      LODWORD(vector.x) = endOffset;
      pos = v47 * vec1.z;
      vector.y = pos;
      vec1.x = vector.z;
      LODWORD(vec1.y) = endOffset;
      vec1.z = pos;
      *((_DWORD *)&v3->_base + 2 * v8) = LODWORD(vector.z);
      *(&v3->_flag + 2 * v8) = LODWORD(vec1.y);
      v26 = v48;
      v27 = v42;
      *(&v3->_handle + 2 * v8) = LODWORD(vec1.z);
      starsNum = v27->starsNum;
      v48 = v26 + 1;
      ++v8;
    }
    while ( (__int16)(v26 + 1) < starsNum );
  }
  return fclose(fp);
}

//----- (0001E70C) --------------------------------------------------------
P_Game __fastcall sub_1E70C(P_Game pGame, __int16 races, unsigned __int8 a3)
{
  int v4; // eax
  int v5; // edi
  int v6; // eax
  int starsNum; // eax
  WORD k; // di
  int v9; // eax
  __int16 m; // ax
  int *v11; // edx
  int v12; // ecx
  P_Star star; // edx
  int v14; // ebx
  T_Star *v15; // edx
  char v16; // bl
  __int16 v17; // dx
  int *v18; // eax
  int v19; // ecx
  P_Star v20; // eax
  int ii; // ecx
  unsigned __int8 v22; // bl
  UBYTE v23; // dl
  T_Race *v24; // eax
  unsigned int v25; // edi
  __int16 v26; // ax
  int mm; // edx
  int v28; // eax
  int v29; // ecx
  int v30; // edi
  int jj; // edx
  int v32; // eax
  int v33; // ecx
  int v34; // edi
  int kk; // edx
  int v36; // eax
  int v37; // ecx
  int v38; // edi
  char v39; // al
  int v40; // eax
  P_Game result; // eax
  P_Game v42; // edx
  P_Star v43; // ebx
  UBYTE ability; // ch
  P_Game v45; // edx
  int v46; // ecx
  int v47; // [esp+4h] [ebp-28h]
  int v48; // [esp+8h] [ebp-24h]
  WORD v50; // [esp+10h] [ebp-1Ch]
  int v51; // [esp+14h] [ebp-18h]
  WORD i; // [esp+14h] [ebp-18h]
  WORD j; // [esp+14h] [ebp-18h]
  __int16 nn; // [esp+14h] [ebp-18h]
  WORD i1; // [esp+14h] [ebp-18h]
  WORD n; // [esp+18h] [ebp-14h]

  pGame->aa2 = 0xFFFFFFFF;
  pGame->z7 = 0;
  pGame->racesNum = races;
  v48 = 0;
  for ( i = 0; i < pGame->starsNum; ++i )
  {
    v4 = i;
    pGame->stars[v4].racesBits = 0;
    pGame->stars[v4].Unknown_15 = 0;
    pGame->stars[v4].Unknown_16 = 0;
    pGame->stars[v4].Unknown_17 = 0;
  }
  for ( j = 0; j < pGame->lanesNum; ++j )
  {
    pGame->lanes[j].Unknown_20[0] = 0;
  }
  v5 = 0;
  Q_RESEARCH_CPP_LoadResTreeTxt_sub_46480(&V_ResTree, 0);
  while ( 1 )
  {
    LOWORD(v51) = v5;
    v6 = (__int16)v5;
    if ( (__int16)v5 >= 7 )
    {
      break;
    }
    V_ResTree.a.w1[(__int16)v5] = 0xFFFF;
    v5 = v51 + 1;
    word_106FB4[v6] = 0;
  }
  v50 = 0x258;
  starsNum = pGame->starsNum;
  pGame->f = 0;
  if ( starsNum < 0x19 )
  {
    v50 = 0x1C2;
  }
  while ( v50 > pGame->f )
  {
    if ( v48 )
    {
      for ( k = 0; k < pGame->racesNum; ++k )
      {
        v9 = k;
        pGame->races[v9].star->racesBits = 0;
        pGame->races[v9].star->Unknown_17 = 0;
        for ( m = 0; ; ++m )
        {
          star = pGame->races[k].star;
          if ( m >= star->Unknown_44 )
          {
            break;
          }
          v11 = *(int **)&star->Unknown_2C[4 * m];
          v12 = *v11;
          *((_BYTE *)v11 + 0x20) = 0;
          *(_BYTE *)(v12 + 0x16) = 0;
          *(_BYTE *)(v11[1] + 0x16) = 0;
        }
      }
    }
    for ( n = 0; n < pGame->racesNum; ++n )
    {
      v14 = *(int *)((char *)&pGame->stars[0x63].z2 + 2);
      v15 = &pGame->stars[rand() % (v14 >> 0x10)];
      pGame->races[n].star = v15;
      if ( v15->racesBits )
      {
        --n;
      }
      else
      {
        v15->racesBits = 0x80;
        v16 = 1 << n;
        pGame->races[n].star->racesBits |= 1 << n;
        pGame->races[n].index = n;
        v17 = 0;
        pGame->races[n].star->Unknown_17 |= 1 << n;
        while ( 1 )
        {
          v20 = pGame->races[n].star;
          if ( v17 >= v20->Unknown_44 )
          {
            break;
          }
          v18 = *(int **)&v20->Unknown_2C[4 * v17];
          v19 = *v18;
          *((_BYTE *)v18 + 0x20) |= v16;
          *(_BYTE *)(v19 + 0x16) |= v16;
          ++v17;
          *(_BYTE *)(v18[1] + 0x16) |= v16;
        }
      }
    }
    v5 = v48 + 1;
    sub_220CC(pGame);
    ++v48;
  }
  for ( ii = 0; (__int16)ii < pGame->racesNum; ++ii )
  {
    if ( (_WORD)ii )
    {
      do
      {
        v25 = 0;
        v22 = rand() % 0x15;
        v26 = 0;
        if ( (__int16)ii > 0 )
        {
          while ( v22 != pGame->races[v26].Unknown_01 )
          {
            if ( ++v26 >= (__int16)ii )
            {
              goto LABEL_37;
            }
          }
          v25 = 0xFFFFFFFF;
        }
LABEL_37:
        ;
      }
      while ( v25 );
    }
    else
    {
      v22 = a3;
    }
    v23 = ii;
    HIWORD(v5) = (unsigned int)pGame->races >> 0x10;
    v24 = &pGame->races[(__int16)ii];
    sub_3B1FC(v24, v23, v22);
  }
  sub_1EE08(pGame, pGame->races[0].Unknown_02);
  v39 = pGame->Unknown_D8A[0x2A];
  if ( v39 )
  {
    if ( (unsigned __int8)v39 <= 1u )
    {
      for ( jj = 0; (__int16)jj < pGame->racesNum; ++jj )
      {
        v32 = (__int16)jj;
        LOWORD(ii) = pGame->races[v32].Unknown_1C7[1];
        v33 = ii + 0x1E;
        LOWORD(v5) = pGame->races[v32].Unknown_1C7[2];
        pGame->races[v32].Unknown_1C7[1] = v33;
        v34 = v5 + 0x1E;
        LOWORD(v33) = pGame->races[v32].Unknown_1C7[3];
        pGame->races[v32].Unknown_1C7[2] = v34;
        v33 += 0x1E;
        LOWORD(v34) = pGame->races[v32].Unknown_1C7[4];
        pGame->races[v32].Unknown_1C7[3] = v33;
        v34 += 0x1E;
        LOWORD(v33) = pGame->races[v32].Unknown_1C7[5];
        pGame->races[v32].Unknown_1C7[4] = v34;
        v33 += 0x1E;
        LOWORD(v34) = pGame->races[v32].Unknown_1C7[6];
        pGame->races[v32].Unknown_1C7[5] = v33;
        v5 = v34 + 0x28;
        LOWORD(v33) = pGame->races[v32].Unknown_1D5;
        pGame->races[v32].Unknown_1C7[6] = v5;
        ii = v33 - 0x1E;
        pGame->races[v32].Unknown_1D5 = ii;
      }
    }
    else if ( v39 == 2 )
    {
      for ( kk = 0; (__int16)kk < pGame->racesNum; ++kk )
      {
        v36 = (__int16)kk;
        LOWORD(ii) = pGame->races[v36].Unknown_1C7[1];
        v37 = ii + 0x14;
        LOWORD(v5) = pGame->races[v36].Unknown_1C7[2];
        pGame->races[v36].Unknown_1C7[1] = v37;
        v38 = v5 + 0x14;
        LOWORD(v37) = pGame->races[v36].Unknown_1C7[3];
        pGame->races[v36].Unknown_1C7[2] = v38;
        v37 += 0x14;
        LOWORD(v38) = pGame->races[v36].Unknown_1C7[4];
        pGame->races[v36].Unknown_1C7[3] = v37;
        v38 += 0x14;
        LOWORD(v37) = pGame->races[v36].Unknown_1C7[5];
        pGame->races[v36].Unknown_1C7[4] = v38;
        v37 += 0x14;
        LOWORD(v38) = pGame->races[v36].Unknown_1C7[6];
        pGame->races[v36].Unknown_1C7[5] = v37;
        v5 = v38 + 0x1E;
        LOWORD(v37) = pGame->races[v36].Unknown_1D5;
        pGame->races[v36].Unknown_1C7[6] = v5;
        ii = v37 - 0x14;
        pGame->races[v36].Unknown_1D5 = ii;
      }
    }
  }
  else
  {
    for ( mm = 0; (__int16)mm < pGame->racesNum; ++mm )
    {
      v28 = (__int16)mm;
      LOWORD(ii) = pGame->races[v28].Unknown_1C7[1];
      v29 = ii + 0x14;
      LOWORD(v5) = pGame->races[v28].Unknown_1C7[2];
      pGame->races[v28].Unknown_1C7[1] = v29;
      v30 = v5 + 0x14;
      LOWORD(v29) = pGame->races[v28].Unknown_1C7[3];
      pGame->races[v28].Unknown_1C7[2] = v30;
      v29 += 0x14;
      LOWORD(v30) = pGame->races[v28].Unknown_1C7[4];
      pGame->races[v28].Unknown_1C7[3] = v29;
      v30 += 0x14;
      LOWORD(v29) = pGame->races[v28].Unknown_1C7[5];
      pGame->races[v28].Unknown_1C7[4] = v30;
      v29 += 0x14;
      LOWORD(v30) = pGame->races[v28].Unknown_1C7[6];
      pGame->races[v28].Unknown_1C7[5] = v29;
      v5 = v30 + 0x1E;
      LOWORD(v29) = pGame->races[v28].Unknown_1D5;
      pGame->races[v28].Unknown_1C7[6] = v5;
      ii = v29 - 0x14;
      pGame->races[v28].Unknown_1D5 = ii;
    }
  }
  pGame->pCurStar = pGame->races[0].star;
  pGame->shipsNum = 0;
  for ( nn = 0; ; ++nn )
  {
    result = (P_Game)nn;
    if ( nn >= 0x6B )
    {
      break;
    }
    v40 = nn;
    pGame->ships[v40].raceIndex = 0xFFFF;
    pGame->ships[v40].locationType = 0;
    pGame->ships[v40].pLocation.pPlanet = 0;
  }
  for ( i1 = 0; i1 < pGame->racesNum; ++i1 )
  {
    if ( pGame->races[i1].ability == 3 && i1 == V_RaceIndex )
    {
      result = (P_Game)(V_RaceIndex ^ i1);
      v42 = pGame;
      while ( (int)result < pGame->racesNum )
      {
        v43 = v42->races[0].star;
        v42 = (P_Game)((char *)v42 + 0x1EE);
        result = (P_Game)((char *)result + 1);
        v43->Unknown_17 |= 1 << i1;
      }
    }
    else
    {
      ability = pGame->races[i1].ability;
      if ( ability == 0xF )
      {
        result = 0;
        v45 = pGame;
        while ( (int)result < pGame->lanesNum )
        {
          result = (P_Game)((char *)result + 1);
          v45->lanes[0].Unknown_20[0] |= 1 << i1;
          v45 = (P_Game)((char *)v45 + 0x27);
        }
      }
      else if ( ability == 4 )
      {
        v46 = 0;
        result = pGame;
        v47 = 0;
        while ( v46 < pGame->racesNum )
        {
          if ( i1 != v46 )
          {
            pGame->races[i1].Unknown_1B2[v47] = pGame->races[i1].Unknown_1D5;
            pGame->races[i1].Unknown_1C0[v46] = 1;
            result->races[0].Unknown_1B2[i1] = result->races[0].Unknown_1D5;
            result->races[0].Unknown_1C0[i1] = 1;
          }
          result = (P_Game)((char *)result + 0x1EE);
          ++v46;
          ++v47;
        }
      }
    }
  }
  return result;
}
// 1E7E7: variable 'v51' is possibly undefined
// 106FB4: using guessed type __int16 word_106FB4[7];

//----- (0001EE08) --------------------------------------------------------
char __fastcall sub_1EE08(P_Game pGame, char a2)
{
  P_Game v2; // esi
  __int16 v3; // cx
  unsigned int v4; // edi
  __int16 v5; // ax
  __int16 v7; // [esp+2h] [ebp-14h]

  v2 = pGame;
  pGame->races[0].Unknown_02 = a2;
  v3 = 1;
  v4 = 0xFFFFFFFF;
  if ( pGame->racesNum > 1 )
  {
    do
    {
LABEL_4:
      while ( v4 )
      {
        v4 = 0;
        v7 = rand() % 7;
        v5 = 0;
        if ( v3 > 0 )
        {
          while ( v2->races[v5].Unknown_02 != v7 )
          {
            if ( ++v5 >= v3 )
            {
              goto LABEL_4;
            }
          }
          v4 = 0xFFFFFFFF;
        }
      }
      LOBYTE(pGame) = v7;
      v2->races[v3++].Unknown_02 = v7;
      v4 = 0xFFFFFFFF;
    }
    while ( v3 < v2->racesNum );
  }
  return (char)pGame;
}
// 1EE39: variable 'v7' is possibly undefined

//----- (0001EEA4) --------------------------------------------------------
__int16 __fastcall sub_1EEA4(P_Game pGame)
{
  P_Game v1; // ebp
  int v2; // ecx
  int v3; // edi
  int v4; // edx
  __int16 Unknown_01; // si
  int v6; // esi
  char s[24]; // [esp+0h] [ebp-38h] BYREF
  int v9; // [esp+18h] [ebp-20h]
  int v10; // [esp+1Ch] [ebp-1Ch]

  v1 = pGame;
  v2 = 0;
  if ( pGame->racesNum > 0 )
  {
    v3 = 0xE;
    v10 = 0x15;
    v9 = 7;
    do
    {
      v4 = (__int16)v2;
      Unknown_01 = v1->races[v4].Unknown_01;
      sprintf(s, "DATA\\SMRACE%02d.SHP", v1->races[v4].Unknown_01);
      sub_1AEB0(&WinMgr.t13, v2, s);
      sprintf(s, "DATA\\LGRACE%02d.SHP", Unknown_01);
      sub_1AEB0(&WinMgr.t13, v9, s);
      sprintf(s, "DATA\\SMSHIP%02d.SHP", Unknown_01);
      sub_1AEB0(&WinMgr.t13, v3, s);
      ++v2;
      ++v3;
      sprintf(s, "DATA\\DKSHIP%02d.SHP", Unknown_01);
      v6 = v9;
      sub_1AEB0(&WinMgr.t13, v10, s);
      LOWORD(pGame) = v1->racesNum;
      v9 = v6 + 1;
      ++v10;
    }
    while ( (__int16)v2 < (__int16)pGame );
  }
  return (__int16)pGame;
}

//----- (0001EFC0) --------------------------------------------------------
void __fastcall sub_1EFC0(P_Game a1)
{
  int i; // eax

  memset(a1->lanes, 0, sizeof(a1->lanes));
  a1->lanesNum = 0;
  sub_1F91C();
  a1->t10.f = 2;
  while ( a1->t10.f > 1 )
  {
    for ( i = 0; (__int16)i < a1->starsNum; ++i )
    {
      a1->stars[(__int16)i].Unknown_6 = 0xFFFF;
    }
    sub_1FB34(a1);
    sub_201D8(a1);
  }
}

//----- (0001F038) --------------------------------------------------------
unsigned int __fastcall sub_1F038(P_Game a1)
{
  int v2; // edi
  UBYTE *v3; // edx
  int i; // ecx
  int j; // eax
  int v6; // ecx
  int v7; // kr04_4
  int v8; // ecx
  T_Lane *lanes; // kr08_4
  int v10; // kr0C_4
  unsigned __int8 index; // bl
  int v12; // edx
  unsigned __int8 v13; // bh
  unsigned __int8 v14; // bh
  unsigned __int8 v15; // bh
  unsigned __int8 v16; // al
  UBYTE *v17; // eax
  UBYTE *v18; // edx
  unsigned int result; // eax
  char *v20; // ebp
  int v21; // ebx
  int v22; // edx
  char v23; // cl
  char *v24; // eax
  int v25; // edx
  char v26[1100]; // [esp+0h] [ebp-48Ch]
  int v27; // [esp+44Ch] [ebp-40h]
  UBYTE *v28; // [esp+450h] [ebp-3Ch]
  int v29; // [esp+454h] [ebp-38h]
  int v30; // [esp+458h] [ebp-34h]
  int v31; // [esp+45Ch] [ebp-30h]
  unsigned int v32; // [esp+460h] [ebp-2Ch]
  int v33; // [esp+464h] [ebp-28h]
  unsigned __int8 v34; // [esp+468h] [ebp-24h]
  unsigned __int8 v35; // [esp+46Ch] [ebp-20h]
  unsigned __int8 v36; // [esp+470h] [ebp-1Ch]

  if ( a1->t10.f != 1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x5BA);
  }
  v2 = (a1->starsNum - 1) * a1->starsNum;
  v28 = V_BigBuffer;
  if ( !V_BigBuffer )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x5C2);
  }
  v3 = v28;
  for ( i = 0; i < a1->starsNum; ++i )
  {
    for ( j = i + 1; j < a1->starsNum; ++j )
    {
      v3[1] = j;
      *v3 = i;
      v3 += 2;
    }
  }
  if ( v3 - v28 != v2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x5D1);
  }
  memset(a1->z10000, 0xFF, sizeof(a1->z10000));
  v6 = 0;
  v31 = v2 >> 1;
  v7 = 0;
  while ( v6 < a1->starsNum )
  {
    a1->z10000[0x64 * v7 + v6] = 0;
    v26[++v6 + 0x3E7] = 0;
    ++v7;
  }
  v8 = 0;
  lanes = a1->lanes;
  v10 = 0;
  while ( v8 < a1->lanesNum )
  {
    index = lanes[v10].pStar1->index;
    v36 = lanes[v10].pStar2->index;
    v12 = v36;
    a1->z10000[0x64 * index + v36] = 1;
    a1->z10000[0x64 * v12 + index] = 1;
    v13 = v26[index + 0x3E8];
    v29 = v13;
    v26[index + 0x3E8] = v13 + 1;
    v14 = v26[v12 + 0x3E8];
    v26[0xA * index + v29] = v12;
    v29 = v14;
    v15 = v14 + 1;
    v26[v12 + 0x3E8] = v15;
    v16 = v26[index + 0x3E8];
    v26[0xA * v12 + v29] = index;
    if ( v16 >= 0xAu || v15 >= 0xAu )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x5F3);
    }
    ++v8;
    ++v10;
  }
  v17 = v28;
  v18 = &v28[2 * v31 - 2];
  if ( v18 >= v28 )
  {
    do
    {
      if ( a1->z10000[0x64 * *v17 + v17[1]] == 1 )
      {
        *v17 = *v18;
        v17[1] = v18[1];
        v18 += 0xFFFFFFFE;
        --v31;
      }
      else
      {
        v17 += 2;
      }
    }
    while ( v17 <= v18 );
  }
  result = v31;
  v27 = 2;
  if ( v31 > 0 )
  {
    v30 = 1;
    do
    {
      if ( a1->starsNum <= v27 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x610);
      }
      v20 = (char *)v28;
      result = (unsigned int)&v28[2 * v31 - 2];
      v32 = result;
      if ( (unsigned int)v28 <= result )
      {
        v33 = v30;
        do
        {
          v35 = *v20;
          v34 = v20[1];
          for ( result = 0; (__int16)result < (int)(unsigned __int8)v26[v35 + 0x3E8]; ++result )
          {
            v21 = v35;
            v22 = v34;
            if ( (unsigned __int8)a1->z10000[0x64 * (unsigned __int8)v26[0xA * v35 + (__int16)result] + v34] == v33 )
            {
              v23 = v27;
              a1->z10000[0x64 * v35 + v34] = v27;
              v24 = (char *)v32;
              a1->z10000[0x64 * v22 + v21] = v23;
              *v20 = *v24;
              v20 += 0xFFFFFFFE;
              v25 = v31;
              v20[3] = *(_BYTE *)(v32 + 1);
              result = v32 - 2;
              v31 = v25 - 1;
              v32 -= 2;
              break;
            }
          }
          v20 += 2;
        }
        while ( (unsigned int)v20 <= v32 );
      }
      ++v30;
      ++v27;
    }
    while ( v31 > 0 );
  }
  return result;
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (0001F404) --------------------------------------------------------
int __fastcall sub_1F404(P_Game pGame)
{
  T_Planet *planet; // ebp
  P_Game v2; // eax
  T_Star *v3; // edx
  double v4; // st7
  int v5; // ebx
  int v6; // edx
  int v7; // edx
  WORD v8; // ax
  P_Game v9; // ecx
  UWORD v10; // ax
  P_Game v11; // edx
  double v12; // st7
  P_Game v13; // edx
  int v1; // eax
  float angle; // [esp-4h] [ebp-11Ch]
  int v16[21]; // [esp+0h] [ebp-118h] BYREF
  int v17[21]; // [esp+54h] [ebp-C4h] BYREF
  T_Vector3D vector; // [esp+A8h] [ebp-70h]
  float v19[3]; // [esp+B4h] [ebp-64h] BYREF
  T_Vector3D vec1; // [esp+C0h] [ebp-58h] BYREF
  float v21; // [esp+CCh] [ebp-4Ch]
  float *v22; // [esp+D0h] [ebp-48h]
  P_Star v23; // [esp+D4h] [ebp-44h]
  int *Unknown_49C5; // [esp+D8h] [ebp-40h]
  const char *v25; // [esp+DCh] [ebp-3Ch]
  int v26; // [esp+E0h] [ebp-38h]
  int v27; // [esp+E4h] [ebp-34h]
  float v28; // [esp+E8h] [ebp-30h]
  int j; // [esp+ECh] [ebp-2Ch]
  T_Star *stars; // [esp+F0h] [ebp-28h]
  int numPlanets; // [esp+F4h] [ebp-24h]
  int v32; // [esp+F8h] [ebp-20h]
  T_Star *v33; // [esp+FCh] [ebp-1Ch]
  int v34; // [esp+100h] [ebp-18h]
  unsigned int v35; // [esp+104h] [ebp-14h]
  int v36; // [esp+108h] [ebp-10h]
  char *name; // [esp+10Ch] [ebp-Ch]
  P_Game v38; // [esp+110h] [ebp-8h]
  int i; // [esp+114h] [ebp-4h]

  v38 = pGame;
  stars = pGame->stars;
  Unknown_49C5 = pGame->Unknown_49C5;
  planet = pGame->planets;
  j = 0;
  v23 = (P_Star)pGame->stars[0].name;
  while ( 1 )
  {
    v1 = v38->starsNum;
    if ( v1 <= j )
    {
      return v1;
    }
    numPlanets = rand() % 5 + 1;
    if ( numPlanets > 5 )
    {
      numPlanets = 5;
    }
    v36 = 0xFFFFFFFF;
    i = 0;
    v2 = v38;
    while ( v38->racesNum > i )
    {
      if ( stars == v2->races[0].star )
      {
        v36 = i;
        break;
      }
      v2 = (P_Game)((char *)v2 + 0x1EE);
      ++i;
    }
    if ( v36 >= 0 && !numPlanets )
    {
      numPlanets = 1;
    }
    v32 = 0;
    if ( v36 >= 0 )
    {
      v32 = rand() % numPlanets;
    }
    v3 = stars;
    stars->planetsNum = numPlanets;
    memset(&vec1, 0, sizeof(vec1));
    v4 = (double)word_964FA[v3->type];
    v34 = 0;
    i = 0;
    v28 = v4;
    v26 = 360 / numPlanets;
    if ( numPlanets > 0 )
    {
      v25 = (const char *)v23;
      v35 = 0;
      v33 = stars;
      v27 = (int)v38 + 0x1EE * v36;
      name = planet->name;
      do
      {
        v33->Unknown_46[0] = (int)planet;
        LOWORD(v5) = rand() % 5;
        LOWORD(v6) = rand() % 0xB;
        if ( v36 >= 0 && v32 == i )
        {
          qmemcpy(v16, dword_96548, sizeof(v16));
          qmemcpy(v17, dword_9659C, sizeof(v17));
          v7 = *(unsigned __int8 *)(v27 + 7);
          v5 = v16[v7];
          v6 = v17[v7];
        }
        planet->word1A = 0;
        planet->pUnknown_10 = 0;
        v8 = j;
        planet->z7 = 0;
        planet->starIndex = v8;
        v9 = v38;
        planet->Unknown_E = i;
        v10 = Q_PLANET_CPP_sub_33AF0(planet, v5, v6, &Unknown_49C5[v9->Word_18245]);
        v11 = v38;
        v38->Word_18245 += v10;
        if ( v11->Word_18245 > 20000 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x67B);
        }
        sprintf(name, "%s ", v25);
        Q_AppendRomanNum_sub_31E60(name, i + 1);
        v12 = ((double)word_964F0[v35 / 2] + v28) * 2000.0 * 0.011111111;
        v22 = v19;
        v21 = v12;
        vector.x = v21;
        vector.y = 0.0 * v21;
        vector.z = vector.y;
        v19[0] = v21;
        v19[1] = vector.y;
        v19[2] = vector.y;
        vec1.x = v21;
        vec1.y = vector.y;
        vec1.z = vector.y;
        angle = (float)v34;
        Q_RotateVectorY_sub_532AC(&vec1, angle);
        sub_362C8(planet, &vec1);
        if ( v36 >= 0 && v32 == i )
        {
          planet->raceIndex = v36;
          planet->word42 = 2;
          sub_34AE4(planet, 5u, 0xFFFFFFFF);
        }
        ++planet;
        v33 = (T_Star *)((char *)v33 + 4);
        v35 += 2;
        ++i;
        name += 0x7B;
        v34 += v26;
      }
      while ( i < numPlanets );
    }
    v13 = v38;
    v38->planetsNum += numPlanets;
    if ( v13->planetsNum >= 0x1F4 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x697);
    }
    ++j;
    ++v23;
    ++stars;
  }
}
// 96548: using guessed type int dword_96548[21];
// 9659C: using guessed type int dword_9659C[21];

//----- (0001F91C) --------------------------------------------------------
int sub_1F91C()
{
  int result; // eax
  WORD starsNum; // di
  T_Star *v2; // edx
  int type; // eax
  int v4; // esi
  WORD v5; // ax
  WORD v6; // dx
  T_Vector3D *p_v; // ebx
  WORD v8; // dx
  T_Star *v9; // eax
  double v10; // st7
  int v11[3]; // [esp+14h] [ebp-48h] BYREF
  float v12; // [esp+20h] [ebp-3Ch]
  float v13; // [esp+24h] [ebp-38h]
  float v14; // [esp+28h] [ebp-34h]
  int *v15; // [esp+2Ch] [ebp-30h]
  T_Star *v16; // [esp+30h] [ebp-2Ch]
  T_Star *stars; // [esp+34h] [ebp-28h]
  int v18; // [esp+38h] [ebp-24h]
  int v19; // [esp+3Ch] [ebp-20h]
  WORD v20; // [esp+40h] [ebp-1Ch]

  memset(V_Game.z10000, 0, sizeof(V_Game.z10000));
  for ( result = 0; (__int16)result < V_Game.starsNum; ++result )
  {
    *((_BYTE *)&V_Game.day + 0x64 * (__int16)result + (__int16)result + (_DWORD)&loc_32DDA + 1) = 1;
  }
  starsNum = V_Game.starsNum;
  LOWORD(v19) = 0;
  if ( starsNum > 0 )
  {
    stars = V_Game.stars;
    do
    {
      v2 = &stars[(__int16)v19];
      type = v2->type;
      v16 = v2;
      if ( v2->Unknown_44 != word_9652E[type] )
      {
        v4 = 0x1388;
        v5 = V_Game.starsNum;
        v6 = 0;
        v20 = 0xFFFF;
        p_v = &v16->v;
        if ( v5 > 0 )
        {
          do
          {
            if ( !*((_BYTE *)&V_Game.day + 0x64 * (__int16)v19 + v6 + (_DWORD)&loc_32DDA + 1) )
            {
              v9 = &stars[v6];
              if ( v9->Unknown_44 != word_9652E[v9->type] )
              {
                v15 = v11;
                v12 = 0.0;
                v13 = 0.0;
                v14 = 0.0;
                v12 = p_v->x - v9->v.x;
                v13 = p_v->y - v9->v.y;
                v14 = p_v->z - v9->v.z;
                *(float *)v11 = v12;
                *(float *)&v11[1] = v13;
                *(float *)&v11[2] = v14;
                v10 = sqrt(v13 * v13 + v12 * v12 + v14 * v14);
                v18 = (int)v10;
                if ( v4 > (int)v10 )
                {
                  v4 = (int)v10;
                  v20 = v6;
                }
              }
            }
            ++v6;
          }
          while ( v6 < V_Game.starsNum );
        }
        if ( v20 != 0xFFFFFFFF && !sub_1CF68(v16, &stars[v20]) )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x6D0);
        }
      }
      result = v19 + 1;
      v8 = V_Game.starsNum;
      LOWORD(v19) = result;
    }
    while ( (__int16)result < v8 );
  }
  return result;
}

//----- (0001FB34) --------------------------------------------------------
int __fastcall sub_1FB34(P_Game a1)
{
  WORD i; // bx
  int v3; // eax
  WORD f; // dx
  T_Type09 *v5; // ecx
  int l; // ebx
  float *j; // edx
  float *v8; // eax
  double v9; // st7
  double v10; // st7
  double v11; // st7
  __int16 v12; // bx
  WORD b; // ax
  WORD g; // dx
  WORD v15; // cx
  int result; // eax
  float v17; // [esp+0h] [ebp-58h] BYREF
  float v18; // [esp+4h] [ebp-54h]
  float v19; // [esp+8h] [ebp-50h]
  float v20; // [esp+Ch] [ebp-4Ch]
  float v21; // [esp+10h] [ebp-48h]
  float v22; // [esp+14h] [ebp-44h]
  float v23; // [esp+18h] [ebp-40h] BYREF
  float v24; // [esp+1Ch] [ebp-3Ch]
  float v25; // [esp+20h] [ebp-38h]
  float v26; // [esp+24h] [ebp-34h]
  float v27; // [esp+28h] [ebp-30h]
  float v28; // [esp+2Ch] [ebp-2Ch]
  float *v29; // [esp+30h] [ebp-28h]
  float *v30; // [esp+34h] [ebp-24h]
  int v31; // [esp+38h] [ebp-20h]
  __int16 k; // [esp+3Ch] [ebp-1Ch]

  a1->t10.f = 0;
  memset(&a1->t10, 0, 0x26D0u);
  for ( i = 0; i < a1->starsNum; ++i )
  {
    v3 = i;
    if ( a1->stars[v3].Unknown_6 == 0xFFFFFFFF )
    {
      sub_1FD18(a1, (int)&a1->stars[v3]);
      ++a1->t10.f;
    }
  }
  a1->g = 0;
  f = a1->t10.f;
  k = 0;
  if ( f > 0 )
  {
    do
    {
      v5 = &a1->t10.a.a[k];
      l = 0;
      for ( j = (float *)&v5->c.c; (__int16)l < v5->b; ++l )
      {
        v8 = (float *)v5->a[(__int16)l];
        v29 = &v17;
        v20 = 0.0;
        v21 = 0.0;
        v22 = 0.0;
        v20 = *j + v8[2];
        v21 = *(float *)&v5->c.e + v8[3];
        v9 = *(float *)&v5->c.f + v8[4];
        v17 = v20;
        v22 = v9;
        v18 = v21;
        v19 = v22;
        *j = v20;
        *(float *)&v5->c.e = v18;
        *(float *)&v5->c.f = v19;
      }
      v10 = 1.0 / (double)v5->b;
      v30 = &v23;
      v26 = 0.0;
      v27 = 0.0;
      v28 = 0.0;
      v26 = *j * v10;
      v27 = *(float *)&v5->c.e * v10;
      v11 = v10 * *(float *)&v5->c.f;
      v23 = v26;
      v28 = v11;
      v24 = v27;
      v25 = v28;
      *j = v26;
      *(float *)&v5->c.e = v24;
      v12 = k;
      *(float *)&v5->c.f = v25;
      ++v12;
      b = v5->b;
      g = a1->g;
      k = v12;
      v15 = a1->t10.f;
      a1->g = b + g;
    }
    while ( v12 < v15 );
  }
  v31 = (int)((double)a1->g / (double)a1->t10.f);
  result = v31;
  a1->g = v31;
  return result;
}

//----- (0001FD18) --------------------------------------------------------
void __fastcall sub_1FD18(P_Game a1, int a2)
{
  __int16 i; // bx
  int v5; // edx
  int v6; // edx

  *(_WORD *)(a2 + 6) = a1->t10.f;
  sub_2016C(a1, a2, a1->t10.f);
  for ( i = 0; i < *(__int16 *)(a2 + 0x44); ++i )
  {
    v5 = **(_DWORD **)(a2 + 4 * i + 0x2C);
    if ( *(__int16 *)(v5 + 6) == 0xFFFFFFFF )
    {
      sub_1FD18(a1, v5);
    }
    v6 = *(_DWORD *)(*(_DWORD *)(a2 + 4 * i + 0x2C) + 4);
    if ( *(__int16 *)(v6 + 6) == 0xFFFFFFFF )
    {
      sub_1FD18(a1, v6);
    }
  }
}

//----- (0001FD90) --------------------------------------------------------
int __fastcall sub_1FD90(int a1, int a2, int a3)
{
  int v6; // eax
  WORD starsNum; // bx
  int v8; // edx

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x71E);
  }
  v6 = 0;
  if ( V_Game.starsNum > 0 )
  {
    do
    {
      starsNum = V_Game.starsNum;
      v8 = (__int16)v6++;
      *(_BYTE *)(v8 + a2) = 0;
    }
    while ( (__int16)v6 < starsNum );
  }
  return sub_1FDF0(a1, *(_DWORD *)(a1 + 0x1EE * a3 + 0xD), a2, a3);
}

//----- (0001FDF0) --------------------------------------------------------
int __fastcall sub_1FDF0(int a1, int a2, int a3, int a4)
{
  int result; // eax
  int v5; // esi
  _BYTE *v6; // ebp
  WORD v7; // dx
  __int16 j; // bx
  int raceIndex; // eax
  int v11; // [esp+4h] [ebp-24h]
  WORD i; // [esp+14h] [ebp-14h]
  __int16 v15; // [esp+14h] [ebp-14h]
  char v16; // [esp+18h] [ebp-10h]

  v16 = 0;
  for ( i = 0; i < V_Game.racesNum; ++i )
  {
    if ( *(_BYTE *)(0x1EE * a4 + a1 + i + 0x1C6) == 3 )
    {
      v16 |= 1 << i;
    }
  }
  v15 = 0;
  result = a2;
  if ( *(__int16 *)(a2 + 0x44) > 0 )
  {
    v11 = 1 << a4;
    do
    {
      v5 = *(_DWORD *)(a2 + 4 * v15 + 0x2C);
      result = *(__int16 *)(v5 + 0x21);
      if ( result != a4 )
      {
        if ( *(_DWORD *)v5 == a2 )
        {
          v6 = *(_BYTE **)(v5 + 4);
        }
        else
        {
          v6 = *(_BYTE **)v5;
        }
        if ( ((unsigned __int8)v11 & v6[0x17]) != 0 )
        {
          if ( (~v11 & ((unsigned __int8)(v6[0x15] & ~v16) | (unsigned __int8)(~v16 & v6[0x14])) & 0x7F) != 0 )
          {
            result = a3 + *(__int16 *)(a2 + 4);
            ++*(_BYTE *)result;
          }
          else
          {
            v7 = 0;
            for ( j = 0; j < 0x6B; ++j )
            {
              if ( v7 >= V_Game.shipsNum )
              {
                break;
              }
              raceIndex = V_Game.ships[j].raceIndex;
              if ( raceIndex != 0xFFFFFFFF )
              {
                ++v7;
                if ( (P_Planet)v5 == V_Game.ships[j].pLocation.pPlanet
                  && raceIndex != a4
                  && *(_BYTE *)(0x1EE * a4 + a1 + raceIndex + 0x1C6) != 3 )
                {
                  break;
                }
              }
            }
            if ( v7 < V_Game.shipsNum )
            {
              result = a3 + *(__int16 *)(a2 + 4);
              ++*(_BYTE *)result;
            }
            else
            {
              *(_WORD *)(v5 + 0x21) = a4;
              result = sub_1FDF0(a1, (int)v6, a3, a4);
            }
          }
        }
        else
        {
          result = a3 + *(__int16 *)(a2 + 4);
          ++*(_BYTE *)result;
        }
      }
      ++v15;
    }
    while ( v15 < *(__int16 *)(a2 + 0x44) );
  }
  return result;
}

//----- (0001FFE0) --------------------------------------------------------
int __fastcall sub_1FFE0(P_Game a1, int a2)
{
  int result; // eax
  _BYTE *v4; // edi
  WORD v5; // dx
  __int16 k; // bx
  int v7; // esi
  WORD i; // [esp+4h] [ebp-1Ch]
  __int16 j; // [esp+4h] [ebp-1Ch]
  char v11; // [esp+8h] [ebp-18h]

  v11 = 0;
  for ( i = 0; i < V_Game.racesNum; ++i )
  {
    if ( V_Game.races[V_RaceIndex].Unknown_1C0[i] == 3 )
    {
      v11 |= 1 << i;
    }
  }
  result = a2;
  for ( j = 0; j < *(__int16 *)(a2 + 0x44); ++j )
  {
    result = a2 + 4 * j;
    v7 = *(_DWORD *)(result + 0x2C);
    if ( !*(_WORD *)(v7 + 0x21) )
    {
      v4 = *(_DWORD *)v7 == a2 ? *(_BYTE **)(v7 + 4) : *(_BYTE **)v7;
      result = (unsigned __int8)v4[0x17];
      if ( ((1 << V_RaceIndex) & result) != 0 )
      {
        result = ((unsigned __int8)(v4[0x15] & ~v11) | (unsigned __int8)(~v11 & v4[0x14])) & 0x7F;
        if ( (~(1 << V_RaceIndex) & result) == 0 )
        {
          v5 = 0;
          for ( k = 0; ; ++k )
          {
            result = k;
            if ( k >= 0x6B )
            {
              break;
            }
            if ( v5 >= V_Game.shipsNum )
            {
              break;
            }
            result = V_Game.ships[k].raceIndex;
            if ( result != 0xFFFFFFFF )
            {
              ++v5;
              if ( (P_Planet)v7 == V_Game.ships[k].pLocation.pPlanet
                && result != V_RaceIndex
                && V_Game.races[V_RaceIndex].Unknown_1C0[result] != 3 )
              {
                break;
              }
            }
          }
          if ( v5 >= V_Game.shipsNum )
          {
            *(_WORD *)(v7 + 0x21) = 1;
            ++a1->starsControlled;
            result = sub_1FFE0(a1, (int)v4);
          }
        }
      }
    }
  }
  return result;
}

//----- (0002016C) --------------------------------------------------------
void __fastcall sub_2016C(P_Game a1, int a2, __int16 a3)
{
  T_Type09 *v3; // ecx

  if ( a3 >= 24 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x7BB);
  }
  v3 = &a1->t10.a.a[a3];
  if ( v3->b >= 100 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x7BE);
  }
  v3->a[v3->b++] = a2;
}

//----- (000201D8) --------------------------------------------------------
void __fastcall sub_201D8(P_Game a1)
{
  __int16 *v1; // ecx
  __int16 f; // si
  __int16 *v3; // esi
  __int16 v4; // dx
  int v5; // eax
  float *v6; // edi
  float *v7; // eax
  float v8; // ebx
  __int16 i; // dx
  T_Type09 *v10; // ebx
  double v11; // st7
  __int16 j; // bx
  int v13; // edx
  double v14; // st7
  int v15; // eax
  T_Lane *v16; // eax
  int v17; // eax
  float v18; // [esp+8h] [ebp-88h]
  int v19; // [esp+Ch] [ebp-84h]
  int v20; // [esp+10h] [ebp-80h]
  float v21; // [esp+14h] [ebp-7Ch]
  int v22; // [esp+18h] [ebp-78h]
  int v23; // [esp+1Ch] [ebp-74h]
  int v24[3]; // [esp+20h] [ebp-70h] BYREF
  int v25[3]; // [esp+2Ch] [ebp-64h] BYREF
  float v26; // [esp+38h] [ebp-58h]
  int v27; // [esp+3Ch] [ebp-54h]
  int v28; // [esp+40h] [ebp-50h]
  int v29; // [esp+44h] [ebp-4Ch]
  int *v30; // [esp+48h] [ebp-48h]
  int *v31; // [esp+4Ch] [ebp-44h]
  T_Type10 *p_t10; // [esp+50h] [ebp-40h]
  int assert; // [esp+54h] [ebp-3Ch]
  int v34; // [esp+58h] [ebp-38h]
  int v35; // [esp+5Ch] [ebp-34h]
  P_Game v36; // [esp+60h] [ebp-30h]
  int v37; // [esp+64h] [ebp-2Ch]
  int v38; // [esp+68h] [ebp-28h]
  int v39; // [esp+6Ch] [ebp-24h]
  __int16 v40; // [esp+70h] [ebp-20h]
  WORD k; // [esp+74h] [ebp-1Ch]

  v36 = a1;
  v1 = 0;
  v26 = 0.0;
  v27 = 0;
  v28 = 0;
  if ( !a1->t10.f )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x7DD);
  }
  if ( v36->t10.f != 1 )
  {
    f = v36->t10.f;
    k = 0;
    if ( f > 0 )
    {
      p_t10 = &v36->t10;
      do
      {
        v3 = (__int16 *)&p_t10->a.a[k];
        v4 = 0;
        v34 = 99999;
        v35 = 99999;
        assert = 0;
        v5 = (unsigned __int16)v3[0xC8];
        v40 = 0;
        v6 = 0;
        if ( (__int16)v5 > 0 )
        {
          do
          {
            v7 = *(float **)&v3[2 * v4];
            LODWORD(v8) = 2 * *(_DWORD *)v7;
            v29 = *(__int16 *)((char *)word_9652E + LODWORD(v8));
            v39 = *((__int16 *)v7 + 0x22);
            v29 -= v39;
            v39 = v40;
            if ( v29 > v40 )
            {
              v6 = v7;
              v40 = *(__int16 *)((char *)word_9652E + LODWORD(v8)) - *((_WORD *)v7 + 0x22);
            }
            ++v4;
          }
          while ( v4 < v3[0xC8] );
        }
        if ( !v6 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x7FF);
        }
        for ( i = 0; i < *(__int16 *)((char *)&v36->day + (_DWORD)&loc_32DCD + 4); ++i )
        {
          if ( i != k )
          {
            v10 = &p_t10->a.a[i];
            v31 = v24;
            v18 = v6[2] - *(float *)&v10->c.c;
            *(float *)&v19 = v6[3] - *(float *)&v10->c.e;
            *(float *)&v20 = v6[4] - *(float *)&v10->c.f;
            *(float *)v24 = v18;
            v24[1] = v19;
            v24[2] = v20;
            v26 = v18;
            v27 = v19;
            v28 = v20;
            v11 = sqrt(*(float *)&v19 * *(float *)&v19 + v18 * v18 + *(float *)&v20 * *(float *)&v20);
            v38 = (int)v11;
            if ( (int)v11 < v34 )
            {
              v1 = (__int16 *)v10;
              v34 = (int)v11;
            }
          }
        }
        if ( !v1 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x813);
        }
        for ( j = 0; j < v1[0xC8]; ++j )
        {
          v13 = *(_DWORD *)&v1[2 * j];
          if ( !*((_BYTE *)&v36->day + 0x64 * *((__int16 *)v6 + 2) + *(__int16 *)(v13 + 4) + (_DWORD)&loc_32DDA + 1) )
          {
            v30 = v25;
            v21 = v6[2] - *(float *)(v13 + 8);
            *(float *)&v22 = v6[3] - *(float *)(v13 + 0xC);
            *(float *)&v23 = v6[4] - *(float *)(v13 + 0x10);
            *(float *)v25 = v21;
            v25[1] = v22;
            v25[2] = v23;
            v26 = v21;
            v27 = v22;
            v28 = v23;
            v14 = sqrt(*(float *)&v22 * *(float *)&v22 + v21 * v21 + *(float *)&v23 * *(float *)&v23);
            v39 = word_9652E[*(_DWORD *)v13];
            v15 = *(__int16 *)(v13 + 0x44);
            v37 = (int)v14;
            if ( v39 != v15 && v37 < v35 )
            {
              assert = v13;
              v35 = v37;
            }
          }
        }
        if ( !assert )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x82C);
        }
        v16 = sub_1CF68((T_Star *)v6, (T_Star *)assert);
        if ( !v16 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x832);
        }
        v16->Unknown_20[3] |= 1u;
        v17 = assert;
        *((_BYTE *)v6 + 0x18) |= 1u;
        *(_BYTE *)(v17 + 0x18) |= 1u;
        ++k;
      }
      while ( k < v36->t10.f );
    }
  }
}

//----- (000205A0) --------------------------------------------------------
T_Lane *__fastcall sub_205A0(P_Game a1, T_Star *a2, T_Star *a3)
{
  int lanesNum; // ebx
  T_Lane *v6; // edx

  if ( !a2 || !a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x83F);
  }
  lanesNum = a1->lanesNum;
  if ( lanesNum == 0x94 || *((_BYTE *)&a1->day + 0x64 * a2->index + a3->index + (_DWORD)&loc_32DDA + 1) )
  {
    return 0;
  }
  v6 = &a1->lanes[lanesNum];
  v6->Unknown_20[0] = 0;
  v6->pStar1 = a2;
  v6->pStar2 = a3;
  ++a1->lanesNum;
  *((_BYTE *)&a1->day + 0x64 * a2->index + a3->index + (_DWORD)&loc_32DDA + 1) = 1;
  *((_BYTE *)&a1->day + 0x64 * a3->index + a2->index + (_DWORD)&loc_32DDA + 1) = 1;
  return v6;
}

//----- (00020684) --------------------------------------------------------
P_Ship __fastcall sub_20684(P_Game pGame, __int16 raceIndex)
{
  T_Ship *pvShip; // ebx
  __int16 v5; // dx
  int v6; // kr04_4
  P_Ship result; // eax

  if ( raceIndex < 0 || raceIndex >= pGame->racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x863);
  }
  if ( pGame->shipsNum >= 107 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x864);
  }
  pvShip = pGame->ships;
  v5 = 0;
  v6 = 0;
  while ( v5 < 107 )
  {
    if ( pGame->ships[v6].raceIndex == 0xFFFFFFFF )
    {
      sub_48C5C(pvShip, 0);
      pvShip->raceIndex = raceIndex;
      result = pvShip;
      ++pGame->shipsNum;
      return result;
    }
    ++v5;
    ++v6;
  }
  Q_AssertLogBreakExit_sub_261A8(0, "..\\cosmos.cpp", 0x873);
  return 0;
}

//----- (00020720) --------------------------------------------------------
void __fastcall sub_20720(P_Game pGame, P_Ship pShip)
{
  if ( pShip->raceIndex < 0 || pShip->raceIndex >= pGame->racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x87E);
  }
  if ( !pShip->locationType )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x87F);
  }
  pShip->raceIndex = 0xFFFF;
  pShip->locationType = 0;
  pShip->name[0] = 0;
  if ( --pGame->shipsNum < 0 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x887);
  }
}

//----- (000207A0) --------------------------------------------------------
char __fastcall sub_207A0(P_Game a1)
{
  int v2; // eax
  int v3; // kr04_4
  int v4; // kr0C_4
  int v5; // kr14_4
  int v6; // kr1C_4
  int v7; // edx
  int v8; // kr24_4
  int v9; // eax
  int v10; // kr2C_4
  int v11; // edx
  int v12; // kr34_4
  int v13; // eax
  int v14; // kr3C_4
  UBYTE v15; // bl
  int v16; // edx
  int v17; // eax
  char v18; // ch
  double v19; // st6
  int v21; // [esp+8h] [ebp-24h]
  int v22; // [esp+8h] [ebp-24h]
  int v23; // [esp+8h] [ebp-24h]
  unsigned __int8 v24; // [esp+Ch] [ebp-20h]
  char v25; // [esp+10h] [ebp-1Ch]

  v25 = 0;
  v2 = 0x1EE * V_RaceIndex;
  if ( *(int *)((char *)&a1->races[0].Unknown_03 + v2) == 0xFFFFFFFF )
  {
    v25 = 1;
  }
  if ( !v25 )
  {
    v2 = 0;
    v25 = 2;
    v3 = 0;
    while ( v2 < a1->racesNum )
    {
      if ( v2 != V_RaceIndex && !a1->races[v3].Unknown_03 )
      {
        v25 = 0;
        break;
      }
      ++v2;
      ++v3;
    }
  }
  if ( !v25 )
  {
    v2 = 0;
    v25 = 3;
    v4 = 0;
    while ( v2 < a1->racesNum )
    {
      if ( (a1->races[v4].star->racesBits & 0x7F) != 1 << V_RaceIndex )
      {
        LOBYTE(v2) = 0;
        v25 = 0;
        break;
      }
      ++v2;
      ++v4;
    }
  }
  if ( !v25 )
  {
    v24 = 0;
    v25 = 4;
    v2 = 0;
    v5 = 0;
    while ( v2 < a1->racesNum )
    {
      if ( !a1->races[v5].Unknown_03 )
      {
        v24 |= 1 << v2;
      }
      if ( v2 != V_RaceIndex && !a1->races[v5].Unknown_03 && a1->races[0].Unknown_1C0[v2] != 3 )
      {
        v25 = 0;
        break;
      }
      ++v2;
      ++v5;
    }
    if ( v25 == 4 )
    {
      v2 = 0;
      v6 = 0;
      while ( v2 < a1->starsNum )
      {
        if ( (v24 & a1->stars[v6].Unknown_17) == 0 )
        {
          v25 = 0;
          break;
        }
        ++v2;
        ++v6;
      }
    }
  }
  if ( !v25 )
  {
    v2 = 2 * a1->starsNum / 3 + 1;
    if ( v2 <= a1->starsControlled )
    {
      v25 = 5;
    }
  }
  if ( v25 )
  {
    v7 = 0;
    v21 = 0;
    v8 = 0;
    while ( v7 < V_ResTree.num )
    {
      if ( ((1 << V_RaceIndex) & V_ResTree.items[v8].Unknown_48) != 0 )
      {
        ++v21;
      }
      ++v7;
      ++v8;
    }
    v9 = 0;
    v10 = 0;
    while ( v9 < *(__int16 *)((char *)&a1->day + (_DWORD)&loc_27281 + 2) )
    {
      if ( V_RaceIndex == *((_BYTE *)&a1->day + 0x7B * v10 + (_DWORD)&loc_1829D + 1) )
      {
        v21 += 2;
      }
      ++v9;
      ++v10;
    }
    v11 = 0;
    v22 = Q_Race_GetShipsNum_sub_40224((P_Race)((char *)a1->races + v9), 0, 0) + v21;
    v12 = 0;
    while ( v11 < a1->starsNum )
    {
      if ( ((1 << V_RaceIndex) & (unsigned __int8)a1->stars[v12].Unknown_17) != 0 )
      {
        ++v22;
      }
      ++v11;
      ++v12;
    }
    v13 = 0;
    v14 = 0;
    while ( v13 < a1->racesNum )
    {
      if ( v13 != V_RaceIndex && a1->races[v14].Unknown_03 != 0xFFFFFFFF )
      {
        v15 = a1->races[0].Unknown_1C0[(_DWORD)a1];
        if ( v15 == 3 )
        {
          v22 += 0xF;
        }
        else if ( v15 == 2 )
        {
          v22 -= 0xA;
        }
      }
      ++v13;
      ++v14;
    }
    if ( v25 == 4 )
    {
      v22 += 0x32;
    }
    v16 = 0x64 - 0x4B * a1->day / 0xFA0;
    v17 = v16;
    if ( v16 >= 0x19 )
    {
      if ( v16 > 0x64 )
      {
        v17 = 0x64;
      }
    }
    else
    {
      v17 = 0x19;
    }
    v18 = a1->Unknown_D8A[0x2A];
    v23 = v17 * v22 / 0x64;
    if ( v18 == 1 )
    {
      v19 = (double)v23 * 1.25;
    }
    else
    {
      if ( v18 != 2 )
      {
LABEL_71:
        if ( v23 < 0 )
        {
          v23 = 0;
        }
        *((_BYTE *)&loc_30700 + (_DWORD)a1) = v25;
        a1->aa2 = 0x64 * v23 / 0x258;
        WinMgr.gameEventsNum = 0;
        LOBYTE(v2) = sub_56B60(&WinMgr, 1, 9, 1);
        return v2;
      }
      v19 = (double)v23 * 1.5;
    }
    v23 = (int)v19;
    goto LABEL_71;
  }
  return v2;
}

//----- (00020B3C) --------------------------------------------------------
T_Star *__fastcall sub_20B3C(P_Game pGame)
{
  T_Star *stars; // esi
  int i; // eax
  WORD v4; // di
  int j; // kr04_4
  int v6; // ecx
  __int16 k; // ax
  int v8; // edx
  int v10[107]; // [esp+0h] [ebp-1CCh] BYREF
  unsigned __int8 v11; // [esp+1ACh] [ebp-20h]
  unsigned __int8 v12; // [esp+1B0h] [ebp-1Ch]

  v12 = 1 << V_RaceIndex;
  stars = pGame->stars;
  v11 = sub_43374(&V_Game.races[V_RaceIndex], 0xFFFFFFFF);
  if ( !*(_WORD *)pGame->z1 )
  {
    for ( i = 0; (__int16)i < pGame->starsNum; ++i )
    {
      byte_D8460[(__int16)i] &= ~1u;
    }
  }
  v4 = 0;
  for ( j = 0; v4 < pGame->starsNum; ++j )
  {
    if ( (byte_D8460[v4] & 1) == 0 )
    {
      byte_D8460[v4] |= 1u;
      if ( (v12 & stars[j].Unknown_15) != 0 && (v11 & stars[j].Unknown_15) != 0 )
      {
        v6 = sub_1D794((P_Location)&stars[j], (P_Ship *)v10);
        for ( k = 0; k < v6; ++k )
        {
          v8 = *(__int16 *)(v10[k] + 0x56);
          if ( (v8 == V_RaceIndex || V_Game.races[V_RaceIndex].Unknown_1C0[v8] == 2) && *(int *)(v10[k] + 0x88) > 0 )
          {
            ++*(_WORD *)pGame->z1;
            return stars;
          }
        }
      }
    }
    ++v4;
  }
  return 0;
}
// 20B3C: using guessed type int var_1CC[107];

//----- (00020C94) --------------------------------------------------------
char __fastcall sub_20C94(P_Game pGame, int a2, int a3, int a4)
{
  unsigned __int8 v5; // cl
  int v6; // edx
  int v7; // eax
  int v8; // eax
  T_TypeA2 *v9; // eax
  int v10; // edx
  int v11; // kr04_4
  int v12; // edx
  int v13; // kr0C_4
  int v14; // kr08_4
  int v15; // kr14_4
  int v16; // ebx
  WORD v17; // dx
  __int16 i; // cx
  __int16 v19; // dx
  __int16 *v20; // eax
  int v21; // eax
  int j; // kr1C_4
  int v23; // eax
  char z7; // ch
  int v26; // [esp-10h] [ebp-1E8h]
  int v27; // [esp-Ch] [ebp-1E4h]
  int Unknown_15; // [esp-8h] [ebp-1E0h]
  int v29; // [esp-4h] [ebp-1DCh]
  void *v30[107]; // [esp+0h] [ebp-1D8h] BYREF
  FILE *fp; // [esp+1ACh] [ebp-2Ch]
  char *name; // [esp+1B0h] [ebp-28h]
  char *v33; // [esp+1B4h] [ebp-24h]
  char *v34; // [esp+1B8h] [ebp-20h]
  int v35; // [esp+1BCh] [ebp-1Ch]

  if ( V_FlashPopExists == 0xFFFFFFFF && pGame->day >= 0x1388 )
  {
    v5 = rand() % 0x15;
    v6 = rand() % 5 + 3;
    v7 = rand();
    sub_1E10C(pGame, v7 % 0x4C + 0x19, v6, v5);
    sub_1F038(pGame);
    sub_1F404(pGame);
    sub_1EEA4(pGame);
    v8 = rand();
    sub_1EE08(pGame, v8 % 6);
    pGame->day = 0;
    v9 = sub_56E18(&WinMgr, "RACECONTROLS", 1, 0);
    a4 = (int)v9;
    if ( !v9 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x9B7);
    }
    ((void (__fastcall *)(T_TypeA2 *, _DWORD))v9->procs->proc4)(v9, 0);
  }
  *(_WORD *)pGame->z1 = 0;
  memset(byte_D8460, 0, sizeof(byte_D8460));
  sub_21170(pGame);
  sub_21314(pGame);
  v10 = 0;
  sub_466FC(&V_ResTree);
  v11 = 0;
  while ( v10 < *(__int16 *)((char *)&pGame->day + (_DWORD)&loc_27281 + 2) )
  {
    sub_352E0(&pGame->planets[v11]);
    ++v10;
    ++v11;
  }
  sub_2106C(pGame);
  v12 = 0;
  v13 = 0;
  while ( v12 < pGame->racesNum )
  {
    if ( v12 != V_RaceIndex )
    {
      sub_3B220(&pGame->races[v13], v12, 0x64, a4);
    }
    ++v12;
    ++v13;
  }
  sub_3B220(&V_Game.races[V_RaceIndex], V_RaceIndex, 0x64, a4);
  if ( V_NougatLfExists_dword_A0CFC == 0xFFFFFFFF )
  {
    fp = fopen("numships.dbg", "at");
    v35 = 0;
    if ( V_Game.starsNum > 0 )
    {
      name = V_Game.stars[0].name;
      v15 = 0;
      v14 = 0;
      do
      {
        v16 = sub_1D794((P_Location)&V_Game.stars[v15], (P_Ship *)v30);
        v17 = 0;
        if ( V_Game.racesNum > 0 )
        {
          v34 = name;
          do
          {
            if ( ((1 << v17) & (unsigned __int8)V_Game.stars[v15].Unknown_15) != 0 )
            {
              for ( i = 0; i < v16 && v17 != *((_WORD *)v30[i] + 0x2B); ++i )
              {
                ;
              }
              if ( i >= v16 )
              {
                Unknown_15 = (unsigned __int8)V_Game.stars[v15].Unknown_15;
                ++word_D845C;
                fprintf(fp, "T%04d: %s flags (%d) show R%d ship, but none found.\n", pGame->day + 1, v34, Unknown_15, v17);
              }
            }
            ++v17;
          }
          while ( v17 < V_Game.racesNum );
        }
        v19 = 0;
        v33 = name;
        while ( v19 < v16 )
        {
          v20 = (__int16 *)v30[v19];
          if ( *((_BYTE *)v20 + 0x58) != 1 && ((1 << v20[0x2B]) & (unsigned __int8)V_Game.stars[0].Unknown_15) == 0 )
          {
            v29 = (unsigned __int8)V_Game.stars[0].Unknown_15;
            v27 = v20[0x2B];
            v26 = pGame->day + 1;
            ++word_D845C;
            fprintf(fp, "T%04d: R%d ship exists at %s, flags (%d) indicate otherwise.\n", v26, v27, v33, v29);
          }
          ++v19;
        }
        ++v35;
        ++v15;
        ++v14;
      }
      while ( (__int16)v35 < V_Game.starsNum );
    }
    fclose(fp);
  }
  v21 = 0;
  for ( j = 0; (__int16)v21 < V_Game.lanesNum; ++j )
  {
    *(_WORD *)&pGame->lanes[j].Unknown_20[1] = 0;
    ++v21;
  }
  v23 = 0x1EE * V_RaceIndex;
  if ( ((1 << V_RaceIndex) & (*(P_Star *)((char *)&V_Game.races[0].star + v23))->racesBits) != 0 )
  {
    pGame->starsControlled = 1;
    LOBYTE(v23) = sub_1FFE0(pGame, *(int *)((char *)&V_Game.races[0].star + v23));
  }
  else
  {
    pGame->starsControlled = 0;
  }
  z7 = pGame->z7;
  ++pGame->day;
  if ( !z7 && V_FlashPopExists == FALSE )
  {
    LOBYTE(v23) = sub_207A0(pGame);
  }
  return v23;
}
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// D845C: using guessed type __int16 word_D845C;
// 20C94: using guessed type P_Ship var_1D8[107];

//----- (0002106C) --------------------------------------------------------
P_Game __fastcall sub_2106C(P_Game result)
{
  P_Game v1; // edi
  WORD i; // si
  int v3; // edx
  WORD j; // si
  __int16 v5; // bx
  WORD k; // ax
  int ShipsNum_sub_40224; // [esp+0h] [ebp-20h] BYREF
  __int16 v8; // [esp+4h] [ebp-1Ch]

  v1 = result;
  for ( i = 0; i < V_Game.racesNum; ++i )
  {
    v3 = 6 * i;
    ShipsNum_sub_40224 = Q_Race_GetShipsNum_sub_40224(&V_Game.races[i], 0, &ShipsNum_sub_40224);
    *(_WORD *)&v1->Unknown_D8A[v3 + 2] = ShipsNum_sub_40224;
    result = (P_Game)Q_Race_GetPlanetsNum_sub_402E0(&V_Game.races[i]);
    *(_WORD *)&v1->Unknown_D8A[v3 + 4] = (_WORD)result;
  }
  for ( j = 0; j < V_Game.racesNum; ++j )
  {
    v8 = *(_WORD *)&v1->Unknown_D8A[6 * j + 4] + *(_WORD *)&v1->Unknown_D8A[6 * j + 2];
    v5 = 0;
    for ( k = 0; k < V_Game.racesNum; ++k )
    {
      if ( j != k && *(__int16 *)&v1->Unknown_D8A[6 * k + 2] + *(__int16 *)&v1->Unknown_D8A[6 * k + 4] > v8 )
      {
        ++v5;
      }
    }
    result = (P_Game)(6 * j);
    *(_WORD *)&result->Unknown_D8A[(_DWORD)v1] = v5;
  }
  return result;
}

//----- (00021170) --------------------------------------------------------
void __fastcall sub_21170(P_Game a1)
{
  T_Star *stars; // esi
  int v3; // ecx
  int v4; // kr04_4
  unsigned __int8 v5; // al
  unsigned __int8 v6; // [esp+0h] [ebp-18h]

  v6 = 1 << V_RaceIndex;
  v3 = 0;
  if ( a1->starsNum > 0 )
  {
    stars = a1->stars;
    v4 = 0;
    do
    {
      v5 = stars[v4].racesBits | stars[v4].Unknown_15;
      stars[v4].z2 = 0;
      if ( (v5 & v6) == 0 )
      {
        if ( v5 )
        {
          sub_211EC(a1, &stars[v4], 0);
        }
        stars[v4].z2 = 0xFFFFFFFF;
      }
      ++v3;
      ++v4;
    }
    while ( (__int16)v3 < a1->starsNum );
  }
}

//----- (000211EC) --------------------------------------------------------
void __fastcall sub_211EC(P_Game pGame, P_Star pStar, int a3)
{
  WORD racesNum; // cx
  WORD v7; // ax
  int v8; // ebx
  T_Race *races; // ebp
  int v10; // edi
  __int16 v11; // cx
  __int16 v12[8]; // [esp+2h] [ebp-2Ch]
  unsigned __int8 v13; // [esp+12h] [ebp-1Ch] BYREF
  P_Ship pShip; // [esp+13h] [ebp-1Bh]
  int v15; // [esp+1Ah] [ebp-14h]

  if ( V_FlashPopExists == 0xFFFFFFFF )
  {
    a3 = V_FlashPopExists;
  }
  racesNum = pGame->racesNum;
  v7 = 0;
  LOWORD(v15) = 0;
  if ( racesNum > 0 )
  {
    do
    {
      if ( a3 || (a3 = 0, v7 != V_RaceIndex) )
      {
        if ( ((unsigned __int8)(pStar->Unknown_15 | pStar->racesBits) & (unsigned __int8)(1 << v7)) != 0 )
        {
          v8 = (__int16)v15;
          LOWORD(v15) = v15 + 1;
          v12[v8] = v7;
        }
      }
      ++v7;
    }
    while ( v7 < pGame->racesNum );
  }
  if ( (_WORD)v15 )
  {
    races = pGame->races;
    while ( 1 )
    {
      v10 = 0;
      v11 = 0;
      if ( (__int16)v15 > 0 )
      {
        break;
      }
LABEL_15:
      if ( !v10 )
      {
        return;
      }
    }
    while ( 1 )
    {
      v13 = 0;
      v10 |= sub_406C4(&races[v12[v11]], pStar, (int)&v13);
      if ( !v13 )
      {
        goto LABEL_14;
      }
      if ( v13 < 2u )
      {
        break;
      }
      if ( v13 <= 2u )
      {
        sub_3676C((T_Planet *)pShip, 1);
      }
      else
      {
        if ( v13 != 3 )
        {
          break;
        }
        sub_49B3C(pShip, 1);
      }
LABEL_14:
      if ( ++v11 >= (__int16)v15 )
      {
        goto LABEL_15;
      }
    }
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cosmos.cpp", 0xAE2);
    goto LABEL_14;
  }
}
// 211EC: using guessed type __int16 var_2C[8];

//----- (00021314) --------------------------------------------------------
void __fastcall sub_21314(P_Game a1)
{
  P_Star pStar; // ecx
  int v3; // edi
  int v4; // kr04_4

  v3 = 0;
  if ( a1->starsNum > 0 )
  {
    pStar = a1->stars;
    v4 = 0;
    do
    {
      if ( pStar[v4].z2 != 0xFFFFFFFF )
      {
        if ( pStar[v4].racesBits | (unsigned __int8)pStar[v4].Unknown_15 )
        {
          sub_211EC(a1, &pStar[v4], 0xFFFFFFFF);
        }
        pStar[v4].z2 = 0xFFFFFFFF;
      }
      ++v3;
      ++v4;
    }
    while ( (__int16)v3 < a1->starsNum );
  }
}

//----- (00021374) --------------------------------------------------------
void __fastcall Q_SaveGam_sub_21374(P_Game pGame, P_FileInfo pfi)
{
  WORD j; // cx
  T_Star *pStar; // esi
  WORD v4; // cx
  T_Planet *planets; // esi
  __int16 kk; // si
  __int16 k; // cx
  P_Ship vpShips; // edi
  char *v9; // eax
  WORD l; // cx
  T_Race *races; // esi
  WORD m; // cx
  T_Lane *pLanes; // esi
  __int16 v14; // si
  __int16 i; // ax
  __int16 v16; // di
  __int16 v17; // bx
  WORD v18; // cx
  T_Sector *sectors; // esi
  T_Type09 v20; // [esp+0h] [ebp-238h] BYREF
  T_Lane lane; // [esp+1A0h] [ebp-98h] BYREF
  T_SavBlock1Sizes v22; // [esp+1C8h] [ebp-70h] BYREF
  P_Game vpGame; // [esp+1E8h] [ebp-50h]
  int day; // [esp+1ECh] [ebp-4Ch] BYREF
  int index; // [esp+1F0h] [ebp-48h] BYREF
  int v26; // [esp+1F4h] [ebp-44h] BYREF
  int z7; // [esp+1F8h] [ebp-40h] BYREF
  int aa2; // [esp+1FCh] [ebp-3Ch] BYREF
  int v29; // [esp+200h] [ebp-38h] BYREF
  int v30; // [esp+204h] [ebp-34h] BYREF
  int v31; // [esp+208h] [ebp-30h] BYREF
  int starsNum; // [esp+20Ch] [ebp-2Ch] BYREF
  int Word_18245; // [esp+210h] [ebp-28h] BYREF
  int planetsNum; // [esp+214h] [ebp-24h] BYREF
  int shipsNum; // [esp+218h] [ebp-20h] BYREF
  int v36; // [esp+21Ch] [ebp-1Ch] BYREF
  int racesNum; // [esp+220h] [ebp-18h] BYREF
  int lanesNum; // [esp+224h] [ebp-14h] BYREF
  int f; // [esp+228h] [ebp-10h] BYREF
  int sectorsNum; // [esp+22Ch] [ebp-Ch] BYREF
  T_Type10 *p_t10; // [esp+230h] [ebp-8h]
  __int16 v42; // [esp+234h] [ebp-4h]

  vpGame = pGame;
  // Block 1 - Sizes
  v22.sizeResTree = 0x1D72;
  v22.sizeStar = 0x60;
  v22.sizePlanet = 0x7B;
  v22.sizeRace = 0x1EE;
  v22.magic5 = 0x19E;
  v22._sizeSector = 0xD;
  v22.sizeGame = 0x354EF;
  v22.magic4 = 0x27;
  // Block 2
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v22, 0x20u);
  day = vpGame->day;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &day, 4u);
  index = vpGame->pCurStar->index;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &index, 4u);
  v26 = vpGame->pCurPlanet - vpGame->planets;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v26, 4u);
  z7 = vpGame->z7;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &z7, 4u);
  aa2 = vpGame->aa2;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &aa2, 4u);
  v29 = V_Day1;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v29, 4u);
  v30 = V_Day2;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v30, 4u);
  v31 = V_Day3;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v31, 4u);
  // Block 3 - ResTree
  Q_ReadWriteResTree_sub_46BB0(&V_ResTree, pfi, FALSE);
  // Block 4 - Stars
  starsNum = vpGame->starsNum;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &starsNum, 4u);
  j = 0;
  if ( vpGame->starsNum > 0 )
  {
    pStar = vpGame->stars;
    do
    {
      Q_ReadWriteStar_sub_1D920(&pStar[j++], pfi, FALSE);
    }
    while ( j < vpGame->starsNum );
  }
  // Block 5
  Word_18245 = vpGame->Word_18245;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &Word_18245, 4u);
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, vpGame->Unknown_49C5, 4 * vpGame->Word_18245);
  // Block 6 - Planets
  planetsNum = vpGame->planetsNum;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &planetsNum, 4u);
  v4 = 0;
  if ( vpGame->planetsNum > 0 )
  {
    planets = vpGame->planets;
    do
    {
      Q_ReadWritePlanet_sub_370B8(&planets[v4++], pfi, FALSE);
    }
    while ( v4 < vpGame->planetsNum );
  }
  // Block 7 - Ships
  kk = 0;
  k = 0;
  shipsNum = vpGame->shipsNum;
  vpShips = vpGame->ships;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &shipsNum, 4u);
  while ( k < 0x6B )
  {
    v9 = (char *)vpGame + 0x162 * k;
    if ( *(__int16 *)(v9 + 0x272DB) != 0xFFFFFFFF )
    {
      if ( !v9[0x272DD] )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xB57);
      }
      v36 = k;
      Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v36, 4u);
      ++kk;
      Q_ReadWriteShip_sub_4AE8C(&vpShips[k], pfi, FALSE);
    }
    ++k;
  }
  if ( kk != vpGame->shipsNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xB65);
  }
  // Block 8 - Races
  racesNum = vpGame->racesNum;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &racesNum, 4u);
  l = 0;
  if ( vpGame->racesNum > 0 )
  {
    races = vpGame->races;
    do
    {
      Q_ReadWriteRace_sub_43BDC(&races[l++], pfi, FALSE);
    }
    while ( l < vpGame->racesNum );
  }
  // Block 9 - Lanes
  lanesNum = vpGame->lanesNum;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &lanesNum, 4u);
  memset(&lane.vector1, 0, 0x18);
  m = 0;
  if ( vpGame->lanesNum > 0 )
  {
    pLanes = vpGame->lanes;
    do
    {
      lane = pLanes[m];
      lane.pStar1 = (P_Star)lane.pStar1->index;
      lane.pStar2 = (P_Star)lane.pStar2->index;
      Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &lane, 0x27u);
      ++m;
    }
    while ( m < vpGame->lanesNum );
  }
  // Block 10
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, vpGame->z10000, 10000u);
  // Block 11
  f = vpGame->t10.f;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &f, 4u);
  memset(&v20.c, 0, sizeof(v20.c));
  v14 = vpGame->t10.f;
  v42 = 0;
  if ( v14 > 0 )
  {
    p_t10 = &vpGame->t10;
    do
    {
      qmemcpy(&v20, &p_t10->a.a[v42], sizeof(v20));
      *(_DWORD *)&i = 0;
      if ( v20.b > 0 )
      {
        do
        {
          v20.a[i] = *(__int16 *)(v20.a[i] + 4);
          ++*(_DWORD *)&i;
        }
        while ( i < v20.b );
      }
      v16 = v42;
      Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v20, 0x19Eu);
      v17 = vpGame->t10.f;
      v42 = v16 + 1;
    }
    while ( (__int16)(v16 + 1) < v17 );
  }
  // Block 12 - Sectors
  sectorsNum = vpGame->sectorsNum;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &sectorsNum, 4u);
  v18 = 0;
  if ( vpGame->sectorsNum > 0 )
  {
    sectors = vpGame->sectors;
    do
    {
      Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &sectors[v18++], 0xDu);
    }
    while ( v18 < vpGame->sectorsNum );
  }
}
// 105248: using guessed type int V_Day1;
// 10524C: using guessed type int V_Day2;
// 105250: using guessed type int V_Day3;

//----- (00021AA0) --------------------------------------------------------
void __fastcall Q_LoadGam_sub_21AA0(P_Game pGame, P_FileInfo pfi)
{
  __int16 v4; // ax
  WORD v5; // cx
  T_Star *v6; // eax
  int *Unknown_49C5; // ebp
  __int16 v8; // ax
  WORD v9; // cx
  unsigned int v10; // eax
  __int16 i; // ax
  int v12; // edx
  WORD v13; // cx
  __int16 v14; // ax
  WORD v15; // cx
  T_Race *v16; // eax
  __int16 v17; // ax
  int laneIndex; // ebp
  T_Lane *v19; // ecx
  T_Star *v20; // ebx
  int pStar2; // eax
  T_Star *v22; // edx
  T_Star *v23; // eax
  int v24; // ebp
  WORD f; // cx
  int j; // eax
  WORD v27; // dx
  __int16 v28; // ax
  WORD v29; // cx
  T_Sector *v30; // edx
  _DWORD v31[95]; // [esp+0h] [ebp-1E0h] BYREF
  _WORD v32[5]; // [esp+190h] [ebp-50h]
  int v33; // [esp+19Ah] [ebp-46h]
  T_SavBlock1Sizes v34; // [esp+1A0h] [ebp-40h] BYREF
  int buf; // [esp+1C0h] [ebp-20h] BYREF
  unsigned int v36; // [esp+1C4h] [ebp-1Ch]
  T_Star *stars; // [esp+1C8h] [ebp-18h]
  T_Planet *planets; // [esp+1CCh] [ebp-14h]
  T_Lane *lanes; // [esp+1D0h] [ebp-10h]
  __int16 Unknown_44; // [esp+1D4h] [ebp-Ch]
  __int16 v41; // [esp+1D8h] [ebp-8h]
  int v42; // [esp+1DCh] [ebp-4h]

  Q_ReadFile_sub_1BF94(pfi, &v34, 0x20u);
  if ( v34.sizeResTree != 0x1D72 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBAA);
  }
  if ( v34.sizeStar != 0x60 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBAB);
  }
  if ( v34.sizePlanet != 0x7B )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBAC);
  }
  if ( v34.sizeRace != 0x1EE )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBAD);
  }
  if ( v34.magic4 != 0x27 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBAE);
  }
  if ( v34.magic5 != 0x19E )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBAF);
  }
  if ( v34._sizeSector != 0xD )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBB0);
  }
  if ( v34.sizeGame != 0x354EF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBB1);
  }
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  pGame->day = buf;
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  pGame->pCurStar = &pGame->stars[buf];
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  pGame->pCurPlanet = &pGame->planets[buf];
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  pGame->z7 = buf;
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  pGame->aa2 = buf;
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  V_Day1 = buf;
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  V_Day2 = buf;
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  V_Day3 = buf;
  Q_ReadWriteResTree_sub_46BB0(&V_ResTree, pfi, TRUE);
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  v4 = buf;
  v5 = 0;
  pGame->starsNum = buf;
  if ( v4 > 0 )
  {
    do
    {
      v6 = &pGame->stars[v5++];
      Q_ReadWriteStar_sub_1D920(v6, pfi, TRUE);
    }
    while ( v5 < pGame->starsNum );
  }
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  pGame->Word_18245 = buf;
  Unknown_49C5 = pGame->Unknown_49C5;
  Q_ReadFile_sub_1BF94(pfi, pGame->Unknown_49C5, 4 * pGame->Word_18245);
  // Block 6 - Planets
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  v8 = buf;
  v9 = 0;
  pGame->planetsNum = buf;
  if ( v8 > 0 )
  {
    planets = pGame->planets;
    do
    {
      v36 = 0x7B * v9;
      Q_ReadWritePlanet_sub_370B8(&planets[v36 / 0x7B], pfi, TRUE);
      v10 = v36;
      pGame->planets[v36 / 0x7B].pUnknown_10 = Unknown_49C5;
      ++v9;
      Unknown_49C5 += *(unsigned __int16 *)((char *)&pGame->planets[0].word1A + v10);
    }
    while ( v9 < pGame->planetsNum );
  }
  // Block 7 - Ships
  for ( i = 0; i < 107; ++i )
  {
    v12 = i;
    pGame->ships[v12].raceIndex = 0xFFFF;
    pGame->ships[v12].locationType = 0;
  }
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  v13 = 0;
  pGame->shipsNum = buf;
  while ( v13 < 107 )
  {
    if ( v13 < pGame->shipsNum )
    {
      Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
      Q_ReadWriteShip_sub_4AE8C(&pGame->ships[buf], pfi, TRUE);
    }
    ++v13;
  }
  // Block 8 - Races
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  v14 = buf;
  v15 = 0;
  pGame->racesNum = buf;
  if ( v14 > 0 )
  {
    do
    {
      v16 = &pGame->races[v15++];
      Q_ReadWriteRace_sub_43BDC(v16, pfi, TRUE);
    }
    while ( v15 < pGame->racesNum );
  }
  // Block 9 - Lanes
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  v17 = buf;
  v41 = 0;
  pGame->lanesNum = buf;
  if ( v17 > 0 )
  {
    lanes = pGame->lanes;
    stars = pGame->stars;
    do
    {
      laneIndex = v41;
      v19 = &lanes[laneIndex];
      Q_ReadFile_sub_1BF94(pfi, &lanes[laneIndex], 0x27u);
      v20 = &stars[(int)pGame->lanes[laneIndex].pStar1];
      pStar2 = (int)pGame->lanes[laneIndex].pStar2;
      v22 = stars;
      pGame->lanes[laneIndex].pStar1 = v20;
      v23 = &v22[pStar2];
      pGame->lanes[laneIndex].pStar2 = v23;
      Unknown_44 = v20->Unknown_44;
      v24 = Unknown_44;
      v20->Unknown_44 = Unknown_44 + 1;
      *(_DWORD *)&v20->Unknown_2C[4 * v24] = v19;
      LOWORD(v22) = v23->Unknown_44;
      v23->Unknown_44 = (_WORD)v22 + 1;
      *(_DWORD *)&v23->Unknown_2C[4 * (__int16)v22] = v19;
      LOWORD(v22) = pGame->lanesNum;
      ++v41;
    }
    while ( v41 < (__int16)v22 );
  }
  // Block 10
  Q_ReadFile_sub_1BF94(pfi, pGame->z10000, 10000u);
  // Block 11
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  pGame->t10.f = buf;
  *(_DWORD *)&v32[3] = 0;
  v33 = 0;
  *(_DWORD *)&v32[1] = 0;
  f = pGame->t10.f;
  v42 = 0;
  if ( f > 0 )
  {
    do
    {
      Q_ReadFile_sub_1BF94(pfi, v31, 0x19Eu);
      for ( j = 0; (__int16)j < v32[0]; ++j )
      {
        v31[(__int16)j] = &pGame->stars[v31[(__int16)j]];
      }
      v27 = pGame->t10.f;
      ++v42;
    }
    while ( (__int16)v42 < v27 );
  }
  // Block 12
  Q_ReadFile_sub_1BF94(pfi, &buf, 4u);
  v28 = buf;
  v29 = 0;
  pGame->sectorsNum = buf;
  if ( v28 > 0 )
  {
    do
    {
      v30 = &pGame->sectors[v29++];
      Q_ReadFile_sub_1BF94(pfi, v30, 0xDu);
    }
    while ( v29 < pGame->sectorsNum );
  }
  sub_1EEA4(pGame);
}
// 105248: using guessed type int V_Day1;
// 10524C: using guessed type int V_Day2;
// 105250: using guessed type int V_Day3;

//----- (000220CC) --------------------------------------------------------
WORD __fastcall sub_220CC(P_Game a1)
{
  __int16 v2; // di
  WORD racesNum; // dx
  double v4; // st6
  WORD v5; // bx
  WORD i; // dx
  P_Star star; // ebx
  P_Star v8; // eax
  WORD result; // ax
  double v10[7]; // [esp+8h] [ebp-84h] BYREF
  float v11; // [esp+40h] [ebp-4Ch]
  float v12; // [esp+44h] [ebp-48h]
  float v13; // [esp+48h] [ebp-44h]
  float v14; // [esp+4Ch] [ebp-40h]
  float v15; // [esp+50h] [ebp-3Ch]
  float v16; // [esp+54h] [ebp-38h]
  int v17[6]; // [esp+58h] [ebp-34h] BYREF
  int v18; // [esp+70h] [ebp-1Ch]

  v2 = 0;
  v14 = 0.0;
  v15 = 0.0;
  v16 = 0.0;
  memset(v10, 0, sizeof(v10));
  racesNum = a1->racesNum;
  a1->f = 0;
  if ( racesNum > 0 )
  {
    do
    {
      for ( i = 0; i < a1->racesNum; ++i )
      {
        if ( v2 != i )
        {
          star = a1->races[i].star;
          v8 = a1->races[v2].star;
          v17[5] = (int)v17;
          v11 = 0.0;
          v12 = 0.0;
          v13 = 0.0;
          v11 = v8->v.x - star->v.x;
          v12 = v8->v.y - star->v.y;
          v13 = v8->v.z - star->v.z;
          *(float *)v17 = v11;
          *(float *)&v17[1] = v12;
          *(float *)&v17[2] = v13;
          v14 = v11;
          v15 = v12;
          v16 = v13;
          v10[v2] = sqrt(v12 * v12 + v11 * v11 + v13 * v13) + v10[v2];
        }
      }
      v18 = a1->racesNum - 1;
      v10[v2] = v10[v2] / (double)v18;
      v4 = (double)a1->f + v10[v2++];
      v18 = (int)v4;
      v5 = a1->racesNum;
      a1->f = (int)v4;
    }
    while ( v2 < v5 );
  }
  result = a1->f / a1->racesNum;
  a1->f = result;
  return result;
}
// 220CC: using guessed type double var_84[7];

//----- (00022260) --------------------------------------------------------
void __fastcall __spoils<edx> sub_22260(void *result)
{
  _wcpp_2_dtor_array_(result, 7, &C_Race);
}

//----- (00022280) --------------------------------------------------------
void __fastcall __spoils<edx> sub_22280(void *a1)
{
  _wcpp_2_dtor_array_(a1, 0x64, &C_Star);
}

//----- (000222A0) --------------------------------------------------------
void __fastcall __spoils<edx> sub_222A0(void *result)
{
  _wcpp_2_dtor_array_(result, 0x6B, &C_Ship);
}

//----- (000222C0) --------------------------------------------------------
void __fastcall __spoils<edx> sub_222C0(void *a1)
{
  _wcpp_2_dtor_array_(a1, 24, &C_Type09);
}

//----- (000222E0) --------------------------------------------------------
void __fastcall __spoils<edx> sub_222E0(void *a1)
{
  _wcpp_2_dtor_array_(a1, 9, &C_Sector);
}

//----- (00022300) --------------------------------------------------------
void __fastcall __spoils<edx> sub_22300(void *result)
{
  _wcpp_2_dtor_array_(result, 0x1F4, &C_Planet);
}

//----- (00022320) --------------------------------------------------------
void __fastcall __spoils<edx> sub_22320(void *result)
{
  _wcpp_2_dtor_array_(result, 148, &C_Lane);
}

//----- (00022360) --------------------------------------------------------
P_Lane __fastcall sub_22360(P_Lane result)
{
  result->vector1.x = 0.0;
  result->vector1.y = 0.0;
  result->vector1.z = 0.0;
  result->vector2.y = 0.0;
  result->vector2.z = 0.0;
  result->vector2.x = 0.0;
  return result;
}

//----- (000223B0) --------------------------------------------------------
void __fastcall __spoils<> Q_SectorCtor_sub_223B0(P_Sector pSector)
{
  pSector->v.y = 0.0;
  pSector->v.z = 0.0;
  pSector->v.x = 0.0;
}

//----- (000223E0) --------------------------------------------------------
void __fastcall __spoils<> sub_223E0(P_Type09 a1)
{
  a1->c.e = 0;
  a1->c.f = 0;
  a1->c.c = 0;
}

//----- (00022400) --------------------------------------------------------
void __fastcall __spoils<> Q_PlanetCtor_sub_22400(P_Planet pPlanet)
{
  pPlanet->v.x = 0.0;
  pPlanet->v.y = 0.0;
  pPlanet->v.z = 0.0;
  pPlanet->word1A = 0;
  pPlanet->pUnknown_10 = 0;
  pPlanet->z7 = 0;
}

//----- (00022430) --------------------------------------------------------
int __fastcall sub_22430(const void *a1, const void *a2)
{
  int v2; // edx
  float v4; // [esp+0h] [ebp-8h]
  float v5; // [esp+4h] [ebp-4h]

  v5 = *(float *)(*(_DWORD *)a1 + 0xD);
  v4 = *(float *)(*(_DWORD *)a2 + 0xD);
  v2 = 0;
  if ( v5 > (double)v4 )
  {
    return 0xFFFFFFFF;
  }
  if ( v5 < (double)v4 )
  {
    return 1;
  }
  return v2;
}

//----- (00022468) --------------------------------------------------------
void __fastcall Q_Proc_sub_22468()
{
  T_TypeA2 *v0; // eax

  v0 = sub_56E18(&WinMgr, "NEXTTURNCONT", 1, 0);
  if ( !v0 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x69);
  }
  v0[1].a1.magic12345678 = 0;
}

//----- (000224A4) --------------------------------------------------------
P_Wnd2COSW __fastcall Q_Wnd2COSWCtor_sub_224A4(P_Wnd2COSW result)
{
  UBYTE v1; // cl

  Q_A2Ctor_sub_2C830(&result->a);
  sub_1B4F0(&result->Wnd9RW1);
  sub_254A4((int)result->Unknown_172);
  result->a.procs = &Wnd2COSW_Procs;
  result->Unknown_AB = 0;
  result->Unknown_AF = 0;
  result->Unknown_B3 = 0;
  result->Unknown_B7 = 0;
  result->Unknown_BB = 0;
  result->Unknown_C0 = 0;
  result->Unknown_C4 = 0xFFFFFFFF;
  result->Unknown_C8 = 0xFFFFFFFF;
  result->Unknown_CC = 0xFFFFFFFF;
  result->Unknown_D0 = 0xFFFFFFFF;
  result->Unknown_D4 = 0;
  result->Unknown_592 = 0;
  result->Unknown_D8 = 0xFF;
  result->cursorShape = 2;
  result->Unknown_58E = 0;
  result->Unknown_58A = 0;
  v1 = V_RaceIndex;
  result->Unknown_582 = 0;
  result->Unknown_D9 = 1 << v1;
  return result;
}

//----- (00022588) --------------------------------------------------------
char *__fastcall Q_Wnd2COSWDtor_sub_22588(char *a1, char a2)
{
  char *v2; // ebx
  char *v4; // eax
  void *v5; // edx
  P_TypeA2 v6; // eax

  v2 = a1;
  if ( (a2 & 4) != 0 )
  {
    v4 = _wcpp_2_dtor_array_store_(a1, &C_Wnd2COSW);
    operator delete[](v4);
  }
  else
  {
    v5 = *(void **)(a1 + 0xAB);
    *(_DWORD *)(a1 + 0xA7) = &Wnd2COSW_Procs;
    if ( v5 )
    {
      sub_2627C(v5);
    }
    operator delete[](*(void **)(v2 + 0xAB));
    if ( *(_DWORD *)(v2 + 0xAF) )
    {
      sub_2627C(*(void **)(v2 + 0xAF));
    }
    operator delete[](*(void **)(v2 + 0xAF));
    if ( *(_DWORD *)(v2 + 0xB3) )
    {
      sub_2627C(*(void **)(v2 + 0xB3));
    }
    operator delete[](*(void **)(v2 + 0xB3));
    sub_254B0((int)(v2 + 0x172));
    Q_Ret_sub_1B66C();
    v6 = Q_A2Dtor_sub_2C848((P_TypeA2)v2, 1);
    v2 = (char *)v6;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v6);
    }
  }
  return v2;
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (00022644) --------------------------------------------------------
unsigned int __fastcall Q_COSWND_CPP_sub_22644(P_Wnd2COSW a1, const char *starShapes, const char *shipShapes)
{
  void *v4; // eax
  void *v5; // eax
  __int16 v6; // ax
  __int16 y0; // cx
  __int16 v8; // bx
  __int16 y1; // ax
  void *v10; // eax
  T_FileInfo fi; // [esp+0h] [ebp-128h] BYREF

  if ( !starShapes )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x9E);
  }
  if ( !shipShapes )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x9F);
  }
  Q_InitFileInfo_sub_1BB78(&fi);
  if ( a1->Unknown_AB )
  {
    sub_2627C(a1->Unknown_AB);
  }
  operator delete[](a1->Unknown_AB);
  if ( Q_OpenFile_sub_1BBFC(&fi, starShapes, O_BINARY, 0) )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\coswnd.cpp", 0xAA);
  }
  v4 = Q_CfileLoad_sub_1BF1C(&fi, 0);
  a1->Unknown_AB = v4;
  if ( !v4 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0xAC);
  }
  if ( a1->Unknown_AF )
  {
    sub_2627C(a1->Unknown_AF);
  }
  operator delete[](a1->Unknown_AF);
  if ( Q_OpenFile_sub_1BBFC(&fi, shipShapes, O_BINARY, 0) )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\coswnd.cpp", 0xB5);
  }
  v5 = Q_CfileLoad_sub_1BF1C(&fi, 0);
  a1->Unknown_AF = v5;
  if ( !v5 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0xB7);
  }
  v6 = LOWORD(a1->a.a1.pane.x1) - LOWORD(a1->a.a1.pane.x0);
  y0 = a1->a.a1.pane.y0;
  a1->Unknown_576 = v6;
  v8 = v6;
  y1 = a1->a.a1.pane.y1;
  a1->Unknown_576 = v8 >> 1;
  a1->Unknown_578 = (__int16)(y1 - y0) >> 1;
  sub_2280C(a1);
  if ( a1->Unknown_B3 )
  {
    sub_2627C(a1->Unknown_B3);
  }
  operator delete[](a1->Unknown_B3);
  v10 = operator new[](0x1D1Fu);
  Q_RegisterData_sub_2625C(v10, 1, "CW DISPLAYITEMS");
  a1->Unknown_B3 = v10;
  if ( !v10 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0xCC);
  }
  a1->Unknown_B7 = 0;
  a1->Unknown_B9 = 0x163;
  Q_CloseFileAndDelete_sub_1BBC8(&fi);
  return 0xFFFFFFFF;
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);

//----- (0002280C) --------------------------------------------------------
LONG *__fastcall sub_2280C(P_Wnd2COSW a1)
{
  LONG *result; // eax

  a1->Unknown_57A = 35.0;
  sub_1B808(&a1->Wnd9RW1, a1->Unknown_57A, 1.0, 100000.0, a1->Unknown_576);
  a1->Wnd9RW1.vector_34.x = 0.0;
  a1->Wnd9RW1.vector_34.y = 0.0;
  a1->Wnd9RW1.vector_34.z = -1500.0;
  a1->Wnd9RW1.Unknown_74 = 1.0;
  a1->Wnd9RW1.Unknown_78 = 0;
  result = &a1->Wnd9RW1.Unknown_80;
  a1->Wnd9RW1.Unknown_7C = 0;
  a1->Wnd9RW1.Unknown_80 = 0;
  a1->Wnd9RW1.Unknown_84 = 1.0;
  a1->Wnd9RW1.Unknown_88 = 0;
  a1->Wnd9RW1.Unknown_8C = 0;
  a1->Wnd9RW1.Unknown_90 = 0;
  a1->Wnd9RW1.Unknown_94 = 1.0;
  return result;
}

//----- (000228A4) --------------------------------------------------------
#error "228A4: function frame is wrong (funcsize=0)"

//----- (00023BF0) --------------------------------------------------------
void __fastcall sub_23BF0(int a1, int a2)
{
  T_TypeA2 *v3; // eax
  int v4; // eax
  int v5; // kr04_4
  int v6; // kr08_4
  int v7; // kr10_4
  char v8; // al
  char v9; // al
  __int16 i; // si
  char v11; // dl
  int v12; // ebx
  int v13; // edx
  int v14; // ebx
  int v15; // edx
  const char *v16; // ecx
  int *v17; // eax
  int v18; // ebx
  int v19; // edx
  WORD v20; // dx
  char *v21; // esi
  char *v22; // edi
  char v23; // al
  char v24; // al
  int v25; // ebx
  int v26; // edx
  char s[128]; // [esp+0h] [ebp-F8h] BYREF
  char v28[40]; // [esp+80h] [ebp-78h] BYREF
  _DWORD v29[9]; // [esp+A8h] [ebp-50h] BYREF
  char v30[20]; // [esp+CCh] [ebp-2Ch] BYREF
  int v31; // [esp+E0h] [ebp-18h]

  v31 = a2;
  sub_254F8((int *)(a1 + 0x172), a1);
  if ( WinMgr.Unknown_4228 == 3 )
  {
    v3 = sub_56E18(&WinMgr, "NEWGAMEWND", 3, 0);
    if ( !v3 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x414);
    }
    ((void (__fastcall *)(T_TypeA2 *, int))v3->procs->proc4)(v3, 1);
  }
  if ( *(_DWORD *)(a1 + 0xD4) == 0xFFFFFFFF )
  {
    sub_23FD4(a1);
  }
  if ( WinMgr.Unknown_4228 != 3 )
  {
    Q_WINMGR_CPP_sub_53E38((PANE *)(a1 + 4), 3, 3, V_RaceIndex);
  }
  if ( *(_DWORD *)(a1 + 0xBB) )
  {
    s[0] = 0;
    v17 = *(int **)(a1 + 0xBB);
    v11 = 1;
    if ( !*((_BYTE *)v17 + 4) )
    {
      v4 = *v17;
      if ( ((unsigned __int8)V_RaceIndexMask & *(_BYTE *)(v4 + 0x17)) != 0 )
      {
        v5 = v4 + 0x1C;
        v6 = 0;
        v7 = 0;
        do
        {
          v8 = *(_BYTE *)(v5 + 2 * v6);
          s[2 * v7] = v8;
          if ( !v8 )
          {
            break;
          }
          v9 = *(_BYTE *)(v5 + 2 * v6 + 1);
          s[2 * v7 + 1] = v9;
          ++v6;
          ++v7;
        }
        while ( v9 );
        for ( i = 0; i < 7 && (*(_BYTE *)(**(_DWORD **)(a1 + 0xBB) + 0x14) & (unsigned __int8)(*(_BYTE *)(a1 + 0xD9) & v11)) == 0; ++i )
        {
          v11 *= 2;
        }
      }
      v12 = *(_DWORD *)(a1 + 0x14) - 0x1B;
      v13 = *(_DWORD *)(a1 + 0x10) - 0x82;
      WinMgr.LargeFont.pane = V_Type6_stru_D8654.pane;
      sub_2B8A8(&WinMgr.LargeFont, v13, v12, s, 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
      v14 = *(_DWORD *)(a1 + 0x14) - 0xC;
      v15 = *(_DWORD *)(a1 + 0x10) - 0x82;
      v16 = V_StarTypeTexts_D84C4[***(_DWORD ***)(a1 + 0xBB)];
      WinMgr.SmallFont.pane = V_Type6_stru_D8654.pane;
      sub_2B8A8(&WinMgr.SmallFont, v15, v14, v16, 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
    }
  }
  if ( v31 != 0xA )
  {
    stru_D85E4 = *(PANE *)(a1 + 4);
  }
  sub_552CC(&WinMgr, &stru_D85E4);
  if ( V_NougatLfExists_dword_A0CFC == 0xFFFFFFFF && V_NougatLfExists_dword_A0CFC == *(_DWORD *)(a1 + 0x58E) )
  {
    sprintf(s, "STARS CONTROLLED %d", V_Game.starsControlled);
    WinMgr.SmallFont.pane = V_Type6_stru_D8654.pane;
    sub_2B8A8(&WinMgr.SmallFont, 0xA, 0x18C, s, 0, 0xFFFFFFFF, 0xFF, 0);
    sprintf(s, "PERCENT CONTROLLED %d", 0x64 * V_Game.starsControlled / V_Game.starsNum);
    qmemcpy(v29, "Peaceful", sizeof(v29));
    sprintf(s, "%d Biorythym (%s)\n", word_104BE8, &v29[3 * V_Game.Unknown_D8A[0x2A]]);
    v18 = *(_DWORD *)(a1 + 0xC) + 0x1E;
    v19 = *(_DWORD *)(a1 + 8) + 5;
    WinMgr.LargeFont.pane = V_Type6_stru_D8654.pane;
    sub_2B8A8(&WinMgr.LargeFont, v19, v18, s, 0, 0xFFFFFFFF, 0xFF, 0);
    v20 = 0;
    s[0] = 0;
    qmemcpy(v28, "Unknown", sizeof(v28));
    if ( V_Game.racesNum > 0 )
    {
      do
      {
        sprintf(
          v30,
          "R%d %10s %d\n",
          v20,
          &v28[0xA * (char)V_Game.races[V_RaceIndex].Unknown_1C0[v20]],
          V_Game.races[V_RaceIndex].Unknown_1B2[v20]);
        v21 = v30;
        ++v20;
        v22 = &s[strlen(s)];
        do
        {
          v23 = *v21;
          *v22 = *v21;
          if ( !v23 )
          {
            break;
          }
          v24 = v21[1];
          v21 += 2;
          v22[1] = v24;
          v22 += 2;
        }
        while ( v24 );
      }
      while ( v20 < V_Game.racesNum );
    }
    v25 = *(_DWORD *)(a1 + 0xC) + 0x37;
    v26 = *(_DWORD *)(a1 + 8) + 5;
    WinMgr.LargeFont.pane = V_Type6_stru_D8654.pane;
    sub_2B8A8(&WinMgr.LargeFont, v26, v25, s, 0, 0xFFFFFFFF, 0xFF, 0);
  }
}
// 968DC: using guessed type char V_RaceIndexMask;
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// 104BE8: using guessed type __int16 word_104BE8;
// 23BF0: using guessed type char s[128];
// 23BF0: using guessed type char var_78[40];

//----- (00023FD4) --------------------------------------------------------
int __fastcall sub_23FD4(int a1)
{
  int v1; // esi
  int v2; // kr04_4
  int v3; // kr0C_4
  int i; // kr14_4
  int result; // eax
  void *ShapeTable_sub_1B084; // eax
  void *v7; // eax
  LONG Unknown_02; // [esp-Ch] [ebp-44h]
  PANE *pane; // [esp+8h] [ebp-30h]
  LONG hotY; // [esp+Ch] [ebp-2Ch]
  LONG hotX; // [esp+10h] [ebp-28h]
  LONG flags; // [esp+14h] [ebp-24h]
  unsigned __int16 v14; // [esp+18h] [ebp-20h]
  char v15; // [esp+1Ch] [ebp-1Ch]

  v1 = 0;
  v15 = 1;
  pane = (PANE *)(a1 + 4);
  v2 = 0;
  v3 = 0;
  for ( i = 0; ; ++i )
  {
    result = V_Game.racesNum;
    if ( v1 >= V_Game.racesNum )
    {
      break;
    }
    hotX = *((__int16 *)&unk_D85C8 + 2 * v2);
    hotY = word_D85CA[2 * v2];
    if ( (*(unsigned __int8 *)(a1 + 0xD8) & v15) != 0 && (V_Game.races[V_RaceIndex].Unknown_1C0[v1] || v1 == V_RaceIndex) )
    {
      flags = 0;
      v14 = word_FFEA0[0];
      if ( V_Game.races[v3].Unknown_03 == 0xFFFFFFFF )
      {
        flags = 1;
        VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[0x16]);
      }
      ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, v14);
      VFX_shape_transform(pane, ShapeTable_sub_1B084, 0, hotX, hotY, V_BigBuffer, 0, 0x10000, 0x10000, flags);
    }
    if ( (*(unsigned __int8 *)(a1 + 0xD8) & v15) != 0 )
    {
      Unknown_02 = V_Game.races[v3].Unknown_02;
      v7 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEE2);
      VFX_shape_draw(pane, v7, Unknown_02, hotX, hotY);
    }
    ++v1;
    v15 *= 2;
    ++v2;
    ++v3;
  }
  return result;
}
// D85CA: using guessed type __int16 word_D85CA[13];
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEA0: using guessed type __int16 word_FFEA0[7];

//----- (00024154) --------------------------------------------------------
void __fastcall sub_24154(float *a1, int a2, float a3)
{
  float degrees; // [esp+0h] [ebp-8h]

  sub_254B0((int)a1 + 0x172);
  degrees = a3 * WinMgr.j;
  if ( a2 == 0xFFFFFFFF )
  {
    sub_535E4((P_Wnd9RW1)((char *)a1 + 0x14E), degrees);
  }
  else
  {
    sub_535B4((P_Wnd9RW1)a1, degrees);
  }
}

//----- (00024198) --------------------------------------------------------
void __fastcall sub_24198(int a1, int a2, int a3, int a4)
{
  int v5; // [esp-4h] [ebp-10h]

  if ( (*(float *)(a1 + 0x57A) >= 20.0 || a2 >= 0) && (*(float *)(a1 + 0x57A) <= 60.0 || a2 <= 0) )
  {
    v5 = *(__int16 *)(a1 + 0x576);
    *(float *)(a1 + 0x57A) = (double)a2 * WinMgr.j + *(float *)(a1 + 0x57A);
    sub_1B808((P_Wnd9RW1)(a1 + 0xDA), *(float *)(a1 + 0x57A), 1.0, 100000.0, v5);
    sub_254B0(a1 + 0x172);
  }
  else
  {
    *(_BYTE *)(a1 + 0xC0) &= ~0x10u;
  }
}

//----- (0002422C) --------------------------------------------------------
void __fastcall sub_2422C(int a1, int a2, int a3, int a4)
{
  size_t *v5; // edx
  int v6; // esi
  int v7; // eax
  int i; // kr04_4
  size_t *v9; // eax
  _DWORD *v10; // ebp
  double v11; // st7
  size_t *v12; // eax
  int v13; // edx
  int **v14; // ebx
  int *v15; // ebp
  int *v16; // ebx
  int *v17; // ebp
  double v18; // st7
  double v19; // st7
  float z; // eax
  int v21; // ebp
  __int16 v22; // dx
  int v23; // ebp
  int v24; // ebx
  int j; // eax
  double v26; // st7
  unsigned __int8 v27; // al
  int v28[3]; // [esp+8h] [ebp-114h] BYREF
  int v29[3]; // [esp+14h] [ebp-108h] BYREF
  int v30[3]; // [esp+20h] [ebp-FCh] BYREF
  float v31; // [esp+2Ch] [ebp-F0h]
  int v32; // [esp+30h] [ebp-ECh]
  int v33; // [esp+34h] [ebp-E8h]
  T_Vector3D v34; // [esp+38h] [ebp-E4h] BYREF
  int v35[3]; // [esp+44h] [ebp-D8h] BYREF
  float v36; // [esp+50h] [ebp-CCh]
  float v37; // [esp+54h] [ebp-C8h]
  float v38; // [esp+58h] [ebp-C4h]
  float v39; // [esp+5Ch] [ebp-C0h]
  int v40; // [esp+60h] [ebp-BCh]
  int v41; // [esp+64h] [ebp-B8h]
  int v42[3]; // [esp+68h] [ebp-B4h] BYREF
  float v43; // [esp+74h] [ebp-A8h]
  int v44; // [esp+78h] [ebp-A4h]
  int v45; // [esp+7Ch] [ebp-A0h]
  float v46; // [esp+80h] [ebp-9Ch]
  int v47; // [esp+84h] [ebp-98h]
  int v48; // [esp+88h] [ebp-94h]
  float v49; // [esp+8Ch] [ebp-90h]
  float v50; // [esp+90h] [ebp-8Ch]
  float v51; // [esp+94h] [ebp-88h]
  float v52; // [esp+98h] [ebp-84h]
  int v53; // [esp+9Ch] [ebp-80h]
  int v54; // [esp+A0h] [ebp-7Ch]
  T_Vector3D v55; // [esp+A4h] [ebp-78h] BYREF
  int *v56; // [esp+B0h] [ebp-6Ch]
  int *v57; // [esp+B8h] [ebp-64h]
  int *v58; // [esp+BCh] [ebp-60h]
  float v59; // [esp+C0h] [ebp-5Ch]
  int *v60; // [esp+C4h] [ebp-58h]
  int *v61; // [esp+C8h] [ebp-54h]
  int v62; // [esp+D0h] [ebp-4Ch]
  size_t *v63; // [esp+D4h] [ebp-48h]
  T_Star *v64; // [esp+D8h] [ebp-44h]
  size_t *v65; // [esp+DCh] [ebp-40h]
  int v66; // [esp+E0h] [ebp-3Ch]
  float *v67; // [esp+E4h] [ebp-38h]
  int v68; // [esp+E8h] [ebp-34h]
  int v69; // [esp+ECh] [ebp-30h]
  int v70; // [esp+F0h] [ebp-2Ch]
  int v71; // [esp+F4h] [ebp-28h] BYREF
  int v72; // [esp+F8h] [ebp-24h] BYREF
  int v73; // [esp+FCh] [ebp-20h] BYREF
  __int16 v74[14]; // [esp+100h] [ebp-1Ch] BYREF

  memset(&v55, 0, sizeof(v55));
  memset(&v34, 0, sizeof(v34));
  v5 = (size_t *)(a1 + 0x172);
  v6 = *(_DWORD *)(a1 + 0xB3);
  sub_254B0(a1 + 0x172);
  sub_1B864(a1 + 0xDA, a1 + 0x172, 0, a4);
  v62 = 0;
  v63 = v5;
  v67 = (float *)(a1 + 0x11A);
  v7 = v6 - 0x15;
  v65 = v5;
  for ( i = 0; ; ++i )
  {
    v69 = v7;
    if ( *(__int16 *)(a1 + 0xB7) <= v62 )
    {
      break;
    }
    v27 = *(_BYTE *)(v6 + 0x15 * i + 4);
    if ( v27 )
    {
      if ( v27 <= 1u )
      {
        v10 = *(_DWORD **)(v6 + 0x15 * i);
        sub_53384((float *)(*v10 + 8), v67, &v55.x);
        sub_53384((float *)(v10[1] + 8), v67, &v34.x);
        *(_DWORD *)(v6 + 0x15 * i + 0x11) = 0xFFFFFFFF;
        if ( v55.z > (double)*(float *)(a1 + 0x106)
          && v55.z < (double)*(float *)(a1 + 0x10A)
          && v34.z > (double)*(float *)(a1 + 0x106)
          && v34.z < (double)*(float *)(a1 + 0x10A) )
        {
          sub_533D4(&v55, *(float *)(a1 + 0x102), *(__int16 *)(a1 + 0x576), *(__int16 *)(a1 + 0x578), (int)v74, (int)&v73);
          sub_533D4(&v34, *(float *)(a1 + 0x102), *(__int16 *)(a1 + 0x576), *(__int16 *)(a1 + 0x578), (int)&v72, (int)&v71);
          *(_WORD *)(v6 + 0x15 * i + 5) = v74[0];
          *(_WORD *)(v6 + 0x15 * i + 7) = v73;
          *(_WORD *)(v6 + 0x15 * i + 9) = v72;
          *(_WORD *)(v6 + 0x15 * i + 0xB) = v71;
          v11 = (v55.z + v34.z) * 0.5;
          *(_DWORD *)(v6 + 0x15 * i + 0x11) = 0;
          v12 = v65;
          *(float *)(v6 + 0x15 * i + 0xD) = v11;
          sub_254BC((int)v12, v6 + 0x15 * i);
        }
      }
      else if ( v27 == 2 )
      {
        v13 = *(_DWORD *)(v6 + 0x15 * i);
        if ( *(_BYTE *)(v13 + 0x58) == 5 )
        {
          v14 = *(int ***)(v13 + 0x59);
          v49 = 0.0;
          v50 = 0.0;
          v51 = 0.0;
          v36 = 0.0;
          v37 = 0.0;
          v38 = 0.0;
          if ( (*(_DWORD *)(v13 + 0xA2) & 0x7FFFFFFF) != 0 )
          {
            v17 = *v14;
            v49 = *((float *)*v14 + 2);
            v50 = *((float *)v17 + 3);
            v51 = *((float *)v17 + 4);
            v16 = v14[1];
          }
          else
          {
            v15 = v14[1];
            v49 = *((float *)v15 + 2);
            v50 = *((float *)v15 + 3);
            v51 = *((float *)v15 + 4);
            v16 = *v14;
          }
          v36 = *((float *)v16 + 2);
          v37 = *((float *)v16 + 3);
          v38 = *((float *)v16 + 4);
          v52 = v36 - v49;
          v56 = v28;
          *(float *)&v53 = v37 - v50;
          *(float *)&v54 = v38 - v51;
          *(float *)v28 = v52;
          v28[1] = v53;
          v28[2] = v54;
          v18 = sqrt(*(float *)&v53 * *(float *)&v53 + v52 * v52 + *(float *)&v54 * *(float *)&v54);
          v57 = v35;
          v43 = v36 - v49;
          *(float *)v35 = v43;
          *(float *)&v44 = v37 - v50;
          v35[1] = v44;
          *(float *)&v45 = v38 - v51;
          v35[2] = v45;
          v58 = v42;
          v59 = *(float *)(v13 + 0x9E);
          v46 = v43 * v59;
          *(float *)&v47 = *(float *)&v44 * v59;
          *(float *)&v48 = *(float *)&v45 * v59;
          v19 = 1.0 / v18;
          *(float *)v42 = v46;
          v42[1] = v47;
          v42[2] = v48;
          v31 = v46 * v19;
          v60 = v30;
          *(float *)&v32 = *(float *)&v47 * v19;
          *(float *)v30 = v31;
          v30[1] = v32;
          *(float *)&v33 = v19 * *(float *)&v48;
          v30[2] = v33;
          v39 = v49 + v31;
          v61 = v29;
          *(float *)&v40 = v50 + *(float *)&v32;
          *(float *)v29 = v39;
          *(float *)&v41 = v51 + *(float *)&v33;
          v29[1] = v40;
          v29[2] = v41;
          sub_53384((float *)v29, v67, &v55.x);
          *(_DWORD *)(v6 + 0x15 * i + 0x11) = 0xFFFFFFFF;
          if ( v55.z > (double)*(float *)(a1 + 0x106) && v55.z < (double)*(float *)(a1 + 0x10A) )
          {
            sub_533D4(&v55, *(float *)(a1 + 0x102), *(__int16 *)(a1 + 0x576), *(__int16 *)(a1 + 0x578), (int)v74, (int)&v73);
            *(_WORD *)(v6 + 0x15 * i + 5) = v74[0] + 3;
            *(_WORD *)(v6 + 0x15 * i + 7) = v73;
            z = v55.z;
            *(_DWORD *)(v6 + 0x15 * i + 0x11) = 0;
            *(float *)(v6 + 0x15 * i + 0xD) = z;
            sub_254BC((int)v63, v6 + 0x15 * i);
            goto LABEL_29;
          }
        }
        else
        {
          v21 = *(_DWORD *)(v69 + 0x11);
          v68 = v69;
          if ( !v21 )
          {
            if ( *(_BYTE *)(v69 + 4) )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x56E);
            }
            v22 = 4;
            v23 = *(unsigned __int8 *)(v66 + 0x14);
            v24 = *(unsigned __int8 *)(a1 + 0xD8);
            v64 = *(T_Star **)v68;
            v70 = v24;
            for ( j = 0; j < 7; ++j )
            {
              if ( (v70 & v23 & (1 << j)) != 0 )
              {
                v22 += 2;
              }
            }
            if ( v64 == V_Game.pCurStar )
            {
              v22 += 2;
            }
            *(_WORD *)(v6 + 0x15 * i + 5) = v22 + *(_WORD *)(v68 + 5);
            *(_WORD *)(v6 + 0x15 * i + 7) = *(_WORD *)(v68 + 7);
            v26 = *(float *)(v68 + 0xD) + 1.0;
            *(_DWORD *)(v6 + 0x15 * i + 0x11) = 0;
            *(float *)(v6 + 0x15 * i + 0xD) = v26;
          }
        }
        sub_254BC((int)v63, v6 + 0x15 * i);
      }
      else
      {
        Q_AssertLogBreakExit_sub_261A8(0, "..\\coswnd.cpp", 0x588);
      }
    }
    else
    {
      v66 = *(_DWORD *)(v6 + 0x15 * i);
      sub_53384((float *)(v66 + 8), v67, &v55.x);
      *(_DWORD *)(v6 + 0x15 * i + 0x11) = 0xFFFFFFFF;
      if ( v55.z > (double)*(float *)(a1 + 0x106) && v55.z < (double)*(float *)(a1 + 0x10A) )
      {
        sub_533D4(&v55, *(float *)(a1 + 0x102), *(__int16 *)(a1 + 0x576), *(__int16 *)(a1 + 0x578), (int)v74, (int)&v73);
        *(_WORD *)(v6 + 0x15 * i + 5) = v74[0];
        *(_WORD *)(v6 + 0x15 * i + 7) = v73;
        *(float *)(v6 + 0x15 * i + 0xD) = v55.z;
        v9 = v65;
        *(_DWORD *)(v6 + 0x15 * i + 0x11) = 0;
        sub_254BC((int)v9, v6 + 0x15 * i);
      }
    }
LABEL_29:
    v7 = v69 + 0x15;
    ++v62;
  }
  sub_254DC(v65);
}
// 2422C: using guessed type _WORD var_1C[14];

//----- (00024948) --------------------------------------------------------
int __fastcall sub_24948(int result, int a2, int a3)
{
  int v3; // ebp
  int v4; // ebx
  int v5; // edi
  int v6; // edx
  int v7; // eax
  int v8; // edx
  int v9; // ebx
  __int16 v10; // si
  int i; // ebx
  int v12; // eax
  int v13; // edx
  int v14; // edi
  char v15; // dl
  int v16; // eax
  int v17; // kr00_4
  int v18; // kr04_4
  int v19; // kr0C_4
  char v20; // al
  char v21; // al
  __int16 j; // si
  int v23; // ebx
  int v24; // edx
  int v25; // ebx
  int v26; // edx
  const char *v27; // ecx
  _DWORD v28[5]; // [esp+0h] [ebp-2Ch] BYREF
  int v29; // [esp+14h] [ebp-18h]
  int v30; // [esp+18h] [ebp-14h]

  v3 = result;
  v29 = a2;
  v30 = a3;
  if ( *(_DWORD *)(result + 0xD4) == 0xFFFFFFFF )
  {
    return result;
  }
  v4 = *(_DWORD *)(result + 0xBB);
  if ( v4 )
  {
    v5 = 0x28;
    v6 = *(__int16 *)(v4 + 5) - v29;
    v7 = *(__int16 *)(v4 + 7) - v30;
    if ( *(_BYTE *)(v4 + 4) == 2 )
    {
      v6 += byte_965F8[0];
      v5 = 0x14;
      v7 += SHIBYTE(dword_965FD);
    }
    result = v6 * v6 + v7 * v7;
    if ( result <= v5 )
    {
      return result;
    }
    v8 = *(_DWORD *)(v3 + 0x57E);
    *(_DWORD *)(v3 + 0xBB) = 0;
    sub_5A270(&WinMgr, v8, 0, 0);
    stru_D85E4.x0 = *(_DWORD *)(v3 + 0x10) - 0x82;
    v9 = *(_DWORD *)(v3 + 0xA7);
    stru_D85E4.y0 = *(_DWORD *)(v3 + 0x14) - 0x1B;
    (*(void (__fastcall **)(int, int))(v9 + 0xC))(v3, 0xA);
  }
  v10 = *(_WORD *)(v3 + 0xB7) - 1;
  for ( i = 0x15 * (*(__int16 *)(v3 + 0xB7) - 1) + *(_DWORD *)(v3 + 0xB3); ; i -= 0x15 )
  {
    result = v10;
    if ( v10 < 0 )
    {
      break;
    }
    if ( *(_BYTE *)(i + 4) != 1 )
    {
      v12 = *(__int16 *)(i + 5) - v29;
      v13 = *(__int16 *)(i + 7) - v30;
      v14 = 0x28;
      if ( *(_BYTE *)(i + 4) == 2 )
      {
        v12 += byte_965F8[0];
        v13 += SHIBYTE(dword_965FD);
        v14 = 0x14;
      }
      result = v13 * v13 + v12 * v12;
      if ( result < v14 )
      {
        *(_DWORD *)(v3 + 0xBB) = i;
        break;
      }
    }
    --v10;
  }
  if ( *(_DWORD *)(v3 + 0xBB) )
  {
    sub_5A270(&WinMgr, *(_DWORD *)(v3 + 0x57E) + 1, 0, 0);
    result = *(_DWORD *)(v3 + 0xBB);
    if ( !*(_BYTE *)(result + 4) )
    {
      v28[0] = dword_96654[0];
      v28[1] = dword_96654[1];
      v28[2] = dword_96654[2];
      v28[3] = dword_96654[3];
      v28[4] = dword_96654[4];
      v15 = 1;
      v16 = **(_DWORD **)(v3 + 0xBB);
      if ( ((unsigned __int8)V_RaceIndexMask & *(_BYTE *)(v16 + 0x17)) != 0 )
      {
        v17 = v16 + 0x1C;
        v18 = 0;
        v19 = 0;
        do
        {
          v20 = *(_BYTE *)(v17 + 2 * v18);
          *((_BYTE *)v28 + 2 * v19) = v20;
          if ( !v20 )
          {
            break;
          }
          v21 = *(_BYTE *)(v17 + 2 * v18 + 1);
          *((_BYTE *)v28 + 2 * v19 + 1) = v21;
          ++v18;
          ++v19;
        }
        while ( v21 );
        for ( j = 0; j < 7 && (*(_BYTE *)(**(_DWORD **)(v3 + 0xBB) + 0x14) & (unsigned __int8)(*(_BYTE *)(v3 + 0xD9) & v15)) == 0; ++j )
        {
          v15 *= 2;
        }
      }
      if ( LOBYTE(v28[0]) )
      {
        v23 = *(_DWORD *)(v3 + 0x14) - 0x1B;
        v24 = *(_DWORD *)(v3 + 0x10) - 0x82;
        WinMgr.LargeFont.pane = V_Type6_stru_D8654.pane;
        sub_2B8A8(&WinMgr.LargeFont, v24, v23, (const char *)v28, 0, 0xFFFFFFFF, 0xFF, 0);
      }
      v25 = *(_DWORD *)(v3 + 0x14) - 0xC;
      v26 = *(_DWORD *)(v3 + 0x10) - 0x82;
      v27 = V_StarTypeTexts_D84C4[***(_DWORD ***)(v3 + 0xBB)];
      WinMgr.SmallFont.pane = V_Type6_stru_D8654.pane;
      return sub_2B8A8(&WinMgr.SmallFont, v26, v25, v27, 0, 0xFFFFFFFF, 0xFF, 0);
    }
  }
  return result;
}
// 965FD: using guessed type int dword_965FD;
// 96654: using guessed type _DWORD dword_96654[5];
// 968DC: using guessed type char V_RaceIndexMask;

//----- (00024BE0) --------------------------------------------------------
int __fastcall sub_24BE0(int a1)
{
  int result; // eax
  T_TypeA2 *v3; // eax
  int v4; // ecx
  int v5; // kr04_4
  _DWORD *v6; // ebx
  __int16 *v7; // ecx
  int v8; // edx

  result = *(_DWORD *)(a1 + 0xBB);
  if ( !*(_BYTE *)(result + 4) )
  {
    if ( *(_DWORD *)(a1 + 0x582) )
    {
      result = *(_DWORD *)result;
      if ( ((unsigned __int8)V_RaceIndexMask & *(_BYTE *)(result + 0x16)) != 0 )
      {
        v4 = 0;
        v5 = 0;
        while ( v4 < *(__int16 *)(result + 0x44) )
        {
          v6 = *(_DWORD **)(result + 4 * v5 + 0x2C);
          if ( result == *v6 && v6[1] == **(_DWORD **)(a1 + 0x586) || *v6 == **(_DWORD **)(a1 + 0x586) && result == v6[1] )
          {
            v7 = **(__int16 ***)(a1 + 0x586);
            v8 = result;
            sub_1D654(v7, (T_Star *)result, v6);
            *(_DWORD *)(a1 + 0x582) = 0;
            sub_24D30(a1, v8, (int)v6, (int)v7);
            sub_2422C(a1, v8, (int)v6, (int)v7);
            return (*(int (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
          }
          ++v4;
          ++v5;
        }
      }
    }
    else if ( WinMgr.Unknown_4228 == 1 )
    {
      result = *(_DWORD *)result;
      if ( ((unsigned __int8)V_RaceIndexMask & *(_BYTE *)(result + 0x17)) != 0 )
      {
        V_Game.pCurStar = (P_Star)result;
        *(_DWORD *)(a1 + 0xBB) = 0;
        return sub_56B60(&WinMgr, 1, 0x10, 1);
      }
    }
    else if ( WinMgr.Unknown_4228 == 0xD )
    {
      V_Game.pCurStar = *(P_Star *)result;
      v3 = sub_56E18(&WinMgr, "NEGSCREEN", 0xD, 0);
      if ( !v3 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x612);
      }
      sub_32A1C((int)v3);
      return (*(int (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    }
  }
  return result;
}
// 968DC: using guessed type char V_RaceIndexMask;

//----- (00024D30) --------------------------------------------------------
int __fastcall sub_24D30(int a1, int a2, int a3, int a4)
{
  WORD i; // di
  T_Star *v6; // esi
  __int16 v7; // bx
  int v8; // esi
  WORD j; // si
  T_Lane *v10; // edi
  WORD v11; // di
  __int16 k; // si
  int result; // eax
  T_Ship *v14; // eax
  int v15[107]; // [esp+0h] [ebp-1D4h] BYREF
  char s[32]; // [esp+1ACh] [ebp-28h] BYREF

  *(_WORD *)(a1 + 0xB7) = 0;
  for ( i = 0; i < V_Game.starsNum; ++i )
  {
    if ( *(_WORD *)(a1 + 0xB7) >= *(_WORD *)(a1 + 0xB9) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x659);
    }
    v6 = &V_Game.stars[i];
    *(_DWORD *)(*(_DWORD *)(a1 + 0xB3) + 0x15 * (*(int *)(a1 + 0xB5) >> 0x10)) = v6;
    *(_BYTE *)(*(_DWORD *)(a1 + 0xB3) + 0x15 * *(__int16 *)(a1 + 0xB7) + 4) = 0;
    v7 = *(_WORD *)(a1 + 0xB7) + 1;
    *(_WORD *)(a1 + 0xB7) = v7;
    if ( v6->Unknown_15 )
    {
      if ( v7 >= *(__int16 *)(a1 + 0xB9) )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x66B);
      }
      v8 = sub_1D794((P_Location)&V_Game.stars[i], (P_Ship *)v15);
      if ( !v8 && V_NougatLfExists_dword_A0CFC == 0xFFFFFFFF )
      {
        sprintf(s, "cos%05d.bug", V_Game.day);
        Q_SaveGam_sub_54048(s);
        Q_AssertLogBreakExit_sub_261A8(0, "..\\coswnd.cpp", 0x676);
      }
      if ( v8 > 0 )
      {
        *(_DWORD *)(0x15 * *(__int16 *)(a1 + 0xB7) + *(_DWORD *)(a1 + 0xB3)) = v15[0];
        *(_BYTE *)(*(_DWORD *)(a1 + 0xB3) + 0x15 * (__int16)(*(_WORD *)(a1 + 0xB7))++ + 4) = 2;
      }
    }
  }
  for ( j = 0; j < V_Game.lanesNum; ++j )
  {
    v10 = &V_Game.lanes[j];
    if ( ((unsigned __int8)V_RaceIndexMask & v10->Unknown_20[0]) != 0 )
    {
      if ( *(_WORD *)(a1 + 0xB7) >= *(_WORD *)(a1 + 0xB9) )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x68B);
      }
      *(_DWORD *)(*(_DWORD *)(a1 + 0xB3) + 0x15 * *(__int16 *)(a1 + 0xB7)) = v10;
      *(_BYTE *)(*(_DWORD *)(a1 + 0xB3) + 0x15 * (__int16)(*(_WORD *)(a1 + 0xB7))++ + 4) = 1;
    }
  }
  v11 = 0;
  for ( k = 0; ; ++k )
  {
    result = k;
    if ( k >= 0x6B || v11 >= V_Game.shipsNum )
    {
      break;
    }
    if ( *(_WORD *)(a1 + 0xB7) >= *(_WORD *)(a1 + 0xB9) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x698);
    }
    v14 = &V_Game.ships[k];
    if ( v14->raceIndex != 0xFFFFFFFF )
    {
      ++v11;
      if ( v14->locationType == 5 )
      {
        *(_DWORD *)(0x15 * *(__int16 *)(a1 + 0xB7) + *(_DWORD *)(a1 + 0xB3)) = v14;
        *(_BYTE *)(0x15 * (__int16)(*(_WORD *)(a1 + 0xB7))++ + *(_DWORD *)(a1 + 0xB3) + 4) = 2;
      }
    }
  }
  return result;
}
// 968DC: using guessed type char V_RaceIndexMask;
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// 24D30: using guessed type int var_1D4[107];

//----- (00024FCC) --------------------------------------------------------
void __fastcall sub_24FCC(P_Wnd2COSW a1, P_FileInfo pfi, int read)
{
  T_Wnd9RW1 *p_Wnd9RW1; // ecx
  T_Vector3D *p_vector3; // edi
  int *p_Unknown_8C; // ebp
  int v7; // edx
  int *v8; // edx
  int v9[7]; // [esp+0h] [ebp-1A4h] BYREF
  char Unknown_D8; // [esp+1Ch] [ebp-188h]
  char Unknown_D9; // [esp+1Dh] [ebp-187h]
  T_Wnd9RW1 v12; // [esp+1Eh] [ebp-186h] BYREF
  int Unknown_57A; // [esp+B6h] [ebp-EEh]
  int v14[7]; // [esp+C0h] [ebp-E4h] BYREF
  char v15; // [esp+DCh] [ebp-C8h]
  char v16; // [esp+DDh] [ebp-C7h]
  T_Wnd9RW1 v17; // [esp+DEh] [ebp-C6h] BYREF
  int v18; // [esp+176h] [ebp-2Eh]
  T_FileInfo *pfi_; // [esp+180h] [ebp-24h]
  int p_Unknown_74; // [esp+184h] [ebp-20h]
  int *p_Unknown_80; // [esp+188h] [ebp-1Ch]
  T_Vector3D *p_vector2; // [esp+18Ch] [ebp-18h]
  T_Vector3D *p_vector_34; // [esp+190h] [ebp-14h]

  pfi_ = pfi;
  p_Wnd9RW1 = &a1->Wnd9RW1;
  p_Unknown_74 = (int)&a1->Wnd9RW1.Unknown_74;
  p_vector3 = &a1->Wnd9RW1.matrix_00.vector3;
  p_vector_34 = &a1->Wnd9RW1.vector_34;
  p_Unknown_8C = &a1->Wnd9RW1.Unknown_8C;
  p_vector2 = &a1->Wnd9RW1.matrix_00.vector2;
  p_Unknown_80 = &a1->Wnd9RW1.Unknown_80;
  if ( read == TRUE )
  {
    sub_1B4F0(&v17);
    Q_ReadFile_sub_1BF94(pfi_, v14, 0xBEu);
    a1->Unknown_C0 = v14[0];
    a1->Unknown_C4 = v14[1];
    a1->Unknown_58A = v14[2];
    a1->Unknown_C8 = v14[3];
    a1->Unknown_CC = v14[4];
    a1->Unknown_D0 = v14[5];
    a1->Unknown_D4 = v14[6];
    a1->Unknown_D8 = v15;
    a1->Unknown_D9 = v16;
    p_Wnd9RW1->matrix_00.vector1.x = v17.matrix_00.vector1.x;
    p_Wnd9RW1->matrix_00.vector1.y = v17.matrix_00.vector1.y;
    p_Wnd9RW1->matrix_00.vector1.z = v17.matrix_00.vector1.z;
    *p_vector2 = v17.matrix_00.vector2;
    *p_vector3 = v17.matrix_00.vector3;
    p_Wnd9RW1->Unknown_24 = v17.Unknown_24;
    p_Wnd9RW1->Unknown_28 = v17.Unknown_28;
    p_Wnd9RW1->Unknown_2C = v17.Unknown_2C;
    p_Wnd9RW1->Unknown_30 = v17.Unknown_30;
    *p_vector_34 = v17.vector_34;
    p_Wnd9RW1->Unknown_40 = v17.Unknown_40;
    p_Wnd9RW1->Unknown_44 = v17.Unknown_44;
    p_Wnd9RW1->Unknown_48 = v17.Unknown_48;
    p_Wnd9RW1->Unknown_4C = v17.Unknown_4C;
    p_Wnd9RW1->Unknown_50 = v17.Unknown_50;
    p_Wnd9RW1->Unknown_54 = v17.Unknown_54;
    p_Wnd9RW1->Unknown_58 = v17.Unknown_58;
    p_Wnd9RW1->Unknown_5C = v17.Unknown_5C;
    p_Wnd9RW1->Unknown_60 = v17.Unknown_60;
    p_Wnd9RW1->Unknown_64 = v17.Unknown_64;
    p_Wnd9RW1->Unknown_68 = v17.Unknown_68;
    p_Wnd9RW1->Unknown_6C = v17.Unknown_6C;
    p_Wnd9RW1->Unknown_70 = v17.Unknown_70;
    v7 = p_Unknown_74;
    *(float *)p_Unknown_74 = v17.Unknown_74;
    *(_DWORD *)(v7 + 4) = v17.Unknown_78;
    *(_DWORD *)(v7 + 8) = v17.Unknown_7C;
    v8 = p_Unknown_80;
    *p_Unknown_80 = v17.Unknown_80;
    v8[1] = LODWORD(v17.Unknown_84);
    v8[2] = v17.Unknown_88;
    *p_Unknown_8C = v17.Unknown_8C;
    p_Unknown_8C[1] = v17.Unknown_90;
    p_Unknown_8C[2] = LODWORD(v17.Unknown_94);
    a1->Unknown_57A = (float)v18;
    Q_Ret_sub_1B66C();
  }
  else
  {
    sub_1B4F0(&v12);
    v9[0] = a1->Unknown_C0;
    v9[1] = a1->Unknown_C4;
    v9[2] = a1->Unknown_58A;
    v9[3] = a1->Unknown_C8;
    v9[4] = a1->Unknown_CC;
    v9[5] = a1->Unknown_D0;
    v9[6] = a1->Unknown_D4;
    Unknown_D8 = a1->Unknown_D8;
    Unknown_D9 = a1->Unknown_D9;
    v12.matrix_00.vector1.x = p_Wnd9RW1->matrix_00.vector1.x;
    v12.matrix_00.vector1.y = a1->Wnd9RW1.matrix_00.vector1.y;
    v12.matrix_00.vector1.z = a1->Wnd9RW1.matrix_00.vector1.z;
    v12.matrix_00.vector2 = *p_vector2;
    v12.matrix_00.vector3.x = p_vector3->x;
    v12.matrix_00.vector3.y = a1->Wnd9RW1.matrix_00.vector3.y;
    v12.matrix_00.vector3.z = a1->Wnd9RW1.matrix_00.vector3.z;
    v12.Unknown_24 = a1->Wnd9RW1.Unknown_24;
    v12.Unknown_28 = a1->Wnd9RW1.Unknown_28;
    v12.Unknown_2C = a1->Wnd9RW1.Unknown_2C;
    v12.Unknown_30 = a1->Wnd9RW1.Unknown_30;
    v12.vector_34 = *p_vector_34;
    v12.Unknown_40 = a1->Wnd9RW1.Unknown_40;
    v12.Unknown_44 = a1->Wnd9RW1.Unknown_44;
    v12.Unknown_48 = a1->Wnd9RW1.Unknown_48;
    v12.Unknown_4C = a1->Wnd9RW1.Unknown_4C;
    v12.Unknown_50 = a1->Wnd9RW1.Unknown_50;
    v12.Unknown_54 = a1->Wnd9RW1.Unknown_54;
    v12.Unknown_58 = a1->Wnd9RW1.Unknown_58;
    v12.Unknown_5C = a1->Wnd9RW1.Unknown_5C;
    v12.Unknown_60 = a1->Wnd9RW1.Unknown_60;
    v12.Unknown_64 = a1->Wnd9RW1.Unknown_64;
    v12.Unknown_68 = a1->Wnd9RW1.Unknown_68;
    v12.Unknown_6C = a1->Wnd9RW1.Unknown_6C;
    v12.Unknown_70 = a1->Wnd9RW1.Unknown_70;
    v12.Unknown_74 = *(float *)p_Unknown_74;
    v12.Unknown_78 = *(_DWORD *)(p_Unknown_74 + 4);
    v12.Unknown_7C = *(_DWORD *)(p_Unknown_74 + 8);
    v12.Unknown_80 = *p_Unknown_80;
    LODWORD(v12.Unknown_84) = p_Unknown_80[1];
    v12.Unknown_88 = p_Unknown_80[2];
    v12.Unknown_8C = *p_Unknown_8C;
    v12.Unknown_90 = a1->Wnd9RW1.Unknown_90;
    v12.Unknown_94 = a1->Wnd9RW1.Unknown_94;
    Unknown_57A = (int)a1->Unknown_57A;
    Q_CFILE_CPP_dos_write_sub_1C098(&pfi_->fh, v9, 0xBEu);
    Q_Ret_sub_1B66C();
  }
}

//----- (000254A4) --------------------------------------------------------
void __fastcall __spoils<> sub_254A4(int a1)
{
  sub_254B0(a1);
}

//----- (000254B0) --------------------------------------------------------
void __fastcall __spoils<> sub_254B0(int result)
{
  *(_DWORD *)(result + 0x400) = 0;
}

//----- (000254BC) --------------------------------------------------------
int __fastcall sub_254BC(int result, int a2)
{
  int v2; // ebx

  v2 = *(_DWORD *)(result + 0x400);
  if ( v2 < 0x100 )
  {
    if ( a2 )
    {
      *(_DWORD *)(result + 4 * v2) = a2;
      ++*(_DWORD *)(result + 0x400);
    }
  }
  return result;
}

//----- (000254DC) --------------------------------------------------------
void __fastcall sub_254DC(size_t *a1)
{
  qsort(a1, a1[0x100], 4u, sub_22430);
}

//----- (000254F8) --------------------------------------------------------
void __fastcall sub_254F8(int *a1, int a2)
{
  int v2; // kr04_4
  int v3; // esi
  unsigned __int8 v4; // al
  LONG v5; // edi
  int v6; // ebp
  int v7; // ecx
  T_Star *v8; // ebx
  LONG v9; // eax
  LONG v10; // ebp
  T_Star *v11; // eax
  char v12; // dl
  int v13; // edi
  LONG v14; // ecx
  LONG v15; // [esp-Ch] [ebp-78h]
  LONG v16; // [esp-8h] [ebp-74h]
  LONG v17; // [esp-8h] [ebp-74h]
  PANE *v18; // [esp+0h] [ebp-6Ch]
  int v20; // [esp+Ch] [ebp-60h]
  PANE *v21; // [esp+10h] [ebp-5Ch]
  T_Star *v22; // [esp+14h] [ebp-58h]
  PANE *v23; // [esp+18h] [ebp-54h]
  PANE *v24; // [esp+1Ch] [ebp-50h]
  PANE *v25; // [esp+20h] [ebp-4Ch]
  PANE *v26; // [esp+24h] [ebp-48h]
  int v27; // [esp+28h] [ebp-44h]
  PANE *v28; // [esp+2Ch] [ebp-40h]
  PANE *pane; // [esp+30h] [ebp-3Ch]
  T_Star *v30; // [esp+34h] [ebp-38h]
  int v31; // [esp+38h] [ebp-34h]
  int i; // [esp+40h] [ebp-2Ch]
  __int16 Unknown_4228; // [esp+44h] [ebp-28h]
  __int16 j; // [esp+48h] [ebp-24h]
  unsigned __int8 v36; // [esp+4Ch] [ebp-20h]
  char v37; // [esp+50h] [ebp-1Ch]
  char v38; // [esp+54h] [ebp-18h]

  VFX_pane_wipe((PANE *)(a2 + 4), *(unsigned __int8 *)(a2 + 0xBF));
  v36 = 4 * V_Game.races[V_RaceIndex].Unknown_02 + 0x13;
  v27 = 0;
  if ( a1[0x100] > 0 )
  {
    v28 = (PANE *)(a2 + 4);
    v26 = (PANE *)(a2 + 4);
    v25 = (PANE *)(a2 + 4);
    v21 = (PANE *)(a2 + 4);
    pane = (PANE *)(a2 + 4);
    v18 = (PANE *)(a2 + 4);
    v23 = (PANE *)(a2 + 4);
    v24 = (PANE *)(a2 + 4);
    v2 = 0;
    do
    {
      v3 = *a1;
      v4 = *(_BYTE *)(*a1 + 4);
      v20 = (int)(*(float *)(*a1 + 0xD) + -1500.0);
      if ( v4 )
      {
        if ( v4 <= 1u )
        {
          if ( *(_DWORD *)(a2 + 0xC4) || *(_DWORD *)(a2 + 0x58A) )
          {
            v7 = 7;
            v8 = *(T_Star **)v3;
            if ( v20 <= 0xDC )
            {
              if ( v20 <= 0x93 )
              {
                if ( v20 <= 0x49 )
                {
                  if ( v20 <= 0 )
                  {
                    if ( v20 <= (int)0xFFFFFFB7 )
                    {
                      if ( v20 <= (int)0xFFFFFF6D )
                      {
                        if ( v20 > (int)0xFFFFFF24 )
                        {
                          v7 = 6;
                        }
                      }
                      else
                      {
                        v7 = 5;
                      }
                    }
                    else
                    {
                      v7 = 4;
                    }
                  }
                  else
                  {
                    v7 = 3;
                  }
                }
                else
                {
                  v7 = 2;
                }
              }
              else
              {
                v7 = 1;
              }
            }
            else
            {
              v7 = 0;
            }
            if ( *(_DWORD *)(a2 + 0x58A) == 0xFFFFFFFF )
            {
              if ( *(_WORD *)&v8->name[5] )
              {
                v9 = 4 * V_Game.races[V_RaceIndex].Unknown_02 + 0x10 + v7 / 2;
              }
              else
              {
                v9 = v7 + 0x30;
              }
            }
            else
            {
              v9 = v7 + 0x68;
            }
            if ( !*(_DWORD *)(a2 + 0x58A) && (v8->name[7] & 1) != 0 )
            {
              v9 = v7 / 2 + 0x70;
            }
            VFX_line_draw(v23, *(__int16 *)(v3 + 5), *(__int16 *)(v3 + 7), *(__int16 *)(v3 + 9), *(__int16 *)(v3 + 0xB), 0, v9);
          }
        }
        else if ( v4 == 2 && *(_DWORD *)(a2 + 0xC8) )
        {
          v10 = 3;
          v11 = *(T_Star **)v3;
          if ( v20 <= 0xDC )
          {
            if ( v20 <= 0 )
            {
              if ( v20 > (int)0xFFFFFF24 )
              {
                v10 = 2;
              }
            }
            else
            {
              v10 = 1;
            }
          }
          else
          {
            v10 = 0;
          }
          v12 = BYTE2(v11->Unknown_46[4]);
          if ( v12 == 5 )
          {
            if ( ((1 << V_RaceIndex) & *(unsigned __int8 *)(*(int *)((char *)&v11->Unknown_46[4] + 3) + 0x20)) != 0
              && ((1 << LOWORD(v11->Unknown_46[4])) & *(unsigned __int8 *)(a2 + 0xD8)) != 0 )
            {
              sub_53EB8(v24, *(void **)(a2 + 0xAF), v10, *(__int16 *)(v3 + 5), *(__int16 *)(v3 + 7), v11->Unknown_46[4]);
            }
          }
          else
          {
            v37 = 1;
            if ( v12 == 4 )
            {
              v30 = *(T_Star **)((char *)&v11->Unknown_46[4] + 3);
            }
            else
            {
              v30 = &V_Game.stars[*(__int16 *)(*(int *)((char *)&v11->Unknown_46[4] + 3) + 0xC)];
            }
            if ( !v30 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x822);
            }
            if ( ((1 << V_RaceIndex) & (unsigned __int8)v30->Unknown_17) != 0 )
            {
              v13 = 0;
              for ( i = 0; V_Game.racesNum > i; ++i )
              {
                if ( (*(_BYTE *)(a2 + 0xD8) & (unsigned __int8)(v37 & v30->Unknown_15)) != 0 )
                {
                  v17 = *(__int16 *)(v3 + 7) + *((char *)&dword_965FD + v13 + 3);
                  v14 = *(__int16 *)(v3 + 5) + byte_965F8[v13++];
                  sub_53EB8(v21, *(void **)(a2 + 0xAF), v10, v14, v17, i);
                }
                v37 *= 2;
              }
            }
          }
        }
      }
      else
      {
        v22 = *(T_Star **)v3;
        v31 = 3;
        if ( v20 <= 0xDC )
        {
          if ( v20 <= 0 )
          {
            if ( v20 > (int)0xFFFFFF24 )
            {
              v31 = 2;
            }
          }
          else
          {
            v31 = 1;
          }
        }
        else
        {
          v31 = 0;
        }
        VFX_shape_draw(v18, *(void **)(a2 + 0xAB), v31 + 4 * v22->type, *(__int16 *)(v3 + 5), *(__int16 *)(v3 + 7));
        Unknown_4228 = WinMgr.Unknown_4228;
        v5 = 4;
        if ( (((1 << V_RaceIndex) & (unsigned __int8)v22->Unknown_17) != 0 || WinMgr.Unknown_4228 == 3)
          && *(_DWORD *)(a2 + 0xCC)
          && v22->racesBits )
        {
          v6 = 0;
          v38 = 1;
          do
          {
            if ( (*(_BYTE *)(a2 + 0xD8) & (unsigned __int8)(v22->racesBits & v38)) != 0 )
            {
              v16 = v5;
              v15 = v5;
              v5 += 2;
              VFX_ellipse_draw(
                pane,
                *(__int16 *)(v3 + 5),
                *(__int16 *)(v3 + 7),
                v15,
                v16,
                v31 + (unsigned __int8)(4 * V_Game.races[v6].Unknown_02 + 0x13) - 3);
            }
            ++v6;
            v38 *= 2;
          }
          while ( v6 != 7 );
        }
        if ( v22 == V_Game.pCurStar && WinMgr.Unknown_4228 != 3 )
        {
          VFX_ellipse_draw(v25, *(__int16 *)(v3 + 5), *(__int16 *)(v3 + 7), v5, v5, 0xF3);
        }
        if ( (((1 << V_RaceIndex) & (unsigned __int8)v22->Unknown_17) != 0 || Unknown_4228 == 3)
          && (v22->racesBits & 0x80) != 0
          && *(_DWORD *)(a2 + 0xD0) == 0xFFFFFFFF )
        {
          for ( j = 0; j < V_Game.racesNum; ++j )
          {
            if ( v22 == V_Game.races[j].star )
            {
              break;
            }
          }
          if ( j >= V_Game.racesNum )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x786);
          }
          if ( (*(_BYTE *)(a2 + 0xD8) & (unsigned __int8)(1 << j)) != 0 || WinMgr.Unknown_4228 == 3 )
          {
            Q_WINMGR_CPP_sub_53E38(v26, *(__int16 *)(v3 + 5) - 7, *(__int16 *)(v3 + 7) + 3, j);
          }
        }
        if ( ((1 << V_RaceIndex) & (unsigned __int8)v22->Unknown_17) != 0
          && *(_DWORD *)(a2 + 0xCC)
          && ((1 << V_RaceIndex) & v22->racesBits) == 0 )
        {
          VFX_pixel_write(v28, *(__int16 *)(v3 + 5) - 4, *(__int16 *)(v3 + 7), v36);
          VFX_pixel_write(v28, *(__int16 *)(v3 + 5), *(__int16 *)(v3 + 7) - 4, v36);
          VFX_pixel_write(v28, *(__int16 *)(v3 + 5) + 4, *(__int16 *)(v3 + 7), v36);
          VFX_pixel_write(v28, *(__int16 *)(v3 + 5), *(__int16 *)(v3 + 7) + 4, v36);
        }
      }
      ++v27;
      ++v2;
    }
    while ( v27 < a1[0x100] );
  }
}
// 965FD: using guessed type int dword_965FD;

//----- (00025BF8) --------------------------------------------------------
void __fastcall __spoils<> sub_25BF8(P_TypeA2 a1)
{
  Q_A2Ctor_sub_2C830(a1);
  a1->procs = (P_Procs)off_95B9C;
}
// 95B9C: using guessed type int (*off_95B9C[2])();

//----- (00025C08) --------------------------------------------------------
T_TypeA2 *__fastcall sub_25C08(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_95B48);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95B9C;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95B9C: using guessed type int (*off_95B9C[2])();

//----- (00025C4C) --------------------------------------------------------
void __fastcall sub_25C4C(unsigned int a1, int a2)
{
  int v3; // edi
  __int16 v4; // si
  PANE *v5; // ebp

  sub_2CD24(a1, a2);
  v3 = 0x2F;
  v4 = 0;
  if ( V_Game.racesNum > 0 )
  {
    v5 = (PANE *)(a1 + 4);
    do
    {
      if ( v4 == V_RaceIndex || V_Game.races[V_RaceIndex].Unknown_1C0[v4] )
      {
        Q_WINMGR_CPP_sub_53E38(v5, (__int16)v3, 3, v4);
        v3 += 0x10;
      }
      ++v4;
    }
    while ( v4 < V_Game.racesNum );
  }
}

//----- (00025CB8) --------------------------------------------------------
void __fastcall __spoils<> Q_WndRSWCtor_sub_25CB8(P_WndRSW result)
{
  Q_A2Ctor_sub_2C830(&result->a);
  result->a.procs = (P_Procs)off_95B84;
  result->Unknown_AB = 0;
}
// 95B84: using guessed type int (*off_95B84[5])();

//----- (00025CD4) --------------------------------------------------------
T_TypeA2 *__fastcall Q_WndRSWDtor_sub_25CD4(P_WndRSW a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, &C_WndRSW);
    operator delete[](v3);
    return (T_TypeA2 *)a1;
  }
  else
  {
    a1->a.procs = (P_Procs)off_95B84;
    v5 = Q_A2Dtor_sub_2C848(&a1->a, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95B84: using guessed type int (*off_95B84[5])();

//----- (00025D18) --------------------------------------------------------
void __fastcall sub_25D18(int result, LONG a2)
{
  unsigned int v3; // esi
  int v4; // ecx
  UBYTE Unknown_01; // al
  __int16 v6; // cx
  WORD i; // ax
  char *sub_1CEA8; // eax
  char *v9; // eax
  __int16 v10; // eax^2
  PANE *v11; // esi
  int v12; // ecx
  LONG v13; // ebx
  void *ShapeTable_sub_1B084; // eax
  __int16 v15; // [esp-8h] [ebp-68h]
  int v16; // [esp-4h] [ebp-64h]
  char s[52]; // [esp+0h] [ebp-60h] BYREF
  int Unknown_03; // [esp+34h] [ebp-2Ch]
  int v19; // [esp+38h] [ebp-28h]
  char *v20; // [esp+3Ch] [ebp-24h]
  LONG color; // [esp+40h] [ebp-20h]
  int v22; // [esp+44h] [ebp-1Ch]
  UBYTE v23; // [esp+48h] [ebp-18h]

  if ( *(_DWORD *)(result + 0x39) )
  {
    v3 = 0xFFFFFFFF;
    v22 = 0;
    color = 0xF2;
    if ( a2 )
    {
      color = a2;
    }
    v4 = *(__int16 *)(result + 0xAB);
    Unknown_03 = V_Game.races[v4].Unknown_03;
    v23 = V_Game.races[V_RaceIndex].Unknown_1C0[v4];
    if ( !v23 || Unknown_03 )
    {
      v22 = 0xFFFFFFFF;
    }
    else
    {
      Unknown_01 = V_Game.races[v4].Unknown_01;
      v19 = 4 * V_Game.races[v4].Unknown_02 + 0x13;
      v20 = V_SpecNames[Unknown_01];
    }
    if ( *(_WORD *)(result + 0xAB) == V_RaceIndex )
    {
      v6 = 0;
      for ( i = 0; i < V_Game.racesNum; ++i )
      {
        if ( i != V_RaceIndex && V_Game.races[V_RaceIndex].Unknown_1C0[i] )
        {
          ++v6;
        }
      }
      v16 = V_Game.racesNum - 1;
      sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xB);// 11: "%d of %d Species Known"
      sprintf(s, sub_1CEA8, v6, v16);
      v20 = s;
      v22 = 0;
      v19 = 0xF3;
      color = 0xF2;
      v3 = 0;
    }
    if ( Unknown_03 == 0xFFFFFFFF )
    {
      v9 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xC);    // 12: "Extinct"
      sprintf(s, v9);
      v20 = s;
      v19 = 0xF3;
      v22 = 0;
    }
    if ( !v22 )
    {
      if ( v3 == 0xFFFFFFFF )
      {
        VFX_pane_wipe((PANE *)(result + 4), color);
        v15 = color;
        v10 = v19;
        v11 = (PANE *)(result + 4);
      }
      else
      {
        v10 = v19;
        v11 = (PANE *)(result + 4);
        v15 = 0xFF;
      }
      WinMgr.LargeFont.pane = *v11;
      sub_2B8A8(&WinMgr.LargeFont, 0, 0, v20, 0x43, v10, v15, 0);
    }
    if ( v23 )
    {
      v12 = *(__int16 *)(result + 0xAB);
      if ( v12 != V_RaceIndex && v22 != 0xFFFFFFFF )
      {
        Q_WINMGR_CPP_sub_53E38((PANE *)(result + 4), 0xE, 3, v12);
        v13 = 0xFFFFFFFF;
        if ( !Unknown_03 )
        {
          if ( v23 == 3 )
          {
            v13 = 9;
          }
          else if ( v23 == 2 )
          {
            v13 = 8;
          }
        }
        if ( v13 != 0xFFFFFFFF )
        {
          ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF2);
          VFX_shape_draw((PANE *)(result + 4), ShapeTable_sub_1B084, v13, 0xE, 3);
        }
      }
    }
    sub_552CC(&WinMgr, (PANE *)(result + 4));
  }
}

//----- (00025FB4) --------------------------------------------------------
int __fastcall sub_25FB4(int result)
{
  if ( *(_DWORD *)(result + 0x39) )
  {
    return (*(int (**)(void))(*(_DWORD *)(result + 0xA7) + 0xC))();
  }
  return result;
}

//----- (00026000) --------------------------------------------------------
unsigned int __fastcall sub_26000(int a1, __int16 a2, __int16 a3, LONG a4)
{
  WORD v5; // ax
  unsigned int result; // eax
  LONG v7; // ecx
  LONG v8; // edx
  LONG v9; // ebx
  int v10; // eax
  int v11; // [esp-4h] [ebp-14h]

  switch ( a2 )
  {
    case 1:
      v5 = *(char *)(a1 + 0x25) - 0x31;
      *(_WORD *)(a1 + 0xAB) = v5;
      if ( v5 < V_Game.racesNum )
      {
        goto LABEL_10;
      }
      result = 0;
      break;
    case 2:
      *(_DWORD *)(a1 + 0x39) = 0;
      v7 = *(_DWORD *)(a1 + 0x10);
      v8 = *(_DWORD *)(a1 + 8);
      v11 = *(_DWORD *)(a1 + 0x14);
      v9 = *(_DWORD *)(a1 + 0xC);
      *(_DWORD *)(a1 + 0x35) = 0;
      sub_55214(&WinMgr, v8, v9, v7, v11);
      result = 0;
      break;
    case 4:
    case 5:
      v10 = *(__int16 *)(a1 + 0xAB);
      if ( V_Game.races[V_RaceIndex].Unknown_1C0[v10] && v10 != V_RaceIndex && V_Game.races[v10].Unknown_03 != 0xFFFFFFFF )
      {
        byte_968DD = *(_BYTE *)(a1 + 0xAB);
        goto LABEL_10;
      }
      result = 0;
      break;
    case 6:
      goto LABEL_13;
    case 7:
      (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0x10))();
      result = 0xFFFFFFFF;
      break;
    case 0xB:
      *(_WORD *)(a1 + 0xAB) = a3;
LABEL_13:
      (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
      result = 0xFFFFFFFF;
      break;
    case 0xD:
      (*(void (__fastcall **)(int, _DWORD, __int16, LONG))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0, a3, a4);
      result = sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
      break;
    default:
LABEL_10:
      result = sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
      break;
  }
  return result;
}
// 968DD: using guessed type char byte_968DD;

//----- (00026140) --------------------------------------------------------
void sub_26140()
{
  Q_Ret_sub_1B66C();
}

//----- (00026150) --------------------------------------------------------
char *__fastcall sub_26150(char *result)
{
  sub_1B4F0((P_Wnd9RW1)(result + 0x1E));
  return result;
}

//----- (00026160) --------------------------------------------------------
int Q_StopSystems_sub_26160()
{
  Q_StopMouse_sub_2632C();
  Q_StopVideoSystem_sub_2C6CC(&V_Type6_stru_D8654);
  Q_StopSoundSystem_sub_4FE8C(&V_SoundSystem);
  return printf("\n%s\n\n", "Thank you for playing Ascendancy.");
}

//----- (00026194) --------------------------------------------------------
void Q_debugbreak_sub_26194()
{
  __debugbreak();
}

//----- (00026198) --------------------------------------------------------
void __fastcall __noreturn Q_AssertLogBreakExit_sub_26198(int ignore, const char *sourcefile, int line)
{
  if ( !ignore )
  {
    sprintf("Thank you for playing Ascendancy.", "Assert Failed: <%s> Line %d\n\n", sourcefile, line);
    Q_debugbreak_exit_sub_2624C();
  }
  JUMPOUT(0x26195);
}
// 2619A: control flows out of bounds to 26195

//----- (000261A8) --------------------------------------------------------
void __fastcall Q_AssertLogBreakExit_sub_261A8(int ignore, const char *sourcefile, int line)
{
  if ( !ignore )
  {
    sprintf("Thank you for playing Ascendancy.", "Assert Failed: <%s> Line %d\n\n", sourcefile, line);
    Q_debugbreak_exit_sub_2624C();
  }
  JUMPOUT(0x26195);
}
// 261AA: control flows out of bounds to 26195

//----- (000261B8) --------------------------------------------------------
int __fastcall sub_261B8(int result, const char *a2, int a3)
{
  int v3; // kr04_4
  int v4; // kr0C_4
  char v5; // al
  char v6; // al
  _WORD v7[132]; // [esp+0h] [ebp-108h] BYREF

  if ( !result )
  {
    v3 = 0;
    v4 = 0;
    do
    {
      v5 = s[2 * v3];
      LOBYTE(v7[v4]) = v5;
      if ( !v5 )
      {
        break;
      }
      v6 = s[2 * v3 + 1];
      HIBYTE(v7[v4]) = v6;
      ++v3;
      ++v4;
    }
    while ( v6 );
    sprintf("Thank you for playing Ascendancy.", "Assert Failed: <%s> Line %d\n\n%s\n", a2, a3, (const char *)v7);
    Q_debugbreak_exit_sub_2624C();
  }
  return result;
}

//----- (0002620C) --------------------------------------------------------
__int64 __cdecl sub_2620C(char *format, char a2)
{
  char *v3; // [esp+0h] [ebp-Ch] BYREF

  v3 = &a2;
  return (unsigned int)vsprintf("Thank you for playing Ascendancy.", format, &v3);
}

//----- (0002624C) --------------------------------------------------------
void __noreturn Q_debugbreak_exit_sub_2624C()
{
  Q_debugbreak_sub_26194();
  exit(1);
}

//----- (0002625C) --------------------------------------------------------
void __fastcall __spoils<edx,ebx> Q_RegisterData_sub_2625C(void *aData, int a2, char *name)
{
  if ( aData )
  {
    Q_WINMGR_CPP_sub_5A094(&WinMgr, aData, a2, name);
  }
}

//----- (0002627C) --------------------------------------------------------
void __fastcall sub_2627C(void *pdata)
{
  Q_WINMGR_CPP_sub_5A144(&WinMgr, pdata);
}

//----- (0002628C) --------------------------------------------------------
void *__fastcall Q_Allocate_sub_2628C(size_t a1, int a2, char *a3)
{
  void *result; // eax
  void *v4; // esi

  result = malloc(a1);
  v4 = result;
  if ( result )
  {
    Q_WINMGR_CPP_sub_5A094(&WinMgr, result, a2, a3);
    return v4;
  }
  return result;
}

//----- (000262B0) --------------------------------------------------------
void *__fastcall sub_262B0(size_t num, size_t size, int a3, char *name)
{
  void *result; // eax
  void *v5; // esi

  result = calloc(num, size);
  v5 = result;
  if ( result )
  {
    Q_WINMGR_CPP_sub_5A094(&WinMgr, result, a3, name);
    return v5;
  }
  return result;
}

//----- (000262CC) --------------------------------------------------------
void __fastcall sub_262CC(void *ptr)
{
  Q_WINMGR_CPP_sub_5A144(&WinMgr, ptr);
  free(ptr);
}

//----- (000262F0) --------------------------------------------------------
void sub_262F0()
{
  _wcpp_2_mod_register_(&dword_96768);
  sub_26314();
  dword_96770 = 1;
}
// 96768: using guessed type _DWORD dword_96768;
// 96770: using guessed type int dword_96770;

//----- (00026314) --------------------------------------------------------
void sub_26314()
{
  ;
}

//----- (0002631C) --------------------------------------------------------
void sub_2631C()
{
  Q_StopMouse_sub_2632C();
}

//----- (0002632C) --------------------------------------------------------
void Q_StopMouse_sub_2632C()
{
  if ( V_Mouse.initialized )
  {
    MOUSE_shutdown();
  }
  else
  {
    Q_Null_sub_26328();
  }
}

//----- (0002633C) --------------------------------------------------------
int Q_StartMouse_sub_2633C()
{
  V_Mouse.initialized = MOUSE_init(640, 480);
  return (V_Mouse.initialized == 0) - 1;
}

//----- (00026360) --------------------------------------------------------
void __fastcall Q_ProcessKeyboard_sub_26360()
{
  WORD v0; // ax
  bool v1; // zf
  int v2; // eax

  HIBYTE(v0) = 2;
  __asm { int     16h; KEYBOARD - GET SHIFT STATUS }
  V_Keyboard.Flags = v0;
  if ( (v0 & 1) != 0 || (v0 & 2) != 0 )
  {
    V_Keyboard.Shift = 0xFFFFFFFF;
  }
  else
  {
    V_Keyboard.Shift = 0;
  }
  V_Keyboard.Ctrl = ((v0 & 4) == 0) - 1;
  V_Keyboard.Alt = ((v0 & 8) == 0) - 1;
  V_Keyboard.ScrollLock = ((v0 & 0x10) == 0) - 1;
  V_Keyboard.NumLock = ((v0 & 0x20) == 0) - 1;
  V_Keyboard.CapsLock = ((v0 & 0x40) == 0) - 1;
  v2 = ((v0 & 0x80) == 0) - 1;
  v1 = v2 == 0;
  V_Keyboard.Insert = v2;
  BYTE1(v2) = 1;
  __asm { int     16h; KEYBOARD - CHECK BUFFER, DO NOT CLEAR }
  if ( v1 )
  {
    LOWORD(v2) = 0;
  }
  if ( (_WORD)v2 )
  {
    __asm { int     16h; KEYBOARD - READ CHAR FROM BUFFER, WAIT IF EMPTY }
    V_Keyboard.ASCIIChar = (unsigned __int8)v2;
    V_Keyboard.Pressed = TRUE;
    V_Keyboard.ScanCode = 0;
  }
  else
  {
    V_Keyboard.Pressed = 0;
  }
}
// 2637B: variable 'v0' is possibly undefined

//----- (000264B4) --------------------------------------------------------
void __fastcall Q_ProcessMouse_sub_264B4()
{
  LONG mx; // [esp+0h] [ebp-2Ch] BYREF
  LONG my; // [esp+4h] [ebp-28h] BYREF
  LONG ml; // [esp+8h] [ebp-24h] BYREF
  LONG mr; // [esp+Ch] [ebp-20h] BYREF
  LONG mc; // [esp+10h] [ebp-1Ch] BYREF

  MOUSE_status(&mx, &my, &ml, &mr, &mc);
  if ( mx == V_Mouse.x && my == V_Mouse.y )
  {
    V_Mouse.moved = 0;
  }
  else
  {
    V_Mouse.x = mx;
    V_Mouse.moved = TRUE;
    V_Mouse.y = my;
  }
  if ( ml == V_Mouse.left )
  {
    V_Mouse.leftClicked = 0;
  }
  else
  {
    V_Mouse.left = ml;
    V_Mouse.leftClicked = TRUE;
  }
  if ( mr == V_Mouse.right )
  {
    V_Mouse.rightClicked = 0;
  }
  else
  {
    V_Mouse.right = mr;
    V_Mouse.rightClicked = TRUE;
  }
}

//----- (0002656C) --------------------------------------------------------
int __fastcall Q_ProcessInput_sub_2656C()
{
  V_Mouse.leftClicked = 0;
  V_Mouse.rightClicked = 0;
  V_Mouse.moved = 0;
  V_Keyboard.Pressed = 0;
  Q_ProcessKeyboard_sub_26360();
  if ( V_Mouse.initialized )
  {
    Q_ProcessMouse_sub_264B4();
  }
  return Q_GameLoop_dword_96774;
}
// 96774: using guessed type int Q_GameLoop_dword_96774;

//----- (000265A8) --------------------------------------------------------
void __fastcall sub_265A8(int a1)
{
  unsigned __int16 v1; // dx
  LONG v2; // edx
  LONG v3; // eax
  __int16 v4; // dx
  WORD v5; // dx

  V_Mouse.moved = 0;
  V_Mouse.leftClicked = 0;
  V_Mouse.rightClicked = 0;
  V_Keyboard.Pressed = 0;
  v1 = *(_WORD *)(a1 + 8);
  if ( v1 < 2u )
  {
    if ( v1 == 1 )
    {
      v2 = *(_DWORD *)(a1 + 0xC);
      v3 = *(_DWORD *)(a1 + 0x10);
      V_Mouse.x = v2;
      V_Mouse.y = v3;
      MOUSE_force_move(v2, v3);
      V_Mouse.moved = 0xFFFFFFFF;
    }
  }
  else if ( v1 <= 2u )
  {
    if ( *(_DWORD *)(a1 + 0xC) )
    {
      V_Mouse.right = *(_DWORD *)(a1 + 0x10);
      V_Mouse.rightClicked = 0xFFFFFFFF;
    }
    else
    {
      V_Mouse.left = *(_DWORD *)(a1 + 0x10);
      v4 = *(_WORD *)(a1 + 0xA);
      V_Mouse.leftClicked = 0xFFFFFFFF;
      if ( v4 && V_Mouse.left )
      {
        V_Keyboard.Shift = 0xFFFFFFFF;
      }
      else
      {
        V_Keyboard.Shift = 0;
      }
    }
  }
  else if ( v1 == 3 )
  {
    V_Keyboard.Flags = *(_WORD *)(a1 + 0xA);
    v5 = *(_WORD *)(a1 + 0xC);
    V_Keyboard.ASCIIChar = *(_WORD *)(a1 + 0x10);
    V_Keyboard.ScanCode = v5;
    V_Keyboard.Pressed = 0xFFFFFFFF;
    if ( (V_Keyboard.Flags & 1) != 0 || (V_Keyboard.Flags & 2) != 0 )
    {
      V_Keyboard.Shift = 0xFFFFFFFF;
    }
    else
    {
      V_Keyboard.Shift = 0;
    }
    V_Keyboard.Ctrl = ((V_Keyboard.Flags & 4) == 0) - 1;
    V_Keyboard.Alt = ((V_Keyboard.Flags & 8) == 0) - 1;
    V_Keyboard.ScrollLock = ((V_Keyboard.Flags & 0x10) == 0) - 1;
    V_Keyboard.NumLock = ((V_Keyboard.Flags & 0x20) == 0) - 1;
    V_Keyboard.CapsLock = ((V_Keyboard.Flags & 0x40) == 0) - 1;
    if ( (V_Keyboard.Flags & 0x80) != 0 )
    {
      V_Keyboard.Insert = 0xFFFFFFFF;
    }
    else
    {
      V_Keyboard.Insert = 0;
    }
  }
}

//----- (000267A0) --------------------------------------------------------
void __fastcall __spoils<> Q_Wnd23EWCtor_sub_267A0(P_Wnd23EW a1)
{
  Q_A2_sub_2FC50(&a1->a2);
  a1->a2.procs = &Wnd23EW_Procs;
  Q_WndEW_sub_26800(a1);
}

//----- (000267BC) --------------------------------------------------------
void __fastcall __spoils<> Q_Wnd23EWDtor_sub_267BC(P_Wnd23EW a1, char a2)
{
  char *v2; // eax
  T_TypeA2 *v3; // eax

  if ( (a2 & 4) != 0 )
  {
    v2 = _wcpp_2_dtor_array_store_(a1, &C_Wnd23EW);
    operator delete[](v2);
  }
  else
  {
    a1->a2.procs = &Wnd23EW_Procs;
    v3 = sub_2FC68(&a1->a2, 1);
    if ( (a2 & 2) != 0 )
    {
      operator delete(v3);
    }
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (00026800) --------------------------------------------------------
void __fastcall __spoils<> Q_WndEW_sub_26800(P_Wnd23EW result)
{
  result->pGameEvent = 0;
}

//----- (00026874) --------------------------------------------------------
void __fastcall sub_26874(P_Wnd23EW a1, P_GameEvent pGameEvent)
{
  int v3; // kr04_4
  int v4; // kr08_4
  int v5; // kr10_4
  char v6; // al
  char v7; // al
  P_GameEvent pGameEvent_; // ebx
  void *p1; // edx
  _WORD *p2; // esi
  WORD eventId; // kr00_2
  char *v12; // eax
  char *v13; // eax
  unsigned __int8 v14; // bl
  P_GameEvent v15; // ebx
  _WORD *v16; // edx
  char *v17; // ebx
  char *v18; // esi
  char *v19; // ebx
  P_GameEvent v20; // eax
  char *v21; // esi
  int v22; // edx
  int v23; // eax
  int v24; // eax
  char *v25; // eax
  char *v26; // edx
  P_GameEvent v27; // edi
  char *v28; // esi
  void *v29; // edi
  char *v30; // esi
  _DWORD *v31; // edi
  int v32; // eax
  char *v33; // edx
  __int16 v34; // bx
  char *v35; // eax
  char *v36; // edx
  __int16 v37; // ax
  P_GameEvent v38; // eax
  void *v39; // edx
  char *v40; // eax
  char *v41; // ebx
  UBYTE v42; // al
  _WORD *v43; // ecx
  __int16 v44; // ax
  char *v45; // edx
  char *v46; // edx
  char *v47; // edx
  UBYTE v48; // al
  int v49; // [esp-8h] [ebp-298h]
  char *sub_1CEA8; // [esp-4h] [ebp-294h]
  char format[600]; // [esp+0h] [ebp-290h] BYREF
  char s[32]; // [esp+258h] [ebp-38h] BYREF
  int v53; // [esp+27Ch] [ebp-14h]
  char *Unknown_C95; // [esp+280h] [ebp-10h]
  _WORD *v55; // [esp+284h] [ebp-Ch]
  int v56; // [esp+288h] [ebp-8h]
  char *Unknown_CB0; // [esp+28Ch] [ebp-4h]

  if ( !pGameEvent )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x48);
  }
  a1->pGameEvent = pGameEvent;
  sprintf(s, "event%02d", pGameEvent->eventId);
  Q_ShowHelpTopic_sub_2FCB0((P_Wnd20HW)a1, "help.txt", s);
  Unknown_C95 = a1->Unknown_C95;
  Unknown_CB0 = a1->Unknown_CB0;
  if ( a1->Unknown_C95[0] != 1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x55);
  }
  if ( *(int *)a1->Unknown_DA3 > 1 && *Unknown_CB0 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x57);
  }
  v3 = *(_DWORD *)(Unknown_C95 + 5);
  v4 = 0;
  v5 = 0;
  do
  {
    v6 = *(_BYTE *)(v3 + 2 * v4);
    format[2 * v5] = v6;
    if ( !v6 )
    {
      break;
    }
    v7 = *(_BYTE *)(v3 + 2 * v4 + 1);
    format[2 * v5 + 1] = v7;
    ++v4;
    ++v5;
  }
  while ( v7 );
  pGameEvent_ = a1->pGameEvent;
  p1 = pGameEvent_->p1;
  p2 = pGameEvent_->p2;
  eventId = pGameEvent_->eventId;
  v56 = (int)p1 + 0x24;
  v55 = p2 + 0x12;
  v53 = 5 * (_DWORD)p1;
  switch ( eventId )
  {
    case ASCEND_EP_00_NEW_DISCOVERY:
      sprintf(*(char **)(Unknown_C95 + 5), format, V_SpecNames[V_Game.races[V_RaceIndex].Unknown_01], &V_ResTree.items[(_DWORD)p1]);
      v12 = Unknown_CB0;
      *(_WORD *)(Unknown_CB0 + 1) = 0x1F;
      *(_WORD *)(v12 + 3) = (_WORD)p1;
      break;
    case ASCEND_EP_01_CONSTRUCTION_COMPLETE:
      v14 = (unsigned __int8)pGameEvent_->p2;
      sprintf(
        *(char **)(Unknown_C95 + 5),
        format,
        V_PlanetItems.item[v14].name,
        v56,
        v56,
        *((unsigned __int16 *)p1 + 0x21) - *((unsigned __int16 *)p1 + 0x26));
      *(_WORD *)(Unknown_CB0 + 1) = 0x1E;
      *(_WORD *)(Unknown_CB0 + 3) = v14;
      *(_WORD *)&a1->Unknown_CB0[0x1C] = 0x1D;
      *(_WORD *)&a1->Unknown_CB0[0x1E] = *((_WORD *)p1 + 0xA) + 5 * *((_WORD *)p1 + 0xB);
      break;
    case ASCEND_EP_02_WOULD_LIKE_TO_SPEAK:
      v34 = (__int16)pGameEvent_->p1;
      sprintf(*(char **)(Unknown_C95 + 5), format, V_SpecNames[V_Game.races[v34].Unknown_01]);
      v35 = Unknown_CB0;
      *(_WORD *)(Unknown_CB0 + 3) = 0;
      *(_WORD *)(v35 + 1) = v34;
      break;
    case ASCEND_EP_SHIPARRIVE:
    case ASCEND_EP_FINDRACE:
    case ASCEND_EP_HOSTILESHIP:
    case ASCEND_EP_HOSTILEPLAN:
    case ASCEND_EP_OTHERWAR:
    case ASCEND_EP_20_DISCOVERED_SYSTEM:
      v20 = a1->pGameEvent;
      v21 = (char *)v20->p1;
      if ( v21[0x58] != 4 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0xB3);
      }
      v22 = *(_DWORD *)(v21 + 0x59);
      if ( a1->pGameEvent->eventId == 0x14 )
      {
        if ( *(_WORD *)(v22 + 0x44) == 1 )
        {
          v23 = 0xD;                                   // 13: ""
        }
        else
        {
          v23 = 0xE;                                   // 14: "s"
        }
        sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v23);
        v49 = *(__int16 *)(v22 + 0x44);
        if ( *(_WORD *)(v22 + 0x5A) == 1 )
        {
          v24 = 0xD;                                   // 13: ""
        }
        else
        {
          v24 = 0xE;                                   // 14: "s"
        }
        v25 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v24);
        sprintf(*(char **)(Unknown_C95 + 5), format, v21 + 0x34, v22 + 0x1C, *(__int16 *)(v22 + 0x5A), v25, v49, sub_1CEA8);
      }
      else
      {
        sprintf(*(char **)(Unknown_C95 + 5), format, v21 + 0x34, v22 + 0x1C, V_SpecNames[V_Game.races[(int)v20->p2].Unknown_01]);
      }
      v26 = Unknown_CB0;
      *(_WORD *)(Unknown_CB0 + 1) = V_RaceIndex + 0xE;
      *(_WORD *)(v26 + 3) = v21[0xAA];
      break;
    case ASCEND_EP_RACEFINDUS:
    case ASCEND_EP_BADSHIPENTERS:
      v27 = a1->pGameEvent;
      v28 = (char *)v27->p1;
      v29 = v27->p2;
      if ( v28[0x58] != 4 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0xCD);
      }
      if ( a1->pGameEvent->eventId == 9 )
      {
        sprintf(*(char **)(Unknown_C95 + 5), format, V_SpecNames[V_Game.races[(_DWORD)v29].Unknown_01], *(_DWORD *)(v28 + 0x59) + 0x1C);
      }
      else
      {
        sprintf(*(char **)(Unknown_C95 + 5), format, *(_DWORD *)(v28 + 0x59) + 0x1C);
      }
      *(_WORD *)(Unknown_CB0 + 1) = (_WORD)v29 + 0xE;
      *(_WORD *)(Unknown_CB0 + 3) = v28[0xAA];
      break;
    case ASCEND_EP_SPECIESEXTINCT:
      sprintf(*(char **)(Unknown_C95 + 5), format, V_SpecNames[V_Game.races[(_DWORD)p1].Unknown_01]);
      v36 = Unknown_CB0;
      v37 = (__int16)a1->pGameEvent->p1;
      *(_WORD *)(Unknown_CB0 + 3) = 0;
      *(_WORD *)(v36 + 1) = v37;
      break;
    case ASCEND_EP_SCRAPNEWESTSHIP:
    case ASCEND_EP_SHIPDESTROYED:
      v38 = a1->pGameEvent;
      v39 = v38->p1;
      v40 = (char *)v38->p2;
      if ( v40 )
      {
        sprintf(*(char **)(Unknown_C95 + 5), format, v40 + 0x1C);
      }
      v41 = Unknown_CB0;
      v42 = V_RaceIndex;
      *(_WORD *)(Unknown_CB0 + 3) = (_WORD)v39;
      *(_WORD *)(v41 + 1) = v42 + 0xE;
      break;
    case ASCEND_EP_COLONYINVADED:
      v43 = p1;
      if ( !p1 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x114);
      }
      sprintf(*(char **)(Unknown_C95 + 5), format, (char *)p1 + 0x24, V_SpecNames[V_Game.races[*((unsigned __int8 *)p1 + 0x57)].Unknown_01]);
      v44 = sub_1B270(&WinMgr.t13, "data\\planets.shp", 0);
      v45 = Unknown_CB0;
      *(_WORD *)(Unknown_CB0 + 1) = v44;
      if ( *(unsigned __int16 *)(v45 + 1) == 0xFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x118);
      }
      *(_WORD *)(Unknown_CB0 + 3) = 5 * v43[0xB] + v43[0xA];
      break;
    case ASCEND_EP_15_HAS_FREE_POPULATION:
      sprintf(*(char **)(Unknown_C95 + 5), format, v56);
      *(_WORD *)(Unknown_CB0 + 1) = 0x1D;
      *(_WORD *)(Unknown_CB0 + 3) = 5 * *((_WORD *)p1 + 0xB) + *((_WORD *)p1 + 0xA);
      *(_WORD *)&a1->Unknown_CB0[0x1C] = 0x2C;
      *(_WORD *)&a1->Unknown_CB0[0x1E] = 2;
      break;
    case ASCEND_EP_16_ENTERED_ORBIT:
      sprintf(*(char **)(Unknown_C95 + 5), format, (char *)p1 + 0x34, v55);
      v19 = Unknown_CB0;
      *(_WORD *)(Unknown_CB0 + 1) = V_RaceIndex + 0xE;
      *(_WORD *)(v19 + 3) = *((char *)p1 + 0xAA);
      *(_WORD *)&a1->Unknown_CB0[0x1C] = 0x1D;
      *(_WORD *)&a1->Unknown_CB0[0x1E] = p2[0xA] + 5 * p2[0xB];
      break;
    case ASCEND_EP_17_SHIP_COMPLETE:
    case ASCEND_EP_18_REFIT_COMPLETE:
      v15 = a1->pGameEvent;
      v16 = v15->p2;
      v17 = (char *)v15->p1;
      sprintf(
        *(char **)(Unknown_C95 + 5),
        format,
        v17 + 0x34,
        v16 + 0x12,
        v16 + 0x12,
        (unsigned __int16)v16[0x21] - (unsigned __int16)v16[0x26]);
      v18 = Unknown_CB0;
      *(_WORD *)(Unknown_CB0 + 1) = V_RaceIndex + 0xE;
      *(_WORD *)(v18 + 3) = v17[0xAA];
      *(_WORD *)&a1->Unknown_CB0[0x1C] = 0x1D;
      *(_WORD *)&a1->Unknown_CB0[0x1E] = v16[0xA] + 5 * v16[0xB];
      break;
    case ASCEND_EP_19_REMAINING_MOVES:
      sprintf(*(char **)(Unknown_C95 + 5), format, (char *)p1 + 0x1C);
      break;
    case ASCEND_EP_21_ALL_TECH_FOR_SHIP:
      v46 = Unknown_CB0;
      sprintf(*(char **)(Unknown_C95 + 5), format, V_SpecNames[V_Game.races[V_RaceIndex].Unknown_01]);
      *(_WORD *)(v46 + 3) = 0;
      *(_WORD *)(v46 + 1) = V_RaceIndex;
      break;
    case ASCEND_EP_22_XENO_COMPLETE:
      sprintf(*(char **)(Unknown_C95 + 5), format, V_SpecNames[V_Game.races[V_RaceIndex].Unknown_01], v55, &V_ResTree.items[(_DWORD)p1]);
      v13 = Unknown_CB0;
      *(_WORD *)(Unknown_CB0 + 1) = 0x1F;
      *(_WORD *)(v13 + 3) = (_WORD)p1;
      *(_WORD *)&a1->Unknown_CB0[0x1C] = 0x1D;
      *(_WORD *)&a1->Unknown_CB0[0x1E] = p2[0xA] + 5 * p2[0xB];
      break;
    case ASCEND_EP_23_LANE_TRANSMISION:
      v30 = (char *)p1;
      if ( *((_BYTE *)p1 + 0x58) != 5 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0xE0);
      }
      v31 = *(_DWORD **)((char *)p1 + 0x59);
      if ( !v31 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0xE3);
      }
      v32 = *v31;
      if ( ((1 << V_RaceIndex) & *(unsigned __int8 *)(*v31 + 0x17)) == 0 )
      {
        v32 = v31[1];
      }
      sprintf(*(char **)(Unknown_C95 + 5), format, (char *)p1 + 0x34, v32 + 0x1C);
      v33 = Unknown_CB0;
      *(_WORD *)(Unknown_CB0 + 1) = V_RaceIndex + 0xE;
      *(_WORD *)(v33 + 3) = v30[0xAA];
      break;
    case ASCEND_EP_25_FIRST_LAB:
      sprintf(*(char **)(Unknown_C95 + 5), format, V_SpecNames[V_Game.races[V_RaceIndex].Unknown_01]);
      v47 = Unknown_CB0;
      v48 = V_RaceIndex;
      *(_WORD *)(Unknown_CB0 + 3) = 0;
      *(_WORD *)(v47 + 1) = v48;
      break;
    default:
      return;
  }
}
// 26D02: conditional instruction was optimized away because bh.1!=4
// 26874: using guessed type char format[600];

//----- (000270F4) --------------------------------------------------------
unsigned int __fastcall sub_270F4(int a1, __int16 a2, LONG a3, LONG a4)
{
  int v5; // ebx

  if ( !a2 || (unsigned __int16)a2 > 1u )
  {
    return sub_2FD68(a1, a2, a3, a4);
  }
  *(_DWORD *)(a1 + 0x35) = 0xFFFFFFFF;
  v5 = *(_DWORD *)(a1 + 0xA7);
  *(_DWORD *)(a1 + 0x39) = 0xFFFFFFFF;
  (*(void (**)(void))(v5 + 0xC))();
  return 0;
}

//----- (0002712C) --------------------------------------------------------
void __fastcall __spoils<> Q_A2_sub_2712C(T_TypeA2 *a1)
{
  Q_A2Ctor_sub_2C830(a1);
  a1->procs = (P_Procs)off_95C58;
}
// 95C58: using guessed type int (*off_95C58[5])();

//----- (0002713C) --------------------------------------------------------
T_TypeA2 *__fastcall sub_2713C(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_95C18);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95C58;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95C58: using guessed type int (*off_95C58[5])();

//----- (00027184) --------------------------------------------------------
unsigned int __fastcall sub_27184(T_TypeA2 *a1, __int16 a2, LONG a3, LONG a4)
{
  if ( !a2 )
  {
    return sub_2F424(a1, a2, a3, a4);
  }
  if ( (unsigned __int16)a2 <= 1u )
  {
    sub_4F8CC(&V_SoundSystem, V_Game.races[V_RaceIndex].Unknown_01 + 8, 0);
    return sub_2F424(a1, a2, a3, a4);
  }
  if ( a2 != 2 )
  {
    return sub_2F424(a1, a2, a3, a4);
  }
  sub_56B60(&WinMgr, 1, 1, 1);
  return 0xFFFFFFFF;
}

//----- (000271FC) --------------------------------------------------------
__int64 __fastcall sub_271FC(int a1)
{
  int Unknown_01; // ecx
  FILE *v2; // ebp
  char *v3; // esi
  char *v4; // edi
  char v5; // al
  char v6; // al
  char *v7; // esi
  char *v8; // edi
  char v9; // al
  char v10; // al
  char *v11; // esi
  char *v12; // edi
  char v13; // al
  char v14; // al
  char *v15; // esi
  char *v16; // edi
  char v17; // al
  char v18; // al
  char *v19; // esi
  char *v20; // edi
  char v21; // al
  char v22; // al
  char *v23; // esi
  char *v24; // edi
  char v25; // al
  char v26; // al
  char *v27; // ecx
  int v28; // esi
  char v29; // ah
  char v30; // bl
  char *v31; // ecx
  int v32; // esi
  char v33; // al
  char v34; // dh
  void *ShapeTable_sub_1B084; // eax
  UBYTE Unknown_02; // al
  const char *v37; // ecx
  int v38; // esi
  UBYTE v39; // al
  char v41[1004]; // [esp+0h] [ebp-624h] BYREF
  char s[204]; // [esp+3ECh] [ebp-238h] BYREF
  char v43[204]; // [esp+4B8h] [ebp-16Ch] BYREF
  char s1[60]; // [esp+584h] [ebp-A0h] BYREF
  PANE v45; // [esp+5C0h] [ebp-64h] BYREF
  int v46; // [esp+5D4h] [ebp-50h]
  char *v47; // [esp+5D8h] [ebp-4Ch]
  int v48; // [esp+5DCh] [ebp-48h]
  int v49; // [esp+5E0h] [ebp-44h] BYREF
  int v50; // [esp+5E4h] [ebp-40h]
  int v51; // [esp+5E8h] [ebp-3Ch]
  int v52; // [esp+5ECh] [ebp-38h]
  int v53; // [esp+5F0h] [ebp-34h]
  int v54; // [esp+5F4h] [ebp-30h]
  int v55; // [esp+5F8h] [ebp-2Ch]
  int v56; // [esp+5FCh] [ebp-28h]
  int v57; // [esp+600h] [ebp-24h]
  char *v58; // [esp+604h] [ebp-20h]
  int v59; // [esp+608h] [ebp-1Ch]
  int v60; // [esp+60Ch] [ebp-18h]

  v46 = a1;
  Unknown_01 = V_Game.races[V_RaceIndex].Unknown_01;
  v58 = (char *)V_BigBuffer;
  V_BigBuffer[0] = 0;
  v41[0] = 0;
  v2 = Q_OpenFile_sub_1BB10("history.txt", 0);
  if ( !v2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x1C1);
  }
  v51 = 0;
  do
  {
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
    sscanf(s, "%s", s1);
    if ( !stricmp(s1, "SPECNUM") )
    {
      sscanf(s, "%s %d", s1, &v49);
      if ( Unknown_01 == v49 )
      {
        v51 = 1;
      }
    }
    else if ( !stricmp(s1, "END") )
    {
      sub_2620C("Species %d not found in history file.\n", Unknown_01);
      sub_261B8(0, "..\\eventwnd.cpp", 0x1E8);
    }
  }
  while ( !v51 );
  v48 = 0;
  if ( v51 != 2 )
  {
    v47 = V_SpecNames[Unknown_01];
    do
    {
      Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
      sscanf(s, "%s", s1);
      if ( !stricmp(s1, "SPECNUM") || !stricmp(s1, "END") )
      {
        v51 = 2;
      }
      else if ( !stricmp(s1, "POWER") )
      {
        v53 = 0;
        v56 = 0;
        sprintf(v43, "%s: ", v47);
        do
        {
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
          if ( !strnicmp(s, "ENDPOWER", 8u) )
          {
            v53 = 0xFFFFFFFF;
          }
          else
          {
            v56 += strlen(s);
            if ( v56 >= 0xC4 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x238);
            }
            v3 = s;
            v4 = &v43[strlen(v43)];
            do
            {
              v5 = *v3;
              *v4 = *v3;
              if ( !v5 )
              {
                break;
              }
              v6 = v3[1];
              v3 += 2;
              v4[1] = v6;
              v4 += 2;
            }
            while ( v6 );
          }
        }
        while ( !v53 );
      }
      else if ( !stricmp(s1, "INTRO") )
      {
        v59 = 0;
        v55 = 0;
        do
        {
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
          if ( !strnicmp(s, "ENDINTRO", 8u) )
          {
            v59 = 0xFFFFFFFF;
            v48 = 0xFFFFFFFF;
          }
          else
          {
            v55 += strlen(s);
            if ( v55 >= 0x3E4 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x24D);
            }
            v7 = s;
            v8 = &v41[strlen(v41)];
            do
            {
              v9 = *v7;
              *v8 = *v7;
              if ( !v9 )
              {
                break;
              }
              v10 = v7[1];
              v7 += 2;
              v8[1] = v10;
              v8 += 2;
            }
            while ( v10 );
          }
        }
        while ( !v59 );
      }
      else if ( !stricmp(s1, "PEACE") && v48 == 0xFFFFFFFF && !V_Game.Unknown_D8A[0x2A] )
      {
        v50 = 0;
        do
        {
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
          if ( !strnicmp(s, "ENDPEACE", 8u) )
          {
            v50 = 0xFFFFFFFF;
          }
          else
          {
            v55 += strlen(s);
            if ( v55 >= 0x3E4 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x25F);
            }
            v11 = s;
            v12 = &v41[strlen(v41)];
            do
            {
              v13 = *v11;
              *v12 = *v11;
              if ( !v13 )
              {
                break;
              }
              v14 = v11[1];
              v11 += 2;
              v12[1] = v14;
              v12 += 2;
            }
            while ( v14 );
          }
        }
        while ( !v50 );
      }
      else if ( !stricmp(s1, "NEUTRAL") && v48 == 0xFFFFFFFF && V_Game.Unknown_D8A[0x2A] == 1 )
      {
        v57 = 0;
        do
        {
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
          if ( !strnicmp(s, "ENDNEUTRAL", 0xAu) )
          {
            v57 = 0xFFFFFFFF;
          }
          else
          {
            v55 += strlen(s);
            if ( v55 >= 0x3E4 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x271);
            }
            v15 = s;
            v16 = &v41[strlen(v41)];
            do
            {
              v17 = *v15;
              *v16 = *v15;
              if ( !v17 )
              {
                break;
              }
              v18 = v15[1];
              v15 += 2;
              v16[1] = v18;
              v16 += 2;
            }
            while ( v18 );
          }
        }
        while ( !v57 );
      }
      else if ( !stricmp(s1, "HOSTILE") && v48 == 0xFFFFFFFF && V_Game.Unknown_D8A[0x2A] == 2 )
      {
        v52 = 0;
        do
        {
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
          if ( !strnicmp(s, "ENDHOSTILE", 0xAu) )
          {
            v52 = 0xFFFFFFFF;
          }
          else
          {
            v55 += strlen(s);
            if ( v55 >= 0x3E4 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x283);
            }
            v19 = s;
            v20 = &v41[strlen(v41)];
            do
            {
              v21 = *v19;
              *v20 = *v19;
              if ( !v21 )
              {
                break;
              }
              v22 = v19[1];
              v19 += 2;
              v20[1] = v22;
              v20 += 2;
            }
            while ( v22 );
          }
        }
        while ( !v52 );
      }
      else if ( !stricmp(s1, "TEXT") )
      {
        v60 = 0;
        v54 = 0;
        do
        {
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
          if ( !strnicmp(s, "ENDTEXT", 7u) )
          {
            v60 = 0xFFFFFFFF;
          }
          else
          {
            v54 += strlen(s);
            if ( v54 >= 0xBB4 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x295);
            }
            v23 = s;
            v24 = &v58[strlen(v58)];
            do
            {
              v25 = *v23;
              *v24 = *v23;
              if ( !v25 )
              {
                break;
              }
              v26 = v23[1];
              v23 += 2;
              v24[1] = v26;
              v24 += 2;
            }
            while ( v26 );
          }
        }
        while ( !v60 );
      }
    }
    while ( v51 != 2 );
  }
  v27 = v41;
  fclose(v2);
  v28 = 0;
  if ( v41[0] )
  {
    while ( 1 )
    {
      if ( v28 >= 0x3E5 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x2AB);
      }
      v29 = *v27;
      if ( *v27 == 0xA )
      {
        break;
      }
      if ( v29 == 0x40 )
      {
        *v27 = 0xA;
      }
      else if ( v29 == 0x5F )
      {
        break;
      }
LABEL_95:
      v30 = *++v27;
      ++v28;
      if ( !v30 )
      {
        goto LABEL_96;
      }
    }
    *v27 = 0x20;
    goto LABEL_95;
  }
LABEL_96:
  if ( !v58 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x2B7);
  }
  v31 = v58;
  v32 = 0;
  if ( *v58 )
  {
    while ( 1 )
    {
      if ( v32 >= 0xBB5 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x2BD);
      }
      v33 = *v31;
      if ( *v31 == 0xA )
      {
        break;
      }
      if ( v33 == 0x40 )
      {
        *v31 = 0xA;
      }
      else if ( v33 == 0x5F )
      {
        break;
      }
LABEL_106:
      v34 = *++v31;
      ++v32;
      if ( !v34 )
      {
        goto LABEL_107;
      }
    }
    *v31 = 0x20;
    goto LABEL_106;
  }
LABEL_107:
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEAE[V_RaceIndex]);
  VFX_shape_draw(&V_Type6_stru_D8654.pane, ShapeTable_sub_1B084, 0, 7, 0x2E);
  v45.window = *(WINDOW **)(v46 + 4);
  v45.x1 = 0x278;
  v45.x0 = 7;
  v45.y0 = 0x105;
  v45.y1 = 0x1D1;
  Unknown_02 = V_Game.races[V_RaceIndex].Unknown_02;
  v37 = v58;
  WinMgr.LargeFont.pane.window = v45.window;
  WinMgr.LargeFont.pane.x0 = 7;
  WinMgr.LargeFont.pane.y0 = v45.y0;
  WinMgr.LargeFont.pane.x1 = v45.x1;
  WinMgr.LargeFont.pane.y1 = v45.y1;
  v38 = v46;
  sub_2B8A8(&WinMgr.LargeFont, 0xA, 0xA, v37, 0, 4 * Unknown_02 + 0x13, 0xFF, 0x257);
  v45.window = *(WINDOW **)(v38 + 4);
  v45.x1 = 0x278;
  v45.y1 = 0xF5;
  v45.x0 = 0x138;
  v45.y0 = 0x2E;
  WinMgr.LargeFont.pane.window = v45.window;
  WinMgr.LargeFont.pane.x0 = 0x138;
  WinMgr.LargeFont.pane.y0 = v45.y0;
  WinMgr.LargeFont.pane.x1 = v45.x1;
  WinMgr.LargeFont.pane.y1 = v45.y1;
  sub_2B8A8(&WinMgr.LargeFont, 0xA, 0xA, v41, 0, 0xF3, 0xFF, 0x126);
  v45.window = *(WINDOW **)(v46 + 4);
  v45.x0 = 7;
  v45.y0 = 7;
  v45.x1 = 0x278;
  v45.y1 = 0x25;
  Q_WINMGR_CPP_sub_53E38(&v45, 3, 3, V_RaceIndex);
  v39 = V_Game.races[V_RaceIndex].Unknown_02;
  WinMgr.LargeFont.pane = v45;
  return (unsigned int)sub_2B8A8(&WinMgr.LargeFont, 0, 0xA, v43, 2, 4 * v39 + 0x13, 0xFF, 0x25A);
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEAE: using guessed type __int16 word_FFEAE[7];
// 271FC: using guessed type char var_624[1004];
// 271FC: using guessed type char var_16C[204];

//----- (00027BF8) --------------------------------------------------------
void __fastcall __spoils<> Q_A2_sub_27BF8(P_TypeA2 a1)
{
  Q_A2Ctor_sub_2C830(a1);
  a1->procs = (P_Procs)off_95C40;
}
// 95C40: using guessed type int (*off_95C40[5])();

//----- (00027C08) --------------------------------------------------------
T_TypeA2 *__fastcall sub_27C08(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_95C04);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95C40;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95C40: using guessed type int (*off_95C40[5])();

//----- (00027C50) --------------------------------------------------------
unsigned int __fastcall sub_27C50(T_TypeA2 *a1, __int16 a2, LONG a3, LONG a4)
{
  __int16 v5; // ax
  char v7[2]; // [esp+0h] [ebp-10h] BYREF
  __int16 v8[7]; // [esp+2h] [ebp-Eh]

  v8[1] = a2;
  if ( a2 != 1 )
  {
    return sub_2F424(a1, v8[1], a3, a4);
  }
  LOBYTE(v8[0]) = 0;
  v7[1] = 0;
  v7[0] = 0;
  sub_2C2F8(&V_Type6_stru_D8654, v7);
  v5 = 5;
  dword_132B64 = 0;
  dword_132B60 = 0xFFFFFFFF;
  if ( V_Game.z7 == 1 )
  {
    v5 = V_Game.races[V_RaceIndex].Unknown_01 + 8;
  }
  sub_4F8CC(&V_SoundSystem, v5, 0);
  return sub_2F424(a1, v8[1], a3, a4);
}
// 132B60: using guessed type int dword_132B60;
// 132B64: using guessed type int dword_132B64;

//----- (00027D18) --------------------------------------------------------
void __fastcall sub_27D18(int a1, int a2, int a3, int a4)
{
  LONG v4; // eax
  FILE *v5; // ebp
  char *v6; // esi
  char *v7; // edi
  char v8; // al
  char v9; // al
  char *v10; // esi
  char *v11; // edi
  char v12; // al
  char v13; // al
  LONG v14; // ebx
  LONG v15; // ecx
  char *v16; // esi
  char *v17; // edi
  char v18; // al
  char v19; // al
  char *v20; // ecx
  char v21; // bh
  char v22; // dl
  char *v23; // ecx
  char v24; // bl
  char v25; // ah
  char *v26; // ecx
  char v27; // dh
  char v28; // al
  void *ShapeTable_sub_1B084; // eax
  UBYTE Unknown_02; // al
  int v31; // ebp
  char *sub_1CEA8; // eax
  UBYTE v33; // al
  UBYTE v34; // al
  const char *v35; // ecx
  void *v36; // eax
  LONG v37; // edi
  int v38; // kr10_4
  int i; // kr2C_4
  LONG v40; // ebx
  void *v41; // eax
  int racesNum; // eax
  void *v43; // eax
  __int16 v44; // bp
  void *v45; // eax
  UBYTE v46; // dl
  int v47; // esi
  int ShipsNum_sub_40224; // eax
  unsigned int v49; // ebp
  int j; // kr1C_4
  int shipsNum; // eax
  int raceIndex; // eax
  LONG v53; // ebx
  int v54; // ecx
  LONG v55; // ecx
  void *v56; // eax
  int v57; // esi
  int PlanetsNum_sub_402E0; // eax
  unsigned int v59; // ebp
  int v60; // kr24_4
  UBYTE v61; // al
  LONG v62; // ebx
  int v63; // ecx
  int v64; // eax
  LONG y0; // edx
  int v66; // ecx
  void *v67; // eax
  LONG v68; // ebp
  int v69; // edi
  LONG v70; // esi
  void *v71; // eax
  LONG hullSize; // [esp-20h] [ebp-378h]
  LONG v73; // [esp-20h] [ebp-378h]
  LONG v74; // [esp-20h] [ebp-378h]
  LONG v75; // [esp-1Ch] [ebp-374h]
  LONG v76; // [esp-18h] [ebp-370h]
  LONG v77; // [esp-18h] [ebp-370h]
  LONG v78; // [esp-Ch] [ebp-364h]
  __int16 v79; // [esp-4h] [ebp-35Ch]
  char v80[204]; // [esp+0h] [ebp-358h] BYREF
  char v81[204]; // [esp+CCh] [ebp-28Ch] BYREF
  char v82[204]; // [esp+198h] [ebp-1C0h] BYREF
  char s1[60]; // [esp+264h] [ebp-F4h] BYREF
  PANE pane; // [esp+2A0h] [ebp-B8h] BYREF
  char s[16]; // [esp+2B4h] [ebp-A4h] BYREF
  T_Ship *v86; // [esp+2C4h] [ebp-94h]
  int v87; // [esp+2C8h] [ebp-90h]
  int aa2; // [esp+2CCh] [ebp-8Ch]
  LONG shape_number; // [esp+2D0h] [ebp-88h]
  int assert; // [esp+2D4h] [ebp-84h]
  int v91; // [esp+2D8h] [ebp-80h]
  int v92; // [esp+2DCh] [ebp-7Ch]
  LONG v93; // [esp+2E0h] [ebp-78h]
  int v94; // [esp+2E4h] [ebp-74h]
  int v95; // [esp+2E8h] [ebp-70h]
  int v96; // [esp+2ECh] [ebp-6Ch]
  int v97; // [esp+2F0h] [ebp-68h]
  int v98; // [esp+2F4h] [ebp-64h]
  int v99; // [esp+2F8h] [ebp-60h]
  int v100; // [esp+2FCh] [ebp-5Ch]
  int v101; // [esp+300h] [ebp-58h]
  int v102; // [esp+304h] [ebp-54h]
  int v103; // [esp+308h] [ebp-50h]
  int v104; // [esp+30Ch] [ebp-4Ch]
  int v105; // [esp+310h] [ebp-48h]
  T_Planet *v106; // [esp+314h] [ebp-44h]
  int v107; // [esp+318h] [ebp-40h]
  int v108; // [esp+31Ch] [ebp-3Ch]
  PANE *v109; // [esp+320h] [ebp-38h]
  unsigned int v110; // [esp+324h] [ebp-34h]
  int v111; // [esp+328h] [ebp-30h]
  LONG hotX; // [esp+32Ch] [ebp-2Ch]
  int v113; // [esp+330h] [ebp-28h]
  int v114; // [esp+334h] [ebp-24h]
  int v115; // [esp+338h] [ebp-20h]
  int v116; // [esp+33Ch] [ebp-1Ch]
  int v117; // [esp+340h] [ebp-18h]

  v87 = a1;
  aa2 = V_Game.aa2;
  v4 = V_Game.aa2 / 0xA - 1;
  shape_number = v4;
  if ( v4 >= 0 )
  {
    if ( v4 > 9 )
    {
      shape_number = 9;
    }
  }
  else
  {
    shape_number = 0;
  }
  V_BigBuffer[0] = 0;
  assert = (int)V_BigBuffer;
  switch ( V_Game.z7 )
  {
    case 1:
      sprintf(s, "end-xtnc.txt");
      break;
    case 2:
      sprintf(s, "end-dest.txt");
      break;
    case 3:
      sprintf(s, "end-capt.txt");
      break;
    case 4:
      sprintf(s, "end-unit.txt");
      break;
    case 5:
      sprintf(s, "end-ctrl.txt");
      break;
    default:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\eventwnd.cpp", 0x34E);
      break;
  }
  v5 = Q_OpenFile_sub_1BB10(s, 0);
  if ( !v5 )
  {
    sub_2620C("Couldn't open %s", (char)s);
    sub_261B8(0, "..\\eventwnd.cpp", 0x370);
  }
  v80[0] = 0;
  v92 = 0;
  do
  {
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v5, v82);
    sscanf(v82, "%s", s1);
    if ( !stricmp(s1, "END") )
    {
      v92 = 0xFFFFFFFF;
    }
    else if ( !stricmp(s1, "ENDDESC") )
    {
      v100 = 0;
      v101 = 0;
      do
      {
        Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v5, v82);
        if ( !strnicmp(v82, "ENDTEXT", 7u) )
        {
          v100 = 0xFFFFFFFF;
        }
        else
        {
          v101 += strlen(v82);
          if ( v101 >= 0xC4 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x3A1);
          }
          v6 = v82;
          v7 = &v80[strlen(v80)];
          do
          {
            v8 = *v6;
            *v7 = *v6;
            if ( !v8 )
            {
              break;
            }
            v9 = v6[1];
            v6 += 2;
            v7[1] = v9;
            v7 += 2;
          }
          while ( v9 );
        }
      }
      while ( !v100 );
    }
    else if ( !stricmp(s1, "CONGRAT") )
    {
      v102 = 0;
      v103 = 0;
      do
      {
        Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v5, v82);
        if ( !strnicmp(v82, "ENDTEXT", 7u) )
        {
          v102 = 0xFFFFFFFF;
        }
        else
        {
          v103 += strlen(v82);
          if ( v103 >= 0x3E4 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x3B3);
          }
          v10 = v82;
          v11 = (char *)(assert + strlen((const char *)assert));
          do
          {
            v12 = *v10;
            *v11 = *v10;
            if ( !v12 )
            {
              break;
            }
            v13 = v10[1];
            v10 += 2;
            v11[1] = v13;
            v11 += 2;
          }
          while ( v13 );
        }
      }
      while ( !v102 );
    }
    else if ( !stricmp(s1, "RANKS") )
    {
      v14 = 0;
      if ( shape_number > 0 )
      {
        v15 = shape_number;
        do
        {
          ++v14;
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v5, v82);
        }
        while ( v14 < v15 );
      }
      v16 = v82;
      Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v5, v82);
      v81[0] = 0;
      v17 = &v81[strlen(v81)];
      do
      {
        v18 = *v16;
        *v17 = *v16;
        if ( !v18 )
        {
          break;
        }
        v19 = v16[1];
        v16 += 2;
        v17[1] = v19;
        v17 += 2;
      }
      while ( v19 );
    }
  }
  while ( v92 != 0xFFFFFFFF );
  v20 = v80;
  fclose(v5);
  v93 = 0;
  if ( v80[0] )
  {
    while ( 1 )
    {
      if ( v93 >= 0xC5 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x3D7);
      }
      v21 = *v20;
      if ( *v20 == 0xA )
      {
        break;
      }
      if ( v21 == 0x40 )
      {
        *v20 = 0xA;
      }
      else if ( v21 == 0x5F )
      {
        break;
      }
LABEL_55:
      v22 = *++v20;
      ++v93;
      if ( !v22 )
      {
        goto LABEL_56;
      }
    }
    *v20 = 0x20;
    goto LABEL_55;
  }
LABEL_56:
  v93 = 0;
  v23 = v81;
  if ( v81[0] )
  {
    while ( 1 )
    {
      if ( v93 >= 0xC5 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x3E9);
      }
      v24 = *v23;
      if ( *v23 == 0xA )
      {
        break;
      }
      if ( v24 == 0x40 )
      {
        *v23 = 0xA;
      }
      else if ( v24 == 0x5F )
      {
        break;
      }
LABEL_64:
      v25 = *++v23;
      ++v93;
      if ( !v25 )
      {
        goto LABEL_65;
      }
    }
    *v23 = 0x20;
    goto LABEL_64;
  }
LABEL_65:
  if ( !assert )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x3F5);
  }
  v26 = (char *)assert;
  v93 = 0;
  if ( *(_BYTE *)assert )
  {
    while ( 1 )
    {
      if ( v93 >= 0x3E5 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x3FB);
      }
      v27 = *v26;
      if ( *v26 == 0xA )
      {
        break;
      }
      if ( v27 == 0x40 )
      {
        *v26 = 0xA;
      }
      else if ( v27 == 0x5F )
      {
        break;
      }
LABEL_75:
      v28 = *++v26;
      ++v93;
      if ( !v28 )
      {
        goto LABEL_76;
      }
    }
    *v26 = 0x20;
    goto LABEL_75;
  }
LABEL_76:
  pane.window = *(WINDOW **)(v87 + 4);
  pane.x0 = 7;
  pane.y0 = 0xD7;
  pane.x1 = 0x12F;
  pane.y1 = 0x17D;
  if ( V_Game.z7 != 1 )
  {
    v78 = shape_number;
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF6);
    VFX_shape_draw(&pane, ShapeTable_sub_1B084, v78, 0x94, 0x53);
  }
  pane.x1 = 0x12F;
  pane.x0 = 7;
  pane.y0 = 0xD7;
  pane.y1 = 0x107;
  sprintf(v82, "%s", v80);
  Unknown_02 = V_Game.races[V_RaceIndex].Unknown_02;
  v31 = aa2;
  WinMgr.LargeFont.pane = pane;
  sub_2B8A8(&WinMgr.LargeFont, 0xE, 0, v82, 1, 4 * Unknown_02 + 0x13, 0xFF, 0x118);
  pane.x1 = 0x12F;
  pane.y1 = 0x17D;
  pane.x0 = 7;
  pane.y0 = 0x14D;
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xF); // 15: "Your score is %d%%.\nThis gives you the title of %s"
  sprintf(v82, sub_1CEA8, v31, v81);
  v33 = V_Game.races[V_RaceIndex].Unknown_02;
  WinMgr.LargeFont.pane = pane;
  sub_2B8A8(&WinMgr.LargeFont, 0, 0, v82, 3, 4 * v33 + 0x13, 0xFF, 0x118);
  pane.x1 = 0x278;
  pane.x0 = 7;
  pane.y0 = 0x18D;
  pane.y1 = 0x1D1;
  v34 = V_Game.races[V_RaceIndex].Unknown_02;
  v35 = (const char *)assert;
  WinMgr.LargeFont.pane.window = pane.window;
  WinMgr.LargeFont.pane.x0 = 7;
  WinMgr.LargeFont.pane.y0 = pane.y0;
  WinMgr.LargeFont.pane.x1 = pane.x1;
  WinMgr.LargeFont.pane.y1 = pane.y1;
  sub_2B8A8(&WinMgr.LargeFont, 7, 0, v35, 1, 4 * v34 + 0x13, 0xFF, 0x25A);
  v36 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEAE[V_RaceIndex]);
  v37 = 0x2A;
  VFX_shape_draw(&V_Type6_stru_D8654.pane, v36, 0, 7, 7);
  v93 = 1;
  v110 = 2;
  Q_WINMGR_CPP_sub_53E38((PANE *)(v87 + 4), 0xA, 0xA, V_RaceIndex);
  v38 = 0;
  for ( i = 0; ; ++i )
  {
    racesNum = V_Game.racesNum;
    if ( V_Game.racesNum <= v93 )
    {
      break;
    }
    if ( v93 == 4 )
    {
      v37 = 0x85;
    }
    v43 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEA0[v110 / 2]);
    VFX_shape_transform(&V_Type6_stru_D8654.pane, v43, 0, 0x3E * v38 + 0x15B, v37, V_BigBuffer, 0, 0x8000, 0x8000, 0);
    v44 = v93;
    v79 = v93;
    v45 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF2);
    sub_53EB8(&V_Type6_stru_D8654.pane, v45, 3, 0x3E * v38 + 0x15B, v37, v79);
    Q_WINMGR_CPP_sub_53E38(&V_Type6_stru_D8654.pane, 0x3E * v38 + 0x154, v37 + 0x21, v44);
    v46 = V_Game.races[V_RaceIndex].Unknown_1C0[v93];
    v40 = 0xFFFFFFFF;
    if ( v46 == 3 )
    {
      v40 = 9;
    }
    else if ( v46 == 2 )
    {
      v40 = 8;
    }
    if ( v40 != 0xFFFFFFFF )
    {
      v41 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF2);
      VFX_shape_draw(&V_Type6_stru_D8654.pane, v41, v40, 0x3E * v38 + 0x154, v37 + 0x21);
    }
    ++v93;
    ++v38;
  }
  v94 = 0x278;
  LOWORD(racesNum) = word_FFEBC[V_RaceIndex];
  pane.x0 = 0x138;
  v116 = racesNum;
  pane.y0 = 7;
  pane.x1 = 0x278;
  pane.y1 = 0x17D;
  v47 = 7;
  ShipsNum_sub_40224 = Q_Race_GetShipsNum_sub_40224(&V_Game.races[V_RaceIndex], 0, 0);
  v95 = ShipsNum_sub_40224;
  if ( ShipsNum_sub_40224 < 0x14 )
  {
    v47 = 7 - 7 * (0x14 - ShipsNum_sub_40224) / 0x11;
  }
  if ( v47 >= 0 )
  {
    if ( v47 > 6 )
    {
      v47 = 6;
    }
  }
  else
  {
    v47 = 0;
  }
  v96 = v95 / (v47 + 1);
  v97 = 0;
  v99 = 0x9F;
  v98 = v94 - 0x212;
  if ( v94 - 0x212 < 2 )
  {
    v98 = 2;
  }
  v93 = 0;
  v91 = 0x208;
  v104 = 0x11;
  v49 = 0xFFFFFF00 * v47 + 0x700;
  for ( j = 0; ; ++j )
  {
    shipsNum = V_Game.shipsNum;
    if ( V_Game.shipsNum <= v93 )
    {
      break;
    }
    raceIndex = V_Game.ships[j].raceIndex;
    v86 = &V_Game.ships[j];
    if ( raceIndex == V_RaceIndex )
    {
      v53 = 0;
      if ( v97 > v96 && v47 > 0 )
      {
        v49 += 0x100;
        --v47;
      }
      if ( v47 > 0 )
      {
        VFX_shape_lookaside(&(*V_Type6_stru_D8654.hazeTables)[0][v49]);
        v53 = 1;
      }
      v54 = v91 - pane.x0;
      v55 = rand() % v98 + v54;
      hotX = v104 - pane.y0;
      v76 = hotX + rand() % v99;
      hullSize = v86->hullSize;
      v56 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v116);
      VFX_shape_transform(&pane, v56, hullSize, v55, v76, V_BigBuffer, 0, 0x5555, 0x5555, v53);
    }
    ++v93;
    ++v97;
  }
  LOWORD(shipsNum) = word_FFEDA;
  v117 = shipsNum;
  v113 = 0x1FF;
  v57 = 7;
  PlanetsNum_sub_402E0 = Q_Race_GetPlanetsNum_sub_402E0(&V_Game.races[V_RaceIndex]);
  if ( PlanetsNum_sub_402E0 < 0x14 )
  {
    v57 = 7 - 7 * (0x14 - PlanetsNum_sub_402E0) / 0x11;
  }
  if ( v57 >= 0 )
  {
    if ( v57 > 6 )
    {
      v57 = 6;
    }
  }
  else
  {
    v57 = 0;
  }
  v114 = v95 / (v57 + 1);
  v111 = v113 - 0x14C;
  v115 = 0;
  v105 = 0x97;
  if ( v113 - 0x14C < 2 )
  {
    v111 = 2;
  }
  v93 = 0;
  v107 = 0x142;
  v108 = 0xDC;
  v59 = 0xFFFFFF00 * v57 + 0x700;
  v60 = 0;
  while ( V_Game.planetsNum > v93 )
  {
    v61 = V_Game.planets[v60].raceIndex;
    v106 = &V_Game.planets[v60];
    if ( v61 == V_RaceIndex )
    {
      v62 = 0;
      if ( v115 > v114 && v57 > 0 )
      {
        v59 += 0x100;
        --v57;
      }
      if ( v57 > 0 )
      {
        VFX_shape_lookaside(&(*V_Type6_stru_D8654.hazeTables)[0][v59]);
        v62 = 1;
      }
      v63 = v107 - pane.x0;
      v64 = rand();
      y0 = pane.y0;
      hotX = v64 % v111 + v63;
      v66 = v108;
      v77 = v66 - y0 + rand() % v105;
      v75 = hotX;
      v73 = 5 * v106->type + v106->size;
      v67 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v117);
      VFX_shape_transform(&pane, v67, v73, v75, v77, V_BigBuffer, 0, 0x5555, 0x5555, v62);
    }
    ++v93;
    ++v115;
    ++v60;
  }
  v68 = 0xCB;
  v69 = 0;
  v93 = 0;
  v70 = 0x213;
  v109 = (PANE *)(v87 + 4);
  while ( V_ResTree.num > v93 )
  {
    if ( v93 && !(v93 % 6) )
    {
      v70 = 0x213;
      v68 += 0x11;
    }
    if ( ((1 << V_RaceIndex) & V_ResTree.items[v69].Unknown_48) != 0 )
    {
      v74 = v93;
      v71 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEDE);
      VFX_shape_transform(v109, v71, v74, v70, v68, V_BigBuffer, 0, 0x5555, 0x5555, 0);
    }
    v70 += 0x11;
    ++v69;
    ++v93;
  }
  sub_552CC(&WinMgr, &V_Type6_stru_D8654.pane);
}
// 28784: conditional instruction was optimized away because %var_60.4==9F
// 289D7: conditional instruction was optimized away because %var_48.4==97
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEA0: using guessed type __int16 word_FFEA0[7];
// FFEAE: using guessed type __int16 word_FFEAE[7];
// FFEBC: using guessed type __int16 word_FFEBC[7];
// 27D18: using guessed type char var_358[204];
// 27D18: using guessed type char var_28C[204];

//----- (00028C40) --------------------------------------------------------
void __cdecl callback_fn()
{
  dword_D8650 = 0xFFFFFFFF;
}
// D8650: using guessed type int dword_D8650;

//----- (00028C4C) --------------------------------------------------------
int __fastcall sub_28C4C(__int16 *a1, __int16 *a2)
{
  return *a1 - *a2;
}

//----- (00028C58) --------------------------------------------------------
int __fastcall Q_NC_sub_28C58(int result, __int16 a2)
{
  __int16 v2; // cx

  v2 = *(_WORD *)(result + 6);
  *(_WORD *)(result + 2) += a2;
  *(_WORD *)(result + 6) = a2 + v2;
  return result;
}

//----- (00028C74) --------------------------------------------------------
void __fastcall __spoils<> sub_28C74(P_Type2 a1)
{
  Q_InitFileInfo_sub_1BB78(&a1->a);
  sub_2B2C0(&a1->font);
  a1->dword198 = 0;
  a1->dword1A8 = 0;
  a1->dword1AC = 0;
  a1->dword1B0 = 0;
  a1->dword1B4 = 0;
  a1->dword19C = 0xFFFFFFFF;
  memset(a1->char118, 0, sizeof(a1->char118));
  a1->dword1E4 = 0;
  a1->dword1E8 = 0;
  a1->dword1EC = 0;
  a1->dword1F0 = 0;
  *(_DWORD *)&a1->word932 = 0;
  memset(a1->char204, 0, sizeof(a1->char204));
  memset(a1->char808, 0, sizeof(a1->char808));
  a1->word804 = 0;
  a1->word806 = 0;
  a1->word908 = 0;
  a1->Unknown_90E[1] = 0;
  a1->Unknown_90E[2] = 0;
  a1->Unknown_90E[3] = 0xFFFFFFFF;
  a1->dword1E0 = 0x12;
  a1->Unknown_90E[4] = 0;
  a1->Unknown_90E[5] = 0xFFFFFFFF;
  a1->dword92E = 0;
}

//----- (00028DA4) --------------------------------------------------------
void __fastcall __spoils<> sub_28DA4(P_Type2 a1)
{
  int v2; // ebx
  int v3; // kr04_4
  int v4; // ebx
  int v5; // kr0C_4

  if ( a1->dword1B0 == 0xFFFFFFFF )
  {
    sub_2627C((void *)a1->dword1AC);
  }
  operator delete((void *)a1->dword1AC);
  if ( a1->dword1B4 == 0xFFFFFFFF )
  {
    sub_2627C((void *)a1->dword198);
    operator delete((void *)a1->dword198);
    sub_2627C((void *)a1->dword1A8);
    operator delete((void *)a1->dword1A8);
  }
  v2 = 0;
  v3 = 0;
  while ( v2 < (__int16)a1->word908 )
  {
    sub_2627C(*(void **)&a1->char808[8 * v3]);
    ++v2;
    ++v3;
  }
  operator delete(*(void **)a1->char808);
  v4 = 0;
  v5 = 0;
  while ( v4 < (__int16)a1->word806 )
  {
    if ( *(_WORD *)&a1->char204[0xC * v5 + 2] == 0xA )
    {
      sub_2627C(*(void **)&a1->char204[0xC * v5 + 8]);
      operator delete(*(void **)&a1->char204[0xC * v5 + 8]);
      *(_DWORD *)&a1->char204[0xC * v5 + 8] = 0;
    }
    ++v4;
    ++v5;
  }
  if ( a1->Unknown_90E[1] )
  {
    sub_2627C((void *)a1->Unknown_90E[1]);
  }
  operator delete((void *)a1->Unknown_90E[1]);
  sub_2AD08(a1);
  sub_2B2E0(&a1->font);
  Q_CloseFileAndDelete_sub_1BBC8(&a1->a);
}
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (00028EB4) --------------------------------------------------------
UBYTE *__fastcall sub_28EB4(int a1, const char *a2, int a3, int a4, int a5)
{
  UBYTE *result; // eax
  int v7; // eax
  int v8; // eax
  int v9; // eax

  if ( !a2 )
  {
    return 0;
  }
  sub_2A1DC(a1, "SUBTITLE.TXT");
  if ( Q_OpenFile_sub_1BBFC((P_FileInfo)a1, a2, 0x200, 0) )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0xE9);
    return 0;
  }
  if ( Q_ReadFile_sub_1BF94((P_FileInfo)a1, (void *)(a1 + 0x118), 0x80u) == 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0xE3);
    return 0;
  }
  if ( *(unsigned __int16 *)(a1 + 0x11C) != 0xAF12 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0xEF);
    return 0;
  }
  if ( a4 == 0xFFFFFFFF )
  {
    v7 = (0x280 - *(unsigned __int16 *)(a1 + 0x120)) / 2;
  }
  else
  {
    v7 = a4;
  }
  *(_DWORD *)(a1 + 0x1A0) = v7;
  if ( a5 == 0xFFFFFFFF )
  {
    v8 = (0x1E0 - *(unsigned __int16 *)(a1 + 0x122)) / 2;
  }
  else
  {
    v8 = a5;
  }
  *(_DWORD *)(a1 + 0x1BC) = 0x27F;
  *(_DWORD *)(a1 + 0x1C0) = 0x1DF;
  *(_DWORD *)(a1 + 0x1A4) = v8;
  *(_DWORD *)(a1 + 0x1CC) = a1 + 0x1B8;
  if ( a3 )
  {
    *(_DWORD *)(a1 + 0x1B0) = 0;
    *(_DWORD *)(a1 + 0x1AC) = a3;
  }
  else
  {
    result = V_Type6_stru_D8654.window.buffer;
    *(_DWORD *)(a1 + 0x1AC) = V_Type6_stru_D8654.window.buffer;
    if ( !result )
    {
      return result;
    }
    *(_DWORD *)(a1 + 0x1B0) = 0;
  }
  *(_DWORD *)(a1 + 0x1C4) = 0;
  v9 = *(_DWORD *)(a1 + 0x1AC);
  *(_DWORD *)(a1 + 0x1C8) = 0;
  *(_DWORD *)(a1 + 0x1B8) = v9;
  return (UBYTE *)0xFFFFFFFF;
}

//----- (00029038) --------------------------------------------------------
int __fastcall sub_29038(int a1, size_t a2, unsigned int a3, int a4, int a5, int a6)
{
  int v8; // edi
  int v9; // edx
  void *v10; // eax
  int v12; // eax
  size_t v13; // eax
  int v14; // edx
  int v15; // ebp
  int v16; // eax

  v8 = a3;
  *(_WORD *)(a1 + 0x804) = 0;
  *(_WORD *)(a1 + 0x92A) = 0;
  *(_DWORD *)(a1 + 0x942) = 0;
  *(_WORD *)(a1 + 0x92C) = 0;
  if ( a2 < a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x15E);
  }
  if ( a2 - a4 < a3 )
  {
    v8 = a2 - a4;
  }
  v9 = *(_DWORD *)(a1 + 0x1B4);
  *(_DWORD *)(a1 + 0x19C) = 0xFFFFFFFF;
  if ( v9 == 0xFFFFFFFF )
  {
    sub_2627C(*(void **)(a1 + 0x198));
    operator delete[](*(void **)(a1 + 0x198));
    sub_2627C(*(void **)(a1 + 0x1A8));
    operator delete[](*(void **)(a1 + 0x1A8));
    *(_DWORD *)(a1 + 0x198) = 0;
    *(_DWORD *)(a1 + 0x1A8) = 0;
    *(_DWORD *)(a1 + 0x1B4) = 0;
  }
  if ( a6 )
  {
    *(_DWORD *)(a1 + 0x1E8) = a6;
  }
  if ( *(_DWORD *)(a1 + 0x1E8)
    || (v10 = operator new[](a2), Q_RegisterData_sub_2625C(v10, 1, "FLIC BUFFER"), (*(_DWORD *)(a1 + 0x1E8) = v10) != 0) )
  {
    v12 = *(_DWORD *)(a1 + 0x1E8);
    *(_DWORD *)(a1 + 0x1F4) = a2;
    v13 = a2 + v12;
    v14 = *(_DWORD *)(a1 + 0x168);
    *(_DWORD *)(a1 + 0x1EC) = v13;
    *(_DWORD *)(a1 + 0x1F0) = v13 - a4;
    v15 = *(_DWORD *)(a1 + 0x1F0) - v8;
    *(_DWORD *)(a1 + 0x1FC) = a5;
    *(_DWORD *)(a1 + 0x1E4) = v15;
    sub_1BECC((int *)a1, v14, 0);
    *(_DWORD *)(a1 + 0x200) = ((int)sub_1BFD4((int *)a1, *(void **)(a1 + 0x1E4), v8, 0x40u, (int)sub_2BCF4) >= v8) - 1;
    VFX_area_wipe(0, 0, 639, 479, 0);
    v16 = *(_DWORD *)(a1 + 0x1E4);
    *(_DWORD *)(a1 + 0x198) = v16;
    *(_DWORD *)(a1 + 0x1A8) = v16 + 0x10;
    *(_DWORD *)(a1 + 0x1E4) = *(_DWORD *)(a1 + 0x1E8);
    *(_DWORD *)(a1 + 0x1F8) = *(_DWORD *)(a1 + 0x198) - *(_DWORD *)(a1 + 0x1E4);
    return 0xFFFFFFFF;
  }
  else
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0x183);
    return 0;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);

//----- (000291F8) --------------------------------------------------------
unsigned int __fastcall Q_NC_sub_291F8(int a1)
{
  int v2; // edx
  int v4; // edi
  _DWORD *v5; // edi
  int v6; // ebp
  int v7; // kr04_4
  unsigned __int16 v8; // ax

  v2 = *(_DWORD *)(a1 + 0x19C) + 1;
  *(_DWORD *)(a1 + 0x19C) = v2;
  if ( v2 )
  {
    if ( *(unsigned __int16 *)(a1 + 0x11E) >= *(int *)(a1 + 0x19C) )
    {
      goto LABEL_6;
    }
    v2 = *(_DWORD *)(a1 + 0x16C);
    *(_DWORD *)(a1 + 0x19C) = 1;
  }
  else
  {
    v2 = *(_DWORD *)(a1 + 0x168);
  }
  sub_1BECC((int *)a1, v2, 0);
LABEL_6:
  if ( Q_ReadFile_sub_1BF94((P_FileInfo)a1, *(void **)(a1 + 0x198), 0x10u) == 0xFFFFFFFF )
  {
    return 0;
  }
  v4 = **(_DWORD **)(a1 + 0x198) - 0x10;
  if ( v4 < 0 || v4 > 0x4B000 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x1DD);
  }
  Q_ReadFile_sub_1BF94((P_FileInfo)a1, *(void **)(a1 + 0x1A8), **(_DWORD **)(a1 + 0x198) - 0x10);
  if ( *(unsigned __int16 *)(*(_DWORD *)(a1 + 0x198) + 4) != 0xF1FA )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x1E0);
  }
  v5 = *(_DWORD **)(a1 + 0x1A8);
  v6 = 0;
  v7 = 0;
  while ( v6 < *(unsigned __int16 *)(*(_DWORD *)(a1 + 0x198) + 6) )
  {
    v5 = (_DWORD *)((char *)v5 + *v5);
    v8 = *(_WORD *)(v2 + 6 * v7++ + 4);
    if ( v8 < 0xFu )
    {
      if ( v8 < 4u )
      {
        goto LABEL_18;
      }
      if ( v8 <= 4u )
      {
        sub_29C6C(a1, (_WORD *)(v2 + 6 * v7));
      }
      else
      {
        if ( v8 != 7 )
        {
LABEL_18:
          Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x221);
        }
        sub_2AD40((unsigned __int16 *)(v2 + 6 * v7), *(_DWORD *)(a1 + 0x1A0), *(_DWORD *)(a1 + 0x1A4));
      }
    }
    else if ( v8 <= 0xFu )
    {
      sub_29D54(a1, (unsigned __int8 *)(v2 + 6 * v7));
    }
    else if ( v8 <= 0x10u )
    {
      sub_29F58(a1, (const void *)(v2 + 6 * v7));
    }
    else if ( v8 != 0x12 )
    {
      goto LABEL_18;
    }
    ++v6;
  }
  return 0xFFFFFFFF;
}

//----- (0002936C) --------------------------------------------------------
unsigned int __fastcall Q_NC_sub_2936C(int a1)
{
  int v2; // ebx
  int v4; // esi
  int i; // edi
  unsigned __int16 *v6; // edx
  unsigned __int16 v7; // ax
  unsigned __int16 v8; // ax
  _DWORD *v9; // esi
  _DWORD *v10; // esi
  _BYTE *v11; // edi
  int v12; // edx
  void *v13; // edi
  signed int v14; // ecx
  int v15; // ecx
  int v16; // edx
  int v17; // esi
  int v18; // edx
  unsigned int v19; // ebx
  unsigned int v20; // eax

  v2 = ++*(_DWORD *)(a1 + 0x19C);
  if ( *(unsigned __int16 *)(a1 + 0x11E) <= v2 )
  {
    return 0;
  }
  if ( !v2 )
  {
    VFX_area_wipe(0, 0, 0x27F, 0x1DF, *(_DWORD *)(a1 + 0x926));
  }
  if ( *(_DWORD *)(a1 + 0x946) == 0xFFFFFFFF )
  {
    sub_29B24((_DWORD *)a1);
  }
  if ( *(unsigned __int16 *)(*(_DWORD *)(a1 + 0x198) + 4) != 0xF1FA )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x246);
  }
  v4 = *(_DWORD *)(a1 + 0x1A8);
  for ( i = 0; i < *(unsigned __int16 *)(*(_DWORD *)(a1 + 0x198) + 6); ++i )
  {
    v6 = (unsigned __int16 *)(v4 + 6);
    v7 = *(_WORD *)(v4 + 4);
    v4 += *(_DWORD *)v4;
    if ( v7 < 0xFu )
    {
      if ( v7 < 4u )
      {
        goto LABEL_14;
      }
      if ( v7 <= 4u )
      {
        sub_29C6C(a1, v6);
      }
      else
      {
        if ( v7 != 7 )
        {
LABEL_14:
          Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x26C);
        }
        sub_2AD40(v6, *(_DWORD *)(a1 + 0x1A0), *(_DWORD *)(a1 + 0x1A4));
      }
    }
    else if ( v7 <= 0xFu )
    {
      sub_29D54(a1, (unsigned __int8 *)v6);
    }
    else if ( v7 <= 0x10u )
    {
      sub_29F58(a1, v6);
    }
    else if ( v7 != 0x12 )
    {
      goto LABEL_14;
    }
  }
  v8 = *(_WORD *)(a1 + 0x92A);
  if ( v8 )
  {
    if ( v8 <= 1u )
    {
      sub_2C4C0(&V_Type6_stru_D8654, *(__int16 *)(a1 + 0x932), *(__int16 *)(a1 + 0x934));
    }
    else if ( v8 == 2 )
    {
      sub_2C418(&V_Type6_stru_D8654, *(__int16 *)(a1 + 0x932), *(_WORD *)(a1 + 0x934));
    }
  }
  if ( *(__int16 *)(a1 + 0xC * *(__int16 *)(a1 + 0x804) + 0x204) == *(_DWORD *)(a1 + 0x19C) )
  {
    sub_2AA88(a1);
  }
  v9 = *(_DWORD **)(a1 + 0x198);
  *(_DWORD *)(a1 + 0x1F8) += *v9;
  v10 = (_DWORD *)((char *)v9 + *v9);
  v11 = *(_BYTE **)(a1 + 0x1F0);
  *(_DWORD *)(a1 + 0x198) = v10;
  if ( v10 < (_DWORD *)v11 )
  {
    v12 = (char *)(v10 + 4) - v11;
    if ( v12 <= 0 )
    {
      v14 = (char *)v10 + *v10 - v11;
      if ( v14 <= 0 )
      {
        goto LABEL_42;
      }
      if ( v14 >= *(_DWORD *)(a1 + 0x1EC) - (int)v11 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x2D2);
      }
      v13 = *(void **)(a1 + 0x1F0);
    }
    else
    {
      qmemcpy(v11, *(const void **)(a1 + 0x1E8), (char *)(v10 + 4) - v11);
      v13 = v10 + 4;
      v14 = **(_DWORD **)(a1 + 0x198) - 0x10;
    }
    qmemcpy(v13, (const void *)(v12 + *(_DWORD *)(a1 + 0x1E8)), v14);
    goto LABEL_42;
  }
  *(_DWORD *)(a1 + 0x198) = (char *)v10 + *(_DWORD *)(a1 + 0x1E8) - v11;
LABEL_42:
  v15 = *(_DWORD *)(a1 + 0x200);
  *(_DWORD *)(a1 + 0x1A8) = *(_DWORD *)(a1 + 0x198) + 0x10;
  if ( !v15 )
  {
    if ( *(_DWORD *)(a1 + 0x1F8) < *(_DWORD *)(a1 + 0x1FC) )
    {
      v16 = *(_DWORD *)(a1 + 0x1F8);
    }
    else
    {
      v16 = *(_DWORD *)(a1 + 0x1FC);
    }
    v17 = v16;
    if ( v16 + *(_DWORD *)(a1 + 0x1E4) - *(_DWORD *)(a1 + 0x1F0) > 0 )
    {
      v17 = *(_DWORD *)(a1 + 0x1F0) - *(_DWORD *)(a1 + 0x1E4);
    }
    if ( Q_ReadFile_sub_1BF94((P_FileInfo)a1, *(void **)(a1 + 0x1E4), v17) < v17 )
    {
      *(_DWORD *)(a1 + 0x200) = 0xFFFFFFFF;
    }
    v18 = *(_DWORD *)(a1 + 0x1F8);
    v19 = *(_DWORD *)(a1 + 0x1F0);
    *(_DWORD *)(a1 + 0x1E4) += v17;
    v20 = *(_DWORD *)(a1 + 0x1E4);
    *(_DWORD *)(a1 + 0x1F8) = v18 - v17;
    if ( v20 >= v19 )
    {
      *(_DWORD *)(a1 + 0x1E4) = *(_DWORD *)(a1 + 0x1E8);
    }
  }
  if ( (unsigned int)(*(_DWORD *)(a1 + 0x1EC) + **(_DWORD **)(a1 + 0x198) + *(_DWORD *)(a1 + 0x1F8) - *(_DWORD *)(a1 + 0x1F0)) >= *(_DWORD *)(a1 + 0x1F4) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x305);
  }
  return 0xFFFFFFFF;
}

//----- (000296B4) --------------------------------------------------------
unsigned int __fastcall sub_296B4(int a1, int a2, int a3, int a4)
{
  int v5; // edx
  int v7; // eax
  _DWORD *v8; // esi
  int v9; // edi
  int v10; // kr04_4
  unsigned __int16 v11; // ax
  unsigned __int16 v12; // ax
  unsigned int v13; // esi
  unsigned int v14; // edx
  int v15; // edx
  void *v16; // edi
  signed int v17; // ecx
  signed int *v18; // esi
  int v19; // edx
  int v20; // esi
  int v21; // edi
  unsigned int v22; // edx
  unsigned int v23; // eax
  int v24; // esi
  int v25; // edx
  int v26; // ecx
  int v27; // ecx
  unsigned int v28; // esi
  unsigned int v29; // eax

  if ( dword_D8650 )
  {
    if ( *(_DWORD *)(a1 + 0x946) == 0xFFFFFFFF )
    {
      sub_29B24((_DWORD *)a1);
    }
    if ( dword_D8650 != 0xFFFFFFFF && *(_DWORD *)(a1 + 0x93A) != 0xFFFFFFFF )
    {
      goto LABEL_54;
    }
    if ( !*(_DWORD *)(a1 + 0x93A) )
    {
      _disable();
      dword_D8650 = 0;
      _enable();
    }
    v5 = *(_DWORD *)(a1 + 0x19C) + 1;
    *(_DWORD *)(a1 + 0x19C) = v5;
    if ( !v5 )
    {
      VFX_area_wipe(0, 0, 639, 479, *(_DWORD *)(a1 + 0x926));
    }
    if ( *(unsigned __int16 *)(a1 + 0x11E) <= *(int *)(a1 + 0x19C) )
    {
      return 0;
    }
    v7 = *(unsigned __int16 *)(*(_DWORD *)(a1 + 0x198) + 4);
    ++dword_A0CF8;
    if ( v7 != 0xF1FA )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x32E);
    }
    v8 = *(_DWORD **)(a1 + 0x1A8);
    v9 = 0;
    v10 = 0;
    while ( v9 < *(unsigned __int16 *)(*(_DWORD *)(a1 + 0x198) + 6) )
    {
      v8 = (_DWORD *)((char *)v8 + *v8);
      v11 = *(_WORD *)(v5 + 6 * v10++ + 4);
      if ( v11 < 0xFu )
      {
        if ( v11 < 4u )
        {
          goto LABEL_19;
        }
        if ( v11 <= 4u )
        {
          *(_WORD *)(a1 + 0x92C) = 0;
          sub_29C6C(a1, (_WORD *)(v5 + 6 * v10));
        }
        else
        {
          if ( v11 != 7 )
          {
LABEL_19:
            Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x355);
          }
          sub_2AD40((unsigned __int16 *)(v5 + 6 * v10), *(_DWORD *)(a1 + 0x1A0), *(_DWORD *)(a1 + 0x1A4));
        }
      }
      else if ( v11 <= 0xFu )
      {
        sub_29D54(a1, (unsigned __int8 *)(v5 + 6 * v10));
      }
      else if ( v11 <= 0x10u )
      {
        sub_29F58(a1, (const void *)(v5 + 6 * v10));
      }
      else if ( v11 != 0x12 )
      {
        goto LABEL_19;
      }
      ++v9;
    }
    v12 = *(_WORD *)(a1 + 0x92A);
    if ( v12 )
    {
      if ( v12 <= 1u )
      {
        sub_2C4C0(&V_Type6_stru_D8654, *(__int16 *)(a1 + 0x932), *(__int16 *)(a1 + 0x934));
      }
      else if ( v12 == 2 )
      {
        sub_2C418(&V_Type6_stru_D8654, *(__int16 *)(a1 + 0x932), *(_WORD *)(a1 + 0x934));
      }
    }
    if ( *(__int16 *)(a1 + 0xC * *(__int16 *)(a1 + 0x804) + 0x204) == *(_DWORD *)(a1 + 0x19C) )
    {
      sub_2AA88(a1);
    }
    if ( *(_WORD *)(a1 + 0x92C) )
    {
      Q_FadePalette_sub_2C5E4(&V_Type6_stru_D8654, *(_BYTE *)(a1 + 0x92C) - 1);
      if ( (__int16)++*(_WORD *)(a1 + 0x92C) > 0x40 )
      {
        *(_WORD *)(a1 + 0x92C) = 0;
      }
    }
    if ( *(_DWORD *)(a1 + 0x93A) == 0xFFFFFFFF && *(_DWORD *)(a1 + 0x93E) == *(_DWORD *)(a1 + 0x19C) )
    {
      getch();
      *(_DWORD *)(a1 + 0x93A) = 0;
      *(_DWORD *)(a1 + 0x93E) = 0xFFFFFFFF;
    }
    *(_DWORD *)(a1 + 0x1F8) += **(_DWORD **)(a1 + 0x198);
    v13 = **(_DWORD **)(a1 + 0x198) + *(_DWORD *)(a1 + 0x198);
    v14 = *(_DWORD *)(a1 + 0x1F0);
    *(_DWORD *)(a1 + 0x198) = v13;
    if ( v13 >= v14 )
    {
      *(_DWORD *)(a1 + 0x198) = *(_DWORD *)(a1 + 0x1E8) + v13 - v14;
LABEL_53:
      *(_DWORD *)(a1 + 0x1A8) = *(_DWORD *)(a1 + 0x198) + 0x10;
LABEL_54:
      if ( !*(_DWORD *)(a1 + 0x200) )
      {
        if ( *(_DWORD *)(a1 + 0x1F8) < *(_DWORD *)(a1 + 0x1FC) )
        {
          v19 = *(_DWORD *)(a1 + 0x1F8);
        }
        else
        {
          v19 = *(_DWORD *)(a1 + 0x1FC);
        }
        v20 = v19;
        if ( v19 + *(_DWORD *)(a1 + 0x1E4) - *(_DWORD *)(a1 + 0x1F0) > 0 )
        {
          v20 = *(_DWORD *)(a1 + 0x1F0) - *(_DWORD *)(a1 + 0x1E4);
        }
        if ( Q_ReadFile_sub_1BF94((P_FileInfo)a1, *(void **)(a1 + 0x1E4), v20) < v20 )
        {
          *(_DWORD *)(a1 + 0x200) = 0xFFFFFFFF;
        }
        v21 = *(_DWORD *)(a1 + 0x1F8);
        v22 = *(_DWORD *)(a1 + 0x1F0);
        *(_DWORD *)(a1 + 0x1E4) += v20;
        v23 = *(_DWORD *)(a1 + 0x1E4);
        *(_DWORD *)(a1 + 0x1F8) = v21 - v20;
        if ( v23 >= v22 )
        {
          *(_DWORD *)(a1 + 0x1E4) = *(_DWORD *)(a1 + 0x1E8);
        }
      }
      if ( (unsigned int)(*(_DWORD *)(a1 + 0x1EC) + **(_DWORD **)(a1 + 0x198) + *(_DWORD *)(a1 + 0x1F8) - *(_DWORD *)(a1 + 0x1F0)) >= *(_DWORD *)(a1 + 0x1F4) )
      {
        v24 = *(_DWORD *)(a1 + 0x1F8);
        v25 = *(_DWORD *)(a1 + 0x1F0);
        if ( v24 + *(_DWORD *)(a1 + 0x1E4) - v25 > 0 )
        {
          v24 = v25 - *(_DWORD *)(a1 + 0x1E4);
        }
        if ( Q_ReadFile_sub_1BF94((P_FileInfo)a1, *(void **)(a1 + 0x1E4), v24) < v24 )
        {
          *(_DWORD *)(a1 + 0x200) = 0xFFFFFFFF;
        }
        v26 = *(_DWORD *)(a1 + 0x1F8);
        *(_DWORD *)(a1 + 0x1E4) += v24;
        v27 = v26 - v24;
        v28 = *(_DWORD *)(a1 + 0x1F0);
        v29 = *(_DWORD *)(a1 + 0x1E4);
        *(_DWORD *)(a1 + 0x1F8) = v27;
        if ( v29 >= v28 )
        {
          *(_DWORD *)(a1 + 0x1E4) = *(_DWORD *)(a1 + 0x1E8);
        }
      }
      return 0xFFFFFFFF;
    }
    v15 = v13 + 0x10 - *(_DWORD *)(a1 + 0x1F0);
    if ( v15 <= 0 )
    {
      v18 = *(signed int **)(a1 + 0x1F0);
      v17 = *v18;
      if ( *v18 <= 0 )
      {
        goto LABEL_53;
      }
      if ( v17 >= *(_DWORD *)(a1 + 0x1EC) - (int)v18 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x3D0);
      }
      v16 = *(void **)(a1 + 0x1F0);
    }
    else
    {
      qmemcpy(*(void **)(a1 + 0x1F0), *(const void **)(a1 + 0x1E8), v13 + 0x10 - *(_DWORD *)(a1 + 0x1F0));
      v16 = (void *)(v13 + 0x10);
      v17 = **(_DWORD **)(a1 + 0x198) - 0x10;
    }
    qmemcpy(v16, (const void *)(v15 + *(_DWORD *)(a1 + 0x1E8)), v17);
    goto LABEL_53;
  }
  return 0xFFFFFFFF;
}
// A0CF8: using guessed type int dword_A0CF8;
// D8650: using guessed type int dword_D8650;

//----- (00029B24) --------------------------------------------------------
void __fastcall sub_29B24(_DWORD *a1)
{
  int v1; // ecx
  signed int v2; // ebx
  int v3; // edi
  int v4; // eax
  LONG v5; // esi
  RGB v6[4]; // [esp+0h] [ebp-18h] BYREF

  v1 = a1[0x7A];
  v2 = a1[0x7D] / 0x27Fu;
  v3 = (a1[0x79] - v1) / v2;
  v4 = (a1[0x66] - v1) / v2;
  v6[0].g = 0;
  v6[0].b = 0;
  v5 = v4;
  v6[0].r = 0xFF;
  VFX_DAC_write(0xFE, v6);
  v6[0].r = 0;
  v6[0].g = 0xFF;
  VFX_DAC_write(0xFF, v6);
  if ( v5 < v3 )
  {
    VFX_area_wipe(0, 450, v5, 479, 254);
    VFX_area_wipe(v5, 450, v3, 479, 255);
    VFX_area_wipe(v3, 450, 639, 479, 254);
  }
  else
  {
    VFX_area_wipe(0, 450, v3, 479, 255);
    VFX_area_wipe(v3, 450, v5, 479, 254);
    VFX_area_wipe(v5, 450, 639, 479, 255);
  }
  VFX_area_wipe(v5, 450, v5, 479, 254);
}

//----- (00029C6C) --------------------------------------------------------
unsigned __int16 __fastcall sub_29C6C(int a1, _WORD *a2)
{
  RGB *v3; // esi
  unsigned __int16 result; // ax
  unsigned __int8 v5; // dl
  __int16 r; // ax
  unsigned __int16 j; // di
  int v8; // edx
  UBYTE v9; // dh
  UBYTE b; // bh
  unsigned __int16 v11; // [esp+0h] [ebp-24h]
  unsigned __int16 v12; // [esp+4h] [ebp-20h]
  int v13; // [esp+8h] [ebp-1Ch]
  unsigned __int8 i; // [esp+Ch] [ebp-18h]

  v3 = (RGB *)(a2 + 1);
  result = *a2;
  v11 = *a2;
  v13 = 0;
  HIBYTE(result) = 0;
  for ( i = 0; (unsigned __int16)v13 < v11; ++v13 )
  {
    v5 = v3->r + i;
    r = v3->r;
    LOBYTE(result) = v3->g;
    v12 = result;
    result = (unsigned __int8)result;
    v3 = (RGB *)((char *)v3 + 2);
    i = v5;
    if ( !v3[0xFFFFFFFF].b )
    {
      result = 0;
      v12 = 0x100;
    }
    for ( j = 0; j < v12; ++j )
    {
      v8 = *(__int16 *)(a1 + 0x932);
      if ( j < v8 || j >= *(__int16 *)(a1 + 0x934) + v8 )
      {
        v9 = v3->r;
        v3->g >>= 2;
        b = v3->b;
        v3->r = v9 >> 2;
        v3->b = b >> 2;
        VFX_DAC_write(i++, v3++);
      }
      result = v12;
    }
  }
  return result;
}

//----- (00029D54) --------------------------------------------------------
int __fastcall sub_29D54(int a1, unsigned __int8 *a2)
{
  int v3; // edx
  int v4; // edx
  unsigned __int16 v5; // ax
  unsigned __int8 *v6; // ebp
  int result; // eax
  int i; // [esp+0h] [ebp-2Ch]
  char *s; // [esp+8h] [ebp-24h]
  char v11[4]; // [esp+Ch] [ebp-20h] BYREF
  int v12; // [esp+10h] [ebp-1Ch]
  signed __int8 v13; // [esp+14h] [ebp-18h]

  s = *(char **)(a1 + 0x1AC);
  for ( i = 0; *(unsigned __int16 *)(a1 + 0x122) > i; ++i )
  {
    v12 = 0;
    ++a2;
    if ( *(_WORD *)(a1 + 0x120) )
    {
      do
      {
        v13 = *a2;
        v6 = a2 + 1;
        if ( v13 >= 0 )
        {
          v3 = *v6;
          a2 = v6 + 1;
          memset(s, v3, v13);
        }
        else
        {
          v13 = -v13;
          v4 = v13;
          qmemcpy(s, v6, v13);
          a2 = &v6[v13];
        }
        LOWORD(v4) = v13;
        s += v13;
        v5 = *(_WORD *)(a1 + 0x120);
        v12 += v4;
      }
      while ( (unsigned __int16)v12 < v5 );
    }
    s += 0x280 - *(unsigned __int16 *)(a1 + 0x120);
  }
  v11[0] = 0;
  v11[1] = 0;
  v11[2] = 0;
  Q_PaletteGet_sub_2C2B0(&V_Type6_stru_D8654, 0, 0x100, 0);
  sub_2C670((int)&V_Type6_stru_D8654, 0, 0x100, v11);
  *(_DWORD *)(a1 + 0x1D0) = 0;
  *(_DWORD *)(a1 + 0x1D4) = 0;
  *(_DWORD *)(a1 + 0x1D8) = *(unsigned __int16 *)(a1 + 0x120) - 1;
  *(_DWORD *)(a1 + 0x1DC) = *(unsigned __int16 *)(a1 + 0x122) - 1;
  VFX_pane_refresh(
    (PANE *)(a1 + 0x1CC),
    *(_DWORD *)(a1 + 0x1A0),
    *(_DWORD *)(a1 + 0x1A4),
    *(_DWORD *)(a1 + 0x1D8) + *(_DWORD *)(a1 + 0x1A0),
    *(_DWORD *)(a1 + 0x1DC) + *(_DWORD *)(a1 + 0x1A4));
  for ( *(_WORD *)(a1 + 0x92C) = 0; *(__int16 *)(a1 + 0x92C) < 0x20; ++*(_WORD *)(a1 + 0x92C) )
  {
    Q_FadePalette_sub_2C5E4(&V_Type6_stru_D8654, *(_BYTE *)(a1 + 0x92C));
  }
  ++*(_WORD *)(a1 + 0x92C);
  return result;
}
// 29DB1: variable 'v4' is possibly undefined

//----- (00029F58) --------------------------------------------------------
void __fastcall sub_29F58(int a1, const void *a2)
{
  LONG v3; // edi
  LONG v4; // [esp-Ch] [ebp-1Ch]
  LONG v5; // [esp-8h] [ebp-18h]
  LONG v6; // [esp-4h] [ebp-14h]

  qmemcpy(*(void **)(a1 + 0x1AC), a2, *(unsigned __int16 *)(a1 + 0x122) * *(unsigned __int16 *)(a1 + 0x120));
  *(_DWORD *)(a1 + 0x1D8) = *(unsigned __int16 *)(a1 + 0x120) - 1;
  *(_DWORD *)(a1 + 0x1DC) = *(unsigned __int16 *)(a1 + 0x122) - 1;
  v6 = *(_DWORD *)(a1 + 0x1DC) + *(_DWORD *)(a1 + 0x1A4);
  v5 = *(_DWORD *)(a1 + 0x1D8) + *(_DWORD *)(a1 + 0x1A0);
  v4 = *(_DWORD *)(a1 + 0x1A4);
  v3 = *(_DWORD *)(a1 + 0x1A0);
  *(_DWORD *)(a1 + 0x1D0) = 0;
  *(_DWORD *)(a1 + 0x1D4) = 0;
  VFX_pane_refresh((PANE *)(a1 + 0x1CC), v3, v4, v5, v6);
}

//----- (00029FF8) --------------------------------------------------------
void __fastcall Q_NC_sub_29FF8(int a1, _WORD *a2)
{
  _WORD *v3; // esi
  char *v4; // edi
  _WORD *v5; // kr00_4
  int v6; // kr04_4
  int v8; // eax
  unsigned __int8 v9; // ah
  signed __int8 v10; // al
  int v11; // eax
  int v12; // edx
  char v13; // dl
  __int16 v14; // bx
  int v15; // edx
  int v16; // eax
  int v17; // ebx
  PANE *target; // [esp+0h] [ebp-18h]
  __int16 i; // [esp+4h] [ebp-14h]
  __int16 v20; // [esp+4h] [ebp-14h]
  int v21; // [esp+8h] [ebp-10h]
  __int16 v22; // [esp+Ch] [ebp-Ch]
  __int16 v23; // [esp+10h] [ebp-8h]
  __int16 v24; // [esp+14h] [ebp-4h]

  v3 = *(_WORD **)(a1 + 0x1AC);
  v4 = (char *)(a2 + 1);
  v22 = *a2;
  v23 = 0;
  target = (PANE *)(a1 + 0x1CC);
  v5 = a2 + 1;
  v6 = 0;
  while ( v22-- )
  {
    while ( 1 )
    {
      v24 = v5[v6++];
      if ( v24 > 0 )
      {
        break;
      }
      if ( (v24 & 0x4000) == 0 )
      {
        printf("Bombing on Frame #%d.\n", *(_DWORD *)(a1 + 0x19C));
        Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x569);
      }
      v23 -= v24;
      v3 = (_WORD *)(*(unsigned __int16 *)(a1 + 0x120) * v23 + *(_DWORD *)(a1 + 0x1AC));
    }
    for ( i = 0; ; i = v21 + v20 )
    {
      v8 = v24--;
      if ( v8 <= 0 )
      {
        break;
      }
      v9 = *v4;
      v10 = v4[1];
      LOWORD(v21) = 2 * v10;
      v3 = (_WORD *)((char *)v3 + (unsigned __int8)*v4);
      v4 += 2;
      v20 = v9 + i;
      if ( (__int16)v21 <= 0 )
      {
        v14 = *(_WORD *)v4;
        v4 += 2;
        while ( 1 )
        {
          v15 = v10++;
          if ( v15 >= 0 )
          {
            break;
          }
          *v3++ = v14;
        }
        LOWORD(v21) = -(__int16)v21;
      }
      else
      {
        v11 = v21;
        while ( 1 )
        {
          v12 = (__int16)v11--;
          if ( v12 <= 0 )
          {
            break;
          }
          v13 = *v4++;
          *(_BYTE *)v3 = v13;
          v3 = (_WORD *)((char *)v3 + 1);
        }
      }
      *(_DWORD *)(a1 + 0x1D0) = v20;
      *(_DWORD *)(a1 + 0x1DC) = v23;
      *(_DWORD *)(a1 + 0x1D4) = v23;
      v16 = *(_DWORD *)(a1 + 0x1A4);
      v17 = *(_DWORD *)(a1 + 0x1DC);
      *(_DWORD *)(a1 + 0x1D8) = (__int16)v21 + v20;
      VFX_pane_refresh(
        target,
        *(_DWORD *)(a1 + 0x1D0) + *(_DWORD *)(a1 + 0x1A0),
        *(_DWORD *)(a1 + 0x1D4) + *(_DWORD *)(a1 + 0x1A4),
        *(_DWORD *)(a1 + 0x1D8) + *(_DWORD *)(a1 + 0x1A0),
        v17 + v16);
    }
    v3 = (_WORD *)(++v23 * *(unsigned __int16 *)(a1 + 0x120) + *(_DWORD *)(a1 + 0x1AC));
  }
}
// 2A0FB: variable 'v21' is possibly undefined

//----- (0002A1DC) --------------------------------------------------------
FILE *__fastcall sub_2A1DC(int a1, const char *a2)
{
  FILE *result; // eax
  FILE *v4; // ebx
  int v5; // esi
  unsigned int v6; // kr04_4
  char *v7; // eax
  int v9; // esi
  int v10; // ecx
  void *v11; // eax
  char *v12; // esi
  char *v13; // edi
  char v14; // al
  char v15; // al
  int v16; // eax
  __int16 v17; // dx
  FILE *v18; // ecx
  __int16 v19; // si
  FILE *v20; // esi
  __int16 v21; // bx
  FILE *v22; // esi
  __int16 v23; // cx
  void *v24; // eax
  FILE *v25; // edi
  int v26; // ebx
  FILE *v27; // [esp-10h] [ebp-304h]
  T_FileInfo v28; // [esp+0h] [ebp-2F4h] BYREF
  char v29[256]; // [esp+118h] [ebp-1DCh] BYREF
  char v30[128]; // [esp+218h] [ebp-DCh] BYREF
  char v31[52]; // [esp+298h] [ebp-5Ch] BYREF
  unsigned int v32; // [esp+2CCh] [ebp-28h] BYREF
  FILE *fp; // [esp+2D0h] [ebp-24h]
  int v34; // [esp+2D4h] [ebp-20h]
  int v35; // [esp+2D8h] [ebp-1Ch]
  __int16 v36; // [esp+2DCh] [ebp-18h]

  result = (FILE *)a2;
  if ( a2 )
  {
    v36 = 0;
    result = Q_OpenFile_sub_1BB10(a2, 0);
    fp = result;
    if ( result )
    {
      v34 = 0;
      v35 = a1 + 0x90A;
      while ( 1 )
      {
        v4 = fp;
        fscanf(fp, "%s %d", v31, &v32);
        if ( v32 == 0xFFFFFFFF )
        {
          break;
        }
        v5 = ++v34;
        if ( v32 < 2 )
        {
          if ( v32 )
          {
            fscanf(v4, "%s %s", v31, v30);
            if ( sub_2B360((void **)v35, v30) == FALSE )
            {
              Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0x5E3);
            }
            fscanf(fp, "%s %s", v31, v30);
            Q_InitFileInfo_sub_1BB78(&v28);
            if ( Q_OpenFile_sub_1BBFC(&v28, v30, 0x200, 0) )
            {
              Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0x5EB);
            }
            v24 = Q_CfileLoad_sub_1BF1C(&v28, 0);
            *(_DWORD *)(a1 + 0x92E) = v24;
            if ( !v24 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x5EE);
            }
            v25 = fp;
            fscanf(fp, "%s %d", v31, &v32);
            *(_WORD *)(a1 + 0x932) = v32;
            fscanf(v25, "%s %d", v31, &v32);
            *(_WORD *)(a1 + 0x934) = v32;
            fscanf(v25, "%s %d", v31, &v32);
            v26 = v34 + 6;
            *(_DWORD *)(a1 + 0x926) = v32;
            v34 = v26;
            Q_CloseFileAndDelete_sub_1BBC8(&v28);
          }
          else
          {
            fscanf(v4, "%s %d", v31, &v32);
            *(_DWORD *)(a1 + 0x916) = v32;
            fscanf(v4, "%s %d", v31, &v32);
            *(_DWORD *)(a1 + 0x91A) = v32;
            fscanf(v4, "%s %d", v31, &v32);
            *(_DWORD *)(a1 + 0x91E) = v32;
            fscanf(v4, "%s %d", v31, &v32);
            v34 = v5 + 5;
            *(_DWORD *)(a1 + 0x922) = v32;
          }
        }
        else if ( v32 <= 2 )
        {
          if ( *(__int16 *)(a1 + 0x806) >= 0x80 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x5FF);
          }
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x206) = 1;
          *(_DWORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x208) = v36;
          fscanf(fp, "%s %s", v31, v29);
          v6 = strlen(v29) + 1;
          v7 = v29;
          if ( v29[0] )
          {
            do
            {
              if ( *v7 == 0x5F )
              {
                *v7 = 0x20;
              }
            }
            while ( *++v7 );
          }
          v9 = sub_2B5BC((int *)v35, v29);
          if ( v9 == 0xFFFFFFFF )
          {
            Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0x613);
          }
          v10 = v36;
          *(_DWORD *)(a1 + 8 * v36 + 0x80C) = v9;
          v11 = operator new[]((__int16)(v6 - 1) + 1);
          Q_RegisterData_sub_2625C(v11, 1, "SUBTITLE");
          *(_DWORD *)(a1 + 8 * v10 + 0x808) = v11;
          if ( !v11 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x61B);
          }
          v12 = v29;
          v13 = *(char **)(a1 + 8 * v36 + 0x808);
          do
          {
            v14 = *v12;
            *v13 = *v12;
            if ( !v14 )
            {
              break;
            }
            v15 = v12[1];
            v12 += 2;
            v13[1] = v15;
            v13 += 2;
          }
          while ( v15 );
          fscanf(fp, "%s %d", v31, &v32);
          v32 -= 0x20;
          if ( (int)v32 <= 0 )
          {
            Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0x622);
          }
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x204) = v32;
          v27 = fp;
          ++*(_WORD *)(a1 + 0x806);
          fscanf(v27, "%s %d", v31, &v32);
          v16 = 0xC * *(__int16 *)(a1 + 0x806);
          ++v36;
          *(_WORD *)(v16 + a1 + 0x204) = v32;
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x206) = 2;
          v17 = *(_WORD *)(a1 + 0x806);
          v34 += 4;
          *(_WORD *)(a1 + 0x806) = v17 + 1;
        }
        else if ( v32 < 0xB )
        {
          if ( v32 != 3 )
          {
LABEL_10:
            sprintf("Thank you for playing Ascendancy.", "\n  ** Bad Subtitle Data: %s, %d (line %d)\n\n", v31, v32, v34);
            Q_debugbreak_exit_sub_2624C();
          }
          if ( *(__int16 *)(a1 + 0x806) >= 0x80 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x635);
          }
          v18 = fp;
          fscanf(fp, "%s %d", v31, &v32);
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x204) = v32;
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x206) = 3;
          fscanf(v18, "%s %d", v31, &v32);
          *(_DWORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x208) = v32;
          v19 = *(_WORD *)(a1 + 0x806);
          v34 += 3;
          *(_WORD *)(a1 + 0x806) = v19 + 1;
        }
        else if ( v32 <= 0xB )
        {
          if ( *(__int16 *)(a1 + 0x806) >= 0x80 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x703);
          }
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x206) = 0xB;
          v22 = fp;
          fscanf(fp, "%s %d", v31, &v32);
          *(_DWORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x208) = v32;
          fscanf(v22, "%s %d", v31, &v32);
          *(_DWORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x20C) = v32;
          fscanf(v22, "%s %d", v31, &v32);
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x204) = v32;
          v23 = *(_WORD *)(a1 + 0x806);
          v34 += 4;
          *(_WORD *)(a1 + 0x806) = v23 + 1;
        }
        else
        {
          if ( v32 != 0x10 )
          {
            goto LABEL_10;
          }
          if ( *(__int16 *)(a1 + 0x806) >= 0x80 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x68A);
          }
          v20 = fp;
          fscanf(fp, "%s %d", v31, &v32);
          *(_DWORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x208) = v32;
          fscanf(v20, "%s %d", v31, &v32);
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x206) = (v32 != 1) + 0x1E;
          fscanf(v20, "%s %d", v31, &v32);
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x204) = v32;
          v21 = *(_WORD *)(a1 + 0x806) + 1;
          v34 += 4;
          *(_WORD *)(a1 + 0x806) = v21;
        }
      }
      fclose(v4);
      qsort((void *)(a1 + 0x204), *(__int16 *)(a1 + 0x806), 0xCu, (int (__fastcall *)(const void *, const void *))sub_28C4C);
      return (FILE *)0xFFFFFFFF;
    }
  }
  return result;
}
// 2A1DC: using guessed type char var_5C[52];

//----- (0002AA88) --------------------------------------------------------
void __fastcall sub_2AA88(int a1)
{
  int v2; // ebx
  int v3; // ecx
  int v4; // edi
  ULONG v5; // edx
  HTIMER v6; // eax
  unsigned __int16 v7; // ax
  int v8; // [esp+0h] [ebp-8h]
  T_Font *v9; // [esp+4h] [ebp-4h]

  v8 = a1 + 0x808;
  v9 = (T_Font *)(a1 + 0x90A);
  while ( 1 )
  {
    v2 = *(__int16 *)(a1 + 0xC * *(__int16 *)(a1 + 0x804) + 0x204);
    v3 = *(_DWORD *)(a1 + 0x19C);
    if ( v2 != v3 )
    {
      break;
    }
    v7 = *(_WORD *)(a1 + 0xC * *(__int16 *)(a1 + 0x804) + 0x206);
    if ( v7 < 3u )
    {
      if ( !v7 )
      {
        goto LABEL_23;
      }
      if ( v7 <= 1u )
      {
        if ( !*(_DWORD *)(a1 + 0x942) )
        {
          v4 = 8 * *(_DWORD *)(a1 + 0xC * *(__int16 *)(a1 + 0x804) + 0x208) + v8;
          sub_2C1E0((int)&V_Type6_stru_D8654, *(_WORD *)(a1 + 0x932), *(_WORD *)(a1 + 0x934), *(_DWORD *)(a1 + 0x92E));
          sub_2C670((int)&V_Type6_stru_D8654, *(__int16 *)(a1 + 0x932), *(__int16 *)(a1 + 0x934), 0);
          sub_2B8A8(v9, *(__int16 *)(v4 + 4), *(__int16 *)(v4 + 6), *(const char **)v4, 0x80, 0xFFFFFFFF, 0xFFFFFFFF, 0);
          *(_WORD *)(a1 + 0x92A) = 1;
        }
        goto LABEL_6;
      }
      if ( *(_DWORD *)(a1 + 0x942) )
      {
        goto LABEL_6;
      }
      *(_WORD *)(a1 + 0x92A) = 2;
      ++*(_WORD *)(a1 + 0x804);
    }
    else if ( v7 <= 3u )
    {
      v5 = *(_DWORD *)(a1 + 0xC * *(__int16 *)(a1 + 0x804) + 0x208);
      v6 = *(_DWORD *)(a1 + 0x936);
      *(_DWORD *)(a1 + 0x1E0) = v5;
      if ( v6 == 0xFFFFFFFF )
      {
        goto LABEL_6;
      }
      if ( v5 )
      {
        AIL_set_timer_frequency(v6, v5);
      }
      else
      {
        AIL_stop_timer(v6);
      }
      ++*(_WORD *)(a1 + 0x804);
    }
    else if ( v7 < 0x1Eu )
    {
      if ( v7 != 0xB )
      {
        goto LABEL_23;
      }
      if ( V_SoundSystem.DIG_installed == 0xFFFFFFFF )
      {
        Q_SetVolume_sub_4FF4C(&V_SoundSystem, *(_DWORD *)(a1 + 0xC * *(__int16 *)(a1 + 0x804) + 0x20C));
        ++*(_WORD *)(a1 + 0x804);
      }
      else
      {
LABEL_6:
        ++*(_WORD *)(a1 + 0x804);
      }
    }
    else if ( v7 <= 0x1Eu )
    {
      sub_4F8CC(&V_SoundSystem, *(_DWORD *)(a1 + 0xC * *(__int16 *)(a1 + 0x804) + 0x208), v3 ^ v2);
      ++*(_WORD *)(a1 + 0x804);
    }
    else if ( v7 == 0x1F )
    {
      Q_StopSample_sub_4FA1C(&V_SoundSystem);
      ++*(_WORD *)(a1 + 0x804);
    }
    else
    {
LABEL_23:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0x80F);
      ++*(_WORD *)(a1 + 0x804);
    }
  }
}

//----- (0002AC84) --------------------------------------------------------
int __fastcall Q_FLIC_CPP_StartTimer_sub_2AC84(int a1, ULONG hertz)
{
  HTIMER v4; // edx
  HTIMER v5; // eax

  *(_DWORD *)(a1 + 0x1E0) = hertz;
  v4 = *(_DWORD *)(a1 + 0x936);
  if ( v4 == 0xFFFFFFFF )
  {
    v5 = AIL_register_timer((AILTIMERCB)callback_fn);
    *(_DWORD *)(a1 + 0x936) = v5;
    if ( v5 == 0xFFFFFFFF )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0x823);
    }
    AIL_set_timer_frequency(*(_DWORD *)(a1 + 0x936), hertz);
    AIL_start_timer(*(_DWORD *)(a1 + 0x936));
  }
  else
  {
    AIL_set_timer_frequency(v4, hertz);
  }
  return (*(_DWORD *)(a1 + 0x936) == 0xFFFFFFFF) - 1;
}

//----- (0002AD08) --------------------------------------------------------
void __fastcall __spoils<> sub_2AD08(P_Type2 a1)
{
  if ( a1->Unknown_90E[3] != 0xFFFFFFFF )
  {
    AIL_stop_timer(a1->Unknown_90E[3]);
    AIL_release_timer_handle(a1->Unknown_90E[3]);
    a1->Unknown_90E[3] = 0xFFFFFFFF;
  }
}

//----- (0002AD40) --------------------------------------------------------
__int16 __cdecl sub_2AD40(unsigned __int16 *a1, int a2, LONG y)
{
  int v4; // ecx
  unsigned __int16 *v5; // esi
  __int16 result; // ax
  int v7; // edx
  LONG v8; // edx
  char v9; // al
  unsigned __int16 *v10; // esi
  int v11; // ecx
  unsigned __int16 v12; // ax
  int v13; // edx
  unsigned int v14; // ecx
  unsigned __int16 v15; // ax
  UBYTE *v16; // edi
  LONG v17; // edx
  ULONG i; // ecx
  unsigned int j; // ecx
  int v20; // edx
  unsigned int v21; // ecx
  UBYTE *v22; // edi
  ULONG v23; // ecx
  LONG v24; // edx
  int v25; // [esp-2Eh] [ebp-42h]
  int v26; // [esp-2Eh] [ebp-42h]
  LONG v27; // [esp-2Ah] [ebp-3Eh]
  int v28; // [esp-26h] [ebp-3Ah]
  int v29; // [esp-26h] [ebp-3Ah]
  LONG v30; // [esp-22h] [ebp-36h]
  LONG v31; // [esp-22h] [ebp-36h]
  int v32; // [esp-1Eh] [ebp-32h]
  unsigned __int16 v33; // [esp-1Eh] [ebp-32h]
  unsigned __int16 v34; // [esp-1Ah] [ebp-2Eh]
  ULONG v35; // [esp-1Ah] [ebp-2Eh]
  int v36; // [esp-16h] [ebp-2Ah]
  unsigned int v37; // [esp-16h] [ebp-2Ah]
  __int16 v38; // [esp-12h] [ebp-26h]
  int v39; // [esp-10h] [ebp-24h]
  ULONG v40; // [esp+4h] [ebp-10h] BYREF
  UBYTE *v41; // [esp+8h] [ebp-Ch] BYREF
  ULONG nbytes; // [esp+Ch] [ebp-8h] BYREF
  UBYTE *addr; // [esp+10h] [ebp-4h] BYREF

  v4 = *a1;
  v5 = a1 + 1;
  do
  {
    while ( 1 )
    {
      result = *v5++;
      if ( result > 0 )
      {
        break;
      }
      if ( (result & 0x4000) != 0 )
      {
        LOWORD(y) = y - result;
      }
    }
    v7 = a2;
    v39 = v4;
    do
    {
      v38 = result;
      v8 = *(unsigned __int8 *)v5 + v7;
      v9 = *((_BYTE *)v5 + 1);
      v10 = v5 + 1;
      if ( (v9 & 0x80) != 0 )
      {
        v11 = -v9;
        v12 = *v10;
        v5 = v10 + 1;
        v34 = v12;
        v32 = 2 * v11;
        VFX_line_address(v8, y, &addr, &nbytes);
        v13 = v25;
        v14 = v32;
        v15 = v34;
        v16 = addr;
        if ( v32 > (int)nbytes )
        {
          v35 = v32 - nbytes;
          v17 = nbytes + v25;
          for ( i = nbytes >> 1; i; --i )
          {
            *(_WORD *)v16 = v15;
            v16 += 2;
          }
          v33 = v15;
          VFX_line_address(v17, v27, &addr, &nbytes);
          v13 = v26;
          v15 = v33;
          v14 = v35;
          v16 = addr;
        }
        v7 = v14 + v13;
        for ( j = v14 >> 1; j; --j )
        {
          *(_WORD *)v16 = v15;
          v16 += 2;
        }
      }
      else
      {
        v36 = 2 * v9;
        VFX_line_address(v8, y, &v41, &v40);
        v20 = v28;
        y = v30;
        v21 = v36;
        v22 = v41;
        if ( v36 > (int)v40 )
        {
          v37 = v36 - v40;
          v23 = v40;
          v24 = v40 + v28;
          qmemcpy(v41, v10, v40);
          v10 = (unsigned __int16 *)((char *)v10 + v23);
          VFX_line_address(v24, v30, &v41, &v40);
          v20 = v29;
          y = v31;
          v21 = v37;
          v22 = v41;
        }
        v7 = v21 + v20;
        qmemcpy(v22, v10, v21);
        v5 = (unsigned __int16 *)((char *)v10 + v21);
      }
      result = v38 - 1;
    }
    while ( v38 != 1 );
    LOWORD(y) = y + 1;
    v4 = v39 - 1;
  }
  while ( v39 != 1 );
  return result;
}
// 2ADAB: variable 'v25' is possibly undefined
// 2ADD3: variable 'v27' is possibly undefined
// 2ADD9: variable 'v26' is possibly undefined
// 2AE00: variable 'v28' is possibly undefined
// 2AE01: variable 'v30' is possibly undefined
// 2AE29: variable 'v29' is possibly undefined
// 2AE2A: variable 'v31' is possibly undefined

//----- (0002AE48) --------------------------------------------------------
int __cdecl Q_NC_sub_2AE48(unsigned __int16 a1)
{
  while ( MEMORY[0x46C] <= a1 )
  {
    ;
  }
  return MEMORY[0x46C];
}
// 2AE48: could not find valid save-restore pair for edi

//----- (0002AE69) --------------------------------------------------------
__int16 Q_NC_sub_2AE69()
{
  __int16 result; // ax

  result = 0x1510;
  __asm { int     23h; DOS - CONTROL "C" EXIT ADDRESS }
  return result;
}

//----- (0002AE80) --------------------------------------------------------
void __fastcall __spoils<> Q_Wnd1FLICCtor_sub_2AE80(P_Wnd1FLIC a1)
{
  Q_A2Ctor_sub_2C830(&a1->a);
  sub_28C74(&a1->b);
  a1->a.procs = (P_Procs)off_95CB4;
  a1->b.dword936 = 1;
}
// 95CB4: using guessed type int (*off_95CB4[3])();

//----- (0002AEB0) --------------------------------------------------------
P_Wnd1FLIC __fastcall Q_Wnd1FLICDtor_sub_2AEB0(P_Wnd1FLIC a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, &C_Wnd1FLIC);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->a.procs = (P_Procs)off_95CB4;
    sub_28DA4(&a1->b);
    v5 = Q_A2Dtor_sub_2C848(&a1->a, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (P_Wnd1FLIC)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95CB4: using guessed type int (*off_95CB4[3])();

//----- (0002AF04) --------------------------------------------------------
UBYTE *__fastcall sub_2AF04(int a1, const char *a2)
{
  UBYTE *v2; // ecx

  v2 = sub_28EB4(a1 + 0xAB, a2, (int)WinMgr.window->buffer, 0xFFFFFFFF, 0xFFFFFFFF);
  if ( !v2 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\flicwin.cpp", 0x4E);
  }
  return v2;
}

//----- (0002AF3C) --------------------------------------------------------
int __fastcall sub_2AF3C(int a1)
{
  signed int size; // esi
  int v4; // ebx
  unsigned int v5; // ebx

  size = *(__int16 *)(a1 + 0xA01) << 0x14;
  if ( size <= WinMgr.t13.size )
  {
    v4 = *(__int16 *)(a1 + 0xA03);
    if ( v4 == 0xFFFFFFFF )
    {
      size = WinMgr.t13.size;
      v5 = WinMgr.t13.size;
    }
    else
    {
      v5 = v4 << 0x14;
    }
    sub_1B4D0(WinMgr.t13.z1);
    return sub_29038(a1 + 0xAB, size, v5, *(__int16 *)(a1 + 0xA05) << 0xA, *(__int16 *)(a1 + 0xA07) << 0xA, (int)WinMgr.t13.pShapeCache);
  }
  else
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\flicwin.cpp", 0x67);
    return 0;
  }
}

//----- (0002AFF0) --------------------------------------------------------
unsigned int __fastcall sub_2AFF0(int a1, __int16 a2, LONG a3, LONG a4)
{
  __int16 v6; // cx
  __int16 v7; // dx
  __int16 v8; // bx
  unsigned int result; // eax
  T_Palette blackpal; // [esp+0h] [ebp-31Ch] BYREF
  int v11; // [esp+300h] [ebp-1Ch]
  int v12; // [esp+304h] [ebp-18h]
  int v13; // [esp+308h] [ebp-14h]
  char v14; // [esp+30Ch] [ebp-10h]

  LOWORD(v13) = a2;
  v12 = 0;
  v11 = a1 + 0xAB;
  switch ( a2 )
  {
    case 1:
      *(_DWORD *)(a1 + 0x247) = 0xFFFFFFFF;
      *(_WORD *)(a1 + 0x9F7) = 0;
      *(_DWORD *)(a1 + 0x9F9) = 0;
      *(_DWORD *)(a1 + 0x9FD) = 0;
      MOUSE_hide();
      dword_132B60 = 0;
      if ( sub_2AF3C(a1) )
      {
        Q_StopSample_sub_4FA1C(&V_SoundSystem);
        sub_2F424((T_TypeA2 *)a1, v13, a3, a4);
        sub_56400(&WinMgr, *(_DWORD *)(a1 + 0x41), 0xA, 0, 0, 0);
        Q_FLIC_CPP_StartTimer_sub_2AC84(v11, 0x12u);
      }
      else
      {
        sub_1ACE8((int)WinMgr.t13.z1);
        MOUSE_show();
        sub_56B60(&WinMgr, *(_WORD *)(a1 + 0x45), *(_DWORD *)(a1 + 0x47), *(_DWORD *)(a1 + 0x4B));
      }
      result = v12;
      break;
    case 2:
      v6 = 0;
      sub_2AD08((P_Type2)(a1 + 0xAB));
      v14 = 129;
      while ( v6 < 0x40 )
      {
        sub_2BD04(&V_Type6_stru_D8654, v6, 0);
        Q_SetVolume_sub_4FF4C(&V_SoundSystem, v14);
        ++v6;
        v14 -= 2;
      }
      Q_StopSample_sub_4FA1C(&V_SoundSystem);
      sub_1ACE8((int)WinMgr.t13.z1);
      memset(blackpal, 0, sizeof(blackpal));
      Q_PaletteSet_sub_2C224(&V_Type6_stru_D8654, 0, 0x100, blackpal);
      VFX_area_wipe(0, 0, 639, 479, 0);
      Q_LoadPal_sub_2C158(&V_Type6_stru_D8654, "DATA\\game.pal", 0, 0x100u);
      Q_PaletteSet_sub_2C224(&V_Type6_stru_D8654, 0, 0x100, blackpal);
      dword_132B60 = 0xFFFFFFFF;
      dword_132B64 = 0;
      MOUSE_show();
      sub_2F424((T_TypeA2 *)a1, v13, a3, a4);
      result = v12;
      break;
    case 3:
    case 4:
    case 5:
      goto LABEL_14;
    case 0xA:
      if ( !sub_296B4(a1 + 0xAB, a1 + 0xAB, a3, a4) )
      {
        v7 = *(_WORD *)(a1 + 0x9F7) + 1;
        v8 = *(_WORD *)(a1 + 0x9F5);
        *(_WORD *)(a1 + 0x9F7) = v7;
        if ( v7 < v8 )
        {
          sub_2AF3C(a1);
        }
      }
      if ( *(_WORD *)(a1 + 0x9F7) >= *(_WORD *)(a1 + 0x9F5) )
      {
LABEL_14:
        sub_564C0(&WinMgr, *(_DWORD *)(a1 + 0x41), 0xA);
        sub_56B60(&WinMgr, *(_WORD *)(a1 + 0x45), *(_DWORD *)(a1 + 0x47), *(_DWORD *)(a1 + 0x4B));
      }
      v12 = 0xFFFFFFFF;
      result = 0xFFFFFFFF;
      break;
    default:
      result = sub_2F424((T_TypeA2 *)a1, v13, a3, a4);
      break;
  }
  return result;
}
// 132B60: using guessed type int dword_132B60;
// 132B64: using guessed type int dword_132B64;

//----- (0002B2C0) --------------------------------------------------------
void __fastcall __spoils<> sub_2B2C0(P_Font a1)
{
  a1->pVfxFont = 0;
  a1->pane.window = 0;
  sub_2B2FC(a1, 0);
}

//----- (0002B2E0) --------------------------------------------------------
void __fastcall __spoils<> sub_2B2E0(P_Font a1)
{
  if ( a1->pVfxFont )
  {
    sub_2627C(a1->pVfxFont);
  }
  operator delete(a1->pVfxFont);
}
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (0002B2FC) --------------------------------------------------------
MACRO_VFX_BOOL __fastcall sub_2B2FC(P_Font a1, const char *aFName)
{
  void *v4; // eax
  int i; // eax

  a1->pane.window = (WINDOW *)&V_Type6_stru_D8654;
  if ( aFName )
  {
    return sub_2B360((void **)&a1->pVfxFont, aFName);
  }
  v4 = operator new[](0x100u);
  Q_RegisterData_sub_2625C(v4, 1, "FONT TRANSLATE");
  a1->pFontTranslate = (BYTE *)v4;
  if ( !v4 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\font.cpp", 0x5D);
  }
  for ( i = 0; i < 0x100; ++i )
  {
    a1->pFontTranslate[i] = i;
  }
  return TRUE;
}

//----- (0002B360) --------------------------------------------------------
MACRO_VFX_BOOL __fastcall sub_2B360(void **data, const char *aFName)
{
  void *v4; // eax
  T_FileInfo v6; // [esp+0h] [ebp-124h] BYREF

  if ( !aFName )
  {
    return TRUE;
  }
  Q_InitFileInfo_sub_1BB78(&v6);
  if ( !Q_OpenFile_sub_1BBFC(&v6, aFName, O_BINARY, 0) )
  {
    if ( *data )
    {
      sub_2627C(*data);
    }
    operator delete(*data);
    v4 = Q_CfileLoad_sub_1BF1C(&v6, 0);
    *data = v4;
    if ( v4 )
    {
      Q_CloseFileAndDelete_sub_1BBC8(&v6);
      return TRUE;
    }
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v6);
  return FALSE;
}
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (0002B3E0) --------------------------------------------------------
void __fastcall sub_2B3E0(P_Font pFont, int x1, int y1, int x2, int y2)
{
  pFont->pane.x0 = x1;
  pFont->pane.y0 = y1;
  pFont->pane.x1 = x2;
  pFont->pane.y1 = y2;
}

//----- (0002B3F4) --------------------------------------------------------
int __fastcall sub_2B3F4(int a1, char *s2, char *s1, int a4)
{
  char *v6; // esi
  char v7; // al
  int v8; // ecx
  const char *v9; // ebp
  _BYTE *v10; // esi
  char v11; // al
  char v13; // bl
  int v14; // kr04_4
  int v15; // kr0C_4
  char v16; // al
  char v17; // al
  char v18[4]; // [esp+0h] [ebp-14h] BYREF
  int v19; // [esp+4h] [ebp-10h]

  v19 = a1;
  v6 = s2;
  while ( *v6 != 0x7C )
  {
    if ( *v6 )
    {
      v7 = *++v6;
      if ( *v6 == 0x7C )
      {
        break;
      }
      ++v6;
      if ( v7 )
      {
        continue;
      }
    }
    v6 = 0;
    break;
  }
  v8 = 0;
  if ( v6 )
  {
    if ( v6 != s2 )
    {
      strncpy(s1, s2, v6 - s2);
      s1[v6 - s2] = 0;
      return v6 - s2;
    }
    v9 = v6 + 1;
    v10 = v6 + 1;
    *s1 = 0;
    while ( *v10 != 0x7C )
    {
      if ( *v10 )
      {
        v11 = *++v10;
        if ( *v10 == 0x7C )
        {
          break;
        }
        ++v10;
        if ( v11 )
        {
          continue;
        }
      }
      v10 = 0;
      break;
    }
    if ( v10 )
    {
      v8 = v10 - v9 + 2;
      if ( v10 == v9 )
      {
        s1[1] = 0;
        *s1 = 0x7C;
        return v10 - v9 + 2;
      }
      if ( a4 == 0xFFFFFFFF )
      {
        strncpy(v18, v9, 3u);
        v18[3] = 0;
        v13 = atoi(v18);
        *(_BYTE *)(*(_DWORD *)(v19 + 4) + 0xF3) = v13;
        return v10 - v9 + 2;
      }
    }
    else
    {
      return 1;
    }
  }
  else
  {
    v14 = 0;
    v15 = 0;
    do
    {
      v16 = s2[2 * v14];
      s1[2 * v15] = v16;
      if ( !v16 )
      {
        break;
      }
      v17 = s2[2 * v14 + 1];
      s1[2 * v15 + 1] = v17;
      ++v14;
      ++v15;
    }
    while ( v17 );
  }
  return v8;
}

//----- (0002B4F4) --------------------------------------------------------
int __fastcall sub_2B4F4(_DWORD *a1, char *string)
{
  int v3; // edi
  char *v4; // esi
  LONG v6; // [esp-4h] [ebp-24h]
  int i; // [esp+0h] [ebp-20h]
  char *ptr; // [esp+4h] [ebp-1Ch]
  char *s2; // [esp+8h] [ebp-18h]

  if ( !string )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\font.cpp", 0xD7);
  }
  if ( !*a1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\font.cpp", 0xD8);
  }
  s2 = string;
  v3 = 0;
  ptr = strdup(string);
  do
  {
    v4 = ptr;
    for ( i = sub_2B3F4((int)a1, s2, ptr, 0); *v4; v3 += VFX_character_width((void *)*a1, v6) )
    {
      v6 = (unsigned __int8)*v4++;
    }
    s2 += i;
  }
  while ( i > 0 );
  free(ptr);
  return v3;
}

//----- (0002B594) --------------------------------------------------------
LONG __fastcall Q_FONT_CPP_GetFontHeight_sub_2B594(P_Font a1)
{
  if ( !a1->pVfxFont )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\font.cpp", 0x104);
  }
  return VFX_font_height(a1->pVfxFont);
}

//----- (0002B5BC) --------------------------------------------------------
int __fastcall sub_2B5BC(int *a1, char *a2)
{
  LONG FontHeight_sub_2B594; // esi
  int v4; // edx
  int v5; // ecx
  int v6; // ebx

  FontHeight_sub_2B594 = Q_FONT_CPP_GetFontHeight_sub_2B594((P_Font)a1);
  v4 = sub_2B4F4(a1, a2);
  v5 = a1[6] - a1[4] - FontHeight_sub_2B594;
  v6 = a1[5] - a1[3] - v4;
  if ( v5 >= 0 && v6 >= 0 )
  {
    return (v6 >> 1) + (v5 >> 1 << 0x10);
  }
  else
  {
    return 0xFFFFFFFF;
  }
}

//----- (0002B610) --------------------------------------------------------
void __fastcall Q_FONT_CPP_sub_2B610(_DWORD *a1, LONG a2, LONG a3, char *a4, int a5, int a6, __int16 a7)
{
  __int16 v8; // cx
  LONG FontHeight_sub_2B594; // ebx
  LONG v10; // edx
  LONG v11; // edi
  LONG v12; // eax
  LONG v13; // edx
  char *text; // esi
  char *v15; // edi
  int v16; // eax
  PANE v17; // [esp+0h] [ebp-38h] BYREF
  int v18; // [esp+14h] [ebp-24h]
  LONG v19; // [esp+18h] [ebp-20h]
  char *string; // [esp+1Ch] [ebp-1Ch]
  PANE *pane; // [esp+20h] [ebp-18h]
  LONG y; // [esp+24h] [ebp-14h]
  LONG x; // [esp+28h] [ebp-10h]

  v19 = a2;
  y = a3;
  string = a4;
  v8 = a6;
  if ( !string )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\font.cpp", 0x13B);
  }
  if ( !*a1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\font.cpp", 0x13C);
  }
  if ( a7 == 0xFFFFFFFF )
  {
    a7 = *((_WORD *)a1 + 0xE);
  }
  if ( (__int16)a6 == 0xFFFFFFFF )
  {
    v8 = 0xF3;
  }
  if ( v8 != 0xFFFFFFFE )
  {
    *(_BYTE *)(a1[1] + 0xF3) = v8;
  }
  FontHeight_sub_2B594 = Q_FONT_CPP_GetFontHeight_sub_2B594((P_Font)a1);
  v17.window = (WINDOW *)a1[2];
  v17.x0 = a1[3];
  v17.y0 = a1[4];
  v17.x0 += v19;
  v17.y0 += y;
  v10 = sub_2B4F4(a1, string) + v17.x0;
  v17.x1 = v10;
  v17.y1 = FontHeight_sub_2B594 + v17.y0;
  v11 = a1[5];
  if ( v17.x0 <= v11 )
  {
    v12 = v10;
    v13 = a1[3];
    if ( v12 >= v13 && v17.y0 <= a1[6] && v17.y1 >= a1[4] )
    {
      if ( v13 <= v17.x0 )
      {
        if ( v11 < v17.x1 )
        {
          v17.x1 = a1[5];
        }
      }
      else
      {
        v17.x0 = a1[3];
      }
      if ( v17.y0 >= a1[4] )
      {
        if ( v17.y1 > a1[6] )
        {
          v17.y1 = a1[6];
        }
      }
      else
      {
        v17.y0 = a1[4];
      }
      if ( a7 != 0xFF )
      {
        VFX_pane_wipe(&v17, a7);
      }
      text = strdup(string);
      x = v19;
      v15 = string;
      pane = (PANE *)&CONTAINING_RECORD(a1, PANE, window)->y0;
      do
      {
        v18 = sub_2B3F4((int)a1, v15, text, 0xFFFFFFFF);
        if ( *text )
        {
          VFX_string_draw(pane, x, y, (void *)*a1, text, (UBYTE *)a1[1]);
        }
        v16 = sub_2B4F4(a1, text);
        v15 += v18;
        x += v16;
      }
      while ( v18 > 0 );
      free(text);
      if ( (a5 & 0xC0) == 0 )
      {
        sub_552CC(&WinMgr, &v17);
      }
    }
  }
}

//----- (0002B804) --------------------------------------------------------
void __fastcall Q_NC_sub_2B804(LONG *a1, int a2)
{
  LONG v3; // ecx

  sub_55214(&WinMgr, a1[3], a1[4], a1[5], a1[6]);
  v3 = a1[6] - a2;
  a1[4] -= a2;
  a1[6] = v3;
}

//----- (0002B838) --------------------------------------------------------
LONG __fastcall Q_NC_sub_2B838(int a1, __int16 a2, __int16 a3)
{
  LONG v4; // edi
  PANE *v5; // ebp
  LONG result; // eax

  v4 = a2;
  v5 = (PANE *)(a1 + 8);
  while ( 1 )
  {
    result = a3 + a2;
    if ( v4 >= result )
    {
      break;
    }
    VFX_character_draw(v5, 1, 1, *(void **)a1, v4, 0);
    VFX_pane_refresh(v5, *(_DWORD *)(a1 + 0xC), *(_DWORD *)(a1 + 0x10), *(_DWORD *)(a1 + 0x14), *(_DWORD *)(a1 + 0x18));
    ++v4;
    getch();
  }
  return result;
}

//----- (0002B8A8) --------------------------------------------------------
int __fastcall sub_2B8A8(P_Font a1, int a2, int a3, const char *text, __int16 a5, __int16 a6, __int16 a7, int a8)
{
  __int16 Unknown_1C; // ax
  char *v10; // ebp
  char *v11; // ebx
  char *v12; // ecx
  unsigned int v13; // edi
  int v14; // eax
  int v15; // eax
  int v16; // edx
  char *v17; // ebp
  int v18; // edx
  int v19; // edx
  int v21; // [esp+0h] [ebp-40h]
  int v22; // [esp+4h] [ebp-3Ch]
  char *ptr; // [esp+Ch] [ebp-34h]
  int i; // [esp+14h] [ebp-2Ch]
  int v26; // [esp+18h] [ebp-28h]
  int v28; // [esp+20h] [ebp-20h]
  char v29; // [esp+30h] [ebp-10h]

  if ( (a5 & 0x80) != 0 && a7 != 0xFF )
  {
    Unknown_1C = a7;
    if ( a7 == 0xFFFFFFFF )
    {
      Unknown_1C = a1->Unknown_1C;
    }
    VFX_pane_wipe(&a1->pane, Unknown_1C);
  }
  if ( a6 == 0xFFFFFFFF )
  {
    LOBYTE(a6) = 0xF3;
  }
  a1->pFontTranslate[0xF3] = a6;
  if ( a8 < 1 )
  {
    a8 = a1->pane.x1 - a1->pane.x0;
  }
  ptr = strdup(text);
  v10 = ptr;
  v11 = ptr;
  v12 = ptr;
  v28 = 1;
  v13 = 0;
  do
  {
    if ( !*v11 )
    {
      v13 = 0xFFFFFFFF;
    }
    v29 = *v11;
    *v11 = 0;
    v14 = sub_2B4F4(a1, v10);
    *v11 = v29;
    if ( v29 == 0xA )
    {
      *v11 = 0;
      v10 = ++v11;
      ++v28;
    }
    else if ( v14 <= a8 || v12 <= v10 )
    {
      if ( *v11 == 0x20 )
      {
        v12 = v11;
      }
      ++v11;
    }
    else
    {
      v10 = v12 + 1;
      *v12 = 0;
      v11 = v12 + 1;
      ++v28;
    }
  }
  while ( !v13 );
  v26 = Q_FONT_CPP_GetFontHeight_sub_2B594(a1) + 2;
  v21 = v28 * v26;
  if ( (a5 & 0x10) != 0 )
  {
    v15 = a3 - v21;
  }
  else
  {
    v16 = v21 + 1;
    if ( (a5 & 1) != 0 )
    {
      v15 = (a1->pane.y1 - a1->pane.y0 - v16) / 2;
    }
    else
    {
      if ( (a5 & 4) != 0 )
      {
        v22 = a3 - v16 / 2;
        goto LABEL_30;
      }
      v15 = a3;
    }
  }
  v22 = v15;
LABEL_30:
  v17 = ptr;
  for ( i = 0; i < v28; ++i )
  {
    v18 = sub_2B4F4(a1, v17);
    if ( (a5 & 0x20) != 0 )
    {
      v19 = a2 - v18;
    }
    else if ( (a5 & 2) != 0 )
    {
      v19 = (a1->pane.x1 - a1->pane.x0 - v18) / 2;
    }
    else if ( (a5 & 8) != 0 )
    {
      v19 = a2 - v18 / 2;
    }
    else
    {
      v19 = a2;
    }
    Q_FONT_CPP_sub_2B610(a1, v19, v22, v17, a5, 0xFFFFFFFE, a7);
    v17 += strlen(v17) + 1;
    v22 += v26;
  }
  if ( (a5 & 0x80) != 0 )
  {
    sub_552CC(&WinMgr, &a1->pane);
  }
  free(ptr);
  return v28 * v26;
}
// 2B8A8: could not find valid save-restore pair for ebx

//----- (0002BB50) --------------------------------------------------------
void sub_2BB50()
{
  _wcpp_2_mod_register_(&dword_96780);
  Q_Type6Ctor_sub_2BD4C(&V_Type6_stru_D8654);
  dword_96788 = 1;
}
// 96780: using guessed type _DWORD dword_96780;
// 96788: using guessed type int dword_96788;

//----- (0002BB74) --------------------------------------------------------
void __fastcall sub_2BB74(PANE *pane, LONG a2, LONG y1, LONG x1, LONG y0, unsigned __int8 a6, int a7)
{
  PANE source; // [esp+0h] [ebp-20h] BYREF
  LONG v9; // [esp+14h] [ebp-Ch]
  LONG v10; // [esp+18h] [ebp-8h]
  LONG v11; // [esp+1Ch] [ebp-4h]

  v11 = a2;
  v10 = y1;
  v9 = x1;
  if ( a7 == 0xFFFFFFFF )
  {
    source.window = pane->window;
    source.x0 = v11;
    source.y1 = y0;
    source.x1 = x1;
    source.y0 = y1;
    VFX_pane_copy(&source, 0, 0, pane, v11, y1, a6);
  }
  else
  {
    VFX_line_draw(pane, v11, y1, x1, y1, 0, a6);
    VFX_line_draw(pane, v11, y0, v9, y0, 0, a6);
    VFX_line_draw(pane, v11, v10, v11, y0, 0, a6);
    VFX_line_draw(pane, v9, v10, v9, y0, 0, a6);
  }
}
// 2BB74: could not find valid save-restore pair for ebx

//----- (0002BC40) --------------------------------------------------------
void __fastcall Q_GSYSTEM_CPP_sub_2BC40(PANE *pane, void *shape_table, LONG shape_number, int *hotX, int *hotY)
{
  int v6; // ebx
  int v7; // eax
  int v8; // eax
  RECT r; // [esp+0h] [ebp-18h] BYREF
  LONG v10; // [esp+10h] [ebp-8h]
  void *v11; // [esp+14h] [ebp-4h]

  v11 = shape_table;
  v10 = shape_number;
  if ( !pane )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x40);
  }
  if ( !v11 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x41);
  }
  VFX_shape_visible_rectangle(v11, v10, 0, 0, 0, &r);
  v6 = r.y1 - r.y0;
  v7 = pane->x1 - pane->x0 - (r.x1 - r.x0);
  *hotX = v7;
  if ( v7 )
  {
    *hotX = v7 / 2;
  }
  v8 = pane->y1 - pane->y0 - v6;
  *hotY = v8;
  if ( v8 )
  {
    *hotY = v8 / 2;
  }
  *hotX -= r.x0;
  *hotY -= r.y0;
}

//----- (0002BCF4) --------------------------------------------------------
void __fastcall sub_2BCF4(int a1, unsigned __int8 a2)
{
  sub_2BD04(&V_Type6_stru_D8654, a2, 0);
}

//----- (0002BD04) --------------------------------------------------------
void __fastcall sub_2BD04(P_Type6 a1, char a2, char *a3)
{
  char v4; // dh
  int i; // kr04_4
  char v6; // dl
  char v7; // dl
  char v8; // dl
  char v9; // [esp+0h] [ebp-14h]
  char v10; // [esp+1h] [ebp-13h]
  char v11; // [esp+2h] [ebp-12h]

  if ( !a2 )
  {
    Q_PaletteGet_sub_2C2B0(a1, 0, 0x100, a1->palette1);
  }
  if ( a3 )
  {
    v9 = *a3;
    v10 = a3[1];
    v11 = a3[2];
  }
  else
  {
    v9 = 0;
    v10 = 0;
    v11 = 0;
  }
  v4 = 0x40 - a2;
  if ( (char)(0x40 - a2) < 0 )
  {
    v4 = 0;
  }
  for ( i = 0; i != 0x100; ++i )
  {
    v8 = a1->palette1[i].r - v9;
    if ( v8 >= 0 )
    {
      if ( (char)(v8 - v4) > 0 )
      {
        --a1->palette1[i].r;
      }
    }
    else if ( (char)(v4 + v8) < 0 )
    {
      ++a1->palette1[i].r;
    }
    v6 = a1->palette1[i].g - v10;
    if ( v6 >= 0 )
    {
      if ( (char)(v6 - v4) > 0 )
      {
        --a1->palette1[i].g;
      }
    }
    else if ( (char)(v4 + v6) < 0 )
    {
      ++a1->palette1[i].g;
    }
    v7 = a1->palette1[i].b - v11;
    if ( v7 >= 0 )
    {
      if ( (char)(v7 - v4) > 0 )
      {
        --a1->palette1[i].b;
      }
    }
    else if ( (char)(v4 + v7) < 0 )
    {
      ++a1->palette1[i].b;
    }
  }
  Q_PaletteSet_sub_2C224(a1, 0, 0x100, a1->palette1);
}

//----- (0002BD4C) --------------------------------------------------------
void __fastcall Q_Type6Ctor_sub_2BD4C(P_Type6 a1)
{
  a1->window.buffer = 0;
  a1->pane.window = 0;
  *(_DWORD *)&a1->fname[0xFF] = 0;
  a1->fname[0] = 0;
  a1->hazeTables = 0;
  a1->numTables = 0;
}

//----- (0002BD7C) --------------------------------------------------------
T_Type6 *__fastcall Q_Type6Dtor_sub_2BD7C(T_Type6 *a1)
{
  Q_StopVideoSystem_sub_2C6CC(a1);
  return a1;
}

//----- (0002BD88) --------------------------------------------------------
unsigned int __fastcall sub_2BD88(P_Type6 a1, const char *a2, const char *a3)
{
  void *fname; // edx
  const char *v5; // kr08_4
  int v6; // kr0C_4
  char *v7; // kr38_4
  int v8; // kr3C_4
  char v9; // al
  char v10; // al
  int v11; // kr14_4
  char *v12; // kr40_4
  int v13; // kr44_4
  char v14; // al
  char v15; // al
  char *v16; // edi
  const char *v17; // kr18_4
  int v18; // kr1C_4
  int v19; // kr4C_4
  char v20; // al
  char v21; // al
  int v22; // kr24_4
  char *v23; // kr50_4
  int v24; // kr54_4
  char v25; // al
  char v26; // al
  void *v27; // esi
  unsigned int result; // eax
  char *v29; // edi
  BYTE *v30; // esi
  int v31; // ecx
  bool v32; // zf
  int v33; // kr2C_4
  int v34; // kr5C_4
  char v35; // al
  char v36; // al
  int v37; // kr34_4
  int v38; // kr64_4
  char v39; // al
  char v40; // al
  UBYTE *buffer; // ecx
  UBYTE *v42; // eax
  int a; // eax
  int b; // eax
  int v45; // eax
  int v46; // eax
  UBYTE *v47; // edi
  char *v48; // [esp-4h] [ebp-234h]
  T_FileInfo v49; // [esp+0h] [ebp-230h] BYREF
  char v50[256]; // [esp+118h] [ebp-118h] BYREF
  const char *v51; // [esp+218h] [ebp-18h]
  void *drvr; // [esp+21Ch] [ebp-14h]

  v51 = a2;
  fname = a1->fname;
  v48 = a1->fname;
  v5 = v51;
  v6 = 0;
  v7 = a1->fname;
  v8 = 0;
  do
  {
    v9 = v5[2 * v6];
    v7[2 * v8] = v9;
    if ( !v9 )
    {
      break;
    }
    v10 = v5[2 * v6 + 1];
    v7[2 * v8 + 1] = v10;
    ++v6;
    ++v8;
  }
  while ( v10 );
  v11 = 0;
  v12 = &v48[strlen(v48)];
  v13 = 0;
  do
  {
    v14 = asc_91762[2 * v11];
    v12[2 * v13] = v14;
    if ( !v14 )
    {
      break;
    }
    v15 = asc_91762[2 * v11 + 1];
    v12[2 * v13 + 1] = v15;
    ++v11;
    ++v13;
  }
  while ( v15 );
  v16 = v48;
  if ( a3 )
  {
    v31 = 0xFFFFFFFF;
    do
    {
      if ( !v31 )
      {
        break;
      }
      v32 = *v16++ == 0;
      --v31;
    }
    while ( !v32 );
    v37 = 0;
    v38 = 0;
    do
    {
      v39 = a3[2 * v37];
      v16[2 * v38 + 0xFFFFFFFF] = v39;
      if ( !v39 )
      {
        break;
      }
      v40 = a3[2 * v37 + 1];
      v16[2 * v38] = v40;
      ++v37;
      ++v38;
    }
    while ( v40 );
  }
  else
  {
    v17 = v51;
    v18 = 0;
    v19 = 0;
    do
    {
      v20 = v17[2 * v18];
      v50[2 * v19] = v20;
      if ( !v20 )
      {
        break;
      }
      v21 = v17[2 * v18 + 1];
      v50[2 * v19 + 1] = v21;
      ++v18;
      ++v19;
    }
    while ( v21 );
    a3 = (const char *)0x200;
    v22 = 0;
    v23 = &v50[strlen(v50)];
    v24 = 0;
    do
    {
      v25 = aVfxscanDll[2 * v22];
      v23[2 * v24] = v25;
      if ( !v25 )
      {
        break;
      }
      v26 = aVfxscanDll[2 * v22 + 1];
      v23[2 * v24 + 1] = v26;
      ++v22;
      ++v24;
    }
    while ( v26 );
    Q_InitFileInfo_sub_1BB78(&v49);
    Q_OpenFile_sub_1BBFC(&v49, v50, 0x200, 0);
    v27 = Q_CfileLoad_sub_1BF1C(&v49, 0);
    if ( !v27 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x9F);
    }
    Q_CloseFileAndDelete_sub_1BBC8(&v49);
    drvr = DLL_load(v27, 5u, 0);
    sub_2627C(v27);
    fname = drvr;
    operator delete(v27);
    if ( !fname )
    {
      return 0;
    }
    v29 = a1->fname;
    v30 = VFX_driver_name(fname);
    v31 = 0xFFFFFFFF;
    do
    {
      if ( !v31 )
      {
        break;
      }
      v32 = *v29++ == 0;
      --v31;
    }
    while ( !v32 );
    v33 = 0;
    v34 = 0;
    do
    {
      v35 = v30[2 * v33];
      v29[2 * v34 + 0xFFFFFFFF] = v35;
      if ( !v35 )
      {
        break;
      }
      v36 = v30[2 * v33 + 1];
      v29[2 * v34] = v36;
      ++v33;
      ++v34;
    }
    while ( v36 );
    free(drvr);
  }
  result = Q_GSYSTEM_CPP_sub_2BFDC(a1, (int)fname, (int)a3, v31);
  if ( result )
  {
    VFX_init_driver();
    buffer = a1->window.buffer;
    *(_DWORD *)&a1->fname[0xFF] = 0xFFFFFFFF;
    if ( buffer )
    {
      sub_262CC(buffer);
    }
    v42 = (UBYTE *)sub_262B0(a1->b * a1->a, 1u, 1, "OFFSCREEN BUFFER");
    a1->window.stencil = 0;
    a1->window.buffer = v42;
    a = a1->a;
    a1->window.shadow = 0;
    a1->window.x_max = a - 1;
    b = a1->b;
    a1->pane.x0 = 0;
    a1->window.y_max = b - 1;
    v45 = a1->a;
    a1->pane.y0 = 0;
    a1->pane.x1 = v45 - 1;
    v46 = a1->b;
    a1->pane.window = &a1->window;
    v47 = a1->window.buffer;
    a1->pane.y1 = v46 - 1;
    if ( !v47 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0xD9);
    }
    return 0xFFFFFFFF;
  }
  return result;
}
// 2BE8B: conditional instruction was optimized away because esi.4!=0
// 76D64: using guessed type void __fastcall operator delete(void *);
// 2BD88: using guessed type char var_118[256];

//----- (0002BFDC) --------------------------------------------------------
unsigned int __fastcall Q_GSYSTEM_CPP_sub_2BFDC(P_Type6 a1, int a2, int a3, int a4)
{
  void *v5; // esi
  void *v6; // edx
  VFX_DESC *VFX; // eax
  T_FileInfo v9; // [esp-128h] [ebp-12Ch] BYREF

  Q_InitFileInfo_sub_1BB78(&v9);
  Q_OpenFile_sub_1BBFC(&v9, a1->fname, O_BINARY, 0);
  v5 = Q_CfileLoad_sub_1BF1C(&v9, 0);
  if ( !v5 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0xEB);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v9);
  v6 = DLL_load(v5, DLLMEM_ALLOC|DLLSRC_MEM, 0);
  sub_2627C(v5);
  operator delete(v5);
  if ( !v6 )
  {
    return 0;
  }
  VFX_register_driver(v6);
  VFX = VFX_describe_driver();
  a1->a = VFX->scrn_width;
  a1->b = VFX->scrn_height;
  return 0xFFFFFFFF;
}
// 2C02A: conditional instruction was optimized away because esi.4!=0
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (0002C08C) --------------------------------------------------------
void __fastcall Q_AllocateHazeTables_sub_2C08C(P_Type6 a1, unsigned __int16 numTables)
{
  void *v4; // eax

  v4 = operator new[](numTables << 8);
  Q_RegisterData_sub_2625C(v4, 1, "GSYSTEM HAZE TABLES");
  a1->hazeTables = (T_HazeTables *)v4;
  a1->numTables = numTables;
}

//----- (0002C0C0) --------------------------------------------------------
int __fastcall Q_LoadHazeTables_sub_2C0C0(P_Type6 a1, const char *a2, unsigned __int16 num)
{
  void *v4; // edi
  T_FileInfo v6; // [esp+0h] [ebp-118h] BYREF

  if ( num >= a1->numTables )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x11F);
  }
  Q_InitFileInfo_sub_1BB78(&v6);
  Q_OpenFile_sub_1BBFC(&v6, a2, 0x200, 0);
  v4 = Q_CfileLoad_sub_1BF1C(&v6, (*a1->hazeTables)[num]);
  if ( !v4 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\gsystem.cpp", 0x127);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v6);
  return (v4 == 0) - 1;
}

//----- (0002C158) --------------------------------------------------------
unsigned int __fastcall Q_LoadPal_sub_2C158(P_Type6 a1, const char *aFName, int a3, unsigned __int16 a4)
{
  T_FileInfo v8; // [esp+0h] [ebp-124h] BYREF
  unsigned __int16 from[2]; // [esp+118h] [ebp-Ch]

  *(_DWORD *)from = a3;
  Q_InitFileInfo_sub_1BB78(&v8);
  Q_OpenFile_sub_1BBFC(&v8, aFName, O_BINARY, 0);
  if ( !Q_CfileLoad_sub_1BF1C(&v8, a1->palette2) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x13C);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v8);
  Q_PaletteSet_sub_2C224(a1, from[0], a4, a1->palette2);
  return 0xFFFFFFFF;
}
// 2C1AD: conditional instruction was optimized away because ecx.4!=0

//----- (0002C1E0) --------------------------------------------------------
int __fastcall sub_2C1E0(int a1, unsigned __int16 a2, unsigned __int16 a3, unsigned int a4)
{
  __int64 v5; // rax
  int v6; // kr04_4
  int v7; // ebx

  v5 = a4;
  v6 = 0;
  while ( SHIDWORD(v5) < a3 )
  {
    v7 = 3 * (HIDWORD(v5) + a2);
    ++HIDWORD(v5);
    *(_WORD *)(v7 + a1 + 0x433) = *(_WORD *)(a4 + 3 * v6);
    *(_BYTE *)(v7 + a1 + 0x435) = *(_BYTE *)(a4 + 3 * v6++ + 2);
  }
  return v5;
}

//----- (0002C224) --------------------------------------------------------
void __fastcall Q_PaletteSet_sub_2C224(P_Type6 a1, unsigned __int16 from, __int16 count, RGB *palette)
{
  LONG v4; // esi
  int v5; // kr04_4

  VFX_wait_vblank_leading();
  v4 = from;
  v5 = 0;
  while ( v4 < (__int16)(from + count) )
  {
    VFX_DAC_write(v4++, &palette[v5++]);
  }
}

//----- (0002C264) --------------------------------------------------------
void __fastcall Q_NC_sub_2C264(T_Type6 *a1)
{
  Q_PaletteSet_sub_2C224(a1, 0, 256, a1->palette2);
}

//----- (0002C280) --------------------------------------------------------
void __fastcall Q_NC_sub_2C280(P_Type6 a1, signed __int16 a2, __int16 a3)
{
  Q_PaletteSet_sub_2C224(a1, a2, a3, &a1->palette2[a2]);
}

//----- (0002C2B0) --------------------------------------------------------
void __fastcall Q_PaletteGet_sub_2C2B0(P_Type6 a1, unsigned __int16 from, __int16 count, RGB *palette)
{
  RGB *nextrgb; // edi
  LONG v5; // esi
  int v6; // kr04_4

  nextrgb = palette;
  if ( !palette )
  {
    nextrgb = a1->palette2;
  }
  VFX_wait_vblank_leading();
  v5 = from;
  v6 = 0;
  while ( v5 < (__int16)(from + count) )
  {
    VFX_DAC_read(v5++, &nextrgb[v6++]);
  }
}

//----- (0002C2F8) --------------------------------------------------------
void __fastcall sub_2C2F8(T_Type6 *a1, char *a2)
{
  int i; // ecx
  unsigned int v4; // eax

  for ( i = 0; i < 0x40; ++i )
  {
    sub_2BD04(a1, i, a2);
    v4 = i;
    delay(v4);
  }
}

//----- (0002C418) --------------------------------------------------------
void __fastcall sub_2C418(P_Type6 a1, int a2, __int16 a3)
{
  __int16 v3; // si
  LONG v4; // [esp-8h] [ebp-10h]
  RGB v5; // [esp+0h] [ebp-8h] BYREF
  int v6; // [esp+4h] [ebp-4h]

  v6 = a2;
  v3 = a2;
  VFX_wait_vblank_leading();
  if ( (__int16)(a3 + a2) > (__int16)a2 )
  {
    do
    {
      VFX_DAC_read(v3, &v5);
      if ( v5.r )
      {
        --v5.r;
      }
      if ( v5.r )
      {
        --v5.r;
      }
      if ( v5.g )
      {
        --v5.g;
      }
      if ( v5.g )
      {
        --v5.g;
      }
      if ( v5.b )
      {
        --v5.b;
      }
      if ( v5.b )
      {
        --v5.b;
      }
      v4 = v3++;
      VFX_DAC_write(v4, &v5);
    }
    while ( v3 < (__int16)(a3 + a2) );
  }
}
// 2C418: using guessed type RGB anonymous_0;

//----- (0002C4C0) --------------------------------------------------------
void __fastcall sub_2C4C0(P_Type6 a1, int a2, int a3)
{
  __int16 i; // si
  RGB v5; // [esp+0h] [ebp-1Ch] BYREF
  int v6; // [esp+4h] [ebp-18h]
  int v7; // [esp+8h] [ebp-14h]

  v6 = a2;
  VFX_wait_vblank_leading();
  v7 = a3 + a2;
  for ( i = a2; i < (__int16)v7; ++i )
  {
    VFX_DAC_read(i, &v5);
    if ( v5.r < a1->palette2[i].r )
    {
      ++v5.r;
    }
    if ( v5.r < a1->palette2[i].r )
    {
      ++v5.r;
    }
    if ( v5.g < a1->palette2[i].g )
    {
      ++v5.g;
    }
    if ( v5.g < a1->palette2[i].g )
    {
      ++v5.g;
    }
    if ( v5.b < a1->palette2[i].b )
    {
      ++v5.b;
    }
    if ( v5.b < a1->palette2[i].b )
    {
      ++v5.b;
    }
    VFX_DAC_write(i, &v5);
  }
}

//----- (0002C5C0) --------------------------------------------------------
void __fastcall Q_NC_sub_2C5C0(T_Type6 *a1)
{
  int i; // ebx
  unsigned int v3; // eax

  for ( i = 0; i < 64; ++i )
  {
    Q_FadePalette_sub_2C5E4(a1, i);
    v3 = i;
    delay(v3);
  }
}

//----- (0002C5E4) --------------------------------------------------------
void __fastcall Q_FadePalette_sub_2C5E4(P_Type6 a1, char a2)
{
  UBYTE *color2; // ebx
  char v4; // dh
  UBYTE *color1; // eax
  char v6; // dl

  if ( !a2 )
  {
    Q_PaletteGet_sub_2C2B0(a1, 0, 256, a1->palette1);
  }
  color2 = &a1->palette2[0].r;
  v4 = 64 - a2;
  color1 = &a1->palette1[0].r;
  do
  {
    v6 = *color1 - *color2;
    if ( v6 >= 0 )
    {
      if ( (char)(v6 - v4) > 0 )
      {
        --*color1;
      }
    }
    else if ( (char)(v4 + v6) < 0 )
    {
      ++*color1;
    }
    ++color1;
    ++color2;
  }
  while ( color1 != (UBYTE *)a1->palette2 );
  Q_PaletteSet_sub_2C224(a1, 0, 256, a1->palette1);
}

//----- (0002C670) --------------------------------------------------------
void __fastcall sub_2C670(int a1, int a2, int a3, char *a4)
{
  RGB *v4; // edi
  __int16 v5; // si
  char v6[4]; // [esp+0h] [ebp-14h] BYREF
  int v7; // [esp+4h] [ebp-10h]
  int v8; // [esp+8h] [ebp-Ch]

  v8 = a2;
  v4 = (RGB *)a4;
  if ( !a4 )
  {
    v4 = (RGB *)v6;
    v6[1] = 0;
    v6[2] = 0;
    v6[0] = 0;
  }
  v5 = v8;
  v7 = a3 + v8;
  VFX_wait_vblank_leading();
  for ( ; v5 < (__int16)v7; ++v5 )
  {
    VFX_DAC_write(v5, v4);
  }
}

//----- (0002C6CC) --------------------------------------------------------
void __fastcall Q_StopVideoSystem_sub_2C6CC(P_Type6 a1)
{
  UBYTE *buffer; // ebx

  if ( *(_DWORD *)&a1->fname[0xFF] == 0xFFFFFFFF )
  {
    VFX_shutdown_driver();
  }
  buffer = a1->window.buffer;
  *(_DWORD *)&a1->fname[0xFF] = 0;
  if ( buffer )
  {
    sub_262CC(buffer);
    a1->window.buffer = 0;
  }
  if ( a1->window.shadow )
  {
    sub_262CC(a1->window.shadow);
    a1->window.shadow = 0;
  }
  sub_2627C(a1->hazeTables);
  operator delete[](a1->hazeTables);
  a1->hazeTables = 0;
  a1->numTables = 0;
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);

//----- (0002C744) --------------------------------------------------------
void __fastcall Q_GSYSTEM_CPP_PreloadMouseShp_sub_2C744(P_Type6 a1, char *a2, int a3, int a4)
{
  void *v5; // eax
  T_FileInfo v6; // [esp-124h] [ebp-128h] BYREF

  if ( V_Mouse.initialized )
  {
    if ( !a1->c )
    {
      Q_InitFileInfo_sub_1BB78(&v6);
      Q_OpenFile_sub_1BBFC(&v6, "DATA\\MOUSE.SHP", O_BINARY, 0);
      v5 = Q_CfileLoad_sub_1BF1C(&v6, 0);
      a1->c = (int)v5;
      if ( !v5 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x2B3);
      }
      a1->d = 0;
      Q_CloseFileAndDelete_sub_1BBC8(&v6);
    }
    MOUSE_set_pointer((void *)a1->c, a1->d);
  }
}

//----- (0002C7D0) --------------------------------------------------------
void __fastcall Q_GSYSTEM_CPP_sub_2C7D0(T_Type6 *a1, int a2, int a3)
{
  void *c; // ecx

  c = (void *)a3;
  if ( !a3 )
  {
    c = (void *)a1->c;
  }
  if ( !c )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x2C7);
  }
  if ( a2 < 0 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x2C8);
  }
  MOUSE_set_pointer(c, a2);
}
// 2C80C: conditional instruction was optimized away because ecx.4!=0

//----- (0002C830) --------------------------------------------------------
void __fastcall __spoils<> Q_A2Ctor_sub_2C830(P_TypeA2 a1)
{
  a1->procs = (P_Procs)off_95E20;
  Q_A1_sub_2C8E4(&a1->a1);
}
// 95E20: using guessed type int (*off_95E20[2])();

//----- (0002C848) --------------------------------------------------------
P_TypeA2 __fastcall Q_A2Dtor_sub_2C848(P_TypeA2 a1, char a2)
{
  char *v3; // eax
  T_ChildWindows *children; // edx
  __int16 i; // ax
  P_TypeA1 v6; // edx
  int parentIndex; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, &C_A2);
    operator delete[](v3);
  }
  else
  {
    children = a1->a1.children;
    a1->procs = (P_Procs)off_95E20;
    if ( children )
    {
      for ( i = 0; i < 20; ++i )
      {
        v6 = (*a1->a1.children)[i];
        if ( v6 )
        {
          v6->parentIndex = 0;
        }
      }
      sub_262CC(a1->a1.children);
    }
    parentIndex = a1->a1.parentIndex;
    if ( parentIndex )
    {
      sub_2CA0C(&WinMgr.wnds[parentIndex].a2->a1, &a1->a1, parentIndex);
    }
    if ( (a2 & 2) != 0 )
    {
      operator delete(a1);
    }
  }
  return a1;
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95E20: using guessed type int (*off_95E20[2])();

//----- (0002C8E4) --------------------------------------------------------
void __fastcall __spoils<> Q_A1_sub_2C8E4(P_TypeA1 a1)
{
  a1->index = 0;
  a1->pane.window = 0;
  a1->d = 0xFFFF;
  a1->e = 0;
  a1->shapeFrame = 0xFFFF;
  a1->name[0] = 0;
  a1->i = 0;
  a1->j = 0;
  a1->_mouseFocus = 0;
  a1->r = 0xFFFF;
  a1->s = 0xFFFF;
  a1->t = 0xFFFF;
  a1->u = 0;
  a1->sendMessage = 0;
  a1->sendParam1 = 0;
  a1->sendParam2 = 0;
  a1->helpIndex[0] = 0;
  a1->parentIndex = 0;
  a1->children = 0;
  a1->childrenCnt = 0;
  a1->z = 0;
  a1->zz = 0xFFFFFFFF;
}

//----- (0002C978) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_2C978(P_TypeA1 a1)
{
  a1->index = Q_WINMGR_CPP_RegisterWindow_sub_571B8(&WinMgr, a1);
}

//----- (0002C990) --------------------------------------------------------
unsigned int __fastcall Q_GWINDOW_CPP_LinkChild_sub_2C990(P_TypeA1 a1, P_TypeA1 a2)
{
  T_ChildWindows *children; // eax
  __int16 childrenCnt; // ax

  if ( !a1->childrenCnt )
  {
    if ( a1->children )
    {
      sub_262CC(a1->children);
    }
    children = (T_ChildWindows *)Q_Allocate_sub_2628C(0x50u, 1, "CHILD WINDOWS");
    a1->children = children;
    memset(children, 0, sizeof(T_ChildWindows));
  }
  if ( (__int16)a1->childrenCnt >= 20 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x94);
  }
  childrenCnt = a1->childrenCnt;
  a1->childrenCnt = childrenCnt + 1;
  (*a1->children)[childrenCnt] = a2;
  return 0xFFFFFFFF;
}

//----- (0002CA0C) --------------------------------------------------------
unsigned int __fastcall sub_2CA0C(P_TypeA1 a1, P_TypeA1 a2, int a3)
{
  unsigned int v3; // esi
  __int16 i; // kr00_2

  v3 = 0;
  if ( a1->children )
  {
    for ( i = 0; i < 20; ++i )
    {
      if ( a2 == *(P_TypeA1 *)a3 )
      {
        *(_DWORD *)a3 = 0;
        v3 = 0xFFFFFFFF;
        --a1->childrenCnt;
      }
    }
  }
  return v3;
}

//----- (0002CA58) --------------------------------------------------------
int __fastcall Q_NC_sub_2CA58(int a1)
{
  return (*(int (**)(void))(*(_DWORD *)(a1 + 0xA7) + 4))();
}

//----- (0002CA78) --------------------------------------------------------
_DWORD *__fastcall sub_2CA78(_DWORD *result, __int16 a2, __int16 a3)
{
  int v3; // edi
  int v4; // ebp
  int v5; // esi

  v3 = result[3];
  v4 = result[5];
  v5 = a2 + result[4];
  result[2] += a2;
  result[4] = v5;
  result[3] = a3 + v3;
  result[5] = a3 + v4;
  return result;
}

//----- (0002CD24) --------------------------------------------------------
void __fastcall sub_2CD24(unsigned int a1, int a2)
{
  void *ShapeTable_sub_1B084; // eax
  __int16 v3; // ax
  LONG v4; // [esp-18h] [ebp-1Ch]
  LONG v5; // [esp-14h] [ebp-18h]
  LONG v6; // [esp-Ch] [ebp-10h]

  if ( *(_DWORD *)(a1 + 0x39) )
  {
    if ( (*(_DWORD *)WinMgr.z1aa == *(_DWORD *)(a1 + 0x41) || a2 == 3) && *(_DWORD *)(a1 + 0x3D) && a2 != 2 )
    {
      (*(void (__fastcall **)(unsigned int, int))(*(_DWORD *)(a1 + 0xA7) + 0x10))(a1, a2);
    }
    else
    {
      if ( *(__int16 *)(a1 + 0x1E) == 0xFFFFFFFF )
      {
        if ( *(_WORD *)(a1 + 0xA1) )
        {
          sub_2D0F4(a1, 0);
        }
        else
        {
          VFX_pane_wipe((PANE *)(a1 + 4), 0xF2);
          WinMgr.LargeFont.pane = *(PANE *)(a1 + 4);
          v3 = 0;
          if ( *(__int16 *)(a1 + 0x5B) == 0xFFFFFFFF )
          {
            v3 = 2;
          }
          if ( *(__int16 *)(a1 + 0x5D) == 0xFFFFFFFF )
          {
            LOBYTE(v3) = v3 | 1;
          }
          sub_2B8A8(&WinMgr.LargeFont, *(__int16 *)(a1 + 0x5B), *(__int16 *)(a1 + 0x5D), (const char *)(a1 + 0x20), v3, 0xFFFFFFFF, 0xFF, 0);
          if ( *(_DWORD *)(a1 + 0x5F) == 0xFFFFFFFF )
          {
            VFX_line_draw((PANE *)(a1 + 4), 0, 0, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), 0, 0, 0xF3);
            VFX_line_draw((PANE *)(a1 + 4), 0, 0, 0, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), 0, 0xF3);
            v5 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
            VFX_line_draw((PANE *)(a1 + 4), *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), v5, 0, v5, 0, 0xF3);
            v4 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8);
            VFX_line_draw((PANE *)(a1 + 4), v4, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), v4, 0, 0, 0xF3);
          }
        }
      }
      else
      {
        v6 = *(__int16 *)(a1 + 0x1E);
        ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 0x18));
        VFX_shape_draw((PANE *)(a1 + 4), ShapeTable_sub_1B084, v6, 0, 0);
      }
      sub_55274(&WinMgr, *(_DWORD *)(a1 + 8), *(_DWORD *)(a1 + 0xC), *(_DWORD *)(a1 + 0x10), *(_DWORD *)(a1 + 0x14));
    }
    if ( *(_WORD *)(a1 + 0x6B) )
    {
      sub_2D218((_DWORD *)a1);
    }
  }
}

//----- (0002CF28) --------------------------------------------------------
void __fastcall sub_2CF28(unsigned int a1)
{
  PANE *v1; // esi
  void *ShapeTable_sub_1B084; // eax
  __int16 v3; // ax
  LONG v4; // [esp-18h] [ebp-1Ch]
  LONG v5; // [esp-14h] [ebp-18h]
  LONG v6; // [esp-Ch] [ebp-10h]

  v1 = (PANE *)(a1 + 4);
  if ( *(__int16 *)(a1 + 0x1E) == 0xFFFFFFFF )
  {
    if ( *(_WORD *)(a1 + 0xA1) )
    {
      sub_2D0F4(a1, 1);
    }
    else
    {
      VFX_pane_wipe((PANE *)(a1 + 4), 0x96);
      WinMgr.LargeFont.pane = *(PANE *)(a1 + 4);
      v3 = 0;
      if ( *(__int16 *)(a1 + 0x5B) == 0xFFFFFFFF )
      {
        v3 = 2;
      }
      if ( *(__int16 *)(a1 + 0x5D) == 0xFFFFFFFF )
      {
        LOBYTE(v3) = v3 | 1;
      }
      sub_2B8A8(&WinMgr.LargeFont, *(__int16 *)(a1 + 0x5B), *(__int16 *)(a1 + 0x5D), (const char *)(a1 + 0x20), v3, 0xFFFFFFFF, 0xFF, 0);
      if ( *(_DWORD *)(a1 + 0x5F) == 0xFFFFFFFF )
      {
        VFX_line_draw((PANE *)(a1 + 4), 0, 0, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), 0, 0, 0xF3);
        VFX_line_draw((PANE *)(a1 + 4), 0, 0, 0, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), 0, 0xF3);
        v5 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
        VFX_line_draw((PANE *)(a1 + 4), *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), v5, 0, v5, 0, 0xF3);
        v4 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8);
        VFX_line_draw((PANE *)(a1 + 4), v4, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), v4, 0, 0, 0xF3);
      }
    }
  }
  else
  {
    VFX_shape_lookaside((UBYTE *)WinMgr.hazeTableMapFocus);
    v6 = *(__int16 *)(a1 + 0x1E);
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 0x18));
    VFX_shape_translate_draw(v1, ShapeTable_sub_1B084, v6, 0, 0);
  }
  sub_55274(&WinMgr, *(_DWORD *)(a1 + 8), *(_DWORD *)(a1 + 0xC), *(_DWORD *)(a1 + 0x10), *(_DWORD *)(a1 + 0x14));
}

//----- (0002D0F4) --------------------------------------------------------
unsigned int __fastcall sub_2D0F4(unsigned int a1, int a2)
{
  LONG v2; // eax
  PANE *v3; // esi
  unsigned int result; // eax
  unsigned int v5; // kr00_4
  int i; // kr04_4
  char *v7; // eax
  int v8; // ebx
  int v9; // edx
  void *ShapeTable_sub_1B084; // eax
  __int16 v11; // [esp-10h] [ebp-30h]
  LONG v12; // [esp-Ch] [ebp-2Ch]
  LONG v13; // [esp-8h] [ebp-28h]
  LONG v14; // [esp-4h] [ebp-24h]
  int v16; // [esp+8h] [ebp-18h]

  v2 = 0xF2;
  if ( a2 )
  {
    v2 = 0x96;
  }
  v3 = (PANE *)(a1 + 4);
  VFX_pane_wipe((PANE *)(a1 + 4), v2);
  result = a1;
  v16 = 0;
  v5 = a1 + 0x6D;
  for ( i = 0; (__int16)v16 < *(__int16 *)(a1 + 0xA1); ++i )
  {
    if ( !(v5 + 0xD * i) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x1CE);
    }
    if ( *(_BYTE *)(v5 + 0xD * i) )
    {
      if ( *(_BYTE *)(v5 + 0xD * i) == 1 )
      {
        v14 = *(__int16 *)(v5 + 0xD * i + 0xB);
        v13 = *(__int16 *)(v5 + 0xD * i + 9);
        v12 = *(_DWORD *)(v5 + 0xD * i + 5);
        ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(v5 + 0xD * i + 1));
        VFX_shape_draw(v3, ShapeTable_sub_1B084, v12, v13, v14);
      }
      else
      {
        Q_AssertLogBreakExit_sub_261A8(0, "..\\gwindow.cpp", 0x1DF);
      }
    }
    else
    {
      v7 = sub_2D3D0(*(_DWORD *)(v5 + 0xD * i + 1));
      v8 = *(__int16 *)(v5 + 0xD * i + 0xB);
      v9 = *(__int16 *)(v5 + 0xD * i + 9);
      v11 = *(_WORD *)(v5 + 0xD * i + 5);
      WinMgr.LargeFont.pane.window = v3->window;
      WinMgr.LargeFont.pane.x0 = *(_DWORD *)(a1 + 8);
      WinMgr.LargeFont.pane.y0 = *(_DWORD *)(a1 + 0xC);
      WinMgr.LargeFont.pane.x1 = *(_DWORD *)(a1 + 0x10);
      WinMgr.LargeFont.pane.y1 = *(_DWORD *)(a1 + 0x14);
      result = sub_2B8A8(&WinMgr.LargeFont, v9, v8, v7, v11, 0xF3, 0xFF, 0);
    }
    ++v16;
  }
  return result;
}

//----- (0002D218) --------------------------------------------------------
void __fastcall sub_2D218(_DWORD *a1)
{
  __int16 i; // kr00_2
  int v2; // ecx

  if ( *(_DWORD *)((char *)a1 + 0x67) )
  {
    for ( i = 0; i < 0x14; ++i )
    {
      v2 = *a1;
      if ( *a1 )
      {
        a1 = (_DWORD *)*a1;
        if ( *(_DWORD *)(v2 + 0x39) == 0xFFFFFFFF )
        {
          (*(void (__fastcall **)(_DWORD *, _DWORD))(*(_DWORD *)(v2 + 0xA7) + 0xC))(a1, 0);
        }
      }
    }
  }
}

//----- (0002D258) --------------------------------------------------------
void __fastcall sub_2D258(P_TypeA2 a1, __int16 a2)
{
  __int16 i; // si
  P_TypeA1 v4; // ebx

  if ( a1->a1.children )
  {
    for ( i = 0; i < 0x14; ++i )
    {
      v4 = (*a1->a1.children)[i];
      if ( v4 && (v4->i || a2 == 1) )
      {
        (*(void (**)(void))((*a1->a1.children)[i][1].magic12345678 + 8))();
      }
    }
  }
}

//----- (0002D2CC) --------------------------------------------------------
int Q_GWINDOW_CPP_LoadGwshareTxt_sub_2D2CC()
{
  FILE *v0; // ecx
  int i; // kr04_4
  char filename[52]; // [esp+0h] [ebp-34h] BYREF

  v0 = Q_OpenFile_sub_1BB10("gwshare.txt", 0);
  if ( !v0 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x214);
  }
  for ( i = 0; i != 0x2D; ++i )
  {
    fscanf(v0, "%s", filename);
    word_FFE9E[i + 1] = Q_CACHE_CPP_sub_1ADAC(&WinMgr.t13, filename);
  }
  return fclose(v0);
}
// FFE9E: using guessed type __int16 word_FFE9E[];
// 2D2CC: using guessed type char filename[52];

//----- (0002D334) --------------------------------------------------------
int __fastcall sub_2D334(const char *a1)
{
  char *v2; // kr04_4
  int v3; // kr08_4
  int v4; // kr0C_4
  char v5; // al
  char v6; // al
  int result; // eax

  if ( !a1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x226);
  }
  if ( (int)(strlen(a1) + SHIWORD(dword_100302)) >= 0x400 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x229);
  }
  v3 = 0;
  v2 = (char *)&unk_FFF04 + SHIWORD(dword_100302);
  v4 = 0;
  do
  {
    v5 = a1[2 * v3];
    v2[2 * v4] = v5;
    if ( !v5 )
    {
      break;
    }
    v6 = a1[2 * v3 + 1];
    v2[2 * v4 + 1] = v6;
    ++v3;
    ++v4;
  }
  while ( v6 );
  result = SHIWORD(dword_100302);
  HIWORD(dword_100302) += (_WORD)a1;
  return result;
}
// 2D334: could not find valid save-restore pair for edi
// 100302: using guessed type int dword_100302;

//----- (0002D3D0) --------------------------------------------------------
char *__fastcall sub_2D3D0(int a1)
{
  if ( a1 >= SHIWORD(dword_100302) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x237);
  }
  return (char *)&unk_FFF04 + a1;
}
// 100302: using guessed type int dword_100302;

//----- (0002D400) --------------------------------------------------------
unsigned int __fastcall sub_2D400(int a1, int a2)
{
  unsigned int result; // eax
  __int16 v4; // cx

  if ( *(__int16 *)(a1 + 0xA1) < 4 )
  {
    v4 = *(_WORD *)(a1 + 0xA1);
    *(_WORD *)(a1 + 0xA1) = v4 + 1;
    result = 0xFFFFFFFF;
    *(_DWORD *)(a1 + 0xD * v4 + 0x6D) = *(_DWORD *)a2;
    *(_DWORD *)(a1 + 0xD * v4 + 0x71) = *(_DWORD *)(a2 + 4);
    *(_DWORD *)(a1 + 0xD * v4 + 0x75) = *(_DWORD *)(a2 + 8);
    *(_BYTE *)(a1 + 0xD * v4 + 0x79) = *(_BYTE *)(a2 + 0xC);
  }
  else
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\gwindow.cpp", 0x241);
    return 0;
  }
  return result;
}

//----- (0002D464) --------------------------------------------------------
void __fastcall __spoils<> Q_A4_sub_2D464(P_TypeA4TogWnd a1)
{
  Q_A2Ctor_sub_2C830(&a1->a);
  a1->a.procs = (P_Procs)off_95E08;
  Q_A4_sub_2D4C4(a1);
}
// 95E08: using guessed type int (*off_95E08[5])();

//----- (0002D480) --------------------------------------------------------
T_TypeA2 *__fastcall sub_2D480(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_95D68);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95E08;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95E08: using guessed type int (*off_95E08[5])();

//----- (0002D4C4) --------------------------------------------------------
void __fastcall __spoils<> Q_A4_sub_2D4C4(P_TypeA4TogWnd result)
{
  result->buttonState = 0;
}

//----- (0002D4D0) --------------------------------------------------------
unsigned int __fastcall sub_2D4D0(_DWORD *a1, __int16 a2, LONG a3, LONG a4)
{
  if ( (unsigned __int16)a2 < 4u || (unsigned __int16)a2 > 5u || a3 < a1[2] || a3 > a1[4] || a4 < a1[3] || a4 > a1[5] )
  {
    return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
  }
  *(_DWORD *)((char *)a1 + 0xAB) = ~*(_DWORD *)((char *)a1 + 0xAB);
  (*(void (__fastcall **)(_DWORD *, _DWORD))(*(_DWORD *)((char *)a1 + 0xA7) + 0x10))(a1, 0);
  return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
}

//----- (0002D528) --------------------------------------------------------
void __fastcall sub_2D528(int a1, int a2)
{
  PANE *v2; // esi
  void *ShapeTable_sub_1B084; // eax
  void *v4; // eax
  LONG v5; // eax
  LONG v6; // [esp-18h] [ebp-1Ch]
  LONG v7; // [esp-14h] [ebp-18h]
  LONG v8; // [esp-Ch] [ebp-10h]
  LONG v9; // [esp-Ch] [ebp-10h]
  T_HazeTable *hazeTableMapFocus; // [esp-4h] [ebp-8h]

  if ( *(_DWORD *)(a1 + 0x39) )
  {
    if ( (*(_DWORD *)WinMgr.z1aa == *(_DWORD *)(a1 + 0x41) || a2 == 3) && *(_DWORD *)(a1 + 0x3D) && a2 != 2 )
    {
      (*(void (__fastcall **)(int, int))(*(_DWORD *)(a1 + 0xA7) + 0x10))(a1, a2);
    }
    else
    {
      if ( *(__int16 *)(a1 + 0x1E) == 0xFFFFFFFF )
      {
        v5 = 0xF2;
        if ( *(_DWORD *)(a1 + 0xAB) == 0xFFFFFFFF )
        {
          v5 = 0x50;
        }
        VFX_pane_wipe((PANE *)(a1 + 4), v5);
        WinMgr.LargeFont.pane = *(PANE *)(a1 + 4);
        if ( *(__int16 *)(a1 + 0x5B) == 0xFFFFFFFF && *(__int16 *)(a1 + 0x5D) == 0xFFFFFFFF )
        {
          sub_2B8A8(&WinMgr.LargeFont, 0, 0, (const char *)(a1 + 0x20), 3, 0xFFFFFFFF, 0xFF, 0);
        }
        else
        {
          sub_2B8A8(&WinMgr.LargeFont, *(__int16 *)(a1 + 0x5B), *(__int16 *)(a1 + 0x5D), (const char *)(a1 + 0x20), 0, 0xFFFFFFFF, 0xFF, 0);
        }
        if ( *(_DWORD *)(a1 + 0x5F) == 0xFFFFFFFF )
        {
          VFX_line_draw((PANE *)(a1 + 4), 0, 0, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), 0, 0, 0xF3);
          VFX_line_draw((PANE *)(a1 + 4), 0, 0, 0, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), 0, 0xF3);
          v7 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
          VFX_line_draw((PANE *)(a1 + 4), *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), v7, 0, v7, 0, 0xF3);
          v6 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8);
          VFX_line_draw((PANE *)(a1 + 4), v6, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), v6, 0, 0, 0xF3);
        }
      }
      else
      {
        v2 = (PANE *)(a1 + 4);
        if ( *(_DWORD *)(a1 + 0xAB) == 0xFFFFFFFF )
        {
          hazeTableMapFocus = WinMgr.hazeTableMapFocus;
          (*WinMgr.hazeTableMapFocus)[0xF2] = 0x50;
          VFX_shape_lookaside((UBYTE *)hazeTableMapFocus);
          v8 = *(__int16 *)(a1 + 0x1E);
          ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 0x18));
          VFX_shape_translate_draw(v2, ShapeTable_sub_1B084, v8, 0, 0);
          (*WinMgr.hazeTableMapFocus)[0xF2] = 0x96;
        }
        else
        {
          v9 = *(__int16 *)(a1 + 0x1E);
          v4 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 0x18));
          VFX_shape_draw(v2, v4, v9, 0, 0);
        }
      }
      sub_55274(&WinMgr, *(_DWORD *)(a1 + 8), *(_DWORD *)(a1 + 0xC), *(_DWORD *)(a1 + 0x10), *(_DWORD *)(a1 + 0x14));
    }
    if ( *(_WORD *)(a1 + 0x6B) )
    {
      sub_2D218((_DWORD *)a1);
    }
  }
}

//----- (0002D79C) --------------------------------------------------------
void __fastcall sub_2D79C(int a1)
{
  PANE *v1; // esi
  void *ShapeTable_sub_1B084; // eax
  void *v3; // eax
  LONG v4; // eax
  LONG v5; // [esp-18h] [ebp-20h]
  LONG v6; // [esp-14h] [ebp-1Ch]
  LONG v7; // [esp-Ch] [ebp-14h]
  LONG v8; // [esp-Ch] [ebp-14h]
  T_HazeTable *hazeTableMapFocus; // [esp-4h] [ebp-Ch]
  PANE *pane; // [esp+0h] [ebp-8h]

  if ( *(__int16 *)(a1 + 0x1E) == 0xFFFFFFFF )
  {
    v4 = 0x96;
    if ( *(_DWORD *)(a1 + 0xAB) == 0xFFFFFFFF )
    {
      v4 = 0xCA;
    }
    pane = (PANE *)(a1 + 4);
    VFX_pane_wipe((PANE *)(a1 + 4), v4);
    WinMgr.LargeFont.pane = *(PANE *)(a1 + 4);
    sub_2B8A8(&WinMgr.LargeFont, 0, 0, (const char *)(a1 + 0x20), 3, 0xFFFFFFFF, 0xFF, 0);
    if ( *(_DWORD *)(a1 + 0x5F) == 0xFFFFFFFF )
    {
      VFX_line_draw(pane, 0, 0, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), 0, 0, 0xF3);
      VFX_line_draw(pane, 0, 0, 0, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), 0, 0xF3);
      v6 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
      VFX_line_draw(pane, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), v6, 0, v6, 0, 0xF3);
      v5 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8);
      VFX_line_draw(pane, v5, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), v5, 0, 0, 0xF3);
    }
  }
  else
  {
    v1 = (PANE *)(a1 + 4);
    if ( *(_DWORD *)(a1 + 0xAB) == 0xFFFFFFFF )
    {
      hazeTableMapFocus = WinMgr.hazeTableMapFocus;
      (*WinMgr.hazeTableMapFocus)[0xF2] = 0xCA;
      VFX_shape_lookaside((UBYTE *)hazeTableMapFocus);
      v7 = *(__int16 *)(a1 + 0x1E);
      ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 0x18));
      VFX_shape_translate_draw(v1, ShapeTable_sub_1B084, v7, 0, 0);
      (*WinMgr.hazeTableMapFocus)[0xF2] = 0x96;
    }
    else
    {
      VFX_shape_lookaside((UBYTE *)WinMgr.hazeTableMapFocus);
      v8 = *(__int16 *)(a1 + 0x1E);
      v3 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 0x18));
      VFX_shape_translate_draw(v1, v3, v8, 0, 0);
    }
  }
  sub_55274(&WinMgr, *(_DWORD *)(a1 + 8), *(_DWORD *)(a1 + 0xC), *(_DWORD *)(a1 + 0x10), *(_DWORD *)(a1 + 0x14));
}

//----- (0002D99C) --------------------------------------------------------
int __fastcall sub_2D99C(int a1, unsigned int count, int a3)
{
  void *v5; // edx

  v5 = (void *)(a1 + 0xAB);
  if ( a3 == 0xFFFFFFFF )
  {
    return Q_ReadFile_sub_1BF94((P_FileInfo)count, v5, 4u);
  }
  else
  {
    return Q_CFILE_CPP_dos_write_sub_1C098((int *)count, v5, 4u);
  }
}

//----- (0002D9C4) --------------------------------------------------------
void __fastcall __spoils<> Q_A3_sub_2D9C4(P_TypeA3 a1)
{
  Q_A2Ctor_sub_2C830(&a1->a2);
  a1->a2.procs = (P_Procs)off_95DF0;
  a1->controls = 0;
  a1->numControls = 0;
  a1->e = 0xFFFF;
  Q_A1_sub_2DA60(&a1->a2.a1);
}
// 95DF0: using guessed type int (*off_95DF0[5])();

//----- (0002D9FC) --------------------------------------------------------
T_TypeA2 *__fastcall sub_2D9FC(T_TypeA2 *a1, char a2)
{
  char *v4; // eax
  void *magic12345678; // edx
  P_TypeA2 v7; // eax
  P_TypeA2 v8; // ebx

  if ( (a2 & 4) != 0 )
  {
    v4 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_95D54);
    operator delete[](v4);
    return a1;
  }
  else
  {
    magic12345678 = (void *)a1[1].a1.magic12345678;
    a1->procs = (P_Procs)off_95DF0;
    if ( magic12345678 )
    {
      sub_262CC(magic12345678);
      a1[1].a1.magic12345678 = 0;
    }
    v7 = Q_A2Dtor_sub_2C848(a1, 1);
    v8 = v7;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v7);
    }
    return v8;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95DF0: using guessed type int (*off_95DF0[5])();

//----- (0002DA60) --------------------------------------------------------
void __fastcall __spoils<> Q_A1_sub_2DA60(P_TypeA1 result)
{
  result->r = 7;
}

//----- (0002DA68) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_2DA68(P_TypeA1 a1)
{
  a1->index = Q_WINMGR_CPP_RegisterWindow_sub_571B8(&WinMgr, a1);
}

//----- (0002DA80) --------------------------------------------------------
MACRO_VFX_BOOL __fastcall sub_2DA80(P_TypeA3 a1, __int16 numControls)
{
  MACRO_VFX_BOOL result; // eax

  if ( numControls <= 0 )
  {
    return 0;
  }
  result = (MACRO_VFX_BOOL)sub_262B0(numControls, 0xEu, 1, "CONTROLS");
  a1->controls = (void *)result;
  if ( result )
  {
    result = TRUE;
    a1->numControls = numControls;
  }
  return result;
}

//----- (0002DAC8) --------------------------------------------------------
unsigned int __fastcall sub_2DAC8(P_TypeA3 a1, __int16 a2, __int16 a3, WORD *a4)
{
  int v5; // eax
  int i; // kr04_4
  int v7; // eax

  v5 = 0;
  for ( i = 0; v5 < a1->numControls && a2 != *((_WORD *)a1->controls + 7 * i); ++i )
  {
    ++v5;
  }
  if ( v5 >= a1->numControls )
  {
    return 0;
  }
  v7 = 0xE * v5;
  if ( a4 )
  {
    qmemcpy((char *)a1->controls + v7, a4, 0xCu);
    qmemcpy((char *)a1->controls + v7 + 0xC, a4 + 6, 2u);
  }
  else
  {
    *(_WORD *)((char *)a1->controls + v7 + 0xA) = a3;
  }
  return 0xFFFFFFFF;
}

//----- (0002DB54) --------------------------------------------------------
int __fastcall sub_2DB54(int result, __int16 a2, __int16 a3)
{
  int v4; // edi
  int v5; // ebp
  int v6; // ecx
  int v7; // ebx
  __int16 v8; // dx
  int v9; // edx

  v4 = *(_DWORD *)(result + 0xC);
  v5 = *(_DWORD *)(result + 0x14);
  v6 = a2 + *(_DWORD *)(result + 0x10);
  *(_DWORD *)(result + 8) += a2;
  *(_DWORD *)(result + 0x10) = v6;
  v7 = 0;
  *(_DWORD *)(result + 0xC) = a3 + v4;
  v8 = *(_WORD *)(result + 0xAF);
  *(_DWORD *)(result + 0x14) = a3 + v5;
  if ( v8 > 0 )
  {
    do
    {
      v9 = 0xE * (__int16)v7;
      *(_WORD *)(*(_DWORD *)(result + 0xAB) + v9 + 2) += a2;
      *(_WORD *)(*(_DWORD *)(result + 0xAB) + v9 + 4) += a2;
      *(_WORD *)(*(_DWORD *)(result + 0xAB) + v9 + 6) += a3;
      *(_WORD *)(*(_DWORD *)(result + 0xAB) + v9 + 8) += a3;
      ++v7;
    }
    while ( (__int16)v7 < *(__int16 *)(result + 0xAF) );
  }
  return result;
}

//----- (0002DBE4) --------------------------------------------------------
int __fastcall sub_2DBE4(int a1, int a2, int a3)
{
  int v4; // ecx
  int v5; // eax
  __int16 *v6; // eax
  int v7; // edx
  __int16 *v8; // eax

  v4 = a2;
  v5 = *(__int16 *)(a1 + 0xB1);
  if ( v5 != 0xFFFFFFFF )
  {
    v6 = (__int16 *)(0xE * v5 + *(_DWORD *)(a1 + 0xAB));
    if ( a2 <= v6[2] && a2 >= v6[1] && a3 <= v6[4] && a3 >= v6[3] )
    {
      LOWORD(a2) = *(_WORD *)(a1 + 0xB1);
      return a2;
    }
  }
  v7 = 0;
  if ( *(__int16 *)(a1 + 0xAF) <= 0 )
  {
    return 0xFFFFFFFF;
  }
  while ( 1 )
  {
    v8 = (__int16 *)(*(_DWORD *)(a1 + 0xAB) + 0xE * (__int16)v7);
    if ( v4 <= v8[2] && v4 >= v8[1] && a3 <= v8[4] && a3 >= v8[3] )
    {
      break;
    }
    if ( (__int16)++v7 >= *(__int16 *)(a1 + 0xAF) )
    {
      return 0xFFFFFFFF;
    }
  }
  return v7;
}

//----- (0002DCA0) --------------------------------------------------------
int __fastcall sub_2DCA0(int result, __int16 a2)
{
  int v2; // ecx
  int v4; // edx

  v2 = result;
  if ( a2 != *(_WORD *)(result + 0xB1) )
  {
    if ( a2 >= *(__int16 *)(result + 0xAF) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x396);
    }
    v4 = *(__int16 *)(result + 0xB1);
    if ( v4 != 0xFFFFFFFF )
    {
      result = 7 * v4;
      *(_BYTE *)(*(_DWORD *)(v2 + 0xAB) + 0xE * v4 + 0xA) &= ~2u;
    }
    if ( a2 != 0xFFFFFFFF )
    {
      result = *(_DWORD *)(v2 + 0xAB) + 0xE * a2;
      if ( (*(_WORD *)(result + 0xA) & 1) != 0 )
      {
        *(_BYTE *)(result + 0xA) |= 2u;
      }
    }
    *(_WORD *)(v2 + 0xB1) = a2;
  }
  return result;
}

//----- (0002DD2C) --------------------------------------------------------
int __fastcall Q_NC_sub_2DD2C(int a1, __int16 a2, __int16 a3)
{
  int v4; // esi
  int result; // eax
  __int16 v6; // di

  v4 = *(_DWORD *)(a1 + 0xAB);
  result = 7 * a3;
  v6 = *(_WORD *)(v4 + 0xE * a2 + 0xC);
  *(_WORD *)(v4 + 0xE * a2 + 0xC) = *(_WORD *)(v4 + 0xE * a3 + 0xC);
  *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0xE * a3 + 0xC) = v6;
  return result;
}

//----- (0002DD70) --------------------------------------------------------
int __fastcall sub_2DD70(int a1)
{
  int result; // eax

  for ( result = 0; (__int16)result < V_Game.racesNum; ++result )
  {
    *(_WORD *)(0xE * (__int16)result + *(_DWORD *)(a1 + 0xAB) + 0xC) = 5 * V_Game.races[(__int16)result].Unknown_02 + 0x14;
  }
  return result;
}

//----- (0002DDB8) --------------------------------------------------------
unsigned int __fastcall sub_2DDB8(int a1, __int16 a2)
{
  int v2; // eax

  if ( a2 >= *(__int16 *)(a1 + 0xAF) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x3CD);
  }
  if ( a2 == 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x3CE);
  }
  v2 = 0xE * a2 + *(_DWORD *)(a1 + 0xAB);
  if ( (*(_WORD *)(v2 + 0xA) & 1) == 0 )
  {
    return 0;
  }
  if ( (*(_WORD *)(v2 + 0xA) & 4) != 0 )
  {
    *(_BYTE *)(v2 + 0xA) &= ~4u;
  }
  else
  {
    *(_BYTE *)(v2 + 0xA) |= 4u;
  }
  return 0xFFFFFFFF;
}

//----- (0002DE68) --------------------------------------------------------
unsigned int __fastcall sub_2DE68(T_TypeA3 *a1, __int16 a2, LONG a3, LONG a4)
{
  unsigned int result; // eax
  __int16 v6; // ax
  __int16 v7; // bx
  int r; // edx
  int v9; // edi
  unsigned int v10; // ebx
  __int16 i; // [esp+6h] [ebp-Ch]

  switch ( a2 )
  {
    case 1:
      sub_2DD70((int)a1);
      sub_2F424(&a1->a2, a2, a3, a4);
      goto LABEL_3;
    case 4:
    case 5:
      if ( a3 < a1->a2.a1.pane.x0 || a3 > a1->a2.a1.pane.x1 || a4 < a1->a2.a1.pane.y0 || a4 > a1->a2.a1.pane.y1 )
      {
LABEL_3:
        result = 0;
      }
      else
      {
        v7 = sub_2DBE4((int)a1, a3, a4);
        if ( v7 != 0xFFFFFFFF )
        {
          r = (__int16)a1->a2.a1.r;
          if ( r != 0xFFFFFFFF )
          {
            Q_StartSample_sub_4FB90(&V_SoundSystem, r);
          }
          v9 = v7;
          sub_2DCA0((int)a1, v7);
          v10 = sub_2DDB8((int)a1, v7);
          ((void (__fastcall *)(T_TypeA3 *, _DWORD, unsigned int))a1->a2.procs->proc4)(a1, 0, v10);
          if ( v10 == 0xFFFFFFFF )
          {
            if ( a1->a2.a1.parentIndex )
            {
              sub_56D30(&WinMgr, a1->a2.a1.parentIndex, a1->a2.a1.sendMessage, *((__int16 *)a1->controls + 7 * v9), 0);
            }
          }
        }
        result = 0xFFFFFFFF;
      }
      break;
    case 6:
      sub_567BC(&WinMgr, a1->a2.a1.index, 0xFFFFFFFF);
      result = 0xFFFFFFFF;
      break;
    case 7:
      sub_56728(&WinMgr, a1->a2.a1.index, 4, 8, 0, 0);
      result = 0xFFFFFFFF;
      break;
    case 8:
      v6 = sub_2DBE4((int)a1, a3, a4);
      if ( v6 != a1->e )
      {
        sub_2DCA0((int)a1, v6);
        ((void (*)(void))a1->a2.procs->proc4)();
      }
      result = 0xFFFFFFFF;
      break;
    case 9:
      if ( a3 == 0xFFFFFFFF )
      {
        for ( i = 0; i < a1->numControls; ++i )
        {
          sub_2DAC8(a1, 1 << i, a4, 0);
        }
      }
      else
      {
        sub_2DAC8(a1, a3, a4, 0);
      }
      result = 0xFFFFFFFF;
      break;
    default:
      result = sub_2F424(&a1->a2, a2, a3, a4);
      break;
  }
  return result;
}

//----- (0002E084) --------------------------------------------------------
void __usercall sub_2E084(int a1@<eax>, __int16 a2@<si>)
{
  void *ShapeTable_sub_1B084; // eax
  __int16 *v4; // ecx
  void *v5; // eax
  LONG v6; // [esp-Ch] [ebp-18h]
  LONG v7; // [esp-Ch] [ebp-18h]
  LONG v8; // [esp-8h] [ebp-14h]
  LONG v9; // [esp-4h] [ebp-10h]
  __int16 i; // [esp+8h] [ebp-4h]
  __int16 savedregs_4; // [esp+10h] [ebp+4h]

  v6 = *(__int16 *)(a1 + 0x1E);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 0x18));
  VFX_shape_draw((PANE *)(a1 + 4), ShapeTable_sub_1B084, v6, 0, 0);
  for ( i = 0; i < *(__int16 *)(a1 + 0xAF); ++i )
  {
    v4 = (__int16 *)(0xE * savedregs_4 + *(_DWORD *)(a1 + 0xAB));
    switch ( v4[5] )
    {
      case 0:
        a2 = 4;
        break;
      case 1:
        a2 = 0;
        break;
      case 3:
        a2 = 1;
        break;
      case 5:
        a2 = 2;
        break;
      case 7:
        a2 = 3;
        break;
      default:
        Q_AssertLogBreakExit_sub_261A8(0, "..\\gwindow.cpp", 0x48A);
        break;
    }
    v9 = v4[3] - *(_DWORD *)(a1 + 0xC);
    v8 = v4[1] - *(_DWORD *)(a1 + 8);
    v7 = v4[6] + a2;
    v5 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 0x18));
    VFX_shape_draw((PANE *)(a1 + 4), v5, v7, v8, v9);
  }
  sub_55274(&WinMgr, *(_DWORD *)(a1 + 8), *(_DWORD *)(a1 + 0xC), *(_DWORD *)(a1 + 0x10), *(_DWORD *)(a1 + 0x14));
}
// 2E0DC: variable 'savedregs_4' is possibly undefined

//----- (0002E1B4) --------------------------------------------------------
int __fastcall sub_2E1B4(int a1, unsigned int count, int a3)
{
  if ( a3 == 0xFFFFFFFF )
  {
    return Q_ReadFile_sub_1BF94((P_FileInfo)count, *(void **)(a1 + 0xAB), 0xE * *(__int16 *)(a1 + 0xAF));
  }
  else
  {
    return Q_CFILE_CPP_dos_write_sub_1C098((int *)count, *(void **)(a1 + 0xAB), 0xE * *(__int16 *)(a1 + 0xAF));
  }
}

//----- (0002E208) --------------------------------------------------------
int __fastcall sub_2E208(_DWORD *a1, const char *a2, int a3, int a4)
{
  __int16 v4; // bx

  v4 = 0xF2;
  if ( a4 == 0xFFFFFFFF )
  {
    v4 = 0x96;
  }
  WinMgr.LargeFont.pane = *(PANE *)a1;
  return sub_2B8A8(&WinMgr.LargeFont, 1, 1, a2, 0, 0xFFFFFFFF, v4, 0);
}

//----- (0002E248) --------------------------------------------------------
void __fastcall __spoils<> Q_Wnd10LBCtor_sub_2E248(T_Wnd10LB *a1)
{
  Q_A2Ctor_sub_2C830(&a1->a);
  a1->a.procs = (P_Procs)off_95DD8;
  Q_A10_sub_2E2B8(a1);
}
// 95DD8: using guessed type int (*off_95DD8[5])();

//----- (0002E264) --------------------------------------------------------
T_TypeA2 *__fastcall sub_2E264(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, &stru_95D40);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95DD8;
    sub_2ED4C((P_Wnd10LB)a1);
    sub_2F2B4((int)a1);
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95DD8: using guessed type int (*off_95DD8[5])();

//----- (0002E2B8) --------------------------------------------------------
void __fastcall Q_A10_sub_2E2B8(P_Wnd10LB a1)
{
  __int16 FontHeight_sub_2B594; // ax

  Q_A1_sub_2C8E4(&a1->a.a1);
  a1->Unknown_AB = 0;
  a1->Unknown_AF = 0;
  a1->Unknown_B3 = 0;
  a1->Unknown_B7 = 0;
  a1->Unknown_BB = 0;
  a1->Unknown_C4 = 0x31;
  a1->Unknown_C5 = 0xF2;
  a1->Unknown_C6 = 0;
  memset(a1->Unknown_C7, 0, sizeof(a1->Unknown_C7));
  a1->Unknown_8C7 = 0;
  FontHeight_sub_2B594 = Q_FONT_CPP_GetFontHeight_sub_2B594(&WinMgr.LargeFont);
  a1->Unknown_8CB = 0;
  a1->Unknown_8CD = 0;
  a1->Unknown_8CF = 0xFFFF;
  a1->Unknown_8E5 = 0;
  a1->Unknown_8E6 = 0;
  a1->Unknown_8EA = 0;
  a1->Unknown_8EE = 0;
  a1->Unknown_8F2 = 0;
  a1->Unknown_8C9 = FontHeight_sub_2B594 + 3;
  a1->Unknown_8F6 = 0;
  Q_A10_SetProc_sub_2F1C8(a1, sub_2E208);
  a1->a.a1.d = word_FFEE8;
  sub_2E9CC(a1, 1);
}
// FFEE8: using guessed type __int16 word_FFEE8;

//----- (0002E3BC) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_2E3BC(P_TypeA1 a1)
{
  a1->index = Q_WINMGR_CPP_RegisterWindow_sub_571B8(&WinMgr, a1);
}

//----- (0002E3D4) --------------------------------------------------------
unsigned int __fastcall sub_2E3D4(T_Wnd10LB *a1, __int16 a2, signed int a3, signed int a4)
{
  P_Procs procs; // ebx
  int v8; // eax
  int v9; // edx
  __int16 Unknown_8CD; // ax
  int v11; // eax
  int v12; // edx
  unsigned __int16 v13; // dx
  P_Procs v14; // ebx

  if ( (unsigned __int16)a2 < 8u )
  {
    if ( (unsigned __int16)a2 < 4u )
    {
      if ( a2 == 1 )
      {
        sub_2E9CC(a1, a1->Unknown_C3);
        return sub_2F424(&a1->a, 1, a3, a4);
      }
      return sub_2F424(&a1->a, a2, a3, a4);
    }
    if ( (unsigned __int16)a2 > 5u )
    {
      if ( (unsigned __int16)a2 <= 6u )
      {
        sub_567BC(&WinMgr, a1->a.a1.index, 0xFFFFFFFF);
        sub_564C0(&WinMgr, a1->a.a1.index, 0xFFFFFFFF);
        a1->Unknown_8CF = 0xFFFF;
        procs = a1->a.procs;
        a1->Unknown_8E5 = 0;
        ((void (__fastcall *)(T_Wnd10LB *, _DWORD))procs->proc4)(a1, 0);
      }
      else
      {
        sub_56728(&WinMgr, a1->a.a1.index, 4, 8, 0, 0);
        sub_2EDC8((int)a1, V_Mouse.x, V_Mouse.y);
      }
      return 0xFFFFFFFF;
    }
LABEL_11:
    if ( a3 < a1->a.a1.pane.x0 || a3 > a1->a.a1.pane.x1 || a4 < a1->a.a1.pane.y0 || a4 > a1->a.a1.pane.y1 )
    {
      return 0;
    }
    if ( a2 == 0xC && a1->a.a1.helpIndex[0] != 0x30 )
    {
      return sub_2F424(&a1->a, 0xC, a3, a4);
    }
    sub_2F090((int)a1, a3, a4, a2);
    return 0xFFFFFFFF;
  }
  if ( (unsigned __int16)a2 <= 8u )
  {
    sub_2EDC8((int)a1, a3, a4);
    return 0xFFFFFFFF;
  }
  if ( (unsigned __int16)a2 < 0x191u )
  {
    if ( a2 != 0xC )
    {
      return sub_2F424(&a1->a, a2, a3, a4);
    }
    goto LABEL_11;
  }
  if ( (unsigned __int16)a2 <= 0x191u )
  {
    v8 = sub_56528((int)&WinMgr, a1->a.a1.index, a2);
    if ( v8 != 0xFFFF )
    {
      v9 = 2 * v8 / 3 - 1;
      if ( v9 < 0 )
      {
        v9 = 0;
      }
      sub_56564((int)&WinMgr, a1->a.a1.index, a2, v9);
    }
    Unknown_8CD = a1->Unknown_8CD;
    if ( Unknown_8CD )
    {
      a1->Unknown_8CD = Unknown_8CD - 1;
      ((void (__fastcall *)(T_Wnd10LB *, _DWORD))a1->a.procs->proc4)(a1, 0);
    }
    return 0xFFFFFFFF;
  }
  else
  {
    if ( (unsigned __int16)a2 > 0x192u )
    {
      if ( a2 == 0x193 )
      {
        sub_567BC(&WinMgr, a1->a.a1.index, 0x193);
        sub_564C0(&WinMgr, a1->a.a1.index, 0xFFFFFFFF);
        return 0xFFFFFFFF;
      }
      return sub_2F424(&a1->a, a2, a3, a4);
    }
    v11 = sub_56528((int)&WinMgr, a1->a.a1.index, a2);
    if ( v11 != 0xFFFF )
    {
      v12 = 2 * v11 / 3 - 1;
      if ( v12 < 0 )
      {
        v12 = 0;
      }
      sub_56564((int)&WinMgr, a1->a.a1.index, a2, v12);
    }
    v13 = a1->Unknown_8CD;
    if ( v13 < (unsigned __int16)a1->Unknown_8C7 - (a1->a.a1.pane.y1 - a1->a.a1.pane.y0) / (unsigned __int16)a1->Unknown_8C9 )
    {
      v14 = a1->a.procs;
      a1->Unknown_8CD = v13 + 1;
      ((void (__fastcall *)(T_Wnd10LB *, _DWORD))v14->proc4)(a1, 0);
    }
    return 0xFFFFFFFF;
  }
}

//----- (0002E6C0) --------------------------------------------------------
void __fastcall sub_2E6C0(int a1)
{
  LONG v2; // edi
  __int16 v3; // di
  unsigned int v4; // ebp
  unsigned __int16 v5; // ax
  int v6; // ecx
  _DWORD *v7; // ebx
  int v8[2]; // [esp+0h] [ebp-30h] BYREF
  int v9; // [esp+8h] [ebp-28h]
  int v10; // [esp+Ch] [ebp-24h]
  int v11; // [esp+10h] [ebp-20h]
  LONG x1; // [esp+14h] [ebp-1Ch]
  int v13; // [esp+18h] [ebp-18h]

  VFX_pane_wipe((PANE *)(a1 + 4), *(unsigned __int8 *)(a1 + 0xC5));
  x1 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8);
  v2 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
  VFX_line_draw((PANE *)(a1 + 4), 0, 0, x1, 0, 0, *(unsigned __int8 *)(a1 + 0xC4));
  VFX_line_draw((PANE *)(a1 + 4), 0, 0, 0, v2, 0, *(unsigned __int8 *)(a1 + 0xC4));
  VFX_line_draw((PANE *)(a1 + 4), x1, v2, x1, 0, 0, *(unsigned __int8 *)(a1 + 0xC4));
  VFX_line_draw((PANE *)(a1 + 4), x1, v2, 0, v2, 0, *(unsigned __int8 *)(a1 + 0xC4));
  if ( *(_DWORD *)(a1 + 0xB3) == 0xFFFFFFFF )
  {
    sub_2E868(a1, 0);
  }
  v8[1] = *(_DWORD *)(a1 + 8) + 1;
  v9 = *(_DWORD *)(a1 + 0xC) + 1;
  v8[0] = *(_DWORD *)(a1 + 4);
  v10 = *(_DWORD *)(a1 + 0x10) - 1;
  if ( *(_DWORD *)(a1 + 0xB3) == 0xFFFFFFFF )
  {
    v10 -= *(_DWORD *)(a1 + 0xBF);
  }
  v3 = *(_WORD *)(a1 + 0x8CD);
  v4 = 0;
  v13 = a1 + 0xC7;
  while ( v3 < (int)*(unsigned __int16 *)(a1 + 0x8C7) && !v4 )
  {
    v7 = (_DWORD *)(8 * v3 + v13);
    if ( *(_DWORD *)(a1 + 0x8F6) )
    {
      v5 = (*(int (__fastcall **)(_DWORD, _DWORD))(a1 + 0x8F6))(*v7, v7[1]);
    }
    else
    {
      v5 = *(_WORD *)(a1 + 0x8C9);
    }
    v11 = v9 + v5 - 1;
    v6 = *(_DWORD *)(a1 + 0x14);
    if ( v11 >= v6 )
    {
      v4 = 0xFFFFFFFF;
      v11 = v6 - 1;
    }
    (*(void (__fastcall **)(int *, _DWORD, _DWORD, int))(a1 + 0x8FA))(v8, *v7, v7[1], (v3++ != *(_WORD *)(a1 + 0x8CF)) - 1);
    v9 = v11 + 1;
  }
  sub_552CC(&WinMgr, (PANE *)(a1 + 4));
}

//----- (0002E868) --------------------------------------------------------
void __fastcall sub_2E868(int a1, int a2)
{
  int v3; // edi
  int v4; // edx
  int v5; // ebx
  LONG v6; // edi
  int v7; // edx
  void *ShapeTable_sub_1B084; // eax
  void *v9; // eax
  LONG v10; // [esp-Ch] [ebp-34h]
  LONG v11; // [esp-Ch] [ebp-34h]
  LONG v12; // [esp-8h] [ebp-30h]
  LONG v13; // [esp-4h] [ebp-2Ch]
  LONG v14; // [esp-4h] [ebp-2Ch]
  PANE v15; // [esp+0h] [ebp-28h] BYREF
  LONG hotX; // [esp+14h] [ebp-14h]
  PANE *pane; // [esp+18h] [ebp-10h]
  int v18; // [esp+1Ch] [ebp-Ch]
  LONG v19; // [esp+20h] [ebp-8h]
  LONG y1; // [esp+24h] [ebp-4h]

  v18 = a2;
  v3 = *(_DWORD *)(a1 + 0x10);
  v4 = *(_DWORD *)(a1 + 8);
  v5 = *(_DWORD *)(a1 + 0xBF);
  y1 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
  v6 = v3 - v4 - v5;
  VFX_line_draw((PANE *)(a1 + 4), v6, 0, v6, y1, 0, *(unsigned __int8 *)(a1 + 0xC4));
  v7 = *(_DWORD *)(a1 + 0xC) + (*(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC)) / 2;
  v15.window = *(WINDOW **)(a1 + 4);
  v15.x0 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 0xBF) + 1;
  v15.x1 = *(_DWORD *)(a1 + 0x10) - 1;
  v15.y0 = *(_DWORD *)(a1 + 0xC) + 1;
  v15.y1 = *(_DWORD *)(a1 + 0x14) - 1;
  v13 = *(unsigned __int8 *)(a1 + 0xC6);
  v19 = v7;
  VFX_pane_wipe(&v15, v13);
  if ( *(unsigned __int8 *)(a1 + 0x8E5) > 1u )
  {
    if ( *(_BYTE *)(a1 + 0x8E5) == 2 )
    {
      v15.y1 = v19;
    }
    else
    {
      v15.y0 = v19;
    }
    VFX_pane_wipe(&v15, 0x96);
  }
  hotX = v6 + 2;
  v10 = *(__int16 *)(a1 + 0x1E);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 0x18));
  pane = (PANE *)(a1 + 4);
  VFX_shape_draw((PANE *)(a1 + 4), ShapeTable_sub_1B084, v10, v6 + 2, 2);
  v14 = y1 - *(_DWORD *)(a1 + 0xBF) + 2;
  v12 = hotX;
  v11 = *(__int16 *)(a1 + 0x1E) + 1;
  v9 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 0x18));
  VFX_shape_draw(pane, v9, v11, v12, v14);
  if ( v18 == 0xFFFFFFFF )
  {
    sub_55274(&WinMgr, v6 + *(_DWORD *)(a1 + 8), *(_DWORD *)(a1 + 0xC), *(_DWORD *)(a1 + 0x10), *(_DWORD *)(a1 + 0x14));
  }
}

//----- (0002E9CC) --------------------------------------------------------
void __fastcall sub_2E9CC(P_Wnd10LB a1, char a2)
{
  LONG shapeFrame; // eax
  void *ShapeTable_sub_1B084; // eax
  unsigned int v5; // eax
  int v6; // edx
  LONG x0; // eax
  LONG x1; // eax
  int Unknown_B3; // ecx
  LONG v10; // [esp-4h] [ebp-10h]

  if ( a2 == 1 )
  {
    a1->a.a1.shapeFrame = 0;
  }
  else
  {
    a1->a.a1.shapeFrame = 2;
  }
  shapeFrame = a1->a.a1.shapeFrame;
  a1->Unknown_C3 = a2;
  v10 = shapeFrame;
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)a1->a.a1.d);
  v5 = VFX_shape_resolution(ShapeTable_sub_1B084, v10);
  a1->Unknown_BF = v5;
  a1->window = a1->a.a1.pane.window;
  v6 = HIWORD(v5);
  x0 = a1->a.a1.pane.x0;
  a1->Unknown_BF = v6;
  a1->Unknown_8D5 = x0 + 1;
  x1 = a1->a.a1.pane.x1;
  a1->Unknown_BF = v6 + 3;
  Unknown_B3 = a1->Unknown_B3;
  a1->Unknown_8DD = x1 - 1;
  if ( Unknown_B3 == 0xFFFFFFFF )
  {
    a1->Unknown_8DD -= a1->Unknown_BF;
  }
}

//----- (0002EA8C) --------------------------------------------------------
int __fastcall sub_2EA8C(int a1, const char *a2, __int16 a3, int a4)
{
  __int16 v6; // di
  int v7; // edx
  int v8; // eax
  int v9; // edi
  size_t v10; // kr04_4
  void *v11; // eax
  int v12; // ecx
  int v14; // kr08_4
  int v15; // kr10_4
  char v16; // al
  char v17; // al
  int v18; // eax
  const char *v20; // [esp+4h] [ebp-10h]

  v6 = a3;
  if ( *(unsigned __int16 *)(a1 + 0x8C7) >= 0x100u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x62A);
  }
  if ( a3 == 0xFFFFFFFF )
  {
    v6 = *(_WORD *)(a1 + 0x8C9);
  }
  *(_WORD *)(a1 + 0x8CB) += v6;
  v7 = *(unsigned __int16 *)(a1 + 0x8CB);
  if ( (unsigned __int16)v7 > *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC) - 1 )
  {
    if ( *(_DWORD *)(a1 + 0xB7) == 0xFFFFFFFF )
    {
      *(_DWORD *)(a1 + 0x14) = *(_DWORD *)(a1 + 0xC) + v7 + 2;
    }
    else if ( !*(_DWORD *)(a1 + 0xB3) )
    {
      v8 = *(_DWORD *)(a1 + 0xBF);
      v9 = *(_DWORD *)(a1 + 0x8DD);
      *(_DWORD *)(a1 + 0xB3) = 0xFFFFFFFF;
      *(_DWORD *)(a1 + 0x8DD) = v9 - v8;
    }
  }
  if ( *(_DWORD *)(a1 + 0xAB) == 0xFFFFFFFF )
  {
    v10 = strlen(a2) + 1;
    if ( *(_DWORD *)(a1 + 0x8E6) )
    {
      v12 = *(_DWORD *)(a1 + 0x8EE);
      if ( *(_DWORD *)(a1 + 0x8F2) - v12 < v10 )
      {
        Q_AssertLogBreakExit_sub_261A8(0, "..\\gwindow.cpp", 0x653);
        return 0xFFFFFFFF;
      }
      v20 = (const char *)(*(_DWORD *)(a1 + 0x8EA) + v12);
      *(_DWORD *)(a1 + 0x8EE) += v10;
    }
    else
    {
      v11 = operator new[](v10);
      Q_RegisterData_sub_2625C(v11, 1, "LISTBOX STRING");
      v20 = (const char *)v11;
      if ( !v11 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x648);
      }
    }
    v14 = 0;
    v15 = 0;
    do
    {
      v16 = a2[2 * v14];
      v20[2 * v15] = v16;
      if ( !v16 )
      {
        break;
      }
      v17 = a2[2 * v14 + 1];
      v20[2 * v15 + 1] = v17;
      ++v14;
      ++v15;
    }
    while ( v17 );
    a2 = v20;
  }
  *(_DWORD *)(a1 + 8 * *(unsigned __int16 *)(a1 + 0x8C7) + 0xC7) = a2;
  *(_DWORD *)(a1 + 8 * *(unsigned __int16 *)(a1 + 0x8C7) + 0xCB) = 0;
  HIWORD(v18) = HIWORD(a4);
  ++*(_WORD *)(a1 + 0x8C7);
  if ( a4 == 0xFFFFFFFF )
  {
    v18 = (*(int (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
  }
  LOWORD(v18) = *(_WORD *)(a1 + 0x8C7);
  return v18 - 1;
}

//----- (0002EC50) --------------------------------------------------------
unsigned int __fastcall sub_2EC50(int a1, unsigned __int16 a2, int a3)
{
  int v3; // esi
  unsigned int result; // eax

  if ( a2 >= 0x100u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x66B);
  }
  v3 = 8 * a2 + a1;
  if ( !*(_DWORD *)(v3 + 0xC7) )
  {
    return 0;
  }
  result = 0xFFFFFFFF;
  *(_DWORD *)(v3 + 0xCB) = a3;
  return result;
}

//----- (0002ECA4) --------------------------------------------------------
int __fastcall sub_2ECA4(int a1, unsigned __int16 a2)
{
  if ( a2 >= 0x100u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x679);
  }
  return *(_DWORD *)(a1 + 8 * a2 + 0xCB);
}

//----- (0002ECDC) --------------------------------------------------------
int __fastcall sub_2ECDC(int result, unsigned __int16 a2)
{
  if ( *(unsigned __int16 *)(result + 0x8CB) > *(_DWORD *)(result + 0x14) - *(_DWORD *)(result + 0xC) - 1 && a2 < *(_WORD *)(result + 0x8C7) )
  {
    *(_WORD *)(result + 0x8CF) = 0xFFFF;
    *(_WORD *)(result + 0x8CD) = a2;
  }
  return result;
}

//----- (0002ED14) --------------------------------------------------------
int __fastcall sub_2ED14(int a1, unsigned __int16 a2)
{
  if ( a2 >= 0x100u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x68D);
  }
  return *(_DWORD *)(a1 + 8 * a2 + 0xC7);
}

//----- (0002ED4C) --------------------------------------------------------
LONG __fastcall sub_2ED4C(P_Wnd10LB a1)
{
  int v2; // edx
  int v3; // kr04_4
  LONG result; // eax
  int Unknown_AF; // edx

  a1->Unknown_8EE = 0;
  v2 = 0;
  v3 = 0;
  while ( v2 < (unsigned __int16)a1->Unknown_8C7 )
  {
    if ( *(_DWORD *)&a1->Unknown_C7[8 * v3] )
    {
      *(_DWORD *)&a1->Unknown_C7[8 * v3] = 0;
    }
    ++v2;
    ++v3;
  }
  a1->Unknown_8C7 = 0;
  a1->Unknown_8CB = 0;
  a1->Unknown_8CF = 0xFFFF;
  result = a1->a.a1.pane.x1;
  a1->Unknown_8CD = 0;
  Unknown_AF = a1->Unknown_AF;
  a1->Unknown_8DD = result - 1;
  if ( !Unknown_AF )
  {
    a1->Unknown_B3 = 0;
  }
  return result;
}

//----- (0002EDC8) --------------------------------------------------------
void __fastcall sub_2EDC8(int a1, unsigned int a2, unsigned int a3)
{
  unsigned int v5; // eax
  unsigned __int16 v6; // di
  unsigned __int16 v7; // dx
  unsigned int v8; // ebx
  unsigned __int16 v9; // cx
  int v10; // eax
  int v11; // edx
  unsigned int v12; // edx
  unsigned int v13; // eax
  char v14; // al
  int v15; // edx
  int v16; // eax
  LONG v17; // [esp-4h] [ebp-18h]

  if ( *(__int16 *)(a1 + 0x8CF) != 0xFFFFFFFF )
  {
    if ( a3 >= *(_DWORD *)(a1 + 0x8D9) && a3 <= *(_DWORD *)(a1 + 0x8E1) && a2 <= *(_DWORD *)(a1 + 0x8DD) )
    {
      if ( *(_DWORD *)(a1 + 0xBB) == 0xFFFFFFFF )
      {
        VFX_pane_wipe((PANE *)(a1 + 0x8D1), *(unsigned __int8 *)(a1 + 0xC5));
        (*(void (__fastcall **)(int, _DWORD, _DWORD, unsigned int))(a1 + 0x8FA))(
          a1 + 0x8D1,
          *(_DWORD *)(a1 + 8 * *(__int16 *)(a1 + 0x8CF) + 0xC7),
          *(_DWORD *)(a1 + 8 * *(__int16 *)(a1 + 0x8CF) + 0xCB),
          0xFFFFFFFF);
        sub_552CC(&WinMgr, (PANE *)(a1 + 0x8D1));
      }
      return;
    }
    VFX_pane_wipe((PANE *)(a1 + 0x8D1), *(unsigned __int8 *)(a1 + 0xC5));
    (*(void (__fastcall **)(int, _DWORD, _DWORD, _DWORD))(a1 + 0x8FA))(
      a1 + 0x8D1,
      *(_DWORD *)(a1 + 8 * *(__int16 *)(a1 + 0x8CF) + 0xC7),
      *(_DWORD *)(a1 + 8 * *(__int16 *)(a1 + 0x8CF) + 0xCB),
      0);
    sub_552CC(&WinMgr, (PANE *)(a1 + 0x8D1));
    *(_WORD *)(a1 + 0x8CF) = 0xFFFF;
  }
  v5 = *(_DWORD *)(a1 + 0x10);
  if ( *(_DWORD *)(a1 + 0xB3) == 0xFFFFFFFF )
  {
    v5 -= *(_DWORD *)(a1 + 0xBF);
  }
  if ( v5 <= a2 )
  {
    if ( *(_DWORD *)(a1 + 0xB3) != 0xFFFFFFFF )
    {
      return;
    }
    v12 = *(_DWORD *)(a1 + 0xC) + (*(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC)) / 2;
    v13 = *(unsigned __int8 *)(a1 + 0x8E5);
    if ( v13 > 1 )
    {
      if ( a3 <= v12 )
      {
        if ( v13 == 2 )
        {
          return;
        }
        v15 = *(_DWORD *)(a1 + 0xB3);
        v16 = a1;
        *(_BYTE *)(a1 + 0x8E5) = 2;
      }
      else
      {
        if ( v13 == 3 )
        {
          return;
        }
        v15 = *(_DWORD *)(a1 + 0xB3);
        v16 = a1;
        *(_BYTE *)(a1 + 0x8E5) = 3;
      }
    }
    else
    {
      v14 = (a3 > v12) + 2;
      v15 = *(_DWORD *)(a1 + 0xB3);
      *(_BYTE *)(a1 + 0x8E5) = v14;
      v16 = a1;
    }
    sub_2E868(v16, v15);
  }
  else
  {
    if ( *(unsigned __int8 *)(a1 + 0x8E5) > 1u )
    {
      *(_BYTE *)(a1 + 0x8E5) = 1;
      sub_2E868(a1, 0xFFFFFFFF);
      sub_567BC(&WinMgr, *(_DWORD *)(a1 + 0x41), 0x193);
      sub_564C0(&WinMgr, *(_DWORD *)(a1 + 0x41), 0xFFFFFFFF);
    }
    v6 = *(_WORD *)(a1 + 0x8CD);
    v7 = *(_WORD *)(a1 + 0x8C7);
    v8 = 0;
    *(_DWORD *)(a1 + 0x8D9) = *(_DWORD *)(a1 + 0xC) + 1;
    if ( v6 < v7 )
    {
      while ( !v8 )
      {
        v8 = 0;
        v10 = *(_DWORD *)(a1 + 0x8F6);
        if ( v10 )
        {
          v10 = (*(unsigned __int16 (__fastcall **)(_DWORD, _DWORD, _DWORD))(a1 + 0x8F6))(
                  *(_DWORD *)(a1 + 8 * v6 + 0xC7),
                  *(_DWORD *)(a1 + 8 * v6 + 0xCB),
                  0);
        }
        else
        {
          LOWORD(v10) = *(_WORD *)(a1 + 0x8C9);
        }
        *(_DWORD *)(a1 + 0x8E1) = *(_DWORD *)(a1 + 0x8D9) + v10 - 1;
        v11 = *(_DWORD *)(a1 + 0x14);
        if ( *(_DWORD *)(a1 + 0x8E1) >= v11 )
        {
          v8 = 0xFFFFFFFF;
          *(_DWORD *)(a1 + 0x8E1) = v11 - 1;
        }
        if ( a3 >= *(_DWORD *)(a1 + 0x8D9) && a3 <= *(_DWORD *)(a1 + 0x8E1) )
        {
          v17 = *(unsigned __int8 *)(a1 + 0xC5);
          *(_WORD *)(a1 + 0x8CF) = v6;
          VFX_pane_wipe((PANE *)(a1 + 0x8D1), v17);
          (*(void (__fastcall **)(int, _DWORD, _DWORD, unsigned int))(a1 + 0x8FA))(
            a1 + 0x8D1,
            *(_DWORD *)(a1 + 8 * v6 + 0xC7),
            *(_DWORD *)(a1 + 8 * v6 + 0xCB),
            0xFFFFFFFF);
          sub_552CC(&WinMgr, (PANE *)(a1 + 0x8D1));
          return;
        }
        ++v6;
        v9 = *(_WORD *)(a1 + 0x8C7);
        *(_DWORD *)(a1 + 0x8D9) = *(_DWORD *)(a1 + 0x8E1) + 1;
        if ( v6 >= v9 )
        {
          return;
        }
      }
    }
  }
}

//----- (0002F090) --------------------------------------------------------
void __fastcall sub_2F090(int a1, unsigned int a2, unsigned int a3, __int16 a4)
{
  int v6; // ecx
  int v7; // edx
  int v8; // ebx

  if ( *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 0xBF) <= a2 )
  {
    if ( *(_DWORD *)(a1 + 0xB3) == 0xFFFFFFFF )
    {
      if ( *(_DWORD *)(a1 + 0xC) + (*(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC)) / 2 <= a3 )
      {
        (*(void (__fastcall **)(int, int, _DWORD, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 8))(a1, 0x192, 0, 0);
        sub_56400(&WinMgr, *(_DWORD *)(a1 + 0x41), 0x192, 0, 0, 0x1E);
      }
      else
      {
        (*(void (__fastcall **)(int, int, _DWORD, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 8))(a1, 0x191, 0, 0);
        sub_56400(&WinMgr, *(_DWORD *)(a1 + 0x41), 0x191, 0, 0, 0x1E);
      }
      v8 = 1;
      if ( a4 == 5 )
      {
        v8 = 2;
      }
      sub_56728(&WinMgr, *(_DWORD *)(a1 + 0x41), v8, 0x193, 0, 0);
    }
  }
  else
  {
    v6 = *(__int16 *)(a1 + 0x8CF);
    if ( v6 != 0xFFFFFFFF )
    {
      if ( WinMgr.h )
      {
        sub_56D30(&WinMgr, *(_DWORD *)(a1 + 0x63), 0x1C02, v6, a4);
      }
      else
      {
        v7 = *(__int16 *)(a1 + 0x59);
        if ( v7 != 0xFFFFFFFF )
        {
          Q_StartSample_sub_4FB90(&V_SoundSystem, v7);
        }
        sub_56D30(&WinMgr, *(_DWORD *)(a1 + 0x63), 0x1C01, *(__int16 *)(a1 + 0x8CF), a4);
      }
      sub_2EDC8(a1, a2, a3);
    }
  }
}

//----- (0002F1C8) --------------------------------------------------------
void __fastcall Q_A10_SetProc_sub_2F1C8(P_Wnd10LB result, void *a2)
{
  result->proc = a2;
}

//----- (0002F1D8) --------------------------------------------------------
int __fastcall sub_2F1D8(int result, int a2)
{
  *(_DWORD *)(result + 0x8FE) = a2;
  return result;
}

//----- (0002F1E0) --------------------------------------------------------
void __fastcall sub_2F1E0(int a1)
{
  if ( !*(_DWORD *)(a1 + 0x8FE) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x7AB);
  }
  qsort((void *)(a1 + 0xC7), *(unsigned __int16 *)(a1 + 0x8C7), 8u, *(int (__fastcall **)(const void *, const void *))(a1 + 0x8FE));
}

//----- (0002F228) --------------------------------------------------------
int __fastcall sub_2F228(int a1, size_t a2, int a3)
{
  int result; // eax

  sub_2ED4C((P_Wnd10LB)a1);
  if ( *(_DWORD *)(a1 + 0x8EA) )
  {
    sub_262CC(*(void **)(a1 + 0x8EA));
    *(_DWORD *)(a1 + 0x8EA) = 0;
  }
  if ( a3 )
  {
    *(_DWORD *)(a1 + 0x8EA) = a3;
  }
  else
  {
    *(_DWORD *)(a1 + 0x8EA) = Q_Allocate_sub_2628C(a2, 1, "LISTBOX MEMPOOL");
  }
  if ( *(_DWORD *)(a1 + 0x8EA) )
  {
    *(_DWORD *)(a1 + 0x8E6) = 0xFFFFFFFF;
    *(_DWORD *)(a1 + 0x8EE) = 0;
    result = 0xFFFFFFFF;
    *(_DWORD *)(a1 + 0x8F2) = a2;
  }
  else
  {
    *(_DWORD *)(a1 + 0x8E6) = 0;
    *(_DWORD *)(a1 + 0x8F2) = 0;
    result = 0;
    *(_DWORD *)(a1 + 0x8EE) = 0;
  }
  return result;
}

//----- (0002F2B4) --------------------------------------------------------
void __fastcall sub_2F2B4(int a1)
{
  if ( *(_DWORD *)(a1 + 0x8EA) )
  {
    sub_262CC(*(void **)(a1 + 0x8EA));
    *(_DWORD *)(a1 + 0x8EA) = 0;
  }
  *(_DWORD *)(a1 + 0x8F2) = 0;
  *(_DWORD *)(a1 + 0x8EE) = 0;
  *(_DWORD *)(a1 + 0x8E6) = 0;
}

//----- (0002F2F4) --------------------------------------------------------
void __fastcall __spoils<> Q_WndNT_sub_2F2F4(P_WndNT result)
{
  Q_A2Ctor_sub_2C830(&result->a);
  result->a.procs = (P_Procs)off_95DC0;
}
// 95DC0: using guessed type int (*off_95DC0[5])();

//----- (0002F30C) --------------------------------------------------------
T_TypeA2 *__fastcall sub_2F30C(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_95D2C);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95DC0;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95DC0: using guessed type int (*off_95DC0[5])();

//----- (0002F354) --------------------------------------------------------
void __fastcall sub_2F354(int a1)
{
  void *ShapeTable_sub_1B084; // eax
  __int16 v3; // si
  LONG v4; // ecx
  LONG v5; // ebx
  void *v6; // eax
  LONG v7; // [esp-Ch] [ebp-20h]
  __int16 v8; // [esp-4h] [ebp-18h]
  char s[12]; // [esp+0h] [ebp-14h] BYREF
  int v10; // [esp+Ch] [ebp-8h]
  int a2; // [esp+10h] [ebp-4h]
  void *retaddr; // [esp+28h] [ebp+14h]

  v7 = *(_DWORD *)(a1 + 0xAB) + 0xC;
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 0x18));
  v10 = a1 + 4;
  VFX_shape_draw((PANE *)(a1 + 4), ShapeTable_sub_1B084, v7, 0, 0);
  v3 = 0;
  sprintf(s, "%05d", V_Game.day);
  a2 = v10;
  while ( v3 < 5 )
  {
    v4 = 0x1F * v3 + 2;
    v8 = V_RaceIndex;
    v5 = *(_DWORD *)(a1 + 0xAB) + *((char *)&retaddr + v3) - 0x30;
    v6 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 0x18));
    ++v3;
    sub_53EB8((PANE *)a2, v6, v5, v4, 0, v8);
  }
  sub_552CC(&WinMgr, (PANE *)a2);
}
// 2F354: using guessed type char s[12];

//----- (0002F414) --------------------------------------------------------
int __fastcall sub_2F414(int a1)
{
  return (*(int (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
}

//----- (0002F420) --------------------------------------------------------
unsigned int __fastcall sub_2F420(T_TypeA2 *a1, __int16 a2, LONG a3, LONG a4)
{
  return sub_2F424(a1, a2, a3, a4);
}

//----- (0002F424) --------------------------------------------------------
unsigned int __fastcall sub_2F424(T_TypeA2 *a1, __int16 a2, LONG a3, LONG a4)
{
  P_Procs procs; // ebp
  WORD sendMessage; // cx
  int sendParam2; // ebx
  int r; // edx
  int param1; // [esp+2h] [ebp-10h]

  if ( (unsigned __int16)a2 < 7u )
  {
    if ( (unsigned __int16)a2 < 2u )
    {
      if ( a2 == 1 )
      {
        a1->a1.j = 0xFFFFFFFF;
        procs = a1->procs;
        a1->a1.i = 0xFFFFFFFF;
        ((void (*)(void))procs->proc4)();
        sub_2D258(a1, 1);
        return 0;
      }
      return 0;
    }
    if ( (unsigned __int16)a2 <= 2u )
    {
      sub_2D258(a1, a2);
      a1->a1.j = 0;
      a1->a1.i = 0;
      if ( a1->a1.index == *(_DWORD *)WinMgr.z1aa )
      {
        *(_DWORD *)WinMgr.z1aa = 0xFFFFFFFF;
      }
      sub_567BC(&WinMgr, a1->a1.index, 0xFFFFFFFF);
      sub_564C0(&WinMgr, a1->a1.index, 0xFFFFFFFF);
      return 0;
    }
    else
    {
      if ( (unsigned __int16)a2 < 4u )
      {
        return 0;
      }
      if ( (unsigned __int16)a2 <= 5u )
      {
        if ( a3 < a1->a1.pane.x0 || a3 > a1->a1.pane.x1 || a4 < a1->a1.pane.y0 || a4 > a1->a1.pane.y1 )
        {
          return 0;
        }
        sendMessage = a1->a1.sendMessage;
        param1 = a1->a1.sendParam1;
        sendParam2 = a1->a1.sendParam2;
        if ( sendMessage == 0x3E7 )
        {
          sendMessage = a2;
        }
        if ( param1 == 0x3E7 )
        {
          param1 = a2;
        }
        if ( sendParam2 == 0x3E7 )
        {
          sendParam2 = a2;
        }
        r = (__int16)a1->a1.r;
        if ( r != 0xFFFFFFFF )
        {
          Q_StartSample_sub_4FB90(&V_SoundSystem, r);
        }
        if ( a1->a1.parentIndex )
        {
          if ( sendMessage == 0x3E6 )
          {
            sub_56B60(&WinMgr, param1, sendParam2, 0);
            return 0xFFFFFFFF;
          }
          sub_56D30(&WinMgr, a1->a1.parentIndex, sendMessage, param1, sendParam2);
        }
        else
        {
          sub_56B60(&WinMgr, sendMessage, param1, sendParam2);
        }
        return 0xFFFFFFFF;
      }
      else
      {
        if ( a1->a1.j && a1->a1.i && a1->a1._mouseFocus )
        {
          ((void (*)(void))a1->procs->proc4)();
        }
        return 0xFFFFFFFF;
      }
    }
  }
  else if ( (unsigned __int16)a2 <= 7u )
  {
    if ( a1->a1.j && a1->a1.i && a1->a1._mouseFocus )
    {
      ((void (*)(void))a1->procs->proc4)();
    }
    return 0xFFFFFFFF;
  }
  else
  {
    if ( (unsigned __int16)a2 >= 0xEu )
    {
      if ( (unsigned __int16)a2 <= 0xEu )
      {
        a1->a1.i = 0xFFFFFFFF;
        a1->a1.j = 0xFFFFFFFF;
        return 0;
      }
      if ( (unsigned __int16)a2 <= 0xFu )
      {
        a1->a1.i = 0;
        return 0;
      }
      if ( (unsigned __int16)a2 >= 0xC9u )
      {
        if ( (unsigned __int16)a2 > 0xCAu )
        {
          return 0;
        }
        sub_56B60(&WinMgr, 6, a2, 0);
        return 0xFFFFFFFF;
      }
      return 0;
    }
    if ( a2 != 0xC )
    {
      return 0;
    }
    if ( a3 < a1->a1.pane.x0 || a3 > a1->a1.pane.x1 || a4 < a1->a1.pane.y0 || a4 > a1->a1.pane.y1 )
    {
      return 0;
    }
    if ( a1->a1.helpIndex[0] != 0x30 )
    {
      sub_56B60(&WinMgr, 5, (int)a1->a1.helpIndex, 0);
    }
    return 0xFFFFFFFF;
  }
}

//----- (0002F478) --------------------------------------------------------
unsigned int __fastcall sub_2F478(T_TypeA2 *a1, __int16 a2, LONG a3, LONG a4)
{
  if ( a2 != 0xD )
  {
    return sub_2F420(a1, a2, a3, a4);
  }
  ((void (*)(void))a1->procs->proc4)();
  return 0;
}

//----- (0002F48C) --------------------------------------------------------
T_TypeA2 *__fastcall sub_2F48C(T_TypeA2 *a1)
{
  Q_A2Ctor_sub_2C830(a1);
  a1->procs = (P_Procs)off_95DA8;
  sub_2F4EC((int)a1);
  return a1;
}
// 95DA8: using guessed type int (*off_95DA8[4])();

//----- (0002F4A8) --------------------------------------------------------
T_TypeA2 *__fastcall sub_2F4A8(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_95D18);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95DA8;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95DA8: using guessed type int (*off_95DA8[4])();

//----- (0002F4EC) --------------------------------------------------------
int __fastcall sub_2F4EC(int result)
{
  *(_DWORD *)(result + 0xAB) = 0;
  *(_WORD *)(result + 0xB1) = 0;
  *(_WORD *)(result + 0xAF) = 0;
  *(_WORD *)(result + 0xB3) = 0;
  *(_WORD *)(result + 0xB7) = 0xF2;
  *(_DWORD *)(result + 0xB9) = &WinMgr.LargeFont;
  *(_DWORD *)(result + 0xBD) = 0xFFFFFFFF;
  *(_WORD *)(result + 0xB5) = (unsigned __int8)byte_96778;
  return result;
}
// 96778: using guessed type char byte_96778;

//----- (0002F540) --------------------------------------------------------
void __fastcall sub_2F540(int a1)
{
  T_Font *v2; // eax
  const char *v3; // ecx
  int v4; // edx
  int v5; // eax
  int v6; // eax
  LONG v7; // [esp-18h] [ebp-30h]
  LONG v8; // [esp-14h] [ebp-2Ch]
  __int16 v9; // [esp-Ch] [ebp-24h]
  PANE *a2; // [esp+0h] [ebp-18h]

  a2 = (PANE *)(a1 + 4);
  VFX_pane_wipe((PANE *)(a1 + 4), *(__int16 *)(a1 + 0xB7));
  VFX_line_draw(a2, 0, 0, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), 0, 0, 0xF3);
  VFX_line_draw(a2, 0, 0, 0, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), 0, 0xF3);
  v8 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
  VFX_line_draw(a2, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), v8, 0, v8, 0, 0xF3);
  v7 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8);
  VFX_line_draw(a2, v7, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), v7, 0, 0, 0xF3);
  v2 = *(T_Font **)(a1 + 0xB9);
  v9 = *(_WORD *)(a1 + 0xB5);
  v3 = *(const char **)(a1 + 0xAB);
  v2->pane.window = a2->window;
  v2->pane.x0 = a2->x0;
  v2->pane.y0 = a2->y0;
  v2->pane.x1 = a2->x1;
  v2->pane.y1 = a2->y1;
  sub_2B8A8(v2, 2, 4, v3, 0, v9, 0xFF, 0);
  v4 = *(__int16 *)(a1 + 0xB3);
  v5 = *(_DWORD *)(a1 + 0xAB);
  LOBYTE(v3) = *(_BYTE *)(v4 + v5);
  *(_BYTE *)(v4 + v5) = 0;
  v6 = sub_2B4F4(*(_DWORD **)(a1 + 0xB9), *(char **)(a1 + 0xAB));
  *(_BYTE *)(*(__int16 *)(a1 + 0xB3) + *(_DWORD *)(a1 + 0xAB)) = (_BYTE)v3;
  VFX_line_draw(a2, v6 + 2, 3, v6 + 2, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC) - 3, 0, 0x98);
  sub_552CC(&WinMgr, a2);
}

//----- (0002F6B0) --------------------------------------------------------
unsigned int __fastcall sub_2F6B0(int a1, __int16 a2, char a3, unsigned int a4)
{
  int v6; // ecx
  int v8; // ebx
  __int16 v9; // ax
  int v10; // ebx

  if ( a2 != 3 )
  {
    return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
  }
  v6 = *(_DWORD *)(a1 + 0xBD);
  *(_DWORD *)(a1 + 0xBD) = 0;
  if ( a3 >= 0x30 && a3 <= 0x39 || a3 >= 0x41 && a3 <= 0x5A || a3 >= 0x61 && a3 <= 0x7A || a3 == 0x20 || a3 == 0x2D )
  {
    if ( v6 )
    {
      *(_WORD *)(a1 + 0xB3) = 0;
      *(_WORD *)(a1 + 0xB1) = *(_WORD *)(a1 + 0xB3);
      **(_BYTE **)(a1 + 0xAB) = 0;
    }
    if ( *(_WORD *)(a1 + 0xB1) < *(_WORD *)(a1 + 0xAF) && sub_2B4F4(&WinMgr.LargeFont.pVfxFont, *(char **)(a1 + 0xAB)) < 0x5F )
    {
      sub_2F8F8(a1, *(_WORD *)(a1 + 0xB3), a3, a2);
      ++*(_WORD *)(a1 + 0xB3);
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    }
    return 0xFFFFFFFF;
  }
  if ( a4 < 0x4B )
  {
    if ( a4 >= 0xE )
    {
      if ( a4 > 0xE )
      {
        if ( a4 == 0x1C )
        {
          sub_56B60(&WinMgr, 6, 3, 0);
          return 0xFFFFFFFF;
        }
        return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
      }
      if ( *(__int16 *)(a1 + 0xB3) > 0 )
      {
        sub_2F8A4(a1, (__int16)--*(_WORD *)(a1 + 0xB3));
        (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
      }
      return 0xFFFFFFFF;
    }
    return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
  }
  if ( a4 <= 0x4B )
  {
    if ( *(__int16 *)(a1 + 0xB3) > 0 )
    {
      v8 = *(_DWORD *)(a1 + 0xA7);
      --*(_WORD *)(a1 + 0xB3);
      (*(void (__fastcall **)(int, _DWORD))(v8 + 0xC))(a1, 0);
    }
    return 0xFFFFFFFF;
  }
  if ( a4 < 0x4D )
  {
    return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
  }
  if ( a4 <= 0x4D )
  {
    v9 = *(_WORD *)(a1 + 0xB3);
    if ( v9 < *(__int16 *)(a1 + 0xB1) )
    {
      v10 = *(_DWORD *)(a1 + 0xA7);
      *(_WORD *)(a1 + 0xB3) = v9 + 1;
      (*(void (__fastcall **)(int, _DWORD))(v10 + 0xC))(a1, 0);
    }
    return 0xFFFFFFFF;
  }
  else
  {
    if ( a4 != 0x53 )
    {
      return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
    }
    if ( *(_WORD *)(a1 + 0xB3) < *(_WORD *)(a1 + 0xB1) )
    {
      sub_2F8A4(a1, *(__int16 *)(a1 + 0xB3));
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    }
    return 0xFFFFFFFF;
  }
}

//----- (0002F8A4) --------------------------------------------------------
int __fastcall sub_2F8A4(int a1, int a2)
{
  __int16 v3; // bx
  int result; // eax

  if ( (__int16)a2 >= *(__int16 *)(a1 + 0xAF) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x8F2);
  }
  v3 = *(_WORD *)(a1 + 0xB1);
  result = a2;
  if ( (__int16)a2 < v3 )
  {
    do
    {
      *(_BYTE *)(*(_DWORD *)(a1 + 0xAB) + (__int16)result) = *(_BYTE *)(*(_DWORD *)(a1 + 0xAB) + (__int16)result + 1);
      ++result;
    }
    while ( (__int16)result < *(__int16 *)(a1 + 0xB1) );
  }
  --*(_WORD *)(a1 + 0xB1);
  return result;
}

//----- (0002F8F8) --------------------------------------------------------
char __usercall sub_2F8F8@<al>(int a1@<eax>, __int16 a2@<dx>, char a3@<bl>, int a4@<edi>)
{
  int i; // eax
  _BYTE *v7; // edx
  char result; // al

  if ( a2 > *(__int16 *)(a1 + 0xB1) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x903);
  }
  if ( *(_WORD *)(a1 + 0xB1) >= *(_WORD *)(a1 + 0xAF) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x904);
  }
  LOWORD(a4) = *(_WORD *)(a1 + 0xB1);
  if ( a2 == (_WORD)a4 )
  {
    *(_BYTE *)((__int16)a4 + *(_DWORD *)(a1 + 0xAB)) = a3;
    *(_BYTE *)((__int16)a4 + *(_DWORD *)(a1 + 0xAB) + 1) = 0;
  }
  else
  {
    for ( i = a4; (__int16)i >= a2; v7[1] = *v7 )
    {
      v7 = (_BYTE *)((__int16)i-- + *(_DWORD *)(a1 + 0xAB));
    }
  }
  result = a3;
  *(_BYTE *)(*(_DWORD *)(a1 + 0xAB) + a2) = a3;
  ++*(_WORD *)(a1 + 0xB1);
  return result;
}

//----- (0002F9A4) --------------------------------------------------------
int __fastcall sub_2F9A4(int a1, const char *a2, __int16 a3)
{
  int result; // eax
  unsigned int v5; // kr04_4

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x91B);
  }
  *(_DWORD *)(a1 + 0xAB) = a2;
  *(_WORD *)(a1 + 0xAF) = a3;
  result = 0;
  v5 = strlen(a2) + 1;
  *(_WORD *)(a1 + 0xB1) = v5 - 1;
  if ( (__int16)(v5 - 1) > a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x921);
  }
  *(_WORD *)(a1 + 0xB3) = *(_WORD *)(a1 + 0xB1);
  return result;
}

//----- (0002FA18) --------------------------------------------------------
void __fastcall __spoils<> Q_A3_sub_2FA18(P_TypeA3 a1)
{
  Q_A2Ctor_sub_2C830(&a1->a2);
  a1->a2.procs = (P_Procs)off_95D90;
  Q_A3_sub_2FA78(a1);
}
// 95D90: using guessed type int (*off_95D90[5])();

//----- (0002FA34) --------------------------------------------------------
T_TypeA2 *__fastcall sub_2FA34(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_95D04);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95D90;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95D90: using guessed type int (*off_95D90[5])();

//----- (0002FA78) --------------------------------------------------------
void __fastcall __spoils<> Q_A3_sub_2FA78(P_TypeA3 result)
{
  result->controls = 0;
  result->numControls = 3;
  result->e = 0xF3;
}

//----- (0002FA98) --------------------------------------------------------
void __fastcall sub_2FA98(int a1)
{
  PANE *v2; // esi
  const char *v3; // ecx
  LONG v4; // [esp-18h] [ebp-2Ch]
  LONG v5; // [esp-14h] [ebp-28h]
  __int16 v6; // [esp-10h] [ebp-24h]
  __int16 v7; // [esp-Ch] [ebp-20h]
  int v8; // [esp-4h] [ebp-18h]

  v2 = (PANE *)(a1 + 4);
  VFX_pane_wipe((PANE *)(a1 + 4), 0xF2);
  if ( *(_DWORD *)(a1 + 0x5F) == 0xFFFFFFFF )
  {
    VFX_line_draw(v2, 0, 0, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), 0, 0, 0xF3);
    VFX_line_draw(v2, 0, 0, 0, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), 0, 0xF3);
    v5 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
    VFX_line_draw(v2, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), v5, 0, v5, 0, 0xF3);
    v4 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8);
    VFX_line_draw(v2, v4, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), v4, 0, 0, 0xF3);
  }
  if ( *(_DWORD *)(a1 + 0xAB) )
  {
    v3 = *(const char **)(a1 + 0xAB);
    v8 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8) - 5;
    v7 = *(_WORD *)(a1 + 0xB1);
    v6 = *(_WORD *)(a1 + 0xAF);
    WinMgr.LargeFont.pane = *(PANE *)(a1 + 4);
    sub_2B8A8(&WinMgr.LargeFont, 0, 0, v3, v6, v7, 0xFF, v8);
  }
  sub_552CC(&WinMgr, (PANE *)(a1 + 4));
}

//----- (0002FBA4) --------------------------------------------------------
void __fastcall sub_2FBA4(int a1, int a2)
{
  int v3; // ecx
  LONG v4; // eax
  LONG v5; // ebx
  void *ShapeTable_sub_1B084; // eax
  __int16 v7; // [esp-4h] [ebp-14h]

  v3 = *(_DWORD *)(a1 + 0x41);
  v4 = 0xF2;
  if ( *(_DWORD *)WinMgr.z1aa == v3 && a2 != 2 || a2 == 3 )
  {
    v4 = 0x96;
  }
  VFX_pane_wipe((PANE *)(a1 + 4), v4);
  if ( *(__int16 *)(a1 + 0x1E) == 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x9A0);
  }
  v5 = *(__int16 *)(a1 + 0x1E);
  if ( v5 != 0xFFFFFFFF )
  {
    v7 = V_RaceIndex;
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 0x18));
    sub_53EB8((PANE *)(a1 + 4), ShapeTable_sub_1B084, v5, 0, 0, v7);
  }
  sub_552CC(&WinMgr, (PANE *)(a1 + 4));
}

//----- (0002FC3C) --------------------------------------------------------
int __fastcall sub_2FC3C(int a1)
{
  return (*(int (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
}

//----- (0002FC50) --------------------------------------------------------
void __fastcall __spoils<> Q_A2_sub_2FC50(P_TypeA2 a1)
{
  Q_A2Ctor_sub_2C830(a1);
  a1->procs = (P_Procs)off_95E54;
}
// 95E54: using guessed type int (*off_95E54[5])();

//----- (0002FC68) --------------------------------------------------------
T_TypeA2 *__fastcall sub_2FC68(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_95E40);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95E54;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95E54: using guessed type int (*off_95E54[5])();

//----- (0002FCB0) --------------------------------------------------------
void __fastcall Q_ShowHelpTopic_sub_2FCB0(P_Wnd20HW a1, char *helpfile, char *helptopic)
{
  int v4; // kr04_4
  __int8 *Unknown_AB; // kr10_4
  int v6; // kr14_4
  char v7; // al
  char v8; // al
  int v9; // kr0C_4
  char *v10; // kr18_4
  int v11; // kr1C_4
  char v12; // al
  char v13; // al
  LONG v14; // ebx

  a1->Unknown_DAB = 0;
  a1->Unknown_DA7 = a1->Unknown_DAB;
  v4 = 0;
  Unknown_AB = a1->Unknown_AB;
  v6 = 0;
  do
  {
    v7 = helpfile[2 * v4];
    Unknown_AB[2 * v6] = v7;
    if ( !v7 )
    {
      break;
    }
    v8 = helpfile[2 * v4 + 1];
    Unknown_AB[2 * v6 + 1] = v8;
    ++v4;
    ++v6;
  }
  while ( v8 );
  v9 = 0;
  v10 = a1->helpTopic;
  v11 = 0;
  do
  {
    v12 = helptopic[2 * v9];
    v10[2 * v11] = v12;
    if ( !v12 )
    {
      break;
    }
    v13 = helptopic[2 * v9 + 1];
    v10[2 * v11 + 1] = v13;
    ++v9;
    ++v11;
  }
  while ( v13 );
  sub_2FEB8(a1);
  v14 = 0x98;
  if ( !WinMgr.Unknown_4228
    || WinMgr.Unknown_4228 == 1
    || WinMgr.Unknown_4228 == 7
    || WinMgr.Unknown_4228 == 8
    || WinMgr.Unknown_4228 == 0x10
    || WinMgr.Unknown_4228 == 0x14 )
  {
    v14 = 0x50;
  }
  a1->a2.a1.pane.x0 = v14;
  a1->a2.a1.pane.y0 = 0x78;
  a1->a2.a1.pane.x1 = v14 + 0x14F;
  a1->a2.a1.pane.y1 = 0x177;
}

//----- (0002FD68) --------------------------------------------------------
unsigned int __fastcall sub_2FD68(int a1, __int16 a2, LONG a3, LONG a4)
{
  int v4; // ebx
  int v6; // edx
  int v7; // ebx

  if ( (unsigned __int16)a2 < 6u )
  {
    if ( (unsigned __int16)a2 < 2u )
    {
      if ( a2 == 1 )
      {
        *(_DWORD *)(a1 + 0x35) = 0xFFFFFFFF;
        v4 = *(_DWORD *)(a1 + 0xA7);
        *(_DWORD *)(a1 + 0x39) = 0xFFFFFFFF;
        (*(void (**)(void))(v4 + 0xC))();
        return 0;
      }
      return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
    }
    if ( (unsigned __int16)a2 > 2u && a2 == 5 )
    {
      goto LABEL_9;
    }
    return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
  }
  if ( (unsigned __int16)a2 <= 7u )
  {
    return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
  }
  if ( (unsigned __int16)a2 < 0xDu )
  {
    if ( a2 != 0xC )
    {
      return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
    }
LABEL_9:
    sub_56B60(&WinMgr, 6, 0xCA, 0);
    return 0xFFFFFFFF;
  }
  if ( (unsigned __int16)a2 <= 0xDu || (unsigned __int16)a2 < 0x32u || (unsigned __int16)a2 > 0x32u )
  {
    return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
  }
  v6 = *(_DWORD *)(a1 + 0xDA7);
  if ( v6 >= *(_DWORD *)(a1 + 0xDAB) )
  {
    sub_56B60(&WinMgr, 6, a3, a4);
  }
  else
  {
    v7 = *(_DWORD *)(a1 + 0xA7);
    *(_DWORD *)(a1 + 0xDA7) = v6 + 1;
    (*(void (**)(void))(v7 + 0xC))();
  }
  return 0;
}

//----- (0002FE58) --------------------------------------------------------
void __fastcall Q_HELPWIN_CPP_FgetsLine_sub_2FE58(FILE *fp, char *line)
{
  unsigned int found; // edi
  char first; // ah

  found = 0;
  do
  {
    if ( !fgets(line, 200, fp) )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\helpwin.cpp", 0x9E);
    }
    first = *line;
    if ( *line != ' ' && first != '\t' && first != '\n' && first != '\r' && first != '/' && first != '#' )
    {
      found = 0xFFFFFFFF;
    }
  }
  while ( !found );
}

//----- (0002FEB8) --------------------------------------------------------
int __fastcall sub_2FEB8(P_Wnd20HW a1)
{
  T_Wnd20HW *v1; // edx
  P_Wnd20HW v2; // kr04_4
  int v3; // kr08_4
  __int8 *Unknown_DD; // eax
  P_Wnd20HW v5; // edx
  P_Wnd20HW v6; // ecx
  const char *helpTopic; // ecx
  __int64 v8; // rax
  int v9; // edx
  int v10; // edx
  int v11; // eax
  int v12; // edx
  _DWORD *p_magic12345678; // edx
  PANE *p_pane; // ebx
  int v15; // edi
  int v16; // eax
  int v17; // eax
  __int8 *v18; // edx
  int v19; // eax
  int v20; // edx
  char *v21; // esi
  char *v22; // edi
  char v23; // al
  char v24; // al
  _BYTE *v25; // ecx
  int v26; // esi
  char v27; // bl
  int v28; // ecx
  int v29; // esi
  char *v30; // ebx
  char s[204]; // [esp+0h] [ebp-13Ah] BYREF
  char s2[60]; // [esp+CCh] [ebp-6Eh] BYREF
  char s1[60]; // [esp+108h] [ebp-32h] BYREF
  char v35[52]; // [esp+144h] [ebp+Ah] BYREF
  FILE *fp; // [esp+178h] [ebp+3Eh]
  __int8 *Unknown_C95; // [esp+17Ch] [ebp+42h]
  LONG v38; // [esp+180h] [ebp+46h] BYREF
  int v39; // [esp+184h] [ebp+4Ah] BYREF
  int v40; // [esp+188h] [ebp+4Eh] BYREF
  int v41; // [esp+18Ch] [ebp+52h] BYREF
  __int8 *v42; // [esp+190h] [ebp+56h]
  int v43; // [esp+194h] [ebp+5Ah]
  int v44; // [esp+198h] [ebp+5Eh]
  int v45; // [esp+19Ch] [ebp+62h]
  int v46; // [esp+1A0h] [ebp+66h]
  int v47; // [esp+1A4h] [ebp+6Ah]
  int v48; // [esp+1A8h] [ebp+6Eh]
  unsigned int v49; // [esp+1ACh] [ebp+72h]
  P_Wnd20HW v50; // [esp+1B0h] [ebp+76h]
  int v51; // [esp+1B4h] [ebp+7Ah]
  int v52; // [esp+1B8h] [ebp+7Eh]

  v50 = a1;
  sub_2D258(&a1->a2, 2);
  v1 = (T_Wnd20HW *)&v50->Unknown_DD[0x31];
  v2 = v50;
  v3 = 0;
  do
  {
    v2->Unknown_C91[v3++].Unknown_00 = 0;
  }
  while ( (P_Wnd20HW)((char *)v2 + 0x1B * v3) != v1 );
  Unknown_DD = v50->Unknown_DD;
  v50->Unknown_DA3 = 0;
  memset(Unknown_DD, 0, 3000u);
  v48 = 0;
  v46 = 0;
  v45 = 0;
  v5 = v50;
  v6 = v50;
  v50->a2.a1.d = word_FFEEA;
  v5->a2.a1.shapeFrame = 0;
  helpTopic = v6->helpTopic;
  fp = Q_OpenFile_sub_1BB10(v5->Unknown_AB, 0);
  do
  {
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(fp, s);
    sscanf(s, "%s", s1);
    if ( !stricmp(s1, "HELP") )
    {
      sscanf(s, "%s %s", s1, s2);
      if ( !stricmp(helpTopic, s2) )
      {
        v48 = 1;
      }
      else if ( !stricmp("END", s2) )
      {
        v8 = sub_2620C("Topic '%s' not found in help file.\n", (char)helpTopic);
        sub_261B8(0, (const char *)HIDWORD(v8), 0xE8);
      }
    }
  }
  while ( !v48 );
  v47 = 0xFFFFFFFF;
  v43 = 0xFFFFFFFF;
  Unknown_C95 = v50->Unknown_C95;
  if ( v48 != 2 )
  {
    v42 = v50->Unknown_DD;
    v49 = 4 * v46;
    v44 = 0x258 * v45;
    do
    {
      Q_HELPWIN_CPP_FgetsLine_sub_2FE58(fp, s);
      sscanf(s, "%s", s1);
      if ( !stricmp(s1, "HELP") )
      {
        v48 = 2;
      }
      else if ( !stricmp(s1, "POS") )
      {
        v9 = (int)Unknown_C95;
        sscanf(s, "%s %d %d", s1, &v38, &v39);
        *(_WORD *)(v9 + 0x13) = v38;
        *(_WORD *)(v9 + 0x15) = v39;
      }
      else if ( !stricmp(s1, "SHAPE") )
      {
        v10 = v50->Unknown_DA3 + 1;
        v50->Unknown_DA3 = v10;
        if ( v10 >= 0xA )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\helpwin.cpp", 0x124);
        }
        if ( v47 == 0xFFFFFFFF )
        {
          v47 = 0;
        }
        else
        {
          Unknown_C95 += 0x1B;
        }
        v11 = (int)Unknown_C95;
        *Unknown_C95 = 0;
        *(_WORD *)(v11 + 1) = 0;
        *(_WORD *)(v11 + 3) = 0;
        *(_WORD *)(v11 + 0x13) = 0;
        *(_WORD *)(v11 + 0x15) = 0;
        if ( sscanf(s, "%s %d %d %d %d", s1, &v38, &v39, &v40, &v41) == 5 )
        {
          v12 = (int)Unknown_C95;
          *(_WORD *)(Unknown_C95 + 1) = v38;
          *(_WORD *)(v12 + 3) = v39;
          *(_WORD *)(v12 + 0x13) = v40;
          *(_WORD *)(v12 + 0x15) = v41;
        }
      }
      else if ( !stricmp(s1, "BUTTON") )
      {
        if ( v43 == 0xFFFFFFFF )
        {
          v43 = 0;
        }
        else
        {
          v49 += 4;
          ++v46;
        }
        if ( (__int16)v50->a2.a1.childrenCnt <= v46 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\helpwin.cpp", 0x145);
        }
        sub_56D30(&WinMgr, (*v50->a2.a1.children)[v49 / 4]->index, 0xE, 0, 0);
      }
      else if ( !stricmp(s1, "TITLE") )
      {
        sscanf(s, "%s %s", s1, (*v50->a2.a1.children)[v49 / 4]->name);
      }
      else if ( !stricmp(s1, "MSG") )
      {
        sscanf(s, "%s %d", s1, &v38);
        (*v50->a2.a1.children)[v49 / 4]->sendParam1 = v38;
      }
      else if ( !stricmp(s1, "PANE") )
      {
        sscanf(s, "%s %d %d %d %d", s1, &v38, &v39, &v40, &v41);
        p_magic12345678 = &(*v50->a2.a1.children)[v49 / 4]->magic12345678;
        p_magic12345678[2] = v38;
        p_magic12345678[3] = v39;
        p_magic12345678[4] = v40;
        p_magic12345678[5] = v41;
      }
      else if ( !stricmp(s1, "BPOS") )
      {
        sscanf(s, "%s %s", s1, v35);
        p_pane = &(*v50->a2.a1.children)[v49 / 4]->pane;
        if ( !stricmp(v35, "BL") )
        {
          p_pane->x0 = v50->a2.a1.pane.x0 + 0xF;
          p_pane->y0 = v50->a2.a1.pane.y1 - 0x32;
          p_pane->x1 = v50->a2.a1.pane.x0 + 0x5A;
          p_pane->y1 = v50->a2.a1.pane.y1 - 0xF;
        }
        else if ( !stricmp(v35, "BR") )
        {
          p_pane->x0 = v50->a2.a1.pane.x1 - 0x5A;
          p_pane->y0 = v50->a2.a1.pane.y1 - 0x32;
          p_pane->x1 = v50->a2.a1.pane.x1 - 0xF;
          p_pane->y1 = v50->a2.a1.pane.y1 - 0xF;
        }
      }
      else if ( !stricmp(s1, "TEXT") )
      {
        v15 = v50->Unknown_DA3 + 1;
        v50->Unknown_DA3 = v15;
        if ( v15 >= 0xA )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\helpwin.cpp", 0x177);
        }
        if ( v45 >= 5 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\helpwin.cpp", 0x178);
        }
        if ( v47 == 0xFFFFFFFF )
        {
          v47 = 0;
        }
        else
        {
          Unknown_C95 += 0x1B;
        }
        v16 = (int)Unknown_C95;
        *Unknown_C95 = 1;
        *(_DWORD *)(v16 + 0xF) = 0;
        v17 = v44;
        v44 += 0x258;
        v18 = &v42[v17];
        v19 = (int)Unknown_C95;
        *(_DWORD *)(Unknown_C95 + 5) = v18;
        *v18 = 0;
        *(_DWORD *)(v19 + 0xB) = &WinMgr.LargeFont;
        *(_WORD *)(v19 + 0x13) = 0;
        *(_WORD *)(v19 + 0x15) = 0;
        *(_WORD *)(v19 + 9) = 0xFFFF;
        ++v45;
        if ( sscanf(s, "%s %d %d %d", s1, &v38, &v39, &v40) == 4 )
        {
          v20 = (int)Unknown_C95;
          *(_WORD *)(Unknown_C95 + 0x13) = v38;
          *(_WORD *)(v20 + 0x15) = v39;
          *(_WORD *)(v20 + 9) = v40;
        }
        v51 = 0;
        v52 = 0;
        do
        {
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(fp, s);
          if ( !strnicmp(s, "ENDTEXT", 7u) )
          {
            v51 = 0xFFFFFFFF;
          }
          else
          {
            v52 += strlen(s);
            if ( v52 >= 0x254 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\helpwin.cpp", 0x19E);
            }
            v21 = s;
            v22 = (char *)(*(_DWORD *)(Unknown_C95 + 5) + strlen(*(const char **)(Unknown_C95 + 5)));
            do
            {
              v23 = *v21;
              *v22 = *v21;
              if ( !v23 )
              {
                break;
              }
              v24 = v21[1];
              v21 += 2;
              v22[1] = v24;
              v22 += 2;
            }
            while ( v24 );
          }
        }
        while ( !v51 );
        if ( !*(_DWORD *)(Unknown_C95 + 5) )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\helpwin.cpp", 0x1A6);
        }
        v25 = *(_BYTE **)(Unknown_C95 + 5);
        v26 = 0;
        if ( *v25 )
        {
          do
          {
            if ( v26 >= 0x255 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\helpwin.cpp", 0x1AC);
            }
            if ( *v25 == 0xA )
            {
              *v25 = 0x20;
            }
            else if ( *v25 == 0x40 )
            {
              *v25 = 0xA;
            }
            v27 = *++v25;
            ++v26;
          }
          while ( v27 );
        }
      }
      else if ( !stricmp(s1, "CENTERPOS") )
      {
        *(_WORD *)(Unknown_C95 + 0x13) = (v50->a2.a1.pane.x1 - v50->a2.a1.pane.x0) / 2;
        *(_WORD *)(Unknown_C95 + 0x15) = (v50->a2.a1.pane.y1 - 0x32 - v50->a2.a1.pane.y0) / 2;
      }
      else if ( !stricmp(s1, "FONT") )
      {
        sscanf(s, "%s %s", s1, v35);
        if ( !stricmp(v35, "LARGE") )
        {
          *(_DWORD *)(Unknown_C95 + 0xB) = &WinMgr.LargeFont;
        }
        else if ( !stricmp(v35, "SMALL") )
        {
          *(_DWORD *)(Unknown_C95 + 0xB) = &WinMgr.SmallFont;
        }
      }
      else if ( !stricmp(s1, "FLAGS") )
      {
        v28 = 0;
        v29 = sscanf(s, "%s %s %s %s %s %s", s1, v35, &v35[0xA], &v35[0x14], &v35[0x1E], &v35[0x28]) - 1;
        v30 = v35;
        while ( v28 < v29 )
        {
          if ( !stricmp(v30, "TJ_HC") )
          {
            Unknown_C95[0xF] |= 2u;
          }
          else if ( !stricmp(v30, "TJ_VC") )
          {
            Unknown_C95[0xF] |= 1u;
          }
          else if ( !stricmp(v30, "TJ_R") )
          {
            Unknown_C95[0xF] |= 0x20u;
          }
          else if ( !stricmp(v30, "TJ_B") )
          {
            Unknown_C95[0xF] |= 0x10u;
          }
          ++v28;
          v30 += 0xA;
        }
      }
      else if ( !stricmp(s1, "NEWPAGE") )
      {
        *(_DWORD *)(Unknown_C95 + 0x17) = 0xFFFFFFFF;
        ++v50->Unknown_DAB;
      }
    }
    while ( v48 != 2 );
  }
  return fclose(fp);
}

//----- (00030774) --------------------------------------------------------
void __fastcall sub_30774(int a1)
{
  PANE *v1; // esi
  int v2; // eax
  void *ShapeTable_sub_1B084; // eax
  int v4; // edi
  int v5; // esi
  int v6; // eax
  int v7; // kr04_4
  int v8; // esi
  int v9; // ebx
  int v10; // ecx
  int v11; // kr0C_4
  int v12; // kr24_4
  _DWORD *v13; // eax
  int v14; // esi
  int v15; // edx
  int v16; // ebx
  int v17; // kr14_4
  int v18; // esi
  char *v19; // kr18_4
  int v20; // kr1C_4
  char v21; // ah
  void *v22; // eax
  int v23; // edx
  int v24; // ebx
  int v25; // eax
  const char *v26; // ecx
  T_Font *v27; // eax
  int v28; // edx
  int v29; // edi
  __int16 v30; // [esp-Ch] [ebp-A4h]
  LONG v31; // [esp-8h] [ebp-A0h]
  LONG v32; // [esp-8h] [ebp-A0h]
  __int16 v33; // [esp-8h] [ebp-A0h]
  LONG v34; // [esp-4h] [ebp-9Ch]
  int v35; // [esp+0h] [ebp-98h]
  PANE pane; // [esp+54h] [ebp-44h] BYREF
  int v37; // [esp+68h] [ebp-30h]
  int v38; // [esp+6Ch] [ebp-2Ch]
  int v39; // [esp+70h] [ebp-28h]
  int v40; // [esp+74h] [ebp-24h]
  _DWORD *v41; // [esp+78h] [ebp-20h]
  __int16 v42; // [esp+7Ch] [ebp-1Ch]
  __int16 v43; // [esp+80h] [ebp-18h]

  v41 = (_DWORD *)a1;
  v1 = (PANE *)(a1 + 4);
  VFX_pane_wipe((PANE *)(a1 + 4), 0xF2);
  v2 = *((unsigned __int16 *)v41 + 0xC);
  if ( (unsigned __int16)v2 != 0xFFFF )
  {
    v35 = 0;
    v31 = *((__int16 *)v41 + 0xF);
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEA0[v2]);
    VFX_shape_draw(v1, ShapeTable_sub_1B084, v31, 0, 0);
  }
  v4 = 0;
  v5 = 0;
  sub_552CC(&WinMgr, (PANE *)(v41 + 1));
  v6 = 0;
  v7 = 0;
  while ( v6 < *(__int16 *)((char *)v41 + 0x6B) )
  {
    if ( *(_DWORD *)(*(_DWORD *)(4 * v7 + *(_DWORD *)((char *)v41 + 0x67)) + 0x35) == 0xFFFFFFFF )
    {
      ++v4;
      *(int *)((char *)&v35 + v5 + 4) = v6;
      v5 += 4;
    }
    ++v6;
    ++v7;
  }
  v8 = v41[2] + 8;
  v9 = v41[2] + 0x147;
  if ( v4 > 0 )
  {
    v10 = v4;
    v38 = 4 * v4;
    v11 = 0;
    v12 = 0;
    do
    {
      v13 = v41;
      *(_DWORD *)(v4 + 4 * v11 + 8) = v8;
      *(_DWORD *)(v4 + 4 * v11 + 0xC) = v13[3] + 0xD9;
      *(_DWORD *)(v4 + 4 * v11 + 0x14) = v41[3] + 0xF7;
      v14 = (v9 - v8) / v10 + v8;
      ++v11;
      if ( v14 > v9 )
      {
        v14 = v9;
      }
      --v10;
      *(_DWORD *)(v4 + 4 * v11 + 0xC) = v14;
      v8 = v14 + 1;
      ++v12;
    }
    while ( 4 * v12 < v38 );
  }
  pane = *(PANE *)(v41 + 1);
  pane.x0 = v41[2] + 0xA;
  pane.y0 = v41[3] + 0xA;
  pane.x1 = v41[2] + 0x145;
  pane.y1 = v41[3] + 0xCF;
  v15 = 0;
  v16 = *(_DWORD *)((char *)v41 + 0xDA7);
  v40 = 0;
  v17 = 0;
  if ( v16 > 0 )
  {
    do
    {
      if ( v40 >= *(_DWORD *)((char *)v41 + 0xDA3) )
      {
        break;
      }
      if ( *(_DWORD *)((char *)v41 + 0x1B * v17 + 0xCAC) == 0xFFFFFFFF )
      {
        ++v15;
      }
      v18 = *(_DWORD *)((char *)v41 + 0xDA7);
      ++v40;
      ++v17;
    }
    while ( v15 < v18 );
  }
  v39 = 0;
  v19 = (char *)v41 + 0x1B * v40 + 0xC95;
  v20 = 0;
  if ( v40 < *(_DWORD *)((char *)v41 + 0xDA3) )
  {
    do
    {
      if ( v39 == 0xFFFFFFFF )
      {
        break;
      }
      v39 = *(_DWORD *)&v19[0x1B * v20 + 0x17];
      v21 = v19[0x1B * v20];
      if ( v21 )
      {
        if ( v21 == 1 )
        {
          v23 = 0;
          if ( (v19[0x1B * v20 + 0xF] & 2) == 0 )
          {
            v23 = pane.x1 - pane.x0 - *(__int16 *)&v19[0x1B * v20 + 0x13];
          }
          v35 = v23;
          v24 = *(__int16 *)&v19[0x1B * v20 + 0x15];
          v25 = *(__int16 *)&v19[0x1B * v20 + 0x13];
          v26 = *(const char **)&v19[0x1B * v20 + 5];
          v42 = *(_WORD *)&v19[0x1B * v20 + 0xF];
          v43 = *(_WORD *)&v19[0x1B * v20 + 9];
          v37 = v25;
          v27 = *(T_Font **)&v19[0x1B * v20 + 0xB];
          v33 = v43;
          v30 = v42;
          v28 = v37;
          v27->pane = pane;
          sub_2B8A8(v27, v28, v24, v26, v30, v33, 0xFF, v35);
        }
        else if ( v21 != 2 )
        {
          Q_AssertLogBreakExit_sub_261A8(0, "..\\helpwin.cpp", 0x245);
        }
      }
      else
      {
        v35 = *(__int16 *)&v19[0x1B * v20 + 0x15];
        v34 = *(__int16 *)&v19[0x1B * v20 + 0x13];
        v32 = *(unsigned __int16 *)&v19[0x1B * v20 + 3];
        v22 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                (unsigned int)&WinMgr.t13,
                (unsigned __int16)word_FFEA0[*(unsigned __int16 *)&v19[0x1B * v20 + 1]]);
        VFX_shape_draw(&pane, v22, v32, v34, v35);
      }
      v29 = *(_DWORD *)((char *)v41 + 0xDA3);
      ++v40;
      ++v20;
    }
    while ( v40 < v29 );
  }
  sub_2D218(v41);
}
// FFEA0: using guessed type __int16 word_FFEA0[7];

//----- (00030A90) --------------------------------------------------------
int __fastcall sub_30A90(T_Type5 *a1, int edx0, int a3, int a4)
{
  int v5; // edx
  int v6; // eax
  char *sub_1CEA8; // eax
  int result; // eax
  int *v9; // eax
  LONG v10; // edx
  void *ShapeTable_sub_1B084; // eax
  char *v12; // eax
  int v13; // edx
  int v14; // ebx
  int v15; // ecx
  int v16; // esi
  char *v17; // eax
  void *v18; // eax
  void *v19; // eax
  int v20; // eax
  char *v21; // eax
  __int16 v22; // di
  int v23; // kr04_4
  LONG v24; // ecx
  void *v25; // eax
  __int16 v26; // edx^2
  char *v27; // eax
  __int16 v28; // di
  int v29; // kr0C_4
  LONG v30; // ecx
  void *v31; // eax
  __int16 v32; // edx^2
  int v33; // eax
  char *v34; // eax
  __int16 v35; // di
  int v36; // kr14_4
  LONG v37; // ecx
  void *v38; // eax
  LONG v39; // esi
  LONG v40; // ebx
  void *v41; // eax
  int *v42; // edi
  LONG v43; // ebx
  void *v44; // eax
  int v45; // ecx
  LONG v46; // [esp-20h] [ebp-B0h]
  int v47; // [esp-8h] [ebp-98h]
  int v48; // [esp-8h] [ebp-98h]
  int v49; // [esp-8h] [ebp-98h]
  int v50; // [esp-8h] [ebp-98h]
  char v51; // [esp-4h] [ebp-94h]
  int v52; // [esp-4h] [ebp-94h]
  char v53; // [esp-4h] [ebp-94h]
  char v54; // [esp-4h] [ebp-94h]
  char v55; // [esp-4h] [ebp-94h]
  char v56; // [esp-4h] [ebp-94h]
  __int16 v57; // [esp-4h] [ebp-94h]
  char s[52]; // [esp+0h] [ebp-90h] BYREF
  int v59; // [esp+34h] [ebp-5Ch]
  int v60; // [esp+38h] [ebp-58h]
  LONG shape_number; // [esp+3Ch] [ebp-54h]
  char *v62; // [esp+40h] [ebp-50h]
  int a2; // [esp+44h] [ebp-4Ch]
  int v64; // [esp+48h] [ebp-48h]
  LONG v65; // [esp+4Ch] [ebp-44h]
  int v66; // [esp+50h] [ebp-40h]
  int v67; // [esp+54h] [ebp-3Ch]
  int v68; // [esp+58h] [ebp-38h]
  int v69; // [esp+5Ch] [ebp-34h]
  int v70; // [esp+60h] [ebp-30h]
  LONG v71; // [esp+64h] [ebp-2Ch]
  LONG v72; // [esp+68h] [ebp-28h]
  LONG hotY; // [esp+6Ch] [ebp-24h]
  int *v74; // [esp+70h] [ebp-20h]
  int v75; // [esp+74h] [ebp-1Ch]
  int v76; // [esp+78h] [ebp-18h]
  __int16 i; // [esp+7Ch] [ebp-14h]
  int v78; // [esp+80h] [ebp-10h]

  v74 = (int *)edx0;
  v64 = 9;
  if ( a4 && (a3 == 1 || *(_DWORD *)(edx0 + 8) != 0xFFFFFFFF) )
  {
    v64 = 0xF3;
  }
  else
  {
    v5 = v74[2];
    if ( v5 != 0xFFFFFFFF )
    {
      v64 = 4 * v74[v5 + 0xA] + 0x13;
    }
  }
  sprintf(s, "%d.", v74[0x1B]);
  a2 = (__int16)v64;
  WinMgr.LargeFont.pane = (PANE)*a1;
  sub_2B8A8(&WinMgr.LargeFont, 5, 5, s, 0, v64, 0xFF, 0);
  HIWORD(v6) = HIWORD(v74);
  if ( v74[2] == 0xFFFFFFFF )
  {
    sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x10);// 16: "<EMPTY>"
    WinMgr.LargeFont.pane = (PANE)*a1;
    return sub_2B8A8(&WinMgr.LargeFont, 0x1E, 5, sub_1CEA8, 0, a2, 0xFF, 0);
  }
  LOWORD(v6) = word_FFEE0;
  v78 = v6;
  v9 = &v74[v74[2]];
  v10 = v9[3];
  v75 = v9[0xA];
  shape_number = v10;
  v51 = v75;
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v78);
  sub_53F40(a1, ShapeTable_sub_1B084, v10, 0x19, 5, v51);
  WinMgr.LargeFont.pane = (PANE)*a1;
  sub_2B8A8(&WinMgr.LargeFont, 0x2D, 5, V_SpecNames[shape_number], 0, a2, 0xFF, 0);
  v52 = *v74;
  v12 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x11);      // 17: "Day %d"
  sprintf(s, v12, v52);
  WinMgr.LargeFont.pane = (PANE)*a1;
  sub_2B8A8(&WinMgr.LargeFont, 0x2D, 0x14, s, 0, a2, 0xFF, 0);
  v13 = ((v74[0x1C] & 0xFE00) >> 9) + 0x50;
  v14 = v74[0x1C] & 0x1F;
  v15 = (v74[0x1C] & 0x1E0) >> 5;
  v66 = (*((_WORD *)v74 + 0x39) & 0xF800) >> 0xB;
  v16 = v66;
  v62 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x12);      // 18: "am"
  if ( v16 )
  {
    if ( v16 == 0xC )
    {
      v17 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x13);  // 19: "pm"
    }
    else
    {
      if ( v16 <= 0xC )
      {
        goto LABEL_16;
      }
      v17 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x13);  // 19: "pm"
      v66 = v16 - 0xC;
    }
    v62 = v17;
    goto LABEL_16;
  }
  v66 = 0xC;
LABEL_16:
  v59 = (*((_WORD *)v74 + 0x39) & 0x7E0) >> 5;
  sprintf(s, "%d/%d/%d", v15, v14, v13);
  v60 = (__int16)v64;
  WinMgr.LargeFont.pane = (PANE)*a1;
  sub_2B8A8(&WinMgr.LargeFont, 0x2D, 0x32, s, 0, v64, 0xFF, 0);
  sprintf(s, "%d : %.2d %s", v66, v59, v62);
  WinMgr.LargeFont.pane = (PANE)*a1;
  sub_2B8A8(&WinMgr.LargeFont, 0x2D, 0x41, s, 0, v60, 0xFF, 0);
  v46 = shape_number;
  v18 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF4);
  VFX_shape_transform((PANE *)a1, v18, v46, 0x96, 0x1E, V_BigBuffer, 0, 0x8000, 0x8000, 0);
  v53 = v75;
  v19 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF2);
  sub_53F40(a1, v19, 3, 0x96, 0x1E, v53);
  LOWORD(v20) = word_FFEF2;
  v76 = v20;
  v65 = 0xC8;
  v21 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x14);      // 20: "Fleet"
  v70 = 0x14;
  WinMgr.SmallFont.pane = (PANE)*a1;
  v22 = 0;
  sub_2B8A8(&WinMgr.SmallFont, 0xC8, 5, v21, 0, v60, 0xFF, 0);
  v23 = 0;
  while ( v22 < v74[0x18] )
  {
    v24 = v65;
    v54 = v75;
    v47 = v70;
    v25 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v76);
    sub_53F40(a1, v25, 5, v24, v47, v54);
    ++v23;
    if ( v22 % 9 == 8 )
    {
      v65 = 0xC8;
      v70 += 8;
    }
    ++v22;
  }
  v26 = v64;
  v27 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x15);      // 21: "Colonies"
  v71 = 0x118;
  v69 = 0x14;
  WinMgr.SmallFont.pane = (PANE)*a1;
  v28 = 0;
  sub_2B8A8(&WinMgr.SmallFont, 0x118, 5, v27, 0, v26, 0xFF, 0);
  v29 = 0;
  while ( v28 < v74[0x19] )
  {
    v30 = v71;
    v55 = v75;
    v48 = v69;
    v31 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v76);
    sub_53F40(a1, v31, 6, v30, v48, v55);
    ++v29;
    if ( v28 % 9 == 8 )
    {
      v71 = 0x118;
      v69 += 8;
    }
    ++v28;
  }
  v32 = v64;
  v33 = v74[0x1A] >> 2;
  v72 = 0x168;
  v67 = v33;
  v68 = 0x14;
  v34 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x16);      // 22: "Discoveries"
  WinMgr.SmallFont.pane = (PANE)*a1;
  v35 = 0;
  sub_2B8A8(&WinMgr.SmallFont, 0x168, 5, v34, 0, v32, 0xFF, 0);
  v36 = 0;
  while ( v35 < v67 )
  {
    v56 = v75;
    v49 = v68;
    v37 = v72;
    v38 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v76);
    sub_53F40(a1, v38, 7, v37, v49, v56);
    ++v36;
    if ( v35 % 9 == 8 )
    {
      v72 = 0x168;
      v68 += 8;
    }
    ++v35;
  }
  hotY = 5;
  v39 = 0x1CC;
  for ( i = 0; ; ++i )
  {
    result = i;
    if ( i >= v74[1] )
    {
      break;
    }
    if ( i != v74[2] )
    {
      v42 = &v74[i];
      if ( v42[0x11] )
      {
        v57 = *((_WORD *)v42 + 0x14);
        v50 = hotY;
        v43 = v42[3];
        v44 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v78);
        sub_53F40(a1, v44, v43, v39, v50, v57);
        v45 = v42[0x11];
        v40 = 0xFFFFFFFF;
        if ( v45 == 3 )
        {
          v40 = 9;
        }
        else if ( v45 == 2 )
        {
          v40 = 8;
        }
        if ( v40 != 0xFFFFFFFF )
        {
          v41 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF2);
          VFX_shape_draw((PANE *)a1, v41, v40, v39, hotY);
        }
        v39 += 0x39;
        if ( v39 > 0x258 )
        {
          v39 = 0x1CC;
          hotY += 0x1B;
        }
      }
    }
  }
  return result;
}
// 30E3F: variable 'v20' is possibly undefined
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (00031158) --------------------------------------------------------
int __fastcall sub_31158(_DWORD *a1, int a2, int a3, int a4)
{
  __int16 v5; // dx
  char s[12]; // [esp+0h] [ebp-20h] BYREF
  int v8; // [esp+Ch] [ebp-14h]
  int v9; // [esp+10h] [ebp-10h]

  v9 = a2;
  v5 = 9;
  if ( a4 )
  {
    v5 = 0xF3;
  }
  sprintf(s, "%d.", *(_DWORD *)(v9 + 0xDC));
  WinMgr.LargeFont.pane = *(PANE *)a1;
  v8 = v5;
  sub_2B8A8(&WinMgr.LargeFont, 5, 5, s, 0, v5, 0xFF, 0);
  WinMgr.LargeFont.pane = *(PANE *)a1;
  return sub_2B8A8(&WinMgr.LargeFont, 0x1E, 5, (const char *)(v9 + 0x14), 0, v8, 0xFF, 0x226);
}

//----- (00031200) --------------------------------------------------------
void __fastcall __spoils<> Q_WndLW_sub_31200(P_WndLW result)
{
  Q_A2Ctor_sub_2C830(&result->a);
  result->a.procs = (P_Procs)off_95E88;
  Q_A1_sub_2C8E4(&result->a.a1);
}
// 95E88: using guessed type int (*off_95E88[5])();

//----- (0003121C) --------------------------------------------------------
T_TypeA2 *__fastcall sub_3121C(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_95E74);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95E88;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95E88: using guessed type int (*off_95E88[5])();

//----- (00031268) --------------------------------------------------------
unsigned int __fastcall sub_31268(int a1, unsigned __int16 a2, LONG a3, LONG a4)
{
  const char *v6; // ecx
  T_TypeA2 *Wnd_sub_56DA8; // eax
  char v8; // bl
  int v9; // edx
  LONG v10; // ebx
  int v11; // kr0C_4
  int v12; // kr38_4
  int v13; // kr3C_4
  char v14; // al
  char v15; // al
  const char *v16; // esi
  int v17; // edx
  LONG v18; // ecx
  int v19; // kr14_4
  int v20; // kr40_4
  int v21; // kr44_4
  char v22; // al
  char v23; // al
  int v24; // eax
  int v25; // ebx
  int v26; // esi
  char v27; // ah
  int v28; // ebp
  int v29; // kr1C_4
  int v30; // kr4C_4
  char v31; // al
  char v32; // al
  int v33; // kr24_4
  char *v34; // kr50_4
  int v35; // kr54_4
  char v36; // al
  char v37; // al
  int v38; // kr2C_4
  int v39; // kr5C_4
  char v40; // al
  char v41; // al
  int v42; // kr34_4
  char *v43; // kr60_4
  int v44; // kr64_4
  char v45; // al
  char v46; // al
  T_FileInfo v47; // [esp+0h] [ebp-144h] BYREF
  char fname[20]; // [esp+118h] [ebp-2Ch] BYREF
  LONG v49; // [esp+138h] [ebp-Ch]
  LONG v50[2]; // [esp+13Ch] [ebp-8h]

  LOWORD(v50[1]) = a2;
  v50[0] = a3;
  v49 = a4;
  if ( a2 < 3u )
  {
    if ( a2 != 1 )
    {
      return sub_2F424((T_TypeA2 *)a1, v50[1], v50[0], v49);
    }
    v6 = "savescr";
    if ( WinMgr.Unknown_4228 == 2 )
    {
      *(_BYTE *)(a1 + 0xAF) = 1;
    }
    else if ( WinMgr.Unknown_4228 == 4 )
    {
      v6 = "loadscr";
      *(_BYTE *)(a1 + 0xAF) = 0;
    }
    else
    {
      v6 = "tutscr";
      *(_BYTE *)(a1 + 0xAF) = 2;
    }
    Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&WinMgr, "LOADLIST", 0);
    v8 = *(_BYTE *)(a1 + 0xAF);
    *(_DWORD *)(a1 + 0xAB) = Wnd_sub_56DA8;
    if ( v8 == 2 )
    {
      LOWORD(Wnd_sub_56DA8[0xD].a1.e) = 0x3C;
      Q_A10_SetProc_sub_2F1C8(*(P_Wnd10LB *)(a1 + 0xAB), sub_31158);
      sub_317D0(a1);
    }
    else
    {
      LOWORD(Wnd_sub_56DA8[0xD].a1.e) = 0x55;
      Q_A10_SetProc_sub_2F1C8(*(P_Wnd10LB *)(a1 + 0xAB), sub_30A90);
      sub_316A8(a1, (int)sub_30A90);
    }
    v9 = *(LONG *)((char *)v50 + 2);
    v10 = v50[0];
    v11 = 0;
    v12 = a1 + 0x4F;
    v13 = 0;
    do
    {
      v14 = v6[2 * v11];
      *(_BYTE *)(v12 + 2 * v13) = v14;
      if ( !v14 )
      {
        break;
      }
      v15 = v6[2 * v11 + 1];
      *(_BYTE *)(v12 + 2 * v13 + 1) = v15;
      ++v11;
      ++v13;
    }
    while ( v15 );
    v16 = v6;
    v17 = v9 >> 0x10;
    v18 = v49;
    v19 = 0;
    v20 = *(_DWORD *)(a1 + 0xAB) + 0x4F;
    v21 = 0;
    do
    {
      v22 = v16[2 * v19];
      *(_BYTE *)(v20 + 2 * v21) = v22;
      if ( !v22 )
      {
        break;
      }
      v23 = v16[2 * v19 + 1];
      *(_BYTE *)(v20 + 2 * v21 + 1) = v23;
      ++v19;
      ++v21;
    }
    while ( v23 );
    sub_2F424((T_TypeA2 *)a1, v17, v10, v18);
    return 0;
  }
  if ( a2 <= 3u )
  {
    if ( a3 >= 0x31 && a3 <= 0x39 )
    {
      v24 = 9;
      v25 = a3 - 0x30;
      if ( *(_BYTE *)(a1 + 0xAF) == 1 )
      {
        v24 = 0xA;
      }
      if ( v25 < v24 )
      {
        (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 8))();
        return 0xFFFFFFFF;
      }
    }
    return 0;
  }
  if ( a2 != 0x1C01 )
  {
    return sub_2F424((T_TypeA2 *)a1, v50[1], v50[0], v49);
  }
  v26 = sub_2ED14(*(_DWORD *)(a1 + 0xAB), v50[0]);
  sprintf(fname, "%02d.sav", *(_DWORD *)(v26 + 0x6C));
  Q_InitFileInfo_sub_1BB78(&v47);
  v27 = *(_BYTE *)(a1 + 0xAF);
  if ( v27 == 1 )
  {
    Q_SaveGam_sub_54048(fname);
    sub_56B60(&WinMgr, 3, 0, 0);
  }
  else if ( v27 )
  {
    v28 = 0xE0 * a3 + a1 + 0x9C0;
    v29 = 0;
    v30 = 0;
    do
    {
      v31 = *(_BYTE *)(v28 + 2 * v29);
      fname[2 * v30] = v31;
      if ( !v31 )
      {
        break;
      }
      v32 = *(_BYTE *)(v28 + 2 * v29 + 1);
      fname[2 * v30 + 1] = v32;
      ++v29;
      ++v30;
    }
    while ( v32 );
    v33 = 0;
    v34 = &fname[strlen(fname)];
    v35 = 0;
    do
    {
      v36 = aTsv[2 * v33];
      v34[2 * v35] = v36;
      if ( !v36 )
      {
        break;
      }
      v37 = aTsv[2 * v33 + 1];
      v34[2 * v35 + 1] = v37;
      ++v33;
      ++v35;
    }
    while ( v37 );
    Q_LoadGam_sub_53FB0(fname);
    sub_56B60(&WinMgr, 3, 0, 0);
    srand(0);
    dword_96BBC = LODWORD(WinMgr.j);
    WinMgr.j = 1.0;
    v38 = 0;
    v39 = 0;
    do
    {
      v40 = *(_BYTE *)(v28 + 2 * v38);
      fname[2 * v39] = v40;
      if ( !v40 )
      {
        break;
      }
      v41 = *(_BYTE *)(v28 + 2 * v38 + 1);
      fname[2 * v39 + 1] = v41;
      ++v38;
      ++v39;
    }
    while ( v41 );
    v42 = 0;
    v43 = &fname[strlen(fname)];
    v44 = 0;
    do
    {
      v45 = aBin[2 * v42];
      v43[2 * v44] = v45;
      if ( !v45 )
      {
        break;
      }
      v46 = aBin[2 * v42 + 1];
      v43[2 * v44 + 1] = v46;
      ++v42;
      ++v44;
    }
    while ( v46 );
    sub_59988(&WinMgr, fname, 0);
  }
  else if ( *(_DWORD *)(v26 + 8) != 0xFFFFFFFF )
  {
    Q_LoadGam_sub_53FB0(fname);
    *(_WORD *)&WinMgr.z2[0x22] = 1;
    *(_WORD *)WinMgr.z2 = 0;
    *(_WORD *)&WinMgr.z2[0x20] = 1;
    sub_56B60(&WinMgr, 1, 1, 0);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v47);
  return 0xFFFFFFFF;
}
// 96BBC: using guessed type int dword_96BBC;
// 31268: using guessed type char fname[20];

//----- (0003160C) --------------------------------------------------------
void __fastcall sub_3160C(int a1)
{
  char v2; // ah
  LONG v3; // edx
  char *v4; // eax
  char *sub_1CEA8; // [esp+0h] [ebp-18h]

  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x17);
  v2 = *(_BYTE *)(a1 + 0xAF);
  v3 = 0x10;
  if ( v2 == 1 )
  {
    v3 = 0x73;
    v4 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x18);
  }
  else
  {
    if ( v2 != 2 )
    {
      goto LABEL_6;
    }
    v4 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x19);
    v3 = 0;
  }
  sub_1CEA8 = v4;
LABEL_6:
  if ( v3 )
  {
    VFX_pane_wipe((PANE *)(a1 + 4), v3);
  }
  WinMgr.LargeFont.pane = *(PANE *)(a1 + 4);
  sub_2B8A8(&WinMgr.LargeFont, 0, 4, sub_1CEA8, 3, 0xFFFFFFFF, 0xFF, 0);
  sub_2D218((_DWORD *)a1);
}

//----- (000316A8) --------------------------------------------------------
void __fastcall sub_316A8(int a1, int a2)
{
  int v3; // edi
  int v4; // kr00_4
  int v5; // kr04_4
  unsigned __int16 v6; // dx
  T_FileInfo handle; // [esp+0h] [ebp-158h] BYREF
  char s[32]; // [esp+118h] [ebp-40h] BYREF
  int v9; // [esp+138h] [ebp-20h]
  int v10; // [esp+13Ch] [ebp-1Ch]

  v10 = a1;
  sub_2ED4C(*(P_Wnd10LB *)(a1 + 0xAB));
  v3 = 0;
  Q_InitFileInfo_sub_1BB78(&handle);
  v4 = a1 + 0xB0;
  v5 = 0;
  do
  {
    v9 = v3 + 1;
    sprintf(s, "%02d.sav", v3 + 1);
    if ( access(s, 0) )
    {
      *(_DWORD *)(v4 + 0x74 * v5 + 8) = 0xFFFFFFFF;
    }
    else
    {
      Q_OpenFile_sub_1BBFC(&handle, s, 0x200, 0);
      Q_ReadFile_sub_1BF94(&handle, (void *)(v4 + 0x74 * v5), 0x74u);
      dos_getftime(handle.fh, (unsigned __int16 *)(v4 + 0x74 * v5 + 0x70), (unsigned __int16 *)(v4 + 0x74 * v5 + 0x72));
    }
    *(_DWORD *)(v4 + 0x74 * v5 + 0x6C) = v9;
    sub_2EA8C(*(_DWORD *)(v10 + 0xAB), (const char *)(v4 + 0x74 * v5), 0xFFFFFFFF, 0);
    v6 = v3++;
    sub_2EC50(*(_DWORD *)(v10 + 0xAB), v6, *(_BYTE *)(v10 + 0xAF) == 1);
    ++v5;
  }
  while ( v3 < 0x14 );
  Q_CloseFileAndDelete_sub_1BBC8(&handle);
}
// 316A8: using guessed type T_FileInfo handle;

//----- (000317D0) --------------------------------------------------------
int __fastcall sub_317D0(int a1)
{
  FILE *v1; // ebp
  int v2; // esi
  int v3; // kr00_4
  int v4; // kr04_4
  int v5; // kr0C_4
  int v6; // eax
  int v8; // [esp+0h] [ebp-24h] BYREF
  int v9; // [esp+4h] [ebp-20h]
  int v10; // [esp+8h] [ebp-1Ch]

  v9 = a1;
  sub_2ED4C(*(P_Wnd10LB *)(a1 + 0xAB));
  v1 = Q_OpenFile_sub_1BB10("tutindex.txt", 0);
  fscanf(v1, "%d", &v8);
  if ( v8 > 7 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\loadwin.cpp", 0x1EA);
  }
  v10 = 0;
  if ( v8 > 0 )
  {
    v3 = v9 + 0x9D4;
    v4 = 0;
    v2 = v9 + 0x9C0;
    v5 = 0;
    do
    {
      fscanf(v1, "%s", v2 + 0xE0 * v5);
      Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v1, (char *)(v3 + 0xE0 * v4));
      sub_2EA8C(*(_DWORD *)(v9 + 0xAB), (const char *)(v2 + 0xE0 * v5), 0xFFFFFFFF, 0);
      v6 = v10 + 1;
      *(_DWORD *)(v2 + 0xE0 * v5 + 0xDC) = v10 + 1;
      v10 = v6;
      ++v4;
      ++v5;
    }
    while ( v6 < v8 );
  }
  return fclose(v1);
}

//----- (000318A0) --------------------------------------------------------
int __fastcall sub_318A0(unsigned __int16 a1, unsigned __int8 a2)
{
  int v3; // esi
  unsigned int v4; // edx
  int v5; // edi
  unsigned int v7; // eax
  int v8; // ebx
  int v9; // kr04_4

  v3 = *((unsigned __int16 *)dword_10032C + a1);
  if ( (unsigned __int16)v3 == 0xFFFF )
  {
    return 0;
  }
  v4 = dword_100328 + 4 * (unsigned __int16)word_100330;
  v5 = a2;
  v7 = dword_100328 + 4 * v3;
  v8 = (v5 << 0x10) + a1;
  v9 = 0;
  if ( v7 >= v4 )
  {
    return 0;
  }
  while ( v8 != *(_DWORD *)(v7 + 4 * v9) )
  {
    ++v9;
    if ( v7 + 4 * v9 >= v4 )
    {
      return 0;
    }
  }
  return (unsigned __int16)(4 * v3 / 4) + 0x102;
}
// 100328: using guessed type int dword_100328;
// 100330: using guessed type __int16 word_100330;

//----- (00031934) --------------------------------------------------------
char __fastcall sub_31934(int a1)
{
  char v1; // ch
  unsigned __int16 v2; // si
  char v3; // dh
  char v4; // al
  int v5; // edx
  char result; // al
  char v7; // ch
  int v8; // ebx

  v1 = byte_100335;
  v2 = a1;
  v3 = (a1 << byte_100335) | *(_BYTE *)dword_100324++;
  *(_BYTE *)(dword_100324 - 1) = v3;
  v4 = byte_100334;
  if ( (unsigned __int16)(dword_100324 - dword_100338) == 0x100 )
  {
    *(_BYTE *)dword_100338 = 0xFF;
    dword_100338 = dword_100324++;
  }
  v5 = (int)v2 >> (8 - v1);
  result = v4 - (8 - v1);
  v7 = 0;
  v8 = dword_100324;
  *(_BYTE *)dword_100324 = v5;
  if ( (unsigned __int8)result >= 8u )
  {
    dword_100324 = v8 + 1;
    if ( (unsigned __int16)(v8 + 1 - dword_100338) == 0x100 )
    {
      *(_BYTE *)dword_100338 = 0xFF;
      dword_100338 = dword_100324++;
    }
    if ( (unsigned __int8)result > 8u )
    {
      v7 = result - 8;
      *(_BYTE *)dword_100324 = BYTE1(v5);
    }
  }
  else
  {
    v7 = result;
  }
  byte_100335 = v7;
  return result;
}
// 100324: using guessed type int dword_100324;
// 100334: using guessed type char byte_100334;
// 100335: using guessed type char byte_100335;
// 100338: using guessed type int dword_100338;

//----- (00031A34) --------------------------------------------------------
int __fastcall sub_31A34(unsigned __int16 a1, char a2)
{
  int v2; // ecx
  unsigned __int16 v3; // bx
  _WORD *v4; // edx
  int result; // eax

  v2 = dword_100328;
  v3 = word_100330;
  *(_BYTE *)(dword_100328 + 4 * (unsigned __int16)word_100330 + 2) = a2;
  *(_WORD *)(v2 + 4 * v3) = a1;
  v4 = (char *)dword_10032C + 2 * a1;
  if ( (unsigned __int16)*v4 == 0xFFFF )
  {
    *v4 = word_100330;
  }
  sub_31934(a1);
  result = (unsigned __int16)++word_100330 + 0x102;
  if ( result > (unsigned __int16)word_100332 )
  {
    if ( result <= 0x1000 )
    {
      BYTE1(result) = byte_100334 + 1;
      word_100332 *= 2;
      ++byte_100334;
    }
    else
    {
      sub_31934(0x100);
      result = (int)dword_10032C;
      byte_100334 = 9;
      word_100332 = 0x200;
      word_100330 = 0;
      memset(dword_10032C, 0xFF, 0x2008u);
    }
  }
  return result;
}
// 100328: using guessed type int dword_100328;
// 100330: using guessed type __int16 word_100330;
// 100332: using guessed type __int16 word_100332;
// 100334: using guessed type char byte_100334;

//----- (00031B08) --------------------------------------------------------
int sub_31B08()
{
  int v0; // ebx
  int v1; // esi
  unsigned __int16 v2; // ax
  UBYTE v3; // cl
  int v4; // ebx
  int v5; // eax
  char v6; // dh
  int result; // eax
  _BYTE *v8; // ebx
  int v9; // ebx
  char v10; // bl

  v0 = dword_100324;
  byte_100334 = 9;
  word_100332 = 0x200;
  *(_BYTE *)dword_100324 = 8;
  byte_100335 = 0;
  dword_100338 = v0 + 1;
  dword_100324 = v0 + 2;
  sub_31934(0x100);
  v1 = 1;
  v2 = *V_Window1.buffer;
  do
  {
    v3 = V_Window1.buffer[v1];
    v4 = v2;
    v2 = sub_318A0(v2, v3);
    if ( !v2 )
    {
      sub_31A34(v4, v3);
      v2 = v3;
    }
    ++v1;
  }
  while ( v1 < 0x4B000 );
  sub_31934(v2);
  sub_31934(0x101);
  LOWORD(v5) = dword_100324;
  LOWORD(v4) = dword_100338;
  v6 = byte_100335;
  result = v5 - v4;
  if ( byte_100335 )
  {
    *(_BYTE *)dword_100338 = result;
    v8 = (_BYTE *)(dword_100324 + 1);
    dword_100324 = (int)v8;
    *v8 = 0;
    v9 = (int)(v8 + 1);
  }
  else
  {
    v10 = result;
    if ( (unsigned __int16)result == 1 )
    {
      result = dword_100338;
      *(_BYTE *)dword_100338 = byte_100335;
      return result;
    }
    result = dword_100338;
    *(_BYTE *)dword_100338 = v10 - 1;
    v9 = dword_100324 + 1;
    *(_BYTE *)dword_100324 = v6;
  }
  dword_100324 = v9;
  return result;
}
// 31BC0: variable 'v5' is possibly undefined
// 100324: using guessed type int dword_100324;
// 100332: using guessed type __int16 word_100332;
// 100334: using guessed type char byte_100334;
// 100335: using guessed type char byte_100335;
// 100338: using guessed type int dword_100338;

//----- (00031C18) --------------------------------------------------------
int __fastcall sub_31C18(int result, int a2)
{
  RGB *v2; // edi
  LONG v3; // esi
  int v4; // kr04_4
  int v5; // edi
  int v6; // ebp
  int v7; // esi
  _BYTE *v8; // ebp
  int v9; // ebx
  int v10; // ebp
  void *v11; // ecx
  int v12; // esi
  int v13; // [esp-4h] [ebp-30h]
  char s[20]; // [esp+0h] [ebp-2Ch] BYREF
  RGB *triplet; // [esp+14h] [ebp-18h]

  if ( a2 >= (int)&V_CobFiles.fnames[0x17][0x16] )
  {
    V_Window1.buffer = (UBYTE *)result;
    V_Window1.x_max = 0x27F;
    V_Window1.y_max = 0x1DF;
    V_Window1.shadow = 0;
    V_Window1.stencil = 0;
    triplet = (RGB *)(result + 0x4B000);
    VFX_window_read(&V_Window1, 0, 0, 0x27F, 0x1DF);
    dword_100308 = (int)triplet;
    v2 = triplet;
    v3 = 0;
    triplet += 0x100;
    v4 = 0;
    do
    {
      VFX_DAC_read(v3++, &v2[v4++]);
    }
    while ( v3 < 0x100 );
    buf = triplet;
    memset(triplet, 0, (size_t)&loc_493DC + 4);
    dword_100328 = (int)triplet + (_DWORD)&loc_493DC + 4;
    word_100330 = 0;
    triplet = (RGB *)((char *)triplet + (_DWORD)&loc_493DC + 4 + 0x4000);
    dword_10032C = triplet;
    dword_100324 = (int)buf;
    memset(triplet, 0xFF, 0x2008u);
    v5 = dword_100324;
    qmemcpy((void *)dword_100324, "GIF87a", 4u);
    qmemcpy((void *)(v5 + 4), "7a", 2u);
    v6 = dword_100324 + 6;
    *(_WORD *)(dword_100324 + 6) = 0x280;
    *(_WORD *)(v6 + 2) = 0x1E0;
    *(_BYTE *)(v6 + 4) = 0x87;
    *(_BYTE *)(v6 + 5) = 0xFF;
    v7 = 0;
    *(_BYTE *)(v6 + 6) = 0;
    v8 = (_BYTE *)(v6 + 7);
    do
    {
      v9 = 0xFF * *(unsigned __int8 *)(v7 + dword_100308) / 0x3F;
      ++v7;
      *v8++ = v9;
    }
    while ( v7 < 0x300 );
    *v8 = 0x2C;
    *(_WORD *)(v8 + 1) = 0;
    *(_WORD *)(v8 + 3) = 0;
    *(_WORD *)(v8 + 5) = 0x280;
    *(_WORD *)(v8 + 7) = 0x1E0;
    v8[9] = 7;
    dword_100324 = (int)(v8 + 0xA);
    sub_31B08();
    v13 = dword_10033C;
    v10 = dword_100324;
    *(_BYTE *)dword_100324 = 0x3B;
    v11 = buf;
    dword_100324 = v10 + 1;
    sprintf(s, "scr%03d.gif", v13);
    v12 = open(s, 0x262, 0x1C0);
    write(v12, buf, v10 + 1 - (_DWORD)v11);
    result = close(v12);
    dword_100324 = 0;
    dword_10032C = 0;
    dword_100328 = 0;
    buf = 0;
    V_Window1.buffer = 0;
    dword_100308 = 0;
    ++dword_10033C;
  }
  return result;
}
// 100308: using guessed type int dword_100308;
// 100324: using guessed type int dword_100324;
// 100328: using guessed type int dword_100328;
// 100330: using guessed type __int16 word_100330;
// 10033C: using guessed type int dword_10033C;

//----- (00031E60) --------------------------------------------------------
void __fastcall Q_AppendRomanNum_sub_31E60(char *a1, int number)
{
  int v3; // edx
  const char *v4; // esi
  char v5; // al
  char v6; // al
  char *v7; // edi
  char *v8; // kr10_4
  int v9; // kr14_4
  char v10; // al
  char v11; // al
  char *v12; // kr18_4
  int v13; // kr1C_4
  char v14; // al
  char v15; // al
  char *v16; // kr20_4
  int v17; // kr24_4
  char v18; // al
  char v19; // al
  char *v20; // [esp-4h] [ebp-8h]

  if ( number < 0 || !a1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\name.cpp", 0x29);
  }
  v3 = 1000;
  if ( number > 1000 )
  {
    v7 = a1;
    do
    {
      if ( v3 >= 4000 )
      {
        break;
      }
      v4 = "M";
      v20 = v7;
      do
      {
        v5 = *v4;
        v7[strlen(v7)] = *v4;
        if ( !v5 )
        {
          break;
        }
        v6 = v4[1];
        v4 += 2;
        v7[strlen(v7) + 1] = v6;
        v7 += strlen(v7) + 2;
      }
      while ( v6 );
      v7 = v20;
      v3 += 1000;
    }
    while ( v3 < number );
  }
  v8 = V_Romans100[number / 100 % 10];
  v9 = 0;
  do
  {
    v10 = v8[2 * v9];
    a1[strlen(a1)] = v10;
    if ( !v10 )
    {
      break;
    }
    v11 = v8[2 * v9 + 1];
    a1[strlen(a1) + 1] = v11;
    strlen(a1);
    ++v9;
  }
  while ( v11 );
  v12 = V_Romans10[number / 10 % 10];
  v13 = 0;
  do
  {
    v14 = v12[2 * v13];
    a1[strlen(a1)] = v14;
    if ( !v14 )
    {
      break;
    }
    v15 = v12[2 * v13 + 1];
    a1[strlen(a1) + 1] = v15;
    strlen(a1);
    ++v13;
  }
  while ( v15 );
  v16 = V_Romans1[number % 10];
  v17 = 0;
  do
  {
    v18 = v16[2 * v17];
    a1[strlen(a1)] = v18;
    if ( !v18 )
    {
      break;
    }
    v19 = v16[2 * v17 + 1];
    a1[strlen(a1) + 1] = v19;
    strlen(a1);
    ++v17;
  }
  while ( v19 );
}

//----- (00031FB0) --------------------------------------------------------
int __fastcall sub_31FB0(_DWORD *a1, const char *a2, int a3, int a4)
{
  unsigned __int8 v5; // dl
  int v7; // [esp-4h] [ebp-10h]

  v5 = 4 * V_Game.races[V_RaceIndex].Unknown_02 + 0x13;
  if ( a4 == 0xFFFFFFFF )
  {
    v5 = 0xF3;
  }
  v7 = a1[3] - a1[1] - 0x10;
  WinMgr.LargeFont.pane = *(PANE *)a1;
  return sub_2B8A8(&WinMgr.LargeFont, 8, 3, a2, 0, v5, 0xFF, v7);
}

//----- (0003201C) --------------------------------------------------------
void __fastcall __spoils<> Q_WndNW_sub_3201C(P_WndNW a1)
{
  Q_A2Ctor_sub_2C830(&a1->a2);
  a1->a2.procs = (P_Procs)off_95F1C;
  Q_WndNW_sub_3207C(a1);
}
// 95F1C: using guessed type int (*off_95F1C[2])();

//----- (00032038) --------------------------------------------------------
T_TypeA2 *__fastcall sub_32038(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_95ED8);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95F1C;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95F1C: using guessed type int (*off_95F1C[2])();

//----- (0003207C) --------------------------------------------------------
void __fastcall __spoils<> Q_WndNW_sub_3207C(P_WndNW result)
{
  result->b = 0;
  result->c = 0;
  result->d = 0;
  result->f = 0xFFFF;
  result->g = 0xFFFF;
  result->h = 0xFFFF;
}

//----- (000320B8) --------------------------------------------------------
unsigned int __fastcall sub_320B8(int a1, __int16 a2, LONG a3, LONG a4)
{
  LONG v5; // edi
  T_TypeA2 *v6; // eax
  T_TypeA2 *v7; // eax
  T_TypeA2 *v8; // eax
  char Unknown_1E9; // bl
  int v10; // eax
  T_Race *v11; // eax
  __int16 v12; // ax
  __int16 v13; // ax
  int v15; // edx
  char v16[32]; // [esp+0h] [ebp-44h] BYREF
  char v17[16]; // [esp+20h] [ebp-24h] BYREF
  int v18; // [esp+30h] [ebp-14h]
  int v19; // [esp+34h] [ebp-10h]
  int v20; // [esp+38h] [ebp-Ch]
  LONG v21; // [esp+3Ch] [ebp-8h]
  __int16 v22; // [esp+40h] [ebp-4h]
  _BYTE savedregs[12]; // [esp+44h] [ebp+0h]
  void *retaddr; // [esp+50h] [ebp+Ch]

  v22 = a2;
  v5 = a3;
  v21 = a4;
  v18 = V_RaceIndex;
  v20 = (unsigned __int8)byte_968DD;
  if ( (unsigned __int16)a2 < 4u )
  {
    if ( !a2 )
    {
      return sub_2F424((T_TypeA2 *)a1, *(__int16 *)&savedregs[4], v5, v21);
    }
    if ( (unsigned __int16)a2 <= 1u )
    {
      if ( !*(_DWORD *)(a1 + 0xAB) )
      {
        a3 = 0xD;
        a4 = 0;
        v6 = sub_56E18(&WinMgr, "PLAYERDIP", 0xD, 0);
        *(_DWORD *)(a1 + 0xAB) = v6;
        if ( !v6 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x7B);
        }
      }
      *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0xAB) = 0;
      *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8C9) = 0x1D;
      Q_A10_SetProc_sub_2F1C8(*(P_Wnd10LB *)(a1 + 0xAB), sub_31FB0);
      sub_2E9CC(*(P_Wnd10LB *)(a1 + 0xAB), 0);
      *(_BYTE *)(*(_DWORD *)(a1 + 0xAB) + 0xC6) = 0xF2;
      if ( !*(_DWORD *)(a1 + 0xAF) )
      {
        a3 = 0xD;
        a4 = 0;
        v7 = sub_56E18(&WinMgr, "ALIENDIP", 0xD, 0);
        *(_DWORD *)(a1 + 0xAF) = v7;
        if ( !v7 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x88);
        }
      }
      if ( !*(_DWORD *)(a1 + 0xB3) )
      {
        a3 = 0xD;
        a4 = 0;
        v8 = sub_56E18(&WinMgr, "COSMOSWnd", 0xD, 0);
        *(_DWORD *)(a1 + 0xB3) = v8;
        if ( !v8 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x8F);
        }
      }
      sub_32658(a1);
      sub_32E84(a1, 0, a3, a4);
      *(_WORD *)(*(_DWORD *)(a1 + 0xAF) + 0xB1) = 4 * V_Game.races[(unsigned __int8)byte_968DD].Unknown_02 + 0x13;
      memset(byte_101DC4, 0, 0xFu);
      Unknown_1E9 = V_Game.races[v20].Unknown_1E9;
      v10 = v18;
      *(_DWORD *)(a1 + 0xB7) = 0;
      v11 = &V_Game.races[v10];
      if ( Unknown_1E9 == 0xE )
      {
        v13 = sub_44238((int)v11, (unsigned __int8)byte_968DD, v17, *((_WORD *)&dword_96840 + *(__int16 *)(a1 + 0xBF) + 1));
        sub_32A48(a1, (int)v17, v13, 0xFFFFFFFF, 0xFFFFFFFF);
        sub_32C14(a1, 0x1D);
      }
      else
      {
        v19 = Unknown_1E9;
        *(_DWORD *)(a1 + 0xB7) = 0xFFFFFFFF;
        v12 = sub_44A2C(v11, (__int16)retaddr, Unknown_1E9, v16);
        sub_32B44(a1, (int)v16, v12);
        sub_32BDC(a1, v19);
      }
      return sub_2F424((T_TypeA2 *)a1, *(__int16 *)&savedregs[4], v5, v21);
    }
    if ( a2 != 2 )
    {
      return sub_2F424((T_TypeA2 *)a1, *(__int16 *)&savedregs[4], v5, v21);
    }
    sub_2D258((P_TypeA2)a1, *(__int16 *)&savedregs[4]);
    return 0;
  }
  if ( (unsigned __int16)a2 <= 5u )
  {
    if ( a3 >= 0xAE && a3 <= 0x147 && a4 >= 0x145 && a4 <= 0x1D8 )
    {
      Q_StartSample_sub_4FB90(&V_SoundSystem, 0);
      sub_32714(a1, a3, a4);
      return 0xFFFFFFFF;
    }
    return 0;
  }
  if ( (unsigned __int16)a2 < 0xCu )
  {
    return sub_2F424((T_TypeA2 *)a1, *(__int16 *)&savedregs[4], v5, v21);
  }
  if ( (unsigned __int16)a2 <= 0xCu )
  {
    if ( a3 < 0xAE || a3 > 0x147 || a4 < 0x145 || a4 > 0x1D8 )
    {
      return sub_2F424((T_TypeA2 *)a1, *(__int16 *)&savedregs[4], v5, v21);
    }
    sub_56B60(&WinMgr, 5, (int)"tinyrace", 0);
    return 0xFFFFFFFF;
  }
  else
  {
    if ( a2 != 0x1C01 )
    {
      return sub_2F424((T_TypeA2 *)a1, *(__int16 *)&savedregs[4], v5, v21);
    }
    v15 = sub_2ECA4(*(_DWORD *)(a1 + 0xAB), a3);
    sub_32800(a1, v15);
    if ( *(_DWORD *)(a1 + 0xB7) == 0xFFFFFFFF )
    {
      *(_DWORD *)(a1 + 0xB7) = 0;
    }
    return 0xFFFFFFFF;
  }
}
// 96840: using guessed type int dword_96840;
// 968DD: using guessed type char byte_968DD;

//----- (00032414) --------------------------------------------------------
void __fastcall sub_32414(int a1)
{
  T_TypeA2 *Wnd_sub_56DA8; // eax
  __int16 i; // di
  void *v3; // eax
  __int16 v4; // bx
  __int16 v5; // ax
  __int16 v6; // dx
  LONG v7; // esi
  void *ShapeTable_sub_1B084; // eax
  void *v9; // eax
  char *sub_1CEA8; // eax
  LONG v11; // [esp-1Ch] [ebp-50h]
  LONG v12; // [esp-8h] [ebp-3Ch]
  PANE pane; // [esp+0h] [ebp-34h] BYREF
  _DWORD *v14; // [esp+14h] [ebp-20h]
  LONG v15; // [esp+18h] [ebp-1Ch]
  int v16; // [esp+1Ch] [ebp-18h]

  v14 = (_DWORD *)a1;
  pane = V_Type6_stru_D8654.pane;
  if ( *(_WORD *)(a1 + 0xC1) )
  {
    pane.x0 = 0xAE;
    pane.y0 = 0x145;
    pane.x1 = 0x147;
    pane.y1 = 0x1D8;
    VFX_pane_wipe(&pane, 0xF2);
    sub_552CC(&WinMgr, &pane);
    Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&WinMgr, "INTELSCREEN", 0);
    LOWORD(Wnd_sub_56DA8) = word_FFEF2;
    v16 = (int)Wnd_sub_56DA8;
    for ( i = 0; i < *(__int16 *)((char *)v14 + 0xC1); ++i )
    {
      v4 = *((_WORD *)&dword_96840 + i + 1);
      v5 = word_9682E[i];
      v6 = word_96838[i];
      v7 = v5;
      v11 = v5;
      v15 = v6;
      ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEA0[v4]);
      VFX_shape_transform(&V_Type6_stru_D8654.pane, ShapeTable_sub_1B084, 0, v11, v6, V_BigBuffer, 0, 0x8000, 0x8000, 0);
      v12 = v15;
      if ( i == *(_WORD *)((char *)v14 + 0xBF) )
      {
        v9 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v16);
        sub_53EB8(&V_Type6_stru_D8654.pane, v9, 4, v7, v12, v4);
      }
      else
      {
        v3 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v16);
        sub_53EB8(&V_Type6_stru_D8654.pane, v3, 3, v7, v12, v4);
      }
    }
  }
  pane.x0 = 7;
  pane.y0 = 0x145;
  pane.x1 = 0xA5;
  pane.y1 = 0x163;
  VFX_pane_wipe(&pane, 0xF2);
  sub_552CC(&WinMgr, &pane);
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1A);// 26: "Selected System"
  WinMgr.SmallFont.pane = pane;
  sub_2B8A8(&WinMgr.SmallFont, 2, 2, sub_1CEA8, 0, 0xFFFFFFFF, 0xFF, 0);
  WinMgr.LargeFont.pane = pane;
  sub_2B8A8(&WinMgr.LargeFont, 0xA, 0xD, V_Game.pCurStar->name, 0, 0xFFFFFFFF, 0xFF, 0);
  if ( *(_WORD *)((char *)v14 + 0x6B) )
  {
    sub_2D218(v14);
  }
}
// 9682E: using guessed type __int16 word_9682E[5];
// 96838: using guessed type __int16 word_96838[4];
// 96840: using guessed type int dword_96840;
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEA0: using guessed type __int16 word_FFEA0[7];

//----- (00032658) --------------------------------------------------------
void *__fastcall sub_32658(int a1)
{
  void *result; // eax
  WORD i; // dx
  int v4; // ebx

  *(_WORD *)(a1 + 0xC1) = 0;
  *(_WORD *)(a1 + 0xBF) = 0;
  result = (char *)&dword_96840 + 2;
  memset((char *)&dword_96840 + 2, 0xFFFFFFFF, 0xAu);
  for ( i = 0; i < V_Game.racesNum; ++i )
  {
    result = (void *)i;
    if ( i != V_RaceIndex
      && i != (unsigned __int8)byte_968DD
      && V_Game.races[i].Unknown_03 != 0xFFFFFFFF
      && V_Game.races[V_RaceIndex].Unknown_1C0[i] )
    {
      if ( V_Game.races[(unsigned __int8)byte_968DD].Unknown_1C0[i] )
      {
        LOWORD(result) = *(_WORD *)(a1 + 0xC1);
        v4 = (__int16)result;
        result = (char *)result + 1;
        *(_WORD *)(a1 + 0xC1) = (_WORD)result;
        *((_WORD *)&dword_96840 + v4 + 1) = i;
      }
    }
  }
  return result;
}
// 96840: using guessed type int dword_96840;
// 968DD: using guessed type char byte_968DD;

//----- (00032714) --------------------------------------------------------
int __fastcall sub_32714(int a1, int a2, __int16 a3)
{
  __int16 v5; // dx
  int result; // eax
  __int16 v7; // cx
  __int16 v8; // bx
  int v9; // edx
  __int16 v10; // ax
  char v11[16]; // [esp+0h] [ebp-20h] BYREF
  int v12; // [esp+10h] [ebp-10h]

  v12 = a2;
  v5 = *(_WORD *)(a1 + 0xC1);
  result = 0;
  if ( v5 > 0 )
  {
    do
    {
      v7 = v12 - word_9682E[(__int16)result];
      v8 = a3 - word_96838[(__int16)result];
      if ( v7 < 0x16 && v7 > (int)0xFFFFFFEA && v8 < 0x16 && v8 > (int)0xFFFFFFEA )
      {
        break;
      }
      ++result;
    }
    while ( (__int16)result < *(__int16 *)(a1 + 0xC1) );
  }
  if ( (__int16)result < *(__int16 *)(a1 + 0xC1) && (_WORD)result != *(_WORD *)(a1 + 0xBF) )
  {
    v9 = *(_DWORD *)(a1 + 0xB7);
    *(_WORD *)(a1 + 0xBF) = result;
    if ( !v9 )
    {
      v10 = sub_44238(
              (int)&V_Game.races[V_RaceIndex],
              (unsigned __int8)byte_968DD,
              v11,
              *((_WORD *)&dword_96840 + *(__int16 *)(a1 + 0xBF) + 1));
      sub_32A48(a1, (int)v11, v10, 0, 0xFFFFFFFF);
    }
    return (*(int (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
  }
  return result;
}
// 9682E: using guessed type __int16 word_9682E[5];
// 96838: using guessed type __int16 word_96838[4];
// 96840: using guessed type int dword_96840;
// 968DD: using guessed type char byte_968DD;

//----- (00032800) --------------------------------------------------------
int __fastcall sub_32800(int a1, int a2)
{
  int v3; // ebx
  T_Race *v4; // edi
  __int16 v6; // ax
  char v7; // bl
  char v8; // cl
  __int16 v9; // ax
  char v10[16]; // [esp+0h] [ebp-30h] BYREF
  char v11[16]; // [esp+10h] [ebp-20h] BYREF
  int pCurStar; // [esp+20h] [ebp-10h]
  int v13; // [esp+24h] [ebp-Ch]
  int v14; // [esp+28h] [ebp-8h]
  T_Race *v15; // [esp+2Ch] [ebp-4h]

  v14 = V_RaceIndex;
  v3 = (unsigned __int8)byte_968DD;
  v15 = &V_Game.races[V_RaceIndex];
  v4 = &V_Game.races[v3];
  if ( *(_DWORD *)(a1 + 0xB7) != 0xFFFFFFFF )
  {
    v7 = a2;
    pCurStar = 0;
    if ( (_BYTE)a2 == 0xE )
    {
      return sub_56B60(&WinMgr, 3, 0, 0);
    }
    byte_101DC4[a2] = 1;
    if ( (unsigned __int8)a2 < 9u )
    {
      if ( (_BYTE)a2 != 7 )
      {
        goto LABEL_14;
      }
    }
    else if ( (unsigned __int8)a2 > 0xBu )
    {
      if ( (_BYTE)a2 == 0xC )
      {
        pCurStar = (int)V_Game.pCurStar;
      }
      goto LABEL_14;
    }
    pCurStar = *((__int16 *)&dword_96840 + *(__int16 *)(a1 + 0xBF) + 1);
LABEL_14:
    v13 = (char)a2;
    v8 = sub_44BCC((int)v4, (__int16 *)V_RaceIndex, a2, pCurStar, 0);
    sub_32C14(a1, v8);
    sub_450B0(&v15->index, (unsigned __int8)byte_968DD, v7, v8, pCurStar, 0);
    sub_56D30(&WinMgr, *(_DWORD *)(*(_DWORD *)(a1 + 0xB3) + 0x41), 0xD, 0, 0);
    v9 = sub_44238((int)v15, (unsigned __int8)byte_968DD, v11, *((_WORD *)&dword_96840 + *(__int16 *)(a1 + 0xBF) + 1));
    return sub_32A48(a1, (int)v11, v9, 0xFFFFFFFF, 0xFFFFFFFF);
  }
  if ( (_BYTE)a2 == 1 )
  {
    V_Game.pCurStar = (P_Star)V_Game.races[(unsigned __int8)byte_968DD].Unknown_1EA;
    return sub_56B60(&WinMgr, 1, 0x10, 0);
  }
  else
  {
    sub_450B0(&V_Game.races[v3].index, v14, v4->Unknown_1E9, a2, v4->Unknown_1EA, 0);
    sub_56D30(&WinMgr, *(_DWORD *)(*(_DWORD *)(a1 + 0xB3) + 0x41), 0xD, 0, 0);
    v4->Unknown_1E9 = 0xE;
    v6 = sub_44238((int)v15, (unsigned __int8)byte_968DD, v10, *((_WORD *)&dword_96840 + *(__int16 *)(a1 + 0xBF) + 1));
    sub_32A48(a1, (int)v10, v6, 0xFFFFFFFF, 0xFFFFFFFF);
    return sub_32BDC(a1, 0xE);
  }
}
// 96840: using guessed type int dword_96840;
// 968DD: using guessed type char byte_968DD;

//----- (00032A1C) --------------------------------------------------------
__int64 __fastcall sub_32A1C(int a1)
{
  if ( !*(_DWORD *)(a1 + 0xB7) )
  {
    sub_32A48(a1, 0, 0, 0, 0);
  }
  return (unsigned int)(*(int (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
}

//----- (00032A48) --------------------------------------------------------
__int64 __fastcall sub_32A48(int a1, int a2, __int16 a3, int a4, int a5)
{
  T_Wnd10LB *v6; // eax
  __int16 v7; // si
  __int16 Unknown_8CD; // dx
  int v9; // edx
  char *v10; // eax
  unsigned __int16 v11; // ax
  int v13; // [esp+0h] [ebp-18h]
  unsigned __int16 v14; // [esp+8h] [ebp-10h]

  word_103F94 = 0;
  if ( a5 )
  {
    qmemcpy(byte_100340, (const void *)a2, 0xCu);
    qmemcpy(&byte_100340[0xC], (const void *)(a2 + 0xC), 3u);
    word_100350 = a3;
  }
  v6 = *(T_Wnd10LB **)(a1 + 0xAB);
  v7 = 0;
  Unknown_8CD = v6->Unknown_8CD;
  sub_2ED4C(v6);
  v14 = Unknown_8CD;
  if ( word_100350 > 0 )
  {
    do
    {
      v9 = byte_100340[v7];
      if ( !byte_101DC4[v9] )
      {
        v10 = sub_32C48(a1, v9, 0xFFFFFFFF, 0xFFFFFFFF);
        v13 = *(_DWORD *)(a1 + 0xAB);
        v11 = sub_2EA8C(v13, v10, 0xFFFFFFFF, 0);
        sub_2EC50(*(_DWORD *)(a1 + 0xAB), v11, byte_100340[v7]);
      }
      ++v7;
    }
    while ( v7 < word_100350 );
  }
  if ( !a4 )
  {
    sub_2ECDC(*(_DWORD *)(a1 + 0xAB), v14);
  }
  return (unsigned int)(*(int (__cdecl **)(int))(*(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0xA7) + 0xC))(v13);
}
// 32B38: variable 'v13' is possibly undefined
// 100350: using guessed type __int16 word_100350;
// 103F94: using guessed type __int16 word_103F94;

//----- (00032B44) --------------------------------------------------------
__int64 __fastcall sub_32B44(int a1, int a2, __int16 a3)
{
  T_Wnd10LB *v4; // eax
  int v5; // edi
  char *v6; // eax
  unsigned __int16 v7; // ax
  char *v9; // [esp+0h] [ebp-1Ch]

  v4 = *(T_Wnd10LB **)(a1 + 0xAB);
  v5 = 0;
  word_103F94 = 0;
  sub_2ED4C(v4);
  if ( a3 > 0 )
  {
    do
    {
      v9 = (char *)((__int16)v5 + a2);
      v6 = sub_32C48(a1, *v9, 0xFFFFFFFF, 0);
      v7 = sub_2EA8C(*(_DWORD *)(a1 + 0xAB), v6, 0xFFFFFFFF, 0);
      ++v5;
      sub_2EC50(*(_DWORD *)(a1 + 0xAB), v7, *v9);
    }
    while ( (__int16)v5 < a3 );
  }
  return (unsigned int)(*(int (**)(void))(*(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0xA7) + 0xC))();
}
// 103F94: using guessed type __int16 word_103F94;

//----- (00032BDC) --------------------------------------------------------
__int64 __fastcall sub_32BDC(int a1, char a2)
{
  *(_DWORD *)(*(_DWORD *)(a1 + 0xAF) + 0xAB) = sub_32C48(a1, a2, 0, 0xFFFFFFFF);
  return (unsigned int)(*(int (**)(void))(*(_DWORD *)(*(_DWORD *)(a1 + 0xAF) + 0xA7) + 0xC))();
}

//----- (00032C14) --------------------------------------------------------
__int64 __fastcall sub_32C14(int a1, char a2)
{
  *(_DWORD *)(*(_DWORD *)(a1 + 0xAF) + 0xAB) = sub_32C48(a1, a2, 0, 0);
  return (unsigned int)(*(int (**)(void))(*(_DWORD *)(*(_DWORD *)(a1 + 0xAF) + 0xA7) + 0xC))();
}

//----- (00032C48) --------------------------------------------------------
char *__fastcall sub_32C48(int a1, char a2, int a3, int a4)
{
  char *v5; // ebx
  char *v6; // ebx
  char *v7; // edx
  char *name; // esi
  char v9; // al
  char *v10; // edi
  char v11; // al
  char v12; // al
  char *v15; // [esp+4h] [ebp-18h]

  if ( word_103F94 >= 0xF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x27B);
  }
  if ( a3 )
  {
    v15 = (char *)&unk_103454 + 0xB4 * word_103F94 + 0xB4;
  }
  else
  {
    v15 = (char *)&unk_103454;
  }
  if ( a4 )
  {
    if ( a3 )
    {
      v5 = (char *)&unk_100744 + 0x80 * a2;
    }
    else
    {
      v5 = (char *)&unk_101DD4 + 0x80 * a2;
    }
  }
  else
  {
    if ( a3 )
    {
      v6 = (char *)&unk_100EC4;
    }
    else
    {
      v6 = (char *)&unk_102554;
    }
    v5 = &v6[0x80 * a2];
  }
  v7 = v15;
  while ( *v5 )
  {
    name = 0;
    if ( *v5 == 0x25 )
    {
      v9 = v5[1];
      if ( (unsigned __int8)v9 < 0x73u )
      {
        if ( v9 == 0x6D )
        {
          if ( a3 )
          {
            goto LABEL_16;
          }
LABEL_18:
          name = V_SpecNames[V_Game.races[(unsigned __int8)byte_968DD].Unknown_01];
        }
      }
      else if ( (unsigned __int8)v9 <= 0x73u )
      {
        if ( a3 )
        {
          name = V_Game.pCurStar->name;
        }
        else
        {
          name = (char *)(V_Game.races[(unsigned __int8)byte_968DD].Unknown_1EA + 0x1C);
        }
      }
      else
      {
        if ( (unsigned __int8)v9 <= 0x74u )
        {
          if ( a3 == 0xFFFFFFFF && a4 == 0xFFFFFFFF )
          {
            name = V_SpecNames[V_Game.races[*((__int16 *)&dword_96840 + *(__int16 *)(a1 + 0xBF) + 1)].Unknown_01];
          }
          else
          {
            name = V_SpecNames[V_Game.races[V_Game.races[(unsigned __int8)byte_968DD].Unknown_1EA].Unknown_01];
          }
          goto LABEL_32;
        }
        if ( v9 == 0x79 )
        {
          if ( !a3 )
          {
LABEL_16:
            name = V_SpecNames[V_Game.races[V_RaceIndex].Unknown_01];
            goto LABEL_32;
          }
          goto LABEL_18;
        }
      }
    }
LABEL_32:
    if ( name )
    {
      v10 = v7;
      do
      {
        v11 = *name;
        *v10 = *name;
        if ( !v11 )
        {
          break;
        }
        v12 = name[1];
        name += 2;
        v10[1] = v12;
        v10 += 2;
      }
      while ( v12 );
      ++v5;
      v7 += strlen(v7);
    }
    else
    {
      *v7++ = *v5;
    }
    ++v5;
  }
  *v7 = 0;
  if ( a3 )
  {
    ++word_103F94;
  }
  return v15;
}
// 96840: using guessed type int dword_96840;
// 968DD: using guessed type char byte_968DD;
// 103F94: using guessed type __int16 word_103F94;

//----- (00032E84) --------------------------------------------------------
int __fastcall sub_32E84(int a1, int a2, int a3, int a4)
{
  int v5; // kr04_4
  int v6; // kr0C_4
  char v7; // al
  char v8; // al
  FILE *v9; // eax
  FILE *v10; // esi
  int result; // eax
  FILE *v12; // eax
  FILE *v13; // esi
  char s[16]; // [esp+0h] [ebp-34h] BYREF
  char v15[36]; // [esp+10h] [ebp-24h] BYREF

  if ( (unsigned __int8)byte_968DD >= 0x15u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x2D6);
  }
  if ( V_RaceIndex >= 0x15u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x2D7);
  }
  sprintf(s, "RACE%02d.DIP", V_Game.races[(unsigned __int8)byte_968DD].Unknown_01);
  v5 = 0;
  v6 = 0;
  do
  {
    v7 = aPlayerDip[2 * v5];
    v15[2 * v6] = v7;
    if ( !v7 )
    {
      break;
    }
    v8 = aPlayerDip[2 * v5 + 1];
    v15[2 * v6 + 1] = v8;
    ++v5;
    ++v6;
  }
  while ( v8 );
  if ( *(_WORD *)(a1 + 0xBB) != (unsigned __int8)byte_968DD )
  {
    v9 = Q_OpenFile_sub_1BB10(s, 0);
    v10 = v9;
    if ( !v9 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x2E4);
    }
    sub_32FD8(a1, v9, 0);
    fclose(v10);
    *(_WORD *)(a1 + 0xBB) = (unsigned __int8)byte_968DD;
  }
  result = *(__int16 *)(a1 + 0xBD);
  if ( result != V_RaceIndex )
  {
    v12 = Q_OpenFile_sub_1BB10(v15, 0);
    v13 = v12;
    if ( !v12 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x2EF);
    }
    sub_32FD8(a1, v12, 0xFFFFFFFF);
    fclose(v13);
    result = V_RaceIndex;
    *(_WORD *)(a1 + 0xBD) = V_RaceIndex;
  }
  return result;
}
// 32E84: could not find valid save-restore pair for edi
// 968DD: using guessed type char byte_968DD;
// 32E84: using guessed type char var_24[36];

//----- (00032FD8) --------------------------------------------------------
int __fastcall sub_32FD8(int a1, FILE *a2, int a3)
{
  __int16 v3; // si
  char *v4; // eax
  __int16 i; // si
  int result; // eax
  char *v7; // eax
  char v8[220]; // [esp+0h] [ebp-DCh] BYREF

  while ( strncmp(v8, "ACTIONS", 7u) )
  {
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(a2, v8);
  }
  Q_HELPWIN_CPP_FgetsLine_sub_2FE58(a2, v8);
  v3 = 0;
  while ( strncmp(v8, "RESPONSES", 9u) )
  {
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(a2, v8);
    if ( a3 )
    {
      v4 = (char *)&unk_100744 + 0x80 * v3;
    }
    else
    {
      v4 = (char *)&unk_101DD4 + 0x80 * v3;
    }
    ++v3;
    strncpy(v4, v8, 0x7Fu);
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(a2, v8);
  }
  Q_HELPWIN_CPP_FgetsLine_sub_2FE58(a2, v8);
  for ( i = 0; ; ++i )
  {
    result = strncmp(v8, "END DIPLO", 9u);
    if ( !result )
    {
      break;
    }
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(a2, v8);
    if ( a3 )
    {
      v7 = (char *)&unk_100EC4 + 0x80 * i;
    }
    else
    {
      v7 = (char *)&unk_102554 + 0x80 * i;
    }
    strncpy(v7, v8, 0x7Fu);
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(a2, v8);
  }
  return result;
}

//----- (000330DC) --------------------------------------------------------
void __fastcall sub_330DC(T_Type5 *a1, unsigned __int8 *a2)
{
  T_TypeA2 *Wnd_sub_56DA8; // eax
  int v4; // esi
  const char *v5; // ecx
  void *ShapeTable_sub_1B084; // eax
  void *v7; // eax
  char *sub_1CEA8; // eax
  __int16 v9; // di
  int v10; // kr04_4
  LONG v11; // ecx
  void *v12; // eax
  __int16 v13; // edx^2
  char *v14; // eax
  __int16 v15; // di
  int v16; // kr0C_4
  void *v17; // eax
  int TechsNum_sub_40664; // eax
  char *v19; // eax
  __int16 v20; // di
  int v21; // kr14_4
  LONG v22; // ecx
  void *v23; // eax
  LONG v24; // esi
  __int16 v25; // di
  LONG v26; // ebx
  void *v27; // eax
  UBYTE v28; // cl
  LONG v29; // [esp-8h] [ebp-60h]
  LONG v30; // [esp-8h] [ebp-60h]
  LONG v31; // [esp-8h] [ebp-60h]
  __int16 v32; // [esp-4h] [ebp-5Ch]
  __int16 v33; // [esp-4h] [ebp-5Ch]
  __int16 v34; // [esp-4h] [ebp-5Ch]
  int v35[2]; // [esp+0h] [ebp-58h] BYREF
  int v36; // [esp+8h] [ebp-50h]
  int v37; // [esp+Ch] [ebp-4Ch]
  int v38; // [esp+10h] [ebp-48h]
  unsigned __int8 *v39; // [esp+14h] [ebp-44h]
  int PlanetsNum_sub_402E0; // [esp+18h] [ebp-40h]
  T_Race *v41; // [esp+1Ch] [ebp-3Ch]
  int v42; // [esp+20h] [ebp-38h]
  P_Race v43; // [esp+24h] [ebp-34h]
  LONG v44; // [esp+28h] [ebp-30h]
  int v45; // [esp+2Ch] [ebp-2Ch]
  LONG v46; // [esp+30h] [ebp-28h]
  LONG v47; // [esp+34h] [ebp-24h]
  LONG v48; // [esp+38h] [ebp-20h]
  LONG hotY; // [esp+3Ch] [ebp-1Ch]
  LONG v50; // [esp+40h] [ebp-18h]
  LONG v51; // [esp+44h] [ebp-14h]
  int v52; // [esp+48h] [ebp-10h]

  v39 = a2;
  Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&WinMgr, "INTELSCREEN", 0);
  LOWORD(Wnd_sub_56DA8) = word_FFEF2;
  v52 = (int)Wnd_sub_56DA8;
  v43 = (P_Race)a2;
  v4 = *a2;
  v45 = *a2;
  v38 = 4 * V_Game.races[v4].Unknown_02 + 0x13;
  v35[1] = (__int16)v45;
  Q_WINMGR_CPP_sub_53E38((PANE *)a1, 3, 3, v45);
  v5 = V_SpecNames[V_Game.races[v4].Unknown_01];
  v37 = (__int16)v38;
  WinMgr.LargeFont.pane = (PANE)*a1;
  sub_2B8A8(&WinMgr.LargeFont, 0x14, 5, v5, 0, v38, 0xFF, 0);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEA0[v45]);
  VFX_shape_transform((PANE *)a1, ShapeTable_sub_1B084, 0, 0x96, 0x1E, V_BigBuffer, 0, 0x8000, 0x8000, 0);
  v7 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v52);
  v48 = 0xC8;
  sub_53EB8((PANE *)a1, v7, 3, 0x96, 0x1E, v45);
  v35[0] = 0;
  Q_Race_GetShipsNum_sub_40224((P_Race)a2, 0, v35);
  v46 = 0x14;
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x14);// 20: "Fleet"
  WinMgr.SmallFont.pane = (PANE)*a1;
  v9 = 0;
  sub_2B8A8(&WinMgr.SmallFont, 0xC8, 5, sub_1CEA8, 0, v37, 0xFF, 0);
  v10 = 0;
  while ( v9 < v35[0] )
  {
    v11 = v48;
    v32 = v45;
    v29 = v46;
    v12 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF2);
    sub_53EB8((PANE *)a1, v12, 5, v11, v29, v32);
    ++v10;
    if ( v9 % 9 == 8 )
    {
      v48 = 0xC8;
      v46 += 8;
    }
    ++v9;
  }
  v13 = v38;
  PlanetsNum_sub_402E0 = Q_Race_GetPlanetsNum_sub_402E0(v43);
  v51 = 0x118;
  v44 = 0x14;
  v14 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x15);      // 21: "Colonies"
  WinMgr.SmallFont.pane = (PANE)*a1;
  v15 = 0;
  sub_2B8A8(&WinMgr.SmallFont, 0x118, 5, v14, 0, v13, 0xFF, 0);
  v16 = 0;
  while ( v15 < PlanetsNum_sub_402E0 )
  {
    v33 = v45;
    v30 = v44;
    v17 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF2);
    sub_53EB8((PANE *)a1, v17, 6, v51, v30, v33);
    ++v16;
    if ( v15 % 9 == 8 )
    {
      v51 = 0x118;
      v44 += 8;
    }
    ++v15;
  }
  TechsNum_sub_40664 = Q_Race_GetTechsNum_sub_40664(v43);
  v50 = 0x168;
  v42 = TechsNum_sub_40664 >> 2;
  v47 = 0x14;
  v19 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x16);      // 22: "Discoveries"
  WinMgr.SmallFont.pane = (PANE)*a1;
  v20 = 0;
  sub_2B8A8(&WinMgr.SmallFont, 0x168, 5, v19, 0, v38, 0xFF, 0);
  v21 = 0;
  while ( v20 < v42 )
  {
    v22 = v50;
    v34 = v45;
    v31 = v47;
    v23 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF2);
    sub_53EB8((PANE *)a1, v23, 7, v22, v31, v34);
    ++v21;
    if ( v20 % 9 == 8 )
    {
      v50 = 0x168;
      v47 += 8;
    }
    ++v20;
  }
  v24 = 0x1CC;
  v25 = 0;
  v41 = &V_Game.races[V_RaceIndex];
  for ( hotY = 5; v25 < V_Game.racesNum; ++v25 )
  {
    if ( v25 != v45 && v43->Unknown_1C0[v25] && !V_Game.races[v25].Unknown_03 && (v41->Unknown_1C0[v25] || v25 == V_RaceIndex) )
    {
      v36 = v25;
      Q_WINMGR_CPP_sub_53E38((PANE *)a1, v24, hotY, v25);
      v28 = v43->Unknown_1C0[v36];
      v26 = 0xFFFFFFFF;
      if ( v28 == 3 )
      {
        v26 = 9;
      }
      else if ( v28 == 2 )
      {
        v26 = 8;
      }
      if ( v26 != 0xFFFFFFFF )
      {
        v27 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF2);
        VFX_shape_draw((PANE *)a1, v27, v26, v24, hotY);
      }
      v24 += 0x39;
      if ( v24 > 0x258 )
      {
        v24 = 0x1CC;
        hotY += 0x1B;
      }
    }
  }
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEA0: using guessed type __int16 word_FFEA0[7];

//----- (00033598) --------------------------------------------------------
void __fastcall __spoils<> Q_WndIW_sub_33598(P_WndIW a1)
{
  Q_A2Ctor_sub_2C830(&a1->a);
  a1->a.procs = (P_Procs)off_95F04;
  Q_WndIW_sub_335F8(a1);
}
// 95F04: using guessed type int (*off_95F04[5])();

//----- (000335B4) --------------------------------------------------------
T_TypeA2 *__fastcall sub_335B4(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_95EC4);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95F04;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95F04: using guessed type int (*off_95F04[5])();

//----- (000335F8) --------------------------------------------------------
void __fastcall __spoils<> Q_WndIW_sub_335F8(P_WndIW result)
{
  result->Unknown = 0;
}

//----- (00033604) --------------------------------------------------------
unsigned int __fastcall sub_33604(int a1, __int16 a2, LONG a3, LONG a4)
{
  T_TypeA2 *Wnd_sub_56DA8; // eax

  if ( a2 != 1 )
  {
    return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
  }
  if ( !*(_DWORD *)(a1 + 0xAB) )
  {
    Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&WinMgr, "INTELLIST", 0);
    *(_DWORD *)(a1 + 0xAB) = Wnd_sub_56DA8;
    LOWORD(Wnd_sub_56DA8[0xD].a1.e) = 0x3C;
    Q_A10_SetProc_sub_2F1C8(*(P_Wnd10LB *)(a1 + 0xAB), sub_330DC);
  }
  return sub_2F424((T_TypeA2 *)a1, 1, a3, a4);
}

//----- (00033674) --------------------------------------------------------
void __fastcall sub_33674(int a1)
{
  PANE *v1; // esi
  char *sub_1CEA8; // eax
  int v3; // esi
  int v4; // kr04_4
  int v5; // kr0C_4
  unsigned __int16 v6; // ax
  __int16 v7; // [esp-Ch] [ebp-60h]
  char *v8; // [esp-4h] [ebp-58h]
  char s[52]; // [esp+0h] [ebp-54h] BYREF
  _DWORD *v10; // [esp+34h] [ebp-20h]
  int v11; // [esp+38h] [ebp-1Ch] BYREF
  int PlanetsNum_sub_402E0; // [esp+3Ch] [ebp-18h]

  v10 = (_DWORD *)a1;
  v1 = (PANE *)(a1 + 4);
  sub_552CC(&WinMgr, (PANE *)(a1 + 4));
  Q_WINMGR_CPP_sub_53E38(v1, 3, 3, V_RaceIndex);
  v8 = V_SpecNames[V_Game.races[V_RaceIndex].Unknown_01];
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1B);// 27: "%s Intelligence"
  sprintf(s, sub_1CEA8, v8);
  v7 = 4 * V_Game.races[V_RaceIndex].Unknown_02 + 0x13;
  WinMgr.LargeFont.pane = *v1;
  sub_2B8A8(&WinMgr.LargeFont, 0, 9, s, 2, v7, 0xFF, 0);
  v3 = 0;
  sub_2ED4C(*(P_Wnd10LB *)((char *)v10 + 0xAB));
  v4 = 0;
  v5 = 0;
  while ( v3 < V_Game.racesNum )
  {
    if ( v3 == V_RaceIndex || V_Game.races[V_RaceIndex].Unknown_1C0[v3] && !V_Game.races[v3].Unknown_03 )
    {
      v11 = 0;
      Q_Race_GetShipsNum_sub_40224(&V_Game.races[v4], 0, &v11);
      PlanetsNum_sub_402E0 = Q_Race_GetPlanetsNum_sub_402E0(&V_Game.races[v4]);
      v6 = sub_2EA8C(*(_DWORD *)((char *)v10 + 0xAB), (const char *)&V_Game.races[v5], 0xFFFFFFFF, 0);
      sub_2EC50(*(_DWORD *)((char *)v10 + 0xAB), v6, -(PlanetsNum_sub_402E0 + v11));
    }
    ++v3;
    ++v4;
    ++v5;
  }
  sub_2F1D8(*(_DWORD *)((char *)v10 + 0xAB), (int)sub_10A14);
  sub_2F1E0(*(_DWORD *)((char *)v10 + 0xAB));
  sub_2D218(v10);
}

//----- (00033830) --------------------------------------------------------
void __fastcall __spoils<> Q_WndAW_sub_33830(P_WndAW a1)
{
  Q_A2_sub_2FC50(&a1->a2);
  a1->a2.procs = (P_Procs)off_95EEC;
}
// 95EEC: using guessed type int (*off_95EEC[2])();

//----- (00033840) --------------------------------------------------------
T_TypeA2 *__fastcall sub_33840(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  T_TypeA2 *v5; // eax
  T_TypeA2 *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_95EB0);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95EEC;
    v5 = sub_2FC68(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95EEC: using guessed type int (*off_95EEC[2])();

//----- (00033884) --------------------------------------------------------
void __fastcall Q_ShowHelpTopicAbil_sub_33884(P_Wnd20HW a1, char *a2, int a3, int a4)
{
  char s[24]; // [esp+0h] [ebp-20h] BYREF

  sprintf(s, "abil%02d", (char)V_Game.races[V_RaceIndex].ability);
  Q_ShowHelpTopic_sub_2FCB0(a1, "help.txt", s);
}

//----- (000338DC) --------------------------------------------------------
unsigned int __fastcall sub_338DC(int a1, __int16 a2, LONG a3, LONG a4)
{
  int v5; // eax
  T_Race *v6; // esi
  int v7; // edx
  int v8; // eax
  char *sub_1CEA8; // eax
  int v10; // kr04_4
  int v11; // kr10_4
  int v12; // kr14_4
  char v13; // al
  char v14; // al
  char *v15; // esi
  int v16; // kr0C_4
  int v17; // kr18_4
  int v18; // kr1C_4
  char v19; // al
  char v20; // al
  int v21; // ebx
  char s[100]; // [esp+0h] [ebp-84h] BYREF
  char helptopic[32]; // [esp+64h] [ebp-20h] BYREF

  v5 = V_RaceIndex;
  v6 = &V_Game.races[v5];
  if ( !a2 )
  {
    return sub_2FD68(a1, a2, a3, a4);
  }
  if ( (unsigned __int16)a2 <= 1u )
  {
    if ( sub_434E4((char *)&V_Game.races[v5], 0) == 0xFFFFFFFF )
    {
      *(_BYTE *)(a1 + 0xCCB) = 2;
    }
    else
    {
      sub_56D30(&WinMgr, *(_DWORD *)(**(_DWORD **)(a1 + 0x67) + 0x41), 2, 0, 0);
      v7 = (unsigned __int16)word_968E8[(char)v6->ability] - *(_DWORD *)v6->z2;
      if ( v7 == 1 )
      {
        v8 = 0x1C;                                     // 28: ""
      }
      else
      {
        v8 = 0x1D;                                     // 29: "s"
      }
      sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v8);
      sprintf(s, *(const char **)(a1 + 0xCD0), v7, sub_1CEA8);
      v10 = 0;
      v11 = *(_DWORD *)(a1 + 0xCD0);
      v12 = 0;
      do
      {
        v13 = s[2 * v10];
        *(_BYTE *)(v11 + 2 * v12) = v13;
        if ( !v13 )
        {
          break;
        }
        v14 = s[2 * v10 + 1];
        *(_BYTE *)(v11 + 2 * v12 + 1) = v14;
        ++v10;
        ++v12;
      }
      while ( v14 );
      v15 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1E);  // 30: "OK"
      v16 = 0;
      v17 = *(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4) + 0x20;
      v18 = 0;
      do
      {
        v19 = v15[2 * v16];
        *(_BYTE *)(v17 + 2 * v18) = v19;
        if ( !v19 )
        {
          break;
        }
        v20 = v15[2 * v16 + 1];
        *(_BYTE *)(v17 + 2 * v18 + 1) = v20;
        ++v16;
        ++v18;
      }
      while ( v20 );
    }
    *(_DWORD *)(a1 + 0x35) = 0xFFFFFFFF;
    v21 = *(_DWORD *)(a1 + 0xA7);
    *(_DWORD *)(a1 + 0x39) = 0xFFFFFFFF;
    (*(void (__fastcall **)(int, _DWORD))(v21 + 0xC))(a1, 0);
    return 0;
  }
  else
  {
    if ( a2 != 0x32 || a3 != 1 )
    {
      return sub_2FD68(a1, a2, a3, a4);
    }
    sub_434E4((char *)&V_Game.races[v5], 1);
    sprintf(helptopic, "abres%02d", (char)v6->ability);
    Q_ShowHelpTopic_sub_2FCB0((P_Wnd20HW)a1, "help.txt", helptopic);
    (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    return 0;
  }
}
// 968E8: using guessed type __int16 word_968E8[21];
// 338DC: using guessed type char s[100];

//----- (00033A68) --------------------------------------------------------
void __fastcall sub_33A68(int a1)
{
  void *ShapeTable_sub_1B084; // eax
  void *v3; // eax
  LONG Unknown_02; // [esp-Ch] [ebp-18h]

  sub_30774(a1);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, V_RaceIndex);
  VFX_shape_draw((PANE *)(a1 + 4), ShapeTable_sub_1B084, 0, 0xFA, 0x41);
  Unknown_02 = V_Game.races[V_RaceIndex].Unknown_02;
  v3 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, 0x21);
  VFX_shape_draw((PANE *)(a1 + 4), v3, Unknown_02, 0xFA, 0x41);
}

//----- (00033AF0) --------------------------------------------------------
UWORD __fastcall Q_PLANET_CPP_sub_33AF0(P_Planet pPlanet, unsigned __int16 size, unsigned __int16 type, int *a4)
{
  int txtLoaded; // ebx
  int i; // eax
  UWORD v7; // bx
  T_PlanetSurface *surface; // ebx
  signed int v9; // ebp
  unsigned int v10; // eax
  int j; // ebx
  int v12; // ecx
  int v13; // kr04_4
  char v14; // al
  int v15; // eax
  unsigned __int8 Unknown_66; // al
  UWORD word18; // bx
  int v18; // eax
  UWORD v19; // ax
  int v21; // [esp+0h] [ebp-10h]
  int v22; // [esp+4h] [ebp-Ch]
  int v23; // [esp+8h] [ebp-8h]

  if ( pPlanet->pUnknown_10 && size != pPlanet->size )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x41);
  }
  txtLoaded = V_PlanetCfg.txtLoaded;
  pPlanet->pUnknown_10 = a4;
  if ( !txtLoaded )
  {
    Q_PLANET_CPP_LoadPlanItemTxt_sub_33D30();
  }
  if ( size >= 5u )
  {
    pPlanet->size = 4;
  }
  else
  {
    pPlanet->size = size;
  }
  pPlanet->word18 = 0;
  for ( i = 0; i < 15; ++i )
  {
    v7 = *(&V_PlanetCfg.room2[pPlanet->size].a0 + i) + pPlanet->word18;
    pPlanet->word18 = v7;
  }
  if ( v7 > 100u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x52);
  }
  pPlanet->word1A = pPlanet->word18 + 10;
  if ( type >= 11u )
  {
    pPlanet->type = 2;
  }
  else
  {
    pPlanet->type = type;
  }
  surface = &V_PlanetCfg.surfaces[pPlanet->type];
  v9 = 0x7FFF * (unsigned int)surface->black / 100;
  v23 = 0x7FFF * (unsigned int)surface->red / 100 + v9;
  v21 = 0x7FFF * (unsigned int)surface->green / 100 + v23;
  v10 = 0x7FFF * (unsigned int)surface->blue / 100;
  j = 0;
  v12 = 0;
  v22 = v10 + v21;
  v13 = 0;
  while ( j < pPlanet->word1A )
  {
    *((_BYTE *)pPlanet->pUnknown_10 + 4 * v13 + 1) = 0xFF;
    *((_WORD *)pPlanet->pUnknown_10 + 2 * v13 + 1) = 0;
    v14 = 1;
    if ( j < pPlanet->word18 )
    {
      v15 = rand();
      if ( v15 >= v9 )
      {
        ++v12;
        if ( v15 >= v23 )
        {
          if ( v15 >= v21 )
          {
            if ( v15 >= v22 )
            {
              v14 = 1;
            }
            else
            {
              v14 = 4;
            }
          }
          else
          {
            v14 = 3;
          }
        }
        else
        {
          v14 = 2;
        }
      }
      else
      {
        v14 = 0;
      }
    }
    ++j;
    *((_BYTE *)pPlanet->pUnknown_10 + 4 * v13++) = v14;
  }
  pPlanet->Unknown_66 = 0;
  Unknown_66 = pPlanet->Unknown_66;
  pPlanet->buildingProgress = Unknown_66;
  pPlanet->z6 = Unknown_66;
  pPlanet->word4C = Unknown_66;
  pPlanet->prosperity = Unknown_66;
  pPlanet->research = Unknown_66;
  pPlanet->industry = Unknown_66;
  pPlanet->word42 = Unknown_66;
  if ( !(rand() % 7) )
  {
    word18 = pPlanet->word18;
    v18 = rand();
    *((_BYTE *)pPlanet->pUnknown_10 + 4 * (v18 % word18)) |= 8u;
    pPlanet->Unknown_66 |= 2u;
  }
  pPlanet->word52 = 0xFFFF;
  pPlanet->buildingPlanetItemIndex = 0xFF;
  v19 = v12 / 3 + 5;
  pPlanet->word55 = v19;
  pPlanet->maximumPopulation = v19;
  pPlanet->raceIndex = 0xFF;
  sub_34E70(pPlanet);
  pPlanet->Unknown_5E = 0;
  return pPlanet->word1A;
}

//----- (00033D30) --------------------------------------------------------
void __fastcall Q_PLANET_CPP_LoadPlanItemTxt_sub_33D30()
{
  FILE *fp; // esi
  MACRO_VFX_BOOL found; // edi
  int planetType; // edi
  int v3; // kr08_4
  int color; // edx
  int v5; // edi
  int v6; // kr10_4
  int v7; // edx
  int v8; // edi
  int v9; // kr18_4
  int v10; // edx
  int v11; // kr20_4
  int v12; // kr28_4
  int l; // edx
  int v14; // eax
  int v15; // ecx
  int n; // edx
  const char *v17; // ebx
  int len; // kr04_4
  char buf[196]; // [esp+0h] [ebp-ECh] BYREF
  int val1; // [esp+C8h] [ebp-24h] BYREF
  unsigned __int16 val2; // [esp+CCh] [ebp-20h] BYREF
  UWORD val3; // [esp+D0h] [ebp-1Ch] BYREF
  UBYTE val4; // [esp+D4h] [ebp-18h] BYREF
  UBYTE val5; // [esp+D8h] [ebp-14h] BYREF
  UWORD val6; // [esp+DCh] [ebp-10h] BYREF
  UBYTE val7; // [esp+E0h] [ebp-Ch] BYREF
  char *name; // [esp+E8h] [ebp-4h]

  fp = Q_OpenFile_sub_1BB10("planitem.txt", 0);
  if ( fp )
  {
    found = FALSE;
    do
    {
      fgets(buf, 195, fp);
      if ( buf[0] == '#' )
      {
        found = TRUE;
      }
    }
    while ( found == FALSE );
    fscanf(fp, "%d", &val1);
    planetType = 0;
    V_PlanItem50 = val1;
    v3 = 0;
    do
    {
      color = 4 * planetType;
      do
      {
        fscanf(fp, "%d", &val1);
        *(&V_PlanetCfg.room2[5].a0 + ++color) = val1;
      }
      while ( color != 4 * v3 + 4 );
      ++planetType;
      ++v3;
    }
    while ( planetType < 11 );
    v5 = 0;
    v6 = 0;
    do
    {
      v7 = 0xF * v5;
      do
      {
        fscanf(fp, "%d", &val1);
        *((_BYTE *)&V_PlanetCfg.txtLoaded + ++v7 + 3) = val1;
      }
      while ( v7 != 0xF * v6 + 0xF );
      ++v5;
      ++v6;
    }
    while ( v5 < 5 );
    v8 = 0;
    v9 = 0;
    do
    {
      v10 = 0xF * v8;
      do
      {
        fscanf(fp, "%d", &val1);
        *(&V_PlanetCfg.room1[5].a0 + ++v10) = val1;
      }
      while ( v10 != 0xF * v9 + 0xF );
      ++v8;
      ++v9;
    }
    while ( v8 < 5 );
    fscanf(fp, "%d %d %d", &val1, &val2, &val3);
    if ( val1 != 39 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0xE1);
    }
    V_PlanetItems.num1 = val2;
    V_PlanetItems.num2 = val3;
    if ( val2 + val3 > 39 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0xE6);
    }
    name = V_PlanetItems.item[0].name;
    v11 = 0;
    v12 = 0;
    do
    {
      v17 = name;
      fscanf(fp, "%s %d %d %d %d %d %d %d", name, &val1, &val2, &val3, &val4, &val5, &val6, &val7);
      l = 0;
      len = strlen(v17) + 1;
      v15 = len - 1;
      v14 = 0x28 * v11;
      if ( len - 1 > 0 )
      {
        do
        {
          if ( V_PlanetItems.item[0].name[v14] == '^' )
          {
            V_PlanetItems.item[0].name[v14] = ' ';
          }
          ++l;
          ++v14;
        }
        while ( l < len - 1 );
      }
      V_PlanetItems.item[v11].ind = val1;
      V_PlanetItems.item[v11].flags = 0;
      V_PlanetItems.item[v11].res = val2;
      V_PlanetItems.item[v11].pros = val3;
      V_PlanetItems.item[v11].mpop = val4;
      V_PlanetItems.item[v11].upop = val5;
      V_PlanetItems.item[v11].cost = val6;
      n = 0;
      V_PlanetItems.item[v11].resReq = val7;
      do
      {
        fscanf(fp, "%d", &val1);
        if ( val1 == 0xFF )
        {
          break;
        }
        LOWORD(v15) = V_PlanetItems.item[v11].flags;
        v15 |= 1 << val1;
        ++n;
        V_PlanetItems.item[v11].flags = v15;
      }
      while ( n < 8 );
      ++v11;
      ++v12;
    }
    while ( v11 != 0x27 );
    fclose(fp);
  }
  V_PlanetCfg.txtLoaded = TRUE;
}
// 9684C: using guessed type int V_PlanItem50;

//----- (0003407C) --------------------------------------------------------
int __fastcall sub_3407C(P_Planet a1)
{
  int v2; // ebp
  int v3; // kr08_4
  _BYTE *pUnknown_10; // eax
  unsigned int v5; // kr00_4
  unsigned __int16 v6; // bx
  int v8; // [esp+4h] [ebp-10h]
  unsigned __int16 v9; // [esp+8h] [ebp-Ch]
  unsigned __int16 v10; // [esp+Ch] [ebp-8h]
  unsigned __int16 v11; // [esp+10h] [ebp-4h]

  v2 = 0;
  v8 = 0;
  v3 = 0;
  while ( a1->word1A > v8 && v2 < 100 )
  {
    pUnknown_10 = a1->pUnknown_10;
    if ( (*pUnknown_10 & 8) == 0 && (*pUnknown_10 || V_Game.races[a1->raceIndex].ability == 2) && *((_BYTE *)a1->pUnknown_10 + 1) == 0xFF )
    {
      v5 = sub_35A00(a1, v8);
      v11 = sub_35968(a1, HIWORD(v5) - 1, (unsigned __int16)v5);
      v9 = sub_35968(a1, HIWORD(v5) + 1, (unsigned __int16)v5);
      v10 = sub_35968(a1, HIWORD(v5), (unsigned __int16)v5 - 1);
      v6 = sub_35968(a1, HIWORD(v5), (unsigned __int16)v5 + 1);
      ++v2;
      if ( (v11 == 0xFFFF || (*((_WORD *)a1->pUnknown_10 + 2 * v11 + 1) & 1) == 0)
        && (v9 == 0xFFFF || (*((_WORD *)a1->pUnknown_10 + 2 * v9 + 1) & 1) == 0)
        && (v10 == 0xFFFF || (*((_WORD *)a1->pUnknown_10 + 2 * v10 + 1) & 1) == 0)
        && (v6 == 0xFFFF || (*((_WORD *)a1->pUnknown_10 + 2 * v6 + 1) & 1) == 0) )
      {
        --v2;
      }
    }
    ++v8;
    ++v3;
  }
  return v2;
}

//----- (0003420C) --------------------------------------------------------
int __fastcall sub_3420C(T_Planet *a1)
{
  int v2; // ebp
  int i; // kr08_4
  int result; // eax
  _BYTE *pUnknown_10; // esi
  int v6; // eax
  unsigned int v7; // kr00_4
  unsigned __int16 v8; // bx
  int v9; // [esp+0h] [ebp-14h]
  unsigned __int16 v10; // [esp+8h] [ebp-Ch]
  unsigned __int16 v11; // [esp+Ch] [ebp-8h]
  unsigned __int16 v12; // [esp+10h] [ebp-4h]

  v2 = 0;
  v9 = 0;
  for ( i = 0; ; ++i )
  {
    result = a1->word1A;
    if ( (unsigned __int16)result <= v9 || v2 >= 0x64 )
    {
      break;
    }
    pUnknown_10 = a1->pUnknown_10;
    v6 = *pUnknown_10 & 8;
    if ( (*pUnknown_10 & 8) == 0 )
    {
      LOBYTE(v6) = *pUnknown_10;
      if ( !v6 && pUnknown_10[1] == 0xFF )
      {
        v7 = sub_35A00(a1, v9);
        v11 = sub_35968(a1, HIWORD(v7) - 1, (unsigned __int16)v7);
        v12 = sub_35968(a1, HIWORD(v7) + 1, (unsigned __int16)v7);
        v10 = sub_35968(a1, HIWORD(v7), (unsigned __int16)v7 - 1);
        v8 = sub_35968(a1, HIWORD(v7), (unsigned __int16)v7 + 1);
        ++v2;
        if ( (v11 == 0xFFFF || (*((_WORD *)a1->pUnknown_10 + 2 * v11 + 1) & 1) == 0)
          && (v12 == 0xFFFF || (*((_WORD *)a1->pUnknown_10 + 2 * v12 + 1) & 1) == 0)
          && (v10 == 0xFFFF || (*((_WORD *)a1->pUnknown_10 + 2 * v10 + 1) & 1) == 0)
          && (v8 == 0xFFFF || (*((_WORD *)a1->pUnknown_10 + 2 * v8 + 1) & 1) == 0) )
        {
          --v2;
        }
      }
    }
    ++v9;
  }
  return result;
}

//----- (00034368) --------------------------------------------------------
unsigned int __fastcall sub_34368(P_Planet a1, unsigned __int8 planetItemIndex, unsigned __int16 a3)
{
  unsigned int v4; // ebp
  unsigned int v5; // edi
  int resReq; // eax
  int v7; // eax
  char *v8; // eax
  char *v9; // eax
  unsigned int v10; // eax
  unsigned __int16 v11; // cx
  unsigned __int16 v12; // bx
  int v14; // [esp+0h] [ebp-20h]
  int v15; // [esp+8h] [ebp-18h]
  unsigned __int16 v16; // [esp+Ch] [ebp-14h]
  unsigned __int16 v17; // [esp+14h] [ebp-Ch]
  unsigned __int16 v18; // [esp+18h] [ebp-8h]
  unsigned __int16 v19; // [esp+1Ch] [ebp-4h]

  v4 = 0xFFFFFFFF;
  v5 = 0xFFFFFFFF;
  if ( a1->raceIndex == 0xFF && planetItemIndex != 5 )
  {
    return 0;
  }
  if ( planetItemIndex < 0x27u )
  {
    v4 = 0;
    resReq = V_PlanetItems.item[planetItemIndex].resReq;
    if ( resReq == 0xFF || V_ResTree.num > resReq && ((1 << a1->raceIndex) & V_ResTree.items[resReq].Unknown_48) != 0 )
    {
      v19 = a1->word42 - a1->word4C;
      if ( a1->buildingPlanetItemIndex != 0xFF )
      {
        v19 += (char)V_PlanetItems.item[a1->buildingPlanetItemIndex].upop;
      }
      if ( v19 >= (char)V_PlanetItems.item[planetItemIndex].upop )
      {
        v4 = 0xFFFFFFFF;
      }
      if ( v4 == 0xFFFFFFFF && planetItemIndex == 0x17 )
      {
        v4 = sub_362E0(a1);
      }
    }
    if ( planetItemIndex == 5 )
    {
      v4 = 0xFFFFFFFF;
    }
  }
  if ( a3 < a1->word1A )
  {
    v5 = 0;
    if ( planetItemIndex < 0x27u && ((V_PlanetItems.item[planetItemIndex].flags & 1) != 0 || V_Game.races[a1->raceIndex].ability == 2) )
    {
      v5 = 0xFFFFFFFF;
    }
    v14 = 4 * a3;
    v7 = *((unsigned __int8 *)a1->pUnknown_10 + v14);
    if ( *((_BYTE *)a1->pUnknown_10 + v14)
      || planetItemIndex == 0xFF
      || (LOBYTE(v7) = planetItemIndex, (V_PlanetItems.item[v7].flags & 2) != 0) )
    {
      v5 = 0xFFFFFFFF;
    }
    if ( planetItemIndex != 0xFF && planetItemIndex <= 0x1Eu && a3 < a1->word18 != planetItemIndex < (int)V_PlanetItems.num1 )
    {
      v5 = 0;
    }
    if ( planetItemIndex != 0xFF && ((*((_BYTE *)a1->pUnknown_10 + 4 * a3) & 8) != 0) != (planetItemIndex == 0x26) )
    {
      v5 = 0;
    }
    if ( planetItemIndex == 0x24 )
    {
      v8 = (char *)a1->pUnknown_10 + 4 * a3;
      if ( *v8 || v8[1] != (char)0xFF )
      {
        v5 = 0;
      }
    }
    if ( planetItemIndex == 0x23 )
    {
      v9 = (char *)a1->pUnknown_10 + 4 * a3;
      if ( (*((_WORD *)v9 + 1) & 1) == 0 || v9[1] == 0x17 || (*((_WORD *)v9 + 1) & 2) != 0 )
      {
        v5 = 0;
      }
    }
    if ( a3 < a1->word18 && (*((_WORD *)a1->pUnknown_10 + 2 * a3 + 1) & 1) == 0 && planetItemIndex != 5 && planetItemIndex != 0x23 )
    {
      v10 = sub_35A00(a1, a3);
      v11 = v10;
      v15 = HIWORD(v10);
      v16 = sub_35968(a1, HIWORD(v10) - 1, (unsigned __int16)v10);
      v18 = sub_35968(a1, v15 + 1, v11);
      v17 = sub_35968(a1, v15, v11 - 1);
      v12 = sub_35968(a1, v15, v11 + 1);
      if ( (v16 == 0xFFFF || (*((_WORD *)a1->pUnknown_10 + 2 * v16 + 1) & 1) == 0)
        && (v18 == 0xFFFF || (*((_WORD *)a1->pUnknown_10 + 2 * v18 + 1) & 1) == 0)
        && (v17 == 0xFFFF || (*((_WORD *)a1->pUnknown_10 + 2 * v17 + 1) & 1) == 0)
        && (v12 == 0xFFFF || (*((_WORD *)a1->pUnknown_10 + 2 * v12 + 1) & 1) == 0) )
      {
        v5 = 0;
      }
    }
  }
  if ( v4 && v5 )
  {
    return 0xFFFFFFFF;
  }
  else
  {
    return 0;
  }
}

//----- (00034774) --------------------------------------------------------
void __fastcall sub_34774(P_Planet a1, unsigned __int8 a2, int a3, int a4)
{
  unsigned __int8 v5; // cl
  int v6; // edx
  unsigned __int8 v7; // bl
  unsigned __int16 v8; // si

  if ( a3 != 0xFFFF && *((_BYTE *)a1->pUnknown_10 + 4 * a3 + 1) == 0xFF )
  {
    if ( a4 == 0xFFFFFFFF )
    {
      v5 = 0;
      v6 = (unsigned __int16)a3;
      v7 = a2;
    }
    else
    {
      v5 = 2;
      v8 = a3;
      v7 = a2;
      v6 = v8;
    }
    sub_34B0C(a1, v6, v7, v5);
  }
}

//----- (000347CC) --------------------------------------------------------
int __fastcall sub_347CC(P_Planet a1, unsigned __int8 planetItemIndex)
{
  UBYTE raceIndex; // cl
  int v4; // ebp
  int Unknown_48; // edx
  int v6; // ecx
  int v7; // edi
  int v8; // kr04_4
  signed int v9; // edi
  int v10; // ecx
  int v11; // kr0C_4
  int v12; // eax
  signed __int8 ind; // bl
  signed __int8 pros; // bl
  signed __int8 res; // bl
  _BYTE v17[180]; // [esp+0h] [ebp-E0h]
  _BYTE *pUnknown_10; // [esp+C8h] [ebp-18h]
  int v19; // [esp+CCh] [ebp-14h]
  int v20; // [esp+D0h] [ebp-10h]
  int v21; // [esp+D4h] [ebp-Ch]
  int v22; // [esp+D8h] [ebp-8h]
  unsigned __int8 v23; // [esp+DCh] [ebp-4h]

  v23 = planetItemIndex;
  v20 = 0xFFFF;
  raceIndex = a1->raceIndex;
  v4 = 0;
  Unknown_48 = V_ResTree.items[V_ResTree.num - 1].Unknown_48;
  v19 = 0;
  if ( ((1 << raceIndex) & Unknown_48) != 0 && Q_Race_GetTechsNum_sub_40664(&V_Game.races[raceIndex]) == V_ResTree.num )
  {
    v19 = 0xFFFFFFFF;
  }
  v6 = 0;
  v7 = 0;
  v22 = 0;
  v8 = 0;
  while ( v6 < a1->word1A && v7 < 0xC8 )
  {
    if ( *((_BYTE *)a1->pUnknown_10 + v22 + 1) == 0xFF )
    {
      if ( sub_34368(a1, v23, v6) )
      {
        ++v4;
        *(_WORD *)&v17[v7] = v6;
        v7 += 2;
      }
    }
    ++v6;
    ++v8;
  }
  if ( v4 )
  {
    v9 = 0xFFFFFFFF;
    v10 = 0;
    v21 = 0xFFFFFFFF;
    if ( v4 > 0 )
    {
      pUnknown_10 = a1->pUnknown_10;
      v11 = 0;
      do
      {
        switch ( pUnknown_10[4 * *(unsigned __int16 *)&v17[2 * v11]] )
        {
          case 2:
            v12 = 0;
            if ( (char)V_PlanetItems.item[v23].ind > 0 )
            {
              ind = V_PlanetItems.item[v23].ind;
              v12 = 3;
              if ( ind < (char)V_PlanetItems.item[v23].res || ind < (char)V_PlanetItems.item[v23].pros )
              {
                v12 = 2;
              }
            }
            break;
          case 3:
            v12 = 0;
            if ( (char)V_PlanetItems.item[v23].pros > 0 )
            {
              pros = V_PlanetItems.item[v23].pros;
              v12 = 3;
              if ( pros < (char)V_PlanetItems.item[v23].ind || pros < (char)V_PlanetItems.item[v23].res )
              {
                v12 = 2;
              }
            }
            break;
          case 4:
            if ( v19 )
            {
              goto LABEL_24;
            }
            v12 = 0;
            if ( (char)V_PlanetItems.item[v23].res > 0 )
            {
              res = V_PlanetItems.item[v23].res;
              v12 = 3;
              if ( res < (char)V_PlanetItems.item[v23].ind || res < (char)V_PlanetItems.item[v23].pros )
              {
                v12 = 2;
              }
            }
            break;
          default:
LABEL_24:
            v12 = 1;
            break;
        }
        if ( v12 > v9 )
        {
          v21 = v10;
          v9 = v12;
        }
        ++v10;
        ++v11;
      }
      while ( v10 < v4 );
    }
    if ( v21 >= 0 )
    {
      return *(unsigned __int16 *)&v17[2 * v21];
    }
  }
  return v20;
}

//----- (00034A44) --------------------------------------------------------
UWORD __fastcall sub_34A44(T_Planet *a1, _DWORD *a2, _DWORD *a3, _DWORD *a4)
{
  int i; // kr04_4
  UWORD result; // ax
  int v7; // [esp+0h] [ebp-14h]

  *a2 = 0;
  *a3 = 0;
  v7 = 0;
  *a4 = 0;
  for ( i = 0; ; ++i )
  {
    result = a1->word1A;
    if ( result <= v7 )
    {
      break;
    }
    if ( *((_BYTE *)a1->pUnknown_10 + 1) == 0xFF && sub_34368(a1, 0, v7) )
    {
      switch ( *(_BYTE *)a1->pUnknown_10 )
      {
        case 2:
          ++*a3;
          break;
        case 3:
          goto LABEL_3;
        case 4:
          ++*a2;
          break;
        default:
          ++*a2;
          ++*a3;
LABEL_3:
          ++*a4;
          break;
      }
    }
    ++v7;
  }
  return result;
}

//----- (00034AE4) --------------------------------------------------------
int __fastcall sub_34AE4(P_Planet a1, unsigned __int8 planetItemIndex, int a3)
{
  int v5; // ebx

  v5 = sub_347CC(a1, planetItemIndex);
  sub_34774(a1, planetItemIndex, v5, a3);
  return v5;
}

//----- (00034B0C) --------------------------------------------------------
unsigned int __fastcall sub_34B0C(P_Planet pPlanet, int edx0, UBYTE bl0, unsigned __int8 cl0)
{
  unsigned int v5; // ebp
  _BYTE *pUnknown_10; // edi
  unsigned __int8 v8; // dl
  unsigned __int8 v9; // al
  int word52; // edx
  T_Ship *Ship_sub_35A70; // eax
  char *v12; // eax
  UBYTE v13; // dl
  int v14; // eax
  int v15; // edx
  int a3; // [esp+0h] [ebp-24h] BYREF
  int a4; // [esp+4h] [ebp-20h] BYREF
  int a5; // [esp+8h] [ebp-1Ch] BYREF
  int v19; // [esp+Ch] [ebp-18h] BYREF
  int v20; // [esp+10h] [ebp-14h] BYREF
  int a2; // [esp+14h] [ebp-10h] BYREF
  int v22; // [esp+18h] [ebp-Ch]
  int v23; // [esp+1Ch] [ebp-8h]
  UBYTE v24; // [esp+20h] [ebp-4h]

  v23 = edx0;
  v24 = bl0;
  v5 = 0;
  if ( (unsigned __int16)edx0 == 0xFFFF && ((V_PlanetItems.item[bl0].flags & 2) == 0 || cl0 != 2) )
  {
    goto LABEL_42;
  }
  v22 = ((unsigned __int16)v23 < pPlanet->word18) - 1;
  pUnknown_10 = pPlanet->pUnknown_10;
  if ( (unsigned __int16)v23 != 0xFFFF )
  {
    pUnknown_10 += 4 * (unsigned __int16)v23;
  }
  if ( !cl0 )
  {
    if ( pUnknown_10[1] == 0xFF && v24 < 0x27u )
    {
      v8 = v24;
      if ( pPlanet->word42 - (unsigned __int16)pPlanet->word4C >= (char)V_PlanetItems.item[v24].upop
        && v24 >= (int)V_PlanetItems.num1 == v22 )
      {
        pUnknown_10[1] = v24;
        *((_WORD *)pUnknown_10 + 1) = 1;
        v5 = 0xFFFFFFFF;
        if ( (V_PlanetItems.item[v8].flags & 4) != 0 )
        {
          sub_366C8(pPlanet, v8, &a3, &a4, &a5);
          if ( a5 )
          {
            pUnknown_10[3] = 0;
            *((_WORD *)pUnknown_10 + 1) |= (_WORD)a5 << 8;
            sub_34E70(pPlanet);
            return 0xFFFFFFFF;
          }
        }
      }
    }
    goto LABEL_42;
  }
  if ( cl0 > 1u )
  {
    if ( cl0 > 3u )
    {
      sub_34E70(pPlanet);
      return 0;
    }
    if ( cl0 == 3
      || (V_PlanetItems.item[v24].flags & 2) != 0
      || sub_34368(pPlanet, v24, v23) && ((*((_WORD *)pUnknown_10 + 1) & 1) == 0 || v24 == 0x23 && (*((_WORD *)pUnknown_10 + 1) & 2) == 0) )
    {
      word52 = pPlanet->word52;
      if ( (unsigned __int16)word52 != 0xFFFF )
      {
        if ( *((_BYTE *)pPlanet->pUnknown_10 + 4 * word52 + 1) == 0x17 )
        {
          Ship_sub_35A70 = Q_PLANET_CPP_GetShip_sub_35A70(pPlanet, word52);
          sub_49940(Ship_sub_35A70);
        }
        v12 = (char *)pPlanet->pUnknown_10 + 4 * pPlanet->word52;
        if ( (*((_WORD *)v12 + 1) & 1) == 0 )
        {
          v12[1] = 0xFF;
        }
      }
      v13 = v24;
      v14 = v24;
      pPlanet->word52 = 0xFFFF;
      if ( (V_PlanetItems.item[v14].flags & 2) == 0 )
      {
        pPlanet->word52 = v23;
        if ( v13 != 0x23 )
        {
          pUnknown_10[1] = v13;
        }
      }
      v15 = v24;
      pPlanet->buildingPlanetItemIndex = v24;
      if ( (V_PlanetItems.item[v15].flags & 4) != 0 )
      {
        sub_366C8(pPlanet, v15, &v19, &v20, &a2);
        if ( a2 )
        {
          pUnknown_10[3] = 0;
          *((_WORD *)pUnknown_10 + 1) |= (_WORD)a2 << 8;
        }
      }
      sub_34E70(pPlanet);
      return 0xFFFFFFFF;
    }
LABEL_42:
    sub_34E70(pPlanet);
    return v5;
  }
  v9 = pUnknown_10[1];
  if ( v9 == 0xFF
    || (char)V_PlanetItems.item[v9].mpop > pPlanet->maximumPopulation - pPlanet->word42 && (*((_WORD *)pUnknown_10 + 1) & 1) != 0 )
  {
    goto LABEL_42;
  }
  pUnknown_10[1] = 0xFF;
  *((_WORD *)pUnknown_10 + 1) = 0;
  if ( (_WORD)v23 == pPlanet->word52 )
  {
    pPlanet->word52 = 0xFFFF;
    pPlanet->buildingPlanetItemIndex = 0xFF;
  }
  sub_34E70(pPlanet);
  return 0xFFFFFFFF;
}

//----- (00034E70) --------------------------------------------------------
void __fastcall sub_34E70(P_Planet a1)
{
  int v2; // ebp
  int v3; // kr04_4
  char *v4; // esi
  unsigned __int8 v5; // dl
  T_PlanetItem *v6; // eax
  signed __int8 pros; // dh
  int v8; // edi
  signed __int8 res; // dh
  int v10; // edi
  int v11; // eax
  int v12; // eax
  int v13; // eax
  UBYTE buildingPlanetItemIndex; // dl
  int v15; // eax
  UWORD maximumPopulation; // dx
  UWORD word42; // cx
  BYTE v18; // [esp+0h] [ebp-30h]
  WORD v19; // [esp+4h] [ebp-2Ch]
  BYTE v20; // [esp+8h] [ebp-28h]
  WORD v21; // [esp+Ch] [ebp-24h]
  WORD v22; // [esp+10h] [ebp-20h]
  WORD v23; // [esp+14h] [ebp-1Ch]
  int v24; // [esp+18h] [ebp-18h]
  int v25; // [esp+1Ch] [ebp-14h]
  int v26; // [esp+20h] [ebp-10h]
  int v27; // [esp+20h] [ebp-10h]
  UWORD word55; // [esp+24h] [ebp-Ch]

  v2 = 0;
  v25 = 0;
  v24 = 0;
  v26 = 0;
  v19 = 0;
  v23 = 0;
  v21 = 0;
  v22 = 0;
  v18 = 0;
  v20 = 0;
  word55 = a1->word55;
  v3 = 0;
  while ( v2 < a1->word1A )
  {
    v4 = (char *)a1->pUnknown_10 + 4 * v3;
    v5 = v4[1];
    v6 = &V_PlanetItems.item[v5];
    if ( v5 == 0xFF )
    {
      if ( v2 < a1->word18 )
      {
        if ( (*v4 & 8) == 0 )
        {
          ++v23;
          if ( !*v4 )
          {
            ++v21;
          }
        }
      }
      else
      {
        ++v22;
      }
    }
    else
    {
      if ( (*((_WORD *)v4 + 1) & 1) != 0 )
      {
        if ( v6->ind )
        {
          v25 += (char)v6->ind;
          if ( *v4 == 2 )
          {
            ++v25;
          }
        }
        pros = v6->pros;
        if ( pros )
        {
          v8 = pros + v26;
          v26 = v8;
          if ( *((_BYTE *)a1->pUnknown_10 + 4 * v3) == 3 )
          {
            v26 = v8 + 1;
          }
        }
        res = v6->res;
        if ( res )
        {
          v10 = res + v24;
          v24 = v10;
          if ( *((_BYTE *)a1->pUnknown_10 + 4 * v3) == 4 )
          {
            v24 = v10 + 1;
          }
        }
        if ( (v6->flags & ATTACK) == 0 || v5 == 17 )
        {
          if ( (v6->flags & DEFENSE) != 0 || v5 == 17 )
          {
            ++v20;
          }
        }
        else
        {
          ++v18;
        }
        word55 += (char)v6->mpop;
      }
      if ( v5 != 0x17 && (*((_WORD *)a1->pUnknown_10 + 2 * v3 + 1) & 2) == 0 && (V_PlanetItems.item[v5].flags & MASK6) == 0 )
      {
        v19 += (char)v6->upop;
      }
    }
    ++v2;
    ++v3;
  }
  v11 = sub_35930(a1, 0xC);
  if ( v11 != 0xFFFF && (*((_WORD *)a1->pUnknown_10 + 2 * v11 + 1) & 1) != 0 )
  {
    v25 += v25 >> 1;
  }
  v12 = sub_35930(a1, 0xD);
  if ( v12 != 0xFFFF && (*((_WORD *)a1->pUnknown_10 + 2 * v12 + 1) & 1) != 0 )
  {
    v26 += v26 >> 1;
  }
  v13 = sub_35930(a1, 0xE);
  if ( v13 != 0xFFFF && (*((_WORD *)a1->pUnknown_10 + 2 * v13 + 1) & 1) != 0 )
  {
    v24 += v24 >> 1;
  }
  if ( a1->buildingPlanetItemIndex != 0xFF )
  {
    buildingPlanetItemIndex = a1->buildingPlanetItemIndex;
    v15 = v25 >> 2;
    switch ( buildingPlanetItemIndex )
    {
      case 0x21u:
        v26 += v15;
        break;
      case 0x22u:
        LOWORD(v24) = v15 + v24;
        break;
      case 0x23u:
        v19 += (char)V_PlanetItems.item[0x23].upop;
        break;
    }
  }
  if ( v25 )
  {
    v25 = (int)pow((double)(v25 + 1), 0.85);
  }
  if ( v26 )
  {
    v26 = (int)pow((double)(v26 + 1), 0.85);
  }
  v27 = v26 - a1->word42 / 4;
  if ( v27 < 0 )
  {
    LOWORD(v27) = 0;
  }
  a1->word1C = v23;
  a1->word20 = v21;
  a1->word1E = v22;
  a1->industry = v25;
  a1->research = v24;
  if ( V_RaceIndex != a1->raceIndex && V_FlashPopExists == FALSE && V_Game.Unknown_D8A[0x2A] )
  {
    if ( V_Game.Unknown_D8A[0x2A] <= 1u )
    {
      a1->industry = (int)((double)a1->industry * 1.3);
    }
    else if ( V_Game.Unknown_D8A[0x2A] == 2 )
    {
      a1->industry = (int)((double)a1->industry * 1.3);
      a1->research = (int)(1.3 * (double)a1->research);
    }
  }
  a1->prosperity = v27;
  a1->maximumPopulation = word55;
  a1->word4C = v19;
  a1->byte58 = v18;
  a1->byte59 = v20;
  if ( a1->maximumPopulation > 0x64u )
  {
    a1->maximumPopulation = 0x64;
  }
  maximumPopulation = a1->maximumPopulation;
  if ( a1->word42 > maximumPopulation )
  {
    a1->word42 = maximumPopulation;
  }
  word42 = a1->word42;
  if ( (unsigned int)a1->word4C > word42 )
  {
    a1->word4C = word42;
  }
}

//----- (000352E0) --------------------------------------------------------
void __fastcall sub_352E0(P_Planet pPlanet)
{
  _BYTE *pUnknown_10; // edi
  int v3; // kr04_4
  int v4; // edx
  UBYTE buildingPlanetItemIndex; // ah
  unsigned int v6; // ebp
  int v7; // eax
  unsigned __int16 word52; // dx
  UBYTE raceIndex; // al
  char *v10; // eax
  P_Ship Ship_sub_35A70; // eax
  __int16 v12; // ax
  int v13; // edi
  int v14; // ecx
  int v15; // eax
  int v16; // kr0C_4
  UBYTE v17; // bl
  __int16 v18; // di
  UBYTE v19; // al
  int v20; // eax
  UWORD maximumPopulation; // di
  float x_4; // [esp+4h] [ebp-58h]
  T_Vector3D v1; // [esp+8h] [ebp-54h] BYREF
  T_Vector3D v2; // [esp+14h] [ebp-48h]
  int a3; // [esp+2Ch] [ebp-30h] BYREF
  int a4; // [esp+30h] [ebp-2Ch] BYREF
  int length; // [esp+38h] [ebp-24h] BYREF
  float v28; // [esp+3Ch] [ebp-20h]
  int v29; // [esp+40h] [ebp-1Ch]

  pPlanet->Unknown_62 = 0;
  if ( pPlanet->raceIndex != 0xFF )
  {
    pUnknown_10 = pPlanet->pUnknown_10;
    LOWORD(v29) = 0;
    v3 = 0;
    while ( (__int16)v29 < (int)pPlanet->word1A )
    {
      if ( pUnknown_10[4 * v3 + 1] != 0xFF )
      {
        v4 = (unsigned __int8)pUnknown_10[4 * v3 + 1];
        if ( (V_PlanetItems.item[v4].flags & 4) != 0 )
        {
          sub_366C8(pPlanet, v4, &a3, &a4, &length);
          if ( length )
          {
            pUnknown_10[4 * v3 + 3] = 0;
            *(_WORD *)&pUnknown_10[4 * v3 + 2] |= (_WORD)length << 8;
          }
        }
      }
      LOWORD(v29) = v29 + 1;
      ++v3;
    }
    buildingPlanetItemIndex = pPlanet->buildingPlanetItemIndex;
    v6 = 0;
    if ( buildingPlanetItemIndex != 0xFF )
    {
      v7 = buildingPlanetItemIndex;
      if ( (V_PlanetItems.item[v7].flags & 0x20) == 0 )
      {
        if ( pPlanet->word52 == 0xFFFF && (V_PlanetItems.item[v7].flags & 2) == 0 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x3E9);
        }
        word52 = pPlanet->word52;
        pPlanet->buildingProgress += pPlanet->industry;
        if ( (unsigned __int16)Q_GetPlanetItemCost_sub_3583C(pPlanet, word52, pPlanet->buildingPlanetItemIndex) > pPlanet->buildingProgress )
        {
          if ( pPlanet->buildingPlanetItemIndex == 0x1F && !(V_Game.day % 0xA) )
          {
            v13 = V_RaceIndex;
            v14 = pPlanet->industry / 0xA + 1;
            v15 = 0;
            v16 = 0;
            while ( v15 < V_Game.racesNum )
            {
              ++v15;
              *((_WORD *)&V_StaticStrings_dword_A0D04 + 0xF7 * v16 + v13 + 0x1210) = v14 + V_Game.races[v16].Unknown_1B2[v13];
              ++v16;
            }
          }
        }
        else
        {
          raceIndex = pPlanet->raceIndex;
          if ( raceIndex == V_RaceIndex
            && pPlanet->buildingPlanetItemIndex == 2
            && (unsigned __int16)V_ResTree.a.w1[raceIndex] == 0xFFFF
            && !sub_469F0((int)&V_ResTree, raceIndex) )
          {
            Q_AddGameEvent_sub_55AEC(&WinMgr, ASCEND_EP_25_FIRST_LAB, 0, 0);
          }
          if ( V_RaceIndex == pPlanet->raceIndex && WinMgr.Unknown_4228 != 0x11 && pPlanet->buildingPlanetItemIndex != 0x17 && !pPlanet->z7 )
          {
            v6 = 0xFFFFFFFF;
            Q_AddGameEvent_sub_55AEC(&WinMgr, ASCEND_EP_01_CONSTRUCTION_COMPLETE, pPlanet, (void *)pPlanet->buildingPlanetItemIndex);
          }
          v10 = (char *)pPlanet->pUnknown_10 + 4 * pPlanet->word52;
          if ( (*v10 & 8) != 0 )
          {
            *v10 &= ~8u;
            *((_BYTE *)pPlanet->pUnknown_10 + 4 * pPlanet->word52 + 1) = 0xFF;
            sub_46A94(&V_ResTree.num, pPlanet->raceIndex, pPlanet);
          }
          else
          {
            v10[2] |= 1u;
          }
          if ( pPlanet->buildingPlanetItemIndex == 0x17 )// Ship
          {
            Ship_sub_35A70 = Q_PLANET_CPP_GetShip_sub_35A70(pPlanet, pPlanet->word52);
            if ( !Ship_sub_35A70 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x415);
            }
            if ( Ship_sub_35A70->locationType == ASCEND_LOCATION_TYPE_1 )
            {
              pPlanet->word42 -= (char)V_PlanetItems.item[0x17].upop;
            }
            sub_49828(Ship_sub_35A70);
          }
          if ( pPlanet->buildingPlanetItemIndex == 0x24 )// Terraforming
          {
            *((_WORD *)pPlanet->pUnknown_10 + 2 * pPlanet->word52 + 1) = 0;
            *((_BYTE *)pPlanet->pUnknown_10 + 4 * pPlanet->word52 + 1) = 0xFF;
            *((_BYTE *)pPlanet->pUnknown_10 + 4 * pPlanet->word52) = 1;
          }
          if ( pPlanet->buildingPlanetItemIndex == 0x23 )// Automation
          {
            *((_BYTE *)pPlanet->pUnknown_10 + 4 * pPlanet->word52 + 2) |= 2u;
          }
          if ( pPlanet->buildingPlanetItemIndex == 0x25 && (pPlanet->Unknown_66 & 1) == 0 )
          {
            pPlanet->word55 += 0xA;
            pPlanet->Unknown_66 |= 1u;
          }
          if ( (V_PlanetItems.item[pPlanet->buildingPlanetItemIndex].flags & 8) != 0 && pPlanet->word52 >= pPlanet->word18 )
          {
            v12 = 0xF;
            if ( pPlanet->buildingPlanetItemIndex == 0x1B )
            {
              v12 = 0x23;
            }
            *((_BYTE *)pPlanet->pUnknown_10 + 4 * pPlanet->word52 + 3) = 0;
            *((_WORD *)pPlanet->pUnknown_10 + 2 * pPlanet->word52 + 1) |= v12 << 8;
          }
          pPlanet->word52 = 0xFFFF;
          pPlanet->buildingPlanetItemIndex = 0xFF;
          pPlanet->buildingProgress = 0;
        }
      }
    }
    if ( pPlanet->word42 < pPlanet->maximumPopulation )
    {
      v17 = V_RaceIndex;
      v18 = pPlanet->prosperity + pPlanet->z6;
      v19 = pPlanet->raceIndex;
      pPlanet->z6 = v18;
      if ( v19 != v17 && (unsigned __int16)pPlanet->prosperity < 4u )
      {
        pPlanet->z6 = v18 + 1;
      }
      if ( (unsigned __int16)pPlanet->z6 < V_PlanItem50 )
      {
        goto LABEL_71;
      }
      if ( V_RaceIndex == pPlanet->raceIndex
        && WinMgr.Unknown_4228 != 0x11
        && pPlanet->word42 == pPlanet->word4C
        && !v6
        && !pPlanet->z7
        && (pPlanet->buildingPlanetItemIndex == 0xFF || (V_PlanetItems.item[pPlanet->buildingPlanetItemIndex].flags & 0x20) != 0) )
      {
        Q_AddGameEvent_sub_55AEC(&WinMgr, ASCEND_EP_15_HAS_FREE_POPULATION, pPlanet, 0);
      }
      ++pPlanet->word42;
      v20 = sub_35930(pPlanet, 0xF);
      if ( v20 != 0xFFFF && (*((_WORD *)pPlanet->pUnknown_10 + 2 * v20 + 1) & 1) != 0 )
      {
        ++pPlanet->word42;
      }
      maximumPopulation = pPlanet->maximumPopulation;
      if ( pPlanet->word42 > maximumPopulation )
      {
        pPlanet->word42 = maximumPopulation;
      }
    }
    pPlanet->z6 = 0;
LABEL_71:
    sub_34E70(pPlanet);
  }
  v1 = pPlanet->v;
  v28 = sqrt(v1.y * v1.y + v1.x * v1.x + v1.z * v1.z);
  Q_NormVector3D_sub_53000(&v1);
  x_4 = dbl_91DD9 / (v28 * v28);
  Q_RotateVectorY_sub_532AC(&v1, x_4);
  v2.x = v1.x * v28;
  v2.y = v1.y * v28;
  v2.z = v1.z * v28;
  v1.y = v2.y;
  v1.z = v2.z;
  pPlanet->v.x = v2.x;
  pPlanet->v.y = v1.y;
  pPlanet->v.z = v1.z;
}
// 91DD9: using guessed type double dbl_91DD9;
// 9684C: using guessed type int V_PlanItem50;

//----- (0003583C) --------------------------------------------------------
__int16 __fastcall Q_GetPlanetItemCost_sub_3583C(P_Planet pPlanet, unsigned __int16 a2, unsigned __int8 planetItemIndex)
{
  __int16 result; // ax
  T_Ship *Ship_sub_35A70; // eax

  result = 0xFFFF;
  if ( a2 != 0xFFFF )
  {
    planetItemIndex = *((_BYTE *)pPlanet->pUnknown_10 + 4 * a2 + 1);
  }
  if ( planetItemIndex != 0xFF )
  {
    if ( planetItemIndex == 0x17 )                     // Ship
    {
      if ( Q_PLANET_CPP_GetShip_sub_35A70(pPlanet, a2)->locationType == 2 )
      {
        result = pPlanet->Unknown_77;
      }
      else
      {
        Ship_sub_35A70 = Q_PLANET_CPP_GetShip_sub_35A70(pPlanet, a2);
        result = sub_4A18C(Ship_sub_35A70);
      }
    }
    else
    {
      result = V_PlanetItems.item[planetItemIndex].cost;
    }
    if ( planetItemIndex == 0x23 && a2 == pPlanet->word52 )// Automation
    {
      result *= 3;
    }
  }
  return result;
}
// 35893: conditional instruction was optimized away because bl.1 is in (<17u|18..FE)

//----- (000358BC) --------------------------------------------------------
int __fastcall Q_GetDaysToCompletePlanetItem_sub_358BC(P_Planet pPlanet)
{
  UWORD industry; // si
  UWORD buildingProgress; // cx
  unsigned __int16 cost; // ax

  industry = pPlanet->industry;
  buildingProgress = pPlanet->buildingProgress;
  cost = Q_GetPlanetItemCost_sub_3583C(pPlanet, pPlanet->word52, pPlanet->buildingPlanetItemIndex);
  return Q_GetTurnsToComplete_sub_46C20(cost, buildingProgress, industry);
}

//----- (000358F0) --------------------------------------------------------
int __fastcall sub_358F0(P_Planet a1)
{
  UWORD word18; // dx
  int v3; // ebx
  UWORD v4; // ax
  char v5; // cl

  word18 = a1->word18;
  v3 = 0;
  v4 = 0;
  if ( word18 )
  {
    do
    {
      v5 = *((_BYTE *)a1->pUnknown_10 + 4 * v4 + 1);
      if ( v5 != (char)0xFF && v5 != 5 )
      {
        ++v3;
      }
      ++v4;
    }
    while ( v4 < a1->word18 );
  }
  return v3;
}

//----- (00035930) --------------------------------------------------------
UWORD __fastcall sub_35930(P_Planet a1, char a2)
{
  UWORD word1A; // dx
  UWORD i; // ax

  word1A = a1->word1A;
  i = 0;
  if ( !word1A )
  {
    return 0xFFFF;
  }
  while ( a2 != *((_BYTE *)a1->pUnknown_10 + 4 * i + 1) )
  {
    if ( ++i >= a1->word1A )
    {
      return 0xFFFF;
    }
  }
  return i;
}

//----- (00035968) --------------------------------------------------------
int __fastcall sub_35968(P_Planet a1, int a2, int a3)
{
  int v6; // ebx
  int v7; // edx
  int size; // ecx
  int v9; // eax
  int v10; // esi
  int v11; // eax
  int v12; // eax
  int v14; // [esp+4h] [ebp-4h]

  v6 = 0;
  v14 = 0xFFFF;
  if ( a2 >= 0 && a2 < 0xF && a3 >= 0 )
  {
    v7 = 0;
    if ( a2 > 0 )
    {
      size = a1->size;
      v9 = 0xF * size;
      do
      {
        LOWORD(size) = *(&V_PlanetCfg.room1[5].a0 + ++v9);
        ++v7;
        v6 += size;
      }
      while ( v7 < a2 );
    }
    v10 = 0xF * a1->size + a2;
    v11 = *(&V_PlanetCfg.room1[0].a0 + v10);
    if ( a3 >= v11 )
    {
      v12 = *(&V_PlanetCfg.room2[0].a0 + v10) + v11;
      if ( a3 < v12 )
      {
        LOWORD(v12) = *(&V_PlanetCfg.room1[0].a0 + v10);
        return a3 + v6 - v12;
      }
    }
  }
  return v14;
}

//----- (00035A00) --------------------------------------------------------
unsigned int __fastcall sub_35A00(P_Planet a1, unsigned __int16 a2)
{
  unsigned int v4; // edi
  int v5; // edi
  int v6; // ecx
  UWORD word18; // si
  unsigned __int16 v8; // ax
  int v9; // edx

  v4 = 0xFFFFFFFF;
  if ( a2 < a1->word18 )
  {
    v5 = 0;
    v6 = 0;
    word18 = a1->word18;
    v8 = 0;
    if ( word18 )
    {
      v9 = 0xF * a1->size;
      do
      {
        v5 = *(&V_PlanetCfg.room1[0].a0 + v9) + a2 - v8;
        v8 += *(&V_PlanetCfg.room2[0].a0 + v9);
        if ( v8 > a2 )
        {
          break;
        }
        ++v9;
        ++v6;
      }
      while ( v8 < a1->word18 );
    }
    return (v6 << 0x10) + v5;
  }
  return v4;
}

//----- (00035A70) --------------------------------------------------------
P_Ship __fastcall Q_PLANET_CPP_GetShip_sub_35A70(P_Planet pPlanet, unsigned __int16 a2)
{
  unsigned int shipIndex; // ecx

  if ( a2 >= pPlanet->word1A )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x50B);
  }
  shipIndex = ((int)*((unsigned __int16 *)pPlanet->pUnknown_10 + 2 * a2 + 1) >> 8) & 0x7F;
  if ( shipIndex >= 107 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x50F);
  }
  if ( V_Game.ships[(unsigned __int16)shipIndex].raceIndex == 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x510);
  }
  return &V_Game.ships[(unsigned __int16)shipIndex];
}

//----- (00035B04) --------------------------------------------------------
unsigned __int16 __fastcall sub_35B04(int a1, unsigned __int16 a2, int a3)
{
  int v4; // edi
  unsigned __int16 result; // ax

  if ( a2 >= *(_WORD *)(a1 + 0x1A) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x519);
  }
  if ( a2 < *(_WORD *)(a1 + 0x18) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x51A);
  }
  v4 = (a3 - (int)V_Game.ships) / 0x162;
  if ( (unsigned __int16)v4 >= 0x6Bu )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x51E);
  }
  if ( V_Game.ships[(unsigned __int16)v4].raceIndex == 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x51F);
  }
  result = a2;
  *(_WORD *)(*(_DWORD *)(a1 + 0x10) + 4 * a2 + 2) = ((_WORD)v4 << 8) | (unsigned __int8)*(_WORD *)(*(_DWORD *)(a1 + 0x10) + 4 * a2 + 2);
  return result;
}

//----- (00035BB4) --------------------------------------------------------
unsigned int __fastcall sub_35BB4(T_Planet *a1, int a2)
{
  int word18; // edx
  int v5; // eax
  int v6; // kr04_4

  if ( a1->raceIndex == *(__int16 *)(a2 + 0x56) || !sub_361B8(a1) )
  {
    word18 = a1->word18;
    v5 = 4 * (unsigned __int16)word18;
    v6 = 0;
    while ( word18 < a1->word1A )
    {
      if ( *((_BYTE *)a1->pUnknown_10 + 4 * v6 + v5 + 1) == 0xFF )
      {
        *(_BYTE *)(a2 + 0x58) = 3;
        *(_DWORD *)(a2 + 0x59) = a1;
        *((_BYTE *)a1->pUnknown_10 + v5 + 1) = 0x17;
        *(_WORD *)((char *)a1->pUnknown_10 + v5 + 2) = 1;
        sub_35B04((int)a1, word18, a2);
        return 0xFFFFFFFF;
      }
      ++word18;
      ++v6;
    }
  }
  return 0;
}

//----- (00035C38) --------------------------------------------------------
unsigned int __fastcall sub_35C38(T_Planet *a1, T_Ship *a2)
{
  int word18; // ecx
  int v4; // esi
  int v5; // kr00_4
  int v6; // kr04_4
  char *v7; // eax
  double z; // st7
  float v10; // [esp+0h] [ebp-40h] BYREF
  float v11; // [esp+4h] [ebp-3Ch]
  float v12; // [esp+8h] [ebp-38h]
  T_Vector3D v13[2]; // [esp+Ch] [ebp-34h] BYREF
  int v14; // [esp+24h] [ebp-1Ch]
  T_Vector3D *v15; // [esp+28h] [ebp-18h]

  word18 = a1->word18;
  v4 = 4 * word18;
  v5 = 4 * word18;
  v6 = 0;
  while ( word18 < a1->word1A )
  {
    v7 = (char *)a1->pUnknown_10 + 4 * v6 + v5;
    if ( *((_WORD *)v7 + 1) && v7[1] == 0x17 && Q_PLANET_CPP_GetShip_sub_35A70(a1, word18) == a2 )
    {
      *((_BYTE *)a1->pUnknown_10 + v4 + 1) = 0xFF;
      *(_WORD *)((char *)a1->pUnknown_10 + v4 + 2) = 0;
      a2->locationType = 4;
      a2->pLocation.pPlanet = (P_Planet)&V_Game.stars[a1->starIndex];
      v10 = (float)(rand() % 0x3E8 - 0x1F4);
      v11 = (float)(rand() % 0x3E8 - 0x1F4);
      v14 = rand() % 0x3E8 - 0x1F4;
      v12 = (float)v14;
      sub_53054(&v10, 250.0);
      memset(&v13[1], 0, sizeof(T_Vector3D));
      v15 = v13;
      v13[1].x = a1->v.x + v10;
      v13[1].y = a1->v.y + v11;
      z = a1->v.z;
      v13[0] = v13[1];
      v13[1].z = z + v12;
      sub_496BC(a2, v13);
      return 0xFFFFFFFF;
    }
    ++word18;
    ++v6;
  }
  return 0;
}

//----- (00035DA4) --------------------------------------------------------
char __fastcall sub_35DA4(P_Planet a1)
{
  char v1; // bl
  int v2; // ecx

  v1 = 0xFF;
  if ( V_PlanetItems.item[0x1B].resReq == 0xFF )
  {
    return 0x1B;
  }
  v2 = 1 << a1->raceIndex;
  if ( (v2 & V_ResTree.items[V_PlanetItems.item[0x1B].resReq].Unknown_48) != 0 )
  {
    return 0x1B;
  }
  if ( V_PlanetItems.item[0x1A].resReq == 0xFF || (v2 & V_ResTree.items[V_PlanetItems.item[0x1A].resReq].Unknown_48) != 0 )
  {
    return 0x1A;
  }
  return v1;
}

//----- (00035E24) --------------------------------------------------------
char __fastcall sub_35E24(P_Planet a1)
{
  char v1; // dl
  int v2; // ecx

  v1 = 0xFF;
  if ( V_PlanetItems.item[0x1E].resReq == 0xFF )
  {
    return 0x1E;
  }
  v2 = 1 << a1->raceIndex;
  if ( (v2 & V_ResTree.items[V_PlanetItems.item[0x1E].resReq].Unknown_48) != 0 )
  {
    return 0x1E;
  }
  if ( V_PlanetItems.item[0x1D].resReq == 0xFF || (v2 & V_ResTree.items[V_PlanetItems.item[0x1D].resReq].Unknown_48) != 0 )
  {
    return 0x1D;
  }
  if ( V_PlanetItems.item[0x1C].resReq == 0xFF || (v2 & V_ResTree.items[V_PlanetItems.item[0x1C].resReq].Unknown_48) != 0 )
  {
    return 0x1C;
  }
  return v1;
}

//----- (00035ED8) --------------------------------------------------------
int __fastcall sub_35ED8(T_Planet *a1)
{
  int word18; // ebp
  int v3; // kr00_4
  int v4; // kr04_4
  char v5; // al
  char *v6; // eax
  char v7; // dl
  _DWORD *a4; // [esp+Ch] [ebp-34h] BYREF
  int a3; // [esp+10h] [ebp-30h] BYREF
  int result; // [esp+14h] [ebp-2Ch] BYREF
  float result_4; // [esp+18h] [ebp-28h]
  int v13; // [esp+1Ch] [ebp-24h]
  int v14; // [esp+20h] [ebp-20h]
  float v15; // [esp+24h] [ebp-1Ch]

  word18 = a1->word18;
  v15 = -1.0;
  v3 = 4 * word18;
  v4 = 0;
  while ( word18 < a1->word1A )
  {
    v6 = (char *)a1->pUnknown_10 + 4 * v4 + v3;
    v7 = v6[1];
    result_4 = -1.0;
    if ( v7 != (char)0xFF && (*((_WORD *)v6 + 1) & 1) != 0 )
    {
      v5 = v6[1];
      if ( (unsigned __int8)v5 >= 0x1Cu && (unsigned __int8)v5 <= 0x1Eu )
      {
        a4 = 0;
        a3 = 0;
        result = 1;
        sub_366C8(a1, *((_BYTE *)a1->pUnknown_10 + 4 * v4 + v3 + 1), &a4, &a3, &result);
        if ( result )
        {
          v14 = (int)*(unsigned __int16 *)((char *)a1->pUnknown_10 + 4 * v4 + v3 + 2) >> 8;
        }
        if ( v14 > 0 )
        {
          v13 = 0x20 * (_DWORD)a4;
          result_4 = (double)(0x20 * (int)a4) * 0.95;
        }
      }
    }
    if ( result_4 > (double)v15 )
    {
      v15 = result_4;
    }
    ++word18;
    ++v4;
  }
  return (int)v15;
}

//----- (00035FE0) --------------------------------------------------------
int __fastcall sub_35FE0(P_Planet a1)
{
  int word18; // ebx
  int result; // eax
  int v4; // kr00_4
  int v5; // kr04_4
  char v6; // dl
  char *v7; // edx

  word18 = a1->word18;
  result = 0;
  v4 = 4 * (unsigned __int16)word18;
  v5 = 0;
  while ( word18 < a1->word1A )
  {
    v7 = (char *)a1->pUnknown_10 + 4 * v5 + v4;
    if ( v7[1] != (char)0xFF && (*((_WORD *)v7 + 1) & 1) != 0 )
    {
      v6 = v7[1];
      if ( (unsigned __int8)v6 >= 0x1Au )
      {
        if ( (unsigned __int8)v6 <= 0x1Au )
        {
          result += 3;
        }
        else if ( v6 == 0x1B )
        {
          result += 6;
        }
      }
    }
    ++word18;
    ++v5;
  }
  return result;
}

//----- (00036050) --------------------------------------------------------
int __fastcall sub_36050(P_Planet a1)
{
  int word18; // ebx
  int result; // eax
  int v4; // kr00_4
  int v5; // kr04_4
  char v6; // dl
  char *v7; // edx

  word18 = a1->word18;
  result = 0;
  v4 = 4 * (unsigned __int16)word18;
  v5 = 0;
  while ( word18 < a1->word1A )
  {
    v7 = (char *)a1->pUnknown_10 + 4 * v5 + v4;
    if ( v7[1] != (char)0xFF && (*((_WORD *)v7 + 1) & 1) != 0 )
    {
      v6 = v7[1];
      if ( (unsigned __int8)v6 < 29u )
      {
        if ( v6 == 0x1C )
        {
          result += 2;
        }
      }
      else if ( (unsigned __int8)v6 <= 29u )
      {
        result += 4;
      }
      else if ( v6 == 30 )
      {
        result += 6;
      }
    }
    ++word18;
    ++v5;
  }
  return result;
}

//----- (000360D8) --------------------------------------------------------
int __fastcall sub_360D8(P_Planet a1)
{
  int word18; // ebx
  int result; // eax
  int v4; // kr00_4
  int v5; // kr04_4
  char *v6; // edx

  word18 = a1->word18;
  result = 0;
  v4 = 4 * (unsigned __int16)word18;
  v5 = 0;
  while ( word18 < a1->word1A )
  {
    v6 = (char *)a1->pUnknown_10 + 4 * v5 + v4;
    if ( v6[1] != (char)0xFF && (*((_WORD *)v6 + 1) & 1) != 0 )
    {
      switch ( v6[1] )
      {
        case 0x1A:
          ++result;
          break;
        case 0x1B:
        case 0x1C:
          result += 2;
          break;
        case 0x1D:
          result += 4;
          break;
        case 0x1E:
          result += 6;
          break;
        default:
          break;
      }
    }
    ++word18;
    ++v5;
  }
  return result;
}

//----- (00036158) --------------------------------------------------------
int __fastcall sub_36158(P_Planet a1)
{
  int result; // eax
  int v3; // ebx
  int v4; // kr04_4
  char v5; // dl
  char *v6; // edx

  result = 0;
  v3 = 0;
  v4 = 0;
  while ( v3 < a1->word18 )
  {
    v6 = (char *)a1->pUnknown_10 + 4 * v4;
    if ( v6[1] != (char)0xFF && (*((_WORD *)v6 + 1) & 1) != 0 )
    {
      v5 = v6[1];
      if ( (unsigned __int8)v5 >= 18u )
      {
        if ( (unsigned __int8)v5 <= 18u )
        {
          result += 2;
        }
        else if ( v5 == 19 )
        {
          result += 4;
        }
      }
    }
    ++v3;
    ++v4;
  }
  return result;
}

//----- (000361B8) --------------------------------------------------------
int __fastcall sub_361B8(T_Planet *a1)
{
  int word18; // ecx
  int v3; // edi
  int v4; // kr00_4
  int v5; // kr04_4
  char *v6; // eax
  char v7; // dl

  word18 = a1->word18;
  v3 = 0;
  v4 = 4 * (unsigned __int16)word18;
  v5 = 0;
  while ( word18 < a1->word1A )
  {
    v6 = (char *)a1->pUnknown_10 + 4 * v5 + v4;
    if ( v6[1] != (char)0xFF && (*((_WORD *)v6 + 1) & 1) != 0 )
    {
      if ( v6[1] == 0x17 && Q_PLANET_CPP_GetShip_sub_35A70(a1, word18)->raceIndex == a1->raceIndex )
      {
        return 0xFFFFFFFF;
      }
      v7 = *((_BYTE *)a1->pUnknown_10 + 4 * v5 + v4 + 1);
      if ( v7 == 0x1A || v7 == 0x1B )
      {
        return 0xFFFFFFFF;
      }
    }
    ++word18;
    ++v5;
  }
  return v3;
}

//----- (0003623C) --------------------------------------------------------
unsigned int __fastcall sub_3623C(T_Planet *a1)
{
  unsigned int v2; // ebp
  int v3; // kr04_4
  char *v4; // eax
  char v5; // dh
  int a2; // [esp+0h] [ebp-1Ch]

  v2 = 0;
  a2 = 0;
  v3 = 0;
  while ( a1->word18 > a2 )
  {
    v4 = (char *)a1->pUnknown_10 + 4 * v3;
    if ( v4[1] != (char)0xFF && (*((_WORD *)v4 + 1) & 1) != 0 )
    {
      v5 = v4[1];
      if ( v5 == 2 || v5 == 8 )
      {
        if ( sub_34B0C(a1, (unsigned __int16)a2, *((_BYTE *)a1->pUnknown_10 + 4 * v3 + 1), 1u) )
        {
          v2 = 0xFFFFFFFF;
        }
      }
    }
    ++a2;
    ++v3;
  }
  return v2;
}

//----- (000362C8) --------------------------------------------------------
void __fastcall sub_362C8(P_Planet a1, T_Vector3D *a2)
{
  a1->v = *a2;
  sub_53440(&a1->v);
}

//----- (000362E0) --------------------------------------------------------
unsigned int __fastcall sub_362E0(P_Planet a1)
{
  int v2; // ebx
  int v3; // eax

  if ( a1->raceIndex >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x688);
  }
  v2 = 0;
  v3 = sub_35930(a1, 0x16);
  if ( v3 != 0xFFFF && (*((_WORD *)a1->pUnknown_10 + 2 * v3 + 1) & 1) != 0 && sub_3EFE0(&V_Game.races[a1->raceIndex]) > 0 )
  {
    return 0xFFFFFFFF;
  }
  return v2;
}

//----- (0003636C) --------------------------------------------------------
void __fastcall sub_3636C(int a1, int a2)
{
  int v4; // edx
  __int16 v5; // bx
  int v6; // eax
  int v7; // kr04_4

  v4 = *(_DWORD *)(a1 + 0x10);
  v5 = 0;
  v6 = 0;
  v7 = 0;
  while ( v5 < (int)*(unsigned __int16 *)(a1 + 0x18) )
  {
    if ( *(unsigned __int8 *)(v4 + 4 * v7) < 2u )
    {
      if ( *(_BYTE *)(v4 + 4 * v7) )
      {
        ++v6;
      }
      else if ( a2 )
      {
        ++v6;
      }
    }
    else
    {
      v6 += 2;
    }
    ++v5;
    ++v7;
  }
}

//----- (000363B0) --------------------------------------------------------
int __fastcall sub_363B0(T_Planet *a1)
{
  unsigned __int16 v2; // ax
  int v3; // edi
  int v4; // ebx
  int v5; // eax
  int v6; // kr04_4
  int v7; // edi

  if ( a1->raceIndex > V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x6CD);
  }
  sub_3636C((int)a1, (V_Game.races[a1->raceIndex].ability != 2) - 1);
  v3 = (a1->maximumPopulation - a1->word42) / 2 + a1->word42 + a1->research + (unsigned __int16)a1->prosperity + a1->industry + v2;
  if ( (a1->Unknown_66 & 2) != 0 )
  {
    v3 += 0x64;
  }
  v4 = 0;
  v5 = 0;
  v6 = 0;
  while ( v5 < a1->word1A )
  {
    ++v5;
    v4 += V_PlanetItems.item[*((unsigned __int8 *)a1->pUnknown_10 + 4 * v6++ + 1)].cost;
  }
  v7 = v4 + v3;
  if ( sub_35930(a1, 0x16) )
  {
    v7 += 0x32;
  }
  if ( sub_35930(a1, 0x18) )
  {
    v7 += 0x32;
  }
  if ( v7 < 0 )
  {
    return 0;
  }
  return v7;
}
// 36405: variable 'v2' is possibly undefined

//----- (000364B4) --------------------------------------------------------
int __fastcall sub_364B4(T_Planet *a1, __int16 a2)
{
  T_Race *v3; // ebx
  int raceIndex; // eax
  unsigned __int16 v5; // ax
  unsigned int v6; // esi
  int v7; // edi
  int v8; // eax
  int v9; // edx
  int v10; // kr04_4
  int word18; // edx
  int v12; // kr0C_4
  int v13; // edi
  int v14; // eax
  int v16; // [esp+0h] [ebp-1Ch]
  unsigned int v17; // [esp+4h] [ebp-18h]

  if ( a2 > V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x71A);
  }
  v3 = &V_Game.races[a2];
  raceIndex = a1->raceIndex;
  v16 = 0;
  if ( raceIndex == 0xFF || a2 != raceIndex && v3->Unknown_1C0[raceIndex] == 2 )
  {
    sub_3636C((int)a1, (V_Game.races[a2].ability != 2) - 1);
    v16 = v5;
    if ( (a1->Unknown_66 & 2) != 0 )
    {
      v16 = v5 + 0x28;
    }
    if ( v16 > 0x46 || v3->Unknown_1C0[a1->raceIndex] == 2 )
    {
      if ( v3->Unknown_1C0[a1->raceIndex] != 2 )
      {
        goto LABEL_30;
      }
      v6 = 0;
      v7 = (a1->maximumPopulation - a1->word42) / 2 + a1->word42 + a1->research + (unsigned __int16)a1->prosperity + a1->industry;
      v17 = 0;
      if ( sub_35930(a1, 0xB) != 0xFFFF )
      {
        v6 = 0xFFFFFFFF;
      }
      if ( sub_35930(a1, 0x19) != 0xFFFF )
      {
        v17 = 0xFFFFFFFF;
      }
      v8 = 0;
      if ( !v6 )
      {
        v9 = 0;
        v10 = 0;
        while ( v9 < a1->word18 )
        {
          ++v9;
          v8 += V_PlanetItems.item[*((unsigned __int8 *)a1->pUnknown_10 + 4 * v10++ + 1)].cost;
        }
      }
      if ( !v17 )
      {
        word18 = a1->word18;
        v12 = 0;
        while ( word18 < a1->word1A )
        {
          ++word18;
          v8 += V_PlanetItems.item[*((unsigned __int8 *)a1->pUnknown_10 + 4 * v12++ + 1)].cost;
        }
      }
      v13 = v8 + v7;
      if ( sub_35930(a1, 0x16) )
      {
        v13 += 0x32;
      }
      if ( sub_35930(a1, 0x18) )
      {
        v13 += 0x32;
      }
      v14 = 2 * (v13 / 0xA + v16);
    }
    else
    {
      v14 = 0;
    }
    v16 = v14;
  }
LABEL_30:
  if ( v16 < 0 )
  {
    return 0;
  }
  return v16;
}
// 3654C: variable 'v5' is possibly undefined

//----- (000366C8) --------------------------------------------------------
void __fastcall sub_366C8(P_Planet a1, char a2, _DWORD *a3, _DWORD *a4, _DWORD *a5)
{
  if ( !a3 || !a4 || !a5 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x785);
  }
  switch ( a2 )
  {
    case 28:
      *a3 = 45;
      *a4 = 7;
      *a5 = 1;
      break;
    case 29:
      *a3 = 45;
      *a4 = 7;
      *a5 = 3;
      break;
    case 30:
      *a3 = 90;
      *a4 = 8;
      *a5 = 3;
      break;
    case 17:
      *a3 = 200;
      *a4 = 0;
      *a5 = 2;
      break;
  }
}

//----- (0003676C) --------------------------------------------------------
int __fastcall sub_3676C(T_Planet *a1, int a2)
{
  int Unknown_6B; // eax
  int Unknown_6F; // edi
  double v5; // st7
  BOOL v6; // eax
  int v7; // eax
  double v8; // st7
  double z; // st7
  int v10; // eax
  int v11; // eax
  float v12; // [esp+Ch] [ebp-8Ch]
  float v13; // [esp+10h] [ebp-88h]
  float v14; // [esp+14h] [ebp-84h]
  float v15; // [esp+18h] [ebp-80h] BYREF
  float v16; // [esp+1Ch] [ebp-7Ch]
  float v17; // [esp+20h] [ebp-78h]
  float v18; // [esp+24h] [ebp-74h] BYREF
  float v19; // [esp+28h] [ebp-70h]
  float v20; // [esp+2Ch] [ebp-6Ch]
  int v21[3]; // [esp+30h] [ebp-68h] BYREF
  float v22; // [esp+3Ch] [ebp-5Ch]
  float v23; // [esp+40h] [ebp-58h]
  float v24; // [esp+44h] [ebp-54h]
  float v25; // [esp+48h] [ebp-50h]
  float v26; // [esp+4Ch] [ebp-4Ch]
  float v27; // [esp+50h] [ebp-48h]
  int *v28; // [esp+54h] [ebp-44h]
  int v29; // [esp+58h] [ebp-40h]
  __int64 result; // [esp+5Ch] [ebp-3Ch] BYREF
  float *v31; // [esp+64h] [ebp-34h]
  int a3; // [esp+68h] [ebp-30h] BYREF
  _DWORD a4[2]; // [esp+6Ch] [ebp-2Ch] BYREF
  int v34; // [esp+74h] [ebp-24h]
  float v35; // [esp+78h] [ebp-20h]
  int v36; // [esp+7Ch] [ebp-1Ch]
  int v37; // [esp+80h] [ebp-18h]

  Unknown_6B = a1->Unknown_6B;
  v37 = 0;
  LOBYTE(Unknown_6B) = *(_BYTE *)(Unknown_6B + 1);
  v34 = 0xFFFFFFFF;
  if ( (_BYTE)Unknown_6B == 0xFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x7AB);
  }
  Unknown_6F = a1->Unknown_6F;
  a3 = 0;
  a4[0] = 0;
  LODWORD(result) = 1;
  sub_366C8(a1, *(_BYTE *)(a1->Unknown_6B + 1), &a3, a4, &result);
  if ( Unknown_6F )
  {
    if ( *(_BYTE *)(Unknown_6F + 0x58) != 4 || &V_Game.stars[a1->starIndex] != (T_Star *)*(T_Game **)(Unknown_6F + 0x59) )
    {
      v34 = 0;
    }
    if ( a3 > 0 )
    {
      v28 = v21;
      v25 = 0.0;
      v26 = 0.0;
      v27 = 0.0;
      v25 = *(float *)(Unknown_6F + 0x9E) - a1->v.x;
      v26 = *(float *)(Unknown_6F + 0xA2) - a1->v.y;
      v27 = *(float *)(Unknown_6F + 0xA6) - a1->v.z;
      *(float *)v21 = v25;
      *(float *)&v21[1] = v26;
      *(float *)&v21[2] = v27;
      v5 = sqrt(v26 * v26 + v25 * v25 + v27 * v27);
      v29 = 0x20 * a3;
      if ( (double)(0x20 * a3) < v5 )
      {
        v34 = 0;
      }
    }
  }
  v36 = 1;
  if ( (_DWORD)result )
  {
    v36 = (int)*(unsigned __int16 *)(a1->Unknown_6B + 2) >> 8;
  }
  v6 = v34 && v36;
  v37 |= v6;
  if ( (v37 & 1) != 0 )
  {
    if ( a4[0] )
    {
      v7 = sub_4B7A0(Unknown_6F, a2, a4[0], a1->raceIndex);
      v37 |= v7;
    }
    if ( a2 == 1 )
    {
      if ( *(_BYTE *)(a1->Unknown_6B + 1) == 0x11 )
      {
        v31 = &v18;
        v12 = *(float *)(Unknown_6F + 0x9E) - a1->v.x;
        v13 = *(float *)(Unknown_6F + 0xA2) - a1->v.y;
        v14 = *(float *)(Unknown_6F + 0xA6) - a1->v.z;
        v18 = v12;
        v19 = v13;
        v20 = v14;
        v8 = sqrt(v13 * v13 + v12 * v12 + v14 * v14) + -3200.0;
        v35 = v8;
        if ( v8 < 1280.0 )
        {
          v35 = 1280.0;
        }
        sub_53054(&v18, v35);
        v22 = 0.0;
        v23 = 0.0;
        v24 = 0.0;
        a4[1] = &v15;
        v22 = a1->v.x + v18;
        v23 = a1->v.y + v19;
        z = a1->v.z;
        v15 = v22;
        v24 = z + v20;
        v16 = v23;
        v17 = v24;
        *(float *)(Unknown_6F + 0x9E) = v22;
        *(float *)(Unknown_6F + 0xA2) = v16;
        *(float *)(Unknown_6F + 0xA6) = v17;
      }
      if ( (_DWORD)result && v36 > 0 )
      {
        v10 = a1->Unknown_6B;
        --v36;
        *(_BYTE *)(v10 + 3) = 0;
        *(_WORD *)(a1->Unknown_6B + 2) |= (_WORD)v36 << 8;
      }
    }
  }
  v11 = v37;
  a1->Unknown_73 = v37;
  return v11;
}

//----- (00036A5C) --------------------------------------------------------
void __fastcall sub_36A5C(T_Planet *a1, int a2, __int16 a3)
{
  int raceIndex; // edx
  int v5; // eax
  UWORD word1A; // cx
  int v7; // edi
  int v8; // eax
  int v9; // ebx
  int v10; // ecx
  unsigned __int16 v11; // di
  int v12; // ebp
  int v13; // eax
  __int16 v14; // ecx^2
  int v15; // ebx
  P_Ship Ship_sub_35A70; // eax
  __int16 v17[10]; // [esp+0h] [ebp-30h]
  int v18; // [esp+14h] [ebp-1Ch]
  unsigned __int16 v19[2]; // [esp+18h] [ebp-18h]
  int v20; // [esp+1Ch] [ebp-14h]

  v18 = a2;
  LOWORD(v20) = a3;
  if ( a1->Unknown_62 != 0xFFFFFFFF )
  {
    if ( a1->raceIndex >= V_Game.racesNum && a1->raceIndex != 0xFF )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x7FE);
    }
    if ( (v20 & 0x8000u) != 0 || (__int16)v20 >= V_Game.racesNum )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x7FF);
    }
    raceIndex = a1->raceIndex;
    if ( raceIndex != 0xFF )
    {
      v5 = raceIndex;
      raceIndex = (__int16)v20;
      sub_433E0(&V_Game.races[v5], v20, &V_Game.stars[a1->starIndex]);
    }
    LOWORD(raceIndex) = a1->word18;
    word1A = a1->word1A;
    v7 = 0;
    *(_DWORD *)v19 = 0xFFFF;
    if ( (unsigned __int16)raceIndex < word1A )
    {
      v8 = 0;
      do
      {
        v9 = 4 * (unsigned __int16)raceIndex;
        if ( *((_BYTE *)a1->pUnknown_10 + v9 + 1) != 0xFF )
        {
          v17[v8] = raceIndex;
          if ( (V_PlanetItems.item[*((unsigned __int8 *)a1->pUnknown_10 + v9 + 1)].flags & 8) != 0 && (_WORD)raceIndex != a1->word52 )
          {
            *(_DWORD *)v19 = raceIndex;
          }
          ++v8;
          ++v7;
        }
        ++raceIndex;
      }
      while ( (unsigned __int16)raceIndex < a1->word1A );
    }
    if ( v7 )
    {
      v10 = 0xFFFFFFFF;
      if ( v19[0] == 0xFFFF )
      {
        v11 = v17[rand() % v7];
      }
      else
      {
        v11 = v19[0];
        v12 = 4 * v19[0];
        v13 = ((int)*(unsigned __int16 *)((char *)a1->pUnknown_10 + v12 + 2) >> 8) - v18;
        if ( v13 > 0 && v19[0] != a1->word52 )
        {
          *((_BYTE *)a1->pUnknown_10 + v12 + 3) = 0;
          *(_WORD *)((char *)a1->pUnknown_10 + v12 + 2) |= (_WORD)v13 << 8;
          v10 = 0;
        }
      }
      if ( *((_BYTE *)a1->pUnknown_10 + 4 * v11 + 1) == 0x17 )
      {
        v14 = v20;
        v15 = v18;
        Ship_sub_35A70 = Q_PLANET_CPP_GetShip_sub_35A70(a1, v11);
        v10 = ((sub_4B7A0((int)Ship_sub_35A70, 1, 2 * v15, v14) & 4) == 0) - 1;
      }
      if ( a1->maximumPopulation < a1->word42 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x837);
      }
      if ( V_PlanetItems.item[*((unsigned __int8 *)a1->pUnknown_10 + 4 * v11 + 1)].mpop )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x838);
      }
      if ( v10 == 0xFFFFFFFF )
      {
        sub_34B0C(a1, v11, 0xFFu, 1u);
        if ( *((_BYTE *)a1->pUnknown_10 + 4 * v11 + 1) != 0xFF )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x83D);
        }
        if ( v11 == a1->word52 )
        {
          a1->word52 = 0xFFFF;
          a1->buildingPlanetItemIndex = 0xFF;
          a1->buildingProgress = 0;
        }
      }
      sub_34E70(a1);
    }
  }
}
// 36A5C: using guessed type __int16 var_30[10];

//----- (00036CD4) --------------------------------------------------------
MACRO_VFX_BOOL __fastcall Q_TryInvadePlanet_sub_36CD4(P_Planet pPlanet, unsigned __int16 dx0, int *a3)
{
  P_Ship vpShip; // eax
  int raceIndex; // edx
  T_Ship *vpShip_; // ebp
  unsigned int v8; // eax
  WORD v9; // di
  __int16 i; // ax
  __int16 j; // ax
  char *v12; // edx
  char *v13; // edx
  int ii; // edi
  __int16 jj; // bx
  int v16; // edi
  char *v17; // eax
  char *v18; // eax
  MACRO_VFX_BOOL mastersOfInvasion; // [esp+0h] [ebp-30h]
  int surfaceShields; // [esp+4h] [ebp-2Ch]
  int modulesToUse; // [esp+8h] [ebp-28h]
  MACRO_VFX_BOOL invaded; // [esp+Ch] [ebp-24h]
  int invasionModules; // [esp+10h] [ebp-20h]
  int v25; // [esp+14h] [ebp-1Ch]
  unsigned __int16 k; // [esp+18h] [ebp-18h]
  unsigned __int16 a2; // [esp+1Ch] [ebp-14h]

  invaded = FALSE;
  if ( dx0 >= pPlanet->word1A )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x851);
  }
  if ( *((_BYTE *)pPlanet->pUnknown_10 + 4 * dx0 + 1) != 0x17 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x852);
  }
  vpShip = Q_PLANET_CPP_GetShip_sub_35A70(pPlanet, dx0);
  raceIndex = pPlanet->raceIndex;
  vpShip_ = vpShip;
  if ( raceIndex == 0xFF || raceIndex == vpShip->raceIndex )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x856);
  }
  mastersOfInvasion = FALSE;
  if ( !V_Game.races[vpShip->raceIndex].ability )
  {
    mastersOfInvasion = TRUE;
  }
  if ( sub_433E0(&V_Game.races[pPlanet->raceIndex], vpShip->raceIndex, &V_Game.stars[pPlanet->starIndex]) == 0xFFFFFFFF )
  {
    v8 = 0xF7 * pPlanet->raceIndex;
    v9 = V_Game.races[v8 / 0xF7].Unknown_1C7[1];
    if ( v9 < V_Game.races[0].Unknown_1B2[vpShip_->raceIndex + v8] )
    {
      V_Game.races[0].Unknown_1B2[vpShip_->raceIndex + v8] = v9 - 0xA;
    }
  }
  invasionModules = 0;
  surfaceShields = 0;
  for ( i = 0; i < vpShip_->hullCellsNum; ++i )
  {
    if ( vpShip_->hullCells[i].gizmoIndex == 0x49 )
    {
      ++invasionModules;
    }
  }
  for ( j = 0; j < (int)pPlanet->word18; ++j )
  {
    v13 = (char *)pPlanet->pUnknown_10 + 4 * j;
    if ( v13[1] == 0x12 && (*((_WORD *)v13 + 1) & 1) != 0 )
    {
      ++surfaceShields;
    }
    else
    {
      v12 = (char *)pPlanet->pUnknown_10 + 4 * j;
      if ( v12[1] == 0x13 && (*((_WORD *)v12 + 1) & 1) != 0 )
      {
        surfaceShields += 2;
      }
    }
  }
  v25 = invasionModules;
  if ( invasionModules > surfaceShields )
  {
    v25 = surfaceShields + 1;
  }
  modulesToUse = v25;
  if ( mastersOfInvasion == TRUE )
  {
    modulesToUse = 1;
  }
  ii = 0;
  jj = 0;
  *a3 = modulesToUse;
  while ( jj < vpShip_->hullCellsNum && ii < modulesToUse )
  {
    if ( vpShip_->hullCells[jj].gizmoIndex == 0x49 )
    {
      ++ii;
      Q_Ship_RemoveGizmo_sub_492F8(vpShip_, jj);
    }
    ++jj;
  }
  sub_496E0(vpShip_);
  v16 = 0;
  for ( a2 = 0; (__int16)a2 < (int)pPlanet->word18 && v16 < v25; ++a2 )
  {
    v17 = (char *)pPlanet->pUnknown_10 + 4 * (__int16)a2;
    if ( v17[1] == 0x12 && (*((_WORD *)v17 + 1) & 1) != 0 )
    {
      ++v16;
      sub_34B0C(pPlanet, a2, 0xFFu, 1u);
    }
  }
  for ( k = 0; (__int16)k < (int)pPlanet->word18 && v16 < v25; ++k )
  {
    v18 = (char *)pPlanet->pUnknown_10 + 4 * (__int16)k;
    if ( v18[1] == 0x13 && (*((_WORD *)v18 + 1) & 1) != 0 )
    {
      v16 += 2;
      if ( v16 <= v25 )
      {
        sub_34B0C(pPlanet, k, 0xFFu, 1u);
      }
    }
  }
  if ( invasionModules > surfaceShields || mastersOfInvasion == TRUE )
  {
    if ( pPlanet->raceIndex == V_RaceIndex && WinMgr.Unknown_4228 != 0x10 )
    {
      Q_AddGameEvent_sub_55AEC(&WinMgr, ASCEND_EP_COLONYINVADED, pPlanet, 0);
    }
    sub_1D234(&V_Game.stars[pPlanet->starIndex], pPlanet, vpShip_->raceIndex);
    invaded = TRUE;
    pPlanet->dayColonized = V_Game.day;
  }
  sub_34E70(pPlanet);
  return invaded;
}

//----- (00037040) --------------------------------------------------------
void __fastcall sub_37040(P_Planet pPlanet)
{
  int v2; // edx
  int v3; // kr04_4
  char *v4; // esi

  sub_1D234(&V_Game.stars[pPlanet->starIndex], pPlanet, 0xFFFF);
  v2 = 0;
  v3 = 0;
  while ( v2 < pPlanet->word1A )
  {
    v4 = (char *)pPlanet->pUnknown_10 + 4 * v3;
    if ( v4[1] != 0x17 )
    {
      v4[1] = 0xFF;
      *((_WORD *)pPlanet->pUnknown_10 + 2 * v3 + 1) = 0;
    }
    ++v2;
    ++v3;
  }
  pPlanet->word4C = 0;
  pPlanet->word42 = pPlanet->word4C;
  pPlanet->raceIndex = 0xFF;
  sub_34E70(pPlanet);
}

//----- (000370B8) --------------------------------------------------------
void __fastcall Q_ReadWritePlanet_sub_370B8(P_Planet pPlanet, P_FileInfo pfi, int read)
{
  T_Planet vPlanet; // [esp+0h] [ebp-8Ch] BYREF

  if ( read == TRUE )
  {
    memset(&vPlanet, 0, 0xC);
    vPlanet.pUnknown_10 = 0;
    vPlanet.z7 = 0;
    vPlanet.word1A = 0;
    Q_ReadFile_sub_1BF94(pfi, &vPlanet, 0x7Bu);
    pPlanet->v.x = vPlanet.v.x;
    pPlanet->v.y = vPlanet.v.y;
    pPlanet->v.z = vPlanet.v.z;
    pPlanet->starIndex = vPlanet.starIndex;
    pPlanet->Unknown_E = vPlanet.Unknown_E;
    pPlanet->pUnknown_10 = vPlanet.pUnknown_10;
    pPlanet->size = vPlanet.size;
    pPlanet->type = vPlanet.type;
    pPlanet->word18 = vPlanet.word18;
    pPlanet->word1A = vPlanet.word1A;
    pPlanet->word1C = vPlanet.word1C;
    pPlanet->word1E = vPlanet.word1E;
    pPlanet->word20 = vPlanet.word20;
    pPlanet->z5 = vPlanet.z5;
    qmemcpy(pPlanet->name, vPlanet.name, 0x1Cu);
    *(_WORD *)&pPlanet->name[0x1C] = *(_WORD *)&vPlanet.name[0x1C];
    pPlanet->word42 = vPlanet.word42;
    pPlanet->industry = vPlanet.industry;
    pPlanet->research = vPlanet.research;
    pPlanet->prosperity = vPlanet.prosperity;
    pPlanet->maximumPopulation = vPlanet.maximumPopulation;
    pPlanet->word4C = vPlanet.word4C;
    pPlanet->z6 = vPlanet.z6;
    pPlanet->buildingProgress = vPlanet.buildingProgress;
    pPlanet->word52 = vPlanet.word52;
    pPlanet->buildingPlanetItemIndex = vPlanet.buildingPlanetItemIndex;
    pPlanet->word55 = vPlanet.word55;
    pPlanet->raceIndex = vPlanet.raceIndex;
    pPlanet->byte58 = vPlanet.byte58;
    pPlanet->byte59 = vPlanet.byte59;
    pPlanet->z7 = vPlanet.z7;
    pPlanet->Unknown_5E = vPlanet.Unknown_5E;
    pPlanet->Unknown_62 = vPlanet.Unknown_62;
    pPlanet->Unknown_66 = vPlanet.Unknown_66;
    pPlanet->dayColonized = vPlanet.dayColonized;
    pPlanet->Unknown_6B = vPlanet.Unknown_6B;
    pPlanet->Unknown_6F = vPlanet.Unknown_6F;
    pPlanet->Unknown_73 = vPlanet.Unknown_73;
    pPlanet->Unknown_77 = vPlanet.Unknown_77;
    if ( V_Game.starsNum <= pPlanet->starIndex )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x8E4);
    }
    if ( pPlanet->Unknown_E >= 5 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x8E5);
    }
    V_Game.stars[pPlanet->starIndex].Unknown_46[pPlanet->Unknown_E] = (int)pPlanet;
    ++V_Game.stars[pPlanet->starIndex].planetsNum;
  }
  else
  {
    Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, pPlanet, 0x7Bu);
  }
}

//----- (000372B0) --------------------------------------------------------
void __fastcall __spoils<> Q_WndPW_sub_372B0(P_WndPW a1)
{
  Q_A2Ctor_sub_2C830(&a1->a);
  a1->a.procs = (P_Procs)off_95F84;
  Q_WndPW_sub_37310(a1);
}
// 95F84: using guessed type int (*off_95F84[5])();

//----- (000372CC) --------------------------------------------------------
P_TypeA2 __fastcall sub_372CC(P_TypeA2 a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_95F58);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95F84;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95F84: using guessed type int (*off_95F84[5])();

//----- (00037310) --------------------------------------------------------
void __fastcall Q_WndPW_sub_37310(P_WndPW a1)
{
  WORD Unknown_AE; // ax
  int v3; // ebx
  int v4; // kr04_4
  char s[64]; // [esp+0h] [ebp-40h] BYREF

  a1->Unknown_AB = -1;
  a1->Unknown_AE = -1;
  Unknown_AE = a1->Unknown_AE;
  a1->Unknown_18B = 5;
  a1->Unknown_B0 = Unknown_AE;
  v3 = 0;
  a1->Unknown_AC = Unknown_AE;
  v4 = 0;
  do
  {
    sprintf(s, "data\\planal%02d.shp", v3++);
    *(_WORD *)&a1->Unknown_173[2 * v4++ + 2] = Q_CACHE_CPP_sub_1ADAC(&WinMgr.t13, s);
  }
  while ( v3 < 0xB );
}

//----- (00037380) --------------------------------------------------------
int __fastcall sub_37380(int a1, int a2)
{
  return (__int16)((0x11 * a1 + 0x22 * a2 - 0x29D6) / 0x484) | (((0x11 * a1 - 0x22 * a2 - 0xC9E) / (int)0xFFFFFB7C) << 0x10);
}

//----- (000373E0) --------------------------------------------------------
int __fastcall sub_373E0(int a1, int a2)
{
  int v3; // eax

  if ( a1 > 0xD && a1 < 0x99 && a2 > 0x77 && a2 < 0x1D5 )
  {
    return (a2 - 0x77) / 0x46 + V_Game.pCurPlanet->word18 + 5 * ((a1 - 0xD) / 0x46);
  }
  v3 = sub_37380(a1, a2);
  return (unsigned __int16)sub_35968(V_Game.pCurPlanet, v3 >> 0x10, (__int16)v3);
}

//----- (0003745C) --------------------------------------------------------
int __fastcall sub_3745C(T_Type5 *a1, unsigned __int8 *a2, int a3, int a4)
{
  LONG v5; // eax
  T_TypeA2 *Wnd_sub_56DA8; // eax
  LONG v7; // ebp
  unsigned __int16 v8; // bx
  void *ShapeTable_sub_1B084; // eax
  void *v10; // eax
  char *name; // ecx
  LONG v13; // [esp-20h] [ebp-40h]
  LONG v14; // [esp-18h] [ebp-38h]
  int v15; // [esp+0h] [ebp-20h] BYREF
  LONG hotY; // [esp+4h] [ebp-1Ch] BYREF
  LONG shape_number; // [esp+8h] [ebp-18h] BYREF
  int v18; // [esp+Ch] [ebp-14h] BYREF
  unsigned __int8 v19; // [esp+10h] [ebp-10h]

  v5 = 0xF2;
  if ( a4 )
  {
    v5 = 0x96;
  }
  VFX_pane_wipe((PANE *)a1, v5);
  v19 = *a2;
  if ( v19 != 0xFF )
  {
    Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&WinMgr, "PLANETALLOC", 0);
    sub_39390((int)Wnd_sub_56DA8, v19, (__int16 *)&v18, &shape_number);
    v7 = (LONG)sub_10000;
    if ( v19 == 0x17 )
    {
      v7 = 0x8000;
    }
    v8 = shape_number;
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v18);
    Q_GSYSTEM_CPP_sub_2BC40((PANE *)a1, ShapeTable_sub_1B084, v8, &v15, &hotY);
    v14 = hotY;
    v13 = (unsigned __int16)shape_number;
    v10 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v18);
    VFX_shape_transform((PANE *)a1, v10, v13, 0x28, v14, V_BigBuffer, 0, v7, v7, 0);
  }
  name = V_PlanetItems.item[*a2].name;
  WinMgr.LargeFont.pane = (PANE)*a1;
  return sub_2B8A8(&WinMgr.LargeFont, 0x50, 0, name, 1, 0xFFFFFFFF, 0xFF, 0);
}
// 10000: using guessed type void __noreturn sub_10000();
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (00037568) --------------------------------------------------------
void __fastcall sub_37568(int eax0, unsigned __int16 a2, int a3, unsigned int a4)
{
  T_Wnd10LB *Wnd_sub_56DA8; // ecx
  T_Wnd14PSW *v5; // eax
  P_Wnd14PSW pWnd14PSW; // edi
  char *v7; // ebx
  P_Wnd20HW v8; // eax
  P_Procs v9; // ebx
  int i; // kr04_4
  P_Wnd20HW v11; // eax
  P_Wnd20HW v12; // edx
  P_Wnd20HW v13; // edx
  int v14; // edx
  T_Planet *v15; // eax
  T_Planet *v16; // eax
  T_Planet *pCurPlanet; // eax
  P_Wnd20HW v18; // edx
  unsigned __int8 v19; // ch
  UBYTE v20; // dh
  P_Ship pShip; // esi
  int v22; // eax
  T_Star *pStar; // edi
  P_Planet pPlanet; // ebx
  char *title; // eax
  P_Planet pPlanet_; // edx
  UBYTE raceIndex; // cl
  int v28; // edi
  signed int v29; // ecx
  WORD j; // dx
  int jj; // esi
  int PlanetsNum_sub_402E0; // eax
  char *helpTopic; // ebx
  int v34; // eax
  char *sub_1CEA8; // eax
  P_Wnd20HW v36; // edi
  int v37; // kr0C_4
  int v38; // kr18_4
  int v39; // kr1C_4
  char v40; // al
  char v41; // al
  P_Wnd20HW v42; // edi
  int v43; // kr14_4
  int v44; // kr20_4
  int v45; // kr24_4
  char v46; // al
  char v47; // al
  unsigned int v48; // eax
  UBYTE v49; // al
  unsigned __int16 v50; // bx
  P_Wnd20HW v51; // eax
  int v52; // eax
  int v53; // ebx
  P_Procs procs; // esi
  P_Wnd10LB v55; // eax
  P_Wnd20HW v56; // edi
  P_Wnd20HW v57; // esi
  const char *v58; // edi
  P_Wnd10LB v59; // eax
  int v60; // esi
  T_Ship *v61; // ecx
  T_TypeA2 *v62; // edi
  P_Ship Ship_sub_35A70; // eax
  char *v64; // [esp-8h] [ebp-120h]
  int v65; // [esp-4h] [ebp-11Ch]
  char v66[200]; // [esp+0h] [ebp-118h] BYREF
  int s[7]; // [esp+C8h] [ebp-50h] BYREF
  _DWORD v68[5]; // [esp+E4h] [ebp-34h]
  int v69; // [esp+F8h] [ebp-20h]
  P_Wnd20HW pWnd20HW; // [esp+FCh] [ebp-1Ch]
  unsigned int v71; // [esp+100h] [ebp-18h]
  P_Wnd10LB result; // [esp+104h] [ebp-14h]
  unsigned __int16 v73[2]; // [esp+108h] [ebp-10h]
  int v74; // [esp+10Ch] [ebp-Ch]
  P_Wnd20HW a1; // [esp+110h] [ebp-8h]
  int v76; // [esp+114h] [ebp-4h]
  _BYTE savedregs[12]; // [esp+118h] [ebp+0h]

  a1 = (P_Wnd20HW)eax0;
  LOWORD(v76) = a2;
  *(_DWORD *)v73 = a3;
  v71 = a4;
  Wnd_sub_56DA8 = (T_Wnd10LB *)Q_FindWnd_sub_56DA8(&WinMgr, "PLANLIST", 0);
  result = Wnd_sub_56DA8;
  v5 = (T_Wnd14PSW *)Q_FindWnd_sub_56DA8(&WinMgr, "PLSQUARE", 0);
  pWnd14PSW = v5;
  if ( a2 >= 7u )
  {
    if ( (unsigned __int16)v76 <= 7u )
    {
      sub_56728(&WinMgr, a1->a2.a1.index, 4, 8, 0, 0);
      if ( (a1->a2.a1._mouseFocus & a1->a2.a1.i & a1->a2.a1.j) == 0xFFFFFFFF )
      {
        ((void (__fastcall *)(P_Wnd20HW, _DWORD))a1->a2.procs->proc5)(a1, 0);
      }
      return;
    }
    if ( (unsigned __int16)v76 < 0x33u )
    {
      if ( (unsigned __int16)v76 > 8u )
      {
        if ( (_WORD)v76 != 0x32 )
        {
          goto LABEL_8;
        }
        *(_WORD *)&a1->Unknown_AB[1] = 0xFFFF;
        if ( *(_DWORD *)v73 == 0xA || *(_DWORD *)v73 == 0xB )
        {
          sub_56D30(&WinMgr, v5->a.a1.index, 2, 0, 0);
          ((void (*)(void))a1->a2.procs->proc3)();
        }
        else if ( *(_DWORD *)v73 == 0xC )
        {
          sub_56D30(&WinMgr, v5->a.a1.index, 2, 0, 0);
          procs = a1->a2.procs;
          a1->Unknown_AB[0] = 5;
          ((void (*)(void))procs->proc3)();
        }
        else if ( *(_DWORD *)v73 == 4
               || V_RaceIndex == V_Game.pCurPlanet->raceIndex
               || *(unsigned __int16 *)&a1->Unknown_AB[3] != 0xFFFF
               && *((_BYTE *)V_Game.pCurPlanet->pUnknown_10 + 4 * *(unsigned __int16 *)&a1->Unknown_AB[3] + 1) == 0x17
               && Q_PLANET_CPP_GetShip_sub_35A70(V_Game.pCurPlanet, *(_WORD *)&a1->Unknown_AB[3])->raceIndex == V_RaceIndex )
        {
          sub_56D30(&WinMgr, pWnd14PSW->a.a1.index, 0x32, *(int *)v73, *(unsigned __int16 *)&a1->Unknown_AB[3]);
          sub_2D258(&a1->a2, 6);
          sub_56D30(&WinMgr, pWnd14PSW->a.a1.index, 1, 0, 0);
          ((void (__fastcall *)(P_Wnd20HW, _DWORD))a1->a2.procs->proc4)(a1, 0);
        }
        return;
      }
      if ( Wnd_sub_56DA8->a.a1.i || v5->a.a1.i )
      {
        return;
      }
      v13 = a1;
      *(_WORD *)&a1->Unknown_AB[1] = sub_373E0(*(int *)v73, v71);
      if ( V_Game.pCurPlanet->raceIndex != V_RaceIndex
        && v13->Unknown_AB[0] != 5
        && *(unsigned __int16 *)&a1->Unknown_AB[1] != 0xFFFF
        && (*((_BYTE *)V_Game.pCurPlanet->pUnknown_10 + 4 * *(unsigned __int16 *)&a1->Unknown_AB[1] + 1) != 0x17
         || Q_PLANET_CPP_GetShip_sub_35A70(V_Game.pCurPlanet, *(_WORD *)&a1->Unknown_AB[1])->raceIndex != V_RaceIndex) )
      {
        *(_WORD *)&a1->Unknown_AB[1] = 0xFFFF;
      }
      v14 = *(unsigned __int16 *)&a1->Unknown_AB[1];
      if ( (unsigned __int16)v14 != 0xFFFF
        && *((_BYTE *)V_Game.pCurPlanet->pUnknown_10 + 4 * v14 + 1) == 0x17
        && Q_PLANET_CPP_GetShip_sub_35A70(V_Game.pCurPlanet, v14)->raceIndex != V_RaceIndex )
      {
        *(_WORD *)&a1->Unknown_AB[1] = 0xFFFF;
      }
    }
    else if ( a2 <= 0x33u )
    {
      if ( V_RaceIndex == V_Game.pCurPlanet->raceIndex )
      {
        if ( *(_DWORD *)v73 == 1 )
        {
          *(_WORD *)&a1->Unknown_AB[3] = 0xFFFF;
        }
        v55 = result;
        v56 = a1;
        result->Unknown_AB = 0;
        v57 = a1;
        v55->Unknown_8C9 = 0x4B;
        v55->Unknown_C6 = 0xF2;
        Q_A10_SetProc_sub_2F1C8(v55, sub_3745C);
        v69 = 0;
        v74 = 0;
        v58 = &v56->Unknown_AB[7];
        sub_2ED4C(result);
        do
        {
          if ( (_BYTE)v74 != 5 && sub_34368(V_Game.pCurPlanet, v74, *(_WORD *)&a1->Unknown_AB[3]) )
          {
            v59 = result;
            v57->Unknown_AB[7] = v74;
            *(_DWORD *)&v57->Unknown_AB[8] = 0;
            sub_2EA8C((int)v59, v58, 0xFFFFFFFF, 0);
            v57 = (P_Wnd20HW)((char *)v57 + 5);
            v58 += 5;
            ++v69;
          }
          ++v74;
        }
        while ( v74 < 0x27 );
        if ( v69 )
        {
          sub_2D258(&a1->a2, 6);
          sub_56D30(&WinMgr, result->a.a1.index, 1, 0, 0);
        }
      }
    }
    else
    {
      if ( (unsigned __int16)v76 < 0x1C01u )
      {
        if ( (_WORD)v76 != 0x34 )
        {
          goto LABEL_8;
        }
        v60 = 0xFFFFFFFF;
        if ( v71 )
        {
          *(_WORD *)&a1->Unknown_AB[5] = v5->Unknown_AB;
        }
        else
        {
          v61 = sub_40144(&V_Game.races[V_Game.pCurPlanet->raceIndex], V_Game.pCurPlanet);
          if ( !v61 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\planwin.cpp", 0x2AD);
          }
          v60 = 0;
          sub_35B04((int)V_Game.pCurPlanet, v73[0], (int)v61);
        }
        v62 = Q_FindWnd_sub_56DA8(&WinMgr, "SHIPDESSCREEN", 0);
        Ship_sub_35A70 = Q_PLANET_CPP_GetShip_sub_35A70(V_Game.pCurPlanet, v73[0]);
        sub_4DA7C((int)v62, (int)Ship_sub_35A70, v60, 0);
        sub_56B60(&WinMgr, 1, 8, 1);
        return;
      }
      v7 = (char *)a1 + 5 * *(_DWORD *)v73;
      if ( (unsigned __int16)v76 > 0x1C01u )
      {
        if ( (_WORD)v76 != 0x1C02 )
        {
LABEL_8:
          sub_2F424(&a1->a2, *(__int16 *)&savedregs[4], *(LONG *)v73, v71);
          return;
        }
        v53 = (unsigned __int8)v7[0xB2];
        if ( v53 != 0xFF )
        {
          sub_56B60(&WinMgr, 5, v53, 5);
        }
        return;
      }
      v49 = v7[0xB2];
      v50 = *(_WORD *)&a1->Unknown_AB[3];
      a1->Unknown_AB[0] = v49;
      if ( v50 == 0xFFFF )
      {
        if ( v49 != 0xFF && (V_PlanetItems.item[v49].flags & 2) != 0 )
        {
          sub_34B0C(V_Game.pCurPlanet, 0xFFFF, v49, 2u);
          a1->Unknown_AB[0] = 0xFF;
        }
      }
      else if ( v49 != 0xFF )
      {
        if ( sub_34368(V_Game.pCurPlanet, a1->Unknown_AB[0], v50) == 0xFFFFFFFF )
        {
          if ( a1->Unknown_AB[0] == 0x17 )
          {
            *(_WORD *)&a1->Unknown_AB[5] = *(_WORD *)&a1->Unknown_AB[3];
          }
          sub_34B0C(V_Game.pCurPlanet, *(unsigned __int16 *)&a1->Unknown_AB[3], a1->Unknown_AB[0], 2u);
        }
        v51 = a1;
        a1->Unknown_AB[0] = 0xFF;
        *(_WORD *)&v51->Unknown_AB[1] = 0xFFFF;
        *(_WORD *)&a1->Unknown_AB[3] = *(_WORD *)&v51->Unknown_AB[1];
      }
      sub_56D30(&WinMgr, result->a.a1.index, 2, 0, 0);
      v52 = *(unsigned __int16 *)&a1->Unknown_AB[5];
      if ( (unsigned __int16)v52 != 0xFFFF )
      {
        a1->a2.procs->proc3(a1, 0x34, v52, 0);
        return;
      }
    }
LABEL_151:
    ((void (__fastcall *)(P_Wnd20HW, _DWORD))a1->a2.procs->proc4)(a1, 0);
    return;
  }
  if ( (unsigned __int16)v76 < 4u )
  {
    if ( !(_WORD)v76 )
    {
      goto LABEL_8;
    }
    if ( a2 <= 1u )
    {
      v68[0] = off_96850[0];
      v68[1] = off_96850[1];
      v68[2] = off_96850[2];
      v68[3] = off_96850[3];
      v68[4] = off_96850[4];
      for ( i = 0; i != 5; ++i )
      {
        sub_56D70(&WinMgr, (char *)v68[i], *(__int16 *)&savedregs[4], *(int *)v73, v71);
      }
      v11 = a1;
      a1->a2.a1.i = 0xFFFFFFFF;
      v11->a2.a1.j = 0xFFFFFFFF;
      v11->Unknown_AB[0] = 0xFF;
      *(_WORD *)&v11->Unknown_AB[1] = 0xFFFF;
      v12 = a1;
      *(_WORD *)&a1->Unknown_AB[3] = *(_WORD *)&v11->Unknown_AB[1];
      if ( *(unsigned __int16 *)&v12->Unknown_AB[5] != 0xFFFF )
      {
        sub_394BC((int)v12);
      }
      ((void (__fastcall *)(P_Wnd20HW, _DWORD))a1->a2.procs->proc4)(a1, 0);
      if ( dword_10467C )
      {
        sub_557D4(&WinMgr, dword_104680, (const char *)dword_10467C, 0x14);
        dword_10467C = 0;
      }
      return;
    }
    if ( (_WORD)v76 != 3 )
    {
      goto LABEL_8;
    }
    if ( v71 < 0x17 )
    {
      if ( v71 < 0x13 )
      {
        if ( v71 == 1 )
        {
          if ( Wnd_sub_56DA8->a.a1.i )
          {
            sub_56D30(&WinMgr, Wnd_sub_56DA8->a.a1.index, 2, 0, 0);
          }
          else if ( v5->a.a1.i )
          {
            sub_56D30(&WinMgr, v5->a.a1.index, 2, 0, Wnd_sub_56DA8->a.a1.i);
          }
          else
          {
            sub_56B60(&WinMgr, 3, 0, 0);
          }
        }
      }
      else if ( v71 <= 0x13 )
      {
        if ( V_NougatLfExists_dword_A0CFC )
        {
          if ( V_Game.pCurPlanet->raceIndex == 0xFF )
          {
            V_Game.pCurPlanet->raceIndex = V_RaceIndex;
          }
          else
          {
            sub_1D234(&V_Game.stars[V_Game.pCurPlanet->starIndex], V_Game.pCurPlanet, V_RaceIndex);
          }
        }
      }
      else if ( v71 == 0x14 && V_NougatLfExists_dword_A0CFC )
      {
        pCurPlanet = V_Game.pCurPlanet;
        V_Game.pCurPlanet->word42 += 2;
        sub_34AE4(pCurPlanet, 5u, 0xFFFFFFFF);
      }
    }
    else if ( v71 <= 0x17 )
    {
      if ( V_NougatLfExists_dword_A0CFC )
      {
        v15 = V_Game.pCurPlanet;
        V_Game.pCurPlanet->buildingProgress += 0xC8;
        sub_352E0(v15);
      }
    }
    else if ( v71 < 0x1F )
    {
      if ( v71 == 0x18 && V_NougatLfExists_dword_A0CFC )
      {
        V_Game.pCurPlanet->word42 = V_Game.pCurPlanet->maximumPopulation;
      }
    }
    else if ( v71 <= 0x1F )
    {
      a1->Unknown_DD[0xAE] ^= 1u;
    }
    else if ( v71 >= 0x31 )
    {
      if ( v71 <= 0x31 )
      {
        if ( V_NougatLfExists_dword_A0CFC )
        {
          sub_352E0(V_Game.pCurPlanet);
        }
      }
      else if ( v71 == 0x32 )
      {
        if ( V_Keyboard.Shift )
        {
          if ( V_NougatLfExists_dword_A0CFC )
          {
            v16 = V_Game.pCurPlanet;
            ++V_Game.pCurPlanet->word55;
            sub_34E70(v16);
          }
        }
        else
        {
          V_Game.pCurPlanet->z7 = ~V_Game.pCurPlanet->z7;
        }
      }
    }
    goto LABEL_151;
  }
  if ( a2 <= 4u )
  {
    if ( a1->a2.a1.i )
    {
      if ( Wnd_sub_56DA8->a.a1.i )
      {
        sub_56D30(&WinMgr, Wnd_sub_56DA8->a.a1.index, 2, 0, 0);
      }
      else if ( v5->a.a1.i )
      {
        sub_56D30(&WinMgr, v5->a.a1.index, 2, 0, Wnd_sub_56DA8->a.a1.i);
      }
      else
      {
        v18 = a1;
        *(_WORD *)&a1->Unknown_AB[3] = *(_WORD *)&a1->Unknown_AB[1];
        if ( *(unsigned __int16 *)&v18->Unknown_AB[3] == 0xFFFF )
        {
          if ( v18->Unknown_AB[0] != (__int8)0xFF )
          {
            v18->Unknown_AB[0] = 0xFF;
          }
        }
        else
        {
          if ( (__int16)v18->a2.a1.r != 0xFFFFFFFF )
          {
            Q_StartSample_sub_4FB90(&V_SoundSystem, v18->a2.a1.r);
          }
          v19 = a1->Unknown_AB[0];
          if ( v19 == 0xFF )
          {
            ((void (*)(void))a1->a2.procs->proc3)();
            return;
          }
          if ( sub_34368(V_Game.pCurPlanet, v19, *(_WORD *)&a1->Unknown_AB[3]) )
          {
            v20 = a1->Unknown_AB[0];
            if ( v20 == 5 )
            {
              pShip = Q_PLANET_CPP_GetShip_sub_35A70(V_Game.pCurPlanet, pWnd14PSW->Unknown_AB);
              v22 = sub_4937C(pShip, 0x47);            // Colonizer
              Q_Ship_RemoveGizmo_sub_492F8(pShip, v22);
              pStar = &V_Game.stars[V_Game.pCurPlanet->starIndex];
              if ( V_Game.pCurPlanet->raceIndex != 0xFF )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\planwin.cpp", 0x1C6);
              }
              pPlanet = V_Game.pCurPlanet;
              title = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1F);// 31: "Name Your Colony"
              sub_557D4(&WinMgr, title, pPlanet->name, 20);
              pPlanet_ = V_Game.pCurPlanet;
              raceIndex = pShip->raceIndex;
              V_Game.pCurPlanet->raceIndex = raceIndex;
              pStar->racesBits |= 1 << raceIndex;
              pPlanet_->word42 = 2;
              pPlanet_->dayColonized = V_Game.day;
              v28 = 0;
              sub_34B0C(V_Game.pCurPlanet, *(unsigned __int16 *)&a1->Unknown_AB[3], a1->Unknown_AB[0], 0);
              v29 = -1u;
              memset(s, 0, sizeof(s));
              for ( j = 0; j < V_Game.racesNum; ++j )
              {
                jj = j;
                if ( !V_Game.races[jj].Unknown_03 )
                {
                  PlanetsNum_sub_402E0 = Q_Race_GetPlanetsNum_sub_402E0(&V_Game.races[jj]);
                  s[j] = PlanetsNum_sub_402E0;
                  if ( v28 < PlanetsNum_sub_402E0 && (j == V_RaceIndex || V_Game.races[V_RaceIndex].Unknown_1C0[j]) )
                  {
                    v29 = j;
                    v28 = s[j];
                  }
                }
              }
              if ( v29 < 0 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\planwin.cpp", 0x1E9);
              }
              pWnd20HW = (P_Wnd20HW)Q_FindWnd_sub_56DA8(&WinMgr, "HELPWINDOW", 0);
              helpTopic = "colonize";
              if ( v29 == V_RaceIndex )
              {
                helpTopic = "maxcolonize";
              }
              Q_ShowHelpTopic_sub_2FCB0(pWnd20HW, "help.txt", helpTopic);
              v65 = s[v29];
              v64 = V_SpecNames[V_Game.races[v29].Unknown_01];
              if ( s[V_RaceIndex] == 1 )
              {
                v34 = 0x20;                            // 32: "y"
              }
              else
              {
                v34 = 0x21;                            // 33: "ies"
              }
              sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v34);
              v36 = pWnd20HW;
              sprintf(
                v66,
                *(const char **)&pWnd20HW->Unknown_C95[5],
                V_SpecNames[V_Game.races[V_RaceIndex].Unknown_01],
                s[V_RaceIndex],
                sub_1CEA8,
                v64,
                v65);
              v37 = 0;
              v38 = *(_DWORD *)&v36->Unknown_C95[5];
              v39 = 0;
              do
              {
                v40 = v66[2 * v37];
                *(_BYTE *)(v38 + 2 * v39) = v40;
                if ( !v40 )
                {
                  break;
                }
                v41 = v66[2 * v37 + 1];
                *(_BYTE *)(v38 + 2 * v39 + 1) = v41;
                ++v37;
                ++v39;
              }
              while ( v41 );
              *(_WORD *)&pWnd20HW->Unknown_C91[0].Unknown_04[1] = 0x1D;
              *(_WORD *)&pWnd20HW->Unknown_C91[0].Unknown_04[3] = V_Game.pCurPlanet->size + 5 * V_Game.pCurPlanet->type;
              v42 = pWnd20HW;
              sprintf(v66, *(const char **)&pWnd20HW->Unknown_C91[1].Unknown_04[5], V_Game.pCurPlanet->name);
              v43 = 0;
              v44 = *(_DWORD *)&v42->Unknown_C91[1].Unknown_04[5];
              v45 = 0;
              do
              {
                v46 = v66[2 * v43];
                *(_BYTE *)(v44 + 2 * v45) = v46;
                if ( !v46 )
                {
                  break;
                }
                v47 = v66[2 * v43 + 1];
                *(_BYTE *)(v44 + 2 * v45 + 1) = v47;
                ++v43;
                ++v45;
              }
              while ( v47 );
              sub_56B60(&WinMgr, 5, 0, 0);
              a1->Unknown_AB[0] = 0xFF;
            }
            else
            {
              v48 = sub_34B0C(V_Game.pCurPlanet, *(unsigned __int16 *)&a1->Unknown_AB[3], v20, 2u);
              if ( a1->Unknown_AB[0] == 0x17 && v48 == 0xFFFFFFFF )
              {
                *(_WORD *)&a1->Unknown_AB[5] = *(_WORD *)&a1->Unknown_AB[3];
              }
              a1->Unknown_AB[0] = 0xFF;
            }
          }
        }
      }
      ((void (*)(void))a1->a2.procs->proc3)();
    }
  }
  else if ( (unsigned __int16)v76 <= 5u )
  {
    v8 = a1;
    a1->Unknown_AB[0] = 0xFF;
    v9 = v8->a2.procs;
    *(_WORD *)&v8->Unknown_AB[3] = 0xFFFF;
    ((void (*)(void))v9->proc4)();
  }
  else
  {
    sub_567BC(&WinMgr, a1->a2.a1.index, 8);
    if ( (a1->a2.a1._mouseFocus & a1->a2.a1.i & a1->a2.a1.j) == 0xFFFFFFFF )
    {
      ((void (__fastcall *)(P_Wnd20HW, _DWORD))a1->a2.procs->proc4)(a1, 0);
    }
  }
}
// 37B38: conditional instruction was optimized away because ch.1!=FF
// 96850: using guessed type char *off_96850[5];
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// 10467C: using guessed type int dword_10467C;
// 37568: using guessed type int s[7];
// 37568: using guessed type char var_118[200];

//----- (000384B0) --------------------------------------------------------
void __fastcall sub_384B0(int a1)
{
  int v2; // eax
  void *ShapeTable_sub_1B084; // eax
  void *v4; // eax
  void *v5; // eax
  char v6; // ah
  int v7; // ebx
  unsigned int v8; // eax
  unsigned __int8 *pUnknown_10; // edx
  int v10; // kr04_4
  unsigned __int16 v11; // di
  int v12; // esi
  int v13; // eax
  LONG v14; // ebx
  LONG v15; // ecx
  int v16; // eax
  T_HazeTables *hazeTables; // edx
  T_HazeTables *v18; // eax
  int v19; // esi
  int v20; // eax
  LONG v21; // edx
  LONG v22; // ebx
  int v23; // eax
  int i; // esi
  int v25; // eax
  LONG v26; // edi
  LONG v27; // edx
  int v28; // eax
  unsigned __int16 v29; // di
  void *v30; // esi
  int v31; // esi
  unsigned __int8 v32; // al
  void *v33; // eax
  int v34; // eax
  unsigned int v35; // eax
  UBYTE raceIndex; // dl
  int v37; // kr0C_4
  LONG v38; // esi
  char *v39; // edx
  unsigned __int16 v40; // si
  int v41; // eax
  LONG v42; // esi
  int v43; // ecx
  int v44; // edi
  unsigned __int8 v45; // al
  void *v46; // eax
  BOOL v47; // edi
  void *v48; // eax
  void *v49; // [esp-24h] [ebp-3B8h]
  void *v50; // [esp-24h] [ebp-3B8h]
  LONG v51; // [esp-20h] [ebp-3B4h]
  LONG v52; // [esp-20h] [ebp-3B4h]
  LONG v53; // [esp-20h] [ebp-3B4h]
  LONG v54; // [esp-1Ch] [ebp-3B0h]
  LONG v55; // [esp-1Ch] [ebp-3B0h]
  LONG v56; // [esp-1Ch] [ebp-3B0h]
  LONG v57; // [esp-18h] [ebp-3ACh]
  LONG v58; // [esp-18h] [ebp-3ACh]
  LONG v59; // [esp-18h] [ebp-3ACh]
  LONG v60; // [esp-Ch] [ebp-3A0h]
  LONG v61; // [esp-Ch] [ebp-3A0h]
  LONG v62; // [esp-8h] [ebp-39Ch]
  LONG v63; // [esp-4h] [ebp-398h]
  UBYTE v64[256]; // [esp+0h] [ebp-394h] BYREF
  UBYTE s[256]; // [esp+100h] [ebp-294h] BYREF
  LONG x0; // [esp+200h] [ebp-194h] BYREF
  LONG y0[5]; // [esp+204h] [ebp-190h]
  int v68; // [esp+218h] [ebp-17Ch]
  int v69; // [esp+21Ch] [ebp-178h]
  LONG v70; // [esp+230h] [ebp-164h]
  int v71; // [esp+234h] [ebp-160h]
  int v72; // [esp+248h] [ebp-14Ch]
  int v73; // [esp+24Ch] [ebp-148h]
  LONG x1; // [esp+260h] [ebp-134h] BYREF
  LONG y1[5]; // [esp+264h] [ebp-130h]
  int v76; // [esp+278h] [ebp-11Ch]
  int v77; // [esp+27Ch] [ebp-118h]
  int v78; // [esp+280h] [ebp-114h]
  LONG v79; // [esp+290h] [ebp-104h]
  int v80; // [esp+294h] [ebp-100h]
  int v81; // [esp+298h] [ebp-FCh]
  int v82; // [esp+2A8h] [ebp-ECh]
  int v83; // [esp+2ACh] [ebp-E8h]
  int v84; // [esp+2B0h] [ebp-E4h]
  PANE v85; // [esp+2C0h] [ebp-D4h] BYREF
  PANE pane; // [esp+2D4h] [ebp-C0h] BYREF
  PANE v87; // [esp+2E8h] [ebp-ACh] BYREF
  PANE v88; // [esp+2FCh] [ebp-98h] BYREF
  int v89; // [esp+310h] [ebp-84h]
  int v90; // [esp+314h] [ebp-80h]
  int v91; // [esp+318h] [ebp-7Ch]
  int v92; // [esp+31Ch] [ebp-78h]
  int v93; // [esp+320h] [ebp-74h]
  LONG v94; // [esp+324h] [ebp-70h]
  int v95; // [esp+328h] [ebp-6Ch]
  void *shape_table; // [esp+32Ch] [ebp-68h]
  unsigned __int16 v97[2]; // [esp+330h] [ebp-64h]
  int v98; // [esp+334h] [ebp-60h]
  int v99; // [esp+338h] [ebp-5Ch]
  int v100; // [esp+33Ch] [ebp-58h]
  LONG shape_number; // [esp+340h] [ebp-54h]
  int v102; // [esp+344h] [ebp-50h]
  LONG v103; // [esp+348h] [ebp-4Ch]
  unsigned __int8 *v104; // [esp+34Ch] [ebp-48h]
  int v105; // [esp+350h] [ebp-44h]
  int v106; // [esp+354h] [ebp-40h]
  int v107; // [esp+358h] [ebp-3Ch]
  LONG hotX; // [esp+35Ch] [ebp-38h]
  int v109; // [esp+360h] [ebp-34h]
  int v110; // [esp+364h] [ebp-30h]
  int v111; // [esp+368h] [ebp-2Ch] BYREF
  unsigned int v112; // [esp+36Ch] [ebp-28h]
  int v113; // [esp+370h] [ebp-24h]
  int v114; // [esp+374h] [ebp-20h]
  LONG v115; // [esp+378h] [ebp-1Ch] BYREF
  unsigned __int8 v116; // [esp+37Ch] [ebp-18h]

  shape_number = V_Game.pCurPlanet->size;
  LOWORD(v2) = V_Game.pCurPlanet->type;
  v113 = (unsigned __int16)word_FFEF8;
  v2 = (unsigned __int16)v2;
  LOWORD(v2) = *(_WORD *)(a1 + 2 * (unsigned __int16)v2 + 0x175);
  v111 = v2;
  if ( *(__int16 *)(a1 + 0x1E) != 0xFFFFFFFF )
  {
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v113);
    VFX_shape_draw((PANE *)(a1 + 4), ShapeTable_sub_1B084, 4, 7, 0x73);
    if ( (*(_BYTE *)(a1 + 0x18B) & 4) != 0 )
    {
      v4 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v111);
      VFX_shape_draw((PANE *)(a1 + 4), v4, shape_number, 0x198, 0x128);
    }
    v60 = *(__int16 *)(a1 + 0x1E);
    v5 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v113);
    VFX_shape_draw((PANE *)(a1 + 4), v5, v60, 0, 0);
    sub_552CC(&WinMgr, (PANE *)(a1 + 4));
  }
  v88 = *(PANE *)(a1 + 4);
  v6 = *(_BYTE *)(a1 + 0xAB);
  v112 = 0xFFFF;
  if ( v6 != (char)0xFF )
  {
    v112 = 0xFFFE;
    v7 = *(unsigned __int16 *)(a1 + 0xAC);
    if ( (unsigned __int16)v7 != 0xFFFF && *((_BYTE *)V_Game.pCurPlanet->pUnknown_10 + 4 * v7 + 1) == 0xFF )
    {
      v8 = sub_34368(V_Game.pCurPlanet, *(_BYTE *)(a1 + 0xAB), v7);
      if ( v8 )
      {
        LOWORD(v8) = *(_WORD *)(a1 + 0xAC);
        v112 = v8;
      }
    }
  }
  pUnknown_10 = (unsigned __int8 *)V_Game.pCurPlanet->pUnknown_10;
  v115 = 0xFFFF;
  v104 = pUnknown_10;
  LOBYTE(pUnknown_10) = V_Game.pCurPlanet->raceIndex;
  *(_DWORD *)v97 = 0;
  if ( (_BYTE)pUnknown_10 == V_RaceIndex || sub_35930(V_Game.pCurPlanet, 0xB) == 0xFFFF )
  {
    v106 = 0x6E;
    v93 = 0x19A;
    v107 = 0xF * shape_number;
    v10 = 0;
    do
    {
      v91 = *(&V_PlanetCfg.room1[0].a0 + v107);
      v100 = v93;
      v95 = v107;
      v105 = v106;
      while ( *(&V_PlanetCfg.room1[0].a0 + v95) + *(&V_PlanetCfg.room2[0].a0 + v95) > v91 )
      {
        x1 = 0x22 * v91 + v100;
        v76 = x1 + 0x22;
        v79 = x1;
        v82 = x1 - 0x22;
        y1[0] = 0x11 * v91 + v105;
        v77 = y1[0] + 0x11;
        v80 = y1[0] + 0x22;
        v83 = y1[0] + 0x11;
        v84 = 0x960000;
        v81 = 0x960000;
        v78 = 0x960000;
        y1[1] = 0x960000;
        HIWORD(v34) = HIWORD(v104);
        v116 = v104[1];
        LOWORD(v34) = *v104;
        v114 = v34;
        v89 = dword_96864[0];
        v90 = dword_96864[1];
        v35 = sub_34368(V_Game.pCurPlanet, 0xFFu, v97[0]);
        if ( *(unsigned __int16 *)(a1 + 0xAC) == *(_DWORD *)v97 && *(_BYTE *)(a1 + 0xAB) == 0xFF && v116 == 0xFF && v35 == 0xFFFFFFFF )
        {
          sub_61800(&V_Type6_stru_D8654.pane.window, 4, (int)&x1);
          goto LABEL_34;
        }
        if ( (*(_BYTE *)(a1 + 0x18B) & 1) != 0 )
        {
          v11 = 0xC;
          v110 = 0xD;
          if ( !(_WORD)v114 )
          {
            v110 = 7;
            v11 = 0;
          }
          switch ( (unsigned __int16)v114 )
          {
            case 2u:
              v11 = 0x75;
              v110 = 8;
              break;
            case 3u:
              v11 = 0x92;
              v110 = 9;
              break;
            case 4u:
              v11 = 0xFF;
              v110 = 0xA;
              break;
          }
          if ( v35 == 0xFFFFFFFF )
          {
            x0 = x1;
            y0[0] = y1[0] + 1;
            v68 = v76 - 2;
            v69 = v77;
            v70 = v79;
            v71 = v80 - 1;
            v72 = v82 + 2;
            v12 = 0;
            v73 = v83;
            do
            {
              v13 = 6 * *((char *)&v90 + v12);
              v14 = y0[v13];
              v15 = y0[v13 - 1];
              v16 = 6 * *((char *)&v89 + v12++);
              VFX_line_draw(&V_Type6_stru_D8654.pane, y0[v16 - 1], y0[v16], v15, v14, 0, v11);
            }
            while ( v12 < 4 );
            if ( (_WORD)v110 )
            {
              hazeTables = V_Type6_stru_D8654.hazeTables;
              v18 = (T_HazeTables *)((unsigned __int16)v110 << 8);
LABEL_33:
              sub_62DA5((WINDOW *)&V_Type6_stru_D8654.pane, 4, (int)&x0, (int)v18 + (_DWORD)hazeTables);
            }
          }
          else
          {
            x0 = x1;
            y0[0] = y1[0] + 0xE;
            v68 = v76 - 0x1C;
            v69 = v77;
            v70 = v79;
            v71 = v80 - 0xE;
            v72 = v82 + 0x1C;
            v19 = 0;
            v73 = v83;
            do
            {
              v20 = 6 * *((char *)&v90 + v19);
              v21 = y0[v20];
              v22 = y0[v20 - 1];
              v23 = 6 * *((char *)&v89 + v19++);
              VFX_line_draw(&V_Type6_stru_D8654.pane, y0[v23 - 1], y0[v23], v22, v21, 0, v11);
            }
            while ( v19 < 4 );
            if ( (_WORD)v110 )
            {
              v18 = V_Type6_stru_D8654.hazeTables;
              hazeTables = (T_HazeTables *)((unsigned __int16)v110 << 8);
              goto LABEL_33;
            }
          }
        }
LABEL_34:
        if ( *(unsigned __int16 *)(a1 + 0xAC) == *(_DWORD *)v97 && *(_BYTE *)(a1 + 0xAB) == 0xFF && v116 == 0xFF )
        {
          for ( i = 0; i < 4; ++i )
          {
            v25 = 6 * *((char *)&v90 + i);
            v26 = y1[v25];
            v27 = y1[v25 - 1];
            v28 = 6 * *((char *)&v89 + i);
            VFX_line_draw(&V_Type6_stru_D8654.pane, y1[v28 - 1], y1[v28], v27, v26, 0, 0x96);
          }
        }
        if ( v116 == 0xFF && (v114 & 8) == 0 )
        {
          if ( (unsigned __int16)v112 == *(_DWORD *)v97 )
          {
            sub_39390(a1, *(_BYTE *)(a1 + 0xAB), (__int16 *)&v111, &v115);
            v63 = y1[0];
            v62 = x1;
            v61 = (unsigned __int16)v115;
            v33 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v111);
            VFX_shape_draw(&V_Type6_stru_D8654.pane, v33, v61, v62, v63);
          }
        }
        else
        {
          v29 = v97[0];
          sub_393F4(a1, v97[0], &v111, &v115);
          v30 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v111);
          shape_table = v30;
          if ( V_Game.pCurPlanet->word52 == *(_DWORD *)v97 )
          {
            sub_61800(&V_Type6_stru_D8654.pane.window, 4, (int)&x1);
            v31 = 0x22 * V_Game.pCurPlanet->buildingProgress;
            v109 = v31 / (unsigned __int16)Q_GetPlanetItemCost_sub_3583C(V_Game.pCurPlanet, v29, 0xFFu);
            v32 = 0xF2;
            if ( *(unsigned __int16 *)(a1 + 0xAC) == *(_DWORD *)v97 )
            {
              v32 = 0x96;
            }
            memset(s, v32, sizeof(s));
            VFX_shape_lookaside(s);
            VFX_shape_translate_draw(&V_Type6_stru_D8654.pane, shape_table, (unsigned __int16)v115, x1, y1[0]);
            pane = V_Type6_stru_D8654.pane;
            pane.y0 = y1[0] + 0x22 - v109;
            if ( *(unsigned __int16 *)(a1 + 0xAC) == *(_DWORD *)v97 )
            {
              VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[0x15]);
              VFX_shape_translate_draw(&pane, shape_table, (unsigned __int16)v115, x1, y1[0] - pane.y0);
            }
            else
            {
              VFX_shape_draw(&pane, shape_table, (unsigned __int16)v115, x1, y1[0] - pane.y0);
            }
          }
          else if ( *(unsigned __int16 *)(a1 + 0xAC) == *(_DWORD *)v97 )
          {
            VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[0x15]);
            VFX_shape_translate_draw(&V_Type6_stru_D8654.pane, v30, (unsigned __int16)v115, x1, y1[0]);
          }
          else
          {
            VFX_shape_draw(&V_Type6_stru_D8654.pane, v30, (unsigned __int16)v115, x1, y1[0]);
          }
        }
        ++v91;
        ++*(_DWORD *)v97;
        v104 += 4;
      }
      v93 -= 0x22;
      ++v107;
      ++v10;
    }
    while ( v106 != 0x16D );
  }
  v94 = 0xD;
  raceIndex = V_Game.pCurPlanet->raceIndex;
  v103 = 0x77;
  v98 = 0;
  if ( raceIndex != V_RaceIndex && sub_35930(V_Game.pCurPlanet, 0x19) != 0xFFFF )
  {
    v98 = 0xFFFFFFFF;
  }
  *(_DWORD *)v97 = V_Game.pCurPlanet->word18;
  v92 = 4 * *(_DWORD *)v97;
  hotX = v94 + 0x23;
  v37 = 0;
  while ( V_Game.pCurPlanet->word1A > *(int *)v97 )
  {
    v39 = (char *)V_Game.pCurPlanet->pUnknown_10 + v92;
    v99 = 0;
    v40 = (unsigned __int8)v39[1];
    if ( v39[1] == 0x17 && Q_PLANET_CPP_GetShip_sub_35A70(V_Game.pCurPlanet, v97[0])->raceIndex == V_RaceIndex )
    {
      v99 = 0xFFFFFFFF;
    }
    if ( *(unsigned __int16 *)(a1 + 0xAC) == *(_DWORD *)v97 )
    {
      HIWORD(v41) = v97[1];
      LOWORD(v41) = v40;
      if ( v41 == 0xFF && !v98 && *(_BYTE *)(a1 + 0xAB) == 0xFF )
      {
        v88.x0 = v94;
        v88.y0 = v103;
        v88.x1 = v94 + 0x46;
        v88.y1 = v103 + 0x46;
        sub_2BB74(&v88, 1, 1, 0x45, 0x45, 0x96u, 0);
      }
    }
    v102 = v40;
    if ( v40 == 0xFF )
    {
      if ( (unsigned __int16)v112 == *(_DWORD *)v97 )
      {
        v38 = (LONG)sub_10000;
        if ( *(_BYTE *)(a1 + 0xAB) == 0x17 )
        {
          v38 = 0x8000;
        }
        sub_39390(a1, *(_BYTE *)(a1 + 0xAB), (__int16 *)&v111, &v115);
        v57 = v103 + 0x23;
        v54 = hotX;
        v51 = (unsigned __int16)v115;
        v49 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v111);
        VFX_shape_transform(&V_Type6_stru_D8654.pane, v49, v51, v54, v57, V_BigBuffer, 0, v38, v38, 0);
      }
    }
    else
    {
      sub_393F4(a1, v97[0], &v111, &v115);
      v85 = *(PANE *)(a1 + 4);
      v42 = (LONG)sub_10000;
      if ( v102 == 0x17 )
      {
        v42 = 0x8000;
      }
      if ( V_Game.pCurPlanet->word52 == *(_DWORD *)v97 )
      {
        v43 = 0x46 * V_Game.pCurPlanet->buildingProgress;
        v44 = v43 / (unsigned __int16)Q_GetPlanetItemCost_sub_3583C(V_Game.pCurPlanet, v97[0], 0xFFu);
        v45 = 0xF2;
        if ( *(unsigned __int16 *)(a1 + 0xAC) == *(_DWORD *)v97 )
        {
          v45 = 0x96;
        }
        memset(v64, v45, sizeof(v64));
        if ( !v98 || v99 == 0xFFFFFFFF )
        {
          VFX_shape_lookaside(v64);
          v58 = v103 + 0x23;
          v55 = hotX;
          v52 = (unsigned __int16)v115;
          v46 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v111);
          VFX_shape_transform(&V_Type6_stru_D8654.pane, v46, v52, v55, v58, V_BigBuffer, 0, v42, v42, 1);
        }
        v85.y0 = v103 + 0x46 - v44;
      }
      if ( !v98 || v99 == 0xFFFFFFFF )
      {
        v47 = *(unsigned __int16 *)(a1 + 0xAC) == *(_DWORD *)v97;
        VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[0x15]);
        v59 = v103 + 0x23 - v85.y0;
        v56 = hotX;
        v53 = (unsigned __int16)v115;
        v50 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v111);
        VFX_shape_transform(&v85, v50, v53, v56, v59, V_BigBuffer, 0, v42, v42, v47);
      }
    }
    ++v37;
    if ( (*(_DWORD *)v97 - V_Game.pCurPlanet->word18) % 5 == 4 )
    {
      v103 = 0x77;
      hotX += 0x46;
      v94 += 0x46;
    }
    v92 += 4;
    ++*(_DWORD *)v97;
  }
  if ( Q_FindWnd_sub_56DA8(&WinMgr, "PLANLIST", 0)->a1.i == 0xFFFFFFFF )
  {
    v87.window = (WINDOW *)&V_Type6_stru_D8654;
    v87.x0 = 0x70;
    v87.y0 = 0x70;
    v87.y1 = 0x1AC;
    v87.x1 = 0x210;
    v48 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v113);
    VFX_shape_draw(&v87, v48, 5, 0, 0);
  }
  sub_2D218((_DWORD *)a1);
}
// 10000: using guessed type void __noreturn sub_10000();
// 96864: using guessed type _DWORD dword_96864[2];
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// 384B0: using guessed type _DWORD var_D4[2];

//----- (00039390) --------------------------------------------------------
char __fastcall sub_39390(int a1, unsigned __int8 a2, __int16 *a3, _WORD *a4)
{
  __int16 v4; // ax

  if ( a2 >= 0x27u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planwin.cpp", 0x461);
  }
  *a3 = word_FFEDC;
  *a4 = 0;
  LOBYTE(v4) = a2;
  *a4 = a2;
  if ( a2 == 0x17 )
  {
    v4 = word_FFEBC[V_Game.pCurPlanet->raceIndex];
    *a3 = v4;
    *a4 = 0;
  }
  return v4;
}
// 393C3: conditional instruction was optimized away because dl.1<27u
// FFEBC: using guessed type __int16 word_FFEBC[7];

//----- (000393F4) --------------------------------------------------------
__int16 __fastcall sub_393F4(int a1, unsigned __int16 a2, _WORD *a3, _WORD *a4)
{
  P_Planet pCurPlanet; // eax
  _BYTE *v6; // eax
  __int16 v7; // dx
  __int16 result; // ax
  P_Ship Ship_sub_35A70; // esi

  if ( a2 >= V_Game.pCurPlanet->word1A )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planwin.cpp", 0x476);
  }
  *a3 = word_FFEDC;
  pCurPlanet = V_Game.pCurPlanet;
  *a4 = 0;
  v6 = (char *)pCurPlanet->pUnknown_10 + 4 * a2;
  v7 = (unsigned __int8)v6[1];
  if ( (unsigned __int8)v7 == 0xFF )
  {
    if ( (*v6 & 8) != 0 )
    {
      *a4 = 0x27;
    }
  }
  else
  {
    *a4 = v7;
  }
  result = v7;
  if ( v7 == 0x17 )
  {
    Ship_sub_35A70 = Q_PLANET_CPP_GetShip_sub_35A70(V_Game.pCurPlanet, a2);
    *a3 = word_FFEBC[Ship_sub_35A70->raceIndex];
    if ( Ship_sub_35A70->hullSize < 0 || Ship_sub_35A70->hullSize >= 4 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\planwin.cpp", 0x48A);
    }
    result = Ship_sub_35A70->hullSize;
    *a4 = result;
  }
  return result;
}
// FFEBC: using guessed type __int16 word_FFEBC[7];

//----- (000394BC) --------------------------------------------------------
char *__fastcall sub_394BC(int a1)
{
  T_TypeA2 *Wnd_sub_56DA8; // esi
  char *result; // eax
  int magic12345678; // edx
  int v5; // ebp
  T_Ship *Ship_sub_35A70; // eax
  T_Planet *pCurPlanet; // eax
  int v8; // edx

  Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&WinMgr, "SHIPDESSCREEN", 0);
  dword_10467C = Wnd_sub_56DA8[1].a1.magic12345678 + 0x34;
  result = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x22);   // 34: "Name Your Ship"
  magic12345678 = Wnd_sub_56DA8[1].a1.magic12345678;
  dword_104680 = result;
  if ( magic12345678 )
  {
    if ( *(_DWORD *)&Wnd_sub_56DA8[1].a1.shapeFrame == 0xFFFFFFFF )
    {
      dword_104680 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x23);// 35: "Rename Your Ship?"
      pCurPlanet = V_Game.pCurPlanet;
      *((_BYTE *)V_Game.pCurPlanet->pUnknown_10 + 4 * *(unsigned __int16 *)(a1 + 0xB0) + 2) &= ~1u;
      sub_34B0C(pCurPlanet, *(unsigned __int16 *)(a1 + 0xB0), 0x17u, 3u);
      v8 = sub_4EE00((int)Wnd_sub_56DA8);
      result = (char *)V_Game.pCurPlanet;
      V_Game.pCurPlanet->Unknown_77 = v8;
      *(_BYTE *)(Wnd_sub_56DA8[1].a1.magic12345678 + 0x58) = 2;
      *(_DWORD *)(Wnd_sub_56DA8[1].a1.magic12345678 + 0x59) = result;
    }
  }
  else
  {
    v5 = *(_DWORD *)&Wnd_sub_56DA8[1].a1.shapeFrame;
    dword_10467C = 0;
    if ( !v5 )
    {
      Ship_sub_35A70 = Q_PLANET_CPP_GetShip_sub_35A70(V_Game.pCurPlanet, *(_WORD *)(a1 + 0xB0));
      sub_49940(Ship_sub_35A70);
      result = (char *)sub_34B0C(V_Game.pCurPlanet, *(unsigned __int16 *)(a1 + 0xB0), 0xFFu, 1u);
    }
  }
  *(_WORD *)(a1 + 0xB0) = 0xFFFF;
  return result;
}
// 10467C: using guessed type int dword_10467C;

//----- (000395C4) --------------------------------------------------------
int __fastcall sub_395C4(int a1, unsigned int count, int a3)
{
  void *v5; // edx

  v5 = (void *)(a1 + 0x18B);
  if ( a3 == 0xFFFFFFFF )
  {
    return Q_ReadFile_sub_1BF94((P_FileInfo)count, v5, 1u);
  }
  else
  {
    return Q_CFILE_CPP_dos_write_sub_1C098((int *)count, v5, 1u);
  }
}

//----- (000395EC) --------------------------------------------------------
void __fastcall __spoils<> Q_A2_sub_395EC(P_TypeA2 result)
{
  Q_A2Ctor_sub_2C830(result);
  result->procs = (P_Procs)off_95F6C;
}
// 95F6C: using guessed type int (*off_95F6C[5])();

//----- (000395FC) --------------------------------------------------------
T_TypeA2 *__fastcall sub_395FC(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_95F44);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95F6C;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95F6C: using guessed type int (*off_95F6C[5])();

//----- (00039644) --------------------------------------------------------
unsigned int __fastcall sub_39644(T_TypeA2 *a1, __int16 a2, LONG a3, LONG a4)
{
  T_TypeA2 *v5; // eax
  T_TypeA2 *Wnd_sub_56DA8; // [esp+0h] [ebp-10h]

  Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&WinMgr, "PLANLIST", 0);
  v5 = Q_FindWnd_sub_56DA8(&WinMgr, "PLSQUARE", 0);
  if ( (Wnd_sub_56DA8->a1.i || v5->a1.i) && a2 != 0xF && a2 != 0xE )
  {
    return 0;
  }
  if ( (unsigned __int16)a2 < 6u )
  {
    return sub_2F424(a1, a2, a3, a4);
  }
  if ( (unsigned __int16)a2 <= 6u )
  {
    ((void (__fastcall *)(T_TypeA2 *, int))a1->procs->proc4)(a1, 2);
  }
  else
  {
    if ( a2 != 7 )
    {
      return sub_2F424(a1, a2, a3, a4);
    }
    ((void (__fastcall *)(T_TypeA2 *, int))a1->procs->proc4)(a1, 1);
  }
  return 0;
}

//----- (000396F0) --------------------------------------------------------
void __fastcall sub_396F0(int a1, int a2)
{
  T_TypeA2 *Wnd_sub_56DA8; // esi
  T_TypeA2 *v3; // eax
  T_TypeA2 *v4; // ebp
  int v5; // eax
  LONG v6; // eax
  void *ShapeTable_sub_1B084; // eax
  LONG v8; // eax
  LONG v9; // ebp
  int v10; // esi
  int v11; // kr04_4
  void *v12; // eax
  LONG v13; // eax
  char *sub_1CEA8; // eax
  unsigned __int16 word52; // bx
  unsigned __int8 magic12345678; // cl
  char *v17; // esi
  int v18; // kr0C_4
  int v19; // kr1C_4
  char v20; // al
  char v21; // al
  UBYTE buildingPlanetItemIndex; // ch
  int DaysToCompletePlanetItem_sub_358BC; // esi
  UWORD flags; // ax
  int v25; // eax
  char *v26; // eax
  char *v27; // kr10_4
  int v28; // kr14_4
  int v29; // kr24_4
  char v30; // al
  char v31; // al
  LONG v32; // edi
  unsigned __int16 v33; // bx
  PANE *v34; // esi
  void *v35; // eax
  void *v36; // eax
  const char *v37; // ecx
  int v38; // ebx
  int v39; // edi
  int v40; // ecx
  int v41; // ebp
  int v42; // esi
  LONG v43; // edi
  LONG v44; // ebp
  int i; // esi
  LONG v46; // ecx
  LONG v47; // ebx
  LONG v48; // edx
  LONG v49; // [esp-10h] [ebp-A0h]
  LONG v50; // [esp-Ch] [ebp-9Ch]
  LONG v51; // [esp-8h] [ebp-98h]
  char *v52; // [esp+Ch] [ebp-84h]
  char s[60]; // [esp+10h] [ebp-80h] BYREF
  LONG hotX; // [esp+4Ch] [ebp-44h] BYREF
  LONG hotY; // [esp+50h] [ebp-40h] BYREF
  char *name; // [esp+54h] [ebp-3Ch]
  int v57; // [esp+58h] [ebp-38h]
  int v58; // [esp+5Ch] [ebp-34h]
  int v59; // [esp+60h] [ebp-30h]
  PANE *pane; // [esp+64h] [ebp-2Ch]
  PANE *v61; // [esp+68h] [ebp-28h]
  LONG v62; // [esp+6Ch] [ebp-24h]
  int v63; // [esp+70h] [ebp-20h] BYREF
  LONG shape_number; // [esp+74h] [ebp-1Ch] BYREF
  unsigned __int8 v65; // [esp+78h] [ebp-18h]

  v59 = a1;
  v57 = 0;
  if ( a2 != 2 && (*(_DWORD *)WinMgr.z1aa == *(_DWORD *)(a1 + 0x41) || a2 == 1) )
  {
    v57 = 0xFFFFFFFF;
  }
  Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&WinMgr, "PLANLIST", 0);
  v3 = Q_FindWnd_sub_56DA8(&WinMgr, "PLSQUARE", 0);
  if ( Wnd_sub_56DA8->a1.i || v3->a1.i )
  {
    v57 = 0;
  }
  v58 = *(_DWORD *)(v59 + 0x47);
  if ( v58 == 4 )
  {
    v58 = 3;
  }
  if ( *(_WORD *)(v59 + 0x45) == 0x33 )
  {
    v58 = 4;
  }
  v4 = Q_FindWnd_sub_56DA8(&WinMgr, "PLANETALLOC", 0);
  v63 = 0xFFFF;
  shape_number = 0xFFFF;
  VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[0x15]);
  if ( v58 <= 2 )
  {
    VFX_pane_wipe((PANE *)(v59 + 4), 0);
  }
  HIWORD(v5) = HIWORD(v58);
  switch ( v58 )
  {
    case 0:
      LOWORD(v5) = word_FFEEC;
      v63 = v5;
      v62 = (int)pow((double)V_Game.pCurPlanet->research, 0.75);
      shape_number = v62;
      if ( (unsigned __int16)v62 > 0x14u )
      {
        shape_number = 0x14;
      }
      goto LABEL_23;
    case 1:
      LOWORD(v5) = word_FFEEE;
      v63 = v5;
      v62 = (int)pow((double)V_Game.pCurPlanet->industry, 0.75);
      shape_number = v62;
      if ( (unsigned __int16)v62 > 0x14u )
      {
        shape_number = 0x14;
      }
      goto LABEL_23;
    case 2:
      LOWORD(v5) = word_FFEF0;
      v63 = v5;
      HIWORD(v6) = HIWORD(V_Game.pCurPlanet);
      LOWORD(v6) = V_Game.pCurPlanet->prosperity;
      shape_number = v6;
      if ( (unsigned __int16)v6 > 0x14u )
      {
        shape_number = 0x14;
      }
LABEL_23:
      ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v63);
      VFX_shape_draw((PANE *)(v59 + 4), ShapeTable_sub_1B084, (unsigned __int16)shape_number, 0, 0);
      goto LABEL_66;
    case 3:
      v8 = 0xF2;
      if ( v57 )
      {
        v8 = 0x96;
      }
      v9 = 0;
      v62 = v59 + 4;
      VFX_pane_wipe((PANE *)(v59 + 4), v8);
      shape_number = 1;
      pane = (PANE *)(v59 + 4);
      v10 = 0;
      v11 = 0;
      while ( v10 < V_Game.pCurPlanet->maximumPopulation )
      {
        if ( v10 == (unsigned __int16)V_Game.pCurPlanet->word4C )
        {
          ++shape_number;
        }
        if ( v10 == V_Game.pCurPlanet->word42 )
        {
          ++shape_number;
        }
        v12 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF8);
        VFX_shape_draw(pane, v12, (unsigned __int16)shape_number, 0xA * v11++, v9);
        if ( v10 % 0xA == 9 )
        {
          v9 += 0xA;
        }
        ++v10;
      }
      goto LABEL_66;
    case 4:
      v13 = 0xF2;
      if ( v57 && V_Game.pCurPlanet->raceIndex == V_RaceIndex )
      {
        v13 = 0x96;
      }
      VFX_pane_wipe((PANE *)(v59 + 4), v13);
      v65 = 0xFF;
      qmemcpy(s, &unk_9686C, sizeof(s));
      sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x24);// 36: "No Project"
      word52 = 0xFFFF;
      magic12345678 = v4[1].a1.magic12345678;
      name = sub_1CEA8;
      if ( magic12345678 == 0xFF )
      {
        buildingPlanetItemIndex = V_Game.pCurPlanet->buildingPlanetItemIndex;
        if ( buildingPlanetItemIndex != 0xFF )
        {
          DaysToCompletePlanetItem_sub_358BC = (unsigned __int16)Q_GetDaysToCompletePlanetItem_sub_358BC(V_Game.pCurPlanet);
          flags = V_PlanetItems.item[buildingPlanetItemIndex].flags;
          v65 = buildingPlanetItemIndex;
          if ( (flags & 0x20) == 0 )
          {
            if ( DaysToCompletePlanetItem_sub_358BC == 0xFFFF )
            {
              v27 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x27);// 39: "No Progress"
              v28 = 0;
              v29 = 0;
              do
              {
                v30 = v27[2 * v28];
                s[2 * v29] = v30;
                if ( !v30 )
                {
                  break;
                }
                v31 = v27[2 * v28 + 1];
                s[2 * v29 + 1] = v31;
                ++v28;
                ++v29;
              }
              while ( v31 );
            }
            else
            {
              if ( DaysToCompletePlanetItem_sub_358BC == 1 )
              {
                v25 = 0x1C;                            // 28: ""
              }
              else
              {
                v25 = 0x1D;                            // 29: "s"
              }
              v52 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v25);
              v26 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x26);// 38: "%d day%s until completion"
              sprintf(s, v26, DaysToCompletePlanetItem_sub_358BC, v52);
            }
          }
          if ( V_Game.pCurPlanet->buildingPlanetItemIndex != 0x23 )
          {
            word52 = V_Game.pCurPlanet->word52;
          }
        }
      }
      else
      {
        v17 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x25);// 37: "Pick a Location"
        v65 = magic12345678;
        v18 = 0;
        v19 = 0;
        do
        {
          v20 = v17[2 * v18];
          s[2 * v19] = v20;
          if ( !v20 )
          {
            break;
          }
          v21 = v17[2 * v18 + 1];
          s[2 * v19 + 1] = v21;
          ++v18;
          ++v19;
        }
        while ( v21 );
      }
      if ( v65 == 0xFF )
      {
        if ( V_Game.pCurPlanet->word42 != V_Game.pCurPlanet->word4C )
        {
          goto LABEL_65;
        }
        v38 = 0x19;
        v34 = (PANE *)(v59 + 4);
        v37 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x28);// 40: "(No Free Population)"
      }
      else
      {
        if ( word52 == 0xFFFF )
        {
          sub_39390((int)v4, v65, (__int16 *)&v63, &shape_number);
        }
        else
        {
          sub_393F4((int)v4, word52, &v63, &shape_number);
        }
        v32 = (LONG)sub_10000;
        if ( v65 == 0x17 )
        {
          v32 = 0x8000;
        }
        v33 = shape_number;
        name = V_PlanetItems.item[v65].name;
        v34 = (PANE *)(v59 + 4);
        v35 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v63);
        Q_GSYSTEM_CPP_sub_2BC40(v34, v35, v33, &hotX, &hotY);
        v51 = hotY;
        v50 = hotX;
        v49 = (unsigned __int16)shape_number;
        v36 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v63);
        VFX_shape_transform(v34, v36, v49, v50, v51, V_BigBuffer, 0, v32, v32, 0);
        v37 = s;
        v38 = 0x50;
      }
      WinMgr.LargeFont.pane = *v34;
      sub_2B8A8(&WinMgr.LargeFont, 0, v38, v37, 2, 0xFFFFFFFF, 0xFF, 0);
LABEL_65:
      WinMgr.LargeFont.pane = *(PANE *)(v59 + 4);
      sub_2B8A8(&WinMgr.LargeFont, 0, 0xA, name, 2, 0xFFFFFFFF, 0xFF, 0);
LABEL_66:
      if ( v58 <= 2 && v57 && V_RaceIndex == V_Game.pCurPlanet->raceIndex )
      {
        v39 = *(_DWORD *)(v59 + 0x10);
        v40 = *(_DWORD *)(v59 + 8);
        v41 = *(_DWORD *)(v59 + 0x14);
        v42 = *(_DWORD *)(v59 + 0xC);
        v61 = (PANE *)(v59 + 4);
        v43 = v39 - v40;
        v44 = v41 - v42;
        for ( i = 0; i < 3; ++i )
        {
          v46 = v43;
          v47 = i;
          v48 = i;
          --v43;
          sub_2BB74(v61, v48, v47, v46, v44--, 0x96u, 0);
        }
      }
      sub_552CC(&WinMgr, (PANE *)(v59 + 4));
      return;
    default:
      goto LABEL_66;
  }
}
// 10000: using guessed type void __noreturn sub_10000();
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEEC: using guessed type __int16 word_FFEEC;
// FFEEE: using guessed type __int16 word_FFEEE;
// FFEF0: using guessed type __int16 word_FFEF0;
// 396F0: using guessed type char s[60];

//----- (00039D80) --------------------------------------------------------
void __fastcall __spoils<> Q_Wnd14PSWCtor_sub_39D80(P_Wnd14PSW a1)
{
  Q_A2Ctor_sub_2C830(&a1->a);
  a1->a.procs = (P_Procs)off_95FB8;
  Q_CachePlanetTexts_sub_39DE0();
}
// 95FB8: using guessed type int (*off_95FB8[5])();

//----- (00039D9C) --------------------------------------------------------
T_TypeA2 *__fastcall sub_39D9C(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, &C_Wnd14PSW);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_95FB8;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95FB8: using guessed type int (*off_95FB8[5])();

//----- (00039DE0) --------------------------------------------------------
// Need optimization. Example:
//   jj = 0x2E;                                           // 46: "Husk"
//   for ( j = 0; j != 11; ++j )
//   {
//     dword_10469C[j] = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(jj++);
//   }
void __fastcall Q_CachePlanetTexts_sub_39DE0()
{
  int ii; // ebx
  int i; // kr04_4
  char *txt1; // eax
  int jj; // edx
  int j; // kr0C_4
  char *txt2; // eax
  int kk; // ebx
  int k; // kr14_4
  char *txt3; // eax

  ii = 0x29;                                           // 41: "Tiny"
  for ( i = 0; i != 5; ++i )
  {
    txt1 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(ii++);
    *((_DWORD *)&unk_104684 + i + 1) = txt1;
  }
  jj = 0x2E;                                           // 46: "Husk"
  for ( j = 0; j != 0xB; ++j )
  {
    txt2 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(jj++);
    dword_104688[j + 5] = txt2;
  }
  kk = 0x39;                                           // 57: "Cancel"
  for ( k = 0; k != 8; ++k )
  {
    txt3 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(kk++);
    dword_10469C[k + 11] = txt3;
  }
}

//----- (00039E3C) --------------------------------------------------------
unsigned int __fastcall sub_39E3C(int eax0, __int16 dx0, LONG a3, LONG a4)
{
  int v4; // eax
  char v5; // cl
  P_Wnd20HW v7; // eax
  int v8; // esi
  int v9; // eax
  T_Ship *Ship_sub_35A70; // eax
  T_Ship *v11; // esi
  int v12; // ebx
  int raceIndex; // edx
  int v14; // edi
  int v15; // ebx
  int v16; // edx
  int v17; // edi
  int v18; // ebx
  int v19; // esi
  int v20; // ecx
  int v21; // eax
  int v22; // ecx
  unsigned int v23; // edx
  P_TypeA1 v24; // ecx
  char *v25; // esi
  char *name; // edi
  char v27; // al
  char v28; // al
  int v29; // edi
  int v30; // ebx
  int v31; // edx
  int v32; // eax
  WORD v33; // bx
  int index; // edx
  P_Wnd20HW v35; // edi
  char *sub_1CEA8; // esi
  int v37; // kr04_4
  int v38; // kr18_4
  int v39; // kr1C_4
  char v40; // al
  char v41; // al
  P_TypeA1 v42; // edx
  int v43; // ecx
  int v44; // ebx
  int v45; // ebx
  char *v46; // kr08_4
  int v47; // kr0C_4
  char *v48; // kr20_4
  int v49; // kr24_4
  char v50; // al
  char v51; // al
  int v52; // edi
  P_Wnd20HW v53; // eax
  T_Ship *v54; // eax
  T_Ship *v55; // eax
  MACRO_VFX_BOOL v56; // esi
  char *helptopic; // ebx
  P_Wnd20HW vpWnd20HW; // ecx
  int PlanetsNum_sub_402E0; // edi
  int v60; // eax
  int v61; // eax
  char *v62; // eax
  int v63; // kr14_4
  int v64; // kr28_4
  int v65; // kr2C_4
  char v66; // al
  char v67; // al
  int v68; // [esp-4h] [ebp-144h]
  char *v69; // [esp-4h] [ebp-144h]
  _WORD s[140]; // [esp+0h] [ebp-140h] BYREF
  int param1; // [esp+118h] [ebp-28h]
  int a2; // [esp+11Ch] [ebp-24h] BYREF
  int v73; // [esp+120h] [ebp-20h]
  int param2; // [esp+124h] [ebp-1Ch]
  int v75; // [esp+128h] [ebp-18h]
  int v76; // [esp+12Ch] [ebp-14h]
  P_Wnd20HW a1; // [esp+130h] [ebp-10h]
  unsigned int v78; // [esp+134h] [ebp-Ch]
  _BYTE v79[6]; // [esp+138h] [ebp-8h]
  _BYTE savedregs[12]; // [esp+140h] [ebp+0h]

  a1 = (P_Wnd20HW)eax0;
  *(_WORD *)&v79[4] = dx0;
  param1 = a3;
  param2 = a4;
  v4 = *(unsigned __int16 *)(eax0 + 0xAB);
  v5 = 0xFF;
  if ( (unsigned __int16)v4 != 0xFFFF )
  {
    v5 = *((_BYTE *)V_Game.pCurPlanet->pUnknown_10 + 4 * v4 + 1);
  }
  if ( *(_WORD *)&v79[4] < 0x33u )
  {
    if ( *(_WORD *)&v79[4] >= 4u )
    {
      if ( *(_WORD *)&v79[4] > 5u )
      {
        if ( *(_WORD *)&v79[4] >= 7u )
        {
          if ( *(_WORD *)&v79[4] <= 7u )
          {
            if ( a1->a2.a1.j && a1->a2.a1.i && a1->a2.a1._mouseFocus )
            {
              ((void (*)(void))a1->a2.procs->proc5)();
            }
            return 0xFFFFFFFF;
          }
          else
          {
            if ( *(_WORD *)&v79[4] != 0x32 )
            {
              return sub_2F424(&a1->a2, *(__int16 *)&savedregs[4], param1, param2);
            }
            unk_104684 = param1;
            *(_WORD *)a1->Unknown_AB = param2;
            return 0;
          }
        }
        if ( a1->a2.a1.j && a1->a2.a1.i && a1->a2.a1._mouseFocus )
        {
          ((void (*)(void))a1->a2.procs->proc4)();
        }
      }
      return 0xFFFFFFFF;
    }
    if ( !*(_WORD *)&v79[4] )
    {
      return sub_2F424(&a1->a2, *(__int16 *)&savedregs[4], param1, param2);
    }
    if ( *(_WORD *)&v79[4] <= 1u )
    {
      v7 = a1;
      a1->a2.a1.j = 0xFFFFFFFF;
      v8 = unk_104684;
      v7->a2.a1.i = 0xFFFFFFFF;
      if ( v8 == 3 )
      {
        HIWORD(v9) = 0;
        v75 = 0;
        if ( v5 == (char)0xFF )
        {
          v20 = 0;
          while ( (_BYTE)v20 == 5 || !sub_34368(V_Game.pCurPlanet, v20, *(_WORD *)a1->Unknown_AB) )
          {
            if ( ++v20 >= 0x27 )
            {
              goto LABEL_37;
            }
          }
          v21 = v75 + 1;
          *(_DWORD *)&s[2 * v21 + 0x62] = 0x36;
          v75 = v21;
        }
        else
        {
          if ( v5 == 0x17 )
          {
            LOWORD(v9) = *(_WORD *)a1->Unknown_AB;
            if ( (*((_WORD *)V_Game.pCurPlanet->pUnknown_10 + 2 * v9 + 1) & 1) != 0 )
            {
              Ship_sub_35A70 = Q_PLANET_CPP_GetShip_sub_35A70(V_Game.pCurPlanet, *(_WORD *)a1->Unknown_AB);
              v11 = Ship_sub_35A70;
              if ( !Ship_sub_35A70 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\psqwin.cpp", 0x79);
              }
              if ( sub_4937C(Ship_sub_35A70, 0x47) != 0xFFFFFFFF && V_Game.pCurPlanet->raceIndex == 0xFF )
              {
                v12 = v75 + 1;
                *(_DWORD *)&s[2 * v75 + 0x64] = 0x34;
                v75 = v12;
              }
              if ( sub_4937C(v11, 0x49) != 0xFFFFFFFF )
              {
                raceIndex = V_Game.pCurPlanet->raceIndex;
                if ( raceIndex != 0xFF && (_BYTE)raceIndex != V_RaceIndex )
                {
                  v14 = v75 + 1;
                  *(_DWORD *)&s[2 * v75 + 0x64] = 0x39;
                  v75 = v14;
                }
              }
              *(_DWORD *)&s[2 * v75 + 0x64] = 0x37;
              v15 = v75;
              v16 = sub_35930(V_Game.pCurPlanet, 0x18);
              v75 = v15 + 1;
              if ( (unsigned __int16)v16 != 0xFFFF
                && (*((_WORD *)V_Game.pCurPlanet->pUnknown_10 + 2 * v16 + 1) & 1) != 0
                && V_RaceIndex == V_Game.pCurPlanet->raceIndex )
              {
                v17 = v75 + 1;
                *(_DWORD *)&s[2 * v75 + 0x64] = 0x38;
                v75 = v17;
              }
            }
          }
          if ( v5 != 5 )
          {
            v18 = v75 + 1;
            *(_DWORD *)&s[2 * v75 + 0x64] = 0x35;
            v75 = v18;
          }
          if ( sub_34368(V_Game.pCurPlanet, 0x23u, *(_WORD *)a1->Unknown_AB) )
          {
            v19 = v75 + 1;
            *(_DWORD *)&s[2 * v75 + 0x64] = 0x3A;
            v75 = v19;
          }
        }
LABEL_37:
        *(_DWORD *)v79 = 0xA0;
        v22 = v75 + 1;
        *(_DWORD *)&s[2 * v75 + 0x64] = 0x33;
        v75 = v22;
        if ( v22 > 0 )
        {
          v76 = v22;
          v78 = 0;
          v73 = 4 * v22;
          do
          {
            v23 = v78;
            v24 = (*a1->a2.a1.children)[v78 / 4];
            v25 = (char *)*((_DWORD *)&V_PlanetCfg.room1[4].a8 + *(_DWORD *)&s[v78 / 2 + 0x64]);
            name = v24->name;
            do
            {
              v27 = *v25;
              *name = *v25;
              if ( !v27 )
              {
                break;
              }
              v28 = v25[1];
              v25 += 2;
              name[1] = v28;
              name += 2;
            }
            while ( v28 );
            v29 = v76;
            v24->sendMessage = *(_WORD *)((char *)&s[0x64] + v23);
            v30 = *(_DWORD *)v79;
            v31 = 0x1DF - *(_DWORD *)v79;
            v24->pane.x0 = *(_DWORD *)v79;
            v24->pane.y0 = 0x151;
            v24->pane.y1 = 0x16F;
            *(_DWORD *)v79 = v31 / v29 + v30;
            if ( *(int *)v79 > 0x1DF )
            {
              *(_DWORD *)v79 = 0x1DF;
            }
            v32 = *(_DWORD *)v79;
            v33 = *(_WORD *)&savedregs[4];
            v68 = param2;
            v24->pane.x1 = *(_DWORD *)v79;
            index = v24->index;
            *(_DWORD *)v79 = v32 + 1;
            sub_56D30(&WinMgr, index, v33, param1, v68);
            --v76;
            v78 += 4;
          }
          while ( (int)v78 < v73 );
        }
        if ( v75 == 1 )
        {
          v35 = a1;
          sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1E);// 30: "OK"
          v37 = 0;
          v38 = (int)(*v35->a2.a1.children)[0]->name;
          v39 = 0;
          do
          {
            v40 = sub_1CEA8[2 * v37];
            *(_BYTE *)(v38 + 2 * v39) = v40;
            if ( !v40 )
            {
              break;
            }
            v41 = sub_1CEA8[2 * v37 + 1];
            *(_BYTE *)(v38 + 2 * v39 + 1) = v41;
            ++v37;
            ++v39;
          }
          while ( v41 );
        }
      }
      else
      {
        v42 = (*v7->a2.a1.children)[0];
        v42->pane.x0 = 0xA0;
        v42->pane.y0 = 0x151;
        v43 = param1;
        v42->pane.x1 = 0x1DF;
        v44 = *(_DWORD *)&v79[2];
        v42->pane.y1 = 0x16F;
        v45 = v44 >> 0x10;
        v46 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1E);
        v47 = 0;
        v48 = v42->name;
        v49 = 0;
        do
        {
          v50 = v46[2 * v47];
          v48[2 * v49] = v50;
          if ( !v50 )
          {
            break;
          }
          v51 = v46[2 * v47 + 1];
          v48[2 * v49 + 1] = v51;
          ++v47;
          ++v49;
        }
        while ( v51 );
        v52 = param2;
        v42->sendMessage = 0x33;
        sub_56D30(&WinMgr, v42->index, v45, v43, v52);
      }
      ((void (__fastcall *)(P_Wnd20HW, _DWORD))a1->a2.procs->proc4)(a1, 0);
      return 0;
    }
    else
    {
      if ( *(_WORD *)&v79[4] != 2 )
      {
        return sub_2F424(&a1->a2, *(__int16 *)&savedregs[4], param1, param2);
      }
      sub_2D258(&a1->a2, *(__int16 *)&savedregs[4]);
      v53 = a1;
      a1->a2.a1.j = 0;
      v53->a2.a1.i = 0;
      if ( *(_DWORD *)WinMgr.z1aa == a1->a2.a1.index )
      {
        *(_DWORD *)WinMgr.z1aa = 0xFFFFFFFF;
      }
      sub_567BC(&WinMgr, a1->a2.a1.index, 0xFFFFFFFF);
      sub_564C0(&WinMgr, a1->a2.a1.index, 0xFFFFFFFF);
      return 0;
    }
  }
  else
  {
    if ( *(_WORD *)&v79[4] <= 0x33u )
    {
LABEL_88:
      sub_56D30(&WinMgr, a1->a2.a1.parentIndex, 0x32, 0xA, 0);
      return 0;
    }
    if ( *(_WORD *)&v79[4] < 0x37u )
    {
      if ( *(_WORD *)&v79[4] < 0x35u )
      {
        sub_56D30(&WinMgr, a1->a2.a1.parentIndex, 0x32, 0xC, 0);
        return 0;
      }
      else if ( *(_WORD *)&v79[4] <= 0x35u )
      {
        if ( v5 == 0x17 )
        {
          v54 = Q_PLANET_CPP_GetShip_sub_35A70(V_Game.pCurPlanet, *(_WORD *)a1->Unknown_AB);
          sub_49940(v54);
        }
        sub_34B0C(V_Game.pCurPlanet, *(unsigned __int16 *)a1->Unknown_AB, 0xFFu, 1u);
        sub_56D30(&WinMgr, a1->a2.a1.parentIndex, 0x32, 0xA, 0);
        return 0;
      }
      else
      {
        sub_56D30(&WinMgr, a1->a2.a1.parentIndex, 0x32, 0xB, 0);
        return 0;
      }
    }
    else
    {
      if ( *(_WORD *)&v79[4] <= 0x37u )
      {
        v55 = Q_PLANET_CPP_GetShip_sub_35A70(V_Game.pCurPlanet, *(_WORD *)a1->Unknown_AB);
        sub_35C38(V_Game.pCurPlanet, v55);
        sub_56D30(&WinMgr, a1->a2.a1.parentIndex, 0x32, 0xA, 0);
        return 0;
      }
      if ( *(_WORD *)&v79[4] < 0x39u )
      {
        sub_56D30(&WinMgr, a1->a2.a1.parentIndex, 0x32, 0xA, 0);
        sub_56D30(&WinMgr, a1->a2.a1.parentIndex, 0x34, *(unsigned __int16 *)a1->Unknown_AB, 1);
        return 0;
      }
      if ( *(_WORD *)&v79[4] > 0x39u )
      {
        if ( *(_WORD *)&v79[4] != 0x3A )
        {
          return sub_2F424(&a1->a2, *(__int16 *)&savedregs[4], param1, param2);
        }
        sub_34B0C(V_Game.pCurPlanet, *(unsigned __int16 *)a1->Unknown_AB, 0x23u, 2u);
        goto LABEL_88;
      }
      v56 = Q_TryInvadePlanet_sub_36CD4(V_Game.pCurPlanet, *(_WORD *)a1->Unknown_AB, &a2);
      helptopic = "invadefailure";
      vpWnd20HW = (P_Wnd20HW)Q_FindWnd_sub_56DA8(&WinMgr, "HELPWINDOW", 0);
      if ( v56 == 0xFFFFFFFF )
      {
        helptopic = "invadesuccess";
      }
      PlanetsNum_sub_402E0 = Q_Race_GetPlanetsNum_sub_402E0(&V_Game.races[V_RaceIndex]);
      Q_ShowHelpTopic_sub_2FCB0(vpWnd20HW, "help.txt", helptopic);
      if ( PlanetsNum_sub_402E0 == 1 )
      {
        v60 = 0x20;                                    // 32: "y"
      }
      else
      {
        v60 = 0x21;                                    // 33: "ies"
      }
      v69 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v60);
      if ( a2 == 1 )
      {
        v61 = 0x1C;                                    // 28: ""
      }
      else
      {
        v61 = 0x1D;                                    // 29: "s"
      }
      v62 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v61);
      sprintf((char *)s, *(const char **)&vpWnd20HW->Unknown_C95[5], V_Game.pCurPlanet->name, a2, v62, PlanetsNum_sub_402E0, v69);
      v63 = 0;
      v64 = *(_DWORD *)&vpWnd20HW->Unknown_C95[5];
      v65 = 0;
      do
      {
        v66 = s[v63];
        *(_BYTE *)(v64 + 2 * v65) = v66;
        if ( !v66 )
        {
          break;
        }
        v67 = HIBYTE(s[v63]);
        *(_BYTE *)(v64 + 2 * v65 + 1) = v67;
        ++v63;
        ++v65;
      }
      while ( v67 );
      *(_WORD *)&vpWnd20HW->Unknown_C91[0].Unknown_04[1] = 0x1C;
      *(_WORD *)&vpWnd20HW->Unknown_C91[0].Unknown_04[3] = 0x49;
      *(_WORD *)&vpWnd20HW->Unknown_C91[1].Unknown_04[1] = 0x1D;
      *(_WORD *)&vpWnd20HW->Unknown_C91[1].Unknown_04[3] = V_Game.pCurPlanet->size + 5 * V_Game.pCurPlanet->type;
      sub_56D30(&WinMgr, a1->a2.a1.parentIndex, 0x32, 0xA, 0);
      sub_56B60(&WinMgr, 5, 0, 0);
      return 0;
    }
  }
}
/* Orphan comments:
30: "OK"
*/

//----- (0003A6BC) --------------------------------------------------------
void __fastcall sub_3A6BC(int a1)
{
  PANE *v1; // esi
  void *ShapeTable_sub_1B084; // eax
  int v3; // eax
  char *sub_1CEA8; // eax
  int raceIndex; // esi
  int v6; // edx
  int v7; // ebx
  char *v8; // eax
  int v9; // edx
  unsigned __int8 v10; // al
  UWORD industry; // cx
  UWORD buildingProgress; // si
  unsigned __int16 PlanetItemCost_sub_3583C; // ax
  int v14; // eax
  UWORD word42; // dx
  UWORD maximumPopulation; // bx
  int v17; // eax
  unsigned __int16 v18; // bx
  char v19; // al
  char *v20; // kr00_4
  int v21; // kr04_4
  int v22; // kr44_4
  char v23; // al
  char v24; // al
  P_Ship Ship_sub_35A70; // eax
  char *v26; // eax
  const char *v27; // ebx
  char *v28; // eax
  unsigned __int16 v29; // dx
  UWORD v30; // cx
  UWORD v31; // si
  unsigned __int16 v32; // ax
  int v33; // eax
  int v34; // edx
  char *v35; // kr08_4
  int v36; // kr0C_4
  int v37; // kr4C_4
  char v38; // al
  char v39; // al
  int v40; // eax
  char *v41; // eax
  char *v42; // kr10_4
  int v43; // kr14_4
  int v44; // kr54_4
  char v45; // al
  char v46; // al
  char *v47; // eax
  char *v48; // kr18_4
  int v49; // kr1C_4
  int v50; // kr5C_4
  char v51; // al
  char v52; // al
  char *v53; // kr20_4
  int v54; // kr24_4
  int v55; // kr64_4
  char v56; // al
  char v57; // al
  char *v58; // kr28_4
  int v59; // kr2C_4
  int v60; // kr6C_4
  char v61; // al
  char v62; // al
  char *v63; // eax
  char *v64; // eax
  char *v65; // kr30_4
  int v66; // kr34_4
  int v67; // kr74_4
  char v68; // al
  char v69; // al
  char *v70; // kr38_4
  int v71; // kr3C_4
  int v72; // kr7C_4
  char v73; // al
  char v74; // al
  char *v75; // eax
  char *v76; // eax
  char *v77; // ecx
  char *v78; // eax
  int v79; // eax
  char *v80; // eax
  T_ResItem *v81; // [esp-10h] [ebp-1AAh]
  __int16 v82; // [esp-Ch] [ebp-1A6h]
  char *v83; // [esp-Ch] [ebp-1A6h]
  char *v84; // [esp-Ch] [ebp-1A6h]
  char *v85; // [esp-8h] [ebp-1A2h]
  char *v86; // [esp-8h] [ebp-1A2h]
  int v87; // [esp-8h] [ebp-1A2h]
  char *v88; // [esp-8h] [ebp-1A2h]
  int v89; // [esp-8h] [ebp-1A2h]
  char *v90; // [esp-4h] [ebp-19Eh]
  char *v91; // [esp-4h] [ebp-19Eh]
  char *v92; // [esp-4h] [ebp-19Eh]
  char *v93; // [esp-4h] [ebp-19Eh]
  char *v94; // [esp-4h] [ebp-19Eh]
  int v95; // [esp-4h] [ebp-19Eh]
  int v96; // [esp-4h] [ebp-19Eh]
  char *v97; // [esp-4h] [ebp-19Eh]
  char v98[152]; // [esp+0h] [ebp-19Ah] BYREF
  char v99[100]; // [esp+98h] [ebp-102h] BYREF
  char v100[100]; // [esp+FCh] [ebp-9Eh] BYREF
  char s[52]; // [esp+160h] [ebp-3Ah] BYREF
  char v102[52]; // [esp+194h] [ebp-6h] BYREF
  PANE v103; // [esp+1C8h] [ebp+2Eh]
  _BYTE v104[20]; // [esp+1DCh] [ebp+42h] BYREF
  char *v105; // [esp+1F0h] [ebp+56h]
  T_ResItem *name; // [esp+1F4h] [ebp+5Ah]
  char *v107; // [esp+1F8h] [ebp+5Eh]
  char *format; // [esp+1FCh] [ebp+62h]
  char *v109; // [esp+200h] [ebp+66h]
  char *v110; // [esp+204h] [ebp+6Ah]
  int v111; // [esp+208h] [ebp+6Eh]
  char *v112; // [esp+20Ch] [ebp+72h]
  _DWORD *v113; // [esp+210h] [ebp+76h]
  int TurnsToComplete_sub_46C20; // [esp+214h] [ebp+7Ah]
  char *v115; // [esp+218h] [ebp+7Eh]

  v113 = (_DWORD *)a1;
  v1 = (PANE *)(a1 + 4);
  sub_552CC(&WinMgr, (PANE *)(a1 + 4));
  VFX_pane_wipe(v1, 0xF2);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEEA);
  v111 = 0;
  VFX_shape_draw(v1, ShapeTable_sub_1B084, 0, 0, 0);
  v103 = *(PANE *)(v113 + 1);
  v103.x0 = v113[2] + 0xA;
  v103.y0 = v113[3] + 0xA;
  v112 = 0;
  v3 = v113[2];
  name = 0;
  v110 = 0;
  v103.x1 = v3 + 0x145;
  format = 0;
  TurnsToComplete_sub_46C20 = 0xFFFF;
  v103.y1 = v113[3] + 0xCF;
  WinMgr.LargeFont.pane = v103;
  WinMgr.LargeFont.Unknown_1C = 0xFF;
  v115 = 0;
  switch ( unk_104684 )
  {
    case 0:
      sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x41);// 65: "Research"
      v112 = sub_1CEA8;
      LOWORD(sub_1CEA8) = V_Game.pCurPlanet->research;
      raceIndex = V_Game.pCurPlanet->raceIndex;
      v115 = sub_1CEA8;
      v6 = (unsigned __int16)V_ResTree.a.w1[raceIndex];
      if ( v6 != 0xFFFF )
      {
        v111 = 0xFFFFFFFF;
        name = &V_ResTree.items[v6];
        v7 = sub_469F0((int)&V_ResTree, raceIndex);
        TurnsToComplete_sub_46C20 = Q_GetTurnsToComplete_sub_46C20(
                                      V_ResTree.items[v6].cost,
                                      (unsigned __int16)word_106FB4[V_Game.pCurPlanet->raceIndex],
                                      v7);
      }
      v110 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x42); // 66: "be discovered"
      format = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x43);// 67: "No progress is being made on %s."
      break;
    case 1:
      v8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x44);   // 68: "Industry"
      HIWORD(v9) = 0;
      v112 = v8;
      LOWORD(v8) = V_Game.pCurPlanet->industry;
      LOWORD(v9) = V_Game.pCurPlanet->word52;
      v115 = v8;
      v10 = 0xFF;
      if ( (unsigned __int16)v9 != 0xFFFF )
      {
        v10 = *((_BYTE *)V_Game.pCurPlanet->pUnknown_10 + 4 * v9 + 1);
      }
      if ( v10 != 0xFF )
      {
        name = (T_ResItem *)V_PlanetItems.item[v10].name;
        v111 = 0xFFFFFFFF;
        industry = V_Game.pCurPlanet->industry;
        buildingProgress = V_Game.pCurPlanet->buildingProgress;
        PlanetItemCost_sub_3583C = Q_GetPlanetItemCost_sub_3583C(V_Game.pCurPlanet, v9, 0xFFu);
        TurnsToComplete_sub_46C20 = Q_GetTurnsToComplete_sub_46C20(PlanetItemCost_sub_3583C, buildingProgress, industry);
      }
      v110 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x45); // 69: "be completed"
      format = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x43);// 67: "No progress is being made on %s."
      break;
    case 2:
      v112 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x46); // 70: "Prosperity"
      HIWORD(v14) = HIWORD(V_Game.pCurPlanet);
      LOWORD(v14) = V_Game.pCurPlanet->prosperity;
      v115 = (char *)v14;
      name = (T_ResItem *)Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x47);// 71: "Population"
      v110 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x48); // 72: "grow"
      word42 = V_Game.pCurPlanet->word42;
      maximumPopulation = V_Game.pCurPlanet->maximumPopulation;
      v111 = 0xFFFFFFFF;
      if ( word42 >= maximumPopulation )
      {
        format = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x4A);// 74: "%s has no more room to grow."
      }
      else
      {
        TurnsToComplete_sub_46C20 = Q_GetTurnsToComplete_sub_46C20(
                                      V_PlanItem50,
                                      (unsigned __int16)V_Game.pCurPlanet->z6,
                                      (unsigned __int16)V_Game.pCurPlanet->prosperity);
        if ( (unsigned __int16)TurnsToComplete_sub_46C20 == 0xFFFF )
        {
          format = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x49);// 73: "%s is not growing."
        }
      }
      break;
    case 3:
      v17 = *(unsigned __int16 *)((char *)v113 + 0xAB);
      if ( (unsigned __int16)v17 != 0xFFFF )
      {
        HIBYTE(v18) = 0;
        v107 = (char *)V_Game.pCurPlanet->pUnknown_10 + 4 * v17;
        LOBYTE(v18) = v107[1];
        v109 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x4B);// 75: "White"
        v19 = *v107;
        v105 = 0;
        switch ( v19 & 7 )
        {
          case 0:
            v109 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x4C);// 76: "Black"
            break;
          case 2:
            v109 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x4D);// 77: "Red"
            v105 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x4E);// 78: "industry"
            break;
          case 3:
            v109 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x4F);// 79: "Green"
            v105 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x50);// 80: "prosperity"
            break;
          case 4:
            v109 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x51);// 81: "Blue"
            v105 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x52);// 82: "research"
            break;
          default:
            break;
        }
        if ( *(_WORD *)((char *)v113 + 0xAB) >= V_Game.pCurPlanet->word18 )
        {
          v109 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x53);// 83: "Orbital"
        }
        if ( v18 == 0xFF )
        {
          if ( (*v107 & 8) != 0 && V_RaceIndex == V_Game.pCurPlanet->raceIndex )
          {
            v42 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x58);// 88: "Xenoarcheological Ruins"
            v43 = 0;
            v44 = 0;
            do
            {
              v45 = v42[2 * v43];
              v100[2 * v44] = v45;
              if ( !v45 )
              {
                break;
              }
              v46 = v42[2 * v43 + 1];
              v100[2 * v44 + 1] = v46;
              ++v43;
              ++v44;
            }
            while ( v46 );
          }
          else
          {
            v92 = v109;
            v47 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x59);// 89: "%s Square"
            sprintf(v100, v47, v92);
          }
          sub_2B8A8(&WinMgr.LargeFont, 0, 0x14, v100, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
          if ( (*v107 & 8) == 0 )
          {
            if ( *(_WORD *)((char *)v113 + 0xAB) < V_Game.pCurPlanet->word18 )
            {
              if ( (*v107 & 7) == 1 )
              {
                v53 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x5B);// 91: "White squares are ordinary habitable surface squares."
                v54 = 0;
                v55 = 0;
                do
                {
                  v56 = v53[2 * v54];
                  v98[2 * v55] = v56;
                  if ( !v56 )
                  {
                    break;
                  }
                  v57 = v53[2 * v54 + 1];
                  v98[2 * v55 + 1] = v57;
                  ++v54;
                  ++v55;
                }
                while ( v57 );
              }
              else if ( (*v107 & 7) != 0 )
              {
                v93 = v105;
                v85 = v109;
                v63 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x5D);// 93: "%s squares increase the effectiveness of %s-producing structures."
                sprintf(v98, v63, v85, v93);
              }
              else
              {
                v58 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x5C);// 92: "Black squares are uninhabitable.  Most structures cannot be built on them."
                v59 = 0;
                v60 = 0;
                do
                {
                  v61 = v58[2 * v59];
                  v98[2 * v60] = v61;
                  if ( !v61 )
                  {
                    break;
                  }
                  v62 = v58[2 * v59 + 1];
                  v98[2 * v60 + 1] = v62;
                  ++v59;
                  ++v60;
                }
                while ( v62 );
              }
            }
            else
            {
              v48 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x5A);// 90: "Orbital squares are used for building orbital structures such as 
                                                       // Shipyards and Ships."
              v49 = 0;
              v50 = 0;
              do
              {
                v51 = v48[2 * v49];
                v98[2 * v50] = v51;
                if ( !v51 )
                {
                  break;
                }
                v52 = v48[2 * v49 + 1];
                v98[2 * v50 + 1] = v52;
                ++v49;
                ++v50;
              }
              while ( v52 );
            }
            sub_2B8A8(&WinMgr.LargeFont, 0xA, 0x50, v98, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
          }
        }
        else
        {
          v20 = V_PlanetItems.item[v18].name;
          v21 = 0;
          v22 = 0;
          do
          {
            v23 = v20[2 * v21];
            s[2 * v22] = v23;
            if ( !v23 )
            {
              break;
            }
            v24 = v20[2 * v21 + 1];
            s[2 * v22 + 1] = v24;
            ++v21;
            ++v22;
          }
          while ( v24 );
          if ( v18 == 0x17 )
          {
            Ship_sub_35A70 = Q_PLANET_CPP_GetShip_sub_35A70(V_Game.pCurPlanet, *(_WORD *)((char *)v113 + 0xAB));
            sprintf(s, "%s \"%s\"", V_PlanetItems.item[0x17].name, Ship_sub_35A70->name);
          }
          if ( (*((_WORD *)v107 + 1) & 2) != 0 )
          {
            v26 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x54);// 84: "Automated "
          }
          else
          {
            v26 = (char *)&unk_920AA;
          }
          v27 = v26;
          qmemcpy(v102, &unk_968A8, 0x32u);
          if ( *(_WORD *)((char *)v113 + 0xAB) < V_Game.pCurPlanet->word18 )
          {
            v90 = v109;
            v28 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x55);// 85: " on %s Square"
            sprintf(v102, v28, v90);
          }
          sprintf(v99, "%s%s%s", v27, s, v102);
          sub_2B8A8(&WinMgr.LargeFont, 0, 0xF, v99, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
          v29 = *(_WORD *)((char *)v113 + 0xAB);
          if ( !*((_WORD *)V_Game.pCurPlanet->pUnknown_10 + 2 * v29 + 1) )
          {
            v30 = V_Game.pCurPlanet->industry;
            v31 = V_Game.pCurPlanet->buildingProgress;
            v32 = Q_GetPlanetItemCost_sub_3583C(V_Game.pCurPlanet, v29, 0xFFu);
            v33 = Q_GetTurnsToComplete_sub_46C20(v32, v31, v30);
            v34 = v33;
            if ( v33 == 0xFFFF )
            {
              v35 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x56);// 86: "No progress"
              v36 = 0;
              v37 = 0;
              do
              {
                v38 = v35[2 * v36];
                v99[2 * v37] = v38;
                if ( !v38 )
                {
                  break;
                }
                v39 = v35[2 * v36 + 1];
                v99[2 * v37 + 1] = v39;
                ++v36;
                ++v37;
              }
              while ( v39 );
            }
            else
            {
              if ( v33 == 1 )
              {
                v40 = 0x1C;                            // 28: ""
              }
              else
              {
                v40 = 0x1D;                            // 29: "s"
              }
              v91 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v40);
              v41 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x57);// 87: "%d day%s until completion"
              sprintf(v99, v41, v34, v91);
            }
            sub_2B8A8(&WinMgr.LargeFont, 0, 0x32, v99, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
          }
        }
      }
      break;
    case 4:
      sub_2B8A8(&WinMgr.LargeFont, 0, 0xF, V_Game.pCurPlanet->name, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
      v94 = dword_10469C[V_Game.pCurPlanet->type];
      v86 = dword_104688[V_Game.pCurPlanet->size];
      v64 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x5E);  // 94: "%s %s Planet"
      sprintf(v100, v64, v86, v94);
      sub_2B8A8(&WinMgr.LargeFont, 0, 0x3C, v100, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
      v65 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x5F);  // 95: "No One"
      v66 = 0;
      v67 = 0;
      do
      {
        v68 = v65[2 * v66];
        v104[2 * v67] = v68;
        if ( !v68 )
        {
          break;
        }
        v69 = v65[2 * v66 + 1];
        v104[2 * v67 + 1] = v69;
        ++v66;
        ++v67;
      }
      while ( v69 );
      if ( V_Game.pCurPlanet->raceIndex != 0xFF )
      {
        v70 = V_SpecNames[V_Game.races[V_Game.pCurPlanet->raceIndex].Unknown_01];
        v71 = 0;
        v72 = 0;
        do
        {
          v73 = v70[2 * v71];
          v104[2 * v72] = v73;
          if ( !v73 )
          {
            break;
          }
          v74 = v70[2 * v71 + 1];
          v104[2 * v72 + 1] = v74;
          ++v71;
          ++v72;
        }
        while ( v74 );
      }
      v87 = 4 * V_Game.races[V_Game.pCurPlanet->raceIndex].Unknown_02 + 0x13;
      v75 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x60);  // 96: "Owned by |%d|%s"
      sprintf(v100, v75, v87, v104);
      sub_2B8A8(&WinMgr.LargeFont, 0, 0x5A, v100, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
      v95 = V_Game.pCurPlanet->maximumPopulation;
      v76 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x61);  // 97: "Maximum Population  %d"
      sprintf(v100, v76, v95);
      sub_2B8A8(&WinMgr.LargeFont, 0, 0x78, v100, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
      if ( V_Game.pCurPlanet->raceIndex == V_RaceIndex && V_Game.pCurPlanet->z7 == 0xFFFFFFFF )
      {
        v82 = 4 * V_Game.races[V_RaceIndex].Unknown_02 + 0x13;
        v77 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x62);// 98: "Self Managed"
        sub_2B8A8(&WinMgr.LargeFont, 0, 0x96, v77, 2, v82, 0xFFFFFFFF, 0);
      }
      break;
    default:
      break;
  }
  if ( v112 )
  {
    v96 = (unsigned __int16)v115;
    v88 = v112;
    v83 = V_Game.pCurPlanet->name;
    v78 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x63);    // 99: "%s %s: %d per day"
    sprintf(v100, v78, v83, v88, v96);
    sub_2B8A8(&WinMgr.LargeFont, 0, 0xF, v100, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
    if ( v111 )
    {
      if ( (unsigned __int16)TurnsToComplete_sub_46C20 == 0xFFFF )
      {
        sprintf(v100, format, name);
      }
      else
      {
        if ( (unsigned __int16)TurnsToComplete_sub_46C20 == 1 )
        {
          v79 = 0x1C;                                  // 28: ""
        }
        else
        {
          v79 = 0x1D;                                  // 29: "s"
        }
        v97 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v79);
        v89 = (unsigned __int16)TurnsToComplete_sub_46C20;
        v84 = v110;
        v81 = name;
        v80 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x64);// 100: "%s will %s in %d day%s."
        sprintf(v100, v80, v81, v84, v89, v97);
      }
      sub_2B8A8(&WinMgr.LargeFont, 0, 0x50, v100, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
    }
  }
  if ( *(_WORD *)((char *)v113 + 0x6B) )
  {
    sub_2D218(v113);
  }
}
// 9684C: using guessed type int V_PlanItem50;
// 106FB4: using guessed type __int16 word_106FB4[7];
// 3A6BC: using guessed type char s[52];
// 3A6BC: using guessed type char var_184[100];
// 3A6BC: using guessed type char var_120[100];
// 3A6BC: using guessed type char var_21C[152];
// 3A6BC: using guessed type _BYTE var_40[20];

//----- (0003B120) --------------------------------------------------------
void __fastcall Q_RaceCtor_sub_3B120(P_Race pRace)
{
  char *v2; // edx
  int v3; // ebx
  char *v4; // edi
  char *pSpecname; // esi
  char v6; // al
  char v7; // al

  v2 = V_SpecNames[0];
  v3 = 0x65;                                           // 101: "Minions"
  do
  {
    v4 = v2;
    pSpecname = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v3);
    do
    {
      v6 = *pSpecname;
      *v4 = *pSpecname;
      if ( !v6 )
      {
        break;
      }
      v7 = pSpecname[1];
      pSpecname += 2;
      v4[1] = v7;
      v4 += 2;
    }
    while ( v7 );
    v2 += 20;
    ++v3;
  }
  while ( v2 != V_SpecNames[21] );
  pRace->Unknown_01 = 0xFF;
  pRace->index = 0xFF;
  pRace->star = 0;
  sub_3B188(pRace);
}

//----- (0003B188) --------------------------------------------------------
void __fastcall sub_3B188(P_Race pRace)
{
  P_Race v1; // edx
  int i; // kr04_4

  pRace->Unknown_1AA = 0x12;
  pRace->Unknown_1AC = 0x16;
  pRace->Unknown_1AE = 0;
  pRace->Unknown_19B = 0;
  pRace->Unknown_1D9 = 0;
  pRace->Unknown_1DB = 0;
  pRace->Unknown_1E9 = 0xE;
  v1 = pRace;
  pRace->Unknown_1EA = 0;
  for ( i = 0; i != 7; ++i )
  {
    v1->Unknown_1C0[0] = 0;
    v1 = (P_Race)((char *)v1 + 1);
    pRace->Unknown_1B2[i] = 0;
  }
  pRace->Unknown_03 = 0;
}

//----- (0003B1FC) --------------------------------------------------------
int __fastcall sub_3B1FC(P_Race a1, UBYTE a2, __int16 a3)
{
  int result; // eax

  sub_3B188(a1);
  a1->index = a2;
  result = a1->Unknown_01;
  if ( result != a3 )
  {
    a1->Unknown_01 = a3;
    return Q_RACENEG_CPP_sub_43C80(a1);
  }
  return result;
}

//----- (0003B220) --------------------------------------------------------
char __fastcall sub_3B220(P_Race a1, int a2, int a3, int a4)
{
  P_Race v4; // ebp
  __int16 v5; // di
  T_Ship *v6; // esi
  int ShipsNum_sub_40224; // eax
  int v8; // ebx
  int v9; // edx
  int v10; // ebx
  int v11; // kr04_4
  UBYTE v12; // dl
  T_Race *v13; // ecx
  int v15[107]; // [esp+0h] [ebp-1CCh] BYREF
  int v16; // [esp+1ACh] [ebp-20h]
  int v17; // [esp+1B0h] [ebp-1Ch]

  v4 = a1;
  if ( a1->Unknown_03 != 0xFFFFFFFF )
  {
    v17 = sub_3EFE0(a1);
    if ( v17 < 0 )
    {
      v5 = 0;
      v16 = Q_Race_GetShipsNum_sub_40224(v4, (P_Ship *)v15, 0) - 1;
      while ( v5 < -v17 )
      {
        v6 = (T_Ship *)v15[v16 - v5];
        if ( v4->index == V_RaceIndex )
        {
          Q_AddGameEvent_sub_55AEC(&WinMgr, ASCEND_EP_SCRAPNEWESTSHIP, (void *)v6->hullSize, 0);
        }
        sub_49940(v6);
        ++v5;
      }
    }
    ShipsNum_sub_40224 = Q_Race_GetShipsNum_sub_40224(v4, (P_Ship *)v15, 0);
    sub_3C1C0(&v4->index, v15, ShipsNum_sub_40224);
    v8 = Q_Race_GetShipsNum_sub_40224(v4, (P_Ship *)v15, 0);
    if ( !v8 && !Q_Race_GetPlanetsNum_sub_402E0(v4) )
    {
      v9 = ASCEND_EP_SPECIESEXTINCT;
      LOBYTE(v8) = v4->index;
      v4->Unknown_03 = 0xFFFFFFFF;
LABEL_19:
      LOBYTE(a1) = Q_AddGameEvent_sub_55AEC(&WinMgr, v9, (void *)v8, 0);
      return (char)a1;
    }
    if ( v8 > 0 )
    {
      v10 = 4 * v8;
      v11 = 0;
      do
      {
        sub_4A6AC((P_Ship)v15[v11++]);
      }
      while ( 4 * v11 < v10 );
    }
    v8 = 0;
    dword_10509C = 0;
    sub_3B5B8(&v4->index);
    sub_405F4(v4);
    LOBYTE(a1) = v4->star->racesBits & 0x80;
    if ( (_BYTE)a1 )
    {
      v12 = V_RaceIndex;
      v13 = (T_Race *)(*(_DWORD *)v4->z2 + 1);
      LOBYTE(a1) = v4->index;
      *(_DWORD *)v4->z2 = v13;
      if ( (_BYTE)a1 == v12 )
      {
        if ( v13 )
        {
          a1 = (P_Race)(unsigned __int16)word_968E8[(char)v4->ability];
          if ( a1 == v13 )
          {
            v9 = 0x18;
            goto LABEL_19;
          }
        }
      }
    }
  }
  return (char)a1;
}
// 968E8: using guessed type __int16 word_968E8[21];
// 10509C: using guessed type int dword_10509C;
// 3B220: using guessed type int var_1CC[107];

//----- (0003B38C) --------------------------------------------------------
char __fastcall Q_NC_sub_3B38C(unsigned __int8 *a1)
{
  T_Race *v1; // esi
  int v2; // ecx
  int v3; // ebp
  int v4; // ebp
  __int16 i; // di
  T_Race *v6; // eax
  P_Ship v7; // eax
  __int16 v8; // di
  P_Ship v9; // eax
  void *raceIndex; // ecx
  _DWORD v12[142]; // [esp+0h] [ebp-5D0h] BYREF
  P_Ship v13[215]; // [esp+250h] [ebp-380h] BYREF
  int ShipsNum_sub_40224; // [esp+5C4h] [ebp-Ch]
  T_Planet *pPlanet; // [esp+5C8h] [ebp-8h]
  __int16 j; // [esp+5CCh] [ebp-4h]

  v1 = (T_Race *)a1;
  LOBYTE(a1) = *a1;
  if ( (_BYTE)a1 == V_RaceIndex && V_FlashPopExists != 0xFFFFFFFF )
  {
    v2 = 0;
    LOWORD(a1) = 0;
    if ( V_Game.racesNum > 0 )
    {
      v3 = 0;
      do
      {
        if ( (__int16)a1 != v1->index && !v1->Unknown_1C0[(__int16)a1] )
        {
          ++v2;
          v13[v3 + 0xD6] = (P_Ship)(__int16)a1;
          ++v3;
        }
        LOWORD(a1) = (_WORD)a1 + 1;
      }
      while ( (__int16)a1 < V_Game.racesNum );
    }
    if ( v2 )
    {
      memset(v12, 0, 0x250u);
      v4 = 0;
      for ( i = 0; i < v2; ++i )
      {
        v6 = &V_Game.races[(_DWORD)v13[i + 0xD6]];
        v4 += Q_Race_GetShipsNum_sub_40224(v6, &v13[v4 + 0x6B], 0);
      }
      ShipsNum_sub_40224 = Q_Race_GetShipsNum_sub_40224(v1, v13, 0);
      for ( j = 0; ; ++j )
      {
        LOBYTE(a1) = j;
        if ( j >= ShipsNum_sub_40224 )
        {
          break;
        }
        v7 = v13[j];
        if ( v7->locationType == 5 )
        {
          pPlanet = v7->pLocation.pPlanet;
          if ( !v12[((char *)pPlanet - (char *)V_Game.lanes) / 0x27] )
          {
            v8 = 0;
            v12[((char *)pPlanet - (char *)V_Game.lanes) / 0x27] = 0xFFFFFFFF;
            while ( v8 < v4 )
            {
              v9 = v13[v8 + 0x6B];
              if ( pPlanet == v9->pLocation.pPlanet )
              {
                raceIndex = (void *)v9->raceIndex;
                if ( !*((_BYTE *)raceIndex + (_DWORD)v1 + 0x1C0) )
                {
                  *((_BYTE *)raceIndex + (_DWORD)v1 + 0x1C0) = 1;
                  v1->Unknown_1B2[(_DWORD)raceIndex] = v1->Unknown_1D5;
                  V_Game.races[(_DWORD)raceIndex].Unknown_1C0[v1->index] = 1;
                  V_Game.races[(_DWORD)raceIndex].Unknown_1B2[v1->index] = V_Game.races[(_DWORD)raceIndex].Unknown_1D5;
                  Q_AddGameEvent_sub_55AEC(&WinMgr, ASCEND_EP_23_LANE_TRANSMISION, v13[j], raceIndex);
                }
              }
              ++v8;
            }
          }
        }
      }
    }
  }
  return (char)a1;
}

//----- (0003B56C) --------------------------------------------------------
int __fastcall sub_3B56C(P_Race pRace, P_Location pLocation)
{
  int v3; // edi
  __int16 i; // dx
  int result; // eax
  P_Ship v6; // eax
  P_Ship pShip[107]; // [esp+0h] [ebp-1ACh] BYREF

  v3 = sub_1D794(pLocation, pShip);
  for ( i = 0; ; ++i )
  {
    result = i;
    if ( i >= v3 )
    {
      break;
    }
    v6 = pShip[i];
    if ( v6 )
    {
      if ( v6->raceIndex == pRace->index )
      {
        sub_4A5B8(v6);
      }
    }
  }
  return result;
}

//----- (0003B5B8) --------------------------------------------------------
void __fastcall sub_3B5B8(unsigned __int8 *eax0)
{
  int v1; // ebx
  int v2; // edi
  __int16 i; // bx
  WORD v4; // dx
  int v5; // kr04_4
  int v6; // ecx
  int v7; // eax
  int v8; // ecx
  int v9; // eax
  int v10; // ecx
  int v11; // eax
  int v12; // ebp
  int v13; // ecx
  int v14; // eax
  int v15; // ebx
  int v16; // eax
  double v17; // st7
  double v18; // st7
  double v19; // st7
  __int16 j; // si
  int v21; // ecx
  __int16 v22; // dx
  int v23; // eax
  int v24; // eax
  __int16 v25; // di
  int v26; // edx
  WORD v27; // si
  int v28; // kr0C_4
  T_Star *stars; // edi
  WORD k; // bx
  int v31; // eax
  int v32; // eax
  int v33; // eax
  int v34; // kr14_4
  int v35; // ebp
  int v36; // ecx
  __int16 v37; // si
  int starIndex; // ecx
  __int16 v39; // si
  signed int v40; // ebp
  T_Planet *v41; // ecx
  int v42; // edi
  int v43; // edx
  WORD m; // bx
  T_Planet *v45; // edx
  int v46[107]; // [esp+0h] [ebp-214h] BYREF
  int v47; // [esp+1ACh] [ebp-68h]
  int v48; // [esp+1B0h] [ebp-64h]
  float v49; // [esp+1B4h] [ebp-60h]
  int ShipsNum_sub_40224; // [esp+1B8h] [ebp-5Ch]
  int v51; // [esp+1BCh] [ebp-58h]
  int v52; // [esp+1C0h] [ebp-54h]
  int v53; // [esp+1C4h] [ebp-50h]
  P_Race pRace; // [esp+1C8h] [ebp-4Ch]
  float v55; // [esp+1CCh] [ebp-48h]
  int v56; // [esp+1D0h] [ebp-44h]
  int v57; // [esp+1D4h] [ebp-40h]
  P_Planet a1; // [esp+1D8h] [ebp-3Ch]
  int v59; // [esp+1DCh] [ebp-38h]
  float v60; // [esp+1E0h] [ebp-34h]
  float v61; // [esp+1E4h] [ebp-30h]
  float v62; // [esp+1E8h] [ebp-2Ch]
  float v63; // [esp+1ECh] [ebp-28h]
  int v64; // [esp+1F0h] [ebp-24h]
  int v65; // [esp+1F4h] [ebp-20h]
  unsigned __int8 v66; // [esp+1F8h] [ebp-1Ch]

  pRace = (P_Race)eax0;
  ShipsNum_sub_40224 = Q_Race_GetShipsNum_sub_40224((P_Race)eax0, (P_Ship *)v46, 0);
  if ( pRace->index != V_RaceIndex || V_FlashPopExists == 0xFFFFFFFF )
  {
    sub_3C670(pRace);
    v1 = ShipsNum_sub_40224;
    sub_3C968((int)pRace);
    sub_44080(&pRace->index);
    sub_3C2E8(&pRace->index, v46, v1);
  }
  if ( sub_40590(pRace) != 0xFFFFFFFF
    && (V_RaceIndex != pRace->index || V_FlashPopExists || dword_106FC2 == 0xFFFFFFFF)
    && (unsigned __int16)V_ResTree.a.w1[pRace->index] == 0xFFFF )
  {
    sub_3EA7C(pRace);
  }
  if ( V_RaceIndex != pRace->index || V_FlashPopExists == 0xFFFFFFFF )
  {
    sub_434E4((char *)pRace, 1);
  }
  v2 = ShipsNum_sub_40224;
  for ( i = 0; i < v2; ++i )
  {
    if ( V_RaceIndex != pRace->index || V_FlashPopExists == 0xFFFFFFFF )
    {
      sub_3EBDC(&pRace->index, (T_Ship *)v46[i]);
    }
  }
  if ( V_RaceIndex != pRace->index || V_FlashPopExists == 0xFFFFFFFF )
  {
    LOWORD(v65) = sub_3EFE0(pRace);
    if ( (__int16)v65 > 0xA )
    {
      LOWORD(v65) = 0xA;
    }
    if ( (__int16)v65 > 0 )
    {
      v62 = 0.0;
      v60 = 0.0;
      v61 = 0.0;
      v66 = sub_43374(pRace, 0xFFFFFFFF);
      v4 = 0;
      if ( V_Game.starsNum > 0 )
      {
        v5 = 0;
        do
        {
          if ( (V_Game.stars[v5].racesBits & v66) != 0 )
          {
            v10 = *((char *)&dword_104F6D + v4 + 3);
            v11 = dword_104BEC[v4];
            v59 = v11;
            if ( v10 > 1 )
            {
              v59 = v11 >> (v10 - 1);
            }
            v12 = v4;
            v13 = *((char *)&dword_104F09 + v4 + 3);
            v14 = dword_104D7C[v12];
            v15 = dword_104BEC[v12];
            v60 = (double)v59 + v60;
            v16 = v15 + v14;
            v59 = v16;
            if ( v13 > 0 )
            {
              v59 = v16 >> v13;
            }
            v62 = (double)v59 + v62;
          }
          else if ( (V_Game.stars[v5].Unknown_15 & v66) != 0 )
          {
            v6 = *((char *)&dword_104F09 + v4 + 3);
            v7 = dword_104D7C[v4];
            v53 = v7;
            if ( v6 > 0 )
            {
              v53 = v7 >> v6;
            }
            v62 = (double)v53 + v62;
          }
          else
          {
            if ( *((char *)&dword_104FD1 + v4 + 3) <= 0 )
            {
              v61 = (double)dword_104BEC[v4] + v61;
            }
            v8 = *((char *)&dword_104F09 + v4 + 3);
            v9 = dword_104D7C[v4];
            v52 = v9;
            if ( v8 > 0 )
            {
              v52 = v9 >> v8;
            }
            v62 = (double)v52 + v62;
          }
          ++v4;
          ++v5;
        }
        while ( v4 < V_Game.starsNum );
      }
      v61 = v61 * 0.050000001;
      v17 = v60 * 0.6666666666666666;
      v60 = v17;
      v49 = v17 + v62 + v61;
      if ( v49 <= 0.0 )
      {
        v48 = (__int16)v65 / 3;
        v61 = (float)v48;
        v62 = v61;
        v60 = (double)(__int16)v65 - v61 - v61;
      }
      else
      {
        v18 = (double)(__int16)v65;
        v60 = v60 * v18;
        v62 = v62 * v18;
        v61 = v18 * v61;
        v19 = 1.0 / v49;
        v60 = v60 * v19;
        v62 = v62 * v19;
        v61 = v19 * v61;
      }
      for ( j = 0; j < ShipsNum_sub_40224; ++j )
      {
        v21 = v46[j];
        if ( !v21 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x22A);
        }
        if ( *(_BYTE *)(v21 + 0x58) == 1 )
        {
          if ( *(_DWORD *)(v21 + 0x28) && v61 > 0.0 )
          {
            v61 = v61 - 1.0;
          }
          else if ( Q_ShipHasGizmo_sub_4A534((P_Ship)v46[j], 0x49) && v60 > 0.0 )
          {
            v60 = v60 - 1.0;
          }
          else if ( v62 > 0.0 )
          {
            v62 = v62 - 1.0;
          }
        }
      }
      v22 = 0;
      while ( 1 )
      {
        v23 = v22;
        if ( v22 >= 0x64 )
        {
          break;
        }
        ++v22;
        dword_1046E8[v23] = 0;
        dword_104878[v23] = 0;
        dword_104A08[v23] = 0;
      }
      v24 = 0;
      if ( (__int16)v65 > 0 )
      {
        v25 = v65;
        do
        {
          v26 = (__int16)v24++;
          dword_104B98[v26] = 0xFFFFFFFF;
        }
        while ( (__int16)v24 < v25 );
      }
      v27 = 0;
      if ( V_Game.starsNum > 0 )
      {
        v28 = 0;
        do
        {
          if ( ((1 << pRace->index) & V_Game.stars[v28].racesBits) != 0 )
          {
            stars = V_Game.stars;
            for ( k = 0; k < V_Game.starsNum; ++stars )
            {
              if ( ((1 << pRace->index) & (unsigned __int8)stars->Unknown_16) != 0 )
              {
                v48 = 1 / ((__int16)sub_1DA04((int)stars, (int)&V_Game.stars[v28]) / 0x19 + 1);
                v63 = (float)v48;
                v55 = v63;
                if ( (V_Game.stars[v28].racesBits & v66) != 0 )
                {
                  v33 = *(int *)((char *)&dword_104F6D + k) >> 0x18;
                  v51 = (int)((double)dword_104BEC[k] * v63);
                  if ( v33 >= 1 )
                  {
                    if ( v33 < 2 )
                    {
                      dword_104A08[v27] += v51 / 2;
                    }
                  }
                  else
                  {
                    dword_104A08[v27] += v51;
                  }
                  if ( *((char *)&dword_104F09 + k + 3) < 1 )
                  {
                    dword_104878[v27] += v51;
                  }
                }
                else if ( (V_Game.stars[v28].Unknown_15 & v66) != 0 )
                {
                  v48 = dword_104BEC[k] + dword_104D7C[k];
                  v31 = *((char *)&dword_104F09 + k + 3);
                  v56 = (int)((double)v48 * v63);
                  if ( v31 < 1 )
                  {
                    dword_104878[v27] += v56;
                  }
                }
                else
                {
                  if ( *((char *)&dword_104FD1 + k + 3) < 1 )
                  {
                    dword_1046E8[v27] = (int)((double)dword_104BEC[k] * v63 * 0.050000001 + (double)dword_1046E8[v27]);
                  }
                  v32 = *(int *)((char *)&dword_104F09 + k) >> 0x18;
                  v47 = (int)((double)dword_104D7C[k] * v55);
                  if ( v32 < 1 )
                  {
                    dword_104878[v27] += v47;
                  }
                }
              }
              ++k;
            }
          }
          ++v27;
          ++v28;
        }
        while ( v27 < V_Game.starsNum );
      }
      a1 = V_Game.planets;
      LOWORD(v64) = 0;
      if ( V_Game.planetsNum > 0 )
      {
        v34 = 0;
        do
        {
          if ( a1->buildingPlanetItemIndex == 0xFF && sub_35930(a1, 0x16) != 0xFFFF && a1->raceIndex == pRace->index )
          {
            starIndex = a1->starIndex;
            if ( starIndex >= 0x64 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x2A1);
            }
            v57 = (dword_104878[starIndex] + dword_1046E8[starIndex] + dword_104A08[starIndex]) / 0xA;
            v35 = 0;
            v37 = 0;
            v36 = dword_104BC0[0];
            v57 *= a1->industry;
            if ( (__int16)v65 > 0 )
            {
              while ( 1 )
              {
                if ( v37 >= 0xA )
                {
                  Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x2B1);
                }
                if ( dword_104B98[v37] == 0xFFFFFFFF )
                {
                  break;
                }
                if ( v36 > dword_104BC0[v37] )
                {
                  v35 = v37;
                  v36 = dword_104BC0[v37];
                }
                if ( ++v37 >= (__int16)v65 )
                {
                  goto LABEL_96;
                }
              }
              v35 = v37;
            }
LABEL_96:
            if ( v57 > dword_104BC0[v35] || dword_104B98[v35] == 0xFFFFFFFF )
            {
              dword_104B98[v35] = (__int16)v64;
              dword_104BC0[v35] = v57;
            }
          }
          LOWORD(v64) = v64 + 1;
          ++v34;
        }
        while ( (__int16)v64 < V_Game.planetsNum );
      }
      v39 = 0;
      if ( (__int16)v65 > 0 )
      {
        while ( 1 )
        {
          v40 = dword_104B98[v39];
          if ( v40 <= (int)0xFFFFFFFF || V_Game.planetsNum <= v40 )
          {
            goto LABEL_117;
          }
          v41 = &V_Game.planets[v40];
          if ( !v41 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x2D9);
          }
          v42 = v41->starIndex;
          if ( v42 >= 0x64 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x2DD);
          }
          if ( v61 > 0.0 )
          {
            v43 = dword_1046E8[v42];
            if ( v43 > dword_104878[v42] && v43 > dword_104A08[v42] )
            {
              break;
            }
          }
          if ( v62 > 0.0 && dword_104878[v42] > dword_104A08[v42] )
          {
LABEL_116:
            sub_3CB60(pRace, &V_Game.planets[v40], 1u);
            v62 = v62 - 1.0;
            goto LABEL_117;
          }
          if ( v60 <= 0.0 )
          {
            if ( v61 > 0.0 )
            {
              break;
            }
            if ( v62 > 0.0 )
            {
              goto LABEL_116;
            }
          }
          else
          {
            sub_3CB60(pRace, &V_Game.planets[v40], 2u);
            v60 = v60 - 1.0;
          }
LABEL_117:
          if ( ++v39 >= (__int16)v65 )
          {
            goto LABEL_128;
          }
        }
        sub_3CB60(pRace, &V_Game.planets[v40], 0);
        v61 = v61 - 1.0;
        goto LABEL_117;
      }
    }
  }
LABEL_128:
  for ( m = 0; m < V_Game.planetsNum; ++m )
  {
    v45 = &V_Game.planets[m];
    if ( v45->raceIndex == pRace->index
      && (pRace->index != V_RaceIndex || v45->z7 || V_FlashPopExists)
      && v45->buildingPlanetItemIndex == 0xFF )
    {
      sub_3D8F0((int)pRace, v45);
    }
  }
}
// 1046E8: using guessed type int dword_1046E8[100];
// 104878: using guessed type int dword_104878[100];
// 104A08: using guessed type int dword_104A08[100];
// 104B98: using guessed type int dword_104B98[];
// 104BC0: using guessed type int dword_104BC0[9];
// 104BEC: using guessed type int dword_104BEC[100];
// 104D7C: using guessed type int dword_104D7C[99];
// 104F09: using guessed type int dword_104F09;
// 104F6D: using guessed type int dword_104F6D;
// 104FD1: using guessed type int dword_104FD1;
// 106FC2: using guessed type int dword_106FC2;
// 3B5B8: using guessed type int var_214[107];

//----- (0003C12C) --------------------------------------------------------
unsigned int __fastcall sub_3C12C(unsigned __int8 *a1, _DWORD *a2)
{
  int v3; // ebp
  int v4; // esi
  char v5; // al
  int weaponDamage; // ebx

  v3 = *(_DWORD *)((char *)a2 + 0x15A) - *(_DWORD *)((char *)a2 + 0x15E);
  v4 = 0;
  v5 = sub_4A36C((P_Ship)a2, 0, *a1);
  if ( v5 <= (char)0xFFFFFFFF || v5 >= 0x4C )
  {
    weaponDamage = 0;
  }
  else
  {
    weaponDamage = V_Gizmos[v5].weaponDamage;
  }
  if ( 3 * v3 > *(_DWORD *)((char *)a2 + 0x15A)
    || !a2[0xA] && Q_ShipHasGizmo_sub_4A534((P_Ship)a2, 0x49) == FALSE && weaponDamage > *a2
    || sub_4A8CC((P_Ship)a2) >= 1 && sub_4A1CC((T_Ship *)a2, *a1) >= 0xF )
  {
    return 0xFFFFFFFF;
  }
  return v4;
}

//----- (0003C1C0) --------------------------------------------------------
char __fastcall sub_3C1C0(unsigned __int8 *a1, int *a2, int a3)
{
  int v5; // eax
  int v6; // ecx
  __int16 v7; // ax
  int v8; // edi
  int v9; // kr04_4
  T_Ship *v10; // ecx
  UBYTE locationType; // dl
  __int8 Unknown_5D; // bl

  v5 = sub_3EFE0((P_Race)a1);
  if ( v5 < 2 )
  {
    if ( a2 )
    {
      if ( a3 > 0 )
      {
        LOBYTE(v5) = *a1;
        if ( *a1 != V_RaceIndex || V_FlashPopExists == 0xFFFFFFFF )
        {
          v6 = 1 << *a1;
          v7 = 0;
          if ( (v6 & V_ResTree.items[1].Unknown_48) != 0 )
          {
            v7 = 1;
            if ( (v6 & V_ResTree.items[0x13].Unknown_48) != 0 )
            {
              v7 = 2;
              if ( (v6 & V_ResTree.items[0x1F].Unknown_48) != 0 )
              {
                v7 = 3;
              }
            }
          }
          if ( !v7 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x365);
          }
          v8 = 0;
          v9 = 0;
          do
          {
            if ( !&a2[v9] )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x36B);
            }
            v10 = (T_Ship *)a2[v9];
            if ( !v10 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x36F);
            }
            locationType = v10->locationType;
            if ( locationType != 1 && locationType != 2 )
            {
              Unknown_5D = v10->Unknown_5D;
              if ( Unknown_5D != 2 && Unknown_5D != 5 && Unknown_5D != 6 && sub_3C12C(a1, (_DWORD *)a2[v9]) )
              {
                sub_49940(v10);
              }
            }
            LOBYTE(v5) = a3;
            ++v8;
            ++v9;
          }
          while ( v8 < a3 );
        }
      }
    }
  }
  return v5;
}
// 3C265: conditional instruction was optimized away because ebx.4>=1

//----- (0003C2E8) --------------------------------------------------------
int __fastcall sub_3C2E8(unsigned __int8 *a1, int *a2, int a3)
{
  int v3; // kr04_4
  int v4; // ebx
  WORD starsNum; // si
  int v6; // esi
  int v7; // eax
  __int16 i; // si
  P_Location v9; // edi
  int v10; // ebx
  int pPlanet; // edi
  int v12; // ebx
  int result; // eax
  T_Ship *v14; // ecx
  UBYTE locationType; // al
  __int16 v18; // [esp+Ch] [ebp-18h]
  char v19; // [esp+10h] [ebp-14h]

  v19 = sub_43374((P_Race)a1, 0xFFFFFFFF);
  sub_1FD90((int)&V_Game, (int)&dword_105035 + 3, *a1);
  v18 = 0;
  if ( V_Game.starsNum > 0 )
  {
    v3 = 0;
    do
    {
      v6 = v18;
      dword_104BEC[v6] = sub_1DA4C(&V_Game.stars[v3], *a1, (int)a2, a3);
      dword_104D7C[v6] = sub_1DB70(&V_Game.stars[v3], *a1, a2, a3);
      v7 = *((char *)&dword_105035 + v18 + 3);
      if ( v7 > 0 && (V_Game.stars[v3].Unknown_15 & (unsigned __int8)v19) != 0 )
      {
        dword_104D7C[v18] = 2 * dword_104D7C[v18] + 0x12C + 0x96 * v7;
      }
      v4 = v18;
      starsNum = V_Game.starsNum;
      ++v18;
      *((_BYTE *)&dword_104F09 + v4 + 3) = 0;
      *((_BYTE *)&dword_104F6D + v4 + 3) = 0;
      *((_BYTE *)&dword_104FD1 + v4 + 3) = 0;
      ++v3;
    }
    while ( v18 < starsNum );
  }
  for ( i = 0; ; ++i )
  {
    result = i;
    if ( i >= a3 )
    {
      break;
    }
    v14 = (T_Ship *)a2[i];
    if ( !v14 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x3B3);
    }
    locationType = v14->locationType;
    v12 = 0xFFFFFFFF;
    if ( locationType == 4 )
    {
      pPlanet = (int)v14->pLocation.pPlanet;
      if ( !pPlanet )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x3BB);
      }
      goto LABEL_16;
    }
    if ( locationType == 3 )
    {
      v9.pPlanet = (P_Planet)v14->pLocation;
      if ( !v9.pPlanet )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x3C3);
      }
      v10 = *(_DWORD *)((char *)&v9.pPlanet->v.z + 2);
      goto LABEL_17;
    }
    if ( locationType == 5 && v14->Unknown_5D == 1 )
    {
      pPlanet = v14->Unknown_5E;
      if ( !pPlanet )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x3CC);
      }
LABEL_16:
      v10 = *(_DWORD *)(pPlanet + 2);
LABEL_17:
      v12 = v10 >> 0x10;
    }
    if ( v12 > (int)0xFFFFFFFF && v12 < V_Game.starsNum )
    {
      if ( v14->Unknown_28 )
      {
        ++*((_BYTE *)&dword_104FD1 + v12 + 3);
      }
      else if ( Q_ShipHasGizmo_sub_4A534(v14, 0x49) )
      {
        ++*((_BYTE *)&dword_104F6D + v12 + 3);
      }
      else
      {
        ++*((_BYTE *)&dword_104F09 + v12 + 3);
      }
    }
  }
  return result;
}
// 104BEC: using guessed type int dword_104BEC[100];
// 104D7C: using guessed type int dword_104D7C[99];
// 104F09: using guessed type int dword_104F09;
// 104F6D: using guessed type int dword_104F6D;
// 104FD1: using guessed type int dword_104FD1;
// 105035: using guessed type int dword_105035;

//----- (0003C4EC) --------------------------------------------------------
void __fastcall Q_NC_sub_3C4EC(P_Star pStar, int a2)
{
  __int16 v3; // ax
  int v4; // eax
  WORD v5; // cx
  int i; // kr04_4
  int v7; // edx
  WORD v8; // bx
  int v9; // kr0C_4
  int v10; // edx
  int v11; // kr14_4
  int v12; // ebx
  __int16 v13; // bx

  if ( a2 )
  {
    *(_WORD *)((char *)&pStar[4].Unknown_18 + 3) = 0;
    if ( ((1 << LOBYTE(pStar->type)) & *(unsigned __int8 *)(*(_DWORD *)((char *)&pStar->Unknown_6 + 1) + 0x14)) != 0 )
    {
      v4 = 0;
      v5 = 0;
      for ( i = 0; v5 < V_Game.starsNum; ++i )
      {
        if ( ((1 << LOBYTE(pStar->type)) & (unsigned __int8)V_Game.stars[i].Unknown_16) != 0 )
        {
          v7 = dword_104D7C[v5] + dword_104BEC[v5];
          if ( v5 >= a2 && v7 > v4 )
          {
            v4 = (v7 + v7 + v7 - v4 - v4) / a2;
          }
        }
        ++v5;
      }
      v8 = 0;
      if ( V_Game.starsNum > 0 )
      {
        v9 = 0;
        do
        {
          if ( ((1 << LOBYTE(pStar->type)) & (unsigned __int8)V_Game.stars[v9].Unknown_16) != 0 && dword_104D7C[v8] + dword_104BEC[v8] >= v4 )
          {
            *(_DWORD *)((char *)&pStar->v.x + 4 * *(__int16 *)((char *)&pStar[4].Unknown_18 + 3) + 3) = &V_Game.stars[v9];
          }
          ++v8;
          ++v9;
        }
        while ( v8 < V_Game.starsNum );
      }
      if ( !*(_WORD *)((char *)&pStar[4].Unknown_18 + 3) )
      {
        v10 = 0;
        if ( V_Game.starsNum > 0 )
        {
          v11 = 0;
          do
          {
            v12 = 1 << LOBYTE(pStar->type);
            if ( ((unsigned __int8)v12 & V_Game.stars[v11].racesBits) != 0 && ((unsigned __int8)v12 & V_Game.stars[v11].Unknown_15) == 0 )
            {
              v13 = *(_WORD *)((char *)&pStar[4].Unknown_18 + 3);
              *(_WORD *)((char *)&pStar[4].Unknown_18 + 3) = v13 + 1;
              *(_DWORD *)((char *)&pStar->v.x + 4 * v13 + 3) = &V_Game.stars[v11];
            }
            ++v10;
            ++v11;
          }
          while ( (__int16)v10 < V_Game.starsNum );
        }
      }
    }
    else
    {
      v3 = *(_WORD *)((char *)&pStar[4].Unknown_18 + 3);
      *(_WORD *)((char *)&pStar[4].Unknown_18 + 3) = v3 + 1;
      *(float *)((char *)&pStar->v.x + 4 * v3 + 3) = *(float *)((char *)&pStar->Unknown_6 + 1);
    }
  }
}
// 104BEC: using guessed type int dword_104BEC[100];
// 104D7C: using guessed type int dword_104D7C[99];

//----- (0003C670) --------------------------------------------------------
char __fastcall sub_3C670(_BYTE *a1)
{
  _BYTE *v1; // ebp
  T_Star *stars; // eax
  int i; // edx
  __int16 v4; // bx
  T_Race *v5; // ecx
  __int16 v6; // si
  int v7; // eax
  int v8; // edx
  int v9; // ecx
  int v10; // eax
  int v11; // edx
  bool v12; // zf
  int v13; // edx
  int v14; // ecx
  unsigned __int8 v15; // dl
  int v17; // [esp+0h] [ebp-34h]
  __int16 v18; // [esp+4h] [ebp-30h]
  int v19; // [esp+8h] [ebp-2Ch]
  int v20; // [esp+Ch] [ebp-28h]
  unsigned __int8 v21; // [esp+10h] [ebp-24h]
  unsigned __int8 v22; // [esp+14h] [ebp-20h]
  unsigned __int8 v23; // [esp+18h] [ebp-1Ch]

  v1 = a1;
  LOWORD(v20) = 0;
  if ( V_Game.racesNum > 0 )
  {
    while ( 1 )
    {
      LOBYTE(a1) = v20;
      v14 = (unsigned __int8)*v1;
      if ( (__int16)v20 != v14 && v1[(__int16)v20 + 0x1C0] && V_Game.races[(__int16)v20].Unknown_03 != 0xFFFFFFFF )
      {
        break;
      }
LABEL_54:
      LOWORD(v20) = v20 + 1;
      if ( (__int16)v20 >= V_Game.racesNum )
      {
        return (char)a1;
      }
    }
    v15 = v1[(__int16)v20 + 0x1C0];
    v4 = 0;
    if ( v15 < 2u )
    {
      v12 = v15 == 1;
    }
    else
    {
      if ( v15 <= 2u )
      {
        v4 = *(_WORD *)&V_Game.Unknown_D8A[6 * (__int16)v20] - *(_WORD *)&V_Game.Unknown_D8A[6 * v14];
        if ( v4 >= 0 )
        {
          if ( v4 > 3 )
          {
            v4 = 3;
          }
        }
        else
        {
          v4 = 0;
        }
        goto LABEL_34;
      }
      v12 = v15 == 3;
    }
    if ( v12 )
    {
      if ( v1[(__int16)v20 + 0x1C0] == 1 )
      {
        stars = V_Game.stars;
        for ( i = 0; i < V_Game.starsNum; ++i )
        {
          if ( ((1 << *v1) & stars->racesBits) != 0 && ((1 << v20) & (unsigned __int8)stars->Unknown_15) != 0 )
          {
            v17 = unk_96912;
            v18 = *((_WORD *)&unk_96912 + 2);
            v4 += *((_WORD *)&v17 + V_Game.Unknown_D8A[0x2A]);
          }
          ++stars;
        }
      }
      v5 = &V_Game.races[(__int16)v20];
      v21 = sub_43374(v5, 0xFFFFFFFF);
      v22 = v21;
      v23 = sub_43374(v5, 0xFFFFFFFF);
      if ( v23 != v21 )
      {
        v6 = 0;
        v7 = 0;
        v8 = 0;
        v19 = 0;
        while ( v7 < V_Game.racesNum )
        {
          if ( v7 != (__int16)v20 && v7 != (unsigned __int8)*v1 )
          {
            if ( ((1 << v7) & v22) != 0 )
            {
              v6 += *(_WORD *)&V_Game.Unknown_D8A[v8 + 2];
            }
            v9 = 1 << v7;
            if ( (v23 & (1 << v7)) != 0 )
            {
              LOWORD(v9) = *(_WORD *)&V_Game.Unknown_D8A[v8 + 2];
              v19 += v9;
            }
          }
          v8 += 6;
          ++v7;
        }
        if ( v6 <= (__int16)v19 )
        {
          v4 += 3;
        }
        else
        {
          --v4;
        }
        if ( v1[(__int16)v20 + 0x1C0] == 1 )
        {
          v10 = *(__int16 *)&V_Game.Unknown_D8A[6 * (__int16)v20];
          v11 = *(__int16 *)&V_Game.Unknown_D8A[6 * (unsigned __int8)*v1];
          if ( v10 - v11 <= 1 )
          {
            if ( v11 - v10 > 1 )
            {
              v4 += 4;
            }
          }
          else
          {
            v4 -= 2;
          }
        }
      }
    }
LABEL_34:
    LOBYTE(a1) = V_RaceIndex;
    if ( (__int16)v20 == V_RaceIndex && V_FlashPopExists == FALSE )
    {
      if ( v4 < 0 )
      {
        LOBYTE(a1) = V_Game.Unknown_D8A[0x2A];
        if ( V_Game.Unknown_D8A[0x2A] )
        {
          if ( V_Game.Unknown_D8A[0x2A] <= 1u )
          {
            v4 *= 2;
          }
          else if ( V_Game.Unknown_D8A[0x2A] == 2 )
          {
            v4 *= 3;
          }
        }
      }
      else
      {
        LOBYTE(a1) = V_Game.Unknown_D8A[0x2A];
        if ( V_Game.Unknown_D8A[0x2A] )
        {
          if ( V_Game.Unknown_D8A[0x2A] <= 1u )
          {
            LOWORD(a1) = v4 / 2;
            v4 /= 2;
          }
          else if ( V_Game.Unknown_D8A[0x2A] == 2 )
          {
            LOWORD(a1) = v4 / 3;
            v4 /= 3;
          }
        }
      }
    }
    if ( v4 )
    {
      *(_WORD *)&v1[2 * (__int16)v20 + 0x1B2] += v4;
      v13 = *(__int16 *)&v1[2 * (__int16)v20 + 0x1B2];
      if ( v13 >= 0x32 )
      {
        if ( v13 > 0x3B6 )
        {
          *(_WORD *)&v1[2 * (__int16)v20 + 0x1B2] = 0x3B6;
        }
      }
      else
      {
        *(_WORD *)&v1[2 * (__int16)v20 + 0x1B2] = 0x32;
      }
    }
    goto LABEL_54;
  }
  return (char)a1;
}

//----- (0003C968) --------------------------------------------------------
int __fastcall sub_3C968(int a1)
{
  int result; // eax
  double v3; // st7
  float v4; // edx
  double v5; // st7
  double v6; // [esp+8h] [ebp-34h]
  double v7; // [esp+8h] [ebp-34h]
  double v8; // [esp+8h] [ebp-34h]
  double v9; // [esp+10h] [ebp-2Ch]
  double v10; // [esp+10h] [ebp-2Ch]
  float v11; // [esp+18h] [ebp-24h]
  float v12; // [esp+1Ch] [ebp-20h]
  float v13; // [esp+20h] [ebp-1Ch]
  float v14; // [esp+24h] [ebp-18h]
  float v15; // [esp+24h] [ebp-18h]
  float v16; // [esp+24h] [ebp-18h]

  result = V_Game.day / 0xA;
  if ( V_Game.day % 0xA )
  {
    return result;
  }
  v13 = (double)(V_Game.day % *(__int16 *)(a1 + 0x1D7)) / (double)*(__int16 *)(a1 + 0x1D7) * 6.28318530716;
  if ( (LODWORD(v13) & 0x7FFFFFFF) == 0 )
  {
    v13 = 0.0099999998;
  }
  v6 = *(float *)(a1 + 0x1DD);
  v7 = sin(v13) * v6;
  v9 = *(float *)(a1 + 0x1E1);
  v10 = sin(v13 * 0.5) * v9 + v7;
  v8 = *(float *)(a1 + 0x1E5);
  v14 = sin(v13 * 2.0) * v8 + v10;
  if ( v14 >= 0.0 )
  {
    v3 = v14 + 0.5;
  }
  else
  {
    v3 = v14 + -0.5;
  }
  v15 = v3;
  v11 = (float)*(__int16 *)(a1 + 0x1D9);
  if ( v15 > (double)v11 )
  {
    v4 = (float)*(__int16 *)(a1 + 0x1D9);
LABEL_11:
    v15 = v4;
    goto LABEL_12;
  }
  v12 = (float)*(__int16 *)(a1 + 0x1DB);
  if ( v15 < (double)v12 )
  {
    v4 = (float)*(__int16 *)(a1 + 0x1DB);
    goto LABEL_11;
  }
LABEL_12:
  if ( *(_BYTE *)a1 == V_RaceIndex )
  {
    word_104BE8 = (int)v15;
  }
  if ( V_Game.Unknown_D8A[0x2A] == 2 )
  {
    v5 = v15 + -6.0;
  }
  else if ( V_Game.Unknown_D8A[0x2A] )
  {
    v5 = v15 + -2.0;
  }
  else
  {
    v5 = v15 + -4.0;
  }
  for ( result = 0; (__int16)result < V_Game.racesNum; ++result )
  {
    if ( *(_BYTE *)((__int16)result + a1 + 0x1C0) )
    {
      if ( !V_Game.races[(__int16)result].Unknown_03 )
      {
        v16 = v5;
        *(_WORD *)(a1 + 2 * (__int16)result + 0x1B2) = (int)((double)*(__int16 *)(a1 + 2 * (__int16)result + 0x1B2) + v16);
      }
    }
  }
  return result;
}
// 104BE8: using guessed type __int16 word_104BE8;

//----- (0003CB60) --------------------------------------------------------
int __fastcall sub_3CB60(P_Race pRace, P_Planet pPlanet, unsigned __int8 a3)
{
  T_Ship *v5; // eax
  int v6; // ebp
  int v7; // [esp+0h] [ebp-14h]

  if ( pPlanet->industry )
  {
    if ( sub_35930(pPlanet, 0x16) == 0xFFFF )
    {
      if ( (V_Game.day > 170 || V_Game.Unknown_D8A[0x2A] == 2)
        && ((1 << pRace->index) & V_ResTree.items[V_PlanetItems.item[0x16].resReq].Unknown_48) != 0 )
      {
        if ( !sub_34AE4(pPlanet, 0x16u, 0) )
        {
          return 2;
        }
        return 1;
      }
    }
    else if ( sub_362E0(pPlanet) && (pPlanet->raceIndex != V_RaceIndex || V_FlashPopExists == 0xFFFFFFFF) )
    {
      v7 = sub_34AE4(pPlanet, 0x17u, 0);
      if ( v7 != 0xFFFF )
      {
        v5 = sub_40144(pRace, pPlanet);
        v6 = (int)v5;
        if ( !v5 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x537);
        }
        sub_3F060(&pRace->index, v5, (int)pPlanet, a3);
        sub_35B04((int)pPlanet, v7, v6);
        return 1;
      }
    }
  }
  return 0;
}

//----- (0003CC90) --------------------------------------------------------
unsigned int __fastcall Q_NC_sub_3CC90(_BYTE *a1, unsigned __int8 a2)
{
  if ( a2 < 39u && ((1 << *a1) & V_ResTree.items[V_PlanetItems.item[a2].resReq].Unknown_48) != 0 )
  {
    return 0xFFFFFFFF;
  }
  else
  {
    return 0;
  }
}

//----- (0003CCE4) --------------------------------------------------------
unsigned int __fastcall sub_3CCE4(P_Race pRace, P_Planet pPlanet)
{
  unsigned int v3; // ebp
  int v4; // edi
  int industry; // ebx
  int research; // ebx
  int v7; // ecx
  int v8; // kr04_4
  char v9; // al
  __int16 v10; // ax
  int pUnknown_10; // eax
  T_PlanetItem *v12; // ebx
  unsigned __int8 *v13; // edi
  int ind; // eax
  int v15; // edi
  signed __int8 pros; // al
  int v17; // edi
  unsigned __int8 *v18; // eax
  signed __int8 res; // ah
  int v20; // edi
  unsigned __int8 *v21; // eax
  char *v22; // edi
  int v23; // kr0C_4
  int v24; // kr14_4
  int resReq; // ebx
  char v26; // bl
  UBYTE v27; // bh
  _DWORD v29[3]; // [esp+0h] [ebp-F8h]
  int v30; // [esp+Ch] [ebp-ECh]
  int v31; // [esp+10h] [ebp-E8h]
  int v32; // [esp+18h] [ebp-E0h]
  int v33; // [esp+1Ch] [ebp-DCh]
  int v34; // [esp+20h] [ebp-D8h]
  int v35; // [esp+24h] [ebp-D4h]
  int v36; // [esp+28h] [ebp-D0h]
  int v37; // [esp+2Ch] [ebp-CCh]
  int v38; // [esp+30h] [ebp-C8h]
  int v39; // [esp+34h] [ebp-C4h]
  int v40; // [esp+38h] [ebp-C0h]
  int v41; // [esp+3Ch] [ebp-BCh]
  int v42; // [esp+44h] [ebp-B4h]
  int v43; // [esp+48h] [ebp-B0h]
  int v44; // [esp+4Ch] [ebp-ACh]
  int v45; // [esp+50h] [ebp-A8h]
  int v46; // [esp+9Ch] [ebp-5Ch]
  int v47; // [esp+A0h] [ebp-58h]
  int v48; // [esp+A4h] [ebp-54h]
  int v49; // [esp+A8h] [ebp-50h]
  float v50; // [esp+ACh] [ebp-4Ch]
  float v51; // [esp+B0h] [ebp-48h]
  int a3; // [esp+B4h] [ebp-44h]
  float v53; // [esp+B8h] [ebp-40h]
  int v54; // [esp+BCh] [ebp-3Ch]
  float v55; // [esp+C0h] [ebp-38h]
  float v56; // [esp+C4h] [ebp-34h]
  int v57; // [esp+C8h] [ebp-30h]
  int v58; // [esp+CCh] [ebp-2Ch]
  int v59; // [esp+D0h] [ebp-28h]
  int v60; // [esp+D4h] [ebp-24h]
  int v61; // [esp+D8h] [ebp-20h]
  float v62; // [esp+DCh] [ebp-1Ch]
  int a2; // [esp+E0h] [ebp-18h]
  int v64; // [esp+E4h] [ebp-14h]
  int v65; // [esp+E8h] [ebp-10h]
  int v66; // [esp+ECh] [ebp-Ch]
  int v67; // [esp+F0h] [ebp-8h]
  unsigned __int8 v68; // [esp+F4h] [ebp-4h]

  v3 = 0;
  v54 = 0;
  v57 = 0xFFFFFFFF;
  v55 = 0.0;
  v53 = 1.0;
  v50 = 1.0;
  v56 = 1.0;
  *(float *)&a3 = 1.0;
  v51 = 1.0;
  v46 = 0;
  v66 = 0;
  v49 = 0;
  v64 = 0;
  a2 = 0;
  v4 = sub_36158(pPlanet);
  if ( V_PlanetItems.item[0x13].resReq == 0xFF
    || ((1 << pPlanet->raceIndex) & V_ResTree.items[V_PlanetItems.item[0x13].resReq].Unknown_48) != 0 )
  {
    a2 = 0xFFFFFFFF;
  }
  if ( V_PlanetItems.item[0x13].resReq == 0xFF
    || ((1 << pPlanet->raceIndex) & V_ResTree.items[V_PlanetItems.item[0x13].resReq].Unknown_48) != 0 )
  {
    v64 = 0xFFFFFFFF;
  }
  if ( pPlanet->maximumPopulation - pPlanet->word42 > 0 )
  {
    v46 = 0xFFFFFFFF;
  }
  if ( sub_40590(pRace) )
  {
    v54 = 0xFFFFFFFF;
  }
  if ( (unsigned __int16)pPlanet->prosperity < 2u )
  {
    v66 = 0xFFFFFFFF;
    v56 = 2.0;
    v3 = 4;
  }
  if ( pPlanet->word1C || pPlanet->maximumPopulation - pPlanet->word42 <= 3 || !v64 )
  {
    if ( (unsigned __int16)pPlanet->word1C > 1u && pPlanet->maximumPopulation - pPlanet->word42 < 2 )
    {
      v3 = 8;
      if ( v46 == 0xFFFFFFFF )
      {
        *(float *)&a3 = 0.0;
      }
    }
  }
  else
  {
    *(float *)&a3 = 0.5;
    v49 = 0xFFFFFFFF;
  }
  if ( v4 < 4 )
  {
    v51 = 2.0;
    if ( !v3 )
    {
      v3 = 0x10;
    }
  }
  if ( v54 )
  {
    v50 = 0.0;
  }
  if ( pPlanet->word42 - (unsigned __int16)pPlanet->word4C <= (unsigned __int16)pPlanet->prosperity
    || (unsigned __int16)pPlanet->prosperity >= 3u )
  {
    if ( pPlanet->word42 - (unsigned __int16)pPlanet->word4C < (unsigned __int16)pPlanet->prosperity
      || (unsigned __int16)pPlanet->prosperity > 5u )
    {
      v56 = 0.5;
    }
  }
  else
  {
    v56 = 2.0;
    if ( !v3 )
    {
      v3 = 4;
    }
  }
  industry = pPlanet->industry;
  if ( (unsigned __int16)industry < 0x19u )
  {
    if ( pPlanet->industry )
    {
      v47 = 0x19 / industry;
      v53 = (float)(0x19 / industry);
    }
    else
    {
      v53 = 25.0;
    }
    if ( !v3 )
    {
      v3 = 2;
    }
  }
  if ( !v54 )
  {
    research = pPlanet->research;
    if ( (unsigned __int16)research < 0x19u )
    {
      if ( pPlanet->research )
      {
        v47 = 0x19 / research;
        v53 = (float)(0x19 / research);
      }
      else
      {
        v53 = 25.0;
      }
      if ( !v3 )
      {
        v3 = 1;
      }
    }
  }
  if ( 5 * v4 < 2 * pPlanet->word18 )
  {
    v51 = 1.5;
    if ( !v3 )
    {
      v3 = 0x10;
    }
  }
  v7 = 0;
  v8 = 0;
  while ( v7 < pPlanet->word18 )
  {
    pUnknown_10 = (int)pPlanet->pUnknown_10;
    LOBYTE(pUnknown_10) = *(_BYTE *)(4 * v8 + pUnknown_10 + 1);
    v60 = 0;
    v59 = 0;
    v61 = 0;
    v58 = 0;
    v48 = 0;
    v12 = &V_PlanetItems.item[(unsigned __int8)pUnknown_10];
    if ( (_BYTE)pUnknown_10 != 0xFF
      && (_BYTE)pUnknown_10 != 4
      && (_BYTE)pUnknown_10 != 6
      && (_BYTE)pUnknown_10 != 7
      && (_BYTE)pUnknown_10 != 8
      && (_BYTE)pUnknown_10 != 0x13
      && (_BYTE)pUnknown_10 != 5
      && (_BYTE)pUnknown_10 != 0xB
      && (_BYTE)pUnknown_10 != 0xC
      && (_BYTE)pUnknown_10 != 0xD
      && (_BYTE)pUnknown_10 != 0xE
      && (_BYTE)pUnknown_10 != 0xF
      && (_BYTE)pUnknown_10 != 0x11
      && (_BYTE)pUnknown_10 != 0x10
      && ((_BYTE)pUnknown_10 != 0x12 || a2 && (v3 == 0x10 || !v3))
      && ((_BYTE)pUnknown_10 != 3 || v49)
      && ((_BYTE)pUnknown_10 != 0x14 || v46)
      && ((_BYTE)pUnknown_10 != 9 && (_BYTE)pUnknown_10 != 0xA || v54) )
    {
      v13 = (unsigned __int8 *)pPlanet->pUnknown_10 + 4 * v8;
      LOWORD(pUnknown_10) = *((_WORD *)v13 + 1) & 1;
      v67 = pUnknown_10;
      HIWORD(ind) = 0;
      if ( (_WORD)v67 )
      {
        if ( v12->ind )
        {
          ind = (char)v12->ind;
          v15 = *v13;
          v60 += ind;
          if ( v15 == 2 )
          {
            ++v60;
          }
        }
        pros = v12->pros;
        if ( pros )
        {
          v17 = pros + v61;
          v18 = (unsigned __int8 *)pPlanet->pUnknown_10;
          v61 = v17;
          ind = v18[4 * v8];
          if ( ind == 3 )
          {
            ind = v17 + 1;
            v61 = v17 + 1;
          }
        }
        res = v12->res;
        if ( res )
        {
          v20 = res + v59;
          v21 = (unsigned __int8 *)pPlanet->pUnknown_10;
          v59 = v20;
          ind = v21[4 * v8];
          if ( ind == 4 )
          {
            v59 = v20 + 1;
          }
        }
        v22 = (char *)pPlanet->pUnknown_10 + 4 * v8;
        if ( v22[1] != (char)0xFF )
        {
          LOWORD(ind) = *((_WORD *)v22 + 1) & 1;
          v67 = ind;
          if ( (_BYTE)ind )
          {
            v9 = v22[1];
            if ( (unsigned __int8)v9 >= 0x12u )
            {
              if ( (unsigned __int8)v9 <= 0x12u )
              {
                v48 += 2;
              }
              else if ( v9 == 0x13 )
              {
                v48 += 4;
              }
            }
          }
        }
        v58 += (char)v12->mpop;
      }
      v62 = (double)v60 * v53;
      v62 = (double)v59 * v50 + v62;
      v62 = (double)v61 * v56 + v62;
      v10 = *((_WORD *)pPlanet->pUnknown_10 + 2 * v8 + 1);
      v62 = (double)v58 * *(float *)&a3 + v62;
      v62 = (double)v48 * v51 + v62;
      if ( (v10 & 2) != 0 )
      {
        v62 = v62 + v56;
      }
      if ( v57 == 0xFFFFFFFF || v62 < (double)v55 )
      {
        v57 = v7;
        v55 = v62;
      }
    }
    ++v7;
    ++v8;
  }
  if ( v57 == 0xFFFFFFFF )
  {
    return 0;
  }
  v65 = rand() % 0x64;
  v23 = 0;
  v24 = 0;
  do
  {
    resReq = V_PlanetItems.item[v24].resReq;
    if ( resReq == 0xFF || ((1 << pPlanet->raceIndex) & V_ResTree.items[resReq].Unknown_48) != 0 )
    {
      v29[v23] = 0xFFFFFFFF;
    }
    else
    {
      v29[v23] = 0;
    }
    ++v23;
    ++v24;
  }
  while ( v23 != 0x27 );
  v68 = 0xFF;
  v26 = *((_BYTE *)pPlanet->pUnknown_10 + 4 * v57 + 1);
  v27 = v26;
  if ( (v26 == 2 || v26 == 9 || v26 == 0xA) && v54 == 0xFFFFFFFF )
  {
    if ( v66 == 0xFFFFFFFF )
    {
      v26 = 1;
    }
    else if ( v65 >= 0x19 )
    {
      v26 = 0;
    }
    else
    {
      v26 = 0x12;
    }
  }
  if ( v3 < 2 )
  {
    if ( !v3 )
    {
      goto LABEL_222;
    }
    if ( !v54 )
    {
      v26 = 2;
      goto LABEL_222;
    }
LABEL_123:
    v26 = 0;
    goto LABEL_222;
  }
  if ( v3 <= 2 )
  {
    goto LABEL_123;
  }
  if ( v3 < 8 )
  {
    v26 = 1;
  }
  else if ( v3 <= 8 )
  {
    v26 = 0x14;
  }
  else
  {
    v26 = 0x12;
  }
LABEL_222:
  if ( (unsigned __int8)v26 < 2u )
  {
    if ( v26 )
    {
      if ( sub_35930(pPlanet, 0xD) == 0xFFFF && v39 )
      {
        v68 = 0xD;
        goto LABEL_136;
      }
      if ( !v66 && sub_35930(pPlanet, 0xF) == 0xFFFF && v41 )
      {
        v68 = 0xF;
        goto LABEL_136;
      }
      if ( !v66 && sub_35930(pPlanet, 0x11) == 0xFFFF && v42 )
      {
        v68 = 0x11;
        goto LABEL_136;
      }
      if ( !v66 && sub_35930(pPlanet, 0xB) == 0xFFFF && v37 )
      {
        v68 = 0xB;
        goto LABEL_136;
      }
      if ( v31 && v33 )
      {
        if ( v65 < 0x32 && !v54 )
        {
          v68 = 4;
          goto LABEL_136;
        }
      }
      else
      {
        if ( v31 && !v54 )
        {
          v68 = 4;
          goto LABEL_136;
        }
        if ( !v33 )
        {
          if ( !v35 || v54 )
          {
            if ( v27 != v26 && v29[1] )
            {
              v68 = 1;
            }
          }
          else
          {
            v68 = 9;
          }
          goto LABEL_136;
        }
      }
      v68 = 7;
      goto LABEL_136;
    }
    if ( sub_35930(pPlanet, 0xC) == 0xFFFF && v38 )
    {
      v68 = 0xC;
      goto LABEL_136;
    }
    if ( sub_35930(pPlanet, 0x11) == 0xFFFF && v42 )
    {
      v68 = 0x11;
      goto LABEL_136;
    }
    if ( sub_35930(pPlanet, 0xB) == 0xFFFF && v37 )
    {
      v68 = 0xB;
      goto LABEL_136;
    }
    if ( v31 && v32 )
    {
      if ( v65 < 0x32 && !v54 )
      {
        v68 = 4;
        goto LABEL_136;
      }
    }
    else
    {
      if ( v31 && !v54 )
      {
        v68 = 4;
        goto LABEL_136;
      }
      if ( !v32 )
      {
        if ( !v36 || v54 )
        {
          if ( v27 && v29[0] )
          {
            v68 = 0;
          }
        }
        else
        {
          v68 = 0xA;
        }
        goto LABEL_136;
      }
    }
    v68 = 6;
    goto LABEL_136;
  }
  if ( (unsigned __int8)v26 <= 2u )
  {
    if ( sub_35930(pPlanet, 0xE) == 0xFFFF && v40 )
    {
      v68 = 0xE;
    }
    else if ( sub_35930(pPlanet, 0x11) == 0xFFFF && v42 )
    {
      v68 = 0x11;
    }
    else if ( sub_35930(pPlanet, 0xB) == 0xFFFF && v37 )
    {
      v68 = 0xB;
    }
    else if ( v34 )
    {
      v68 = 8;
    }
    else if ( v31 )
    {
      v68 = 4;
    }
    else if ( v36 )
    {
      v68 = 0xA;
    }
    else if ( v35 )
    {
      v68 = 9;
    }
    else if ( v27 != v26 && v29[2] )
    {
      v68 = 2;
    }
  }
  else if ( (unsigned __int8)v26 < 0x12u )
  {
    if ( v26 != 3 )
    {
      return 0;
    }
    if ( v31 )
    {
      v68 = 4;
    }
    else if ( v27 != 3 && v30 )
    {
      v68 = 3;
    }
  }
  else if ( (unsigned __int8)v26 <= 0x12u )
  {
    if ( v44 )
    {
      v68 = 0x13;
    }
    else if ( v27 != v26 && v43 )
    {
      v68 = 0x12;
    }
  }
  else
  {
    if ( v26 != 0x14 )
    {
      return 0;
    }
    if ( v31 )
    {
      v68 = 4;
    }
    else if ( v30 )
    {
      v68 = 3;
    }
    else if ( v27 != 0x14 && v45 )
    {
      v68 = 0x14;
    }
  }
LABEL_136:
  if ( v68 < 0x27u && sub_34B0C(pPlanet, (unsigned __int16)v57, v27, 1u) )
  {
    sub_34774(pPlanet, v68, v57, 0);
    return 0xFFFFFFFF;
  }
  return 0;
}
// 3D3C4: conditional instruction was optimized away because ebp.4==10
// 3D3FB: conditional instruction was optimized away because ebp.4==4

//----- (0003D8F0) --------------------------------------------------------
void __fastcall sub_3D8F0(int a1, P_Planet pPlanet)
{
  char *v2; // edi
  int v4; // eax
  T_Planet *v5; // eax
  unsigned __int8 v6; // dl
  int word42; // eax
  int v8; // eax
  int v9; // eax
  int v10; // ebp
  UWORD word4C; // ax
  int v12; // ebp
  int v13; // eax
  int v14; // kr04_4
  char v15; // bl
  T_PlanetItem *v16; // ebx
  int upop; // ebx
  int v18; // ebx
  int v19; // ebp
  int v20; // edi
  int v21; // edx
  int resReq; // eax
  UBYTE raceIndex; // cl
  int ind; // ecx
  T_PlanetItem *v25; // eax
  int v26; // ecx
  __int16 v27; // ax
  int v28; // eax
  int v29; // edi
  int v30; // ebx
  int v31; // kr0C_4
  int v32; // edx
  int v33; // eax
  unsigned __int16 v34; // di
  char v35[5]; // [esp+1h] [ebp-125h]
  _BYTE v36[196]; // [esp+6h] [ebp-120h] BYREF
  int v37; // [esp+CAh] [ebp-5Ch] BYREF
  int v38; // [esp+CEh] [ebp-58h] BYREF
  int v39; // [esp+D2h] [ebp-54h] BYREF
  int maximumPopulation; // [esp+D6h] [ebp-50h]
  int v41; // [esp+DAh] [ebp-4Ch]
  T_Race *v42; // [esp+DEh] [ebp-48h]
  int a3; // [esp+E6h] [ebp-40h]
  int v44; // [esp+EAh] [ebp-3Ch]
  unsigned int v45; // [esp+EEh] [ebp-38h]
  int v46; // [esp+F2h] [ebp-34h]
  int v47; // [esp+F6h] [ebp-30h]
  int v48; // [esp+FAh] [ebp-2Ch]
  int v49; // [esp+FEh] [ebp-28h]
  unsigned __int8 *v50; // [esp+102h] [ebp-24h]
  int v51; // [esp+106h] [ebp-20h]
  int v52; // [esp+10Ah] [ebp-1Ch]
  unsigned __int8 v53; // [esp+10Eh] [ebp-18h]

  v42 = (T_Race *)a1;
  v41 = 0;
  v49 = 0;
  sub_34A44(pPlanet, &v38, &v37, &v39);
  if ( sub_40590(v42) == 0xFFFFFFFF )
  {
    v37 += v38;
    v39 += v38;
    v38 = 0;
  }
  v4 = sub_358F0(pPlanet);
  if ( v4 < 1 )
  {
    if ( v37 > 0 )
    {
LABEL_5:
      v5 = pPlanet;
      v6 = 0;
      goto LABEL_20;
    }
    goto LABEL_18;
  }
  if ( v4 < 2 )
  {
    if ( v39 <= 0 || pPlanet->industry <= 1u )
    {
      goto LABEL_5;
    }
LABEL_18:
    v6 = 1;
    goto LABEL_19;
  }
  if ( v4 >= 3 )
  {
    goto LABEL_21;
  }
  if ( v38 <= 0 || (unsigned __int16)pPlanet->prosperity <= 1u || pPlanet->industry <= 1u )
  {
    if ( v37 > 0 && (unsigned __int16)pPlanet->prosperity > 1u )
    {
      v5 = pPlanet;
      v6 = 0;
      goto LABEL_20;
    }
    goto LABEL_18;
  }
  v6 = 2;
LABEL_19:
  v5 = pPlanet;
LABEL_20:
  if ( sub_34AE4(v5, v6, 0xFFFFFFFF) != 0xFFFF )
  {
    return;
  }
LABEL_21:
  if ( !pPlanet->industry )
  {
    return;
  }
  if ( (unsigned __int16)pPlanet->prosperity < 2u )
  {
    word42 = pPlanet->word42;
    if ( pPlanet->maximumPopulation - (unsigned __int16)word42 < 1 && word42 - (unsigned __int16)pPlanet->word4C < 1 )
    {
      v49 = 0xFFFFFFFF;
    }
  }
  v8 = pPlanet->word42;
  if ( pPlanet->maximumPopulation - (unsigned __int16)v8 < 1 && v8 - (unsigned __int16)pPlanet->word4C < 2 )
  {
    v41 = 0xFFFFFFFF;
  }
  v44 = (__int16)sub_3E1CC((int)v42, pPlanet);
  if ( v44 == 1 )
  {
    return;
  }
  v48 = (sub_3407C(pPlanet) <= 0) - 1;
  v47 = (sub_3420C(pPlanet) <= 0) - 1;
  v9 = sub_34AE4(pPlanet, 0x26u, 0xFFFFFFFF);
  v10 = (v9 == 0xFFFF) - 1;
  sub_34B0C(pPlanet, (unsigned __int16)v9, 0x26u, 1u);
  if ( !pPlanet->word1C || !v48 && !v47 && !v10 )
  {
    goto LABEL_102;
  }
  if ( v10 == 0xFFFFFFFF )
  {
    sub_3E520((int)v42, pPlanet);
    return;
  }
  if ( v48 != 0xFFFFFFFF )
  {
    if ( ((1 << pPlanet->raceIndex) & V_ResTree.items[V_PlanetItems.item[0x24].resReq].Unknown_48) != 0 )
    {
      LOWORD(a3) = sub_35930(pPlanet, 0x15);
      a3 = (unsigned __int16)a3;
      if ( (unsigned __int16)a3 == 0xFFFF )
      {
        if ( sub_34AE4(pPlanet, 0x24u, 0) != 0xFFFF )
        {
          return;
        }
      }
      else
      {
        v34 = a3;
        sub_34B0C(pPlanet, (unsigned __int16)a3, 0x15u, 1u);
        if ( sub_34368(pPlanet, 0x24u, v34) )
        {
          sub_34774(pPlanet, 0x24u, a3, 0);
          return;
        }
      }
      goto LABEL_102;
    }
    if ( pPlanet->word1C > (unsigned int)pPlanet->word20 && v41 != 0xFFFFFFFF && sub_34AE4(pPlanet, 0x15u, 0xFFFFFFFF) != 0xFFFF )
    {
      return;
    }
LABEL_102:
    sub_3CCE4(v42, pPlanet);
    return;
  }
  a3 = 0xFFFFFFFF;
  word4C = pPlanet->word4C;
  v12 = 0;
  if ( word4C < pPlanet->maximumPopulation )
  {
    if ( word4C >= pPlanet->word42 || v44 == 2 )
    {
      return;
    }
  }
  else
  {
    v13 = 0;
    v14 = 0;
    while ( v13 < pPlanet->word18 )
    {
      v2 = (char *)pPlanet->pUnknown_10 + 4 * v14;
      v15 = v2[1];
      if ( v15 != (char)0xFF && v15 != 5 )
      {
        v16 = &V_PlanetItems.item[(unsigned __int8)v2[1]];
        if ( !v16->mpop )
        {
          upop = (char)v16->upop;
          if ( upop > v12 )
          {
            v12 = upop;
            a3 = v13;
          }
        }
      }
      ++v13;
      ++v14;
    }
    if ( a3 == 0xFFFFFFFF )
    {
      Q_debugbreak_sub_26194();
      sub_37040(pPlanet);
      return;
    }
    sub_34B0C(pPlanet, (unsigned __int16)a3, v2[1], 1u);
    if ( (unsigned int)pPlanet->word4C >= pPlanet->word42 )
    {
      return;
    }
  }
  if ( pPlanet->word42 - (unsigned __int16)pPlanet->word4C <= 0 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x85A);
  }
  if ( v49 || sub_3E520((int)v42, pPlanet) != 0xFFFFFFFF )
  {
    v45 = (__int16)sub_3E800(v42, (unsigned __int16 *)pPlanet);
    if ( v45 == 0xFFFFFFFF )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x870);
    }
    v18 = 0;
    v19 = 0;
    v20 = 0;
    v21 = 0;
    do
    {
      while ( 1 )
      {
        if ( (_BYTE)v18 != 5 && v18 < V_PlanetItems.num1 )
        {
          resReq = V_PlanetItems.item[v20].resReq;
          if ( resReq == 0xFF
            || (raceIndex = pPlanet->raceIndex,
                maximumPopulation = V_ResTree.items[resReq].Unknown_48,
                ((1 << raceIndex) & maximumPopulation) != 0) )
          {
            maximumPopulation = pPlanet->maximumPopulation;
            if ( (char)V_PlanetItems.item[v20].upop <= maximumPopulation - (unsigned __int16)pPlanet->word4C )
            {
              break;
            }
          }
        }
LABEL_64:
        ++v18;
        ++v20;
        if ( v18 >= 0x27 )
        {
          goto LABEL_77;
        }
      }
      HIWORD(ind) = HIWORD(v45);
      v25 = &V_PlanetItems.item[v20];
      if ( v45 <= 3 )
      {
        switch ( (unsigned int)v25 )
        {
          case 0u:
            ind = (char)v25->ind;
            if ( !v25->ind )
            {
              goto LABEL_64;
            }
            *(_WORD *)&v36[v21 + 1] = (char)v25->ind;
            break;
          case 1u:
            ind = (char)v25->res;
            if ( !v25->res )
            {
              goto LABEL_64;
            }
            *(_WORD *)&v36[v21 + 1] = (char)v25->res;
            break;
          case 2u:
            ind = (char)v25->pros;
            if ( !v25->pros )
            {
              goto LABEL_64;
            }
            *(_WORD *)&v36[v21 + 1] = (char)v25->pros;
            break;
          case 3u:
            ind = (char)v25->mpop;
            if ( !v25->mpop )
            {
              goto LABEL_64;
            }
            *(_WORD *)&v36[v21 + 1] = (char)v25->mpop;
            break;
        }
      }
      LOWORD(ind) = (char)v25->mpop;
      v51 = ind;
      LOWORD(ind) = (char)v25->pros;
      v26 = ind + v51;
      v52 = v26;
      LOWORD(v26) = (char)v25->res;
      ++v19;
      v51 = v26;
      v27 = (char)v25->ind;
      LOWORD(v26) = v26 + v52;
      v35[v21 + 5] = v18;
      *(_WORD *)&v35[v21 + 8] = v26 + v27;
      v21 += 5;
      ++v18;
      ++v20;
    }
    while ( v18 < 0x27 );
LABEL_77:
    if ( v19 || sub_3CCE4(v42, pPlanet) != 0xFFFFFFFF )
    {
      v28 = rand();
      v29 = 0;
      v53 = 0xFF;
      v46 = v28 % 0x64;
      v30 = 0;
      if ( v19 > 0 )
      {
        v31 = 0;
        while ( 1 )
        {
          v32 = (unsigned __int8)v36[5 * v31];
          v50 = &v36[5 * v31];
          if ( sub_35930(pPlanet, v32) == 0xFFFF )
          {
            break;
          }
          if ( v46 <= 0x41 )
          {
            v33 = *(__int16 *)&v36[5 * v31 + 1];
          }
          else
          {
            v33 = *(__int16 *)&v36[5 * v31 + 3];
          }
          if ( v33 > v29 )
          {
            v29 = v33;
            v53 = *v50;
          }
          ++v30;
          ++v31;
          if ( v30 >= v19 )
          {
            goto LABEL_90;
          }
        }
        if ( V_PlanetItems.item[v36[0]].cost / (int)pPlanet->industry < 0x46 )
        {
          v53 = v36[0];
        }
      }
LABEL_90:
      if ( v53 != 0xFF && sub_34AE4(pPlanet, v53, 0) == 0xFFFF )
      {
        goto LABEL_102;
      }
    }
  }
}
// 3DBF4: variable 'v2' is possibly undefined

//----- (0003E020) --------------------------------------------------------
unsigned int __fastcall sub_3E020(int eax0, P_Planet edx0, unsigned __int8 bl0)
{
  unsigned int result; // eax
  int v5; // ebx
  int v6; // eax
  int v7; // edx
  int word18; // esi
  int v9; // kr00_4
  int v10; // kr04_4
  signed int v11; // eax
  char v12; // cl
  int a3; // [esp+8h] [ebp-18h]
  int a2; // [esp+Ch] [ebp-14h]
  signed int v15; // [esp+10h] [ebp-10h]
  unsigned int v16; // [esp+14h] [ebp-Ch]
  int v17; // [esp+18h] [ebp-8h]

  if ( bl0 > 0x1Eu || bl0 < 0x16u || bl0 == 0x17 )
  {
    return 0;
  }
  v15 = 0;
  v17 = 0xFFFFFFFF;
  a3 = 0;
  v5 = sub_36050(edx0);
  v16 = 0;
  v6 = sub_35FE0(edx0);
  v7 = v6;
  if ( bl0 == 0x1A || bl0 == 0x1B )
  {
    v16 = 0xFFFFFFFF;
  }
  else if ( bl0 == 0x1C || bl0 == 0x1D || bl0 == 0x1E )
  {
    a3 = 0xFFFFFFFF;
  }
  a2 = v6 - 3;
  word18 = edx0->word18;
  v9 = 4 * (unsigned __int16)word18;
  v10 = 0;
  while ( word18 < edx0->word1A )
  {
    v12 = *((_BYTE *)edx0->pUnknown_10 + 4 * v10 + v9 + 1);
    v11 = 0xFFFFFFFF;
    if ( v12 != 0x1A || bl0 == 0x1A )
    {
      if ( v12 != 0x1C || bl0 == 0x1C )
      {
        if ( v12 == 0x1D && bl0 != 0x1D && (!v16 || v7 < v5 - 4) )
        {
          v11 = 4;
          if ( v7 > v5 )
          {
            v11 = 8;
          }
        }
      }
      else if ( !v16 || v7 < v5 - 2 )
      {
        v11 = 2;
        if ( v7 > v5 )
        {
          v11 = 4;
        }
      }
    }
    else if ( !a3 || v5 < a2 )
    {
      v11 = 3;
      if ( v5 > v7 )
      {
        v11 = 6;
      }
    }
    if ( v11 != 0xFFFFFFFF && (v17 == 0xFFFFFFFF || v11 < v15) )
    {
      v17 = word18;
      v15 = v11;
    }
    ++word18;
    ++v10;
  }
  if ( v17 == 0xFFFFFFFF )
  {
    return 0;
  }
  result = sub_34B0C(edx0, (unsigned __int16)v17, *((_BYTE *)edx0->pUnknown_10 + 4 * v17 + 1), 1u);
  if ( result )
  {
    sub_34774(edx0, bl0, v17, 0);
    return 0xFFFFFFFF;
  }
  return result;
}

//----- (0003E1CC) --------------------------------------------------------
int __fastcall sub_3E1CC(int eax0, P_Planet a2)
{
  unsigned __int8 v4; // ch
  int research; // ebx
  int v6; // ebp
  int word42; // eax
  int industry; // edx
  int v9; // eax
  int v10; // edx
  int v11; // edx
  unsigned int v13; // [esp+0h] [ebp-14h]
  int v14; // [esp+8h] [ebp-Ch]
  unsigned __int8 v15; // [esp+Ch] [ebp-8h]
  unsigned __int8 v16; // [esp+10h] [ebp-4h]

  v4 = 0xFF;
  v13 = 0;
  research = a2->research;
  if ( sub_40590((P_Race)eax0) )
  {
    research = 0x3E8;
  }
  if ( sub_358F0(a2) < 5 )
  {
    return 0;
  }
  v14 = sub_35FE0(a2);
  v6 = sub_36050(a2);
  v16 = sub_35DA4(a2);
  v15 = sub_35E24(a2);
  if ( (unsigned __int16)a2->word1E < 2u
    || (word42 = a2->word42, a2->maximumPopulation - (unsigned __int16)word42 < 1) && word42 - (unsigned __int16)a2->word4C < 2
    || (unsigned __int16)a2->prosperity < 2u )
  {
    v13 = 0xFFFFFFFF;
  }
  if ( v14 < 1 && v16 != 0xFF )
  {
    v4 = v16;
  }
  if ( v4 == 0xFF && v6 < 1 && v15 != 0xFF )
  {
    v4 = v15;
  }
  if ( v4 == 0xFF
    && sub_35930(a2, 0x16) == 0xFFFF
    && a2->size > 1u
    && (a2->industry >= 4u || (unsigned __int16)a2->word1C - (unsigned __int16)a2->word20 < 5) )
  {
    if ( (V_ResTree.items[V_PlanetItems.item[0x16].resReq].Unknown_48 & (1 << *(_BYTE *)eax0)) != 0 )
    {
      v4 = 0x16;
    }
  }
  else if ( a2->industry < 4u && sub_3407C(a2) > 0 )
  {
    return 0;
  }
  if ( (a2->industry < 0x14u || research < 0x14) && sub_3407C(a2) > 0 && (v14 > 0 || v16 == 0xFF) && (v6 > 0 || v15 == 0xFF) )
  {
    industry = a2->industry;
    v9 = v6 + v14;
    if ( (unsigned __int16)industry <= research )
    {
      if ( v9 > industry )
      {
        return 0;
      }
    }
    else if ( v9 > research )
    {
      return 0;
    }
  }
  v10 = 0;
  if ( &V_Game.stars[a2->starIndex] == (T_Star *)*(T_Game **)(eax0 + 7) )
  {
    v10 = 6;
  }
  if ( v4 != 0xFF || v6 >= v14 || v15 == 0xFF || v6 >= v10 + 6 )
  {
    if ( v4 == 0xFF && v16 != 0xFF && v10 + 6 > v14 )
    {
      v4 = v16;
    }
  }
  else
  {
    v4 = v15;
  }
  v11 = rand() % 0x64;
  if ( v4 == 0xFF && v11 < 0x14 && sub_34368(a2, 0x19u, 0xFFFFu) && sub_35930(a2, 0x19) == 0xFFFF )
  {
    v4 = 0x19;
  }
  if ( v4 != 0xFF || v6 >= v14 || v15 == 0xFF )
  {
    if ( v4 == 0xFF && v16 != 0xFF )
    {
      v4 = v16;
    }
  }
  else
  {
    v4 = v15;
  }
  if ( v4 != 0xFF )
  {
    if ( !v13 && sub_34AE4(a2, v4, 0) != 0xFFFF )
    {
      return 1;
    }
    if ( sub_3E020(eax0, a2, v4) )
    {
      return 1;
    }
    if ( v4 != v16 || v15 == 0xFF )
    {
      if ( v4 == v15 && v16 != 0xFF && sub_3E020(eax0, a2, v16) )
      {
        return 1;
      }
    }
    else if ( sub_3E020(eax0, a2, v15) )
    {
      return 1;
    }
  }
  return 0;
}

//----- (0003E520) --------------------------------------------------------
unsigned int __fastcall sub_3E520(int a1, P_Planet a2)
{
  unsigned int result; // eax
  int v5; // edx
  int word42; // eax
  int v7; // esi
  int word18; // edx
  int v9; // eax
  UWORD research; // di
  int v11; // edx
  __int16 i; // di
  unsigned __int8 v13; // si
  int v14; // [esp+0h] [ebp-10h]
  char v15; // [esp+4h] [ebp-Ch]
  unsigned __int8 v16; // [esp+8h] [ebp-8h]
  unsigned __int8 v17; // [esp+Ch] [ebp-4h]

  if ( (a2->Unknown_66 & 2) != 0 && sub_34AE4(a2, 0x26u, 0) != 0xFFFF )
  {
    result = 0xFFFFFFFF;
    a2->Unknown_66 &= ~2u;
    return result;
  }
  v5 = 3;
  if ( sub_40590((P_Race)a1) == 0xFFFFFFFF )
  {
    v5 = 0;
  }
  if ( a2->industry < 3u )
  {
    return 0;
  }
  if ( a2->research < v5 )
  {
    return 0;
  }
  if ( (unsigned __int16)a2->prosperity < 2u )
  {
    return 0;
  }
  word42 = a2->word42;
  if ( a2->maximumPopulation - (unsigned __int16)word42 < 1 && word42 - (unsigned __int16)a2->word4C < 2 )
  {
    return 0;
  }
  if ( (unsigned __int16)a2->word1C - (unsigned __int16)a2->word20 < 3 )
  {
    return 0;
  }
  v7 = sub_36158(a2);
  if ( &V_Game.stars[a2->starIndex] == (T_Star *)*(T_Game **)(a1 + 7) )
  {
    word18 = a2->word18;
  }
  else
  {
    word18 = 2 * a2->word18;
  }
  v9 = word18 / 5;
  if ( word18 / 5 < 4 )
  {
    v9 = 4;
  }
  if ( (a2->industry < 0x14u || a2->research < 0x14u) && v7 > 0 )
  {
    research = a2->research;
    v11 = 3 * v7;
    if ( a2->industry <= research )
    {
      if ( v11 <= 2 * a2->industry )
      {
        goto LABEL_25;
      }
    }
    else if ( v11 <= 2 * research )
    {
      goto LABEL_25;
    }
    v9 = v7;
  }
LABEL_25:
  if ( v7 < v9 )
  {
    v16 = 0xFF;
    if ( sub_34368(a2, 0x13u, 0xFFFFu) )
    {
      v16 = 0x13;
    }
    else if ( sub_34368(a2, 0x12u, 0xFFFFu) )
    {
      v16 = 0x12;
    }
    if ( v16 != 0xFF && sub_34AE4(a2, v16, 0) )
    {
      return 0xFFFFFFFF;
    }
  }
  if ( a2->raceIndex % 2
    && a2->industry > 0x14u
    && rand() % 0x64 < 4
    && sub_34368(a2, 0xBu, 0xFFFFu)
    && sub_35930(a2, 0xB) == 0xFFFF
    && sub_34AE4(a2, 0xBu, 0) )
  {
    return 0xFFFFFFFF;
  }
  v14 = unk_96918;
  v15 = *((_BYTE *)&unk_96918 + 4);
  for ( i = 0; i < 5; ++i )
  {
    v17 = *((_BYTE *)&v14 + i);
    if ( (v17 != 0x25 || (a2->Unknown_66 & 1) == 0) && sub_34368(a2, v17, 0xFFFFu) && (sub_40590((P_Race)a1) == 0xFFFFFFFF || v17 != 0xE) )
    {
      v13 = v17;
      if ( sub_35930(a2, v17) == 0xFFFF )
      {
        if ( sub_34AE4(a2, v13, 0) )
        {
          return 0xFFFFFFFF;
        }
      }
    }
  }
  return 0;
}

//----- (0003E800) --------------------------------------------------------
int __fastcall sub_3E800(_BYTE *a1, unsigned __int16 *a2)
{
  int v3; // ebx
  int v4; // eax
  int v5; // eax
  int v7; // eax
  int v8; // eax
  int v9; // ebx
  int v10; // ecx
  int v11; // [esp+0h] [ebp-1Ch] BYREF
  int v12; // [esp+4h] [ebp-18h] BYREF
  int v13[5]; // [esp+8h] [ebp-14h] BYREF

  sub_34A44((T_Planet *)a2, &v12, &v11, v13);
  v3 = sub_40590((P_Race)a1);
  if ( v3 == 0xFFFFFFFF )
  {
    v4 = v12;
    v12 = 0;
    v11 += v4;
    v13[0] += v4;
  }
  v5 = a2[0x21];
  if ( a2[0x25] - (unsigned __int16)v5 >= 2 || v5 - a2[0x26] >= 2 )
  {
    if ( a2[0x22] < 3u && v11 > 0 )
    {
      return 0;
    }
    if ( a2[0x23] < 3u && v12 > 0 && !v3 )
    {
      return 1;
    }
    if ( a2[0x24] < 2u && v13[0] > 0 )
    {
      return 2;
    }
    if ( a2[0x22] < 4u && v11 > 0 )
    {
      return 0;
    }
    if ( a2[0x24] < 3u && v13[0] > 0 )
    {
      return 2;
    }
    if ( a2[0x23] < 5u && v12 > 0 && !v3 )
    {
      return 1;
    }
    if ( !a2[0x24] )
    {
      return 2;
    }
    if ( a2[0x24] < 2u )
    {
      v7 = a2[0x21];
      if ( a2[0x25] - (unsigned __int16)v7 < 1 && v7 - a2[0x26] < 1 )
      {
        return 2;
      }
    }
    if ( v13[0] > 0 && V_PlanItem50 / a2[0x24] > 0xF )
    {
      v8 = a2[0x21];
      if ( a2[0x25] - (unsigned __int16)v8 > 3 && v8 - a2[0x26] != 1 )
      {
        return 2;
      }
    }
    if ( v3 == 0xFFFFFFFF )
    {
      if ( v11 > 0 )
      {
        return 0;
      }
      if ( v13[0] > 0 && a2[0x24] < 5u )
      {
        return 2;
      }
    }
    else
    {
      v9 = a2[0x22];
      v10 = a2[0x23];
      if ( sub_35930((P_Planet)a2, 0xC) != 0xFFFF )
      {
        v10 += v9 >> 1;
      }
      if ( sub_35930((P_Planet)a2, 0xE) != 0xFFF )
      {
        v9 += v10 >> 1;
      }
      if ( (v9 > v10 || v11 <= 0) && v12 > 0 )
      {
        return 1;
      }
      if ( v11 > 0 )
      {
        return 0;
      }
      if ( v13[0] > 0 )
      {
        return 2;
      }
    }
  }
  return 3;
}
// 9684C: using guessed type int V_PlanItem50;
// 3E800: using guessed type int var_14[5];

//----- (0003EA7C) --------------------------------------------------------
__int16 __fastcall sub_3EA7C(_BYTE *a1)
{
  signed __int16 v2; // si
  int v3; // eax
  int v4; // edi
  __int16 i; // si
  __int16 j; // ax
  __int16 v8[32]; // [esp+0h] [ebp-90h]
  __int16 v9[24]; // [esp+40h] [ebp-50h] BYREF
  int v10; // [esp+70h] [ebp-20h]
  int v11; // [esp+74h] [ebp-1Ch]

  v2 = 0;
  v10 = 0;
  while ( 1 )
  {
    LOWORD(v3) = V_ResTree.num;
    if ( v2 >= (int)V_ResTree.num )
    {
      break;
    }
    v4 = (unsigned __int16)v10;
    if ( (unsigned __int16)v10 >= 0x20u )
    {
      break;
    }
    if ( ((1 << *a1) & V_ResTree.items[v2].Unknown_48) == 0 )
    {
      if ( sub_4694C((int)&V_ResTree, v2, (unsigned __int8)*a1) )
      {
        v8[v4] = v2;
        v10 = v4 + 1;
      }
    }
    ++v2;
  }
  LOWORD(v11) = 0xFFFF;
  if ( (_WORD)v10 )
  {
    qmemcpy(v9, &unk_9691E, 0x2Eu);
    if ( ((1 << *a1) & V_ResTree.items[5].Unknown_48) != 0 && rand() % 0x64 < 0x2D )
    {
      LOWORD(v11) = 0xFFFE;
    }
    for ( i = 0; i < (int)(unsigned __int16)v10 && (__int16)v11 == 0xFFFFFFFF; ++i )
    {
      for ( j = 0; j < 0x17 && (__int16)v11 == 0xFFFFFFFF; ++j )
      {
        if ( v9[j] == v8[i] )
        {
          LOWORD(v11) = v8[i];
        }
      }
    }
    if ( (v11 & 0x8000u) != 0 )
    {
      LOWORD(v11) = v8[rand() % (unsigned __int16)v10];
    }
    v3 = (unsigned __int8)*a1;
    V_ResTree.a.w1[v3] = v11;
  }
  return v3;
}
// 3EA7C: using guessed type __int16 var_90[32];
// 3EA7C: using guessed type __int16 var_50[24];

//----- (0003EBDC) --------------------------------------------------------
char __fastcall sub_3EBDC(unsigned __int8 *pPlanet, T_Ship *a2)
{
  T_Race *v2; // ecx
  UBYTE locationType; // ah
  P_Location v4; // esi
  int y_low; // eax
  int v6; // eax
  int v7; // eax
  int v8; // esi
  int v9; // kr04_4
  int i; // kr0C_4
  int v11; // eax
  int v12; // ecx
  double v13; // st7
  double v14; // st7
  double v15; // st7
  int racesBits; // eax
  unsigned __int8 *v18; // [esp+4h] [ebp-40h]
  T_Star *stars; // [esp+8h] [ebp-3Ch]
  float v20; // [esp+Ch] [ebp-38h]
  MACRO_VFX_BOOL v21; // [esp+10h] [ebp-34h]
  int Unknown_15; // [esp+14h] [ebp-30h]
  float v23; // [esp+20h] [ebp-24h]
  float v24; // [esp+20h] [ebp-24h]
  __int16 v25; // [esp+24h] [ebp-20h]
  __int16 v26; // [esp+28h] [ebp-1Ch]
  unsigned __int8 v27; // [esp+2Ch] [ebp-18h]

  v2 = (T_Race *)pPlanet;
  locationType = a2->locationType;
  if ( locationType != 1 && locationType != 2 && locationType != 5 )
  {
    LOBYTE(pPlanet) = V_RaceIndex;
    if ( a2->raceIndex == V_RaceIndex && V_FlashPopExists == FALSE )
    {
      a2->Unknown_5D = 0;
      a2->Unknown_5E = 0;
      return (char)pPlanet;
    }
    if ( a2->locationType == 4 && a2->Unknown_5D == 1 )
    {
      v4.pPlanet = (P_Planet)a2->pLocation;
      if ( !v4.pPlanet )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xBBC);
      }
      if ( a2->Unknown_28 )
      {
        y_low = SLOWORD(v4.pPlanet->v.y);
        if ( *((char *)&dword_104FD1 + y_low + 3) > 0 )
        {
          --*((_BYTE *)&dword_104FD1 + y_low + 3);
        }
      }
      else if ( Q_ShipHasGizmo_sub_4A534(a2, 0x49) )
      {
        v6 = SLOWORD(v4.pPlanet->v.y);
        if ( *((char *)&dword_104F6D + v6 + 3) > 0 )
        {
          --*((_BYTE *)&dword_104F6D + v6 + 3);
        }
      }
      else
      {
        v7 = SLOWORD(v4.pPlanet->v.y);
        if ( *((char *)&dword_104F09 + v7 + 3) > 0 )
        {
          --*((_BYTE *)&dword_104F09 + v7 + 3);
        }
      }
      a2->Unknown_5D = 0;
      a2->Unknown_5E = 0;
    }
    LOBYTE(pPlanet) = a2->Unknown_5D;
    if ( !(_BYTE)pPlanet )
    {
      if ( a2->locationType == 3 && sub_35C38(a2->pLocation.pPlanet, a2) != 0xFFFFFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xBE7);
      }
      if ( a2->locationType != 4 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xBEB);
      }
      pPlanet = (unsigned __int8 *)a2->pLocation.pPlanet;
      v18 = pPlanet;
      if ( !pPlanet )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xBEF);
      }
      if ( a2->Unknown_28 == 0xFFFFFFFF )
      {
        pPlanet = (unsigned __int8 *)sub_403C0(&v2->index, (int)a2->pLocation.pPlanet);
        if ( pPlanet )
        {
          a2->Unknown_5D = 2;
          a2->Unknown_5E = (int)pPlanet;
          return (char)pPlanet;
        }
      }
      if ( a2->Unknown_8 > 0 || a2->Unknown_C > 0 )
      {
        v8 = 0;
        v20 = 0.0;
        v25 = 0;
        stars = 0;
        v21 = Q_ShipHasGizmo_sub_4A534(a2, 0x49);
        v27 = sub_43374(v2, 0xFFFFFFFF);
        v9 = 0;
        for ( i = 0; ; ++i )
        {
          if ( v8 >= V_Game.starsNum )
          {
            LOBYTE(pPlanet) = (_BYTE)stars;
            if ( stars )
            {
              if ( stars != (T_Star *)v18 )
              {
                pPlanet = (unsigned __int8 *)sub_4AA78((int)a2, (int)stars);
                if ( (int)pPlanet > 0 )
                {
                  LOBYTE(pPlanet) = v25;
                  if ( v25 != *((_WORD *)v18 + 2) )
                  {
                    if ( a2->Unknown_28 )
                    {
                      LOBYTE(pPlanet) = v25;
                      ++*((_BYTE *)&dword_104FD1 + v25 + 3);
                    }
                    else
                    {
                      LOBYTE(pPlanet) = v25;
                      if ( v21 )
                      {
                        ++*((_BYTE *)&dword_104F6D + v25 + 3);
                      }
                      else
                      {
                        ++*((_BYTE *)&dword_104F09 + v25 + 3);
                      }
                    }
                  }
                }
              }
            }
            return (char)pPlanet;
          }
          if ( dword_104BEC[v9] > 0 || dword_104D7C[v9] > 0 )
          {
            break;
          }
LABEL_56:
          ++v8;
          ++v9;
        }
        v26 = sub_4AA78((int)a2, (int)V_Game.stars);
        racesBits = V_Game.stars[0].racesBits;
        Unknown_15 = (unsigned __int8)V_Game.stars[0].Unknown_15;
        if ( ((racesBits | Unknown_15) & v27) != 0 )
        {
          if ( a2->Unknown_28 )
          {
            if ( ((unsigned __int8)racesBits & v27) != 0 && (v27 & (unsigned __int8)Unknown_15) == 0 )
            {
              if ( *((char *)&dword_104FD1 + v8 + 3) <= 0 )
              {
                v14 = (double)dword_104BEC[v9];
                goto LABEL_53;
              }
LABEL_35:
              v23 = 0.0;
              goto LABEL_54;
            }
LABEL_36:
            v23 = 0.0;
            goto LABEL_54;
          }
          if ( v21 )
          {
            if ( ((unsigned __int8)racesBits & v27) == 0 )
            {
              goto LABEL_35;
            }
            v11 = *((char *)&dword_104F6D + v8 + 3);
            v23 = (float)dword_104BEC[v9];
            if ( v11 <= 1 )
            {
              goto LABEL_54;
            }
            LOBYTE(v12) = v11 - 1;
          }
          else
          {
            if ( ((unsigned __int8)racesBits & v27) != 0 )
            {
              v13 = (double)(dword_104D7C[v9] + dword_104BEC[v9]);
            }
            else
            {
              v13 = (double)dword_104D7C[v9];
            }
            v23 = v13;
            if ( *((char *)&dword_104F09 + v8 + 3) <= 0 )
            {
              goto LABEL_54;
            }
            LOBYTE(v12) = *((_BYTE *)&dword_104F09 + v8 + 3);
          }
        }
        else
        {
          if ( a2->Unknown_28 )
          {
            if ( *((char *)&dword_104FD1 + v8 + 3) > 0 )
            {
              goto LABEL_36;
            }
            v14 = (double)dword_104BEC[v9];
LABEL_53:
            v23 = v14;
            goto LABEL_54;
          }
          if ( v21 )
          {
            v23 = *(float *)&a2->Unknown_28;
            goto LABEL_54;
          }
          v12 = *((char *)&dword_104F09 + v8 + 3);
          v23 = (float)dword_104D7C[v9];
          if ( v12 <= 0 )
          {
LABEL_54:
            v15 = v23 / (double)(v26 / 0x19 + 1);
            if ( v15 > v20 )
            {
              stars = V_Game.stars;
              v25 = v8;
              v24 = v15;
              v20 = v24;
            }
            goto LABEL_56;
          }
        }
        v14 = v23 / (double)(1 << v12);
        goto LABEL_53;
      }
    }
  }
  return (char)pPlanet;
}
// 104BEC: using guessed type int dword_104BEC[100];
// 104D7C: using guessed type int dword_104D7C[99];
// 104F09: using guessed type int dword_104F09;
// 104F6D: using guessed type int dword_104F6D;
// 104FD1: using guessed type int dword_104FD1;

//----- (0003EFE0) --------------------------------------------------------
int __fastcall sub_3EFE0(P_Race pRace)
{
  int v2; // ebx
  int ShipsNum_sub_40224; // ebp
  int v4; // eax
  int i; // kr04_4
  int result; // eax

  v2 = 1;
  ShipsNum_sub_40224 = Q_Race_GetShipsNum_sub_40224(pRace, 0, 0);
  v4 = 0;
  for ( i = 0; (__int16)v4 < V_Game.starsNum; ++i )
  {
    if ( V_Game.stars[i].racesBits == 1 << pRace->index )
    {
      ++v2;
    }
    ++v4;
  }
  result = v2 - ShipsNum_sub_40224;
  if ( ((1 << pRace->index) & pRace->star->racesBits) != 0 )
  {
    ++result;
  }
  return result;
}

//----- (0003F060) --------------------------------------------------------
__int16 __fastcall sub_3F060(unsigned __int8 *a1, P_Ship pShip, int a3, unsigned __int8 a4)
{
  int v6; // eax
  __int16 v7; // cx
  int v8; // edx
  char v9; // bl
  char v10; // bh
  __int16 result; // ax
  int v12; // [esp+0h] [ebp-26h]
  __int16 v13; // [esp+6h] [ebp-20h]
  char v14; // [esp+Ah] [ebp-1Ch]
  char v15; // [esp+Eh] [ebp-18h]
  char v16; // [esp+12h] [ebp-14h]

  if ( !a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xCD0);
  }
  v13 = 0;
  v6 = 1 << *a1;
  if ( (v6 & V_ResTree.items[1].Unknown_48) != 0 )
  {
    v13 = 1;
    if ( (v6 & V_ResTree.items[0x13].Unknown_48) != 0 )
    {
      v13 = 2;
      if ( (v6 & V_ResTree.items[0x1F].Unknown_48) != 0 )
      {
        v13 = 3;
      }
    }
  }
  if ( !v13 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xCE2);
  }
  HIWORD(v12) = V_Game.day / 0xFA;
  v7 = v13;
  if ( SHIWORD(v12) >= 1 )
  {
    if ( SHIWORD(v12) > 8 )
    {
      HIWORD(v12) = 8;
    }
  }
  else
  {
    HIWORD(v12) = 1;
  }
  while ( v7 >= 0 )
  {
    sub_49148(pShip, v7);
    v8 = sub_4A18C(pShip) + pShip->hullCellsNum * (v12 >> 0x10);
    if ( !*(_WORD *)(a3 + 0x44) )
    {
      *(_WORD *)(a3 + 0x44) = 1;
    }
    if ( v8 / *(unsigned __int16 *)(a3 + 0x44) + 1 < *((__int16 *)a1 + 0xD8) )
    {
      break;
    }
    --v7;
  }
  if ( v7 < 0 )
  {
    v7 = 0;
  }
  sub_49148(pShip, v7);
  v15 = sub_4A36C(pShip, 0, *a1);
  v14 = sub_4A36C(pShip, 4, *a1);
  v16 = sub_4A36C(pShip, 2, *a1);
  v9 = sub_4A36C(pShip, 1, *a1);
  v10 = 0x2B;
  if ( sub_4A404((int)pShip, 0x2C) )
  {
    v10 = 0x2C;
  }
  if ( v14 == (char)0xFF )
  {
    v14 = 0x1B;
  }
  if ( v16 == (char)0xFF )
  {
    v16 = 0x10;
  }
  if ( v15 == (char)0xFF )
  {
    v15 = 0;
  }
  if ( v9 == (char)0xFF )
  {
    v9 = 0xA;
  }
  result = v7;
  switch ( v7 )
  {
    case 0:
      result = sub_3F324((int)a1, v14, v16, v15, v9, v10, pShip, a4);
      break;
    case 1:
      result = sub_3F3F8(a1, v14, v16, v15, v9, v10, pShip, a4);
      break;
    case 2:
      result = sub_3F784((int)a1, v14, v16, v15, v9, v10, pShip, a4);
      break;
    case 3:
      result = sub_3FBAC((int)a1, v14, v16, v15, v9, v10, pShip, a4);
      break;
    default:
      return result;
  }
  return result;
}
// 3F0F5: conditional instruction was optimized away because %var_20.2 is in (1..3)
// 3F15C: variable 'v12' is possibly undefined

//----- (0003F324) --------------------------------------------------------
unsigned int __fastcall sub_3F324(int a1, char a2, char a3, char a4, int a5, char a6, _DWORD *a7, unsigned __int8 a8)
{
  sub_492AC(a7, a2, 0);
  sub_492AC(a7, a3, 1);
  sub_492AC(a7, a6, 2);
  if ( a8 )
  {
    if ( a8 > 1u && a8 == 2 )
    {
      sub_492AC(a7, 0x49, 3);
      return sub_492AC(a7, 0x49, 4);
    }
    else
    {
      sub_492AC(a7, a4, 3);
      return sub_492AC(a7, a4, 4);
    }
  }
  else
  {
    sub_492AC(a7, 0x47, 3);
    return sub_492AC(a7, 0x47, 4);
  }
}

//----- (0003F3F8) --------------------------------------------------------
unsigned int __fastcall sub_3F3F8(unsigned __int8 *a1, char a2, char a3, char a4, char a5, char a6, _DWORD *a7, unsigned __int8 a8)
{
  int v9; // ecx
  int v10; // edi
  int v11; // ecx
  int v12; // ecx
  unsigned int result; // eax
  int v14; // edx
  char v15; // edx^3
  int v16; // ebx
  int v17; // ebx
  int v18; // ecx
  int v19; // ebx
  int v20; // ebx
  int v21; // ecx
  int v22; // edx
  char v23; // edx^3
  int v24; // ebx
  int v25; // ecx
  int v26; // ebx
  int v27; // ebx
  int v28; // ecx
  int v29; // edx
  char v30; // edx^3
  int v31; // ebx

  sub_492AC(a7, a2, 0);
  sub_492AC(a7, a2, 1);
  sub_492AC(a7, a3, 2);
  sub_492AC(a7, a6, 3);
  v9 = 4;
  if ( (int)a7[6] < 8 )
  {
    v9 = 5;
    sub_492AC(a7, a2, 4);
  }
  v10 = v9 + 1;
  if ( !a8 )
  {
    sub_492AC(a7, 0x47, v9);
    sub_492AC(a7, 0x47, v10);
    sub_492AC(a7, 0x47, v9 + 2);
    sub_492AC(a7, 0x49, v9 + 3);
    v12 = v9 + 5;
    result = sub_492AC(a7, a6, v10 + 3);
    if ( v10 + 4 >= 0xA )
    {
      return result;
    }
    while ( 1 )
    {
      v14 = rand() % 0x64;
      if ( v14 > 0x4B )
      {
        break;
      }
      if ( v14 > 0x32 )
      {
        v15 = a5;
        goto LABEL_17;
      }
      if ( v14 <= 0x19 )
      {
        v15 = a6;
        goto LABEL_17;
      }
      result = sub_492AC(a7, 0x47, v12++);
LABEL_18:
      if ( v12 >= 0xA )
      {
        return result;
      }
    }
    v15 = a2;
LABEL_17:
    v16 = v12++;
    result = sub_492AC(a7, v15, v16);
    goto LABEL_18;
  }
  if ( a8 > 1u && a8 == 2 )
  {
    if ( a4 == 5 || !sub_4A404((int)a7, 5) )
    {
      v26 = v9;
      v25 = v9 + 1;
      sub_492AC(a7, a4, v26);
    }
    else
    {
      sub_492AC(a7, 5, v9);
      v25 = v9 + 1;
    }
    sub_492AC(a7, 0x49, v25);
    sub_492AC(a7, 0x49, v25 + 1);
    sub_492AC(a7, 0x49, v25 + 2);
    v27 = v25 + 3;
    v28 = v25 + 4;
    result = sub_492AC(a7, a5, v27);
    if ( v28 >= 0xA )
    {
      return result;
    }
    while ( 1 )
    {
      v29 = rand() % 0x64;
      if ( v29 > 0x4B )
      {
        break;
      }
      if ( v29 > 0x32 )
      {
        v30 = a5;
        goto LABEL_48;
      }
      if ( v29 <= 0x19 )
      {
        v30 = a6;
        goto LABEL_48;
      }
      result = sub_492AC(a7, 0x49, v28++);
LABEL_49:
      if ( v28 >= 0xA )
      {
        return result;
      }
    }
    v30 = a2;
LABEL_48:
    v31 = v28++;
    result = sub_492AC(a7, v30, v31);
    goto LABEL_49;
  }
  if ( a4 == 5 || !sub_4A404((int)a7, 5) )
  {
    v17 = v9;
    v11 = v9 + 1;
    sub_492AC(a7, a4, v17);
  }
  else
  {
    sub_492AC(a7, 5, v9);
    v11 = v9 + 1;
  }
  sub_492AC(a7, a4, v11);
  sub_492AC(a7, a4, v11 + 1);
  sub_492AC(a7, a5, v11 + 2);
  v18 = v11 + 3;
  if ( sub_4A404((int)a7, 0x24) )
  {
    sub_492AC(a7, 0x24, v18++);
  }
  if ( a6 == 0x2B || V_Game.day > 0x320 || *(__int16 *)&V_Game.Unknown_D8A[6 * *a1] >= 3 )
  {
    v19 = v18++;
    sub_492AC(a7, a6, v19);
  }
  sub_492AC(a7, a5, v18);
  v20 = v18 + 1;
  v21 = v18 + 2;
  result = sub_492AC(a7, 0x49, v20);
  if ( v21 < 0xA )
  {
    while ( 1 )
    {
      v22 = rand() % 0x64;
      if ( v22 > 0x42 )
      {
        break;
      }
      if ( v22 <= 0x21 )
      {
        v23 = a5;
        goto LABEL_33;
      }
      result = sub_492AC(a7, 0x49, v21++);
LABEL_34:
      if ( v21 >= 0xA )
      {
        return result;
      }
    }
    v23 = a2;
LABEL_33:
    v24 = v21++;
    result = sub_492AC(a7, v23, v24);
    goto LABEL_34;
  }
  return result;
}

//----- (0003F784) --------------------------------------------------------
unsigned int __fastcall sub_3F784(int a1, char a2, char a3, char a4, char a5, char a6, _DWORD *a7, unsigned __int8 a8)
{
  int v8; // esi
  int v9; // ebp
  int v10; // esi
  int v11; // esi
  int v12; // esi
  unsigned int result; // eax
  int v14; // edx
  int v15; // ebx
  int v16; // ebx
  char v17; // dl
  int v18; // ebx
  int v19; // esi
  int v20; // ebx
  int v21; // esi
  int v22; // esi
  int v23; // ecx
  int v24; // esi
  char v25; // dl
  int v26; // esi
  int v27; // ebx
  int v28; // ebx
  int v29; // esi
  int v30; // edx
  int v31; // ebx
  int v32; // ebx
  char v33; // dl

  sub_492AC(a7, a2, 0);
  sub_492AC(a7, a2, 1);
  sub_492AC(a7, a2, 2);
  sub_492AC(a7, a3, 3);
  sub_492AC(a7, a6, 4);
  sub_492AC(a7, a6, 5);
  v8 = 6;
  if ( (int)a7[6] < 0x10 )
  {
    v8 = 7;
    sub_492AC(a7, a2, 6);
  }
  v9 = v8 + 1;
  if ( a8 )
  {
    if ( a8 <= 1u || a8 != 2 )
    {
      sub_492AC(a7, a4, v8);
      v10 = v8 + 1;
      if ( a4 == 7 || !sub_4A404((int)a7, 7) )
      {
        v18 = v10;
        v11 = v10 + 1;
        sub_492AC(a7, a4, v18);
      }
      else
      {
        sub_492AC(a7, 7, v10);
        v11 = v10 + 1;
      }
      if ( a4 == 5 || !sub_4A404((int)a7, 5) )
      {
        v20 = v11;
        v19 = v11 + 1;
        sub_492AC(a7, a4, v20);
      }
      else
      {
        sub_492AC(a7, 5, v11);
        v19 = v11 + 1;
      }
      sub_492AC(a7, a5, v19);
      v21 = v19 + 1;
      if ( a6 == 0x2B )
      {
        sub_492AC(a7, 0x2B, v21++);
      }
      sub_492AC(a7, 0x49, v21);
      v22 = v21 + 1;
      if ( sub_4A404((int)a7, 0x39) )
      {
        sub_492AC(a7, 0x39, v22++);
      }
      if ( sub_4A404((int)a7, 0x24) )
      {
        sub_492AC(a7, 0x24, v22++);
      }
      if ( sub_4A404((int)a7, 0x41) )
      {
        sub_492AC(a7, 0x41, v22++);
      }
      v23 = v22 + 2;
      sub_492AC(a7, 0x46, v22);
      v24 = v22 + 1;
      if ( sub_4A404((int)a7, 0x23) )
      {
        v25 = 0x23;
      }
      else
      {
        if ( !sub_4A404((int)a7, 0x21) )
        {
          return sub_40084(a1, a7, v24, a2);
        }
        v25 = 0x21;
      }
      sub_492AC(a7, v25, v24);
      v24 = v23;
      return sub_40084(a1, a7, v24, a2);
    }
    if ( a4 == 5 || !sub_4A404((int)a7, 5) )
    {
      v27 = v8;
      v26 = v8 + 1;
      sub_492AC(a7, a4, v27);
    }
    else
    {
      sub_492AC(a7, 5, v8);
      v26 = v8 + 1;
    }
    sub_492AC(a7, 0x49, v26);
    sub_492AC(a7, 0x49, v26 + 1);
    sub_492AC(a7, 0x49, v26 + 2);
    sub_492AC(a7, 0x49, v26 + 3);
    sub_492AC(a7, a5, v26 + 4);
    v28 = v26 + 5;
    v29 = v26 + 6;
    result = sub_492AC(a7, a6, v28);
    while ( v29 < 0xF )
    {
      v30 = rand() % 0x64;
      if ( v30 <= 0x4B )
      {
        if ( v30 <= 0x32 )
        {
          if ( v30 <= 0x19 )
          {
            v32 = v29;
            v33 = a6;
          }
          else
          {
            v33 = 0x49;
            v32 = v29;
          }
        }
        else
        {
          v32 = v29;
          v33 = a5;
        }
        result = sub_492AC(a7, v33, v32);
        ++v29;
      }
      else
      {
        v31 = v29++;
        result = sub_492AC(a7, a2, v31);
      }
    }
  }
  else
  {
    sub_492AC(a7, 0x47, v8);
    sub_492AC(a7, 0x47, v9);
    sub_492AC(a7, 0x47, v8 + 2);
    sub_492AC(a7, 0x47, v8 + 3);
    sub_492AC(a7, 0x49, v8 + 4);
    sub_492AC(a7, a5, v8 + 5);
    v12 = v8 + 7;
    result = sub_492AC(a7, a6, v9 + 5);
    if ( v9 + 6 < 0xF )
    {
      do
      {
        v14 = rand() % 0x64;
        if ( v14 <= 0x50 )
        {
          if ( v14 <= 0x3C )
          {
            if ( v14 <= 0x28 )
            {
              if ( v14 <= 0x14 )
              {
                v16 = v12;
                v17 = a6;
              }
              else
              {
                v17 = 0x47;
                v16 = v12;
              }
            }
            else
            {
              v17 = 0x49;
              v16 = v12;
            }
          }
          else
          {
            v16 = v12;
            v17 = a5;
          }
          result = sub_492AC(a7, v17, v16);
          ++v12;
        }
        else
        {
          v15 = v12++;
          result = sub_492AC(a7, a2, v15);
        }
      }
      while ( v12 < 0xF );
    }
  }
  return result;
}

//----- (0003FBAC) --------------------------------------------------------
unsigned int __fastcall sub_3FBAC(int a1, char a2, char a3, char a4, char a5, char a6, _DWORD *a7, unsigned __int8 a8)
{
  int v8; // esi
  int v9; // ebp
  int v10; // ebx
  int v11; // esi
  int v12; // esi
  int v13; // esi
  unsigned int result; // eax
  int v15; // edx
  int v16; // ebx
  int v17; // ebx
  char v18; // dl
  int v19; // ebx
  int v20; // esi
  int v21; // ebx
  int v22; // esi
  int v23; // ebx
  int v24; // esi
  int v25; // ebp
  int v26; // esi
  char v27; // dl
  int v28; // esi
  int v29; // ebx
  int v30; // ebx
  int v31; // esi
  int v32; // edx
  int v33; // ebx
  int v34; // ebx
  char v35; // dl

  sub_492AC(a7, a2, 0);
  sub_492AC(a7, a2, 1);
  sub_492AC(a7, a2, 2);
  sub_492AC(a7, a2, 3);
  sub_492AC(a7, a3, 4);
  sub_492AC(a7, a3, 5);
  sub_492AC(a7, a6, 6);
  sub_492AC(a7, a6, 7);
  sub_492AC(a7, a5, 8);
  v8 = 9;
  if ( (int)a7[6] < 0x18 )
  {
    v8 = 0xA;
    sub_492AC(a7, a2, 9);
  }
  if ( a6 == 0x2B )
  {
    sub_492AC(a7, 0x2B, v8++);
  }
  v9 = v8 + 1;
  if ( a8 )
  {
    if ( a8 <= 1u || a8 != 2 )
    {
      v10 = v8;
      v11 = v8 + 1;
      sub_492AC(a7, a4, v10);
      if ( a4 == 7 || !sub_4A404((int)a7, 7) )
      {
        v19 = v11;
        v12 = v11 + 1;
        sub_492AC(a7, a4, v19);
      }
      else
      {
        sub_492AC(a7, 7, v11);
        v12 = v11 + 1;
      }
      if ( a4 == 5 || !sub_4A404((int)a7, 5) )
      {
        v21 = v12;
        v20 = v12 + 1;
        sub_492AC(a7, a4, v21);
      }
      else
      {
        sub_492AC(a7, 5, v12);
        v20 = v12 + 1;
      }
      if ( a4 == 8 || !sub_4A404((int)a7, 8) )
      {
        v23 = v20;
        v22 = v20 + 1;
        sub_492AC(a7, a4, v23);
      }
      else
      {
        sub_492AC(a7, 8, v20);
        v22 = v20 + 1;
      }
      sub_492AC(a7, 0x49, v22);
      sub_492AC(a7, 0x49, v22 + 1);
      v24 = v22 + 2;
      if ( sub_4A404((int)a7, 0x39) )
      {
        sub_492AC(a7, 0x39, v24++);
      }
      if ( sub_4A404((int)a7, 0x24) )
      {
        sub_492AC(a7, 0x24, v24++);
      }
      if ( sub_4A404((int)a7, 0x41) )
      {
        sub_492AC(a7, 0x41, v24++);
      }
      v25 = v24 + 4;
      sub_492AC(a7, 0x46, v24);
      sub_492AC(a7, 0x46, v24 + 1);
      sub_492AC(a7, a6, v24 + 2);
      v26 = v24 + 3;
      if ( sub_4A404((int)a7, 0x23) )
      {
        v27 = 0x23;
      }
      else
      {
        if ( !sub_4A404((int)a7, 0x21) )
        {
          return sub_40084(a1, a7, v26, a2);
        }
        v27 = 0x21;
      }
      sub_492AC(a7, v27, v26);
      v26 = v25;
      return sub_40084(a1, a7, v26, a2);
    }
    if ( a4 == 5 || !sub_4A404((int)a7, 5) )
    {
      v29 = v8;
      v28 = v8 + 1;
      sub_492AC(a7, a4, v29);
    }
    else
    {
      sub_492AC(a7, 5, v8);
      v28 = v8 + 1;
    }
    sub_492AC(a7, 0x49, v28);
    sub_492AC(a7, 0x49, v28 + 1);
    sub_492AC(a7, 0x49, v28 + 2);
    sub_492AC(a7, 0x49, v28 + 3);
    sub_492AC(a7, 0x49, v28 + 4);
    sub_492AC(a7, 0x49, v28 + 5);
    sub_492AC(a7, 0x49, v28 + 6);
    sub_492AC(a7, a5, v28 + 7);
    v30 = v28 + 8;
    v31 = v28 + 9;
    result = sub_492AC(a7, a6, v30);
    while ( v31 < 0x19 )
    {
      v32 = rand() % 0x64;
      if ( v32 <= 0x4B )
      {
        if ( v32 <= 0x32 )
        {
          if ( v32 <= 0x19 )
          {
            v34 = v31;
            v35 = a6;
          }
          else
          {
            v35 = 0x49;
            v34 = v31;
          }
        }
        else
        {
          v34 = v31;
          v35 = a5;
        }
        result = sub_492AC(a7, v35, v34);
        ++v31;
      }
      else
      {
        v33 = v31++;
        result = sub_492AC(a7, a2, v33);
      }
    }
  }
  else
  {
    sub_492AC(a7, 0x47, v8);
    sub_492AC(a7, 0x47, v9);
    sub_492AC(a7, 0x47, v8 + 2);
    sub_492AC(a7, 0x47, v8 + 3);
    sub_492AC(a7, 0x47, v8 + 4);
    sub_492AC(a7, 0x49, v8 + 5);
    v13 = v8 + 7;
    result = sub_492AC(a7, a5, v9 + 5);
    if ( v9 + 6 < 0x19 )
    {
      do
      {
        v15 = rand() % 0x64;
        if ( v15 <= 0x50 )
        {
          if ( v15 <= 0x3C )
          {
            if ( v15 <= 0x28 )
            {
              if ( v15 <= 0x14 )
              {
                v17 = v13;
                v18 = a6;
              }
              else
              {
                v18 = 0x47;
                v17 = v13;
              }
            }
            else
            {
              v18 = 0x49;
              v17 = v13;
            }
          }
          else
          {
            v17 = v13;
            v18 = a5;
          }
          result = sub_492AC(a7, v18, v17);
          ++v13;
        }
        else
        {
          v16 = v13++;
          result = sub_492AC(a7, a2, v16);
        }
      }
      while ( v13 < 0x19 );
    }
  }
  return result;
}

//----- (00040084) --------------------------------------------------------
int __fastcall sub_40084(int a1, _DWORD *a2, int a3, char a4)
{
  __int16 v4; // cx
  __int16 v5; // bx
  int v6; // eax
  int v7; // esi
  int v8; // edi
  char v9; // al
  int result; // eax
  int v11; // ebx
  char v12[28]; // [esp+4h] [ebp-44h]
  char v13[20]; // [esp+20h] [ebp-28h] BYREF
  int v14; // [esp+34h] [ebp-14h]
  char v15; // [esp+38h] [ebp-10h]

  v14 = a3;
  v15 = a4;
  v4 = 0;
  v5 = 0;
  qmemcpy(v13, "E?2.-&%\"/74@62&%B=01", sizeof(v13));
  while ( v5 < 0x14 )
  {
    if ( sub_4A404((int)a2, v13[v5]) )
    {
      v6 = v4++;
      v12[v6] = v13[v5];
    }
    ++v5;
  }
  while ( v14 < *(_DWORD *)((char *)a2 + 0x15A) && v4 )
  {
    v7 = rand() % v4;
    v8 = v14 + 1;
    --v4;
    sub_492AC(a2, v12[v7], v14);
    v9 = v12[v4];
    v14 = v8;
    v12[v7] = v9;
  }
  while ( 1 )
  {
    result = v14;
    if ( v14 >= *(_DWORD *)((char *)a2 + 0x15A) )
    {
      break;
    }
    v11 = v14++;
    sub_492AC(a2, v15, v11);
  }
  return result;
}
// 40084: using guessed type char var_28[20];
// 40084: using guessed type char var_44[28];

//----- (00040144) --------------------------------------------------------
T_Ship *__fastcall sub_40144(P_Race pRace, P_Planet pPlanet)
{
  T_Ship *vpShip1; // eax
  T_Ship *vpShip2; // ecx
  UWORD industry; // di
  int day; // edx
  unsigned __int16 v9; // [esp+0h] [ebp-14h]

  if ( !pPlanet )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xF3C);
  }
  if ( sub_3EFE0(pRace) > 0 )
  {
    vpShip1 = sub_20684(&V_Game, pRace->index);
    vpShip2 = vpShip1;
    if ( !vpShip1 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xF45);
    }
    v9 = sub_4A18C(vpShip1);
    if ( !v9 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xF51);
    }
    industry = pPlanet->industry;
    if ( !industry )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xF54);
    }
    day = V_Game.day;
    vpShip2->locationType = 1;
    vpShip2->pLocation.pPlanet = pPlanet;
    vpShip2->_dayBuilt = day + v9 / (int)industry + 1;
    return vpShip2;
  }
  else
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\race.cpp", 0xF40);
    return 0;
  }
}
// 401AC: conditional instruction was optimized away because eax.4!=0

//----- (00040218) --------------------------------------------------------
int __fastcall Q_CompareShipsByDayBuilt_sub_40218(P_Ship *ppShip1, P_Ship *ppShip2)
{
  return (*ppShip1)->_dayBuilt - (*ppShip2)->_dayBuilt;
}

//----- (00040224) --------------------------------------------------------
int __fastcall Q_Race_GetShipsNum_sub_40224(P_Race pRace, P_Ship *ppShip, int *totalSize)
{
  int j; // esi
  __int16 i; // cx
  int ii; // kr04_4
  P_Ship *vppShip; // [esp+4h] [ebp-1Ch]
  int shipsNum; // [esp+8h] [ebp-18h]
  int raceIndex; // [esp+Ch] [ebp-14h]

  vppShip = ppShip;
  j = 0;
  shipsNum = 0;
  if ( totalSize )
  {
    *totalSize = 0;
  }
  i = 0;
  ii = 0;
  while ( i < 107 && j < V_Game.shipsNum )
  {
    raceIndex = V_Game.ships[ii].raceIndex;
    if ( raceIndex != 0xFFFFFFFF )
    {
      ++j;
      if ( raceIndex == pRace->index )
      {
        if ( vppShip )
        {
          *ppShip = &V_Game.ships[ii];
        }
        ++ppShip;
        ++shipsNum;
        if ( totalSize )
        {
          *totalSize += V_Game.ships[ii].hullSize + 1;
        }
      }
    }
    ++i;
    ++ii;
  }
  if ( vppShip )
  {
    qsort(vppShip, shipsNum, 4u, (int (__fastcall *)(const void *, const void *))Q_CompareShipsByDayBuilt_sub_40218);
  }
  return shipsNum;
}

//----- (000402E0) --------------------------------------------------------
int __fastcall Q_Race_GetPlanetsNum_sub_402E0(P_Race pRace)
{
  int count; // ebx
  int i; // eax
  int ii; // kr04_4

  count = 0;
  i = 0;
  ii = 0;
  while ( i < V_Game.planetsNum )
  {
    if ( V_Game.planets[ii].raceIndex == pRace->index )
    {
      ++count;
    }
    ++i;
    ++ii;
  }
  return count;
}

//----- (000403C0) --------------------------------------------------------
int __fastcall sub_403C0(unsigned __int8 *a1, int a2)
{
  __int16 v3; // bx
  __int16 v4; // cx
  int i; // ebp
  int v6; // ebx
  unsigned __int16 v7; // ax
  int *v8; // ecx
  int v9; // ebx
  __int16 v10; // ax
  int v11; // ebx
  int v14; // [esp+0h] [ebp-28h]
  unsigned __int16 v15; // [esp+4h] [ebp-24h]
  unsigned __int16 v16; // [esp+8h] [ebp-20h]
  __int16 v17; // [esp+Ch] [ebp-1Ch]

  v16 = 0;
  v3 = 0;
  v14 = 0;
  if ( V_Game.racesNum > 0 )
  {
    while ( V_Game.races[v3].Unknown_03 == 0xFFFFFFFF
         || v3 == *a1
         || a1[v3 + 0x1C0] != 3
         || ((1 << v3) & *(unsigned __int8 *)(a2 + 0x14)) == 0 )
    {
      if ( ++v3 >= V_Game.racesNum )
      {
        goto LABEL_9;
      }
    }
    return 0;
  }
LABEL_9:
  v4 = 0;
  for ( i = (a1[0x19D] != 2) - 1; v4 < *(__int16 *)(a2 + 0x5A); ++v4 )
  {
    v6 = *(_DWORD *)(a2 + 4 * v4 + 0x46);
    if ( *(unsigned __int8 *)(v6 + 0x57) == 0xFF )
    {
      sub_3636C(*(_DWORD *)(a2 + 4 * v4 + 0x46), i);
      if ( (*(_BYTE *)(v6 + 0x66) & 2) != 0 )
      {
        v7 += 0x28;
      }
      if ( v7 > v16 )
      {
        v16 = v7;
        v14 = v6;
      }
    }
  }
  v15 = 0x46;
  if ( *(_BYTE *)(a2 + 0x14) )
  {
    v10 = 0;
    if ( V_Game.racesNum > 0 )
    {
      while ( 1 )
      {
        if ( a1[v10 + 0x1C0] == 2 )
        {
          v11 = *(unsigned __int8 *)(a2 + 0x14);
          if ( ((1 << v10) & v11) != 0 && ((1 << *a1) & v11) == 0 )
          {
            break;
          }
        }
        if ( ++v10 >= V_Game.racesNum )
        {
          goto LABEL_34;
        }
      }
      v15 = 0;
    }
  }
  else
  {
    v15 = 0x23;
    v17 = 0;
    if ( *(__int16 *)(a2 + 0x44) > 0 )
    {
      while ( 1 )
      {
        v8 = *(int **)(a2 + 4 * v17 + 0x2C);
        if ( !v8 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x100E);
        }
        v9 = *v8;
        if ( a2 == *v8 )
        {
          v9 = v8[1];
        }
        if ( ((1 << *a1) & *(unsigned __int8 *)(v9 + 0x14)) != 0 )
        {
          break;
        }
        if ( ++v17 >= *(__int16 *)(a2 + 0x44) )
        {
          goto LABEL_34;
        }
      }
      v15 = 0x11;
    }
  }
LABEL_34:
  if ( v16 <= v15 )
  {
    return 0;
  }
  return v14;
}
// 40480: variable 'v7' is possibly undefined

//----- (00040590) --------------------------------------------------------
int __fastcall sub_40590(P_Race pRace)
{
  int v1; // edx
  int v2; // kr04_4

  if ( !dword_10509C )
  {
    v1 = 0;
    dword_1050A0 = 0xFFFFFFFF;
    v2 = 0;
    while ( v1 < V_ResTree.num )
    {
      if ( ((1 << pRace->index) & V_ResTree.items[v2].Unknown_48) == 0 )
      {
        dword_1050A0 = 0;
        break;
      }
      ++v1;
      ++v2;
    }
    dword_10509C = 0xFFFFFFFF;
  }
  return dword_1050A0;
}
// 10509C: using guessed type int dword_10509C;
// 1050A0: using guessed type int dword_1050A0;

//----- (000405F4) --------------------------------------------------------
unsigned int __fastcall sub_405F4(_BYTE *a1)
{
  unsigned int v2; // esi
  WORD i; // dx
  T_Planet *v4; // eax
  UBYTE raceIndex; // cl

  v2 = 0;
  if ( sub_40590((P_Race)a1) )
  {
    for ( i = 0; i < V_Game.planetsNum; ++i )
    {
      v4 = &V_Game.planets[i];
      raceIndex = v4->raceIndex;
      if ( raceIndex == *a1 && (raceIndex != V_RaceIndex || v4->z7 || V_FlashPopExists) )
      {
        if ( sub_3623C(v4) )
        {
          v2 = 0xFFFFFFFF;
        }
      }
    }
  }
  return v2;
}

//----- (00040664) --------------------------------------------------------
int __fastcall Q_Race_GetTechsNum_sub_40664(P_Race ppRace)
{
  int v1; // ebx
  int v2; // edx
  int v3; // kr04_4

  v1 = 0;
  v2 = 0;
  v3 = 0;
  while ( v2 < V_ResTree.num )
  {
    if ( ((1 << ppRace->index) & V_ResTree.items[v3].Unknown_48) != 0 )
    {
      ++v1;
    }
    ++v2;
    ++v3;
  }
  return v1;
}

//----- (000406C4) --------------------------------------------------------
int __fastcall sub_406C4(P_Race pRace, P_Star pStar, int a3)
{
  UBYTE raceIndex; // cl
  __int16 v5; // cx
  int v6; // ebp
  P_Ship v7; // esi
  __int16 v8; // bx
  __int8 Unknown_5D; // dh
  __int16 v10; // ax
  P_Location v11; // ecx
  int v12; // edx
  int v13; // ebx
  char v14; // cl
  P_Star star; // eax
  unsigned int v16; // ebx
  UBYTE racesBits; // ch
  __int16 v18; // si
  P_Ship pShip; // ebx
  int v20; // eax
  int result; // eax
  __int16 v22; // dx
  unsigned __int8 v23; // al
  unsigned int v24; // ebp
  int v25; // ebx
  P_Location v26; // esi
  __int16 i; // ax
  int v28; // ebx
  P_Ship vpShip; // esi
  __int16 Unknown_88; // cx
  __int16 j; // bx
  P_Ship v32; // edx
  int Unknown_5E; // eax
  int v34; // eax
  int v35; // edx
  int v36; // ebx
  unsigned __int8 v37; // al
  __int16 v38; // dx
  signed __int16 industry; // di
  int v40; // ecx
  int v41; // eax
  int v42; // eax
  int v43; // eax
  int v44; // eax
  UBYTE v45; // dl
  int Unknown_4228; // eax
  int v47; // eax
  int v48; // eax
  T_Planet *vpPlanet; // ecx
  UBYTE locationType; // bl
  T_Planet *pPlanet; // eax
  int v52; // eax
  UBYTE index; // al
  __int16 v54; // cx
  int v55; // eax
  __int16 v56; // bx
  __int16 v57; // ax
  P_Ship ships[107]; // [esp+0h] [ebp-3CCh] BYREF
  P_Ship ships2[107]; // [esp+1ACh] [ebp-220h] BYREF
  int v60[5]; // [esp+358h] [ebp-74h] BYREF
  __int16 v61[8]; // [esp+36Ch] [ebp-60h] BYREF
  int v62; // [esp+37Ch] [ebp-50h]
  int v63; // [esp+380h] [ebp-4Ch]
  int v64; // [esp+384h] [ebp-48h]
  int v65; // [esp+388h] [ebp-44h]
  int v66; // [esp+38Ch] [ebp-40h]
  int v67; // [esp+390h] [ebp-3Ch]
  P_Location vpLocation; // [esp+394h] [ebp-38h]
  int v69; // [esp+398h] [ebp-34h]
  int v70; // [esp+39Ch] [ebp-30h]
  __int16 v71; // [esp+3A0h] [ebp-2Ch]
  __int16 v72; // [esp+3A4h] [ebp-28h]
  int v73; // [esp+3A8h] [ebp-24h]
  int v74; // [esp+3ACh] [ebp-20h]
  int v75; // [esp+3B0h] [ebp-1Ch]
  int v76; // [esp+3B4h] [ebp-18h]
  unsigned __int8 v77; // [esp+3B8h] [ebp-14h]

  vpLocation.pStar = pStar;
  v64 = a3;
  if ( !a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1081);
  }
  raceIndex = pRace->index;
  v77 = vpLocation.pStar->racesBits | vpLocation.pStar->Unknown_15;
  if ( ((1 << raceIndex) & v77) == 0 )
  {
    return 0;
  }
  sub_3B56C(pRace, vpLocation);
  v5 = 0;
  LOWORD(v76) = 0;
  LOWORD(v73) = 0;
  LOWORD(v74) = 0;
  LOWORD(v70) = 0;
  v65 = 0;
  v6 = sub_1D794(vpLocation, ships);
  while ( v5 < v6 )
  {
    v7 = ships[v5];
    if ( !v7 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x10AC);
    }
    if ( v7->raceIndex == pRace->index && v7->Unknown_88 > 0 && v7->locationType != ASCEND_LOCATION_TYPE_1 )
    {
      v8 = LOWORD(v7->Unknown_94) + v70;
      LOWORD(v74) = LOWORD(v7->Unknown_88) + v74;
      ships2[(__int16)v76] = v7;
      LOWORD(v70) = v8;
      Unknown_5D = v7->Unknown_5D;
      LOWORD(v76) = v76 + 1;
      if ( Unknown_5D )
      {
        v65 = 0xFFFFFFFF;
      }
    }
    ++v5;
  }
  v10 = 0;
  if ( SLOWORD(vpLocation.pPlanet->z7) > 0 )
  {
    v11.pPlanet = vpLocation.pPlanet;
    do
    {
      v12 = *((_DWORD *)&v11.pPlanet->research + v10);
      if ( *(_BYTE *)(v12 + 0x57) == pRace->index )
      {
        v13 = (__int16)v73;
        LOWORD(v73) = v73 + 1;
        v60[v13] = v12;
      }
      ++v10;
    }
    while ( v10 < SLOWORD(vpLocation.pPlanet->z7) );
  }
  if ( !(_WORD)v76 && !(_WORD)v73 )
  {
    return 0;
  }
  if ( vpLocation.pPlanet == (P_Planet)pRace->star
    || !(_WORD)v76
    || V_RaceIndex == pRace->index
    || ((1 << pRace->index) & V_ResTree.items[(unsigned __int8)V_Gizmos[0x24].resReq].Unknown_48) == 0 )
  {
    goto LABEL_39;
  }
  v14 = sub_43374(pRace, 0xFFFFFFFF);
  star = pRace->star;
  v16 = 0;
  racesBits = star->racesBits;
  if ( (racesBits & 0x7F) == 0 )
  {
    v16 = 0xFFFFFFFF;
  }
  if ( !v16 )
  {
    v16 = 0;
    if ( ((unsigned __int8)v14 & (unsigned __int8)(racesBits | star->Unknown_15)) != 0 )
    {
      v16 = 0xFFFFFFFF;
    }
  }
  if ( v16 && (v18 = 0, (__int16)v76 > 0) )
  {
    while ( 1 )
    {
      pShip = ships2[v18];
      if ( pShip->locationType == ASCEND_LOCATION_TYPE_STAR )
      {
        if ( pShip->Unknown_88 )
        {
          v20 = sub_4937C(ships2[v18], 0x24);          // Recaller
          if ( v20 != 0xFFFFFFFF )
          {
            pShip->Unknown_62 = 1;
            pShip->pHullCell = &pShip->hullCells[v20];
            pShip->Unknown_67 = 5;
            if ( (sub_49B3C(pShip, 0) & 1) != 0 )
            {
              break;
            }
          }
        }
      }
      if ( ++v18 >= (__int16)v76 )
      {
        goto LABEL_39;
      }
    }
    *(_BYTE *)v64 = 3;
    *(_DWORD *)(v64 + 1) = ships2[v18];
    return 0xFFFFFFFF;
  }
  else
  {
LABEL_39:
    v22 = 0;
    v23 = 1;
    v24 = 0;
    LOWORD(v75) = 0;
    v62 = 0;
    while ( v22 < 7 )
    {
      v66 = v23;
      if ( (v23 & v77) != 0 )
      {
        v25 = (__int16)v75;
        v26.pPlanet = vpLocation.pPlanet;
        v61[v25] = v22;
        if ( ((unsigned __int8)v66 & HIBYTE(v26.pPlanet->size)) != 0 )
        {
          LOBYTE(v61[v25]) |= 8u;
        }
        if ( (v23 & vpLocation.pPlanet->size) != 0 )
        {
          LOBYTE(v61[(__int16)v75]) |= 0x10u;
        }
        if ( pRace->Unknown_1C0[v22] == 2 )
        {
          if ( V_RaceIndex != pRace->index || V_FlashPopExists == 0xFFFFFFFF || (HIBYTE(vpLocation.pPlanet->size) & v23) != 0 )
          {
            v24 = 0xFFFFFFFF;
            LOBYTE(v61[(__int16)v75]) |= 0x20u;
          }
        }
        else if ( pRace->index != V_RaceIndex
               && v22 == V_RaceIndex
               && ((1 << pRace->index) & (unsigned __int8)byte_D8460[SLOWORD(vpLocation.pPlanet->v.y)]) != 0 )
        {
          v24 = 0xFFFFFFFF;
          LOBYTE(v61[(__int16)v75]) |= 0x20u;
        }
        LOWORD(v75) = v75 + 1;
      }
      ++v22;
      v23 *= 2;
    }
    if ( (__int16)v75 <= 0 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1133);
    }
    if ( (__int16)v75 == 1 )
    {
      v62 = 0xFFFFFFFF;
    }
    if ( !v62 && !v24 && (pRace->index != V_RaceIndex || V_FlashPopExists == 0xFFFFFFFF) )
    {
      LOWORD(v69) = 0;
      do
      {
        v71 = v61[(__int16)v69] & 7;
        if ( pRace->Unknown_1C0[(unsigned __int8)v71] == 3 )
        {
          for ( i = 0; i < (__int16)v75; ++i )
          {
            v28 = v61[i] & 7;
            if ( V_Game.races[v71].Unknown_1C0[(unsigned __int8)v28] == 2 && pRace->Unknown_1C0[v28] != 3 )
            {
              v24 = 0xFFFFFFFF;
              LOBYTE(v61[i]) |= 0x20u;
            }
          }
        }
        LOWORD(v69) = v69 + 1;
      }
      while ( (__int16)v69 < (__int16)v75 );
    }
    if ( v24 != 0xFFFFFFFF
      || V_RaceIndex == pRace->index && V_FlashPopExists != 0xFFFFFFFF && WinMgr.Unknown_4228 != 0x10
      || (result = sub_41268(
                     &pRace->index,
                     v75,
                     (__int16)v76,
                     (int)v61,
                     (char *)vpLocation.pPlanet,
                     (int)ships2,
                     v73,
                     (int)v60,
                     (__int16)v74,
                     (__int16)v70,
                     (int)vpLocation.pPlanet,
                     v64),
          result != 0xFFFFFFFF) )
    {
      if ( V_RaceIndex == pRace->index && !v65 && V_FlashPopExists == FALSE )
      {
        return 0;
      }
      vpShip = 0;
      Unknown_88 = 0;
      for ( j = 0; j < (__int16)v76; ++j )
      {
        if ( !ships2[j]->Unknown_5D && (pRace->index != V_RaceIndex || V_FlashPopExists == 0xFFFFFFFF) )
        {
          sub_3EBDC(&pRace->index, ships2[j]);
        }
        v32 = ships2[j];
        if ( Unknown_88 < v32->Unknown_88 && v32->Unknown_5D )
        {
          vpShip = ships2[j];
          Unknown_88 = v32->Unknown_88;
        }
      }
      if ( !vpShip )
      {
        return 0;
      }
      switch ( vpShip->Unknown_5D )
      {
        case 1:
          if ( vpShip->locationType == ASCEND_LOCATION_TYPE_PLANET )
          {
            sub_35C38(vpShip->pLocation.pPlanet, vpShip);
          }
          if ( vpShip->locationType != ASCEND_LOCATION_TYPE_STAR )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1188);
          }
          if ( pRace->index != V_RaceIndex
            && sub_1D834(vpLocation.pStar, pRace->index) == 0xFFFFFFFF
            && vpShip->Unknown_28 != 0xFFFFFFFF
            && Q_ShipHasGizmo_sub_4A534(vpShip, 0x49) == TRUE )// Invasion Module
          {
            return 0;
          }
          Unknown_5E = vpShip->Unknown_5E;
          if ( (P_Planet)Unknown_5E != vpLocation.pPlanet )
          {
            v36 = vpShip->Unknown_5E;
            v37 = V_Game.z10000[0x64 * SLOWORD(vpLocation.pPlanet->v.y) + *(__int16 *)(Unknown_5E + 4)];
            v38 = 0;
            v63 = 0;
            industry = vpLocation.pPlanet->industry;
            v72 = v37;
            if ( industry > 0 )
            {
              while ( 1 )
              {
                v67 = *(_DWORD *)&vpLocation.pPlanet->name[4 * v38 + 8];
                if ( vpLocation.pPlanet == *(P_Planet *)v67 )
                {
                  v41 = 0x64 * *(__int16 *)(*(_DWORD *)(v67 + 4) + 4);
                  v40 = *(__int16 *)(v36 + 4);
                }
                else
                {
                  v40 = 0x64 * *(__int16 *)(*(_DWORD *)v67 + 4);
                  v41 = *(__int16 *)(v36 + 4);
                }
                if ( (unsigned __int8)V_Game.z10000[v40 + v41] == v72 - 1 )
                {
                  break;
                }
                if ( ++v38 >= (__int16)vpLocation.pPlanet->industry )
                {
                  goto LABEL_115;
                }
              }
              v63 = 0xFFFFFFFF;
            }
LABEL_115:
            if ( v63 != 0xFFFFFFFF )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x11CC);
            }
            if ( (*(_BYTE *)(v67 + 0x23) & 2) != 0 && sub_4A480(vpShip, 0, v67) )
            {
              v42 = v64;
              *(_BYTE *)v64 = 3;
              *(_DWORD *)(v42 + 1) = vpShip;
            }
            else
            {
              vpShip->Unknown_62 = 0;
              v43 = v67;
              vpShip->pHullCell = 0;
              vpShip->Unknown_68 = v43;
              v44 = v64;
              vpShip->Unknown_67 = 2;
              *(_BYTE *)v44 = 3;
              *(_DWORD *)(v44 + 1) = vpShip;
            }
            goto LABEL_121;
          }
          v34 = (int)vpLocation.pPlanet ^ Unknown_5E;
          v35 = vpShip->raceIndex;
          LOBYTE(v34) = V_RaceIndex;
          vpShip->Unknown_5D = 0;
          if ( v35 != v34 || V_FlashPopExists == 0xFFFFFFFF )
          {
            sub_3EBDC(&pRace->index, vpShip);
          }
          result = 0xFFFFFFFF;
          break;
        case 2:
          vpPlanet = (T_Planet *)vpShip->Unknown_5E;
          if ( !vpShip->Unknown_28 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x123F);
          }
          if ( vpPlanet->raceIndex == 0xFF )
          {
            locationType = vpShip->locationType;
            if ( locationType == 3 )
            {
              pPlanet = vpShip->pLocation.pPlanet;
              if ( vpPlanet == pPlanet )
              {
                v52 = sub_4937C(vpShip, 0x47);         // Colonizer
                if ( v52 == 0xFFFFFFFF )
                {
                  Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x125A);
                }
                Q_Ship_RemoveGizmo_sub_492F8(vpShip, v52);
                index = pRace->index;
                vpPlanet->word42 = 2;
                vpPlanet->raceIndex = index;
                vpPlanet->dayColonized = V_Game.day;
                sub_34AE4(vpPlanet, 5u, 0xFFFFFFFF);   // Colony Base
                --vpShip->Unknown_88;
                LOBYTE(vpLocation.pPlanet->size) |= 1 << pRace->index;
                v54 = v74 - 1;
                vpShip->Unknown_5D = 0;
                LOWORD(v74) = v54;
              }
              else
              {
                sub_35C38(pPlanet, vpShip);
                if ( vpShip->locationType != 4 )
                {
                  Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1252);
                }
              }
            }
            else
            {
              if ( locationType != 4 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x126C);
              }
              vpShip->Unknown_62 = 0;
              vpShip->pHullCell = 0;
              vpShip->Unknown_67 = 1;
              v55 = v64;
              vpShip->Unknown_68 = (int)vpPlanet;
              *(_BYTE *)v55 = 3;
              *(_DWORD *)(v55 + 1) = vpShip;
            }
          }
          else
          {
            vpShip->Unknown_5D = 0;
          }
          goto LABEL_121;
        case 3:
          if ( vpShip->raceIndex != V_RaceIndex )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x11F3);
          }
          v45 = vpShip->locationType;
          if ( v45 == 3 )
          {
            if ( vpShip->pLocation.pPlanet != (P_Planet)vpShip->Unknown_5E )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x11F7);
            }
            Unknown_4228 = WinMgr.Unknown_4228;
            vpShip->Unknown_5D = 0;
            if ( Unknown_4228 != 0x10 )
            {
              Q_AddGameEvent_sub_55AEC(&WinMgr, ASCEND_EP_16_ENTERED_ORBIT, vpShip, (void *)vpShip->Unknown_5E);
            }
          }
          else if ( v45 == 4 )
          {
            vpShip->Unknown_62 = 0;
            vpShip->pHullCell = 0;
            vpShip->Unknown_68 = vpShip->Unknown_5E;
            v47 = v64;
            vpShip->Unknown_67 = 1;
            *(_BYTE *)v47 = 3;
            *(_DWORD *)(v47 + 1) = vpShip;
          }
          else
          {
            vpShip->Unknown_5D = 0;
          }
          goto LABEL_121;
        case 7:
          if ( vpShip->raceIndex != V_RaceIndex )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x121D);
          }
          if ( vpShip->locationType != 4 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x121E);
          }
          if ( (vpShip->Unknown_84 & 8) != 0 )
          {
            vpShip->Unknown_5D = 0;
          }
          else if ( vpShip->Unknown_62 )
          {
            vpShip->Unknown_5D = 0;
          }
          else
          {
            v48 = v64;
            vpShip->Unknown_67 = 3;
            *(_BYTE *)v48 = 3;
            *(_DWORD *)(v48 + 1) = vpShip;
          }
          goto LABEL_121;
        default:
          v56 = v74;
          v57 = vpShip->Unknown_88;
          vpShip->Unknown_94 = 0;
          vpShip->Unknown_88 = 0;
          LOWORD(v74) = v56 - v57;
LABEL_121:
          if ( (__int16)v74 <= 0 )
          {
            return 0;
          }
          return 0xFFFFFFFF;
      }
    }
  }
  return result;
}
// 40BBE: conditional instruction was optimized away because %var_1C.2>=1
// 406C4: using guessed type int var_74[5];

//----- (00041268) --------------------------------------------------------
int __userpurge sub_41268@<eax>(
        unsigned __int8 *eax0@<eax>,
        __int16 a2@<dx>,
        int a3@<ecx>,
        int a4@<ebx>,
        char *a5@<ebp>,
        int a6,
        __int16 a7,
        int a8,
        int a9,
        int a10,
        int a11,
        int a12)
{
  __int16 v12; // ax
  int v13; // edi
  __int16 j; // ax
  _BYTE *v15; // edx
  int v16; // esi
  char v17; // cl
  char *v18; // edx
  T_Ship *v19; // eax
  int Unknown_28; // edx
  _WORD *v21; // ebx
  T_Ship *v22; // edx
  P_Ship v24; // ecx
  int v25; // eax
  int v26; // eax
  P_Ship v27; // edx
  P_Ship v28; // edx
  int v29; // esi
  __int16 n; // cx
  int v31; // ebx
  int v32; // esi
  int v33; // eax
  char v34; // bh
  __int16 v35; // bx
  char *v36; // edx
  int v37; // ebp
  float *v38; // ebx
  __int16 ii; // si
  char *v40; // edx
  char v41; // cl
  int v42; // ecx
  double v43; // st7
  double v44; // st7
  int v45; // edx
  __int16 v46; // bx
  __int16 v47; // cx
  int v48; // eax
  int v49; // edx
  T_Planet *v50; // edi
  unsigned __int8 *v51; // ebp
  signed __int16 kk; // cx
  P_Ship Ship_sub_35A70; // esi
  int v54; // eax
  int v55; // ecx
  __int16 mm; // ax
  __int16 v57; // bx
  P_Ship *v58; // eax
  T_Ship *v59; // ecx
  unsigned int v60; // eax
  unsigned int v61; // eax
  int v62; // ebp
  T_Ship *v63; // ecx
  double v64; // st7
  char v65; // cl
  T_Ship *v66; // ebp
  char *v67; // edx
  int v68; // ebx
  T_Ship *v69; // ebp
  _WORD *v70; // ebx
  P_Ship v71; // edi
  int v72; // eax
  int v73; // eax
  P_Ship v74; // edx
  P_Ship v75; // edx
  int *v76; // eax
  int v77; // eax
  int v78; // ecx
  __int16 v79; // ax
  char v80; // dl
  int v81; // esi
  int v82; // eax
  __int16 i2; // bx
  char *v84; // edx
  char v85; // cl
  int v86; // eax
  void *v87[107]; // [esp+8h] [ebp-40Ch] BYREF
  char v88; // [esp+1B4h] [ebp-260h]
  P_HullCell v89; // [esp+1B5h] [ebp-25Fh]
  char v90; // [esp+1B9h] [ebp-25Bh]
  int v91; // [esp+1BAh] [ebp-25Ah]
  int v92; // [esp+1BEh] [ebp-256h]
  int v93; // [esp+1C2h] [ebp-252h]
  int v94; // [esp+1C6h] [ebp-24Eh]
  int v95; // [esp+1CAh] [ebp-24Ah]
  int v96; // [esp+1CEh] [ebp-246h]
  float v97; // [esp+1D2h] [ebp-242h]
  int v98; // [esp+1D6h] [ebp-23Eh]
  char Unknown_62; // [esp+1DCh] [ebp-238h]
  P_HullCell pHullCell; // [esp+1DDh] [ebp-237h]
  char Unknown_67; // [esp+1E1h] [ebp-233h]
  int Unknown_68; // [esp+1E2h] [ebp-232h]
  int Unknown_6C; // [esp+1E6h] [ebp-22Eh]
  int Unknown_70; // [esp+1EAh] [ebp-22Ah]
  int Unknown_74; // [esp+1EEh] [ebp-226h]
  int Unknown_78; // [esp+1F2h] [ebp-222h]
  int Unknown_7C; // [esp+1F6h] [ebp-21Eh]
  float Unknown_80; // [esp+1FAh] [ebp-21Ah]
  int Unknown_84; // [esp+1FEh] [ebp-216h]
  int v110[3]; // [esp+204h] [ebp-210h] BYREF
  float v111; // [esp+210h] [ebp-204h] BYREF
  float v112; // [esp+214h] [ebp-200h]
  float v113; // [esp+218h] [ebp-1FCh]
  float v114; // [esp+21Ch] [ebp-1F8h]
  int v115; // [esp+220h] [ebp-1F4h]
  int v116; // [esp+224h] [ebp-1F0h]
  float v117; // [esp+228h] [ebp-1ECh]
  int v118; // [esp+22Ch] [ebp-1E8h]
  int v119; // [esp+230h] [ebp-1E4h]
  int v120[3]; // [esp+234h] [ebp-1E0h] BYREF
  float v121; // [esp+240h] [ebp-1D4h]
  float v122; // [esp+244h] [ebp-1D0h]
  float v123; // [esp+248h] [ebp-1CCh]
  int v124[3]; // [esp+24Ch] [ebp-1C8h] BYREF
  int v125[3]; // [esp+258h] [ebp-1BCh] BYREF
  float v126; // [esp+264h] [ebp-1B0h]
  float v127; // [esp+268h] [ebp-1ACh]
  float v128; // [esp+26Ch] [ebp-1A8h]
  float v129; // [esp+270h] [ebp-1A4h]
  float v130; // [esp+274h] [ebp-1A0h]
  float v131; // [esp+278h] [ebp-19Ch]
  int v132[3]; // [esp+27Ch] [ebp-198h] BYREF
  int v133[3]; // [esp+288h] [ebp-18Ch] BYREF
  float v134; // [esp+294h] [ebp-180h]
  float v135; // [esp+298h] [ebp-17Ch]
  float v136; // [esp+29Ch] [ebp-178h]
  float v137; // [esp+2A0h] [ebp-174h]
  float v138; // [esp+2A4h] [ebp-170h]
  float v139; // [esp+2A8h] [ebp-16Ch]
  float v140; // [esp+2ACh] [ebp-168h]
  float v141; // [esp+2B0h] [ebp-164h]
  float v142; // [esp+2B4h] [ebp-160h]
  float v143; // [esp+2B8h] [ebp-15Ch] BYREF
  float v144; // [esp+2BCh] [ebp-158h]
  float v145; // [esp+2C0h] [ebp-154h]
  float v146; // [esp+2C4h] [ebp-150h]
  float v147; // [esp+2C8h] [ebp-14Ch]
  float v148; // [esp+2CCh] [ebp-148h]
  float v149; // [esp+2D0h] [ebp-144h]
  float v150; // [esp+2D4h] [ebp-140h]
  float v151; // [esp+2D8h] [ebp-13Ch]
  int v152[3]; // [esp+2DCh] [ebp-138h] BYREF
  float v153; // [esp+2E8h] [ebp-12Ch]
  float v154; // [esp+2ECh] [ebp-128h]
  float v155; // [esp+2F0h] [ebp-124h]
  float v156; // [esp+2F4h] [ebp-120h]
  float v157; // [esp+2F8h] [ebp-11Ch]
  float v158; // [esp+2FCh] [ebp-118h]
  float v159; // [esp+300h] [ebp-114h]
  float v160; // [esp+304h] [ebp-110h]
  float v161; // [esp+308h] [ebp-10Ch]
  int v162[5]; // [esp+30Ch] [ebp-108h] BYREF
  int v163; // [esp+320h] [ebp-F4h]
  int v164; // [esp+324h] [ebp-F0h]
  unsigned __int8 *v165; // [esp+328h] [ebp-ECh]
  float v166; // [esp+32Ch] [ebp-E8h]
  int v167; // [esp+330h] [ebp-E4h] BYREF
  int v168; // [esp+334h] [ebp-E0h]
  P_Ship pShip; // [esp+338h] [ebp-DCh]
  void *v170; // [esp+33Ch] [ebp-D8h]
  int v171; // [esp+340h] [ebp-D4h]
  int *v172; // [esp+344h] [ebp-D0h]
  float v173; // [esp+348h] [ebp-CCh]
  unsigned int v174; // [esp+34Ch] [ebp-C8h]
  T_Ship *v175; // [esp+350h] [ebp-C4h]
  float v176; // [esp+354h] [ebp-C0h]
  float v177; // [esp+358h] [ebp-BCh]
  int *v178; // [esp+35Ch] [ebp-B8h]
  P_Ship v179; // [esp+360h] [ebp-B4h]
  float v180; // [esp+364h] [ebp-B0h]
  int *v181; // [esp+368h] [ebp-ACh]
  float v182; // [esp+36Ch] [ebp-A8h]
  int *v183; // [esp+370h] [ebp-A4h]
  int *v184; // [esp+374h] [ebp-A0h]
  int *v185; // [esp+378h] [ebp-9Ch]
  unsigned int v186; // [esp+37Ch] [ebp-98h] BYREF
  int v187; // [esp+380h] [ebp-94h]
  float v188; // [esp+384h] [ebp-90h]
  int a1; // [esp+388h] [ebp-8Ch]
  float v190; // [esp+38Ch] [ebp-88h]
  float *v191; // [esp+390h] [ebp-84h]
  int *v192; // [esp+394h] [ebp-80h]
  float v193; // [esp+398h] [ebp-7Ch]
  int v194; // [esp+39Ch] [ebp-78h]
  int *v195; // [esp+3A0h] [ebp-74h]
  void *v196; // [esp+3A4h] [ebp-70h]
  unsigned int v197; // [esp+3A8h] [ebp-6Ch]
  float v198; // [esp+3ACh] [ebp-68h]
  float v199; // [esp+3B0h] [ebp-64h]
  int v200; // [esp+3B4h] [ebp-60h]
  T_Ship *v201; // [esp+3B8h] [ebp-5Ch]
  int v202; // [esp+3BCh] [ebp-58h] BYREF
  int v203; // [esp+3C0h] [ebp-54h]
  __int16 i1; // [esp+3C4h] [ebp-50h]
  int v205; // [esp+3C8h] [ebp-4Ch]
  __int16 nn; // [esp+3CCh] [ebp-48h]
  int v207; // [esp+3D0h] [ebp-44h]
  int v208; // [esp+3D4h] [ebp-40h]
  int v209; // [esp+3D8h] [ebp-3Ch]
  int v210; // [esp+3DCh] [ebp-38h]
  __int16 m; // [esp+3E0h] [ebp-34h]
  int v212; // [esp+3E4h] [ebp-30h]
  int v213; // [esp+3E8h] [ebp-2Ch]
  __int16 v214; // [esp+3ECh] [ebp-28h]
  __int16 v215; // [esp+3F0h] [ebp-24h]
  __int16 jj; // [esp+3F4h] [ebp-20h]
  __int16 v217; // [esp+3F8h] [ebp-1Ch]
  __int16 k; // [esp+3FCh] [ebp-18h]
  int v219; // [esp+400h] [ebp-14h]
  unsigned __int8 i; // [esp+404h] [ebp-10h]

  v165 = eax0;
  v205 = a3;
  sub_45958(eax0, 2, (__int16 *)a11, &v167);
  sub_45958(v165, 3, (__int16 *)a11, &v202);
  sub_1DA4C((T_Star *)a11, *v165, 0, 0xFFFFFFFF);
  sub_1DB70((T_Star *)a11, *v165, 0, 0xFFFFFFFF);
  v217 = 1;
  if ( ((1 << V_RaceIndex) & (*(unsigned __int8 *)(a11 + 0x14) | *(unsigned __int8 *)(a11 + 0x15))) == 0 )
  {
    v217 = 1;
  }
  if ( *v165 == V_RaceIndex && V_FlashPopExists == FALSE )
  {
    v217 = 1;
  }
  v12 = 0;
  for ( i = 0; v12 < a2; ++v12 )
  {
    if ( (*(_WORD *)(a4 + 2 * v12) & 0x20) != 0 )
    {
      i |= 1 << (*(_BYTE *)(a4 + 2 * v12) & 7);
    }
  }
  v13 = sub_1D794((P_Location)a11, (P_Ship *)v87);
  v168 = 0;
  for ( j = 0; j < v13; ++j )
  {
    v15 = v87[j];
    if ( v15[0x58] == 4 && ((1 << *((_WORD *)v15 + 0x2B)) & i) != 0 )
    {
      v168 = 0xFFFFFFFF;
      break;
    }
  }
  if ( !v168 && V_RaceIndex == *v165 && V_FlashPopExists == FALSE )
  {
    return 2;
  }
  if ( (_WORD)v205 )
  {
    v16 = 0;
    pShip = 0;
    v179 = 0;
    if ( v217 == 1 )
    {
      if ( v168 )
      {
        Unknown_6C = 0;
        Unknown_70 = 0;
        v170 = 0;
        Unknown_74 = 0;
        v171 = 0;
        Unknown_78 = 0;
        Unknown_7C = 0;
        Unknown_80 = 0.0;
        LOWORD(v208) = 0;
        if ( (__int16)v205 > 0 )
        {
          do
          {
            v17 = *(_BYTE *)(*(_DWORD *)(a6 + 4 * (__int16)v208) + 0x58);
            a1 = *(_DWORD *)(a6 + 4 * (__int16)v208);
            if ( v17 == 4 )
            {
              for ( k = 0; k < v13; ++k )
              {
                v174 = 4 * k;
                v175 = (T_Ship *)v87[v174 / 4];
                if ( (i & (1 << v175->raceIndex)) != 0 )
                {
                  Unknown_62 = v175->Unknown_62;
                  pHullCell = v175->pHullCell;
                  Unknown_67 = v175->Unknown_67;
                  Unknown_68 = v175->Unknown_68;
                  Unknown_6C = v175->Unknown_6C;
                  Unknown_70 = v175->Unknown_70;
                  Unknown_74 = v175->Unknown_74;
                  Unknown_78 = v175->Unknown_78;
                  Unknown_7C = v175->Unknown_7C;
                  Unknown_80 = v175->Unknown_80;
                  Unknown_84 = v175->Unknown_84;
                  if ( sub_4A480(v175, 3u, a1) )
                  {
                    sub_49A40(a1, 0xFFFFFFFF);
                    v171 = a1;
                    v170 = v87[v174 / 4];
                  }
                  v18 = (char *)v87[k];
                  v18[0x62] = Unknown_62;
                  *(_DWORD *)(v18 + 0x63) = pHullCell;
                  v18[0x67] = Unknown_67;
                  *((_DWORD *)v18 + 0x1A) = Unknown_68;
                  *((_DWORD *)v18 + 0x1B) = Unknown_6C;
                  *((_DWORD *)v18 + 0x1C) = Unknown_70;
                  *((_DWORD *)v18 + 0x1D) = Unknown_74;
                  *((_DWORD *)v18 + 0x1E) = Unknown_78;
                  *((_DWORD *)v18 + 0x1F) = Unknown_7C;
                  *((float *)v18 + 0x20) = Unknown_80;
                  *((_DWORD *)v18 + 0x21) = Unknown_84;
                }
              }
              if ( v171 != a1 )
              {
                sub_49A40(a1, 0);
              }
            }
            LOWORD(v208) = v208 + 1;
          }
          while ( (__int16)v208 < (__int16)v205 );
        }
        LOWORD(v203) = 0;
        if ( (__int16)v205 > 0 )
        {
          do
          {
            v19 = *(T_Ship **)(a6 + 4 * (__int16)v203);
            Unknown_28 = v19->Unknown_28;
            v201 = v19;
            if ( (!Unknown_28 || Q_ShipHasGizmo_sub_4A534(v19, 0x49)) && v201->locationType == 4 && v201->Unknown_88 )
            {
              if ( sub_4A564((int)v201) )
              {
                for ( m = 0; m < v13; ++m )
                {
                  v21 = v87[m];
                  if ( (i & (1 << v21[0x2B])) != 0 )
                  {
                    if ( sub_4A480(v201, 3u, (int)v21) )
                    {
                      v22 = v201;
                      *(_BYTE *)a12 = 3;
                      *(_DWORD *)(a12 + 1) = v22;
                      return 0xFFFFFFFF;
                    }
                    v179 = v201;
                  }
                }
              }
              else
              {
                pShip = v201;
              }
            }
            LOWORD(v203) = v203 + 1;
          }
          while ( (__int16)v203 < (__int16)v205 );
        }
        v24 = v179;
        if ( v179 )
        {
          v25 = sub_4937C(v179, 0x39);
          if ( v25 != 0xFFFFFFFF && (v24->Unknown_9C & 4) == 0 && v24->Unknown_88 > 0xC )
          {
            v24->Unknown_62 = 1;
            v24->Unknown_67 = 5;
            v24->pHullCell = &v24->hullCells[v25];
            *(_BYTE *)a12 = 3;
            *(_DWORD *)(a12 + 1) = v24;
            sub_49B3C(v24, 0);
            if ( (v24->Unknown_84 & 1) != 0 )
            {
              return 0xFFFFFFFF;
            }
          }
        }
        if ( pShip )
        {
          v26 = sub_4937C(pShip, 0x41);
          if ( v26 != 0xFFFFFFFF )
          {
            v27 = pShip;
            if ( pShip->Unknown_88 > 0xD )
            {
              pShip->Unknown_62 = 1;
              v27->Unknown_67 = 5;
              v28 = pShip;
              pShip->pHullCell = &pShip->hullCells[v26];
              *(_BYTE *)a12 = 3;
              *(_DWORD *)(a12 + 1) = v28;
              sub_49B3C(pShip, 0);
              if ( (pShip->Unknown_84 & 1) != 0 )
              {
                return 0xFFFFFFFF;
              }
            }
          }
        }
        v200 = v171;
        if ( v171 && sub_43184((int)v165, v171, (int)v170) )
        {
          *(_BYTE *)a12 = 3;
          *(_DWORD *)(a12 + 1) = v171;
          return 0xFFFFFFFF;
        }
        v29 = 0;
        for ( n = 0; n < (__int16)v205; ++n )
        {
          v31 = *(_DWORD *)(a6 + 4 * n);
          if ( (!*(_DWORD *)(v31 + 0x28) || Q_ShipHasGizmo_sub_4A534(*(P_Ship *)(a6 + 4 * n), 0x49))
            && *(_BYTE *)(v31 + 0x58) == 4
            && *(_DWORD *)(v31 + 0x88) * *(_DWORD *)v31 * *(_DWORD *)(v31 + 0x8C) > v29 )
          {
            v29 = *(_DWORD *)(v31 + 0x88) * *(_DWORD *)v31 * *(_DWORD *)(v31 + 0x8C);
            v200 = v31;
          }
        }
        if ( !v200 )
        {
          return 0;
        }
        if ( !a7 || (v146 = 0.0, v147 = 0.0, v148 = 0.0, LOWORD(v213) = 0, a7 <= 0) )
        {
LABEL_101:
          v37 = 0;
          v143 = 0.0;
          v144 = 0.0;
          v145 = 0.0;
          v173 = 99999.0;
          v38 = (float *)(v200 + 0x9E);
          for ( ii = 0; ii < v13; ++ii )
          {
            v40 = (char *)v87[ii];
            if ( (i & (1 << *((_WORD *)v40 + 0x2B))) != 0 )
            {
              v181 = v133;
              v149 = 0.0;
              v150 = 0.0;
              v151 = 0.0;
              v149 = *(float *)(v40 + 0x9E) - *v38;
              v150 = *(float *)(v40 + 0xA2) - v38[1];
              v151 = *(float *)(v40 + 0xA6) - v38[2];
              *(float *)v133 = v149;
              *(float *)&v133[1] = v150;
              *(float *)&v133[2] = v151;
              v143 = v149;
              v144 = v150;
              v145 = v151;
              v182 = sqrt(v150 * v150 + v149 * v149 + v151 * v151);
              v41 = v40[0x58];
              v190 = v182;
              if ( v41 != 4 )
              {
                v190 = v182 + 10000.0;
              }
              if ( v190 < (double)v173 && v190 > 600.0 )
              {
                v37 = (int)v40;
                v173 = v190;
              }
            }
          }
          v42 = v200;
          if ( v200 && v37 )
          {
            v183 = v120;
            v153 = 0.0;
            v154 = 0.0;
            v155 = 0.0;
            v153 = *v38 - *(float *)(v37 + 0x9E);
            v154 = v38[1] - *(float *)(v37 + 0xA2);
            v43 = v38[2] - *(float *)(v37 + 0xA6);
            *(float *)v120 = v153;
            v155 = v43;
            *(float *)&v120[1] = v154;
            *(float *)&v120[2] = v155;
            v156 = 0.0;
            v143 = v153;
            v157 = 0.0;
            v144 = v154;
            v158 = 0.0;
            v145 = v155;
            v194 = rand() % 0xC8 + 0x64;
            v156 = (float)v194;
            v194 = rand() % 0xC8 + 0x64;
            v157 = (float)v194;
            v194 = rand() % 0xC8 + 0x64;
            v158 = (float)v194;
            v184 = v162;
            v114 = v143 + v156;
            *(float *)v162 = v114;
            *(float *)&v115 = v144 + v157;
            v162[1] = v115;
            *(float *)&v116 = v145 + v158;
            v162[2] = v116;
            v143 = v114;
            v144 = *(float *)&v115;
            v145 = *(float *)&v116;
            v194 = sub_49B68(v42, 1);
            v193 = (float)v194;
            if ( v193 < 0.0 )
            {
              v194 = sub_49B68(v37, 1);
              v193 = (double)v194 * 1.2;
            }
            if ( v193 >= 0.0 )
            {
              sub_53054(&v143, v193);
            }
            v185 = v152;
            v126 = 0.0;
            v127 = 0.0;
            v128 = 0.0;
            v126 = v143 + *(float *)(v37 + 0x9E);
            v127 = v144 + *(float *)(v37 + 0xA2);
            v44 = v145 + *(float *)(v37 + 0xA6);
            *(float *)v152 = v126;
            v128 = v44;
            *(float *)&v152[1] = v127;
            *(float *)&v152[2] = v128;
            v143 = v126;
            v144 = v127;
            v145 = v128;
            v45 = v200;
            *(_BYTE *)a12 = 3;
            *(_DWORD *)(a12 + 1) = v45;
            *(_BYTE *)(v45 + 0x62) = 0;
            *(_BYTE *)(v45 + 0x67) = 3;
            *(_DWORD *)(v45 + 0x63) = 0;
            *(_DWORD *)(v45 + 0x68) = 0;
            *(float *)(v45 + 0x6C) = v143;
            *(float *)(v45 + 0x70) = v144;
            *(float *)(v45 + 0x74) = v145;
            return 0xFFFFFFFF;
          }
          return 0;
        }
LABEL_79:
        v32 = *(_DWORD *)(a8 + 4 * (__int16)v213);
        for ( jj = 0; ; ++jj )
        {
          if ( jj >= (int)*(unsigned __int16 *)(v32 + 0x1A) )
          {
            LOWORD(v213) = v213 + 1;
            if ( (__int16)v213 >= a7 )
            {
              goto LABEL_101;
            }
            goto LABEL_79;
          }
          v33 = 4 * jj + *(_DWORD *)(v32 + 0x10);
          v34 = *(_BYTE *)(v33 + 1);
          if ( v34 != (char)0xFF
            && (*(_WORD *)(v33 + 2) & 1) != 0
            && (V_PlanetItems.item[*(unsigned __int8 *)(v33 + 1)].flags & 4) != 0
            && (v34 != 0x11 || *(_BYTE *)(v32 + 0x58)) )
          {
            v35 = 0;
            v176 = 99999.0;
            while ( v35 < v13 )
            {
              v36 = (char *)v87[v35];
              if ( (i & (1 << *((_WORD *)v36 + 0x2B))) != 0 )
              {
                v178 = v110;
                v129 = 0.0;
                v130 = 0.0;
                v131 = 0.0;
                v129 = *(float *)v32 - *(float *)(v36 + 0x9E);
                v130 = *(float *)(v32 + 4) - *(float *)(v36 + 0xA2);
                v131 = *(float *)(v32 + 8) - *(float *)(v36 + 0xA6);
                *(float *)v110 = v129;
                *(float *)&v110[1] = v130;
                *(float *)&v110[2] = v131;
                v146 = v129;
                v147 = v130;
                v148 = v131;
                v180 = sqrt(v130 * v130 + v129 * v129 + v131 * v131);
                v177 = v180;
                if ( v36[0x58] != 4 )
                {
                  v177 = v180 + 10000.0;
                }
                if ( v177 < (double)v176 )
                {
                  a5 = v36;
                  v176 = v177;
                }
              }
              ++v35;
            }
            if ( *(_BYTE *)(*(_DWORD *)(v32 + 0x10) + 4 * jj + 1) != 0x11 || v176 >= 1440.0 )
            {
              if ( !a5 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x13E7);
              }
              *(_DWORD *)(v32 + 0x6B) = 4 * jj + *(_DWORD *)(v32 + 0x10);
              *(_DWORD *)(v32 + 0x6F) = a5;
              sub_3676C((T_Planet *)v32, 0);
              if ( (*(_BYTE *)(v32 + 0x73) & 1) != 0 )
              {
                break;
              }
            }
          }
        }
        *(_BYTE *)a12 = 2;
        *(_DWORD *)(a12 + 1) = v32;
        return 0xFFFFFFFF;
      }
      else
      {
        v46 = *(_WORD *)(a11 + 0x5A);
        LOWORD(v210) = 0;
        if ( v46 <= 0 )
        {
          return 0;
        }
        while ( 1 )
        {
          v48 = *(_DWORD *)(a11 + 4 * (__int16)v210 + 0x46);
          v49 = *(unsigned __int8 *)(v48 + 0x57);
          if ( v49 != 0xFF
            && (_BYTE)v49 != *v165
            && (v165[v49 + 0x1C0] == 2
             || V_RaceIndex == *(_BYTE *)(v48 + 0x57) && ((1 << *v165) & (unsigned __int8)byte_D8460[*(__int16 *)(a11 + 4)]) != 0) )
          {
            v50 = *(T_Planet **)(a11 + 4 * (__int16)v210 + 0x46);
            if ( !v48 )
            {
              return 0;
            }
            v51 = v165;
            for ( kk = *(_WORD *)(v48 + 0x18); kk < (int)v50->word1A; ++kk )
            {
              if ( *((_BYTE *)v50->pUnknown_10 + 4 * kk + 1) == 0x17 && Q_PLANET_CPP_GetShip_sub_35A70(v50, kk)->raceIndex == *v51 )
              {
                Ship_sub_35A70 = Q_PLANET_CPP_GetShip_sub_35A70(v50, kk);
                if ( Ship_sub_35A70->raceIndex != *v51 )
                {
                  Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1468);
                }
                Q_TryInvadePlanet_sub_36CD4(v50, kk, (int *)&v186);
                if ( Ship_sub_35A70 != Q_PLANET_CPP_GetShip_sub_35A70(v50, kk) )
                {
                  Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x146C);
                }
                v186 = sub_35C38(v50, Ship_sub_35A70);
                if ( v186 != 0xFFFFFFFF )
                {
                  Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x146E);
                }
                return 0xFFFFFFFF;
              }
            }
            v187 = sub_361B8(v50);
            if ( !v187 )
            {
              LOWORD(v209) = 0;
              if ( (__int16)v205 > 0 )
              {
                do
                {
                  if ( v16 )
                  {
                    break;
                  }
                  v54 = a6 + 4 * (__int16)v209;
                  v55 = *(_DWORD *)v54;
                  if ( *(_BYTE *)(*(_DWORD *)v54 + 0x58) == 4 )
                  {
                    for ( mm = 0; mm < *(_DWORD *)(v55 + 0x15A); ++mm )
                    {
                      if ( *(_BYTE *)(v55 + 7 * mm + 0xAB) == 0x49 )
                      {
                        v16 = v55;
                        break;
                      }
                    }
                  }
                  LOWORD(v209) = v209 + 1;
                }
                while ( (__int16)v209 < (__int16)v205 );
              }
              if ( v16 )
              {
                *(_BYTE *)a12 = 3;
                *(_DWORD *)(a12 + 1) = v16;
                *(_BYTE *)(v16 + 0x62) = 0;
                *(_DWORD *)(v16 + 0x63) = 0;
                *(_BYTE *)(v16 + 0x67) = 1;
                *(_DWORD *)(v16 + 0x68) = v50;
                return 0xFFFFFFFF;
              }
              v57 = 0;
              if ( (__int16)v205 > 0 )
              {
                while ( 1 )
                {
                  v58 = (P_Ship *)(a6 + 4 * v57);
                  v59 = *v58;
                  if ( !(*v58)->Unknown_28 || Q_ShipHasGizmo_sub_4A534(*v58, 0x49) )
                  {
                    v60 = 0;
                    if ( v59->Unknown_5D == 1 && v59->Unknown_5E == a11 )
                    {
                      v60 = 0xFFFFFFFF;
                    }
                    if ( v59->locationType == 4 && !v60 && Q_ShipHasGizmo_sub_4A534(v59, 0x46) )
                    {
                      break;
                    }
                  }
                  if ( ++v57 >= (__int16)v205 )
                  {
                    goto LABEL_162;
                  }
                }
                if ( sub_4A480(v59, 1u, (int)v50) )
                {
                  v16 = (int)v59;
                }
              }
LABEL_162:
              if ( v16 )
              {
                *(_BYTE *)a12 = 3;
                *(_DWORD *)(a12 + 1) = v16;
                return 0xFFFFFFFF;
              }
            }
            v61 = 0;
            if ( v50->word1A - v50->word18 > (unsigned __int16)v50->word1E )
            {
              v61 = 0xFFFFFFFF;
            }
            if ( v187 == 0xFFFFFFFF || v61 == 0xFFFFFFFF )
            {
              break;
            }
          }
          v47 = *(_WORD *)(a11 + 0x5A);
          LOWORD(v210) = v210 + 1;
          if ( (__int16)v210 >= v47 )
          {
            return 0;
          }
        }
        v62 = 0;
        LOWORD(v212) = 0;
        if ( (__int16)v205 > 0 )
        {
          do
          {
            if ( v16 )
            {
              break;
            }
            v63 = *(T_Ship **)(a6 + 4 * (__int16)v212);
            if ( (!v63->Unknown_28 || Q_ShipHasGizmo_sub_4A534(*(P_Ship *)(a6 + 4 * (__int16)v212), 0x49))
              && v63->locationType == 4
              && (sub_4A564((int)v63) || Q_ShipHasGizmo_sub_4A534(v63, 0x46)) )
            {
              v62 = (int)v63;
              if ( sub_4A480(v63, 1u, (int)v50) )
              {
                v16 = (int)v63;
              }
            }
            LOWORD(v212) = v212 + 1;
          }
          while ( (__int16)v212 < (__int16)v205 );
        }
        if ( v16 )
        {
          *(_BYTE *)a12 = 3;
          *(_DWORD *)(a12 + 1) = v16;
          return 0xFFFFFFFF;
        }
        if ( !v62 )
        {
          return v16;
        }
        v134 = 0.0;
        v135 = 0.0;
        v136 = 0.0;
        v191 = &v111;
        v134 = *(float *)(v62 + 0x9E) - v50->v.x;
        v135 = *(float *)(v62 + 0xA2) - v50->v.y;
        v136 = *(float *)(v62 + 0xA6) - v50->v.z;
        v111 = v134;
        v121 = 0.0;
        v122 = 0.0;
        v112 = v135;
        v123 = 0.0;
        v113 = v136;
        v194 = rand() % 0x64 + 0x14;
        v121 = (float)v194;
        v194 = rand() % 0x64 + 0x14;
        v122 = (float)v194;
        v194 = rand() % 0x64 + 0x14;
        v123 = (float)v194;
        v192 = v124;
        v117 = v111 + v121;
        *(float *)v124 = v117;
        *(float *)&v118 = v112 + v122;
        v124[1] = v118;
        *(float *)&v119 = v113 + v123;
        v124[2] = v119;
        v111 = v117;
        v112 = *(float *)&v118;
        v113 = *(float *)&v119;
        v194 = sub_49B68(v62, 2);
        v188 = (float)v194;
        if ( v188 < 0.0 )
        {
          v194 = sub_35ED8(v50);
          v188 = (double)v194 * 1.2;
        }
        if ( v188 >= 0.0 )
        {
          sub_53054(&v111, v188);
        }
        v195 = v132;
        v140 = 0.0;
        v141 = 0.0;
        v142 = 0.0;
        v140 = v111 + v50->v.x;
        v141 = v112 + v50->v.y;
        v64 = v113 + v50->v.z;
        *(float *)v132 = v140;
        v142 = v64;
        *(float *)&v132[1] = v141;
        *(float *)&v132[2] = v142;
        v111 = v140;
        v112 = v141;
        v113 = v142;
        *(_BYTE *)a12 = 3;
        *(_DWORD *)(a12 + 1) = v62;
        *(_BYTE *)(v62 + 0x62) = 0;
        *(_BYTE *)(v62 + 0x67) = 3;
        *(_DWORD *)(v62 + 0x63) = 0;
        *(_DWORD *)(v62 + 0x68) = 0;
        *(float *)(v62 + 0x6C) = v111;
        *(float *)(v62 + 0x70) = v112;
        *(float *)(v62 + 0x74) = v113;
        return 0xFFFFFFFF;
      }
    }
    else
    {
      v92 = 0;
      v93 = 0;
      v94 = 0;
      v95 = 0;
      v96 = 0;
      v97 = 0.0;
      LOWORD(v219) = 0;
      if ( (__int16)v205 > 0 )
      {
        do
        {
          if ( v16 )
          {
            break;
          }
          v65 = *(_BYTE *)(*(_DWORD *)(a6 + 4 * (__int16)v219) + 0x58);
          v164 = *(_DWORD *)(a6 + 4 * (__int16)v219);
          if ( v65 == 4 )
          {
            for ( nn = 0; nn < v13 && !v16; ++nn )
            {
              v66 = (T_Ship *)v87[nn];
              v197 = 4 * nn;
              if ( (i & (1 << v66->raceIndex)) != 0 )
              {
                v88 = v66->Unknown_62;
                v89 = v66->pHullCell;
                v90 = v66->Unknown_67;
                v91 = v66->Unknown_68;
                v92 = v66->Unknown_6C;
                v93 = v66->Unknown_70;
                v94 = v66->Unknown_74;
                v95 = v66->Unknown_78;
                v96 = v66->Unknown_7C;
                v97 = v66->Unknown_80;
                v98 = v66->Unknown_84;
                if ( sub_4A480(v66, 3u, v164) )
                {
                  v16 = v164;
                  v196 = v87[v197 / 4];
                }
                v67 = (char *)v87[nn];
                v67[0x62] = v88;
                *(_DWORD *)(v67 + 0x63) = v89;
                v67[0x67] = v90;
                *((_DWORD *)v67 + 0x1A) = v91;
                *((_DWORD *)v67 + 0x1B) = v92;
                *((_DWORD *)v67 + 0x1C) = v93;
                *((_DWORD *)v67 + 0x1D) = v94;
                *((_DWORD *)v67 + 0x1E) = v95;
                *((_DWORD *)v67 + 0x1F) = v96;
                *((float *)v67 + 0x20) = v97;
                *((_DWORD *)v67 + 0x21) = v98;
              }
            }
          }
          LOWORD(v219) = v219 + 1;
        }
        while ( (__int16)v219 < (__int16)v205 );
      }
      if ( v16 )
      {
        v68 = (int)v196;
        sub_49A40(v16, 0xFFFFFFFF);
        if ( sub_43184((int)v165, v16, v68) )
        {
          *(_BYTE *)a12 = 3;
          *(_DWORD *)(a12 + 1) = v16;
          return 0xFFFFFFFF;
        }
      }
      LOWORD(v207) = 0;
      if ( (__int16)v205 > 0 )
      {
        do
        {
          if ( v16 )
          {
            break;
          }
          v69 = *(T_Ship **)(a6 + 4 * (__int16)v207);
          if ( v69->locationType == 4 && v69->Unknown_88 )
          {
            if ( sub_4A564(*(_DWORD *)(a6 + 4 * (__int16)v207)) )
            {
              for ( i1 = 0; i1 < v13; ++i1 )
              {
                v70 = v87[i1];
                if ( (i & (1 << v70[0x2B])) != 0 )
                {
                  if ( sub_4A480(v69, 3u, (int)v70) )
                  {
                    *(_BYTE *)a12 = 3;
                    *(_DWORD *)(a12 + 1) = v69;
                    return 0xFFFFFFFF;
                  }
                  v179 = v69;
                }
              }
            }
            else
            {
              pShip = v69;
            }
          }
          LOWORD(v207) = v207 + 1;
        }
        while ( (__int16)v207 < (__int16)v205 );
      }
      v71 = v179;
      if ( v179 )
      {
        v72 = sub_4937C(v179, 0x39);
        if ( v72 != 0xFFFFFFFF && (v71->Unknown_9C & 4) == 0 && v71->Unknown_88 > 0xC )
        {
          v71->Unknown_62 = 1;
          v71->Unknown_67 = 5;
          v71->pHullCell = &v71->hullCells[v72];
          *(_BYTE *)a12 = 3;
          *(_DWORD *)(a12 + 1) = v71;
          sub_49B3C(v71, 0);
          if ( (v71->Unknown_84 & 1) != 0 )
          {
            return 0xFFFFFFFF;
          }
        }
      }
      if ( pShip )
      {
        v73 = sub_4937C(pShip, 0x41);
        if ( v73 != 0xFFFFFFFF )
        {
          v74 = pShip;
          if ( pShip->Unknown_88 > 0xD )
          {
            pShip->Unknown_62 = 1;
            v74->Unknown_67 = 5;
            pShip->pHullCell = &pShip->hullCells[v73];
            v75 = pShip;
            *(_BYTE *)a12 = 3;
            *(_DWORD *)(a12 + 1) = v75;
            sub_49B3C(pShip, 0);
            if ( (pShip->Unknown_84 & 1) != 0 )
            {
              return 0xFFFFFFFF;
            }
          }
        }
      }
      v76 = *(int **)(a11 + 0x2C);
      if ( *v76 == a11 )
      {
        v77 = v76[1];
      }
      else
      {
        v77 = *v76;
      }
      v78 = v77;
      v79 = 0;
      if ( (__int16)v205 > 0 )
      {
        while ( 1 )
        {
          v16 = *(_DWORD *)(a6 + 4 * v79);
          v80 = *(_BYTE *)(v16 + 0x58);
          if ( v80 == 3 )
          {
            break;
          }
          if ( v80 != 4 )
          {
            ++v79;
            v16 = 0;
            if ( v79 < (__int16)v205 )
            {
              continue;
            }
          }
          goto LABEL_240;
        }
        sub_35C38(*(T_Planet **)(v16 + 0x59), *(T_Ship **)(a6 + 4 * v79));
        if ( *(_BYTE *)(v16 + 0x58) != 4 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x15E4);
        }
      }
LABEL_240:
      if ( !v16 )
      {
        return v16;
      }
      if ( *(_BYTE *)(v16 + 0x58) != 4 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x15EF);
      }
      *(_BYTE *)(v16 + 0x5D) = 1;
      *(_DWORD *)(v16 + 0x5E) = v78;
      return 2;
    }
  }
  else
  {
    if ( !a7 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x15FD);
    }
    if ( !v168 )
    {
      return 0;
    }
    v159 = 0.0;
    v160 = 0.0;
    v161 = 0.0;
    v215 = 0;
    if ( a7 > 0 )
    {
      while ( 2 )
      {
        v214 = 0;
        v81 = *(_DWORD *)(a8 + 4 * v215);
        while ( v214 < (int)*(unsigned __int16 *)(v81 + 0x1A) )
        {
          v82 = 4 * v214 + *(_DWORD *)(v81 + 0x10);
          if ( *(_BYTE *)(v82 + 1) != 0xFF
            && (*(_WORD *)(v82 + 2) & 1) != 0
            && (V_PlanetItems.item[*(unsigned __int8 *)(v82 + 1)].flags & 4) != 0
            && (*(_BYTE *)(v82 + 1) != 0x11 || *(_BYTE *)(v81 + 0x58)) )
          {
            v198 = 99999.0;
            for ( i2 = 0; i2 < v13; ++i2 )
            {
              v84 = (char *)v87[i2];
              if ( (i & (1 << *((_WORD *)v84 + 0x2B))) != 0 )
              {
                v172 = v125;
                v137 = 0.0;
                v138 = 0.0;
                v139 = 0.0;
                v137 = *(float *)v81 - *(float *)(v84 + 0x9E);
                v138 = *(float *)(v81 + 4) - *(float *)(v84 + 0xA2);
                v139 = *(float *)(v81 + 8) - *(float *)(v84 + 0xA6);
                *(float *)v125 = v137;
                *(float *)&v125[1] = v138;
                *(float *)&v125[2] = v139;
                v159 = v137;
                v160 = v138;
                v161 = v139;
                v166 = sqrt(v138 * v138 + v137 * v137 + v139 * v139);
                v85 = v84[0x58];
                v199 = v166;
                if ( v85 != 4 )
                {
                  v199 = v166 + 10000.0;
                }
                if ( v199 < (double)v198 )
                {
                  v163 = (int)v84;
                  v198 = v199;
                }
              }
            }
            if ( *(_BYTE *)(*(_DWORD *)(v81 + 0x10) + 4 * v214 + 1) != 0x11 || v198 >= 1440.0 )
            {
              if ( !v163 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1633);
              }
              v86 = v163;
              *(_DWORD *)(v81 + 0x6B) = 4 * v214 + *(_DWORD *)(v81 + 0x10);
              *(_DWORD *)(v81 + 0x6F) = v86;
              sub_3676C((T_Planet *)v81, 0);
              if ( (*(_BYTE *)(v81 + 0x73) & 1) != 0 )
              {
                *(_BYTE *)a12 = 2;
                *(_DWORD *)(a12 + 1) = v81;
                return 0xFFFFFFFF;
              }
            }
          }
          ++v214;
        }
        if ( ++v215 < a7 )
        {
          continue;
        }
        break;
      }
      return 0;
    }
    else
    {
      return 0;
    }
  }
}
// 42437: conditional instruction was optimized away because esi.4==0
// 41268: using guessed type T_Ship *var_40C;

//----- (00043184) --------------------------------------------------------
unsigned int __fastcall sub_43184(int a1, int a2, int a3)
{
  __int16 v4; // di
  __int16 i; // bx
  int v6; // esi
  char v8[12]; // [esp+0h] [ebp-2Ch] BYREF
  _DWORD v9[2]; // [esp+Ch] [ebp-20h]
  __int16 v10; // [esp+14h] [ebp-18h]
  int v11; // [esp+18h] [ebp-14h]

  strcpy(v8, "E?2.-&%#!");
  v9[0] = unk_9696C;
  v9[1] = *((_DWORD *)&unk_9696C + 1);
  v10 = *((_WORD *)&unk_9696C + 4);
  if ( sub_4A8FC((P_Ship)a2) / 2 < *(_DWORD *)(a2 + 0x88) )
  {
    *(_BYTE *)(a2 + 0x62) = 1;
    v4 = 0;
    v11 = a2 + 0xAB;
    while ( v4 < *(_DWORD *)(a2 + 0x15A) )
    {
      if ( V_Gizmos[*(char *)(a2 + 7 * v4 + 0xAB)].cat == 5 )
      {
        for ( i = 0; i < 0xA; ++i )
        {
          v6 = 7 * v4;
          if ( *(_BYTE *)(a2 + v6 + 0xAB) == v8[i] )
          {
            *(_DWORD *)(a2 + 0x63) = v6 + v11;
            *(_BYTE *)(a2 + 0x67) = *((_BYTE *)v9 + i);
            *(_DWORD *)(a2 + 0x68) = a3;
            sub_49B3C((P_Ship)a2, 0);
            if ( (*(_BYTE *)(a2 + 0x84) & 1) != 0 )
            {
              return 0xFFFFFFFF;
            }
          }
        }
      }
      ++v4;
    }
  }
  return 0;
}

//----- (00043374) --------------------------------------------------------
char __fastcall sub_43374(P_Race pRace, int a2)
{
  char v3; // ch
  __int16 i; // bx

  v3 = 0;
  for ( i = 0; i < V_Game.racesNum; ++i )
  {
    if ( i != pRace->index
      && V_Game.races[i].Unknown_03 != 0xFFFFFFFF
      && pRace->Unknown_1C0[i] == 2
      && (a2 == 0xFFFFFFFF || sub_43B7C(pRace, i) > a2) )
    {
      v3 |= 1 << i;
    }
  }
  return v3;
}

//----- (000433E0) --------------------------------------------------------
unsigned int __fastcall sub_433E0(P_Race pRace, WORD a2, P_Star pStar)
{
  __int16 v5; // dx
  int v6; // ebx
  WORD v7; // si
  WORD v8; // bx

  if ( a2 < 0 || a2 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1705);
  }
  if ( !pStar )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1706);
  }
  if ( pRace->Unknown_1C0[a2] == 2 )
  {
    return 0;
  }
  v5 = 10 * (V_Game.Unknown_D8A[0x2A] + 1);
  if ( pRace->Unknown_1C0[v5] == 3 )
  {
    v5 = 20 * (V_Game.Unknown_D8A[0x2A] + 1);
  }
  v6 = a2;
  v7 = pRace->Unknown_1B2[a2] - v5;
  pRace->Unknown_1B2[v7] = v7;
  if ( pRace->Unknown_1C0[v6] == 3 )
  {
    v8 = pRace->Unknown_1C7[4];
    if ( v7 > v8 )
    {
      pRace->Unknown_1B2[v7] = v8 - 0xA;
    }
  }
  byte_D8460[pStar->index] |= 1 << pRace->index;
  return 0xFFFFFFFF;
}

//----- (000434E4) --------------------------------------------------------
int __fastcall sub_434E4(char *a1, int a2)
{
  int v3; // eax
  int v4; // ebx
  int ShipsNum_sub_40224; // eax
  int v7; // kr04_4
  int v8; // edx
  int v9; // kr0C_4
  char *v10; // ecx
  int v11; // ebx
  int v12; // eax
  int v13; // kr14_4
  int v14; // kr1C_4
  int v15; // eax
  unsigned int v16; // ecx
  P_Ship v17; // edx
  int raceIndex; // eax
  T_Star *star; // esi
  int v20; // eax
  int v21; // edi
  int v22; // eax
  P_Ship v23; // edx
  unsigned __int16 v24; // cx
  int v25; // edx
  int v26; // kr24_4
  UWORD word42; // si
  int v28; // ebx
  _BYTE *pUnknown_10; // kr28_4
  int v30; // kr2C_4
  int v31; // esi
  int v32; // kr34_4
  P_Location v33; // edx
  T_Star *x_low; // ecx
  int v35; // kr3C_4
  int i; // eax
  int v37; // edx
  __int16 v38; // bx
  unsigned __int16 v39; // dx
  int v40; // edx
  int v41; // kr44_4
  int v42; // edi
  int v43; // kr4C_4
  int v44; // edi
  int v45; // kr54_4
  T_Star *v46; // edx
  int v47; // eax
  int v48; // ecx
  int v49; // edi
  int v50; // kr5C_4
  T_Race *races; // edx
  int v52; // eax
  char *v53; // ecx
  int v54; // ebx
  int v55; // edx
  int v56; // edx
  int v57; // kr64_4
  char v58; // al
  int v59[107]; // [esp+0h] [ebp-6F8h] BYREF
  P_Ship v60[107]; // [esp+1ACh] [ebp-54Ch] BYREF
  int v61[107]; // [esp+358h] [ebp-3A0h] BYREF
  P_Ship v62[107]; // [esp+504h] [ebp-1F4h] BYREF
  _DWORD v63[3]; // [esp+6B0h] [ebp-48h]
  int v64; // [esp+6BCh] [ebp-3Ch]
  char *v65; // [esp+6C0h] [ebp-38h]
  int v66; // [esp+6C4h] [ebp-34h]
  int v67; // [esp+6C8h] [ebp-30h]
  int v68; // [esp+6CCh] [ebp-2Ch]
  T_Planet *v69; // [esp+6D0h] [ebp-28h]
  int v70; // [esp+6D4h] [ebp-24h]
  int v71; // [esp+6D8h] [ebp-20h]
  P_Location v72; // [esp+6DCh] [ebp-1Ch]
  int v73; // [esp+6E0h] [ebp-18h]

  v3 = a1[0x19D];
  v4 = 0;
  v66 = 0;
  if ( (unsigned __int16)word_968E8[v3] <= *(int *)(a1 + 0x19E) )
  {
    v66 = 0xFFFFFFFF;
    if ( a2 != 1 )
    {
      return v66;
    }
    v58 = a1[0x19D] - 5;
    v67 = 0;
    switch ( v58 )
    {
      case 0:
        ShipsNum_sub_40224 = Q_Race_GetShipsNum_sub_40224((P_Race)a1, (P_Ship *)v61, 0);
        if ( ShipsNum_sub_40224 > 0 )
        {
          v7 = 0;
          do
          {
            *(_DWORD *)(v61[v7] + 0x8C) = *(_DWORD *)(v61[v7] + 0x98);
            ++v7;
          }
          while ( 4 * v7 < 4 * ShipsNum_sub_40224 );
        }
        break;
      case 1:
        v8 = 0;
        v9 = 0;
        while ( v8 < V_Game.racesNum )
        {
          if ( &V_Game.races[v9] != (T_Race *)a1 )
          {
            v10 = (char *)&V_Game.races[v9] + 2 * (unsigned __int8)*a1;
            v11 = V_Game.races[v9].Unknown_1C7[3] + 0x14;
            if ( *((__int16 *)v10 + 0xD9) < v11 )
            {
              *((_WORD *)v10 + 0xD9) = v11;
            }
          }
          ++v8;
          ++v9;
        }
        break;
      case 2:
        v12 = Q_Race_GetShipsNum_sub_40224((P_Race)a1, (P_Ship *)v59, 0);
        if ( v12 > 0 )
        {
          v13 = 0;
          do
          {
            *(_DWORD *)(v59[v13++] + 0x88) *= 2;
          }
          while ( 4 * v13 < 4 * v12 );
        }
        break;
      case 3:
        v64 = 0;
        v14 = 0;
        while ( V_Game.starsNum > v64 )
        {
          if ( ((1 << *a1) & V_Game.stars[v14].racesBits) != 0 )
          {
            v15 = sub_1D794((P_Location)&V_Game.stars[v14], v60);
            if ( v15 > 0 )
            {
              v16 = 0;
              v73 = 4 * v15;
              do
              {
                v17 = v60[v16 / 4];
                raceIndex = v17->raceIndex;
                if ( raceIndex != (unsigned __int8)*a1 && v17->locationType == 4 )
                {
                  star = V_Game.races[raceIndex].star;
                  sub_1D538((P_Location)&V_Game.stars[v14], v17);
                  sub_1D3E8(star, v60[v16 / 4], 0);
                }
                v16 += 4;
              }
              while ( (int)v16 < v73 );
            }
          }
          ++v64;
          ++v14;
        }
        break;
      case 4:
        v71 = 0;
        v72.pPlanet = (P_Planet)V_Game.stars;
        while ( V_Game.starsNum > v71 )
        {
          if ( ((1 << *a1) & HIBYTE(v72.pPlanet->size)) != 0 )
          {
            v20 = sub_1D794(v72, v62);
            if ( v20 > 0 )
            {
              v21 = 4 * v20;
              v22 = 0;
              do
              {
                v23 = v62[v22 / 4u];
                if ( v23->raceIndex != (unsigned __int8)*a1 )
                {
                  v23->Unknown_88 = 0;
                }
                v22 += 4;
              }
              while ( v22 < v21 );
            }
          }
          ++v71;
          v72.pPlanet = (P_Planet)((char *)v72.pPlanet + 0x60);
        }
        break;
      case 5:
        v24 = 0xFFFF;
        v69 = 0;
        v25 = 0;
        v26 = 0;
        while ( v25 < V_Game.planetsNum )
        {
          if ( V_Game.planets[v26].raceIndex == *a1 && V_Game.planets[v26].type != 0xA )
          {
            word42 = V_Game.planets[v26].word42;
            if ( v24 > word42 )
            {
              v69 = &V_Game.planets[v26];
              v24 = word42;
            }
          }
          ++v25;
          ++v26;
        }
        if ( v69 )
        {
          v28 = 0;
          pUnknown_10 = v69->pUnknown_10;
          v30 = 0;
          while ( v28 < v69->word18 )
          {
            if ( !pUnknown_10[4 * v30] || pUnknown_10[4 * v30] == 1 )
            {
              v63[0] = unk_96994;
              v63[1] = *((_DWORD *)&unk_96994 + 1);
              v63[2] = *((_DWORD *)&unk_96994 + 2);
              pUnknown_10[4 * v30] = v63[rand() % 3];
            }
            ++v28;
            ++v30;
          }
        }
        break;
      case 6:
        v31 = 0;
        v32 = 0;
        while ( v31 < V_Game.shipsNum )
        {
          if ( V_Game.ships[v32].raceIndex != 0xFFFFFFFF && V_Game.ships[v32].locationType == 5 )
          {
            v33.pPlanet = (P_Planet)V_Game.ships[v32].pLocation;
            x_low = (T_Star *)LODWORD(v33.pPlanet->v.x);
            if ( (LODWORD(V_Game.ships[v32].vector.y) & 0x7FFFFFFF) == 0 )
            {
              x_low = (T_Star *)LODWORD(v33.pPlanet->v.y);
            }
            sub_1D3E8(x_low, &V_Game.ships[v32], 0);
          }
          ++v31;
          ++v32;
        }
        break;
      case 7:
        v68 = 0;
        v70 = 0;
        v35 = 0;
        while ( V_ResTree.num > v68 )
        {
          v37 = 0;
          for ( i = 0; i < V_Game.racesNum; ++i )
          {
            if ( ((1 << i) & (char)V_ResTree.items[0].next[v70 + 5]) != 0 )
            {
              ++v37;
            }
          }
          if ( v37 >= 2 )
          {
            V_ResTree.items[0].next[v70 + 5] |= 1 << *a1;
            v38 = v68;
            v39 = V_ResTree.a.w1[(unsigned __int8)*a1];
            if ( v39 == v68 )
            {
              V_ResTree.a.w1[(unsigned __int8)*a1] = 0xFFFF;
              word_106FB4[(unsigned __int8)*a1] = v38 ^ v39;
            }
          }
          ++v68;
          ++v35;
        }
        break;
      case 8:
        v40 = 0;
        v41 = 0;
        while ( v40 < V_Game.planetsNum )
        {
          if ( V_Game.planets[v41].raceIndex == *a1 )
          {
            V_Game.planets[v41].Unknown_62 = 0xFFFFFFFF;
          }
          ++v40;
          ++v41;
        }
        v67 = *(_DWORD *)(a1 + 0x19E) - (unsigned __int16)word_968E8[a1[0x19D]];
        break;
      case 9:
        v42 = 0;
        v43 = 0;
        while ( v42 < V_Game.planetsNum )
        {
          if ( V_Game.planets[v43].raceIndex == *a1 )
          {
            V_Game.planets[v43].word55 += 2;
            sub_34E70(&V_Game.planets[v43]);
          }
          ++v42;
          ++v43;
        }
        break;
      case 0xB:
        v44 = 0;
        v45 = 0;
        while ( v44 < V_Game.starsNum )
        {
          if ( ((1 << *a1) & V_Game.stars[v45].racesBits) != 0 )
          {
            v46 = &V_Game.stars[v45];
            v47 = 0;
            if ( v46->Unknown_44 > 0 )
            {
              do
              {
                v48 = *(_DWORD *)v46->Unknown_2C;
                v46 = (T_Star *)((char *)v46 + 4);
                ++v47;
                *(_BYTE *)(v48 + 0x23) |= 2u;
              }
              while ( v47 < V_Game.stars[v45].Unknown_44 );
            }
          }
          ++v44;
          ++v45;
        }
        break;
      case 0xC:
        v65 = a1;
        v49 = 0;
        v50 = 0;
        while ( v49 < V_Game.racesNum )
        {
          if ( v49 != (unsigned __int8)*a1 && v65[0x1C0] == 2 )
          {
            races = V_Game.races;
            v52 = 0;
            v53 = (char *)V_Game.races + 2 * v50;
            while ( v52 < V_Game.racesNum )
            {
              if ( v52 != v49 && v52 != (unsigned __int8)*a1 && *((_WORD *)v53 + 0xD9) > races->Unknown_1C7[1] )
              {
                *((_WORD *)v53 + 0xD9) = races->Unknown_1C7[1];
              }
              ++v52;
              v53 += 0x1EE;
              ++races;
            }
          }
          ++v49;
          ++v65;
          ++v50;
        }
        break;
      case 0xE:
        LOBYTE(v4) = *a1;
        v54 = v4;
        v55 = (unsigned __int16)V_ResTree.a.w1[v54];
        if ( (unsigned __int16)v55 != 0xFFFF )
        {
          word_106FB4[v54] = V_ResTree.items[v55].cost;
        }
        break;
      case 0xF:
        v56 = 0;
        v57 = 0;
        while ( v56 < V_Game.planetsNum )
        {
          if ( V_Game.planets[v57].raceIndex == *a1 && V_Game.planets[v57].buildingPlanetItemIndex != 0xFF )
          {
            V_Game.planets[v57].buildingProgress += 0x64;
          }
          ++v56;
          ++v57;
        }
        break;
      default:
        break;
    }
    *(_DWORD *)(a1 + 0x19E) = v67;
  }
  return v66;
}
// 968E8: using guessed type __int16 word_968E8[21];
// 106FB4: using guessed type __int16 word_106FB4[7];
// 434E4: using guessed type int var_3A0[107];
// 434E4: using guessed type int var_6F8[107];

//----- (00043B7C) --------------------------------------------------------
int __fastcall sub_43B7C(P_Race pRace, __int16 a2)
{
  int v2; // ebx
  int v3; // edx

  v2 = pRace->Unknown_1C7[5] - pRace->Unknown_1B2[a2];
  if ( v2 <= 0 )
  {
    v3 = 100;
  }
  else
  {
    v3 = 100 * v2 / (pRace->Unknown_1C7[5] - pRace->Unknown_1C7[1]);
  }
  if ( v3 > 100 )
  {
    return 100;
  }
  return v3;
}

//----- (00043BDC) --------------------------------------------------------
void __fastcall Q_ReadWriteRace_sub_43BDC(P_Race pRace, P_FileInfo fi, int read)
{
  int star; // eax
  T_Race vRace; // [esp+0h] [ebp-1F4h] BYREF
  T_FileInfo *v6; // [esp+1F0h] [ebp-4h]

  v6 = fi;
  Q_RaceCtor_sub_3B120(&vRace);
  if ( read == TRUE )
  {
    Q_ReadFile_sub_1BF94(v6, &vRace, 0x1EEu);
    qmemcpy(pRace, &vRace, 0x1ECu);
    HIWORD(pRace->Unknown_1EA) = HIWORD(vRace.Unknown_1EA);
    star = (int)pRace->star;
    pRace->Unknown_19B = 0;
    pRace->star = &V_Game.stars[star];
  }
  else
  {
    qmemcpy(&vRace, pRace, sizeof(vRace));
    vRace.star = (P_Star)vRace.star->index;
    Q_CFILE_CPP_dos_write_sub_1C098(&v6->fh, &vRace, 0x1EEu);
  }
}

//----- (00043C80) --------------------------------------------------------
int __fastcall Q_RACENEG_CPP_sub_43C80(P_Race a1)
{
  FILE *v2; // ecx
  __int16 v3; // ax
  WORD v4; // dx
  __int16 v5; // ax
  WORD v6; // bx
  __int16 v7; // ax
  WORD v8; // di
  __int16 v9; // ax
  WORD v10; // dx
  __int16 v11; // ax
  WORD v12; // bx
  int Unknown_01; // [esp-4h] [ebp-11Ch]
  char v15[204]; // [esp+0h] [ebp-118h] BYREF
  char s[52]; // [esp+CCh] [ebp-4Ch] BYREF
  int v17; // [esp+100h] [ebp-18h] BYREF

  Unknown_01 = a1->Unknown_01;
  V_Day1 = 0xFFFFFFF6;
  V_Day2 = 0xFFFFFFF6;
  V_Day3 = 0xFFFFFFF6;
  sprintf(s, "RACE%02d.DIP", Unknown_01);
  v2 = Q_OpenFile_sub_1BB10(s, 0);
  if ( !v2 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\raceneg.cpp", 0x55);
  }
  v15[0] = 0;
  while ( strncmp(v15, "DIPVALUES", 9u) )
  {
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, v15);
  }
  fscanf(v2, "%s %d", v15, &v17);
  a1->Unknown_1C7[1] = v17;
  fscanf(v2, "%s %d", v15, &v17);
  v3 = v17;
  v4 = a1->Unknown_1C7[1];
  a1->Unknown_1C7[2] = v17;
  if ( v3 <= v4 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x64);
  }
  fscanf(v2, "%s %d", v15, &v17);
  v5 = v17;
  v6 = a1->Unknown_1C7[2];
  a1->Unknown_1C7[3] = v17;
  if ( v5 <= v6 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x68);
  }
  fscanf(v2, "%s %d", v15, &v17);
  v7 = v17;
  v8 = a1->Unknown_1C7[3];
  a1->Unknown_1C7[4] = v17;
  if ( v7 <= v8 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x6C);
  }
  fscanf(v2, "%s %d", v15, &v17);
  v9 = v17;
  v10 = a1->Unknown_1C7[4];
  a1->Unknown_1C7[5] = v17;
  if ( v9 <= v10 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x70);
  }
  fscanf(v2, "%s %d", v15, &v17);
  v11 = v17;
  v12 = a1->Unknown_1C7[5];
  a1->Unknown_1C7[6] = v17;
  if ( v11 <= v12 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x74);
  }
  fscanf(v2, "%s %d", v15, &v17);
  a1->Unknown_1D5 = v17;
  fscanf(v2, "%s %d", v15, &v17);
  a1->Unknown_1B0 = v17;
  fscanf(v2, "%s %d", v15, &v17);
  *(_WORD *)a1->z5 = v17;
  fscanf(v2, "%s %d", v15, &v17);
  a1->Unknown_1D9 = v17;
  fscanf(v2, "%s %d", v15, &v17);
  a1->Unknown_1DB = v17;
  fscanf(v2, "%s %d", v15, &v17);
  *(float *)a1->Unknown_1DD = (float)(__int16)v17;
  fscanf(v2, "%s %d", v15, &v17);
  *(float *)&a1->Unknown_1DD[2] = (float)(__int16)v17;
  fscanf(v2, "%s %d", v15, &v17);
  *(float *)&a1->Unknown_1DD[4] = (float)(__int16)v17;
  fscanf(v2, "%s %d", v15, &v17);
  a1->Unknown_1C7[0] = v17;
  a1->ability = a1->Unknown_01;
  *(_DWORD *)a1->z2 = 0;
  return fclose(v2);
}
// 105248: using guessed type int V_Day1;
// 10524C: using guessed type int V_Day2;
// 105250: using guessed type int V_Day3;

//----- (00044024) --------------------------------------------------------
unsigned int __fastcall sub_44024(_BYTE *a1, char a2)
{
  int v3; // eax
  int v4; // kr04_4
  int Unknown_17; // ebx
  int v7; // [esp+0h] [ebp-18h]

  v3 = 0;
  v7 = 0;
  v4 = 0;
  while ( v3 < V_Game.starsNum )
  {
    Unknown_17 = (unsigned __int8)V_Game.stars[v4].Unknown_17;
    if ( ((1 << *a1) & Unknown_17) != 0 && ((1 << a2) & Unknown_17) != 0 )
    {
      return 0xFFFFFFFF;
    }
    ++v3;
    ++v4;
  }
  return v7;
}

//----- (00044080) --------------------------------------------------------
T_Race *__fastcall sub_44080(unsigned __int8 *a1)
{
  unsigned __int8 *v2; // ebp
  int v3; // edi
  int v4; // kr04_4
  int v5; // kr0C_4
  char v6; // al
  T_Race *result; // eax
  unsigned __int8 v8; // al
  void *v9; // ecx
  void *v10; // ebx
  char v11; // [esp+0h] [ebp-2Ch]
  int v12; // [esp+4h] [ebp-28h] BYREF
  int v13; // [esp+8h] [ebp-24h] BYREF
  T_Race *races; // [esp+Ch] [ebp-20h]
  unsigned __int8 *v15; // [esp+10h] [ebp-1Ch]

  if ( *a1 == V_RaceIndex && V_FlashPopExists != 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0xCD);
  }
  v15 = a1;
  v2 = a1;
  a1[0x1E9] = 0xE;
  v3 = 0;
  races = V_Game.races;
  v4 = 0;
  v5 = 0;
  do
  {
    if ( v3 != *a1 && V_Game.races[v3].Unknown_03 != 0xFFFFFFFF )
    {
      if ( (v3 != V_RaceIndex || V_FlashPopExists == 0xFFFFFFFF) && !v2[0x1C0] && sub_44024(a1, v3) == 0xFFFFFFFF )
      {
        *((_WORD *)v15 + 0xD9) = *(_WORD *)(a1 + 0x1D5);
        V_Game.races[v3].Unknown_1B2[*a1] = V_Game.races[v3].Unknown_1D5;
        V_Game.races[v3].Unknown_1C0[*a1] = 1;
        v2[0x1C0] = 1;
      }
      if ( v2[0x1C0] )
      {
        v8 = sub_44434(a1, v3, &v12);
        if ( v8 != 0xE )
        {
          if ( v3 != V_RaceIndex || V_FlashPopExists )
          {
            v11 = v8;
            v6 = sub_44BCC((int)races, (__int16 *)*a1, v8, v12, &v13);
            sub_450B0(a1, v3, v11, v6, v12, v13);
          }
          else
          {
            a1[0x1E9] = v8;
            v9 = (void *)(char)a1[0x1E9];
            v10 = (void *)*a1;
            *(_DWORD *)(a1 + 0x1EA) = v12;
            Q_AddGameEvent_sub_55AEC(&WinMgr, ASCEND_EP_02_WOULD_LIKE_TO_SPEAK, v10, v9);
          }
        }
      }
    }
    ++v2;
    ++v3;
    result = races + 1;
    ++v4;
    ++v5;
  }
  while ( v3 < 7 );
  return result;
}

//----- (00044238) --------------------------------------------------------
int __fastcall sub_44238(int a1, __int16 a2, _BYTE *a3, __int16 a4)
{
  T_Race *v7; // edi
  int v8; // ecx
  char v9; // kr00_1
  _BYTE *v10; // eax
  int result; // eax
  int v12; // eax
  int v13; // eax
  int v14; // ecx
  int v15; // eax
  int v16; // eax
  int v17; // eax
  int v18; // eax
  int v19; // ecx
  int v20; // eax
  _BYTE *v21; // [esp+4h] [ebp-10h]

  *a3 = 0xE;
  v7 = &V_Game.races[a2];
  v8 = 1;
  v9 = *(_BYTE *)(a1 + a2 + 0x1C0);
  v21 = a3 + 2;
  v10 = a3 + 1;
  switch ( v9 )
  {
    case 0:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\raceneg.cpp", 0x126);
      result = 1;
      break;
    case 1:
      *v10 = 2;
      *v21 = 3;
      v8 = 3;
      if ( V_Game.day - V_Day1 >= 5 )
      {
        v8 = 4;
        a3[3] = 4;
      }
      if ( V_Game.day - V_Day2 >= 5 )
      {
        v12 = (__int16)v8++;
        a3[v12] = 5;
      }
      if ( V_Game.day - V_Day3 >= 5 )
      {
        v13 = (__int16)v8++;
        a3[v13] = 6;
      }
      if ( !*(_BYTE *)(a1 + a4 + 0x1C0) || v7->Unknown_1C0[a4] != 2 )
      {
        goto LABEL_29;
      }
      a3[(__int16)v8] = 7;
      result = v8 + 1;
      break;
    case 2:
      *v10 = 0xD;
      result = 2;
      break;
    case 3:
      *v10 = 8;
      v14 = 2;
      if ( V_Game.day - V_Day1 >= 5 )
      {
        v14 = 3;
        *v21 = 4;
      }
      if ( V_Game.day - V_Day2 >= 5 )
      {
        v15 = (__int16)v14++;
        a3[v15] = 5;
      }
      if ( V_Game.day - V_Day3 >= 5 )
      {
        v16 = (__int16)v14++;
        a3[v16] = 6;
      }
      a3[(__int16)v14] = 0xC;
      v8 = v14 + 1;
      if ( *(_BYTE *)(a1 + a4 + 0x1C0) && v7->Unknown_1C0[a4] == 2 )
      {
        v17 = (__int16)v8++;
        a3[v17] = 7;
      }
      if ( *(_BYTE *)(a1 + a4 + 0x1C0) && v7->Unknown_1C0[a4] == 1 )
      {
        v18 = (__int16)v8;
        v19 = v8 + 1;
        a3[v18] = 9;
        v20 = (__int16)v19;
        v8 = v19 + 1;
        a3[v20] = 0xB;
      }
      if ( !*(_BYTE *)(a1 + a4 + 0x1C0) || v7->Unknown_1C0[a4] != 3 )
      {
        goto LABEL_29;
      }
      a3[(__int16)v8] = 0xA;
      result = v8 + 1;
      break;
    default:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\raceneg.cpp", 0x17E);
LABEL_29:
      result = v8;
      break;
  }
  return result;
}
// 105248: using guessed type int V_Day1;
// 10524C: using guessed type int V_Day2;
// 105250: using guessed type int V_Day3;

//----- (00044434) --------------------------------------------------------
char __fastcall sub_44434(unsigned __int8 *a1, __int16 a2, _DWORD *a3)
{
  char v5; // bh
  unsigned __int8 v6; // bl
  __int16 v8; // dx
  __int16 v9; // ax
  __int16 v10; // dx
  int v11; // [esp+0h] [ebp-18h]

  if ( *a1 == V_RaceIndex && V_FlashPopExists != 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x18D);
  }
  v5 = sub_43374((P_Race)a1, 0xFFFFFFFF);
  v6 = a1[a2 + 0x1C0];
  if ( v6 < 2u )
  {
    if ( v6 == 1 )
    {
      if ( V_Game.Unknown_D8A[0x2A] )
      {
        if ( V_Game.Unknown_D8A[0x2A] <= 1u )
        {
          if ( *(_WORD *)&a1[2 * a2 + 0x1B2] < *(_WORD *)(a1 + 0x1C9) && a2 == V_RaceIndex )
          {
            return 2;
          }
        }
        else if ( V_Game.Unknown_D8A[0x2A] == 2 )
        {
          if ( *(_WORD *)&a1[2 * a2 + 0x1B2] < *(_WORD *)(a1 + 0x1CB) && a2 == V_RaceIndex )
          {
            *(_WORD *)&a1[2 * a2 + 0x1B2] = *(_WORD *)(a1 + 0x1C9) - 1;
            return 2;
          }
          if ( *(_WORD *)(a1 + 0x1CD) > *(_WORD *)&a1[2 * a2 + 0x1B2] && a2 == V_RaceIndex )
          {
            *(_WORD *)&a1[2 * a2 + 0x1B2] = *(_WORD *)(a1 + 0x1CB) - 1;
          }
          else if ( *(_WORD *)(a1 + 0x1CF) > *(_WORD *)&a1[2 * a2 + 0x1B2] && a2 == V_RaceIndex )
          {
            *(_WORD *)&a1[2 * a2 + 0x1B2] = *(_WORD *)(a1 + 0x1CD) - 1;
          }
          else if ( *(_WORD *)(a1 + 0x1D1) > *(_WORD *)&a1[2 * a2 + 0x1B2] && a2 == V_RaceIndex )
          {
            *(_WORD *)&a1[2 * a2 + 0x1B2] = *(_WORD *)(a1 + 0x1CF) - 1;
          }
          else if ( *(_WORD *)(a1 + 0x1D3) > *(_WORD *)&a1[2 * a2 + 0x1B2] && a2 == V_RaceIndex )
          {
            *(_WORD *)&a1[2 * a2 + 0x1B2] = *(_WORD *)(a1 + 0x1D1) - 1;
          }
          else if ( a2 == V_RaceIndex )
          {
            *(_WORD *)&a1[2 * a2 + 0x1B2] = *(_WORD *)(a1 + 0x1D3) - 1;
          }
        }
      }
      else if ( *(_WORD *)&a1[2 * a2 + 0x1B2] < *(_WORD *)(a1 + 0x1C9)
             && (!v5 || a2 == V_RaceIndex)
             && (a2 == V_RaceIndex || *(__int16 *)&V_Game.Unknown_D8A[6 * *a1 + 4] > 2) )
      {
        return 2;
      }
      if ( *(_WORD *)(a1 + 0x1D3) < *(_WORD *)&a1[2 * a2 + 0x1B2] )
      {
        return 3;
      }
    }
  }
  else if ( v6 <= 2u )
  {
    if ( *(_WORD *)&a1[2 * a2 + 0x1B2] > *(_WORD *)(a1 + 0x1CD) )
    {
      return 0xD;
    }
  }
  else
  {
    if ( v6 != 3 )
    {
      goto LABEL_51;
    }
    if ( *(_WORD *)&a1[2 * a2 + 0x1B2] < *(_WORD *)(a1 + 0x1C9) && !v5 )
    {
      if ( a2 == V_RaceIndex || *(__int16 *)&V_Game.Unknown_D8A[6 * *a1 + 4] > 2 )
      {
        return 2;
      }
      return 8;
    }
    if ( *(_WORD *)(a1 + 0x1CF) > *(_WORD *)&a1[2 * a2 + 0x1B2] )
    {
      return 8;
    }
  }
LABEL_51:
  if ( V_Game.day % *(__int16 *)(a1 + 0x1C7) || a2 != V_RaceIndex || a1[a2 + 0x1C0] == 2 )
  {
    return 0xE;
  }
  v11 = rand() % 0x64;
  if ( a2 != V_RaceIndex )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x212);
  }
  if ( a1[a2 + 0x1C0] != 3 || v11 >= 0x50 )
  {
LABEL_85:
    if ( *(_WORD *)(a1 + 0x1C9) <= *(_WORD *)&a1[2 * a2 + 0x1B2] )
    {
      if ( a1[a2 + 0x1C0] == 3 )
      {
        v11 += 0xF;
      }
      if ( *(__int16 *)&a1[2 * a2 + 0x1B2] > *(__int16 *)(a1 + 0x1CF) + 0xA && v11 >= 0x5D && sub_46208(a1, a2) )
      {
        return 6;
      }
      if ( *(_WORD *)(a1 + 0x1CF) < *(_WORD *)&a1[2 * a2 + 0x1B2] && v11 >= 0x58 && sub_46034(a1, a2) )
      {
        return 5;
      }
      if ( *(__int16 *)&a1[2 * a2 + 0x1B2] > *(__int16 *)(a1 + 0x1D5) + 0x14 && v11 >= 0x50 && sub_45E64(a1, a2) )
      {
        return 4;
      }
    }
    return 0xE;
  }
  v8 = 0;
  if ( V_Game.racesNum > 0 )
  {
    while ( v8 == *a1
         || v8 == a2
         || V_Game.races[v8].Unknown_03 == 0xFFFFFFFF
         || a1[v8 + 0x1C0] != 2
         || V_Game.races[V_RaceIndex].Unknown_1C0[v8] != 3 )
    {
      if ( ++v8 >= V_Game.racesNum )
      {
        goto LABEL_67;
      }
    }
    *a3 = v8;
    return 0xA;
  }
  else
  {
LABEL_67:
    v9 = 0;
    if ( V_Game.racesNum > 0 )
    {
      while ( v9 == *a1
           || v9 == a2
           || V_Game.races[v9].Unknown_03 == 0xFFFFFFFF
           || a1[v9 + 0x1C0] != 3
           || V_Game.races[V_RaceIndex].Unknown_1C0[v9] != 2 )
      {
        if ( ++v9 >= V_Game.racesNum )
        {
          goto LABEL_76;
        }
      }
      *a3 = v9;
      return 7;
    }
    else
    {
LABEL_76:
      v10 = 0;
      if ( V_Game.racesNum <= 0 )
      {
        goto LABEL_85;
      }
      while ( v10 == *a1
           || v10 == a2
           || V_Game.races[v10].Unknown_03 == 0xFFFFFFFF
           || a1[v10 + 0x1C0] != 2
           || V_Game.races[V_RaceIndex].Unknown_1C0[v10] != 1 )
      {
        if ( ++v10 >= V_Game.racesNum )
        {
          goto LABEL_85;
        }
      }
      *a3 = v10;
      return 9;
    }
  }
}

//----- (00044A2C) --------------------------------------------------------
int __fastcall sub_44A2C(_BYTE *a1, int a2, char a3, _BYTE *a4)
{
  _BYTE *v4; // eax
  int result; // eax

  if ( *a1 != V_RaceIndex )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x263);
  }
  v4 = a4 + 1;
  switch ( a3 )
  {
    case 0:
      *a4 = 0;
      result = 1;
      break;
    case 1:
      *a4 = 1;
      *v4 = 2;
      result = 2;
      break;
    case 2:
      *a4 = 3;
      result = 1;
      break;
    case 3:
      *a4 = 4;
      *v4 = 5;
      result = 2;
      break;
    case 4:
      *a4 = 6;
      *v4 = 7;
      result = 2;
      break;
    case 5:
      *a4 = 8;
      *v4 = 9;
      result = 2;
      break;
    case 6:
      *a4 = 0xA;
      *v4 = 0xB;
      result = 2;
      break;
    case 7:
      *a4 = 0xC;
      *v4 = 0xD;
      result = 2;
      break;
    case 8:
      *a4 = 0xE;
      result = 1;
      break;
    case 9:
      *a4 = 0xF;
      *v4 = 0x10;
      result = 2;
      break;
    case 0xA:
      *a4 = 0x11;
      *v4 = 0x12;
      result = 2;
      break;
    case 0xB:
      *a4 = 0x13;
      *v4 = 0x14;
      result = 2;
      break;
    case 0xC:
      *a4 = 0x15;
      *v4 = 0x16;
      result = 2;
      break;
    case 0xD:
      *a4 = 0x1B;
      *v4 = 0x1C;
      result = 2;
      break;
    case 0xE:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\raceneg.cpp", 0x2CF);
      result = 0xE;
      break;
    default:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\raceneg.cpp", 0x2D4);
      JUMPOUT(0x44B91);
  }
  return result;
}
// 44B8C: control flows out of bounds to 44B91

//----- (00044BCC) --------------------------------------------------------
char __fastcall sub_44BCC(int a1, __int16 *a2, char a3, int a4, int *a5)
{
  __int16 v7; // di
  int v8; // ebx
  const char *v9; // edx
  int v10; // [esp+0h] [ebp-1B8h] BYREF

  *(_DWORD *)(a1 + 0x1EA) = a4;
  switch ( a3 )
  {
    case 2:
      return 3;
    case 3:
      if ( *(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) <= *(_WORD *)(a1 + 0x1D1) )
      {
        return 5;
      }
      else
      {
        return 4;
      }
    case 4:
      if ( *(__int16 *)(a1 + 2 * (__int16)a2 + 0x1B2) > *(__int16 *)(a1 + 0x1D5) + 0x14 && sub_45E64((_BYTE *)a1, (__int16)a2) )
      {
        return 6;
      }
      else
      {
        return 7;
      }
    case 5:
      if ( *(_WORD *)(a1 + 0x1CF) < *(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) && sub_46034((_BYTE *)a1, (__int16)a2) )
      {
        return 8;
      }
      else
      {
        return 9;
      }
    case 6:
      if ( *(__int16 *)(a1 + 2 * (__int16)a2 + 0x1B2) > *(__int16 *)(a1 + 0x1CF) + 0xA && sub_46208((_BYTE *)a1, (__int16)a2) )
      {
        return 0xA;
      }
      else
      {
        return 0xB;
      }
    case 7:
      if ( *(_BYTE *)(a4 + a1 + 0x1C0) != 2 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x336);
      }
      if ( *(__int16 *)(a1 + 2 * a4 + 0x1B2)
         + (__int16)(*(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) - V_Game.races[(__int16)a2].Unknown_1C7[5]) <= *(__int16 *)(a1 + 0x1CD) )
      {
        return 0xD;
      }
      else
      {
        return 0xC;
      }
    case 8:
      return 0xE;
    case 9:
      if ( *(_BYTE *)(a1 + (__int16)a2 + 0x1C0) != 3 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x34A);
      }
      if ( *(_BYTE *)(a1 + a4 + 0x1C0) != 1 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x34B);
      }
      if ( (__int16)(*(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) - *(_WORD *)(a1 + 2 * a4 + 0x1B2)) <= *(__int16 *)(a1 + 0x1D5) )
      {
        return 0x10;
      }
      else
      {
        return 0xF;
      }
    case 0xA:
      if ( *(_BYTE *)(a1 + (__int16)a2 + 0x1C0) != 3 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x361);
      }
      if ( *(_BYTE *)(a1 + a4 + 0x1C0) != 3 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x362);
      }
      v7 = *(_WORD *)(2 * a4 + a1 + 0x1B2);
      if ( (__int16)(*(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) - v7) <= 0
        || (__int16)(*(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) - V_Game.races[(__int16)a2].Unknown_1C7[5])
         - (__int16)(v7 - V_Game.races[a4].Unknown_1C7[5]) <= 0 )
      {
        return 0x12;
      }
      else
      {
        return 0x11;
      }
    case 0xB:
      if ( *(_BYTE *)(a1 + (__int16)a2 + 0x1C0) != 3 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x384);
      }
      if ( *(_BYTE *)(a1 + a4 + 0x1C0) != 1 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x385);
      }
      if ( *(__int16 *)(a1 + 2 * a4 + 0x1B2)
         - (__int16)(*(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) - V_Game.races[(__int16)a2].Unknown_1C7[5]) >= *(__int16 *)(a1 + 0x1C9) )
      {
        return 0x14;
      }
      else
      {
        return 0x13;
      }
    case 0xC:
      if ( !a4 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x39D);
      }
      if ( a5 )
      {
        *a5 = a4;
      }
      if ( !sub_45958((unsigned __int8 *)a1, 2, (__int16 *)a4, 0) )
      {
        return 0x18;
      }
      if ( (unsigned __int16)sub_45848((unsigned __int8 *)a1, a4, (int)&v10, a2) )
      {
        if ( ((1 << *(_BYTE *)a1) & *(unsigned __int8 *)(a4 + 0x15)) != 0 )
        {
          return 0x1A;
        }
        else if ( *(_WORD *)(a1 + 0x1D3) >= *(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) )
        {
          return 0x16;
        }
        else
        {
          return 0x15;
        }
      }
      else if ( ((1 << *(_BYTE *)a1) & *(unsigned __int8 *)(a4 + 0x15)) != 0 )
      {
        return 0x19;
      }
      else
      {
        return 0x17;
      }
    case 0xD:
      if ( *(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) < *(_WORD *)(a1 + 0x1CB) )
      {
        return 0x1C;
      }
      else
      {
        return 0x1B;
      }
    case 0xE:
      v8 = 0x3CE;
      v9 = "..\\raceneg.cpp";
      break;
    default:
      v8 = 0x3D3;
      v9 = "..\\raceneg.cpp";
      break;
  }
  Q_AssertLogBreakExit_sub_261A8(0, v9, v8);
  JUMPOUT(0x45065);
}
// 45060: control flows out of bounds to 45065

//----- (000450B0) --------------------------------------------------------
void __fastcall sub_450B0(unsigned __int8 *a1, __int16 a2, char a3, char a4, int a5, int a6)
{
  unsigned __int8 *v6; // esi
  T_Race *v7; // edi
  char *v8; // edx
  int v9; // eax
  int v10; // edx
  int v11; // eax
  int v12; // edx
  int v13; // eax
  int v14; // edx
  UBYTE *v15; // edi
  int v16; // eax
  int v17; // eax
  int v18; // edx
  __int16 v19; // cx
  int v20; // edx
  int v21; // edx
  __int16 v22; // ax
  _BYTE v23[428]; // [esp+0h] [ebp-1D4h] BYREF
  int v24; // [esp+1ACh] [ebp-28h]
  unsigned int v25; // [esp+1B0h] [ebp-24h]
  int v26; // [esp+1B4h] [ebp-20h]
  int v27; // [esp+1B8h] [ebp-1Ch]
  int v28; // [esp+1BCh] [ebp-18h]
  T_Race *v29; // [esp+1C0h] [ebp-14h]
  __int16 v30; // [esp+1C4h] [ebp-10h]

  v6 = a1;
  v30 = a2;
  v27 = a2;
  v7 = &V_Game.races[a2];
  v26 = (int)v7 + a5;
  v25 = 0x1EE * a5;
  v29 = &V_Game.races[a5];
  v28 = (int)v29 + a2;
  v8 = (char *)v29 + 2 * a2;
  switch ( a3 )
  {
    case 0:
      v9 = *a1;
      v10 = v30;
      v7->Unknown_1C0[v9] = 1;
      v6[v10 + 0x1C0] = v7->Unknown_1C0[v9];
      *(_WORD *)&v6[2 * v30 + 0x1B2] = *(_WORD *)(v6 + 0x1D5);
      v7->Unknown_1B2[*v6] = v7->Unknown_1D5;
      return;
    case 1:
      if ( a4 == 1 )
      {
        *(_WORD *)&a1[2 * v30 + 0x1B2] += 0x28;
      }
      return;
    case 2:
      v11 = *a1;
      v12 = v30;
      v7->Unknown_1C0[v11] = 2;
      v6[v12 + 0x1C0] = v7->Unknown_1C0[v11];
      v7->Unknown_1B2[*v6] -= 0x28;
      return;
    case 3:
      if ( V_RaceIndex == *a1 )
      {
        v7->Unknown_1B2[V_RaceIndex] += 3;
      }
      if ( a4 == 4 )
      {
        v13 = *a1;
        v14 = v30;
        v7->Unknown_1C0[v13] = 3;
        v6[v14 + 0x1C0] = v7->Unknown_1C0[v13];
        *(_WORD *)&v6[2 * v14 + 0x1B2] += 0xA;
        v7->Unknown_1B2[*v6] += 0xA;
      }
      else
      {
        *(_WORD *)&a1[2 * v30 + 0x1B2] = *(_WORD *)(a1 + 0x1D1);
      }
      return;
    case 4:
      if ( V_RaceIndex == *a1 )
      {
        v7->Unknown_1B2[V_RaceIndex] += 5;
        V_Day1 = V_Game.day;
      }
      if ( a4 == 6 )
      {
        sub_45F60(a1, v30, 0);
        *(_WORD *)&v6[2 * v30 + 0x1B2] += 0xA;
        v7->Unknown_1B2[*v6] += 5;
      }
      else
      {
        v18 = v30;
        v19 = *(_WORD *)&a1[2 * v30 + 0x1B2] - 2;
        *(_WORD *)&a1[2 * v30 + 0x1B2] = v19;
        if ( a1[v18 + 0x1C0] == 3 )
        {
          *(_WORD *)&a1[2 * v30 + 0x1B2] = v19 - 2;
        }
      }
      return;
    case 5:
      if ( V_RaceIndex == *a1 )
      {
        v7->Unknown_1B2[V_RaceIndex] += 8;
        V_Day2 = V_Game.day;
      }
      if ( a4 == 8 )
      {
        sub_46130(a1, v30, 0);
        *(_WORD *)&v6[2 * v30 + 0x1B2] += 0xA;
        v7->Unknown_1B2[*v6] += 5;
      }
      else
      {
        v20 = v30;
        *(_WORD *)&a1[2 * v30 + 0x1B2] -= 3;
        if ( a1[v20 + 0x1C0] == 3 )
        {
          *(_WORD *)&a1[2 * v30 + 0x1B2] -= 3;
        }
      }
      return;
    case 6:
      if ( V_RaceIndex == *a1 )
      {
        v7->Unknown_1B2[V_RaceIndex] += 8;
        V_Day3 = V_Game.day;
      }
      if ( a4 == 0xA )
      {
        sub_46304(a1, v30, 0);
        *(_WORD *)&v6[2 * v30 + 0x1B2] += 0xA;
        v7->Unknown_1B2[*v6] += 0xA;
      }
      else
      {
        v21 = v30;
        *(_WORD *)&a1[2 * v30 + 0x1B2] -= 2;
        if ( a1[v21 + 0x1C0] == 3 )
        {
          *(_WORD *)&a1[2 * v30 + 0x1B2] -= 2;
        }
      }
      return;
    case 7:
      if ( a4 != 0xC )
      {
        goto LABEL_54;
      }
      *(_WORD *)&a1[2 * v27 + 0x1B2] += 5;
      if ( *((__int16 *)v8 + 0xD9) > V_Game.races[v25 / 0x1EE].Unknown_1C7[2] - 0xA )
      {
        *(_WORD *)&a1[2 * v27 + 0x1B2] += 5;
        *(_BYTE *)(v26 + 0x1C0) = 1;
        *(_BYTE *)(v28 + 0x1C0) = 1;
        v7->Unknown_1B2[a5] += 0xA;
        v7->Unknown_1B2[*a1] += 5;
        *((_WORD *)v8 + 0xD9) += 0xA;
        v29->Unknown_1B2[*a1] += 0xF;
      }
      return;
    case 8:
      v17 = *a1;
      v7->Unknown_1C0[v17] = 1;
      v6[v27 + 0x1C0] = v7->Unknown_1C0[v17];
      v7->Unknown_1B2[*v6] -= 0x1E;
      return;
    case 9:
      if ( a4 == 0xF )
      {
        *(_WORD *)&a1[2 * v27 + 0x1B2] += 0xA;
        *(_BYTE *)(v26 + 0x1C0) = 2;
        *(_BYTE *)(v28 + 0x1C0) = 2;
        v7->Unknown_1B2[a5] -= 0xF;
        v7->Unknown_1B2[*a1] += 0xA;
        *((_WORD *)v8 + 0xD9) -= 0x14;
        a1 = &v29->index + 2 * *a1;
      }
      goto LABEL_38;
    case 0xA:
      if ( a4 == 0x11 )
      {
        *(_WORD *)&a1[2 * v27 + 0x1B2] += 0xF;
        *(_BYTE *)(v26 + 0x1C0) = 1;
        *(_BYTE *)(v28 + 0x1C0) = 1;
        v7->Unknown_1B2[a5] -= 5;
        v7->Unknown_1B2[*a1] -= 5;
        *((_WORD *)v8 + 0xD9) -= 0xA;
        a1 = &v29->index + 2 * *a1;
LABEL_41:
        *(_WORD *)&a1[2 * v27 + 0x1B2] -= 5;
      }
      else
      {
LABEL_38:
        *(_WORD *)&a1[2 * v27 + 0x1B2] -= 0xA;
      }
      break;
    case 0xB:
      if ( a4 != 0x13 )
      {
        goto LABEL_41;
      }
      *(_WORD *)&a1[2 * v27 + 0x1B2] += 5;
      v24 = V_Game.races[v25 / 0x1EE].Unknown_1C7[5];
      if ( *((__int16 *)v8 + 0xD9) > v24 - 0xA )
      {
        *(_WORD *)&a1[2 * v27 + 0x1B2] += 5;
        *(_BYTE *)(v26 + 0x1C0) = 3;
        *(_BYTE *)(v28 + 0x1C0) = 3;
        v7->Unknown_1B2[a5] += 0xA;
        v7->Unknown_1B2[*a1] += 5;
        *((_WORD *)v8 + 0xD9) += 0xF;
        v29->Unknown_1B2[*a1] += 0xA;
      }
      break;
    case 0xC:
      if ( a4 == 0x15 || a4 == 0x1A )
      {
        if ( v30 != V_RaceIndex )
        {
          if ( !a5 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x4FA);
          }
          v22 = sub_45848(&v7->index, a5, (int)v23, (__int16 *)v7);
          if ( !v22 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x4FD);
          }
          sub_45A0C(v7, a5, (int)v23, v22);
          *(_WORD *)&v6[2 * v30 + 0x1B2] += 0xA;
        }
      }
      else if ( a4 == 0x16 )
      {
LABEL_54:
        *(_WORD *)&a1[2 * v27 + 0x1B2] -= 5;
      }
      return;
    case 0xD:
      if ( *a1 == V_RaceIndex )
      {
        v7->Unknown_1B2[V_RaceIndex] += 3;
      }
      if ( a4 == 0x1B )
      {
        v15 = &v7->index + *a1;
        v16 = v30;
        v15[0x1C0] = 1;
        v6[v16 + 0x1C0] = v15[0x1C0];
      }
      else
      {
        *(_WORD *)&a1[2 * v30 + 0x1B2] -= 0x19;
      }
      return;
    case 0xE:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\raceneg.cpp", 0x515);
      return;
    default:
      return;
  }
}
// 105248: using guessed type int V_Day1;
// 10524C: using guessed type int V_Day2;
// 105250: using guessed type int V_Day3;

//----- (00045848) --------------------------------------------------------
int __usercall sub_45848@<eax>(unsigned __int8 *a1@<eax>, int a2@<edx>, int a3@<ebx>, __int16 *a4@<edi>)
{
  __int16 v5; // si
  int v6; // eax
  int v7; // ebx
  int v8; // ebx
  char v9; // al
  int v10; // ebx
  int v12[107]; // [esp+0h] [ebp-1CCh] BYREF
  int v13; // [esp+1ACh] [ebp-20h]
  int v14; // [esp+1B0h] [ebp-1Ch]
  int v15; // [esp+1B4h] [ebp-18h]
  int ShipsNum_sub_40224; // [esp+1B8h] [ebp-14h]

  v13 = a2;
  v14 = a3;
  LOWORD(v15) = 0;
  v5 = 0;
  ShipsNum_sub_40224 = Q_Race_GetShipsNum_sub_40224((P_Race)a1, (P_Ship *)v12, 0);
  if ( (__int16)ShipsNum_sub_40224 > 0 )
  {
    do
    {
      v8 = v12[v5];
      v9 = *(_BYTE *)(v8 + 0x58);
      v10 = *(_DWORD *)(v8 + 0x59);
      if ( v9 != 1 && v9 != 2 )
      {
        if ( v9 == 3 )
        {
          a4 = (__int16 *)&V_Game.stars[*(__int16 *)(v10 + 0xC)];
LABEL_8:
          if ( (unsigned __int8)V_Game.z10000[0x64 * a4[2] + *(__int16 *)(v13 + 4)] < 3u )
          {
            v6 = 4 * (__int16)v15;
            v7 = v12[v5];
            LOWORD(v15) = v15 + 1;
            *(_DWORD *)(v14 + v6) = v7;
          }
          goto LABEL_10;
        }
        if ( v9 != 4 )
        {
          if ( v9 == 5 )
          {
            a4 = *(__int16 **)v10;
          }
          goto LABEL_8;
        }
        a4 = (__int16 *)v10;
        if ( !sub_45958(a1, 2, (__int16 *)v10, 0) )
        {
          goto LABEL_8;
        }
      }
LABEL_10:
      ++v5;
    }
    while ( v5 < (__int16)ShipsNum_sub_40224 );
  }
  return v15;
}
// 45848: using guessed type int var_1CC[107];

//----- (00045958) --------------------------------------------------------
int __fastcall sub_45958(unsigned __int8 *a1, char a2, __int16 *a3, _DWORD *a4)
{
  int v5; // eax
  __int16 v6; // di
  int v7; // ecx
  __int16 v8; // bx
  int v9; // eax
  int v11[107]; // [esp+0h] [ebp-1C4h] BYREF
  int v12; // [esp+1ACh] [ebp-18h]
  _DWORD *v13; // [esp+1B0h] [ebp-14h]
  char v14; // [esp+1B4h] [ebp-10h]

  v14 = a2;
  v13 = a4;
  if ( !a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x54E);
  }
  v5 = sub_1D794((P_Location)a3, (P_Ship *)v11);
  v6 = 0;
  v7 = 0;
  v8 = 0;
  v12 = v5;
  while ( v8 < v12 )
  {
    v9 = v11[v8];
    if ( v9 && (*(_WORD *)(v9 + 0x56) == *a1 && v14 == 3 || a1[*(__int16 *)(v9 + 0x56) + 0x1C0] == v14) )
    {
      ++v6;
      v7 += *(_DWORD *)v9 * *(_DWORD *)(v9 + 0x8C);
    }
    ++v8;
  }
  if ( v13 )
  {
    *v13 = v7;
  }
  return v6;
}
// 45958: using guessed type int var_1C4[107];

//----- (00045A0C) --------------------------------------------------------
int __fastcall sub_45A0C(_BYTE *a1, int a2, int a3, __int16 a4)
{
  int result; // eax
  int v6; // edx

  if ( *a1 == V_RaceIndex )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x574);
  }
  for ( result = 0; (__int16)result < a4; *(_DWORD *)(v6 + 0x5E) = a2 )
  {
    *(_BYTE *)(*(_DWORD *)(a3 + 4 * (__int16)result) + 0x5D) = 1;
    v6 = *(_DWORD *)(a3 + 4 * (__int16)result++);
  }
  return result;
}

//----- (00045A54) --------------------------------------------------------
unsigned int __fastcall sub_45A54(P_Race pRace, P_Star pStar, P_Ship pShip)
{
  __int16 v5; // ax
  int v6; // edx
  WORD i; // ax
  WORD v8; // si
  int v9; // kr04_4
  __int16 v10; // ax
  int Unknown_15; // edx
  __int16 v12; // dx
  UBYTE v13; // cl
  unsigned int v16; // [esp+0h] [ebp-2Ch]
  unsigned int v17; // [esp+4h] [ebp-28h]
  unsigned int v18; // [esp+8h] [ebp-24h]
  unsigned int v19; // [esp+14h] [ebp-18h]
  void *v20; // [esp+18h] [ebp-14h]

  if ( pRace->index != V_RaceIndex )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x58A);
  }
  v19 = 0;
  v17 = 0;
  v18 = 0;
  v16 = 0;
  v20 = 0;
  if ( (byte_D8460[pStar->index] & 1) != 0 )
  {
    return 0;
  }
  v5 = 0;
  if ( V_Game.racesNum > 0 )
  {
    while ( v5 == V_RaceIndex || pRace->Unknown_1C0[v5] || ((1 << v5) & (pStar->racesBits | (unsigned __int8)pStar->Unknown_15)) == 0 )
    {
      if ( ++v5 >= V_Game.racesNum )
      {
        goto LABEL_11;
      }
    }
    v20 = (void *)v5;
    pRace->Unknown_1C0[v5] = 1;
    v16 = 0xFFFFFFFF;
    pRace->Unknown_1B2[v5] = pRace->Unknown_1D5;
    v6 = v5;
    V_Game.races[v6].Unknown_1C0[pRace->index] = 1;
    V_Game.races[0].Unknown_1B2[pRace->index + v6 * 0xF7] = V_Game.races[v5].Unknown_1D5;
  }
LABEL_11:
  if ( !v16 )
  {
    for ( i = 0; i < V_Game.racesNum; ++i )
    {
      if ( i != V_RaceIndex && pRace->Unknown_1C0[i] == 2 )
      {
        if ( ((1 << i) & (unsigned __int8)pStar->Unknown_15) != 0 )
        {
          v20 = (void *)i;
          v18 = 0xFFFFFFFF;
        }
        if ( !v18 && ((1 << i) & pStar->racesBits) != 0 )
        {
          v17 = 0xFFFFFFFF;
          v20 = (void *)i;
        }
      }
    }
  }
  if ( !v16 && !v18 && !v17 )
  {
    v8 = 0;
    if ( V_Game.racesNum > 0 )
    {
      v9 = 0;
      do
      {
        if ( v8 != V_RaceIndex )
        {
          v10 = 0;
          if ( V_Game.racesNum > 0 )
          {
            Unknown_15 = (unsigned __int8)pStar->Unknown_15;
            while ( ((1 << v8) & Unknown_15) == 0 || ((1 << v10) & Unknown_15) == 0 || V_Game.races[v9].Unknown_1C0[v10] != 2 )
            {
              if ( ++v10 >= V_Game.racesNum )
              {
                goto LABEL_34;
              }
            }
            v19 = 0xFFFFFFFF;
          }
        }
LABEL_34:
        ++v8;
        ++v9;
      }
      while ( v8 < V_Game.racesNum );
    }
  }
  if ( v16 == 0xFFFFFFFF )
  {
    v12 = ASCEND_EP_FINDRACE;
  }
  else if ( v18 == 0xFFFFFFFF )
  {
    v12 = ASCEND_EP_HOSTILESHIP;
  }
  else if ( v17 == 0xFFFFFFFF )
  {
    v12 = ASCEND_EP_HOSTILEPLAN;
  }
  else if ( v19 == 0xFFFFFFFF )
  {
    v12 = ASCEND_EP_OTHERWAR;
  }
  else
  {
    v13 = V_RaceIndex;
    pShip->Unknown_5D = 0;
    pShip->Unknown_5E = 0;
    if ( ((1 << v13) & (unsigned __int8)pStar->Unknown_17) != 0 )
    {
      v12 = ASCEND_EP_SHIPARRIVE;
    }
    else
    {
      v12 = ASCEND_EP_20_DISCOVERED_SYSTEM;
    }
  }
  byte_D8460[pStar->index] |= 1u;
  Q_AddGameEvent_sub_55AEC(&WinMgr, v12, pShip, v20);
  return 0xFFFFFFFF;
}
// 45D0F: conditional instruction was optimized away because edx.4 is in (3..7|==14)

//----- (00045D50) --------------------------------------------------------
unsigned int __fastcall sub_45D50(P_Race a1, P_Star a2, P_Ship a3)
{
  int Unknown_15; // ebx
  MACRO_ASCEND_EP v6; // edx
  UBYTE v7; // cl
  __int16 raceIndex; // [esp+2h] [ebp-14h]

  if ( a1->index != V_RaceIndex )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x61C);
  }
  raceIndex = a3->raceIndex;
  Unknown_15 = (unsigned __int8)a2->Unknown_15;
  v6 = 0xFFFFFFFF;
  if ( ((1 << raceIndex) & Unknown_15) == 0 )
  {
    v7 = a1->Unknown_1C0[raceIndex];
    if ( v7 )
    {
      if ( v7 == 2 )
      {
        v6 = ASCEND_EP_BADSHIPENTERS;
      }
    }
    else
    {
      a1->Unknown_1C0[raceIndex] = 1;
      a1->Unknown_1B2[raceIndex] = a1->Unknown_1D5;
      V_Game.races[raceIndex].Unknown_1C0[a1->index] = 1;
      v6 = ASCEND_EP_RACEFINDUS;
      V_Game.races[raceIndex].Unknown_1B2[a1->index] = V_Game.races[raceIndex].Unknown_1D5;
    }
  }
  if ( v6 == 0xFFFFFFFF || (byte_D8460[a2->index] & 1) != 0 )
  {
    return 0;
  }
  Q_AddGameEvent_sub_55AEC(&WinMgr, (__int16)v6, a3, (void *)raceIndex);
  byte_D8460[a2->index] |= 1u;
  return 0xFFFFFFFF;
}

//----- (00045E64) --------------------------------------------------------
unsigned int __fastcall sub_45E64(_BYTE *a1, __int16 a2)
{
  unsigned __int8 v2; // al
  int v3; // edx
  int i; // kr04_4
  float v7; // [esp+4h] [ebp-24h]
  __int16 v8; // [esp+8h] [ebp-20h]
  __int16 v9; // [esp+Ch] [ebp-1Ch]
  unsigned __int8 v10; // [esp+14h] [ebp-14h]

  if ( a1[a2 + 0x1C0] == 3 )
  {
    return 0xFFFFFFFF;
  }
  v9 = 0;
  v10 = 1 << *a1;
  v8 = 0;
  v2 = 1 << a2;
  v3 = 0;
  for ( i = 0; (__int16)v3 < V_Game.lanesNum; ++i )
  {
    if ( (v10 & V_Game.lanes[i].Unknown_20[0]) != 0 )
    {
      ++v9;
    }
    if ( (v2 & V_Game.lanes[i].Unknown_20[0]) != 0 )
    {
      ++v8;
    }
    ++v3;
  }
  if ( v9 >= 5 )
  {
    if ( !v8 )
    {
      v8 = 1;
    }
    v7 = (float)v9;
    if ( v7 / (double)V_Game.lanesNum > 0.9 )
    {
      return 0;
    }
    if ( v7 / (double)v8 > 2.0 )
    {
      return 0;
    }
    return 0xFFFFFFFF;
  }
  return 0;
}

//----- (00045F60) --------------------------------------------------------
void __fastcall sub_45F60(_BYTE *a1, __int16 a2, int a3)
{
  int v5; // ebx
  int v6; // esi
  int v7; // eax
  int v8; // edx
  int v9; // ebp
  __int64 v10; // rtt
  unsigned __int8 v11; // dh
  unsigned __int8 v12; // dl
  int v13; // ecx
  int v14; // kr04_4
  int v16; // [esp+4h] [ebp-14h]

  v5 = 0;
  v6 = 0;
  if ( a1[a2 + 0x1C0] == 3 )
  {
    v7 = rand();
    v8 = v7;
    v9 = 6;
  }
  else
  {
    v7 = rand();
    v8 = v7;
    v9 = 3;
  }
  LODWORD(v10) = v7;
  HIDWORD(v10) = v8 >> 0x1F;
  v16 = v10 % v9 + 1;
  v11 = 1 << *a1;
  v12 = 1 << V_Game.races[a2].index;
  v13 = 0;
  if ( V_Game.lanesNum > 0 )
  {
    v14 = 0;
    do
    {
      if ( a3 || (v11 & V_Game.lanes[v14].Unknown_20[0]) == 0 )
      {
        if ( (v12 & V_Game.lanes[v14].Unknown_20[0]) != 0 && v5 < v16 && (v11 & V_Game.lanes[v14].Unknown_20[0]) == 0 )
        {
          ++v5;
          V_Game.lanes[v14].Unknown_20[0] |= v11;
        }
      }
      else if ( v6 < v16 && (v12 & V_Game.lanes[v14].Unknown_20[0]) == 0 )
      {
        ++v6;
        V_Game.lanes[v14].Unknown_20[0] |= v12;
      }
      ++v13;
      ++v14;
    }
    while ( (__int16)v13 < V_Game.lanesNum );
  }
}

//----- (00046034) --------------------------------------------------------
unsigned int __fastcall sub_46034(_BYTE *a1, __int16 a2)
{
  unsigned __int8 v2; // al
  int v3; // edx
  int i; // kr04_4
  float v7; // [esp+4h] [ebp-24h]
  __int16 v8; // [esp+8h] [ebp-20h]
  __int16 v9; // [esp+Ch] [ebp-1Ch]
  unsigned __int8 v10; // [esp+14h] [ebp-14h]

  if ( a1[a2 + 0x1C0] == 3 )
  {
    return 0xFFFFFFFF;
  }
  v9 = 0;
  v10 = 1 << *a1;
  v8 = 0;
  v2 = 1 << a2;
  v3 = 0;
  for ( i = 0; (__int16)v3 < V_Game.starsNum; ++i )
  {
    if ( (v10 & V_Game.stars[i].Unknown_17) != 0 )
    {
      ++v9;
    }
    if ( (v2 & V_Game.stars[i].Unknown_17) != 0 )
    {
      ++v8;
    }
    ++v3;
  }
  if ( v9 >= 3 )
  {
    if ( !v8 )
    {
      v8 = 1;
    }
    v7 = (float)v9;
    if ( v7 / (double)V_Game.starsNum > 0.9 )
    {
      return 0;
    }
    if ( v7 / (double)v8 > 1.6 )
    {
      return 0;
    }
    return 0xFFFFFFFF;
  }
  return 0;
}

//----- (00046130) --------------------------------------------------------
void __fastcall sub_46130(_BYTE *a1, __int16 a2, int a3)
{
  int v5; // esi
  int v6; // ebx
  int v7; // eax
  int v8; // edx
  int v9; // ebp
  __int64 v10; // rtt
  unsigned __int8 v11; // dh
  unsigned __int8 v12; // dl
  int v13; // ecx
  int v14; // kr04_4
  int v16; // [esp+4h] [ebp-14h]

  v5 = 0;
  v6 = 0;
  if ( a1[a2 + 0x1C0] == 3 )
  {
    v7 = rand();
    v8 = v7;
    v9 = 4;
  }
  else
  {
    v7 = rand();
    v8 = v7;
    v9 = 2;
  }
  LODWORD(v10) = v7;
  HIDWORD(v10) = v8 >> 0x1F;
  v16 = v10 % v9 + 1;
  v11 = 1 << *a1;
  v12 = 1 << V_Game.races[a2].index;
  v13 = 0;
  if ( V_Game.starsNum > 0 )
  {
    v14 = 0;
    do
    {
      if ( a3 || (v11 & V_Game.stars[v14].Unknown_17) == 0 )
      {
        if ( (v12 & V_Game.stars[v14].Unknown_17) != 0 && v5 < v16 && (v11 & V_Game.stars[v14].Unknown_17) == 0 )
        {
          V_Game.stars[v14].Unknown_16 |= v11;
          ++v5;
          V_Game.stars[v14].Unknown_17 |= v11;
        }
      }
      else if ( v6 < v16 && (v12 & V_Game.stars[v14].Unknown_17) == 0 )
      {
        V_Game.stars[v14].Unknown_16 |= v12;
        ++v6;
        V_Game.stars[v14].Unknown_17 |= v12;
      }
      ++v13;
      ++v14;
    }
    while ( (__int16)v13 < V_Game.starsNum );
  }
}

//----- (00046208) --------------------------------------------------------
unsigned int __fastcall sub_46208(_BYTE *a1, __int16 a2)
{
  unsigned __int8 v2; // al
  __int16 v3; // dx
  int v4; // kr04_4
  float v7; // [esp+0h] [ebp-20h]
  __int16 v8; // [esp+8h] [ebp-18h]
  __int16 v9; // [esp+Ch] [ebp-14h]
  unsigned __int8 v10; // [esp+14h] [ebp-Ch]

  if ( a1[a2 + 0x1C0] == 3 )
  {
    return 0xFFFFFFFF;
  }
  v8 = 0;
  v10 = 1 << *a1;
  v9 = 0;
  v2 = 1 << a2;
  v3 = 0;
  v4 = 0;
  while ( v3 < (int)V_ResTree.num )
  {
    if ( (v10 & V_ResTree.items[v4].Unknown_48) != 0 )
    {
      ++v8;
    }
    if ( (v2 & V_ResTree.items[v4].Unknown_48) != 0 )
    {
      ++v9;
    }
    ++v3;
    ++v4;
  }
  if ( v8 >= 5 )
  {
    if ( !v9 )
    {
      v9 = 1;
    }
    v7 = (float)v8;
    if ( v7 / (double)V_ResTree.num > 0.85 )
    {
      return 0;
    }
    if ( v7 / (double)v9 > 1.7 )
    {
      return 0;
    }
    return 0xFFFFFFFF;
  }
  return 0;
}

//----- (00046304) --------------------------------------------------------
int __fastcall sub_46304(_BYTE *a1, __int16 a2, int a3)
{
  int v4; // ebx
  int v5; // esi
  unsigned __int8 v6; // cl
  __int64 items; // rax
  int v8; // kr04_4
  int v11; // [esp+Ch] [ebp-2Ch]
  __int16 v12; // [esp+18h] [ebp-20h]
  __int16 index; // [esp+20h] [ebp-18h]
  unsigned __int8 v14; // [esp+24h] [ebp-14h]

  v4 = 0;
  v5 = 0;
  if ( a1[a2 + 0x1C0] == 3 )
  {
    v11 = rand() % 2 + 1;
  }
  else
  {
    v11 = 1;
  }
  v14 = 1 << *a1;
  v6 = 1 << V_Game.races[a2].index;
  v12 = (unsigned __int8)*a1;
  index = V_Game.races[a2].index;
  items = (unsigned int)V_ResTree.items;
  v8 = 0;
  while ( V_ResTree.num > SWORD2(items) )
  {
    if ( a3 || (V_ResTree.items[v8].Unknown_48 & v14) == 0 )
    {
      if ( (v6 & V_ResTree.items[v8].Unknown_48) != 0 && v4 < v11 && (v14 & V_ResTree.items[v8].Unknown_48) == 0 )
      {
        V_ResTree.items[v8].Unknown_48 |= v14;
        if ( (unsigned __int16)V_ResTree.a.w1[v12] == SWORD2(items) )
        {
          V_ResTree.a.w1[v12] = 0xFFFF;
        }
        ++v4;
      }
    }
    else if ( v5 < v11 && (V_ResTree.items[v8].Unknown_48 & v6) == 0 )
    {
      V_ResTree.items[v8].Unknown_48 |= v6;
      if ( (unsigned __int16)V_ResTree.a.w1[index] == SWORD2(items) )
      {
        V_ResTree.a.w1[index] = 0xFFFF;
      }
      ++v5;
    }
    ++WORD2(items);
    ++v8;
  }
  return items;
}

//----- (00046470) --------------------------------------------------------
void sub_46470()
{
  Q_RESEARCH_CPP_LoadResTreeTxt_sub_46480(&V_ResTree, 0);
}

//----- (00046480) --------------------------------------------------------
void __fastcall __spoils<eax,edx> Q_RESEARCH_CPP_LoadResTreeTxt_sub_46480(P_ResTree pResTree, const char *fname)
{
  int i; // kr04_4
  int j; // kr0C_4
  const char *v5; // eax
  int mm; // kr14_4
  int v7; // kr2C_4
  int v8; // kr34_4
  FILE *v9; // edx
  int v10; // edx
  int k; // eax
  int v12; // kr1C_4
  int v13; // eax
  int v14; // ecx
  int n; // edi
  int v16; // ebp
  int v17; // ecx
  int ii; // kr24_4
  fpos_t v19; // [esp+4h] [ebp-30h] BYREF
  fpos_t pos; // [esp+8h] [ebp-2Ch] BYREF
  unsigned int bufi1; // [esp+Ch] [ebp-28h] BYREF
  int bufi2; // [esp+10h] [ebp-24h] BYREF
  P_ResTree v23; // [esp+14h] [ebp-20h]
  int m; // [esp+18h] [ebp-1Ch]
  FILE *fp; // [esp+1Ch] [ebp-18h]

  pResTree->b = 0;
  pResTree->allTechForShipReported = 0;
  for ( i = 0; i != 0x64; ++i )
  {
    pResTree->items[i].Unknown_49 = 0;
    pResTree->items[i].Unknown_48 = pResTree->items[i].Unknown_49;
  }
  if ( !V_ResTreeTxtLoaded )
  {
    for ( j = 0; j != 0x64; ++j )
    {
      pResTree->items[j].next[0] = 0xFF;
    }
    pResTree->num = 0;
    if ( fname )
    {
      v5 = fname;
    }
    else
    {
      v5 = "restree.txt";
    }
    fp = Q_OpenFile_sub_1BB10(v5, &v19);
    if ( fp )
    {
      fscanf(fp, "%d", &bufi1);
      pResTree->num = bufi1;
      if ( pResTree->num > 100u )
      {
        pResTree->num = 100;
      }
      m = 0;
      mm = 0;
      v7 = 0;
      v8 = 0;
      while ( pResTree->num > m )
      {
        v9 = fp;
        fscanf(fp, "%s", pResTree->items);
        fscanf(v9, "%d %d", &bufi1, &bufi2);
        pResTree->items[v7].type = bufi1;
        if ( m > 0xA )
        {
          bufi2 *= 2 * mm - 20;
        }
        if ( bufi2 > 65000 )
        {
          bufi2 = 65000;
        }
        v10 = 0;
        pResTree->items[v7].cost = bufi2;
        do
        {
          fscanf(fp, "%d", &bufi1);
          pResTree->items[v7].preq[0] = bufi1;
          if ( bufi1 == 0xFF )
          {
            k = 0;
            goto LABEL_25;
          }
          ++v10;
        }
        while ( v10 < 5 );
        for ( k = 0; k < 60; ++k )
        {
LABEL_25:
          if ( pResTree->items[v7].name[k] == '^' )
          {
            pResTree->items[v7].name[k] = ' ';
          }
        }
        ++m;
        ++mm;
        ++v7;
        ++v8;
      }
      v23 = pResTree;
      m = 0;
      v12 = 0;
      while ( pResTree->num > m )
      {
        v16 = (int)v23;
        for ( n = 0; n < 5; ++n )
        {
          v17 = *(unsigned __int8 *)(v16 + 0x40);
          if ( v17 == 0xFF )
          {
            break;
          }
          v13 = 0;
          v14 = v17;
          while ( pResTree->items[v14].next[v13] != 0xFF )
          {
            if ( ++v13 >= 4 )
            {
              goto LABEL_31;
            }
          }
          LOBYTE(v13) = m;
          pResTree->items[v14].next[v13 + 1] = 0xFF;
          pResTree->items[v14].next[v13] = v13;
LABEL_31:
          ++v16;
        }
        ++m;
        ++v12;
      }
      fgetpos(fp, &pos);
      if ( pos >= v19 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\research.cpp", 0x86);
      }
      fclose(fp);
    }
    V_ResTreeTxtLoaded = 0xFFFFFFFF;
  }
  for ( ii = 0; ii != 7; ++ii )
  {
    pResTree->a.w1[ii] = 0xFFFF;
    pResTree->a.w2[ii] = 0;
  }
}
// 105254: using guessed type int V_ResTreeTxtLoaded;

//----- (000466FC) --------------------------------------------------------
int __fastcall sub_466FC(P_ResTree pResTree)
{
  int v2; // kr04_4
  int v3; // ecx
  int i; // kr0C_4
  int raceIndex; // eax
  int v6; // ebx
  int j; // kr14_4
  int result; // eax
  int v9; // eax
  int v10; // eax
  void *v11; // ebx
  char v12; // dl
  int v13; // edx
  int v14; // eax
  __int64 v15[3]; // [esp+8h] [ebp-3Ch]
  int v16; // [esp+20h] [ebp-24h]
  int v17; // [esp+24h] [ebp-20h]
  int v18; // [esp+28h] [ebp-1Ch]

  v18 = 0;
  v2 = 0;
  while ( V_Game.racesNum > v18 )
  {
    ++v18;
    *((_WORD *)&v15[1] + v2++) = 0;
  }
  v3 = 0;
  for ( i = 0; ; ++i )
  {
    v18 = v3;
    if ( V_Game.planetsNum <= v3 )
    {
      break;
    }
    raceIndex = V_Game.planets[i].raceIndex;
    if ( raceIndex < V_Game.racesNum )
    {
      if ( (_BYTE)raceIndex != V_RaceIndex && V_Game.Unknown_D8A[0x2A] == 2 && V_Game.planets[i].research < 0xFu )
      {
        ++*((_WORD *)&v15[1] + raceIndex);
      }
      *((_WORD *)&v15[1] + V_Game.planets[i].raceIndex) += V_Game.planets[i].research;
    }
    v3 = v18 + 1;
  }
  v6 = 0;
  for ( j = 0; ; ++j )
  {
    v18 = v6;
    result = V_Game.racesNum;
    if ( V_Game.racesNum <= v6 )
    {
      break;
    }
    if ( (unsigned __int16)pResTree->a.w1[j] == 0xFFFF )
    {
      pResTree->a.w2[j] = 0;
    }
    else
    {
      v9 = *((unsigned __int16 *)&v15[1] + v6);
      v17 = (unsigned __int16)v9;
      if ( (_WORD)v9 )
      {
        v16 = v9 + 1;
        v17 = (int)pow((double)(v9 + 1), 0.85);
      }
      v10 = (unsigned __int16)pResTree->a.w1[j];
      pResTree->a.w2[j] += v17;
      if ( (unsigned int)pResTree->a.w2[j] >= pResTree->items[v10].cost )
      {
        v11 = (void *)(unsigned __int16)pResTree->a.w1[j];
        v12 = 1 << v18;
        pResTree->items[(unsigned __int16)v11].Unknown_48 |= 1 << v18;
        pResTree->items[(unsigned __int16)pResTree->a.w1[j]].Unknown_49 |= v12;
        v13 = v18;
        pResTree->a.w1[j] = 0xFFFF;
        v14 = V_RaceIndex;
        pResTree->a.w2[j] = 0;
        if ( v14 == v13 )
        {
          Q_AddGameEvent_sub_55AEC(&WinMgr, ASCEND_EP_00_NEW_DISCOVERY, v11, 0);
          Q_CheckAllTechForShip_sub_468BC(pResTree);
        }
      }
    }
    v6 = v18 + 1;
  }
  return result;
}

//----- (000468BC) --------------------------------------------------------
void __fastcall Q_CheckAllTechForShip_sub_468BC(P_ResTree pResTree)
{
  if ( !pResTree->allTechForShipReported && Q_HasAllTechForShip_sub_46900(pResTree, V_RaceIndex) == TRUE )
  {
    Q_AddGameEvent_sub_55AEC(&WinMgr, ASCEND_EP_21_ALL_TECH_FOR_SHIP, 0, 0);
    pResTree->allTechForShipReported = TRUE;
  }
}

//----- (00046900) --------------------------------------------------------
MACRO_VFX_BOOL __fastcall Q_HasAllTechForShip_sub_46900(P_ResTree pResTree, char a2)
{
  int v2; // edx

  v2 = 1 << a2;
  if ( (v2 & pResTree->items[0].Unknown_48) != 0
    && (v2 & pResTree->items[1].Unknown_48) != 0
    && (v2 & pResTree->items[2].Unknown_48) != 0
    && (v2 & pResTree->items[3].Unknown_48) != 0 )
  {
    return TRUE;
  }
  else
  {
    return FALSE;
  }
}

//----- (0004694C) --------------------------------------------------------
unsigned int __fastcall sub_4694C(int a1, unsigned __int16 a2, __int16 a3)
{
  char v4; // di
  unsigned int v5; // ebp
  int i; // eax

  v4 = a3;
  if ( a3 == 0xFFFFFFFF )
  {
    v4 = V_RaceIndex;
  }
  v5 = 0xFFFFFFFF;
  if ( ((1 << v4) & *(char *)(a1 + 0x4B * a2 + 0x4A)) == 0 )
  {
    for ( i = 0; i < 5; ++i )
    {
      if ( *(unsigned __int8 *)(a1 + 0x4B * a2 + i + 0x40) == 0xFF )
      {
        break;
      }
      if ( ((1 << v4) & *(char *)(a1 + 0x4B * *(unsigned __int8 *)(a1 + 0x4B * a2 + i + 0x40) + 0x4A)) == 0 )
      {
        v5 = 0;
      }
    }
  }
  return v5;
}

//----- (000469F0) --------------------------------------------------------
int __fastcall sub_469F0(int a1, unsigned __int16 a2)
{
  int v3; // edx
  int v4; // kr04_4
  int raceIndex; // ebx
  int v7; // [esp+14h] [ebp-10h]

  if ( a2 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\research.cpp", 0x116);
  }
  v3 = 0;
  v7 = 0;
  v4 = 0;
  while ( v3 < V_Game.planetsNum )
  {
    raceIndex = V_Game.planets[v4].raceIndex;
    if ( raceIndex == a2 )
    {
      LOWORD(raceIndex) = V_Game.planets[v4].research;
      v7 += raceIndex;
    }
    ++v3;
    ++v4;
  }
  if ( v7 )
  {
    return (int)pow((double)(v7 + 1), 0.85);
  }
  return v7;
}

//----- (00046A94) --------------------------------------------------------
__int16 __fastcall sub_46A94(unsigned __int16 *a1, unsigned __int16 a2, void *a3)
{
  unsigned __int16 v5; // dx
  int v6; // eax
  int v7; // kr04_4
  unsigned __int16 v8; // cx
  void *v9; // edi
  char *v10; // esi
  char v11; // dl
  __int16 v13[100]; // [esp+0h] [ebp-E0h]
  void *v14; // [esp+C8h] [ebp-18h]
  int v15; // [esp+CCh] [ebp-14h]

  LOWORD(v15) = a2;
  v14 = a3;
  if ( a2 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\research.cpp", 0x12D);
  }
  v5 = 0;
  v6 = 0;
  v7 = 0;
  while ( v6 < *a1 )
  {
    if ( v6 != a1[(unsigned __int16)v15 + 0xEA7] && ((1 << v15) & *((char *)a1 + 0x4B * v7 + 0x4A)) == 0 )
    {
      v8 = v5++;
      v13[v8] = v6;
    }
    ++v6;
    ++v7;
  }
  if ( v5 )
  {
    v9 = (void *)(unsigned __int16)v13[rand() % v5];
    v10 = (char *)a1 + 0x4B * (unsigned __int16)v9;
    v11 = (1 << v15) | v10[0x4B];
    v10[0x4A] |= 1 << v15;
    v10[0x4B] = v11;
    LOWORD(v6) = v15;
    if ( (unsigned __int16)v15 == V_RaceIndex )
    {
      LOWORD(v6) = Q_AddGameEvent_sub_55AEC(&WinMgr, ASCEND_EP_22_XENO_COMPLETE, v9, v14);
    }
  }
  return v6;
}
// 46A94: using guessed type __int16 var_E0[100];

//----- (00046BB0) --------------------------------------------------------
void __fastcall Q_ReadWriteResTree_sub_46BB0(P_ResTree a1, P_FileInfo a2, int read)
{
  T_ResTree v5; // [esp+0h] [ebp-1D80h] BYREF

  if ( read == TRUE )
  {
    Q_RESEARCH_CPP_LoadResTreeTxt_sub_46480(&v5, 0);
    Q_ReadFile_sub_1BF94(a2, &v5, sizeof(T_ResTree));
    qmemcpy(a1, &v5, 0x1D70u);
    HIWORD(a1->allTechForShipReported) = HIWORD(v5.allTechForShipReported);
  }
  else
  {
    Q_CFILE_CPP_dos_write_sub_1C098(&a2->fh, a1, sizeof(T_ResTree));
  }
}
// 46BE0: CONTAINING_RECORD: too small offset 7536 for struct 'T_ResTree'

//----- (00046C10) --------------------------------------------------------
void __fastcall __spoils<> Q_ResTreeCtor_sub_46C10(P_ResTree a1)
{
  Q_RESEARCH_CPP_LoadResTreeTxt_sub_46480(a1, 0);
}

//----- (00046C20) --------------------------------------------------------
int __fastcall Q_GetTurnsToComplete_sub_46C20(int cost, int done, int production)
{
  int result; // eax

  result = 0xFFFF;
  if ( production > 0 )
  {
    result = (cost - done - 1) / production + 1;
  }
  if ( result < 1 )
  {
    return 1;
  }
  return result;
}

//----- (00046C48) --------------------------------------------------------
void __fastcall __spoils<edx> Q_Wnd9RWDtor_sub_46C48(P_Wnd9RW a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v4; // eax

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, &C_Wnd9RW);
    operator delete[](v3);
  }
  else
  {
    a1->a.procs = (P_Procs)off_96018;
    Q_DestructVectors_sub_1A9E0(a1->vectors);
    Q_Ret_sub_1B66C();
    v4 = Q_A2Dtor_sub_2C848(&a1->a, 1);
    if ( (a2 & 2) != 0 )
    {
      operator delete(v4);
    }
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 96018: using guessed type int (*off_96018[5])();

//----- (00046CAC) --------------------------------------------------------
int __fastcall sub_46CAC(P_Wnd9RW a1)
{
  T_Vector3D *vectors; // kr00_4
  int j; // kr04_4
  double v4; // st7
  int v5; // ebx
  FILE *fp; // eax
  FILE *fp_; // esi
  int v8; // ebx
  T_Vector3D *v9; // kr08_4
  int v10; // kr0C_4
  int v11; // eax
  int result; // eax
  int v13; // esi
  int v14; // edi
  int v15; // ecx
  int v16; // eax
  int i; // ebx
  int v18; // edx
  int v19; // edx
  int v20; // edx
  int v21; // kr14_4
  int v22; // kr1C_4
  int v23; // ebp
  T_Vector3D *v24; // ebx
  int v25; // edi
  int v26; // ecx
  float v27; // [esp-4h] [ebp-124h]
  char v28[100]; // [esp+0h] [ebp-120h] BYREF
  char s[100]; // [esp+64h] [ebp-BCh] BYREF
  int v30; // [esp+C8h] [ebp-58h] BYREF
  int v31; // [esp+CCh] [ebp-54h] BYREF
  int v32; // [esp+D0h] [ebp-50h] BYREF
  int v33; // [esp+D4h] [ebp-4Ch]
  int v34; // [esp+D8h] [ebp-48h]
  int v35; // [esp+DCh] [ebp-44h]
  T_Vector3D *vector; // [esp+E0h] [ebp-40h]
  int v37; // [esp+E4h] [ebp-3Ch]
  int v38; // [esp+E8h] [ebp-38h]
  int v39; // [esp+ECh] [ebp-34h]
  int v40; // [esp+F0h] [ebp-30h]
  int v41; // [esp+F4h] [ebp-2Ch]
  int v42; // [esp+F8h] [ebp-28h]
  int v43; // [esp+FCh] [ebp-24h]
  float degrees; // [esp+100h] [ebp-20h]
  int v45; // [esp+104h] [ebp-1Ch]

  *(_WORD *)&a1->Unknown[0x3E8] = 0xFFFF;
  v39 = 0;
  vectors = a1->vectors;
  j = 0;
  do
  {
    vectors[j].x = 0.0;
    v4 = (double)v39;
    vectors[j].z = 0.0;
    v5 = v39;
    vectors[j].y = v4;
    v39 = v5 + 1;
    ++j;
  }
  while ( v5 + 1 < 0x64 );
  sub_1B808(&a1->Wnd9RW1, 30.0, 1.0, 100000.0, 0x140);
  a1->Wnd9RW1.vector_34.x = 0.0;
  a1->Wnd9RW1.vector_34.y = 0.0;
  a1->Wnd9RW1.vector_34.z = -150.0;
  fp = Q_OpenFile_sub_1BB10("reswin.txt", 0);
  fp_ = fp;
  if ( fp )
  {
    fscanf(fp, "%d", &v30);
    if ( V_ResTree.num == v30 )
    {
      v8 = 0;
      v9 = a1->vectors;
      v10 = 0;
      while ( v8 < V_ResTree.num )
      {
        fscanf(fp_, "%d %d %d", &v30, &v31, &v32);
        ++v8;
        v33 = v31;
        v11 = v32;
        v9[v10].x = (float)v30;
        v34 = v11;
        v9[v10].y = (float)v33;
        v9[v10++].z = (float)v34;
      }
    }
    return fclose(fp_);
  }
  else
  {
    if ( V_ResTreeTxtLoaded != 0xFFFFFFFF )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\reswin.cpp", 0x76);
    }
    memset(s, 0xFF, sizeof(s));
    v13 = 0;
    do
    {
      v14 = 0;
      v41 = 0xFFFFFFFF;
      v45 = 0;
      while ( v14 < V_ResTree.num )
      {
        if ( (unsigned __int8)s[v14] == 0xFF )
        {
          v15 = v45;
          v16 = 0;
          for ( i = 0; i < 5; ++i )
          {
            v18 = V_ResTree.items[0].preq[v15];
            if ( v18 == 0xFF )
            {
              break;
            }
            v19 = (unsigned __int8)s[v18];
            if ( v19 == 0xFF )
            {
              v41 = 0;
              LOBYTE(v16) = 0xFF;
              break;
            }
            if ( v19 >= v16 )
            {
              v16 = v19 + 1;
              if ( v19 + 1 >= v13 )
              {
                v13 = v19 + 2;
              }
            }
            ++v15;
          }
          s[v14] = v16;
        }
        ++v14;
        v45 += 0x4B;
      }
    }
    while ( !v41 );
    memset(v28, 0, sizeof(v28));
    for ( result = 0; result < V_ResTree.num; ++result )
    {
      v20 = (unsigned __int8)s[result];
      ++v28[v20];
    }
    v42 = 0;
    if ( v13 > 0 )
    {
      v38 = 0;
      vector = a1->vectors;
      v37 = 0xF0;
      v21 = 0;
      v22 = 0;
      do
      {
        v43 = 4;
        degrees = (float)v37;
        v23 = (unsigned __int8)v28[v42];
        if ( v42 % 2 && (unsigned __int8)v28[v42] > 2u )
        {
          --v23;
        }
        else if ( (unsigned __int8)v28[v42] > 1u )
        {
          v43 = 0x17;
        }
        v24 = vector;
        v25 = 0;
        v26 = 0;
        v40 = v38;
        while ( v26 < V_ResTree.num )
        {
          if ( (unsigned __int8)s[v26] == v42 )
          {
            v35 = 0xF * (v25 & 1) + v40;
            v24->y = (float)v35;
            v24->z = (float)v43;
            v27 = degrees;
            v24->x = 0.0;
            Q_RotateVectorY_sub_532AC(v24, v27);
            v35 = 0x168 / v23;
            ++v25;
            v43 = 0x17;
            degrees = (double)(0x168 / v23) + degrees;
          }
          ++v24;
          ++v26;
        }
        result = v42 + 1;
        v42 = result;
        ++v21;
        ++v22;
      }
      while ( v13 > result );
    }
  }
  return result;
}
// 105254: using guessed type int V_ResTreeTxtLoaded;
// 46CAC: using guessed type char s[100];
// 46CAC: using guessed type char var_120[100];

//----- (00047088) --------------------------------------------------------
int __fastcall sub_47088(int a1)
{
  int v1; // ebp
  int v2; // ecx
  int v3; // esi
  int v4; // edx
  int result; // eax
  int v6; // [esp+0h] [ebp-24h]
  int v7; // [esp+4h] [ebp-20h]
  int v8; // [esp+8h] [ebp-1Ch]

  v6 = a1;
  v8 = 0xFFFF;
  v1 = V_Mouse.x - *(_DWORD *)(a1 + 8);
  v2 = V_ResTree.num - 1;
  v7 = V_Mouse.y - *(_DWORD *)(a1 + 0xC);
  if ( v2 >= 0 )
  {
    while ( 1 )
    {
      v3 = *(unsigned __int16 *)(a1 + 2 * v2 + 0x913);
      if ( sub_4694C((int)&V_ResTree, v3, 0xFFFFFFFF) )
      {
        a1 = v6 + 2 * v3;
        v4 = *(__int16 *)(a1 + 0x5F3);
        if ( v1 > v4 - 0x19 && v1 < v4 + 0x19 )
        {
          a1 = *(__int16 *)(a1 + 0x6BB);
          if ( a1 - 0x19 < v7 && a1 + 0x19 > v7 )
          {
            break;
          }
        }
      }
      if ( --v2 < 0 )
      {
        goto LABEL_10;
      }
    }
    v8 = v3;
  }
LABEL_10:
  result = v8;
  if ( (_WORD)v8 != *(_WORD *)(v6 + 0x9DB) )
  {
    *(_WORD *)(v6 + 0x9DB) = v8;
    dword_106FD0 = 0xFFFFFFFF;
    dword_106FD4 = 0xFFFFFFFF;
  }
  return result;
}
// 106FD0: using guessed type int dword_106FD0;
// 106FD4: using guessed type int dword_106FD4;

//----- (00047224) --------------------------------------------------------
unsigned int __fastcall sub_47224(int a1, unsigned __int16 a2, LONG a3, unsigned int a4)
{
  int v7; // edx
  char v8; // cl
  int v9; // kr04_4
  int v10; // edx
  char v11; // cl
  int v12; // kr0C_4
  int v13; // eax
  UBYTE v14; // cl
  int v15; // eax
  int v16; // edx
  char v17; // cl
  int v18; // kr14_4
  int v19; // ebx
  int v20; // ebx
  int v21; // eax
  double v22; // st7
  int v23; // edx
  int v24; // edx
  WORD v25; // ax
  float v27; // [esp+10h] [ebp-14h]
  float v28; // [esp+10h] [ebp-14h]
  float v29; // [esp+14h] [ebp-10h]
  int v30; // [esp+14h] [ebp-10h]

  if ( a2 < 6u )
  {
    if ( a2 < 2u )
    {
      if ( a2 != 1 )
      {
        return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
      }
      Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFED8);
      Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEDC);
      Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEBC[V_RaceIndex]);
      Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEDE);
      dword_106FD8 = 0;
      dword_106FCC = 0xFFFFFFFF;
      dword_106FD0 = 0xFFFFFFFF;
      *(_WORD *)(a1 + 0x9DB) = 0xFFFF;
      sub_2F424((T_TypeA2 *)a1, 1, a3, a4);
      sub_56400(&WinMgr, *(_DWORD *)(a1 + 0x41), 0x3A, 0, 0, 0);
      return 0;
    }
    if ( a2 <= 2u )
    {
      v7 = 0;
      v8 = 1 << V_RaceIndex;
      v9 = 0;
      while ( v7 < V_ResTree.num )
      {
        ++v7;
        V_ResTree.items[v9++].Unknown_49 &= ~v8;
      }
      sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
      sub_564C0(&WinMgr, *(_DWORD *)(a1 + 0x41), 0xFFFFFFFF);
      return 0;
    }
    if ( a2 > 3u )
    {
      if ( !*(_DWORD *)(a1 + 0x35) )
      {
        return 0;
      }
      HIWORD(v24) = 0;
      sub_47088(a1);
      LOWORD(v24) = *(_WORD *)(a1 + 0x9DB);
      if ( (unsigned __int16)v24 == 0xFFFF
        || ((1 << V_RaceIndex) & V_ResTree.items[v24].Unknown_48) != 0
        || !sub_4694C((int)&V_ResTree, v24, 0xFFFFFFFF) )
      {
        return 0;
      }
      Q_StartSample_sub_4FB90(&V_SoundSystem, 0);
      dword_106FD4 = 0xFFFFFFFF;
      v25 = *(_WORD *)(a1 + 0x9DB);
      dword_106FD0 = 0xFFFFFFFF;
      V_ResTree.a.w1[V_RaceIndex] = v25;
      return 0;
    }
    if ( a4 < 0x2E )
    {
      if ( a4 < 0xD )
      {
        if ( a4 == 0xC && WinMgr.j > 0.1 )
        {
          WinMgr.j = WinMgr.j * 0.8;
          sub_47088(a1);
          return 0;
        }
        goto LABEL_60;
      }
      if ( a4 <= 0xD )
      {
        if ( WinMgr.j < 10.0 )
        {
          WinMgr.j = WinMgr.j * 1.25;
          sub_47088(a1);
          return 0;
        }
        goto LABEL_60;
      }
      if ( a4 >= 0x20 )
      {
        if ( a4 <= 0x20 )
        {
          if ( !V_NougatLfExists_dword_A0CFC )
          {
            goto LABEL_60;
          }
          v10 = 0;
          v11 = 1 << V_RaceIndex;
          v12 = 0;
          while ( v10 < V_ResTree.num )
          {
            ++v10;
            *((_BYTE *)&V_ResTreeTxtLoaded + 0x4B * v12 + 0x4E) = v11 | V_ResTree.items[v12].Unknown_48;
            ++v12;
          }
        }
        else
        {
          if ( a4 != 0x21 || !V_NougatLfExists_dword_A0CFC )
          {
            goto LABEL_60;
          }
          v16 = 0;
          v17 = 1 << V_RaceIndex;
          v18 = 0;
          while ( v16 < V_ResTree.num )
          {
            ++v16;
            *((_BYTE *)&V_ResTreeTxtLoaded + 0x4B * v18 + 0x4E) = ~v17 & V_ResTree.items[v18].Unknown_48;
            ++v18;
          }
        }
        v13 = V_RaceIndex;
        V_ResTree.a.w1[V_RaceIndex] = 0xFFFF;
        word_106FB4[v13] = 0;
        sub_47088(a1);
        return 0;
      }
    }
    else
    {
      if ( a4 > 0x2E )
      {
        if ( a4 < 0x49 )
        {
          if ( a4 < 0x32 )
          {
            goto LABEL_60;
          }
          if ( a4 <= 0x32 )
          {
            dword_106FC2 = ~dword_106FC2;
            Q_Proc_sub_5A320(0x14);
            dword_106FCC = 0xFFFFFFFF;
            dword_106FD4 = 0xFFFFFFFF;
            sub_47088(a1);
            return 0;
          }
          if ( a4 != 0x47 )
          {
            goto LABEL_60;
          }
        }
        else if ( a4 > 0x49 )
        {
          if ( a4 >= 0x4F && (a4 <= 0x4F || a4 == 0x51) )
          {
            v20 = *(_DWORD *)(a1 + 0xA7);
            *(_DWORD *)(a1 + 0xE3) = 0x49742400;
            (*(void (__fastcall **)(int, _DWORD))(v20 + 0xC))(a1, 0);
            sub_47088(a1);
            return 0;
          }
          goto LABEL_60;
        }
        v19 = *(_DWORD *)(a1 + 0xA7);
        *(_DWORD *)(a1 + 0xE3) = 0xC2C80000;
        (*(void (__fastcall **)(int, _DWORD))(v19 + 0xC))(a1, 0);
        sub_47088(a1);
        return 0;
      }
      if ( V_NougatLfExists_dword_A0CFC && (unsigned __int16)V_ResTree.a.w1[V_RaceIndex] != 0xFFFF )
      {
        v14 = V_RaceIndex;
        v15 = (unsigned __int16)V_ResTree.a.w1[V_RaceIndex];
        V_ResTree.items[v15].Unknown_48 |= 1 << V_RaceIndex;
        V_ResTree.a.w1[v14] = 0xFFFF;
        word_106FB4[v14] = 0;
        sub_47088(a1);
        return 0;
      }
    }
LABEL_60:
    sub_47088(a1);
    return 0;
  }
  if ( a2 <= 6u )
  {
    sub_567BC(&WinMgr, *(_DWORD *)(a1 + 0x41), 8);
    sub_47088(a1);
    if ( (*(_DWORD *)(a1 + 0x3D) & *(_DWORD *)(a1 + 0x35) & *(_DWORD *)(a1 + 0x39)) == 0xFFFFFFFF )
    {
      (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
    }
    return 0xFFFFFFFF;
  }
  if ( a2 < 0x32u )
  {
    if ( a2 <= 7u )
    {
      sub_56728(&WinMgr, *(_DWORD *)(a1 + 0x41), 4, 8, 0, 0);
      sub_47088(a1);
      if ( (*(_DWORD *)(a1 + 0x3D) & *(_DWORD *)(a1 + 0x35) & *(_DWORD *)(a1 + 0x39)) == 0xFFFFFFFF )
      {
        (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0x10))();
      }
      return 0xFFFFFFFF;
    }
    if ( a2 != 8 )
    {
      return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
    }
    goto LABEL_60;
  }
  if ( a2 <= 0x35u )
  {
    if ( a2 == 0x32 )
    {
      if ( (dword_106FD8 & 4) != 0 )
      {
        if ( (dword_106FD8 & 8) != 0 )
        {
          LOBYTE(dword_106FD8) = dword_106FD8 & 0xF7;
        }
        else
        {
          LOBYTE(dword_106FD8) = dword_106FD8 & 0xFB;
        }
      }
      else
      {
        LOBYTE(dword_106FD8) = dword_106FD8 & 0xF3 | 4;
      }
    }
    if ( a2 == 0x33 )
    {
      if ( (dword_106FD8 & 4) != 0 )
      {
        if ( (dword_106FD8 & 8) != 0 )
        {
          LOBYTE(dword_106FD8) = dword_106FD8 & 0xFB;
        }
        else
        {
          LOBYTE(dword_106FD8) = dword_106FD8 | 8;
        }
      }
      else
      {
        LOBYTE(dword_106FD8) = dword_106FD8 | 0xC;
      }
    }
    if ( a2 == 0x34 )
    {
      if ( (dword_106FD8 & 1) != 0 )
      {
        if ( (dword_106FD8 & 2) != 0 )
        {
          LOBYTE(dword_106FD8) = dword_106FD8 & 0xFD;
        }
        else
        {
          LOBYTE(dword_106FD8) = dword_106FD8 & 0xFE;
        }
      }
      else
      {
        LOBYTE(dword_106FD8) = dword_106FD8 & 0xFC | 1;
      }
    }
    if ( a2 == 0x35 )
    {
      if ( (dword_106FD8 & 1) != 0 )
      {
        if ( (dword_106FD8 & 2) != 0 )
        {
          LOBYTE(dword_106FD8) = dword_106FD8 & 0xFE;
        }
        else
        {
          LOBYTE(dword_106FD8) = dword_106FD8 | 2;
        }
      }
      else
      {
        LOBYTE(dword_106FD8) = dword_106FD8 | 3;
      }
    }
    if ( a3 != 4 )
    {
      return 0;
    }
    v21 = 4;
    if ( a2 == 0x34 || a2 == 0x35 )
    {
      v21 = 1;
    }
    sub_56728(&WinMgr, *(_DWORD *)(a1 + 0x41), 1, 0x38, v21, 0);
    return 0;
  }
  else
  {
    if ( a2 < 0x38u )
    {
      return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
    }
    if ( a2 > 0x38u )
    {
      if ( a2 != 0x3A )
      {
        return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
      }
      if ( (dword_106FD8 & 4) != 0 )
      {
        v29 = 3.0;
        if ( (dword_106FD8 & 8) != 0 )
        {
          v29 = -3.0;
        }
        *(float *)&v30 = v29 * WinMgr.j;
        sub_53564((float *)(a1 + 0x11F), a2, a3, 0xFFFFFFFF, v30);
        dword_106FD4 = 0xFFFFFFFF;
      }
      if ( (dword_106FD8 & 1) != 0 )
      {
        v27 = -2.0;
        if ( (dword_106FD8 & 2) != 0 )
        {
          v27 = 2.0;
        }
        v28 = v27 * WinMgr.j;
        v22 = *(float *)(a1 + 0xE3) + v28;
        dword_106FD4 = 0xFFFFFFFF;
        *(float *)(a1 + 0xE3) = v22;
      }
      if ( dword_106FD4 == 0xFFFFFFFF )
      {
        (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
        return 0;
      }
      return 0;
    }
    v23 = *(_DWORD *)(a1 + 0x41);
    dword_106FD8 &= ~a3;
    sub_567BC(&WinMgr, v23, 0xFFFFFFFF);
    return 0;
  }
}
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// FFEBC: using guessed type __int16 word_FFEBC[7];
// 105254: using guessed type int V_ResTreeTxtLoaded;
// 106FB4: using guessed type __int16 word_106FB4[7];
// 106FC2: using guessed type int dword_106FC2;
// 106FCC: using guessed type int dword_106FCC;
// 106FD0: using guessed type int dword_106FD0;
// 106FD4: using guessed type int dword_106FD4;
// 106FD8: using guessed type int dword_106FD8;

//----- (00047A64) --------------------------------------------------------
int __fastcall sub_47A64(const void *a1, const void *a2)
{
  unsigned __int16 v2; // si
  BOOL v3; // edx

  v2 = *(_WORD *)a2;
  v3 = *(float *)(dword_106FDC + 4 * *(unsigned __int16 *)a2) > (double)*(float *)(dword_106FDC + 4 * *(unsigned __int16 *)a1);
  if ( *(float *)(dword_106FDC + 4 * v2) < (double)*(float *)(dword_106FDC + 4 * *(unsigned __int16 *)a1) )
  {
    return 0xFFFFFFFF;
  }
  return v3;
}
// 106FDC: using guessed type int dword_106FDC;

//----- (00047ABC) --------------------------------------------------------
void __fastcall sub_47ABC(int a1)
{
  PANE *v2; // esi
  int v3; // edx
  int i; // kr04_4
  int v5; // ebx
  float v6; // eax
  int v7; // kr0C_4
  int v8; // kr28_4
  int v9; // kr34_4
  int v10; // kr38_4
  int v11; // ebx
  int v12; // edx
  int v13; // kr14_4
  char v14; // bl
  unsigned __int16 v15; // dx
  int v16; // edx
  int v17; // eax
  int v18; // esi
  int v19; // edi
  int v20; // ecx
  __int16 v21; // ax
  void *ShapeTable_sub_1B084; // eax
  LONG v23; // esi
  unsigned __int16 v24; // dx
  void *v25; // eax
  char *sub_1CEA8; // eax
  int v27; // esi
  void *v28; // eax
  void *v29; // eax
  LONG v30; // ebx
  unsigned __int16 v31; // di
  void *v32; // eax
  int v33; // edi
  int v34; // esi
  int v35; // eax
  int Unknown_48; // edx
  int v37; // ebx
  int TurnsToComplete_sub_46C20; // eax
  int v39; // edx
  char *v40; // kr18_4
  int v41; // kr1C_4
  int v42; // kr30_4
  char v43; // al
  char v44; // al
  int v45; // eax
  char *v46; // eax
  int v47; // esi
  char *v48; // eax
  char *name; // eax
  int v50; // esi
  unsigned __int16 v51; // dx
  unsigned __int16 v52; // ax
  LONG v53; // ebp
  void *v54; // eax
  void *v55; // eax
  int v56; // kr24_4
  char *v57; // eax
  int v58; // esi
  int v59; // ebp
  void *v60; // esi
  char *v61; // eax
  unsigned __int16 v62; // di
  __int16 v63; // dx
  char *v64; // eax
  int v65; // esi
  unsigned __int16 v66; // dx
  void *v67; // eax
  void *v68; // eax
  int v69; // esi
  char *v70; // eax
  char *v71; // eax
  LONG v72; // [esp-20h] [ebp-170h]
  LONG v73; // [esp-1Ch] [ebp-16Ch]
  LONG v74; // [esp-1Ch] [ebp-16Ch]
  LONG v75; // [esp-1Ch] [ebp-16Ch]
  LONG v76; // [esp-18h] [ebp-168h]
  LONG v77; // [esp-18h] [ebp-168h]
  LONG v78; // [esp-18h] [ebp-168h]
  LONG v79; // [esp-Ch] [ebp-15Ch]
  __int16 v80; // [esp-Ch] [ebp-15Ch]
  __int16 v81; // [esp-Ch] [ebp-15Ch]
  LONG v82; // [esp-Ch] [ebp-15Ch]
  __int16 v83; // [esp-Ch] [ebp-15Ch]
  __int16 v84; // [esp-Ch] [ebp-15Ch]
  __int16 v85; // [esp-Ch] [ebp-15Ch]
  LONG v86; // [esp-8h] [ebp-158h]
  LONG v87; // [esp-8h] [ebp-158h]
  LONG v88; // [esp-8h] [ebp-158h]
  LONG v89; // [esp-8h] [ebp-158h]
  LONG v90; // [esp-8h] [ebp-158h]
  char *v91; // [esp-8h] [ebp-158h]
  UBYTE *v92; // [esp-4h] [ebp-154h]
  LONG v93; // [esp-4h] [ebp-154h]
  LONG v94; // [esp-4h] [ebp-154h]
  LONG v95; // [esp-4h] [ebp-154h]
  char *v96; // [esp-4h] [ebp-154h]
  char *v97; // [esp-4h] [ebp-154h]
  char v98[100]; // [esp+0h] [ebp-150h]
  char s[80]; // [esp+64h] [ebp-ECh] BYREF
  PANE v100; // [esp+B4h] [ebp-9Ch] BYREF
  PANE v101; // [esp+C8h] [ebp-88h] BYREF
  T_Vector3D v102; // [esp+DCh] [ebp-74h] BYREF
  LONG hotX; // [esp+E8h] [ebp-68h] BYREF
  LONG hotY; // [esp+ECh] [ebp-64h] BYREF
  float v105; // [esp+F0h] [ebp-60h]
  int v106; // [esp+F4h] [ebp-5Ch]
  int a2; // [esp+F8h] [ebp-58h]
  int v108; // [esp+FCh] [ebp-54h]
  int v109; // [esp+100h] [ebp-50h]
  float *v110; // [esp+104h] [ebp-4Ch]
  float v111; // [esp+108h] [ebp-48h]
  LONG x_scale; // [esp+10Ch] [ebp-44h]
  int v113; // [esp+110h] [ebp-40h]
  int v114; // [esp+114h] [ebp-3Ch]
  int v115; // [esp+118h] [ebp-38h]
  int v116; // [esp+11Ch] [ebp-34h]
  int v117; // [esp+120h] [ebp-30h]
  int v118; // [esp+124h] [ebp-2Ch]
  LONG v119; // [esp+128h] [ebp-28h]
  int v120; // [esp+12Ch] [ebp-24h]
  PANE *pane; // [esp+130h] [ebp-20h]
  int v122; // [esp+134h] [ebp-1Ch]
  LONG shape_number; // [esp+138h] [ebp-18h]

  v100 = *(PANE *)(a1 + 4);
  v2 = (PANE *)(a1 + 4);
  VFX_pane_wipe((PANE *)(a1 + 4), 0);
  sub_552CC(&WinMgr, v2);
  v3 = 0;
  v111 = *(float *)(a1 + 0x147);
  v105 = v111;
  a2 = 0;
  for ( i = 0; ; ++i )
  {
    v5 = a2;
    if ( V_ResTree.num <= a2 )
    {
      break;
    }
    v3 = (unsigned __int16)a2;
    if ( sub_4694C((int)&V_ResTree, a2, 0xFFFFFFFF) )
    {
      if ( *(float *)(a1 + 0xC * i + 0x147) < (double)v105 )
      {
        v105 = *(float *)(a1 + 0xC * i + 0x147);
      }
      if ( *(float *)(a1 + 0xC * i + 0x147) > (double)v111 )
      {
        v111 = *(float *)(a1 + 0xC * i + 0x147);
      }
    }
    ++a2;
  }
  if ( *(float *)(a1 + 0xE3) >= (double)v105 )
  {
    if ( *(float *)(a1 + 0xE3) <= (double)v111 )
    {
      goto LABEL_14;
    }
    v6 = v111;
  }
  else
  {
    v6 = v105;
  }
  *(float *)(a1 + 0xE3) = v6;
LABEL_14:
  sub_1B864(a1 + 0xAB, v3, v5, a1);
  a2 = 0;
  v110 = (float *)(a1 + 0xEB);
  v115 = a1;
  v113 = a1;
  v7 = 0;
  v8 = 0;
  v9 = 0;
  v10 = 0;
  while ( V_ResTree.num > a2 )
  {
    memset(&v102, 0, sizeof(v102));
    sub_53384((float *)(a1 + 0x143 + 0xC * v7), v110, &v102.x);
    v11 = a2;
    *(float *)(v113 + 0x783) = v102.z;
    v12 = v115;
    sub_533D4(&v102, *(float *)(a1 + 0xD3), 0xEB, 0xF0, a1 + 0x5F3 + 2 * v9, a1 + 0x6BB + 2 * v8);
    *(_WORD *)(v12 + 0x913) = a2;
    a2 = v11 + 1;
    v115 = v12 + 2;
    ++v7;
    ++v8;
    ++v9;
    ++v10;
  }
  dword_106FDC = a1 + 0x783;
  qsort((void *)(a1 + 0x913), V_ResTree.num, 2u, sub_47A64);
  a2 = 0;
  v13 = 0;
  while ( V_ResTree.num > a2 )
  {
    v14 = a2;
    v15 = *(_WORD *)(a1 + 2 * v13 + 0x913);
    ++a2;
    v98[v15] = v14;
    ++v13;
  }
  v122 = (unsigned __int16)V_ResTree.a.w1[V_RaceIndex];
  a2 = 0;
  pane = (PANE *)(a1 + 4);
  v114 = a1;
  while ( V_ResTree.num > a2 )
  {
    v119 = *(unsigned __int16 *)(v114 + 0x913);
    if ( sub_4694C((int)&V_ResTree, v119, 0xFFFFFFFF) )
    {
      v116 = (int)((*(float *)(a1 + 4 * v119 + 0x783) + *(float *)(a1 + 0xE7)) * 0.25);
      if ( v116 >= (int)0xFFFFFFFD )
      {
        if ( v116 > 3 )
        {
          v116 = 3;
        }
      }
      else
      {
        v116 = 0xFFFFFFFD;
      }
      v92 = (*V_Type6_stru_D8654.hazeTables)[v116 + 4];
      v116 += 3;
      VFX_shape_lookaside(v92);
      v117 = 0;
      if ( ((1 << V_RaceIndex) & V_ResTree.items[v119].Unknown_48) != 0 )
      {
        v117 = 0x14;
      }
      else if ( (unsigned __int16)v122 == v119 )
      {
        v16 = v119 ^ (unsigned __int16)v122;
        LOBYTE(v16) = V_RaceIndex;
        v17 = 0x12 * (unsigned __int16)word_106FB4[v16] / V_ResTree.items[v119].cost + 2;
        v117 = v17;
        if ( v17 >= (int)0xFFFFFFEF )
        {
          if ( v17 > 0x11 )
          {
            v117 = 0x11;
          }
        }
        else
        {
          v117 = 0xFFFFFFEF;
        }
      }
      v18 = 0x4B * v119;
      v118 = 2 * v119 + a1;
      v19 = 0;
      v120 = 4 * v119 + a1;
      while ( 1 )
      {
        v20 = V_ResTree.items[0].preq[v18];
        if ( v20 == 0xFF )
        {
          break;
        }
        if ( sub_4694C((int)&V_ResTree, V_ResTree.items[0].preq[v18], 0xFFFFFFFF) )
        {
          v108 = (int)(((*(float *)(v120 + 0x783) + *(float *)(a1 + 4 * v20 + 0x783)) * 0.5 + *(float *)(a1 + 0xE7)) * 0.25);
          if ( v108 <= 3 )
          {
            if ( v108 < (int)0xFFFFFFFD )
            {
              v108 = 0xFFFFFFFD;
            }
          }
          else
          {
            v108 = 3;
          }
          v21 = 0x6B - v108;
          if ( v20 == *(unsigned __int16 *)(a1 + 0x9DB) )
          {
            v21 = 0xF3;
          }
          VFX_line_draw(
            pane,
            *(__int16 *)(v118 + 0x5F3),
            *(__int16 *)(v118 + 0x6BB) - 0x1B,
            *(__int16 *)(a1 + 2 * v20 + 0x5F3),
            *(__int16 *)(a1 + 2 * v20 + 0x6BB) + 0x1B,
            0,
            v21);
          ++v19;
          ++v18;
          if ( v19 >= 5 )
          {
            break;
          }
        }
        else
        {
          ++v19;
          ++v18;
          if ( v19 >= 5 )
          {
            break;
          }
        }
      }
      if ( v117 )
      {
        v117 = (v117 << 0x10) / 0x14;
        v86 = v117;
        v79 = v117;
        v76 = *(__int16 *)(a1 + 2 * v119 + 0x6BB);
        v73 = *(__int16 *)(a1 + 2 * v119 + 0x5F3);
        v72 = v119;
        ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEDE);
        VFX_shape_transform(pane, ShapeTable_sub_1B084, v72, v73, v76, V_BigBuffer, 0, v79, v86, 1);
      }
      v23 = 1;
      if ( (unsigned __int16)v122 == v119 && ((1 << V_RaceIndex) & V_ResTree.items[v119].Unknown_48) == 0 )
      {
        v23 = 0;
      }
      if ( ((1 << V_RaceIndex) & (char)V_ResTree.items[v119].Unknown_49) != 0 )
      {
        v23 = 3;
      }
      if ( *(unsigned __int16 *)(a1 + 0x9DB) == v119 )
      {
        v23 = 2;
      }
      v24 = sub_1B270(&WinMgr.t13, "data\\resring.shp", 0xFFFFFFFF);
      v93 = *(__int16 *)(a1 + 2 * v119 + 0x6BB);
      v87 = *(__int16 *)(a1 + 2 * v119 + 0x5F3);
      v25 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, v24);
      if ( v23 == 2 )
      {
        VFX_shape_draw(pane, v25, 2, v87, v93);
      }
      else
      {
        VFX_shape_translate_draw(pane, v25, v23, v87, v93);
      }
    }
    v114 += 2;
    ++a2;
  }
  WinMgr.LargeFont.pane = *(PANE *)(a1 + 4);
  if ( dword_106FD0 == 0xFFFFFFFF )
  {
    v100.y1 = 0x1AA;
    v100.x0 = 0x1E5;
    v100.y0 = 7;
    v100.x1 = 0x278;
    VFX_pane_wipe(&v100, 0);
    sub_552CC(&WinMgr, &v100);
    shape_number = 0xFFFF;
    if ( (unsigned __int16)v122 != 0xFFFF )
    {
      shape_number = (unsigned __int16)v122;
    }
    if ( *(unsigned __int16 *)(a1 + 0x9DB) != 0xFFFF )
    {
      shape_number = *(unsigned __int16 *)(a1 + 0x9DB);
    }
    if ( (unsigned __int16)shape_number != 0xFFFF )
    {
      WinMgr.LargeFont.pane = v100;
      v106 = 0xFFFFFFFF;
      v101 = v100;
      if ( (_WORD)shape_number == (_WORD)v122 )
      {
        if ( (_WORD)shape_number != *(_WORD *)(a1 + 0x9DB) )
        {
          v106 = 4 * V_Game.races[V_RaceIndex].Unknown_02 + 0x13;
        }
        v80 = v106;
        sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7A);// 122: "Current Project:"
        sub_2B8A8(&WinMgr.LargeFont, 0, 0xA, sub_1CEA8, 2, v80, 0xFFFFFFFF, 0x82);
      }
      v27 = (unsigned __int16)shape_number;
      v109 = 0x46;
      v101.y1 = 0x78;
      v28 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEDE);
      Q_GSYSTEM_CPP_sub_2BC40(&v101, v28, (unsigned __int16)v27, &hotX, &hotY);
      v94 = hotY;
      v88 = hotX;
      v29 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEDE);
      VFX_shape_draw(&v101, v29, (unsigned __int16)v27, v88, v94);
      v30 = 1;
      v31 = sub_1B270(&WinMgr.t13, "data\\resring.shp", 0xFFFFFFFF);
      if ( (_WORD)v27 == (_WORD)v122 && ((1 << V_RaceIndex) & V_ResTree.items[v27].Unknown_48) == 0 )
      {
        v30 = 0;
      }
      if ( ((1 << V_RaceIndex) & (char)V_ResTree.items[(unsigned __int16)shape_number].Unknown_49) != 0 )
      {
        v30 = 3;
      }
      if ( (_WORD)shape_number == *(_WORD *)(a1 + 0x9DB) )
      {
        v30 = 2;
      }
      v95 = hotY;
      v89 = hotX;
      v32 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, v31);
      VFX_shape_draw(&v101, v32, v30, v89, v95);
      v34 = (unsigned __int16)shape_number;
      v109 += 0x19;
      v33 = v109;
      v35 = sub_2B8A8(&WinMgr.LargeFont, 0, v109, V_ResTree.items[v34].name, 2, v106, 0xFFFFFFFF, 0x82);
      Unknown_48 = V_ResTree.items[v34].Unknown_48;
      v109 = v33 + v35;
      if ( ((1 << V_RaceIndex) & Unknown_48) == 0 )
      {
        v37 = sub_469F0((int)&V_ResTree, V_RaceIndex);
        TurnsToComplete_sub_46C20 = Q_GetTurnsToComplete_sub_46C20(
                                      V_ResTree.items[v34].cost,
                                      (unsigned __int16)word_106FB4[V_RaceIndex],
                                      v37);
        v39 = TurnsToComplete_sub_46C20;
        if ( TurnsToComplete_sub_46C20 == 0xFFFF )
        {
          v40 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7B);// 123: "(No Progress)"
          v41 = 0;
          v42 = 0;
          do
          {
            v43 = v40[2 * v41];
            s[2 * v42] = v43;
            if ( !v43 )
            {
              break;
            }
            v44 = v40[2 * v41 + 1];
            s[2 * v42 + 1] = v44;
            ++v41;
            ++v42;
          }
          while ( v44 );
        }
        else
        {
          if ( TurnsToComplete_sub_46C20 == 1 )
          {
            v45 = 0x1C;                                // 28: ""
          }
          else
          {
            v45 = 0x1D;                                // 29: "s"
          }
          v96 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v45);
          v46 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7C);// 124: "(%d day%s)"
          sprintf(s, v46, v39, v96);
        }
        sub_2B8A8(&WinMgr.LargeFont, 0, v109, s, 2, v106, 0xFFFFFFFF, 0x82);
      }
      v47 = 0x8E;
      for ( a2 = 0; a2 < 0x27; ++a2 )
      {
        if ( V_PlanetItems.item[a2].resReq == (unsigned __int16)shape_number )
        {
          if ( v47 == 0x8E )
          {
            v81 = v106;
            v48 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7D);// 125: "Allows"
            v47 = sub_2B8A8(&WinMgr.LargeFont, 0, 0x8E, v48, 2, v81, 0xFFFFFFFF, 0x82) + 0x98;
          }
          name = V_PlanetItems.item[a2].name;
          if ( (_BYTE)a2 == 0x17 )
          {
            name = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7E);// 126: "Ships: Small and Medium Hulls"
          }
          v50 = sub_2B8A8(&WinMgr.LargeFont, 0, v47, name, 2, v106, 0xFFFFFFFF, 0x82) + v47;
          x_scale = (LONG)sub_10000;
          v101.y0 = v50 + 1;
          v51 = word_FFEDC;
          v101.y1 = v50 + 0x48;
          v52 = a2;
          if ( (_BYTE)a2 == 0x17 )
          {
            x_scale = 0x8000;
            v51 = word_FFEBC[V_RaceIndex];
            v52 = 0;
          }
          v53 = v52;
          v54 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, v51);
          Q_GSYSTEM_CPP_sub_2BC40(&v101, v54, v53, &hotX, &hotY);
          v90 = x_scale;
          v82 = x_scale;
          v77 = hotY;
          v74 = hotX;
          v55 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, v51);
          v47 = v50 + 0x48;
          VFX_shape_transform(&v101, v55, v53, v74, v77, V_BigBuffer, 0, v82, v90, 0);
        }
      }
      a2 = 0;
      v56 = 0;
      do
      {
        if ( (unsigned __int8)V_Gizmos[a2].resReq == (unsigned __int16)shape_number )
        {
          if ( v47 == 0x8E )
          {
            v83 = v106;
            v57 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7D);// 125: "Allows"
            v47 = sub_2B8A8(&WinMgr.LargeFont, 0, 0x8E, v57, 2, v83, 0xFFFFFFFF, 0x82) + 0x98;
          }
          v58 = sub_2B8A8(&WinMgr.LargeFont, 0, v47, V_Gizmos[v56].name, 2, v106, 0xFFFFFFFF, 0x82) + v47;
          v101.y0 = v58 + 1;
          v59 = v58 + 0x48;
          v101.y1 = v58 + 0x48;
          v60 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFED8);
          Q_GSYSTEM_CPP_sub_2BC40(&v101, v60, a2, &hotX, &hotY);
          VFX_shape_draw(&v101, v60, a2, hotX, hotY);
          v47 = v59;
        }
        ++a2;
        ++v56;
      }
      while ( a2 < 0x4C );
      if ( (unsigned __int16)shape_number == 0x13 || (unsigned __int16)shape_number == 0x1F )
      {
        if ( v47 == 0x8E )
        {
          v84 = v106;
          v61 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7D);// 125: "Allows"
          v47 = sub_2B8A8(&WinMgr.LargeFont, 0, 0x8E, v61, 2, v84, 0xFFFFFFFF, 0x82) + 0x98;
        }
        v62 = 2;
        v63 = shape_number;
        v64 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7F);// 127: "Large Ship Hull"
        if ( v63 == 0x1F )
        {
          v62 = 3;
          v64 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x80);// 128: "Gigantic Ship Hull"
        }
        v65 = sub_2B8A8(&WinMgr.LargeFont, 0, v47, v64, 2, v106, 0xFFFFFFFF, 0x82) + v47;
        v101.y0 = v65 + 1;
        v66 = word_FFEBC[V_RaceIndex];
        v101.y1 = v65 + 0x48;
        v67 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, v66);
        Q_GSYSTEM_CPP_sub_2BC40(&v101, v67, v62, &hotX, &hotY);
        v78 = hotY;
        v75 = hotX;
        v68 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, v66);
        VFX_shape_transform(&v101, v68, v62, v75, v78, V_BigBuffer, 0, 0x8000, 0x8000, 0);
      }
    }
    dword_106FD0 = 0;
  }
  v69 = dword_106FCC;
  if ( dword_106FCC == 0xFFFFFFFF )
  {
    v100.x0 = 7;
    v100.x1 = 0x1DC;
    v100.y1 = 0x25;
    v100.y0 = 7;
    sub_552CC(&WinMgr, &v100);
    Q_WINMGR_CPP_sub_53E38(&v100, 3, 3, V_RaceIndex);
    v70 = (char *)&unk_92696;
    if ( dword_106FC2 == v69 )
    {
      v70 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x81);  // 129: "(Self Managed)"
    }
    v97 = v70;
    v91 = V_SpecNames[V_Game.races[V_RaceIndex].Unknown_01];
    v71 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x82);    // 130: "%s Knowledge %s"
    sprintf(s, v71, v91, v97);
    v85 = 4 * V_Game.races[V_RaceIndex].Unknown_02 + 0x13;
    WinMgr.LargeFont.pane = v100;
    sub_2B8A8(&WinMgr.LargeFont, 0, 0, s, 3, v85, 0xFF, 0);
    dword_106FCC = 0;
  }
  dword_106FD4 = 0;
}
// 10000: using guessed type void __noreturn sub_10000();
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEBC: using guessed type __int16 word_FFEBC[7];
// 106FB4: using guessed type __int16 word_106FB4[7];
// 106FC2: using guessed type int dword_106FC2;
// 106FCC: using guessed type int dword_106FCC;
// 106FD0: using guessed type int dword_106FD0;
// 106FD4: using guessed type int dword_106FD4;
// 106FDC: using guessed type int dword_106FDC;
// 47ABC: using guessed type char var_150[100];
// 47ABC: using guessed type char s[80];

//----- (00048B14) --------------------------------------------------------
int __fastcall sub_48B14(int a1, unsigned int count, int a3)
{
  void *v5; // edx

  v5 = (void *)(a1 + 0xAB);
  if ( a3 == 0xFFFFFFFF )
  {
    return Q_ReadFile_sub_1BF94((P_FileInfo)count, v5, 0x98u);
  }
  else
  {
    return Q_CFILE_CPP_dos_write_sub_1C098((int *)count, v5, 0x98u);
  }
}

//----- (00048B40) --------------------------------------------------------
void __fastcall __spoils<> Q_Wnd9RWCtor_sub_48B40(P_Wnd9RW a1)
{
  Q_A2Ctor_sub_2C830(&a1->a);
  sub_1B4F0(&a1->Wnd9RW1);
  _wcpp_2_ctor_array_(a1->vectors, 0x64u, &C_Vector3D);
  a1->a.procs = (P_Procs)off_96018;
  sub_46CAC(a1);
}
// 96018: using guessed type int (*off_96018[5])();

//----- (00048B90) --------------------------------------------------------
void __fastcall __spoils<> Q_ShipCtor_sub_48B90(P_Ship pShip)
{
  pShip->Unknown_6C = 0;
  pShip->Unknown_70 = 0;
  pShip->Unknown_74 = 0;
  pShip->Unknown_78 = 0;
  pShip->Unknown_7C = 0;
  pShip->Unknown_80 = 0.0;
  pShip->vector.x = 0.0;
  pShip->vector.y = 0.0;
  pShip->vector.z = 0.0;
  sub_48C5C(pShip, 0);
}

//----- (00048C5C) --------------------------------------------------------
void __fastcall sub_48C5C(P_Ship pShip, char hullSize)
{
  sub_48EAC(pShip);
  sub_49148(pShip, hullSize);
}

//----- (00048C84) --------------------------------------------------------
void Q_SHIP_CPP_LoadGizmosTxt_sub_48C84()
{
  FILE *fp; // esi
  MACRO_VFX_BOOL found; // ecx
  int v2; // ebp
  T_Gizmo *v3; // kr04_4
  int v4; // kr08_4
  int v5; // ebx
  T_Gizmo *v6; // eax
  int zero; // eax
  char buf[200]; // [esp+0h] [ebp-104h] BYREF
  BYTE val1; // [esp+C8h] [ebp-3Ch] BYREF
  int val2; // [esp+CCh] [ebp-38h] BYREF
  int val3; // [esp+D0h] [ebp-34h] BYREF
  int val4; // [esp+D4h] [ebp-30h] BYREF
  int val5; // [esp+D8h] [ebp-2Ch] BYREF
  int val6; // [esp+DCh] [ebp-28h] BYREF
  int val7; // [esp+E0h] [ebp-24h] BYREF
  int val8; // [esp+E4h] [ebp-20h] BYREF
  int val9; // [esp+E8h] [ebp-1Ch] BYREF

  fp = Q_OpenFile_sub_1BB10("gizmos.txt", 0);
  if ( fp )
  {
    found = FALSE;
    do
    {
      fgets(buf, 200, fp);
      if ( buf[0] == '#' )
      {
        found = TRUE;
      }
    }
    while ( found == FALSE );
    v2 = 0;
    v3 = V_Gizmos;
    v4 = 0;
    do
    {
      fscanf(fp, "%s", &v3[v4]);
      v5 = 0;
      v3 = (T_Gizmo *)(strlen(v3[v4].name) + 1);
      if ( (int)&v3[0xFFFFFFFF].generatorPower + 3 > 0 )
      {
        v6 = &v3[v4];
        do
        {
          if ( v6->name[0] == '^' )
          {
            v6->name[0] = ' ';
          }
          ++v5;
          v6 = (T_Gizmo *)((char *)v6 + 1);
        }
        while ( v5 < (int)&v3[0xFFFFFFFF].generatorPower + 3 );
      }
      fscanf(fp, "%d %d %d %d %d %d %d %d %d", &val1, &val2, &val3, &val4, &val5, &val6, &val7, &val8, &val9);
      v3[v4].cat = val1;
      v3[v4].power = val2;
      v3[v4].range = val3;
      v3[v4].level = val4;
      v3[v4].numUses = val5;
      v3[v4].industry = val6;
      v3[v4].special1 = val7;
      v3[v4].special2 = val8;
      v3[v4].resReq = val9;
      fscanf(fp, "%d", &val9);
      v3[v4].flags = 0;
      while ( val9 != 0xFF )
      {
        LOWORD(v5) = v3[v4].flags;
        v5 |= 1 << val9;
        v3[v4].flags = v5;
        fscanf(fp, "%d", &val9);
      }
      v3[v4].generatorPower = 0;
      zero = v3[v4].generatorPower;
      v3[v4].scannerRangePerTurn = zero;
      v3[v4].driveMaxDistance = zero;
      v3[v4].Unknown_5A = zero;
      v3[v4].shieldStrength = zero;
      v3[v4].weaponDamage = zero;
      switch ( v3[v4].cat )
      {
        case ASCEND_GIZMO_CAT_WEAPON:
          v3[v4].weaponDamage = v3[v4].level;
          break;
        case ASCEND_GIZMO_CAT_SHIELD:
          v3[v4].shieldStrength = v3[v4].level;
          break;
        case ASCEND_GIZMO_CAT_DRIVE:
          v3[v4].driveMaxDistance = v3[v4].level;
          break;
        case ASCEND_GIZMO_CAT_SCANNER:
          v3[v4].scannerRangePerTurn = v3[v4].level;
          break;
        case ASCEND_GIZMO_CAT_GENERATOR:
          v3[v4].generatorPower = v3[v4].power;
          break;
        default:
          break;
      }
      ++v2;
      ++v4;
    }
    while ( v2 < 76 );
    fclose(fp);
  }
  else
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\ship.cpp", 0xBE);
  }
}
// 48C84: using guessed type char buf[200];

//----- (00048EAC) --------------------------------------------------------
void __fastcall sub_48EAC(P_Ship pShip)
{
  int i; // kr04_4
  T_Name20 *v2; // ebx
  int v3; // ecx
  _BYTE *v4; // edi
  char *sub_1CEA8; // esi
  char v6; // al
  char v7; // al
  int j; // ebp
  char v9; // dl
  int v10; // esi
  int v11; // ebx
  char v12; // di
  int v13; // kr0C_4
  int v14; // ecx
  char v15; // dl
  int v16; // ebp
  int v17; // esi
  double v18; // st7
  int v19; // ebx
  int v20; // [esp+0h] [ebp-3Ch]
  int v21; // [esp+4h] [ebp-38h]
  int v22; // [esp+10h] [ebp-2Ch]
  char v23; // [esp+14h] [ebp-28h]
  float v24; // [esp+1Ch] [ebp-20h]
  float v25; // [esp+1Ch] [ebp-20h]
  float v26; // [esp+20h] [ebp-1Ch]

  pShip->gizmosNum = 0;
  pShip->Unknown_0 = 0;
  pShip->Unknown_4 = 0;
  pShip->Unknown_8 = 0;
  pShip->Unknown_10 = 0;
  pShip->Unknown_20 = 0;
  pShip->Unknown_24 = 0;
  pShip->Unknown_18 = 0;
  pShip->Unknown_1C = 0;
  pShip->Unknown_30 = 0;
  pShip->Unknown_28 = 0;
  pShip->Unknown_2C = 0;
  pShip->name[0] = 0;
  pShip->raceIndex = 0xFFFF;
  pShip->locationType = 0;
  pShip->Unknown_90 = 0;
  pShip->hullStrength = 1;
  pShip->Unknown_5D = 0;
  pShip->Unknown_5E = 0;
  pShip->Unknown_88 = pShip->Unknown_90;
  pShip->Unknown_98 = pShip->hullStrength;
  for ( i = 0; i != 0x19; ++i )
  {
    pShip->hullCells[i].gizmoIndex = 0xFF;
    pShip->hullCells[i].Unknown_01 = 0;
    pShip->hullCells[i].Unknown_03 = 0;
  }
  if ( !dword_10701C )
  {
    v2 = V_HullNames;
    v3 = 0x83;                                         // 131: "Small"
    do
    {
      v4 = v2;
      sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v3);
      do
      {
        v6 = *sub_1CEA8;
        *v4 = *sub_1CEA8;
        if ( !v6 )
        {
          break;
        }
        v7 = sub_1CEA8[1];
        sub_1CEA8 += 2;
        v4[1] = v7;
        v4 += 2;
      }
      while ( v7 );
      ++v2;
      ++v3;
    }
    while ( v2 != (T_Name20 *)V_HullNames[4] );
    Q_SHIP_CPP_LoadGizmosTxt_sub_48C84();
    word_107018 = 0;
    for ( j = 0; j < 14; ++j )
    {
      v9 = 1;
      v10 = (unsigned __int8)byte_969B8[j];
      v11 = 0;
      if ( byte_969B8[j] )
      {
        v12 = byte_969C8[j];
        do
        {
          if ( ((unsigned __int8)v9 & (unsigned __int8)v12) != 0 )
          {
            ++word_107018;
          }
          ++v11;
          v9 *= 2;
        }
        while ( v11 < v10 );
      }
    }
    v22 = 0;
    v13 = 0;
    do
    {
      v14 = V_HullCells[1];
      v24 = (float)word_107018;
      v21 = 0;
      v25 = v24 / (double)(V_HullCells[1] - 1);
      v20 = 0;
      v26 = v25;
      do
      {
        if ( v14 <= 0 )
        {
          break;
        }
        v15 = 1;
        v16 = (unsigned __int8)byte_969B8[v21];
        v17 = 0;
        if ( byte_969B8[v21] )
        {
          v23 = byte_969C8[v21];
          do
          {
            if ( ((unsigned __int8)v23 & (unsigned __int8)v15) != 0 )
            {
              v18 = v26 + 1.0;
              v19 = v22 + v20;
              v26 = v18;
              if ( v18 < v25 )
              {
                if ( v14 == 1 && v25 + -1.0 < v26 )
                {
                  v14 = 0;
                  byte_106FE0[v19] |= v15;
                }
              }
              else
              {
                --v14;
                v26 = v26 - v25;
                byte_106FE0[v19] |= v15;
              }
            }
            ++v17;
            v15 *= 2;
          }
          while ( v17 < v16 );
        }
        v20 += 4;
        ++v21;
      }
      while ( v21 < 0xE );
      ++v22;
      ++v13;
    }
    while ( v22 < 4 );
    dword_10701C = TRUE;
  }
}
// 107018: using guessed type __int16 word_107018;
// 10701C: using guessed type int dword_10701C;

//----- (00049148) --------------------------------------------------------
void __fastcall sub_49148(P_Ship pShip, char hullSize)
{
  char *v3; // kr00_4
  int v4; // kr04_4
  char *name; // kr08_4
  int v6; // kr0C_4
  char v7; // al
  char v8; // al
  int raceIndex; // edx

  pShip->hullSize = hullSize;
  if ( hullSize >= 4 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\ship.cpp", 0x131);
  }
  pShip->hullCellsNum = V_HullCells[pShip->hullSize + 1];
  if ( !pShip->name[0] || pShip->raceIndex != V_RaceIndex )
  {
    v3 = V_HullNames[pShip->hullSize];
    v4 = 0;
    name = pShip->name;
    v6 = 0;
    do
    {
      v7 = v3[2 * v4];
      name[2 * v6] = v7;
      if ( !v7 )
      {
        break;
      }
      v8 = v3[2 * v4 + 1];
      name[2 * v6 + 1] = v8;
      ++v4;
      ++v6;
    }
    while ( v8 );
  }
  raceIndex = pShip->raceIndex;
  pShip->hullStrength = 10 * (pShip->hullSize + 1);
  pShip->Unknown_14 = 0;
  if ( V_Game.races[raceIndex].ability == ASCEND_RACE_ABILITY_DOUBLE_HULL )
  {
    pShip->hullStrength *= 2;
  }
  pShip->Unknown_98 = pShip->hullStrength;
}

//----- (000492AC) --------------------------------------------------------
unsigned int __fastcall sub_492AC(_DWORD *a1, char a2, int a3)
{
  char v3; // ch

  if ( a3 > *(_DWORD *)((char *)a1 + 0x15A) )
  {
    return 0;
  }
  v3 = *((_BYTE *)a1 + 7 * a3 + 0xAB);
  if ( a2 == v3 )
  {
    return 0;
  }
  if ( v3 == (char)0xFF )
  {
    ++*(_DWORD *)((char *)a1 + 0x15E);
  }
  *((_BYTE *)a1 + 7 * a3 + 0xAB) = a2;
  sub_496E0((P_Ship)a1);
  return 0xFFFFFFFF;
}

//----- (000492F8) --------------------------------------------------------
MACRO_VFX_BOOL __fastcall Q_Ship_RemoveGizmo_sub_492F8(P_Ship pShip, int hullCellIndex)
{
  if ( pShip->hullCells[hullCellIndex].gizmoIndex == 0xFF )
  {
    return FALSE;
  }
  --pShip->gizmosNum;
  pShip->hullCells[hullCellIndex].gizmoIndex = 0xFF;
  sub_496E0(pShip);
  return TRUE;
}

//----- (00049328) --------------------------------------------------------
int __fastcall sub_49328(int a1, char a2)
{
  unsigned int v3; // edi
  int v4; // edx
  int v5; // kr04_4

  v3 = 0xFFFFFFFF;
  v4 = 0;
  v5 = 0;
  if ( *(int *)(a1 + 0x15A) > 0 )
  {
    while ( *(_BYTE *)(a1 + 7 * v5 + 0xAB) == 0xFF || a2 != V_Gizmos[*(char *)(a1 + 7 * v5 + 0xAB)].cat )
    {
      ++v4;
      ++v5;
      if ( v4 >= *(_DWORD *)(a1 + 0x15A) )
      {
        return v3;
      }
    }
    return v4;
  }
  return v3;
}

//----- (0004937C) --------------------------------------------------------
int __fastcall sub_4937C(P_Ship pShip, char gizmoIndex)
{
  unsigned int v4; // esi
  int hullCellsNum; // edx
  int v6; // eax
  int i; // kr04_4

  v4 = 0xFFFFFFFF;
  hullCellsNum = pShip->hullCellsNum;
  v6 = 0;
  if ( hullCellsNum > 0 )
  {
    for ( i = 0; gizmoIndex != pShip->hullCells[i].gizmoIndex; ++i )
    {
      if ( ++v6 >= pShip->hullCellsNum )
      {
        return v4;
      }
    }
    return v6;
  }
  return v4;
}

//----- (000493BC) --------------------------------------------------------
unsigned int __fastcall sub_493BC(P_Ship pShip, char a2)
{
  int gizmosNum; // ebx
  unsigned int result; // eax
  int v5; // edi
  int v6; // esi
  int v7; // kr04_4
  char gizmoIndex; // bl
  char *v9; // kr08_4
  int v10; // kr0C_4
  char *name; // kr10_4
  int v12; // kr14_4
  char v13; // al
  char v14; // al

  if ( a2 != pShip->hullSize )
  {
    gizmosNum = pShip->gizmosNum;
    result = 0;
    if ( V_HullCells[a2 + 1] < gizmosNum )
    {
      return result;
    }
    v5 = 0;
    v6 = 0;
    if ( pShip->hullCellsNum > 0 )
    {
      v7 = 0;
      do
      {
        gizmoIndex = pShip->hullCells[v7].gizmoIndex;
        if ( gizmoIndex != (char)0xFF )
        {
          Q_Ship_RemoveGizmo_sub_492F8(pShip, v6);
          sub_492AC(pShip, gizmoIndex, v5++);
        }
        ++v6;
        ++v7;
      }
      while ( v6 < pShip->hullCellsNum );
    }
    sub_49148(pShip, a2);
    v9 = V_HullNames[pShip->hullSize];
    v10 = 0;
    name = pShip->name;
    v12 = 0;
    do
    {
      v13 = v9[2 * v10];
      name[2 * v12] = v13;
      if ( !v13 )
      {
        break;
      }
      v14 = v9[2 * v10 + 1];
      name[2 * v12 + 1] = v14;
      ++v10;
      ++v12;
    }
    while ( v14 );
    sub_496E0(pShip);
  }
  return 0xFFFFFFFF;
}

//----- (00049494) --------------------------------------------------------
void __fastcall sub_49494(int a1, float *a2)
{
  double v3; // st7
  int v4; // eax
  T_Vector3D v5[2]; // [esp+0h] [ebp-3Ch] BYREF
  float v6; // [esp+18h] [ebp-24h] BYREF
  float v7; // [esp+1Ch] [ebp-20h]
  float v8; // [esp+20h] [ebp-1Ch]
  int v9; // [esp+24h] [ebp-18h]
  T_Vector3D *v10; // [esp+28h] [ebp-14h]

  if ( sub_35BB4((T_Planet *)a2, a1) )
  {
    v4 = sub_4937C((P_Ship)a1, 0x43);
    if ( v4 != 0xFFFFFFFF && *(_WORD *)(a1 + 7 * v4 + 0xAC) )
    {
      *(_DWORD *)(a1 + 0x88) += V_Gizmos[0x43].special1;
      --*(_WORD *)(a1 + 7 * v4 + 0xAC);
    }
    if ( *(_WORD *)(a1 + 0x56) == V_RaceIndex && *(_BYTE *)(a1 + 0x5D) == 3 )
    {
      if ( WinMgr.Unknown_4228 != 0x10 )
      {
        Q_AddGameEvent_sub_55AEC(&WinMgr, ASCEND_EP_16_ENTERED_ORBIT, (void *)a1, *(void **)(a1 + 0x5E));
      }
      *(_BYTE *)(a1 + 0x5D) = 0;
      *(_DWORD *)(a1 + 0x5E) = 0;
    }
  }
  else
  {
    *(_BYTE *)(a1 + 0x58) = 4;
    v6 = (float)(rand() % 0x3E8 - 0x1F4);
    v7 = (float)(rand() % 0x3E8 - 0x1F4);
    v9 = rand() % 0x3E8 - 0x1F4;
    v8 = (float)v9;
    sub_53054(&v6, 250.0);
    memset(&v5[1], 0, sizeof(T_Vector3D));
    v10 = v5;
    v5[1].x = *a2 + v6;
    v5[1].y = a2[1] + v7;
    v3 = a2[2];
    v5[0] = v5[1];
    v5[1].z = v3 + v8;
    sub_496BC((P_Ship)a1, v5);
  }
}

//----- (0004960C) --------------------------------------------------------
unsigned int __fastcall sub_4960C(int a1, int a2)
{
  if ( *(_DWORD *)(a1 + 0xC) + *(_DWORD *)(a1 + 8) <= 0 && V_Game.races[*(__int16 *)(a1 + 0x56)].ability != 0x12
    || (*(_BYTE *)(a2 + 0x23) & 2) != 0 )
  {
    return 0;
  }
  else
  {
    return 0xFFFFFFFF;
  }
}

//----- (00049648) --------------------------------------------------------
unsigned int __fastcall sub_49648(T_Ship *a1, __int16 **a2)
{
  unsigned int result; // eax
  __int16 *pPlanet; // esi

  result = sub_4960C((int)a1, (int)a2);
  if ( result )
  {
    if ( a1->locationType == 3 )
    {
      pPlanet = (__int16 *)&V_Game.stars[a1->pLocation.pPlanet->starIndex];
    }
    else
    {
      pPlanet = (__int16 *)a1->pLocation.pPlanet;
    }
    result = sub_1D538((P_Location)pPlanet, a1);
    a1->locationType = 5;
    a1->vector.x = 0.0;
    a1->pLocation.pPlanet = (P_Planet)a2;
    if ( pPlanet == *a2 )
    {
      a1->vector.y = 1.0;
    }
    else
    {
      a1->vector.y = 0.0;
    }
  }
  return result;
}

//----- (000496BC) --------------------------------------------------------
void __fastcall sub_496BC(P_Ship a1, P_Vector3D pVector)
{
  a1->vector = *pVector;
  sub_53440(&a1->vector);
}

//----- (000496E0) --------------------------------------------------------
void __fastcall sub_496E0(P_Ship pShip)
{
  int Unknown_14; // eax
  int v3; // esi
  int hullCellsNum; // edi
  int v5; // kr04_4
  T_Gizmo *v6; // eax
  char gizmoIndex; // al
  int v8; // [esp+8h] [ebp-20h]
  int v9; // [esp+Ch] [ebp-1Ch]

  pShip->Unknown_0 = 0;
  pShip->Unknown_4 = 0;
  Unknown_14 = pShip->Unknown_14;
  pShip->Unknown_20 = 0;
  pShip->Unknown_24 = 0;
  pShip->Unknown_18 = 0;
  pShip->Unknown_1C = 0;
  pShip->Unknown_28 = 0;
  v3 = 0;
  pShip->Unknown_2C = 0;
  v9 = 0;
  pShip->Unknown_30 = 0;
  v8 = 0;
  hullCellsNum = pShip->hullCellsNum;
  pShip->Unknown_10 = Unknown_14;
  if ( hullCellsNum > 0 )
  {
    v5 = 0;
    do
    {
      if ( pShip->hullCells[v5].gizmoIndex != 0xFF )
      {
        v6 = &V_Gizmos[(char)pShip->hullCells[v5].gizmoIndex];
        pShip->Unknown_0 += v6->weaponDamage;
        pShip->Unknown_4 += v6->shieldStrength;
        pShip->Unknown_10 += v6->driveMaxDistance;
        pShip->Unknown_20 += v6->scannerRangePerTurn;
        pShip->Unknown_18 += v6->generatorPower;
        if ( v6->cat == 2 )
        {
          pShip->Unknown_1C += v6->power;
        }
        gizmoIndex = pShip->hullCells[v5].gizmoIndex;
        switch ( gizmoIndex )
        {
          case 'G':
            pShip->Unknown_28 = 0xFFFFFFFF;
            break;
          case '+':
            ++v9;
            break;
          case ',':
            ++v8;
            break;
          case '*':
            ++pShip->Unknown_24;
            break;
        }
      }
      ++v3;
      ++v5;
    }
    while ( v3 < pShip->hullCellsNum );
  }
  pShip->Unknown_8 = (int)(sqrt((double)v9) * 10.0);
  pShip->Unknown_C = (int)(sqrt((double)v8) * 20.0);
}

//----- (00049828) --------------------------------------------------------
void __fastcall sub_49828(P_Ship pShip)
{
  P_Planet pPlanet; // ecx
  int v3; // edx
  P_Planet pPlanet_; // eax

  if ( pShip->locationType != ASCEND_LOCATION_TYPE_1 && pShip->locationType != ASCEND_LOCATION_TYPE_2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x260);
  }
  if ( !pShip->pLocation.pPlanet )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x261);
  }
  pPlanet = pShip->pLocation.pPlanet;
  if ( pShip->raceIndex != pPlanet->raceIndex )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x265);
  }
  if ( pShip->locationType == ASCEND_LOCATION_TYPE_1 )
  {
    pShip->_dayBuilt = V_Game.day;
    if ( pShip->raceIndex == V_RaceIndex && WinMgr.Unknown_4228 != 0x11 )
    {
      v3 = ASCEND_EP_17_SHIP_COMPLETE;
LABEL_15:
      Q_AddGameEvent_sub_55AEC(&WinMgr, v3, pShip, pPlanet);
    }
  }
  else if ( pShip->raceIndex == V_RaceIndex && WinMgr.Unknown_4228 != 0x11 )
  {
    v3 = ASCEND_EP_18_REFIT_COMPLETE;
    goto LABEL_15;
  }
  pPlanet_ = pShip->pLocation.pPlanet;
  pShip->locationType = ASCEND_LOCATION_TYPE_PLANET;
  sub_1D3E8(&V_Game.stars[pPlanet_->starIndex], pShip, 0);
  sub_49148(pShip, pShip->hullSize);
  sub_4A6AC(pShip);
}

//----- (00049940) --------------------------------------------------------
void __fastcall sub_49940(P_Ship pShip)
{
  P_Planet pPlanet; // esi
  int starIndex; // eax
  T_Star *pStar; // eax
  int word52; // eax

  if ( !pShip->locationType )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\ship.cpp", 0x288);
  }
  switch ( pShip->locationType )
  {
    case ASCEND_LOCATION_TYPE_1:
    case ASCEND_LOCATION_TYPE_2:
      pPlanet = pShip->pLocation.pPlanet;
      if ( pPlanet->word52 >= pPlanet->word1A )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x297);
      }
      if ( Q_PLANET_CPP_GetShip_sub_35A70(pShip->pLocation.pPlanet, pPlanet->word52) != pShip )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x29A);
      }
      starIndex = pPlanet->starIndex;
      pShip->locationType = 4;
      pStar = &V_Game.stars[starIndex];
      pShip->pLocation.pStar = pStar;
      sub_1D538((P_Location)pStar, pShip);
      word52 = pPlanet->word52;
      pPlanet->buildingPlanetItemIndex = 0xFF;
      if ( (unsigned __int16)word52 != 0xFFFF )
      {
        *((_BYTE *)pPlanet->pUnknown_10 + 4 * word52 + 1) = 0xFF;
        pPlanet->word52 = 0xFFFF;
      }
      break;
    case ASCEND_LOCATION_TYPE_PLANET:
      sub_35C38(pShip->pLocation.pPlanet, pShip);
      if ( pShip->locationType != 4 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x2B0);
      }
      goto LABEL_12;
    case ASCEND_LOCATION_TYPE_STAR:
LABEL_12:
      sub_1D538(pShip->pLocation, pShip);
      break;
    default:
      break;
  }
  sub_20720(&V_Game, pShip);
}

//----- (00049A40) --------------------------------------------------------
void __fastcall sub_49A40(int a1, int a2)
{
  __int16 v3; // si
  int v4; // kr00_4
  int v5; // kr04_4

  v3 = 0;
  v4 = a1 + 0xAB;
  v5 = 0;
  while ( v3 < *(_DWORD *)(a1 + 0x15A) )
  {
    if ( *(_BYTE *)(v4 + 7 * v5) != 0xFF && V_Gizmos[*(char *)(v4 + 7 * v5)].cat == 1 && a2 != *(_DWORD *)(v4 + 7 * v5 + 3) )
    {
      sub_49A8C(a1, (char *)(v4 + 7 * v5));
    }
    ++v3;
    ++v5;
  }
}

//----- (00049A8C) --------------------------------------------------------
T_Gizmo *__fastcall sub_49A8C(int a1, char *a2)
{
  T_Gizmo *result; // eax
  int v5; // edi
  int v6; // edx
  int power; // ebx

  if ( *a2 == (char)0xFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x2D3);
  }
  result = &V_Gizmos[*a2];
  if ( (result->flags & 0x20) != 0 )
  {
    if ( *(_DWORD *)(a2 + 3) == 0xFFFFFFFF )
    {
      *(_DWORD *)(a1 + 0x88) += result->power;
      if ( result->cat == 1 )
      {
        result = (T_Gizmo *)result->shieldStrength;
        v5 = *(_DWORD *)(a1 + 0x90) - (_DWORD)result;
        *(_DWORD *)(a1 + 0x90) = v5;
        if ( v5 < 0 )
        {
          *(_DWORD *)(a1 + 0x90) = 0;
        }
      }
      *(_DWORD *)(a2 + 3) = 0;
    }
    else
    {
      v6 = *(_DWORD *)(a1 + 0x88);
      power = result->power;
      if ( v6 >= power )
      {
        *(_DWORD *)(a1 + 0x88) = v6 - power;
        if ( result->cat == 1 )
        {
          result = (T_Gizmo *)result->shieldStrength;
          *(_DWORD *)(a1 + 0x90) += result;
        }
        *(_DWORD *)(a2 + 3) = 0xFFFFFFFF;
      }
    }
  }
  return result;
}

//----- (00049B3C) --------------------------------------------------------
int __fastcall sub_49B3C(P_Ship pShip, int a2)
{
  __int8 Unknown_62; // cl
  int result; // eax

  Unknown_62 = pShip->Unknown_62;
  result = 0;
  if ( Unknown_62 )
  {
    if ( Unknown_62 == 1 )
    {
      result = sub_4A0D0(pShip, a2);
    }
  }
  else
  {
    result = sub_49CC4(pShip, a2);
  }
  pShip->Unknown_84 = result;
  return result;
}

//----- (00049B68) --------------------------------------------------------
int __fastcall sub_49B68(int a1, int a2)
{
  __int16 i; // dx
  bool v5; // zf
  char v6; // al
  float v8; // [esp+8h] [ebp-20h]
  float v9; // [esp+10h] [ebp-18h]

  v9 = -1.0;
  for ( i = 0; i < *(_DWORD *)(a1 + 0x15A); ++i )
  {
    v6 = *(_BYTE *)(a1 + 7 * i + 0xAB);
    v8 = -1.0;
    if ( v6 != (char)0xFF && v6 < 0x4C && (!V_Gizmos[v6].numUses || *(_WORD *)(a1 + 7 * i + 0xAC)) )
    {
      if ( v6 > (char)0xFFFFFFFF && v6 < 9 )
      {
LABEL_35:
        v8 = (double)(0x20 * V_Gizmos[v6].range) * 0.95;
        goto LABEL_25;
      }
      if ( a2 != 1 )
      {
        if ( a2 != 2 || (unsigned __int8)v6 < 0x2Fu )
        {
          goto LABEL_25;
        }
        if ( (unsigned __int8)v6 > 0x2Fu )
        {
          v5 = v6 == 0x46;
          goto LABEL_24;
        }
LABEL_4:
        v8 = (double)(0x20 * V_Gizmos[v6].range) * 0.825;
        goto LABEL_25;
      }
      if ( (unsigned __int8)v6 < 0x30u )
      {
        if ( (unsigned __int8)v6 < 0x25u )
        {
          if ( (unsigned __int8)v6 >= 0x21u && (unsigned __int8)v6 <= 0x23u )
          {
            goto LABEL_35;
          }
        }
        else
        {
          if ( (unsigned __int8)v6 <= 0x26u )
          {
            goto LABEL_35;
          }
          if ( v6 == 0x2F )
          {
            goto LABEL_4;
          }
        }
      }
      else
      {
        if ( (unsigned __int8)v6 <= 0x32u )
        {
          goto LABEL_35;
        }
        if ( (unsigned __int8)v6 < 0x3Du )
        {
          v5 = v6 == 0x36;
LABEL_24:
          if ( v5 )
          {
            goto LABEL_35;
          }
        }
        else
        {
          if ( (unsigned __int8)v6 <= 0x3Du )
          {
            goto LABEL_35;
          }
          if ( (unsigned __int8)v6 >= 0x40u )
          {
            if ( (unsigned __int8)v6 <= 0x40u )
            {
              goto LABEL_35;
            }
            v5 = v6 == 0x42;
            goto LABEL_24;
          }
        }
      }
LABEL_25:
      if ( v8 > (double)v9 )
      {
        v9 = v8;
      }
      continue;
    }
  }
  return (int)v9;
}

//----- (00049CC4) --------------------------------------------------------
int __fastcall sub_49CC4(P_Ship pShip, int a2)
{
  __int8 Unknown_67; // dh
  int v5; // ebx
  int *Unknown_68; // edx
  int *v7; // edx
  int v8; // edx
  double v9; // st7
  double z; // st7
  int v11; // eax
  double v12; // st6
  __int8 v13; // dl
  int v15[6]; // [esp+8h] [ebp-C0h] BYREF
  int v16[3]; // [esp+20h] [ebp-A8h] BYREF
  int Unknown_6C; // [esp+2Ch] [ebp-9Ch]
  float v18; // [esp+30h] [ebp-98h]
  float v19; // [esp+34h] [ebp-94h]
  T_Vector3D v20; // [esp+38h] [ebp-90h]
  T_Vector3D v21; // [esp+44h] [ebp-84h] BYREF
  T_Vector3D v22; // [esp+50h] [ebp-78h] BYREF
  int v23; // [esp+5Ch] [ebp-6Ch]
  float v24; // [esp+60h] [ebp-68h]
  float v25; // [esp+64h] [ebp-64h]
  float v26; // [esp+68h] [ebp-60h]
  int v27; // [esp+6Ch] [ebp-5Ch]
  int v28; // [esp+70h] [ebp-58h]
  float v29; // [esp+74h] [ebp-54h]
  int v30; // [esp+78h] [ebp-50h]
  int v31; // [esp+7Ch] [ebp-4Ch]
  int v32; // [esp+80h] [ebp-48h] BYREF
  int v33; // [esp+84h] [ebp-44h]
  float v34; // [esp+88h] [ebp-40h]
  int *v35; // [esp+8Ch] [ebp-3Ch]
  int *v36; // [esp+90h] [ebp-38h]
  T_Vector3D *v37; // [esp+94h] [ebp-34h]
  T_Vector3D *v38; // [esp+98h] [ebp-30h]
  int *v39; // [esp+9Ch] [ebp-2Ch]
  float v40; // [esp+A4h] [ebp-24h]
  float Unknown_94; // [esp+A8h] [ebp-20h]
  int Unknown_88; // [esp+ACh] [ebp-1Ch]
  float v43; // [esp+B0h] [ebp-18h]

  if ( pShip->locationType != ASCEND_LOCATION_TYPE_STAR )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x370);
  }
  *(float *)&Unknown_6C = 0.0;
  v18 = 0.0;
  v19 = 0.0;
  Unknown_67 = pShip->Unknown_67;
  v5 = 1;
  switch ( Unknown_67 )
  {
    case 3:
      Unknown_6C = pShip->Unknown_6C;
      v18 = *(float *)&pShip->Unknown_70;
      v19 = *(float *)&pShip->Unknown_74;
      break;
    case 1:
      Unknown_68 = (int *)pShip->Unknown_68;
      Unknown_6C = *Unknown_68;
      v18 = *((float *)Unknown_68 + 1);
      v19 = *((float *)Unknown_68 + 2);
      break;
    case 2:
      v7 = (int *)pShip->Unknown_68;
      Unknown_6C = v7[5];
      v18 = *((float *)v7 + 6);
      v19 = *((float *)v7 + 7);
      v8 = pShip->Unknown_68;
      if ( pShip->pLocation.pStar == *(P_Star *)v8 )
      {
        Unknown_6C = *(int *)(v8 + 8);
        v18 = *(float *)(v8 + 0xC);
        v19 = *(float *)(v8 + 0x10);
      }
      break;
    default:
      v5 = 0;
      break;
  }
  if ( (v5 & 1) != 0 )
  {
    v38 = &v21;
    memset(&v15[3], 0, 0xC);
    *(float *)&v15[3] = *(float *)&Unknown_6C - pShip->vector.x;
    *(float *)&v15[4] = v18 - pShip->vector.y;
    *(float *)&v15[5] = v19 - pShip->vector.z;
    v21 = *(T_Vector3D *)&v15[3];
    v43 = sqrt(*(float *)&v15[4] * *(float *)&v15[4] + *(float *)&v15[3] * *(float *)&v15[3] + *(float *)&v15[5] * *(float *)&v15[5])
        * 0.0062500001;
    Unknown_94 = (float)pShip->Unknown_94;
    v40 = v43;
    if ( v43 > (double)Unknown_94 )
    {
      v43 = Unknown_94;
    }
    Unknown_88 = (int)((double)pShip->Unknown_1C * (v43 + 1.0) / (double)pShip->Unknown_10);
    if ( Unknown_88 < 1 )
    {
      Unknown_88 = 1;
    }
    if ( Unknown_88 > pShip->Unknown_88 )
    {
      v9 = (double)pShip->Unknown_88 * v43 / (double)Unknown_88;
      Unknown_88 = pShip->Unknown_88;
      v43 = v9;
    }
    if ( v43 == v40 )
    {
      LOBYTE(v5) = v5 | 8;
    }
    Q_NormVector3D_sub_53000(&v21);
    v35 = v15;
    v29 = v21.x * v43;
    *(float *)v15 = v29;
    *(float *)&v30 = v21.y * v43;
    v15[1] = v30;
    *(float *)&v31 = v43 * v21.z;
    v15[2] = v31;
    v26 = v29 * 32.0;
    v36 = v16;
    *(float *)&v27 = *(float *)&v30 * 32.0;
    *(float *)v16 = v26;
    *(float *)&v28 = 32.0 * *(float *)&v31;
    v16[1] = v27;
    v16[2] = v28;
    v20.x = v26 * 5.0;
    v37 = &v22;
    v20.y = *(float *)&v27 * 5.0;
    v22 = v20;
    v20.z = 5.0 * *(float *)&v28;
    v21 = v20;
    *(float *)&v23 = 0.0;
    v24 = 0.0;
    v25 = 0.0;
    v39 = &v32;
    *(float *)&v23 = pShip->vector.x + v20.x;
    v24 = pShip->vector.y + v20.y;
    z = pShip->vector.z;
    v32 = v23;
    v25 = z + v20.z;
    v33 = LODWORD(v24);
    v34 = v25;
    pShip->Unknown_78 = v23;
    pShip->Unknown_7C = v33;
    pShip->Unknown_80 = v34;
    sub_53440((T_Vector3D *)&pShip->Unknown_78);
    if ( a2 == 1 )
    {
      v11 = Unknown_88;
      pShip->vector = *(T_Vector3D *)&pShip->Unknown_78;
      v12 = (double)pShip->Unknown_94 - v43;
      pShip->Unknown_88 -= v11;
      pShip->Unknown_94 = (int)v12;
      if ( (v5 & 8) != 0 )
      {
        v13 = pShip->Unknown_67;
        if ( v13 == 1 )
        {
          sub_49494((int)pShip, (float *)pShip->Unknown_68);
        }
        else if ( v13 == 2 )
        {
          sub_49648(pShip, (__int16 **)pShip->Unknown_68);
        }
      }
    }
  }
  return v5;
}

//----- (0004A0D0) --------------------------------------------------------
int __fastcall sub_4A0D0(P_Ship pShip, int a2)
{
  P_HullCell pHullCell; // ecx
  unsigned int v3; // esi
  int v4; // ebx
  __int8 Unknown_67; // cl

  pHullCell = pShip->pHullCell;
  v3 = 0xFFFFFFFF;
  v4 = 0;
  if ( V_Gizmos[(char)pHullCell->gizmoIndex].numUses )
  {
    if ( pHullCell->Unknown_01 )
    {
      if ( a2 == 1 )
      {
        --pHullCell->Unknown_01;
      }
    }
    else
    {
      v3 = 0;
    }
  }
  if ( v3 == 0xFFFFFFFF )
  {
    Unknown_67 = pShip->Unknown_67;
    switch ( Unknown_67 )
    {
      case 0:
        return sub_4B944(pShip, a2);
      case 2:
        return sub_4CAB8(pShip, a2);
      case 1:
        return sub_4C7FC(pShip, a2);
      case 5:
        return sub_4CDF8(pShip, a2);
    }
  }
  return v4;
}

//----- (0004A144) --------------------------------------------------------
int __fastcall Q_ShipGetGizmosCost_sub_4A144(P_Ship pShip)
{
  int cost; // ebx
  unsigned __int16 i; // ax

  cost = 0;
  for ( i = 0; i < pShip->hullCellsNum; ++i )
  {
    if ( pShip->hullCells[i].gizmoIndex != 0xFF )
    {
      cost += V_Gizmos[(char)pShip->hullCells[i].gizmoIndex].industry;
    }
  }
  return cost;
}

//----- (0004A18C) --------------------------------------------------------
int __fastcall sub_4A18C(P_Ship pShip)
{
  int v1; // edx
  int v3[7]; // [esp+0h] [ebp-1Ch]

  v3[0] = dword_969D8[0];
  v3[1] = dword_969D8[1];
  v3[2] = dword_969D8[2];
  v3[3] = dword_969D8[3];
  v1 = v3[pShip->hullSize];
  return v1 + Q_ShipGetGizmosCost_sub_4A144(pShip);
}
// 969D8: using guessed type _DWORD dword_969D8[4];
// 4A18C: using guessed type int var_1C[7];

//----- (0004A1CC) --------------------------------------------------------
int __fastcall sub_4A1CC(T_Ship *a1, __int16 a2)
{
  int v3; // ecx
  int v4; // edi
  unsigned __int16 i; // dx
  int level; // eax
  int v7; // ebp
  char v10; // [esp+6h] [ebp-28h]
  char v11; // [esp+Ah] [ebp-24h]
  char v12; // [esp+Eh] [ebp-20h]
  char v13; // [esp+12h] [ebp-1Ch]
  char v14; // [esp+16h] [ebp-18h]

  if ( a2 < 0 || a2 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x408);
  }
  v10 = sub_4A36C(a1, 0, a2);
  v11 = sub_4A36C(a1, 4, a2);
  v14 = sub_4A36C(a1, 2, a2);
  v3 = 0;
  v13 = sub_4A36C(a1, 1, a2);
  v12 = 0x2B;
  v4 = 0;
  if ( sub_4A404((int)a1, 0x2C) )
  {
    v12 = 0x2C;
  }
  for ( i = 0; i < a1->hullCellsNum; ++i )
  {
    if ( a1->hullCells[i].gizmoIndex != 0xFF )
    {
      level = 0xFFFFFFFF;
      switch ( V_Gizmos[i].cat )
      {
        case 0:
          level = V_Gizmos[v10].level;
          break;
        case 1:
          level = V_Gizmos[v13].level;
          break;
        case 2:
          level = V_Gizmos[v14].level;
          break;
        case 4:
          level = V_Gizmos[v11].level;
          break;
        default:
          break;
      }
      if ( a1->hullCells[i].gizmoIndex == 0x2B && v12 == 0x2C )
      {
        ++v4;
        ++v3;
      }
      else if ( level != 0xFFFFFFFF )
      {
        v7 = V_Gizmos[(char)a1->hullCells[i].gizmoIndex].level;
        ++v4;
        if ( level > v7 )
        {
          v3 += level - v7;
        }
      }
    }
  }
  if ( v4 <= 0 )
  {
    return 0;
  }
  else
  {
    return 0xA * v3 / v4;
  }
}

//----- (0004A36C) --------------------------------------------------------
char __fastcall sub_4A36C(P_Ship a1, char a2, WORD raceIndex)
{
  char raceIndex_; // di
  __int16 level; // bx
  __int16 i; // ax
  char v7; // [esp+4h] [ebp-14h]

  raceIndex_ = raceIndex;
  if ( raceIndex < 0 || raceIndex >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x45F);
  }
  level = 0;
  v7 = 0xFF;
  for ( i = 0; i < 76; ++i )
  {
    if ( V_Gizmos[i].cat == a2
      && ((1 << raceIndex_) & V_ResTree.items[(unsigned __int8)V_Gizmos[i].resReq].Unknown_48) != 0
      && level <= V_Gizmos[i].level )
    {
      v7 = i;
      level = V_Gizmos[i].level;
    }
  }
  return v7;
}

//----- (0004A404) --------------------------------------------------------
int __fastcall sub_4A404(int a1, char a2)
{
  if ( V_Game.racesNum <= *(__int16 *)(a1 + 0x56) || *(__int16 *)(a1 + 0x56) < 0 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x476);
  }
  return (((1 << *(_WORD *)(a1 + 0x56)) & V_ResTree.items[(unsigned __int8)V_Gizmos[a2].resReq].Unknown_48) == 0) - 1;
}

//----- (0004A480) --------------------------------------------------------
P_HullCell __fastcall sub_4A480(P_Ship pShip, unsigned __int16 a2, int a3)
{
  T_HullCell *hullCells; // ecx
  T_HullCell *v6; // edi
  __int16 i; // bx
  int j; // kr04_4

  if ( !pShip->Unknown_88 )
  {
    return 0;
  }
  hullCells = pShip->hullCells;
  pShip->Unknown_62 = 1;
  v6 = 0;
  if ( a2 )
  {
    if ( a2 <= 2u )
    {
      pShip->Unknown_67 = 1;
      pShip->Unknown_68 = a3;
    }
    else
    {
      if ( a2 != 3 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x4A3);
      }
      pShip->Unknown_67 = 0;
      pShip->Unknown_68 = a3;
    }
  }
  else
  {
    pShip->Unknown_67 = 2;
    pShip->Unknown_68 = a3;
  }
  i = 0;
  j = 0;
  while ( i < pShip->hullCellsNum )
  {
    if ( hullCells[j].gizmoIndex != 0xFF
      && (!V_Gizmos[(char)hullCells[j].gizmoIndex].cat || pShip->Unknown_67 == 1 && hullCells[j].gizmoIndex == 0x46) )
    {
      pShip->pHullCell = &hullCells[j];
      if ( (sub_49B3C(pShip, 0) & 1) != 0 )
      {
        return hullCells;
      }
    }
    ++i;
    ++j;
  }
  return v6;
}

//----- (0004A534) --------------------------------------------------------
MACRO_VFX_BOOL __fastcall Q_ShipHasGizmo_sub_4A534(P_Ship pShip, BYTE a2)
{
  __int16 i; // ax

  for ( i = 0; i < pShip->hullCellsNum; ++i )
  {
    if ( a2 == pShip->hullCells[i].gizmoIndex )
    {
      return TRUE;
    }
  }
  return FALSE;
}

//----- (0004A564) --------------------------------------------------------
unsigned int __fastcall sub_4A564(int a1)
{
  __int16 i; // ax

  for ( i = 0; i < *(_DWORD *)(a1 + 0x15A); ++i )
  {
    if ( !V_Gizmos[*(char *)(a1 + 7 * i + 0xAB)].cat && (!V_Gizmos[*(char *)(a1 + 7 * i + 0xAB)].numUses || *(_WORD *)(a1 + 7 * i + 0xAC)) )
    {
      return 0xFFFFFFFF;
    }
  }
  return 0;
}

//----- (0004A5B8) --------------------------------------------------------
void __fastcall sub_4A5B8(P_Ship pShip)
{
  int Unknown_10; // edx
  T_HullCell *hullCells; // ebx
  int v3; // esi
  int v4; // kr04_4
  T_Gizmo *v5; // edx
  int Unknown_88; // ecx
  int power; // edi

  if ( (pShip->Unknown_9C & 1) != 0 )
  {
    pShip->Unknown_94 = 0;
  }
  else
  {
    if ( (pShip->Unknown_9C & 2) != 0 )
    {
      Unknown_10 = V_Gizmos[0x3F].special1 + pShip->Unknown_10;
    }
    else
    {
      Unknown_10 = pShip->Unknown_10;
    }
    pShip->Unknown_94 = Unknown_10;
  }
  pShip->Unknown_90 = 0;
  v3 = 0;
  if ( pShip->hullCellsNum > 0 )
  {
    hullCells = pShip->hullCells;
    v4 = 0;
    do
    {
      if ( hullCells[v4].gizmoIndex != 0xFF )
      {
        v5 = &V_Gizmos[(char)hullCells[v4].gizmoIndex];
        if ( (v5->flags & 0x20) != 0 && hullCells[v4].Unknown_03 == 0xFFFFFFFF )
        {
          Unknown_88 = pShip->Unknown_88;
          power = v5->power;
          if ( Unknown_88 >= power )
          {
            pShip->Unknown_88 = Unknown_88 - power;
            if ( v5->cat == 1 )
            {
              pShip->Unknown_90 += v5->shieldStrength;
            }
          }
        }
      }
      ++v3;
      ++v4;
    }
    while ( v3 < pShip->hullCellsNum );
  }
  if ( (pShip->Unknown_9C & 8) != 0 )
  {
    pShip->Unknown_90 = 0;
  }
}

//----- (0004A6AC) --------------------------------------------------------
void __fastcall sub_4A6AC(P_Ship pShip)
{
  int v2; // eax
  int v3; // edx
  int hullCellsNum; // ebx
  T_HullCell *hullCells; // eax
  int v6; // kr04_4
  P_Lane pLane; // edx
  P_Star pStar2; // eax
  P_Star pStar1; // ebx
  double v10; // st7
  int v11; // eax
  double v12; // st7
  P_Star pStar; // edi
  T_Race *pRace; // eax
  float v15; // [esp+8h] [ebp-3Ch]
  int v16; // [esp+Ch] [ebp-38h]
  int v17; // [esp+10h] [ebp-34h]
  int v18[5]; // [esp+14h] [ebp-30h] BYREF
  float v19; // [esp+28h] [ebp-1Ch]
  float v20; // [esp+2Ch] [ebp-18h]

  pShip->Unknown_9C = 0;
  v2 = sub_4A8FC(pShip);
  v3 = 0;
  hullCellsNum = pShip->hullCellsNum;
  pShip->Unknown_88 = v2;
  if ( hullCellsNum > 0 )
  {
    hullCells = pShip->hullCells;
    v6 = 0;
    do
    {
      if ( hullCells[v6].gizmoIndex != 0xFF )
      {
        hullCells[v6].Unknown_01 = V_Gizmos[(char)hullCells[v6].gizmoIndex].numUses;
      }
      ++v3;
      ++v6;
    }
    while ( v3 < pShip->hullCellsNum );
  }
  if ( pShip->locationType == ASCEND_LOCATION_TYPE_LANE )
  {
    pLane = pShip->pLocation.pLane;
    pStar2 = pLane->pStar2;
    pStar1 = pLane->pStar1;
    v18[3] = (int)v18;
    v15 = pStar1->v.x - pStar2->v.x;
    *(float *)&v16 = pStar1->v.y - pStar2->v.y;
    *(float *)&v17 = pStar1->v.z - pStar2->v.z;
    *(float *)v18 = v15;
    v18[1] = v16;
    v18[2] = v17;
    v10 = sqrt(*(float *)&v16 * *(float *)&v16 + v15 * v15 + *(float *)&v17 * *(float *)&v17);
    v11 = pShip->Unknown_C + pShip->Unknown_8;
    v19 = v10;
    v18[4] = v11;
    LOBYTE(pStar1) = pLane->Unknown_20[3];
    v20 = (float)v11;
    if ( ((unsigned __int8)pStar1 & 1) != 0 )
    {
      v20 = v20 * 0.33333334;
    }
    if ( V_Game.races[pShip->raceIndex].ability == 0x12 )
    {
      if ( v20 < 1.0 )
      {
        v20 = 1.0;
      }
      v20 = v20 * 2.0;
    }
    v12 = pShip->vector.x + v20;
    pShip->vector.x = v12;
    if ( v12 > v19 )
    {
      pShip->vector.x = v19;
    }
    if ( pShip->vector.x == v19 )
    {
      if ( (LODWORD(pShip->vector.y) & 0x7FFFFFFF) != 0 )
      {
        pStar = pShip->pLocation.pLane->pStar2;
      }
      else
      {
        pStar = pShip->pLocation.pLane->pStar1;
      }
      pRace = &V_Game.races[V_RaceIndex];
      if ( pShip->raceIndex == V_RaceIndex )
      {
        sub_45A54(pRace, pStar, pShip);
      }
      else if ( ((1 << V_RaceIndex) & (pStar->racesBits | (unsigned __int8)pStar->Unknown_15)) != 0 )
      {
        sub_45D50(pRace, pStar, pShip);
      }
      sub_1D3E8(pStar, pShip, 0);
      if ( pShip->locationType != ASCEND_LOCATION_TYPE_STAR )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x55A);
      }
    }
  }
  sub_4A5B8(pShip);
}

//----- (0004A8CC) --------------------------------------------------------
int __fastcall sub_4A8CC(P_Ship pShip)
{
  int result; // eax

  result = (V_Game.day - pShip->_dayBuilt) / 100;
  if ( result < 0 )
  {
    return 0;
  }
  if ( result > 0xA )
  {
    return 0xA;
  }
  return result;
}

//----- (0004A8FC) --------------------------------------------------------
int __fastcall sub_4A8FC(P_Ship pShip)
{
  int Unknown_18; // [esp+4h] [ebp-Ch]
  float v3; // [esp+8h] [ebp-8h]

  Unknown_18 = pShip->Unknown_18;
  v3 = (double)sub_4A8CC(pShip) * 0.1 + 1.0;
  if ( v3 >= 1.0 )
  {
    if ( v3 > 2.0 )
    {
      v3 = 2.0;
    }
  }
  else
  {
    v3 = 1.0;
  }
  return (int)((double)Unknown_18 * v3);
}

//----- (0004A988) --------------------------------------------------------
int __fastcall sub_4A988(P_Ship pShip)
{
  int v1; // ebx
  int v2; // esi
  int v3; // kr04_4
  T_Gizmo *v4; // edx

  v1 = 0;
  v2 = 0;
  if ( pShip->hullCellsNum > 0 )
  {
    v3 = 0;
    do
    {
      if ( pShip->hullCells[v3].Unknown_01 == 1 && pShip->hullCells[v3].gizmoIndex != 0xFF )
      {
        v4 = &V_Gizmos[(char)pShip->hullCells[v3].gizmoIndex];
        v1 += v4->industry;
        switch ( v4->cat )
        {
          case ASCEND_GIZMO_CAT_WEAPON:
            v1 += v4->range / 5 + 10 * v4->level;
            break;
          case ASCEND_GIZMO_CAT_SHIELD:
            v1 += 5 * v4->level;
            break;
          case ASCEND_GIZMO_CAT_DRIVE:
            v1 += 2 * v4->level;
            break;
          case ASCEND_GIZMO_CAT_SCANNER:
            v1 += v4->level;
            break;
          case ASCEND_GIZMO_CAT_SPECIAL:
            v1 += v4->range / 5 + 5 * v4->level;
            break;
          default:
            break;
        }
      }
      ++v2;
      ++v3;
    }
    while ( v2 < pShip->hullCellsNum );
  }
  return (4 * pShip->hullStrength + 10 * sub_4A8FC(pShip) + v1) / 0xA;
}

//----- (0004AA78) --------------------------------------------------------
int __fastcall sub_4AA78(int a1, int a2)
{
  int v3; // eax

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x5B6);
  }
  if ( *(_BYTE *)(a1 + 0x58) != 4 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x5B7);
  }
  v3 = *(_DWORD *)(a1 + 0x59);
  if ( a2 == v3 )
  {
    return 0;
  }
  *(_BYTE *)(a1 + 0x5D) = 1;
  *(_DWORD *)(a1 + 0x5E) = a2;
  return (unsigned __int8)V_Game.z10000[0x64 * *(__int16 *)(v3 + 4) + *(__int16 *)(a2 + 4)];
}

//----- (0004AAEC) --------------------------------------------------------
int __fastcall sub_4AAEC(int a1, int a2)
{
  int v2; // eax
  int v3; // kr04_4
  P_Ship v4; // eax
  int v5; // esi
  int v6; // ecx
  double v7; // st7
  P_Ship v8; // edx
  T_HullCell *i; // edx
  P_Ship v10; // eax
  int gizmoIndex; // ebx
  int v12; // eax
  int v13; // edi
  float *v14; // esi
  int j; // kr0C_4
  int v16; // eax
  T_Planet *v17; // ebx
  int v18; // eax
  P_Ship v20[107]; // [esp+8h] [ebp-218h] BYREF
  float v21; // [esp+1B4h] [ebp-6Ch]
  float v22; // [esp+1B8h] [ebp-68h]
  float v23; // [esp+1BCh] [ebp-64h]
  float v24; // [esp+1C0h] [ebp-60h]
  float v25; // [esp+1C4h] [ebp-5Ch]
  float v26; // [esp+1C8h] [ebp-58h]
  int v27[3]; // [esp+1CCh] [ebp-54h] BYREF
  int v28[3]; // [esp+1D8h] [ebp-48h] BYREF
  int v29; // [esp+1E4h] [ebp-3Ch]
  int v30; // [esp+1E8h] [ebp-38h]
  int *v31; // [esp+1ECh] [ebp-34h]
  int v32; // [esp+1F0h] [ebp-30h]
  int v33; // [esp+1F4h] [ebp-2Ch]
  int *v34; // [esp+1F8h] [ebp-28h]
  float v35; // [esp+1FCh] [ebp-24h]
  int v36; // [esp+200h] [ebp-20h]
  float *v37; // [esp+204h] [ebp-1Ch]
  float v38; // [esp+208h] [ebp-18h]

  v29 = a1;
  v36 = a2;
  v30 = 0;
  if ( *(_BYTE *)(a1 + 0x58) == 4 )
  {
    v2 = sub_1D794(*(P_Location *)(a1 + 0x59), v20);
    if ( v2 > 0 )
    {
      v32 = 4 * v2;
      v37 = (float *)(v29 + 0x9E);
      v3 = 0;
      while ( 1 )
      {
        v4 = v20[v3];
        if ( v4->raceIndex == v36 && v4->locationType == 4 )
        {
          v5 = 0;
          v31 = v27;
          v21 = 0.0;
          v22 = 0.0;
          v23 = 0.0;
          v21 = *v37 - v4->vector.x;
          v22 = v37[1] - v4->vector.y;
          v23 = v37[2] - v4->vector.z;
          *(float *)v27 = v21;
          *(float *)&v27[1] = v22;
          *(float *)&v27[2] = v23;
          v6 = 0;
          v7 = sqrt(v22 * v22 + v21 * v21 + v23 * v23);
          v8 = v20[v3];
          v38 = v7;
          for ( i = v8->hullCells; ; ++i )
          {
            v10 = v20[v3];
            if ( v6 >= v10->hullCellsNum )
            {
              break;
            }
            if ( i->gizmoIndex != 0xFF )
            {
              gizmoIndex = (char)i->gizmoIndex;
              if ( V_Gizmos[gizmoIndex].cat == 3 )
              {
                v33 = 0x20 * V_Gizmos[(char)i->gizmoIndex].range;
                if ( (double)v33 >= v38 )
                {
                  v5 += V_Gizmos[gizmoIndex].scannerRangePerTurn;
                }
              }
            }
            ++v6;
          }
          if ( v5 > 0 && v5 > 2 * *(_DWORD *)(v29 + 0x24) )
          {
            v12 = sub_4937C(v10, 0x29);
            v30 = 1;
            if ( v12 != 0xFFFFFFFF )
            {
              break;
            }
          }
        }
        ++v3;
        if ( 4 * v3 >= v32 )
        {
          goto LABEL_20;
        }
      }
      v30 = 2;
    }
LABEL_20:
    if ( !v30 )
    {
      v13 = 0;
      v14 = (float *)(v29 + 0x9E);
      for ( j = 0; ; ++j )
      {
        v16 = *(_DWORD *)(v29 + 0x59);
        if ( v13 >= *(__int16 *)(v16 + 0x5A) )
        {
          break;
        }
        v17 = *(T_Planet **)(4 * j + v16 + 0x46);
        if ( v17->raceIndex == v36 )
        {
          v34 = v28;
          v24 = 0.0;
          v25 = 0.0;
          v26 = 0.0;
          v24 = *v14 - v17->v.x;
          v25 = v14[1] - v17->v.y;
          v26 = v14[2] - v17->v.z;
          *(float *)v28 = v24;
          *(float *)&v28[1] = v25;
          *(float *)&v28[2] = v26;
          v35 = sqrt(v25 * v25 + v24 * v24 + v26 * v26);
          v18 = sub_35930(v17, 0x10);
          if ( v18 != 0xFFFF && (*((_WORD *)v17->pUnknown_10 + 2 * v18 + 1) & 1) != 0 && v35 < 1600.0 )
          {
            return 1;
          }
        }
        ++v13;
      }
    }
  }
  return v30;
}
// 4AAEC: using guessed type P_Ship var_218[107];

//----- (0004AE8C) --------------------------------------------------------
void __fastcall Q_ReadWriteShip_sub_4AE8C(P_Ship pShip, P_FileInfo pfi, int read)
{
  UBYTE locationType; // al
  P_Planet pPlanet; // ebp
  P_Lane pLane; // ebp
  T_Ship vShip; // [esp+0h] [ebp-3BCh] BYREF
  T_Ship vShipa; // [esp+164h] [ebp-258h] BYREF
  char v9[105]; // [esp+2C8h] [ebp-F4h] BYREF
  char v10[105]; // [esp+334h] [ebp-88h] BYREF
  T_HullCell *hullCells; // [esp+3A0h] [ebp-1Ch]
  T_Vector3D *p_vector; // [esp+3A4h] [ebp-18h]
  P_FileInfo vfi; // [esp+3A8h] [ebp-14h]

  vfi = pfi;
  hullCells = pShip->hullCells;
  p_vector = &pShip->vector;
  if ( read == TRUE )
  {
    Q_ShipCtor_sub_48B90(&vShipa);
    Q_ReadFile_sub_1BF94(vfi, &vShipa, 0x162u);
    pShip->Unknown_0 = vShipa.Unknown_0;
    pShip->Unknown_4 = vShipa.Unknown_4;
    pShip->Unknown_8 = vShipa.Unknown_8;
    pShip->Unknown_C = vShipa.Unknown_C;
    pShip->Unknown_10 = vShipa.Unknown_10;
    pShip->Unknown_14 = vShipa.Unknown_14;
    pShip->Unknown_18 = vShipa.Unknown_18;
    pShip->Unknown_1C = vShipa.Unknown_1C;
    pShip->Unknown_20 = vShipa.Unknown_20;
    pShip->Unknown_24 = vShipa.Unknown_24;
    pShip->Unknown_28 = vShipa.Unknown_28;
    pShip->Unknown_2C = vShipa.Unknown_2C;
    pShip->Unknown_30 = vShipa.Unknown_30;
    qmemcpy(pShip->name, vShipa.name, sizeof(pShip->name));
    pShip->Unknown_50 = vShipa.Unknown_50;
    pShip->_dayBuilt = vShipa._dayBuilt;
    pShip->raceIndex = vShipa.raceIndex;
    pShip->locationType = vShipa.locationType;
    pShip->pLocation.pPlanet = vShipa.pLocation.pPlanet;
    pShip->Unknown_5D = vShipa.Unknown_5D;
    pShip->Unknown_5E = vShipa.Unknown_5E;
    pShip->Unknown_62 = vShipa.Unknown_62;
    pShip->pHullCell = vShipa.pHullCell;
    pShip->Unknown_67 = vShipa.Unknown_67;
    pShip->Unknown_68 = vShipa.Unknown_68;
    pShip->Unknown_6C = vShipa.Unknown_6C;
    pShip->Unknown_70 = vShipa.Unknown_70;
    pShip->Unknown_74 = vShipa.Unknown_74;
    pShip->Unknown_78 = vShipa.Unknown_78;
    pShip->Unknown_7C = vShipa.Unknown_7C;
    pShip->Unknown_80 = vShipa.Unknown_80;
    pShip->Unknown_84 = vShipa.Unknown_84;
    pShip->Unknown_88 = vShipa.Unknown_88;
    pShip->hullStrength = vShipa.hullStrength;
    pShip->Unknown_90 = vShipa.Unknown_90;
    pShip->Unknown_94 = vShipa.Unknown_94;
    pShip->Unknown_98 = vShipa.Unknown_98;
    pShip->Unknown_9C = vShipa.Unknown_9C;
    *p_vector = vShipa.vector;
    pShip->hullSize = vShipa.hullSize;
    _wcpp_2_assign_array_(sub_4B780);
    pShip->hullCellsNum = vShipa.hullCellsNum;
    pShip->gizmosNum = vShipa.gizmosNum;
    switch ( pShip->Unknown_5D )
    {
      case 0:
      case 7:
        pShip->Unknown_5E = 0;
        break;
      case 1:
        pShip->Unknown_5E = (int)&V_Game.stars[pShip->Unknown_5E];
        break;
      case 2:
      case 3:
        pShip->Unknown_5E = (int)&V_Game.planets[pShip->Unknown_5E];
        break;
      case 4:
      case 5:
      case 6:
        Q_AssertLogBreakExit_sub_261A8(0, "..\\ship.cpp", 0x642);
        break;
      default:
        Q_AssertLogBreakExit_sub_261A8(0, "..\\ship.cpp", 0x647);
        break;
    }
    locationType = pShip->locationType;
    if ( locationType < (unsigned int)ASCEND_LOCATION_TYPE_PLANET )
    {
      if ( !locationType )
      {
LABEL_16:
        qmemcpy(v10, "InVoid", sizeof(v10));
        sub_2620C("Bad m_LocationType: %s", (char)&v10[0xF * pShip->locationType]);
        sub_261B8(0, "..\\ship.cpp", 0x67A);
        return;
      }
    }
    else
    {
      if ( locationType > (unsigned int)ASCEND_LOCATION_TYPE_STAR )
      {
        if ( locationType == ASCEND_LOCATION_TYPE_LANE )
        {
          pShip->pLocation.pLane = &V_Game.lanes[(int)pShip->pLocation.pLane];
          return;
        }
        goto LABEL_16;
      }
      if ( locationType == ASCEND_LOCATION_TYPE_STAR )
      {
        pShip->pLocation.pStar = &V_Game.stars[(int)pShip->pLocation.pStar];
        return;
      }
    }
    pShip->pLocation.pPlanet = &V_Game.planets[(int)pShip->pLocation.pPlanet];
    return;
  }
  vShip.Unknown_0 = pShip->Unknown_0;
  vShip.Unknown_4 = pShip->Unknown_4;
  vShip.Unknown_8 = pShip->Unknown_8;
  vShip.Unknown_C = pShip->Unknown_C;
  vShip.Unknown_10 = pShip->Unknown_10;
  vShip.Unknown_14 = pShip->Unknown_14;
  vShip.Unknown_18 = pShip->Unknown_18;
  vShip.Unknown_1C = pShip->Unknown_1C;
  vShip.Unknown_20 = pShip->Unknown_20;
  vShip.Unknown_24 = pShip->Unknown_24;
  vShip.Unknown_28 = pShip->Unknown_28;
  vShip.Unknown_2C = pShip->Unknown_2C;
  vShip.Unknown_30 = pShip->Unknown_30;
  qmemcpy(vShip.name, pShip->name, 0x6Au);
  vShip.vector = *p_vector;
  vShip.hullSize = pShip->hullSize;
  _wcpp_2_copy_array_(vShip.hullCells, hullCells, 25, &C_HullCell);
  vShip.hullCellsNum = pShip->hullCellsNum;
  vShip.gizmosNum = pShip->gizmosNum;
  switch ( pShip->Unknown_5D )
  {
    case 0:
    case 7:
      break;
    case 1:
      vShip.Unknown_5E = *(__int16 *)(pShip->Unknown_5E + 4);
      break;
    case 2:
    case 3:
      vShip.Unknown_5E = (pShip->Unknown_5E - (int)V_Game.planets) / 0x7B;
      break;
    case 4:
    case 5:
    case 6:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\ship.cpp", 0x6A7);
      break;
    default:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\ship.cpp", 0x6AC);
      break;
  }
  switch ( pShip->locationType )
  {
    case ASCEND_LOCATION_TYPE_1:
    case ASCEND_LOCATION_TYPE_2:
      vShip.pLocation.pPlanet = (P_Planet)(pShip->pLocation.pPlanet - V_Game.planets);
      break;
    case ASCEND_LOCATION_TYPE_PLANET:
      pPlanet = pShip->pLocation.pPlanet;
      if ( !pPlanet )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x6C0);
      }
      vShip.pLocation.pPlanet = (P_Planet)(pPlanet - V_Game.planets);
      break;
    case ASCEND_LOCATION_TYPE_STAR:
      vShip.pLocation.pStar = (P_Star)pShip->pLocation.pStar->index;
      break;
    case ASCEND_LOCATION_TYPE_LANE:
      pLane = pShip->pLocation.pLane;
      if ( !pLane )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x6CF);
      }
      vShip.pLocation.pLane = (P_Lane)(pLane - V_Game.lanes);
      break;
    default:
      qmemcpy(v9, "InVoid", sizeof(v9));
      sub_2620C("Bad m_LocationType: %s", (char)&v9[0xF * pShip->locationType]);
      sub_261B8(0, "..\\ship.cpp", 0x6EE);
      break;
  }
  Q_CFILE_CPP_dos_write_sub_1C098(&vfi->fh, &vShip, 0x162u);
}
// 78B30: using guessed type _DWORD __stdcall _wcpp_2_assign_array_(_DWORD);

//----- (0004B5C0) --------------------------------------------------------
void __fastcall Q_Type17Copy_sub_4B5C0(P_HullCell dst, P_HullCell src)
{
  *dst = *src;
}

//----- (0004B5E0) --------------------------------------------------------
char *__fastcall Q_ShipCopy_sub_4B5E0(P_Ship a1, P_Ship a2)
{
  char *result; // eax

  a1->Unknown_0 = a2->Unknown_0;
  a1->Unknown_4 = a2->Unknown_4;
  a1->Unknown_8 = a2->Unknown_8;
  a1->Unknown_C = a2->Unknown_C;
  a1->Unknown_10 = a2->Unknown_10;
  a1->Unknown_14 = a2->Unknown_14;
  a1->Unknown_18 = a2->Unknown_18;
  a1->Unknown_1C = a2->Unknown_1C;
  a1->Unknown_20 = a2->Unknown_20;
  a1->Unknown_24 = a2->Unknown_24;
  a1->Unknown_28 = a2->Unknown_28;
  a1->Unknown_2C = a2->Unknown_2C;
  a1->Unknown_30 = a2->Unknown_30;
  qmemcpy(a1->name, a2->name, 0x77u);
  result = (char *)_wcpp_2_copy_array_(a1->hullCells, a2->hullCells, 25, &C_HullCell);
  *(_DWORD *)(result + 0xAF) = a2->hullCellsNum;
  *(_DWORD *)&result[0xB3] = a2->gizmosNum;
  return result;
}

//----- (0004B780) --------------------------------------------------------
int __fastcall sub_4B780(int result, int a2)
{
  *(_BYTE *)result = *(_BYTE *)a2;
  *(_WORD *)(result + 1) = *(_WORD *)(a2 + 1);
  *(_DWORD *)(result + 3) = *(_DWORD *)(a2 + 3);
  return result;
}

//----- (0004B7A0) --------------------------------------------------------
int __fastcall sub_4B7A0(int a1, int a2, int a3, __int16 a4)
{
  int v5; // edi
  int v6; // ebp
  int v7; // ebx
  char v8; // dh
  T_Star *v9; // ecx
  int v10; // ebx
  int v11; // ebx
  int v12; // edx
  int v13; // ebx
  int v16; // [esp+Ch] [ebp-14h]

  v16 = 0;
  if ( a4 < 0 || a4 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0x2F);
  }
  if ( *(__int16 *)(a1 + 0x56) < 0 || V_Game.racesNum <= *(__int16 *)(a1 + 0x56) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0x30);
  }
  v5 = a3;
  v6 = 0;
  if ( (*(_WORD *)(a1 + 0x9C) & 0x10) != 0 )
  {
    v5 = 0;
  }
  v7 = *(_DWORD *)(a1 + 0x90);
  if ( v5 > v7 )
  {
    v5 = *(_DWORD *)(a1 + 0x90);
    v6 = a3 - v7;
    LOBYTE(v16) = 2;
  }
  if ( v6 >= *(_DWORD *)(a1 + 0x8C) )
  {
    v6 = *(_DWORD *)(a1 + 0x8C);
    LOBYTE(v16) = v16 | 4;
  }
  if ( a2 == 1 )
  {
    v8 = *(_BYTE *)(a1 + 0x58);
    v9 = 0;
    if ( v8 == 4 )
    {
      v9 = *(T_Star **)(a1 + 0x59);
    }
    else if ( v8 == 3 || v8 == 1 || v8 == 2 )
    {
      v9 = &V_Game.stars[*(__int16 *)(*(_DWORD *)(a1 + 0x59) + 0xC)];
    }
    if ( !v9 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0x53);
    }
    sub_433E0(&V_Game.races[*(__int16 *)(a1 + 0x56)], a4, v9);
    v10 = *(_DWORD *)(a1 + 0x8C) - v6;
    *(_DWORD *)(a1 + 0x90) -= v5;
    *(_DWORD *)(a1 + 0x8C) = v10;
    if ( v10 < 1 )
    {
      v11 = *(_DWORD *)(a1 + 0xA7);
      v12 = *(_DWORD *)(a1 + 0x54);
      sub_49940((P_Ship)a1);
      v13 = v11 >> 0x18;
      if ( v12 >> 0x10 == V_RaceIndex && WinMgr.Unknown_4228 != 0x10 )
      {
        Q_AddGameEvent_sub_55AEC(&WinMgr, ASCEND_EP_SHIPDESTROYED, (void *)v13, v9);
      }
    }
  }
  return v16;
}

//----- (0004B944) --------------------------------------------------------
int __fastcall sub_4B944(P_Ship a1, int a2)
{
  P_HullCell pHullCell; // eax
  unsigned int v4; // ecx
  T_Gizmo *v5; // edi
  int Unknown_68; // esi
  double v7; // st7
  __int16 Unknown_9C; // ax
  BOOL v9; // eax
  int weaponDamage; // ebx
  int v11; // eax
  double v13; // st7
  double v14; // st7
  double v15; // st7
  double v16; // st7
  double z; // st7
  int v18; // eax
  int v19; // kr04_4
  P_Ship v20; // ebx
  double v21; // st7
  double v22; // st7
  double v23; // st7
  P_Ship v24; // ebx
  int special1; // eax
  int v26; // esi
  int v27; // eax
  int v28; // eax
  int v29; // ebp
  float *v30; // ebx
  int v31; // kr0C_4
  char *v32; // ecx
  double v33; // st7
  double v34; // st7
  char *v35; // ecx
  int v36; // ebx
  int v37; // eax
  int v38; // edx
  int v39; // kr14_4
  char v40; // cl
  int v41; // eax
  int v42; // ebp
  int v43; // edx
  int v44; // kr1C_4
  int v45; // eax
  char v46; // ch
  _BYTE *v47; // edx
  int v48; // ebp
  T_Ship *v49; // eax
  int v50; // ebx
  char v51; // bh
  int v52; // edi
  int v53; // ebx
  int v54; // kr20_4
  int v55; // kr24_4
  char v56; // dh
  int v57; // edx
  char v58; // al
  float *v59; // ebx
  T_Vector3D *p_vector; // edx
  char v61; // ch
  float x_4; // [esp+4h] [ebp-524h]
  void *v63[107]; // [esp+8h] [ebp-520h] BYREF
  P_Ship v64[132]; // [esp+1B4h] [ebp-374h] BYREF
  float v65; // [esp+3C4h] [ebp-164h] BYREF
  float v66; // [esp+3C8h] [ebp-160h]
  float v67; // [esp+3CCh] [ebp-15Ch]
  float v68; // [esp+3D0h] [ebp-158h] BYREF
  float v69; // [esp+3D4h] [ebp-154h]
  float v70; // [esp+3D8h] [ebp-150h]
  float v71; // [esp+3DCh] [ebp-14Ch] BYREF
  float v72; // [esp+3E0h] [ebp-148h]
  float v73; // [esp+3E4h] [ebp-144h]
  float v74; // [esp+3E8h] [ebp-140h]
  float v75; // [esp+3ECh] [ebp-13Ch]
  float v76; // [esp+3F0h] [ebp-138h]
  float v77; // [esp+3F4h] [ebp-134h] BYREF
  float v78; // [esp+3F8h] [ebp-130h]
  float v79; // [esp+3FCh] [ebp-12Ch]
  float v80; // [esp+400h] [ebp-128h]
  float v81; // [esp+404h] [ebp-124h]
  float v82; // [esp+408h] [ebp-120h]
  float v83; // [esp+40Ch] [ebp-11Ch] BYREF
  float v84; // [esp+410h] [ebp-118h]
  float v85; // [esp+414h] [ebp-114h]
  float v86; // [esp+418h] [ebp-110h]
  float v87; // [esp+41Ch] [ebp-10Ch]
  float v88; // [esp+420h] [ebp-108h]
  float v89; // [esp+424h] [ebp-104h] BYREF
  float v90; // [esp+428h] [ebp-100h]
  float v91; // [esp+42Ch] [ebp-FCh]
  float v92; // [esp+430h] [ebp-F8h]
  float v93; // [esp+434h] [ebp-F4h]
  float v94; // [esp+438h] [ebp-F0h]
  float v95; // [esp+43Ch] [ebp-ECh]
  float v96; // [esp+440h] [ebp-E8h]
  float v97; // [esp+444h] [ebp-E4h]
  int v98[3]; // [esp+448h] [ebp-E0h] BYREF
  float v99; // [esp+454h] [ebp-D4h]
  float v100; // [esp+458h] [ebp-D0h]
  float v101; // [esp+45Ch] [ebp-CCh]
  float v102; // [esp+460h] [ebp-C8h] BYREF
  float v103; // [esp+464h] [ebp-C4h]
  float v104; // [esp+468h] [ebp-C0h]
  float v105; // [esp+46Ch] [ebp-BCh]
  float v106; // [esp+470h] [ebp-B8h]
  float v107; // [esp+474h] [ebp-B4h]
  float v108; // [esp+478h] [ebp-B0h]
  float v109; // [esp+47Ch] [ebp-ACh]
  float v110; // [esp+480h] [ebp-A8h]
  float v111; // [esp+484h] [ebp-A4h]
  float v112; // [esp+488h] [ebp-A0h]
  float v113; // [esp+48Ch] [ebp-9Ch]
  float v114; // [esp+490h] [ebp-98h] BYREF
  float v115; // [esp+494h] [ebp-94h]
  float v116; // [esp+498h] [ebp-90h]
  float x; // [esp+49Ch] [ebp-8Ch]
  float y; // [esp+4A0h] [ebp-88h]
  float v119; // [esp+4A4h] [ebp-84h]
  int *v120; // [esp+4A8h] [ebp-80h]
  float *v121; // [esp+4ACh] [ebp-7Ch]
  float *v122; // [esp+4B0h] [ebp-78h]
  float *v123; // [esp+4B4h] [ebp-74h]
  float *v124; // [esp+4B8h] [ebp-70h]
  float *v125; // [esp+4BCh] [ebp-6Ch]
  float *v126; // [esp+4C0h] [ebp-68h]
  float *v127; // [esp+4C8h] [ebp-60h]
  float *v128; // [esp+4CCh] [ebp-5Ch]
  int v129; // [esp+4D0h] [ebp-58h]
  int v130; // [esp+4D4h] [ebp-54h]
  int power; // [esp+4D8h] [ebp-50h]
  float v132; // [esp+4DCh] [ebp-4Ch]
  float v133; // [esp+4E0h] [ebp-48h]
  float v134; // [esp+4E4h] [ebp-44h]
  int v135; // [esp+4E8h] [ebp-40h]
  int v136; // [esp+4ECh] [ebp-3Ch]
  int v137; // [esp+4F0h] [ebp-38h]
  float v138; // [esp+4F4h] [ebp-34h]
  float v139; // [esp+4F8h] [ebp-30h]
  float v140; // [esp+4FCh] [ebp-2Ch]
  float v141; // [esp+500h] [ebp-28h]
  int v142; // [esp+508h] [ebp-20h]
  char v143; // [esp+50Ch] [ebp-1Ch]
  char v144; // [esp+510h] [ebp-18h]

  v130 = a2;
  pHullCell = a1->pHullCell;
  v135 = 0;
  v129 = 0xFFFFFFFF;
  v4 = 0xFFFFFFFF;
  LOBYTE(pHullCell) = pHullCell->gizmoIndex;
  power = 0;
  v143 = (char)pHullCell;
  if ( (_BYTE)pHullCell == 0xFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0xA2);
  }
  v5 = &V_Gizmos[v143];
  if ( v5->power > a1->Unknown_88 )
  {
    v129 = 0;
  }
  else
  {
    power = v5->power;
  }
  Unknown_68 = a1->Unknown_68;
  if ( !Unknown_68 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0xAD);
  }
  if ( a1->locationType != 4 || *(_BYTE *)(Unknown_68 + 0x58) != 4 || a1->pLocation.pPlanet != *(P_Planet *)(Unknown_68 + 0x59) )
  {
    goto LABEL_18;
  }
  if ( v5->range )
  {
    v120 = v98;
    v105 = 0.0;
    v106 = 0.0;
    v107 = 0.0;
    v105 = *(float *)(Unknown_68 + 0x9E) - a1->vector.x;
    v106 = *(float *)(Unknown_68 + 0xA2) - a1->vector.y;
    v107 = *(float *)(Unknown_68 + 0xA6) - a1->vector.z;
    *(float *)v98 = v105;
    *(float *)&v98[1] = v106;
    *(float *)&v98[2] = v107;
    v7 = sqrt(v106 * v106 + v105 * v105 + v107 * v107);
    v142 = 0x20 * v5->range;
    Unknown_9C = a1->Unknown_9C;
    v132 = v7;
    v134 = (float)v142;
    if ( (Unknown_9C & 4) != 0 )
    {
      v134 = v134 * 2.0;
    }
    if ( v132 > (double)v134 )
    {
      v4 = 0;
    }
    if ( v143 == 0x2F && v134 * 0.75 > v132 )
    {
LABEL_18:
      v4 = 0;
    }
  }
  v9 = v129 && v4 && (P_Ship)Unknown_68 != a1 && (v5->flags & 1) != 0;
  v135 |= v9;
  if ( (v135 & 1) == 0 )
  {
    return v135;
  }
  a1->Unknown_78 = *(_DWORD *)(Unknown_68 + 0x9E);
  a1->Unknown_7C = *(_DWORD *)(Unknown_68 + 0xA2);
  a1->Unknown_80 = *(float *)(Unknown_68 + 0xA6);
  weaponDamage = 0;
  if ( !v5->cat )
  {
    weaponDamage = v5->weaponDamage;
  }
  if ( v143 == 0x2F )
  {
    weaponDamage = v5->special1;
  }
  if ( weaponDamage )
  {
    v11 = sub_4B7A0(Unknown_68, v130, weaponDamage, a1->raceIndex);
    v135 |= v11;
  }
  else
  {
    LOBYTE(v135) = v135 | 0x10;
  }
  if ( v130 != 1 )
  {
    return v135;
  }
  v57 = a1->Unknown_88 - power;
  v58 = v143;
  a1->Unknown_88 = v57;
  if ( (unsigned __int8)v58 < 0x32u )
  {
    if ( (unsigned __int8)v58 < 0x25u )
    {
      if ( (unsigned __int8)v58 >= 0x22u )
      {
        if ( (unsigned __int8)v58 <= 0x22u )
        {
          *(_DWORD *)(Unknown_68 + 0x52) = V_Game.day;
          return v135;
        }
        else
        {
          if ( v58 == 0x23 )
          {
            *(_DWORD *)(Unknown_68 + 0x88) = 0;
          }
          return v135;
        }
      }
      if ( v58 == 0x21 )
      {
        v56 = *(_BYTE *)(Unknown_68 + 0x9C);
        *(_DWORD *)(Unknown_68 + 0x94) = 0;
        *(_BYTE *)(Unknown_68 + 0x9C) = v56 | 1;
        return v135;
      }
      return v135;
    }
    if ( (unsigned __int8)v58 > 0x25u )
    {
      if ( (unsigned __int8)v58 < 0x2Du )
      {
        if ( v58 != 0x28 )
        {
          return v135;
        }
        v28 = sub_1D794(a1->pLocation, (P_Ship *)v63);
        v29 = 0;
        if ( v28 > 0 )
        {
          v30 = (float *)(Unknown_68 + 0x9E);
          v136 = 4 * v28;
          v31 = 0;
          do
          {
            v32 = (char *)v63[v31];
            if ( (char *)Unknown_68 != v32 )
            {
              v126 = &v83;
              v80 = 0.0;
              v81 = 0.0;
              v82 = 0.0;
              v80 = *(float *)(v32 + 0x9E) - *v30;
              v81 = *(float *)(v32 + 0xA2) - *(float *)(Unknown_68 + 0xA2);
              v82 = *(float *)(v32 + 0xA6) - *(float *)(Unknown_68 + 0xA6);
              v83 = v80;
              v84 = v81;
              v85 = v82;
              v33 = sqrt(v81 * v81 + v80 * v80 + v82 * v82);
              v142 = 0x20 * v5->special1;
              v138 = (float)v142;
              if ( v33 < v138 )
              {
                sub_53054(&v83, v138);
                v92 = 0.0;
                v93 = 0.0;
                v94 = 0.0;
                v124 = &v71;
                v92 = *v30 + v83;
                v93 = *(float *)(Unknown_68 + 0xA2) + v84;
                v34 = *(float *)(Unknown_68 + 0xA6);
                v71 = v92;
                v94 = v34 + v85;
                v72 = v93;
                v35 = (char *)v63[v31];
                v73 = v94;
                *(float *)(v35 + 0x9E) = v92;
                *(float *)(v35 + 0xA2) = v72;
                *(float *)(v35 + 0xA6) = v73;
              }
            }
            ++v29;
            ++v31;
          }
          while ( 4 * v31 < v136 );
        }
      }
      else
      {
        if ( (unsigned __int8)v58 <= 0x2Du )
        {
          v122 = &v65;
          v95 = 0.0;
          v96 = 0.0;
          v97 = 0.0;
          v95 = *(float *)(Unknown_68 + 0x9E) - a1->vector.x;
          v96 = *(float *)(Unknown_68 + 0xA2) - a1->vector.y;
          v13 = *(float *)(Unknown_68 + 0xA6) - a1->vector.z;
          v65 = v95;
          v97 = v13;
          v66 = v96;
          v67 = v97;
          v142 = 0x20 * v5->special1;
          x_4 = (float)v142;
          sub_53054(&v65, x_4);
          v121 = &v77;
          v111 = 0.0;
          v112 = 0.0;
          v113 = 0.0;
          v111 = *(float *)(Unknown_68 + 0x9E) + v65;
          v112 = *(float *)(Unknown_68 + 0xA2) + v66;
          v14 = *(float *)(Unknown_68 + 0xA6) + v67;
          v77 = v111;
          v113 = v14;
          v78 = v112;
          v79 = v113;
          *(float *)(Unknown_68 + 0x9E) = v111;
          *(float *)(Unknown_68 + 0xA2) = v78;
          *(float *)(Unknown_68 + 0xA6) = v79;
          return v135;
        }
        if ( (unsigned __int8)v58 >= 0x30u )
        {
          if ( (unsigned __int8)v58 > 0x30u )
          {
            v61 = *(_BYTE *)(Unknown_68 + 0x9C);
            *(_DWORD *)(Unknown_68 + 0x90) = 0;
            *(_BYTE *)(Unknown_68 + 0x9C) = v61 | 8;
            return v135;
          }
          v52 = *(_DWORD *)(Unknown_68 + 0x15A);
          v53 = 0;
          v54 = Unknown_68 + 0xAB;
          v55 = 0;
          while ( v53 < v52 )
          {
            if ( *(_BYTE *)(v54 + 7 * v55) == 0x47 || *(_BYTE *)(v54 + 7 * v55) == 0x49 )
            {
              Q_Ship_RemoveGizmo_sub_492F8((P_Ship)Unknown_68, v53);
            }
            ++v53;
            v52 = *(_DWORD *)(Unknown_68 + 0x15A);
            ++v55;
          }
        }
      }
      return v135;
    }
LABEL_84:
    v144 = 0;
    if ( v143 == 0x42 )
    {
      v144 = 5;
    }
    v47 = (_BYTE *)(Unknown_68 + 0xAB);
    v48 = 0;
    v49 = 0;
    if ( *(int *)(Unknown_68 + 0x15A) > 0 )
    {
      v50 = 0;
      do
      {
        if ( *v47 != 0xFF && V_Gizmos[(char)*v47].cat == v144 )
        {
          ++v48;
          v64[v50 + 0x6B] = v49;
          ++v50;
        }
        v49 = (T_Ship *)((char *)v49 + 1);
        v47 += 7;
      }
      while ( (int)v49 < *(_DWORD *)(Unknown_68 + 0x15A) );
    }
    if ( v48 )
    {
      Q_Ship_RemoveGizmo_sub_492F8((P_Ship)Unknown_68, (int)v64[V_Game.day % v48 + 0x6B]);
      return v135;
    }
    return v135;
  }
  if ( (unsigned __int8)v58 <= 0x32u )
  {
LABEL_74:
    v40 = 5;
    if ( v143 == 0x32 )
    {
      v40 = 0;
    }
    v42 = 0;
    v43 = 0;
    if ( *(int *)(Unknown_68 + 0x15A) > 0 )
    {
      v41 = Unknown_68 + 0xAB;
      v44 = 0;
      do
      {
        if ( *(_BYTE *)(v41 + 7 * v44) != 0xFF && v40 == V_Gizmos[*(char *)(v41 + 7 * v44)].cat )
        {
          ++v42;
        }
        ++v43;
        ++v44;
      }
      while ( v43 < *(_DWORD *)(Unknown_68 + 0x15A) );
    }
    v45 = *(_DWORD *)(Unknown_68 + 0x8C) - v42;
    *(_DWORD *)(Unknown_68 + 0x8C) = v45;
    if ( v45 < 1 )
    {
      v46 = v135 | 4;
      sub_49940((P_Ship)Unknown_68);
      LOBYTE(v135) = v46;
      return v135;
    }
    return v135;
  }
  v59 = (float *)(Unknown_68 + 0x9E);
  if ( (unsigned __int8)v58 < 0x3Du )
  {
    p_vector = &a1->vector;
    if ( (unsigned __int8)v58 < 0x36u )
    {
      if ( v58 != 0x34 )
      {
        return v135;
      }
      v127 = &v114;
      v74 = 0.0;
      v75 = 0.0;
      v76 = 0.0;
      v74 = *v59 - p_vector->x;
      v75 = *(float *)(Unknown_68 + 0xA2) - a1->vector.y;
      v76 = *(float *)(Unknown_68 + 0xA6) - a1->vector.z;
      v114 = v74;
      v115 = v75;
      v116 = v76;
      v15 = sqrt(v75 * v75 + v74 * v74 + v76 * v76);
      v142 = 0x20 * v5->special1;
      v16 = v15 - (double)v142;
      v133 = v16;
      if ( v16 < 64.0 )
      {
        v133 = 64.0;
      }
      sub_53054(&v114, v133);
      v99 = 0.0;
      v100 = 0.0;
      v101 = 0.0;
      v128 = &v102;
      v99 = a1->vector.x + v114;
      v100 = a1->vector.y + v115;
      z = a1->vector.z;
      v102 = v99;
      v101 = z + v116;
      v103 = v100;
      v104 = v101;
      *(float *)(Unknown_68 + 0x9E) = v99;
      *(float *)(Unknown_68 + 0xA2) = v103;
      *(float *)(Unknown_68 + 0xA6) = v104;
      return v135;
    }
    if ( (unsigned __int8)v58 > 0x36u )
    {
      if ( (unsigned __int8)v58 <= 0x37u )
      {
        x = p_vector->x;
        y = a1->vector.y;
        v119 = a1->vector.z;
        p_vector->x = *v59;
        a1->vector.y = *(float *)(Unknown_68 + 0xA2);
        a1->vector.z = *(float *)(Unknown_68 + 0xA6);
        *v59 = x;
        *(float *)(Unknown_68 + 0xA2) = y;
        *(float *)(Unknown_68 + 0xA6) = v119;
        return v135;
      }
      if ( v58 != 0x3B )
      {
        return v135;
      }
      special1 = *(_DWORD *)(Unknown_68 + 0x98) - *(_DWORD *)(Unknown_68 + 0x8C);
      if ( special1 > v5->special1 )
      {
        special1 = v5->special1;
      }
      *(_DWORD *)(Unknown_68 + 0x8C) += special1;
      v26 = a1->hullStrength - special1;
      a1->hullStrength = v26;
      if ( v26 < 1 )
      {
        sub_49940(a1);
        return v135;
      }
      return v135;
    }
    goto LABEL_74;
  }
  if ( (unsigned __int8)v58 <= 0x3Du )
  {
    sub_49940((P_Ship)Unknown_68);
    v51 = v135 | 4;
    Q_Ship_RemoveGizmo_sub_492F8(a1, a1->pHullCell - a1->hullCells);
    LOBYTE(v135) = v51;
    return v135;
  }
  if ( (unsigned __int8)v58 < 0x42u )
  {
    if ( v58 != 0x40 )
    {
      return v135;
    }
    v36 = *(_DWORD *)(Unknown_68 + 0x15E);
    if ( !v36 )
    {
      return v135;
    }
    v37 = 0;
    v38 = 0;
    if ( *(int *)(Unknown_68 + 0x15A) <= 0 )
    {
      return v135;
    }
    v39 = 0;
    do
    {
      if ( *(_BYTE *)(Unknown_68 + 7 * v39 + 0xAB) != 0xFF )
      {
        if ( v38 == V_Game.day % v36 )
        {
          Q_Ship_RemoveGizmo_sub_492F8((P_Ship)Unknown_68, v37);
          return v135;
        }
        ++v38;
      }
      ++v37;
      ++v39;
    }
    while ( v37 < *(_DWORD *)(Unknown_68 + 0x15A) );
    return v135;
  }
  if ( (unsigned __int8)v58 <= 0x42u )
  {
    goto LABEL_84;
  }
  if ( (unsigned __int8)v58 < 0x44u )
  {
    return v135;
  }
  if ( (unsigned __int8)v58 > 0x44u )
  {
    if ( v58 != 0x4A )
    {
      return v135;
    }
    v18 = sub_1D794(a1->pLocation, v64);
    if ( v18 > 0 )
    {
      v137 = 4 * v18;
      v19 = 0;
      do
      {
        v20 = v64[v19];
        if ( (P_Ship)Unknown_68 != v20 )
        {
          v123 = &v89;
          v108 = 0.0;
          v109 = 0.0;
          v110 = 0.0;
          v108 = v20->vector.x - *(float *)(Unknown_68 + 0x9E);
          v109 = v20->vector.y - *(float *)(Unknown_68 + 0xA2);
          v110 = v20->vector.z - *(float *)(Unknown_68 + 0xA6);
          v89 = v108;
          v90 = v109;
          v91 = v110;
          v21 = sqrt(v109 * v109 + v108 * v108 + v110 * v110);
          v142 = 0x20 * v5->special2;
          v139 = v21;
          v140 = (float)v142;
          if ( v139 > (double)v140 )
          {
            v142 = 0x20 * v5->special1;
            v22 = v139 - (double)v142;
            v141 = v22;
            if ( v22 < v140 )
            {
              v141 = v140;
            }
            sub_53054(&v89, v141);
            v125 = &v68;
            v86 = 0.0;
            v87 = 0.0;
            v88 = 0.0;
            v86 = *(float *)(Unknown_68 + 0x9E) + v89;
            v87 = *(float *)(Unknown_68 + 0xA2) + v90;
            v23 = *(float *)(Unknown_68 + 0xA6);
            v68 = v86;
            v88 = v23 + v91;
            v69 = v87;
            v24 = v64[v19];
            v70 = v88;
            v24->vector.x = v86;
            v24->vector.y = v69;
            v24->vector.z = v70;
          }
        }
        ++v19;
      }
      while ( 4 * v19 < v137 );
    }
    return v135;
  }
  v27 = *(_DWORD *)(Unknown_68 + 0x18) - *(_DWORD *)(Unknown_68 + 0x88);
  if ( v27 > v57 )
  {
    v27 = v57;
  }
  *(_DWORD *)(Unknown_68 + 0x88) += v27;
  a1->Unknown_88 -= v27;
  return v135;
}
// 4B944: using guessed type P_Ship var_520[107];

//----- (0004C7FC) --------------------------------------------------------
int __fastcall sub_4C7FC(P_Ship a1, int a2)
{
  signed __int8 gizmoIndex; // cl
  T_Gizmo *v3; // esi
  unsigned int v4; // edi
  int Unknown_88; // ebp
  int power; // eax
  T_Planet *Unknown_68; // ebp
  P_Ship v8; // edx
  double v9; // st7
  __int16 Unknown_9C; // ax
  BOOL v11; // eax
  _WORD *pUnknown_10; // esi
  int v14; // edi
  int v15; // kr04_4
  float x; // [esp+8h] [ebp-60h]
  float y; // [esp+Ch] [ebp-5Ch]
  float z; // [esp+10h] [ebp-58h]
  int v19[3]; // [esp+14h] [ebp-54h] BYREF
  float v20; // [esp+20h] [ebp-48h]
  float v21; // [esp+24h] [ebp-44h]
  float v22; // [esp+28h] [ebp-40h]
  int *v23; // [esp+2Ch] [ebp-3Ch]
  int v24; // [esp+30h] [ebp-38h]
  int v25; // [esp+34h] [ebp-34h]
  float v26; // [esp+38h] [ebp-30h]
  int v27; // [esp+3Ch] [ebp-2Ch]
  int v28; // [esp+40h] [ebp-28h]
  float v29; // [esp+44h] [ebp-24h]
  int v30; // [esp+48h] [ebp-20h]
  P_Ship v31; // [esp+4Ch] [ebp-1Ch]
  int v32; // [esp+50h] [ebp-18h]

  v31 = a1;
  v25 = a2;
  gizmoIndex = a1->pHullCell->gizmoIndex;
  v30 = 0;
  v27 = 0;
  v3 = &V_Gizmos[gizmoIndex];
  v4 = 0xFFFFFFFF;
  Unknown_88 = a1->Unknown_88;
  power = v3->power;
  v28 = 0xFFFFFFFF;
  if ( power > Unknown_88 )
  {
    v28 = 0;
  }
  else
  {
    v27 = power;
  }
  Unknown_68 = (T_Planet *)v31->Unknown_68;
  if ( !Unknown_68 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0x217);
  }
  x = Unknown_68->v.x;
  y = Unknown_68->v.y;
  v8 = v31;
  z = Unknown_68->v.z;
  v31->Unknown_78 = LODWORD(Unknown_68->v.x);
  *(float *)&v8->Unknown_7C = y;
  v8->Unknown_80 = z;
  if ( v3->range )
  {
    v23 = v19;
    v20 = 0.0;
    v21 = 0.0;
    v22 = 0.0;
    v20 = x - v31->vector.x;
    v21 = y - v31->vector.y;
    v22 = z - v31->vector.z;
    *(float *)v19 = v20;
    *(float *)&v19[1] = v21;
    *(float *)&v19[2] = v22;
    v9 = sqrt(v21 * v21 + v20 * v20 + v22 * v22);
    v24 = 0x20 * v3->range;
    Unknown_9C = v31->Unknown_9C;
    v26 = v9;
    v29 = (float)v24;
    if ( (Unknown_9C & 4) != 0 )
    {
      v29 = v29 * 2.0;
    }
    if ( v26 > (double)v29 )
    {
      v4 = 0;
    }
    if ( gizmoIndex == 0x2F && v29 * 0.75 > v26 )
    {
      v4 = 0;
    }
  }
  v11 = v28 && v4 && (v3->flags & 0xC) != 0;
  v30 |= v11;
  if ( (v30 & 1) == 0 || v25 != 1 )
  {
    return v30;
  }
  v31->Unknown_88 -= v27;
  if ( !v3->cat )
  {
    sub_36A5C(Unknown_68, v3->weaponDamage, v31->raceIndex);
    return v30;
  }
  if ( gizmoIndex != 0x46 )
  {
    return v30;
  }
  pUnknown_10 = Unknown_68->pUnknown_10;
  v14 = 0;
  v32 = 0;
  v15 = 0;
  while ( v14 < Unknown_68->word18 && v32 < 5 )
  {
    if ( LOBYTE(pUnknown_10[2 * v15]) != 0xFF
      && (pUnknown_10[2 * v15 + 1] & 1) != 0
      && !V_PlanetItems.item[HIBYTE(pUnknown_10[2 * v15])].mpop
      && sub_34B0C(Unknown_68, (unsigned __int16)v14, 0xFFu, 1u) == 0xFFFFFFFF )
    {
      ++v32;
    }
    ++v14;
    ++v15;
  }
  Q_Ship_RemoveGizmo_sub_492F8(v31, v31->pHullCell - v31->hullCells);
  return v30;
}

//----- (0004CAB8) --------------------------------------------------------
int __fastcall sub_4CAB8(P_Ship a1, int a2)
{
  signed __int8 gizmoIndex; // cl
  T_Gizmo *v4; // ebp
  int Unknown_88; // edx
  int power; // eax
  int Unknown_68; // esi
  double v8; // st7
  int range; // eax
  BOOL v10; // eax
  float *v12; // eax
  float *v13; // edx
  float *v14; // eax
  int v15; // ebx
  int v16; // edx
  int v17; // kr04_4
  T_Star *v18; // ecx
  int v19[3]; // [esp+8h] [ebp-78h] BYREF
  int v20[3]; // [esp+14h] [ebp-6Ch] BYREF
  float v21; // [esp+20h] [ebp-60h]
  float v22; // [esp+24h] [ebp-5Ch]
  float v23; // [esp+28h] [ebp-58h]
  float v24; // [esp+2Ch] [ebp-54h]
  float v25; // [esp+30h] [ebp-50h]
  float v26; // [esp+34h] [ebp-4Ch]
  int v27; // [esp+38h] [ebp-48h]
  int v28; // [esp+3Ch] [ebp-44h]
  float v29; // [esp+40h] [ebp-40h]
  int *v30; // [esp+44h] [ebp-3Ch]
  int v31; // [esp+48h] [ebp-38h]
  int *v32; // [esp+4Ch] [ebp-34h]
  float v33; // [esp+50h] [ebp-30h]
  int v34; // [esp+54h] [ebp-2Ch]
  int v35; // [esp+58h] [ebp-28h]
  int v36; // [esp+5Ch] [ebp-24h]
  int v37; // [esp+60h] [ebp-20h]
  int v38; // [esp+64h] [ebp-1Ch]
  float v39; // [esp+68h] [ebp-18h]

  v34 = a2;
  gizmoIndex = a1->pHullCell->gizmoIndex;
  v38 = 0;
  v37 = 0xFFFFFFFF;
  v4 = &V_Gizmos[gizmoIndex];
  v35 = 0;
  Unknown_88 = a1->Unknown_88;
  power = v4->power;
  v36 = 0xFFFFFFFF;
  if ( power > Unknown_88 )
  {
    v36 = 0;
  }
  else
  {
    v35 = power;
  }
  Unknown_68 = a1->Unknown_68;
  if ( !Unknown_68 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0x275);
  }
  v27 = *(int *)(Unknown_68 + 0x14);
  v28 = *(int *)(Unknown_68 + 0x18);
  v29 = *(float *)(Unknown_68 + 0x1C);
  if ( *(P_Planet *)Unknown_68 == a1->pLocation.pPlanet )
  {
    v27 = *(int *)(Unknown_68 + 8);
    v28 = *(int *)(Unknown_68 + 0xC);
    v29 = *(float *)(Unknown_68 + 0x10);
  }
  a1->Unknown_78 = v27;
  a1->Unknown_7C = v28;
  a1->Unknown_80 = v29;
  v24 = 0.0;
  v25 = 0.0;
  v26 = 0.0;
  v30 = v19;
  v24 = *(float *)&v27 - a1->vector.x;
  v25 = *(float *)&v28 - a1->vector.y;
  v26 = v29 - a1->vector.z;
  *(float *)v19 = v24;
  *(float *)&v19[1] = v25;
  *(float *)&v19[2] = v26;
  v8 = sqrt(v25 * v25 + v24 * v24 + v26 * v26);
  range = v4->range;
  v33 = v8;
  if ( range )
  {
    v31 = 0x20 * range;
    if ( (double)(0x20 * range) < v33 )
    {
      v37 = 0;
    }
  }
  v10 = v36 && v37 && (v4->flags & 2) != 0;
  v38 |= v10;
  if ( v34 != 1 || (v38 & 1) == 0 )
  {
    return v38;
  }
  a1->Unknown_88 -= v35;
  if ( !v4->cat && v4->weaponDamage > 1 )
  {
    *(_BYTE *)(Unknown_68 + 0x23) &= ~2u;
    return v38;
  }
  if ( (unsigned __int8)gizmoIndex < 0x33u )
  {
    if ( gizmoIndex == 0x20 )
    {
      *(_BYTE *)(Unknown_68 + 0x23) |= 2u;
      return v38;
    }
    return v38;
  }
  if ( (unsigned __int8)gizmoIndex <= 0x33u )
  {
    v13 = *(float **)(Unknown_68 + 4);
    v14 = *(float **)Unknown_68;
    v32 = v20;
    v15 = 0;
    v21 = 0.0;
    v22 = 0.0;
    v23 = 0.0;
    v21 = v14[2] - v13[2];
    v22 = v14[3] - v13[3];
    v23 = v14[4] - v13[4];
    *(float *)v20 = v21;
    *(float *)&v20[1] = v22;
    *(float *)&v20[2] = v23;
    v16 = 0;
    v39 = sqrt(v22 * v22 + v21 * v21 + v23 * v23);
    v17 = 0;
    do
    {
      if ( v16 >= V_Game.shipsNum )
      {
        break;
      }
      if ( V_Game.ships[v17].raceIndex != 0xFFFFFFFF )
      {
        if ( V_Game.ships[v17].locationType == 5 && (P_Planet)Unknown_68 == V_Game.ships[v17].pLocation.pPlanet )
        {
          V_Game.ships[v17].vector.x = v39;
        }
        ++v16;
      }
      ++v15;
      ++v17;
    }
    while ( v15 < 0x6B );
    goto LABEL_37;
  }
  if ( (unsigned __int8)gizmoIndex < 0x3Cu )
  {
    return v38;
  }
  if ( (unsigned __int8)gizmoIndex <= 0x3Cu )
  {
    v18 = *(T_Star **)Unknown_68;
    if ( *(P_Planet *)Unknown_68 == a1->pLocation.pPlanet )
    {
      v18 = *(T_Star **)(Unknown_68 + 4);
    }
    sub_1D538(a1->pLocation, a1);
    a1->locationType = 5;
    a1->pLocation.pPlanet = (P_Planet)Unknown_68;
    sub_1D3E8(v18, a1, 0);
LABEL_37:
    Q_Ship_RemoveGizmo_sub_492F8(a1, a1->pHullCell - a1->hullCells);
    return v38;
  }
  if ( gizmoIndex != 0x3E )
  {
    return v38;
  }
  v12 = *(float **)Unknown_68;
  if ( *(P_Planet *)Unknown_68 == a1->pLocation.pPlanet )
  {
    v12 = *(float **)(Unknown_68 + 4);
  }
  *((_BYTE *)v12 + 0x17) |= 1 << LOBYTE(a1->raceIndex);
  return v38;
}

//----- (0004CDF8) --------------------------------------------------------
int __fastcall sub_4CDF8(P_Ship a1, int a2)
{
  P_HullCell pHullCell; // ecx
  int power; // ebp
  signed __int8 gizmoIndex; // cl
  T_Gizmo *v6; // edi
  double v8; // st7
  int v9; // eax
  int v10; // ebx
  int v11; // kr04_4
  char *v12; // eax
  double v13; // st7
  double v14; // st7
  int v15; // edi
  int Unknown_98; // ebp
  T_Star *star; // eax
  int v18; // eax
  int v19; // kr0C_4
  T_Ship *v20; // edx
  double v21; // st7
  P_HullCell v22; // edx
  int hullStrength; // ecx
  int v24; // edx
  int v25; // kr14_4
  char v26; // bh
  int v27; // ebx
  int v28; // eax
  int v29; // kr1C_4
  __int16 *v30; // eax
  int raceIndex; // ecx
  int v32; // edx
  int v33; // ebp
  int v34; // eax
  T_Vector3D *p_vector; // edx
  int v36; // kr24_4
  T_Ship *v37; // ecx
  double v38; // st7
  double z; // st7
  char *v40; // ecx
  int v41; // eax
  void *v42[107]; // [esp+8h] [ebp-770h] BYREF
  void *v43[107]; // [esp+1B4h] [ebp-5C4h] BYREF
  void *v44[107]; // [esp+360h] [ebp-418h] BYREF
  void *v45[107]; // [esp+50Ch] [ebp-26Ch] BYREF
  float v46; // [esp+6B8h] [ebp-C0h]
  float v47; // [esp+6BCh] [ebp-BCh]
  float v48; // [esp+6C0h] [ebp-B8h]
  float v49; // [esp+6C4h] [ebp-B4h] BYREF
  float v50; // [esp+6C8h] [ebp-B0h]
  float v51; // [esp+6CCh] [ebp-ACh]
  float v52; // [esp+6D0h] [ebp-A8h] BYREF
  float v53; // [esp+6D4h] [ebp-A4h]
  float v54; // [esp+6D8h] [ebp-A0h]
  float v55; // [esp+6DCh] [ebp-9Ch] BYREF
  float v56; // [esp+6E0h] [ebp-98h]
  float v57; // [esp+6E4h] [ebp-94h]
  float v58; // [esp+6E8h] [ebp-90h]
  float v59; // [esp+6ECh] [ebp-8Ch]
  float v60; // [esp+6F0h] [ebp-88h]
  float v61; // [esp+6F4h] [ebp-84h]
  float v62; // [esp+6F8h] [ebp-80h]
  float v63; // [esp+6FCh] [ebp-7Ch]
  int v64[3]; // [esp+700h] [ebp-78h] BYREF
  float v65; // [esp+70Ch] [ebp-6Ch]
  float v66; // [esp+710h] [ebp-68h]
  float v67; // [esp+714h] [ebp-64h]
  float *v68; // [esp+718h] [ebp-60h]
  float *v69; // [esp+71Ch] [ebp-5Ch]
  int *v70; // [esp+720h] [ebp-58h]
  float *v71; // [esp+728h] [ebp-50h]
  int v72; // [esp+730h] [ebp-48h]
  int v73; // [esp+734h] [ebp-44h]
  int v74; // [esp+738h] [ebp-40h]
  int v75; // [esp+73Ch] [ebp-3Ch]
  int v76; // [esp+740h] [ebp-38h]
  int v77; // [esp+744h] [ebp-34h]
  int v78; // [esp+748h] [ebp-30h]
  float v79; // [esp+74Ch] [ebp-2Ch]
  float v80; // [esp+750h] [ebp-28h]
  T_Vector3D *v81; // [esp+754h] [ebp-24h]
  float v82; // [esp+758h] [ebp-20h]
  float v83; // [esp+75Ch] [ebp-1Ch]
  int v84; // [esp+760h] [ebp-18h]

  v77 = a2;
  pHullCell = a1->pHullCell;
  power = 0;
  v73 = 0;
  gizmoIndex = pHullCell->gizmoIndex;
  v72 = 0xFFFFFFFF;
  if ( gizmoIndex == (signed __int8)0xFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0x2EA);
  }
  v6 = &V_Gizmos[gizmoIndex];
  if ( v6->power > a1->Unknown_88 )
  {
    v72 = 0;
  }
  else
  {
    power = v6->power;
  }
  v73 |= v72 != 0;
  if ( (v73 & 1) == 0 )
  {
    return v73;
  }
  if ( v77 != 1 )
  {
    return v73;
  }
  a1->Unknown_88 -= power;
  if ( (unsigned __int8)gizmoIndex < 0x39u )
  {
    if ( (unsigned __int8)gizmoIndex < 0x27u )
    {
      if ( (unsigned __int8)gizmoIndex >= 0x24u )
      {
        if ( (unsigned __int8)gizmoIndex <= 0x24u )
        {
          sub_1D538(a1->pLocation, a1);
          star = V_Game.races[a1->raceIndex].star;
          a1->pLocation.pPlanet = (P_Planet)star;
          sub_1D3E8(star, a1, 0);
          return v73;
        }
        if ( gizmoIndex == 0x26 )
        {
          v28 = sub_1D794(a1->pLocation, (P_Ship *)v43);
          v78 = 0;
          if ( v28 > 0 )
          {
            v75 = 4 * v28;
            v29 = 0;
            do
            {
              v30 = (__int16 *)v43[v29];
              raceIndex = a1->raceIndex;
              v32 = v30[0x2B];
              if ( v32 != raceIndex && V_Game.races[raceIndex].Unknown_1C0[v32] == 2 )
              {
                sub_4B7A0((int)v30, v77, v6->special1, raceIndex);
              }
              ++v78;
              ++v29;
            }
            while ( 4 * v29 < v75 );
          }
          Q_Ship_RemoveGizmo_sub_492F8(a1, a1->pHullCell - a1->hullCells);
          return v73;
        }
      }
    }
    else if ( (unsigned __int8)gizmoIndex <= 0x27u )
    {
      v33 = 0;
      v34 = sub_1D794(a1->pLocation, (P_Ship *)v42);
      if ( v34 > 0 )
      {
        p_vector = &a1->vector;
        v76 = 4 * v34;
        v36 = 0;
        do
        {
          v37 = (T_Ship *)v42[v36];
          if ( a1 != v37 )
          {
            v71 = &v55;
            v46 = 0.0;
            v47 = 0.0;
            v48 = 0.0;
            v46 = v37->vector.x - p_vector->x;
            v47 = v37->vector.y - a1->vector.y;
            v48 = v37->vector.z - a1->vector.z;
            v55 = v46;
            v56 = v47;
            v57 = v48;
            v38 = sqrt(v47 * v47 + v46 * v46 + v48 * v48);
            v84 = 0x20 * v6->special1;
            v79 = (float)v84;
            if ( v38 < v79 )
            {
              sub_53054(&v55, v79);
              v58 = 0.0;
              v59 = 0.0;
              v60 = 0.0;
              v68 = &v52;
              v58 = p_vector->x + v55;
              v59 = a1->vector.y + v56;
              z = a1->vector.z;
              v52 = v58;
              v60 = z + v57;
              v53 = v59;
              v40 = (char *)v42[v36];
              v54 = v60;
              *(float *)(v40 + 0x9E) = v58;
              *(float *)(v40 + 0xA2) = v53;
              *(float *)(v40 + 0xA6) = v54;
            }
          }
          ++v33;
          ++v36;
        }
        while ( 4 * v36 < v76 );
      }
    }
    else
    {
      if ( (unsigned __int8)gizmoIndex < 0x35u )
      {
        if ( gizmoIndex == 0x2E )
        {
          v69 = &v49;
          v65 = 0.0;
          v66 = 0.0;
          v67 = 0.0;
          v65 = -a1->vector.x;
          v66 = -a1->vector.y;
          v8 = -a1->vector.z;
          v49 = v65;
          v67 = v8;
          v50 = v66;
          v51 = v67;
          a1->vector.x = v65;
          a1->vector.y = v50;
          a1->vector.z = v51;
        }
        return v73;
      }
      if ( (unsigned __int8)gizmoIndex <= 0x35u )
      {
        a1->hullStrength -= v6->special1;
        hullStrength = a1->hullStrength;
        a1->Unknown_88 += v6->special2;
        if ( hullStrength < 1 )
        {
          goto LABEL_29;
        }
      }
      else
      {
        if ( gizmoIndex != 0x38 )
        {
          return v73;
        }
        v9 = sub_1D794(a1->pLocation, (P_Ship *)v44);
        if ( v9 > 0 )
        {
          v10 = 4 * v9;
          v11 = 0;
          do
          {
            v12 = (char *)v44[v11];
            if ( v12[0x58] == 4 )
            {
              v13 = sqrt(
                      *(float *)(v12 + 0xA2) * *(float *)(v12 + 0xA2)
                    + *(float *)(v12 + 0x9E) * *(float *)(v12 + 0x9E)
                    + *(float *)(v12 + 0xA6) * *(float *)(v12 + 0xA6));
              v84 = 0x20 * v6->special2;
              v80 = v13;
              v82 = (float)v84;
              if ( v80 > (double)v82 )
              {
                v84 = 0x20 * v6->special1;
                v14 = v80 - (double)v84;
                v83 = v14;
                if ( v14 < v82 )
                {
                  v83 = v82;
                }
                sub_53054((float *)((char *)v44[v11] + 0x9E), v83);
              }
            }
            ++v11;
          }
          while ( 4 * v11 < v10 );
        }
      }
    }
    return v73;
  }
  if ( (unsigned __int8)gizmoIndex <= 0x39u )
  {
    LOBYTE(a1->Unknown_9C) |= 4u;
    return v73;
  }
  if ( (unsigned __int8)gizmoIndex < 0x41u )
  {
    if ( (unsigned __int8)gizmoIndex <= 0x3Au )
    {
      v15 = v6->special1 + a1->hullStrength;
      Unknown_98 = a1->Unknown_98;
      a1->hullStrength = v15;
      if ( v15 > Unknown_98 )
      {
        a1->hullStrength = Unknown_98;
        return v73;
      }
    }
    else
    {
      if ( gizmoIndex != 0x3F )
      {
        return v73;
      }
      v41 = sub_49328((int)a1, 2);
      if ( v41 != 0xFFFFFFFF )
      {
        Q_Ship_RemoveGizmo_sub_492F8(a1, v41);
        LOBYTE(a1->Unknown_9C) |= 2u;
        return v73;
      }
    }
    return v73;
  }
  if ( (unsigned __int8)gizmoIndex <= 0x41u )
  {
    v24 = 0;
    if ( a1->hullCellsNum > 0 )
    {
      v25 = 0;
      do
      {
        v26 = *((_BYTE *)&a1->Unknown_0 + 7 * v25);
        if ( v26 != (char)0xFF && v26 != 0x41 )
        {
          v27 = v26;
          if ( V_Gizmos[v27].numUses )
          {
            *(_WORD *)((char *)&a1->Unknown_0 + 7 * v25 + 1) = V_Gizmos[v27].numUses;
          }
        }
        ++v24;
        ++v25;
      }
      while ( v24 < a1->hullCellsNum );
    }
    return v73;
  }
  if ( (unsigned __int8)gizmoIndex >= 0x48u )
  {
    if ( (unsigned __int8)gizmoIndex > 0x48u )
    {
      if ( gizmoIndex == 0x4B )
      {
        v22 = a1->pHullCell;
        a1->Unknown_88 += v6->special1;
        Q_Ship_RemoveGizmo_sub_492F8(a1, v22 - a1->hullCells);
      }
      return v73;
    }
    v18 = sub_1D794(a1->pLocation, (P_Ship *)v45);
    if ( v18 > 0 )
    {
      v81 = &a1->vector;
      v74 = 4 * v18;
      v19 = 0;
      do
      {
        v20 = (T_Ship *)v45[v19];
        if ( a1 != v20 )
        {
          v61 = 0.0;
          v62 = 0.0;
          v63 = 0.0;
          v70 = v64;
          v61 = v20->vector.x - v81->x;
          v62 = v20->vector.y - v81->y;
          v63 = v20->vector.z - v81->z;
          *(float *)v64 = v61;
          *(float *)&v64[1] = v62;
          *(float *)&v64[2] = v63;
          v21 = sqrt(v62 * v62 + v61 * v61 + v63 * v63);
          v84 = 0x20 * v6->range;
          if ( (double)v84 >= v21 )
          {
            sub_4B7A0((int)v45[v19], v77, v6->special1, a1->raceIndex);
          }
        }
        ++v19;
      }
      while ( 4 * v19 < v74 );
    }
LABEL_29:
    sub_49940(a1);
    return v73;
  }
  if ( gizmoIndex == 0x45 )
  {
    LOBYTE(a1->Unknown_9C) |= 0x10u;
    Q_Ship_RemoveGizmo_sub_492F8(a1, ((char *)a1->pHullCell - (char *)a1) / 7);
  }
  return v73;
}
// 4CDF8: using guessed type P_Ship var_418[107];
// 4CDF8: using guessed type P_Ship var_26C[107];
// 4CDF8: using guessed type P_Ship var_5C4[107];
// 4CDF8: using guessed type P_Ship var_770[107];

//----- (0004D700) --------------------------------------------------------
void sub_4D700()
{
  _wcpp_2_mod_register_(&dword_96AC0);
  Q_ShipCtor_sub_48B90(&stru_108FE8);
  dword_96AC8 = 1;
}
// 96AC0: using guessed type _DWORD dword_96AC0;
// 96AC8: using guessed type int dword_96AC8;

//----- (0004D724) --------------------------------------------------------
int __fastcall sub_4D724(T_Type5 *a1, int a2, LONG a3, int a4)
{
  void *ShapeTable_sub_1B084; // eax

  if ( a4 )
  {
    VFX_pane_wipe((PANE *)a1, 0x96);
  }
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFED8);
  if ( !ShapeTable_sub_1B084 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x34);
  }
  VFX_shape_draw((PANE *)a1, ShapeTable_sub_1B084, a3, 0x3F, 0x2D);
  WinMgr.SmallFont.pane = (PANE)*a1;
  return sub_2B8A8(&WinMgr.SmallFont, 0x3F, 2, V_Gizmos[a3].name, 8, 0xFFFFFFFF, 0xFF, 0x7A);
}

//----- (0004D7A8) --------------------------------------------------------
unsigned int __fastcall sub_4D7A8(int a1, int a2, int a3)
{
  unsigned int v3; // ebx
  __int64 v4; // rtt
  int v5; // edi
  int v6; // kr04_4
  char v7; // al
  int i; // edx
  char v9; // al
  int v10; // edx
  int v13; // [esp+4h] [ebp-20h]
  int v14; // [esp+Ch] [ebp-18h]

  v3 = 0xFFFFFFFF;
  if ( a2 - 0x94 > 0 )
  {
    LODWORD(v4) = (a2 - 0x94 - (a1 - 0x16F) / 2 + 0x12) / 2;
    HIDWORD(v4) = v4;
    v14 = v4 / 0x12;
    v13 = (unsigned __int8)byte_969A8[v14];
    if ( v14 < 0xE
      && !byte_969A8[v14]
      && v13 + (unsigned __int8)byte_969B8[v14] > 0
      && ((1 << -(char)v13) & (unsigned __int8)byte_106FE0[4 * v14 + a3]) != 0 )
    {
      v5 = 0;
      if ( v14 > 0 )
      {
        v6 = 0;
        do
        {
          v7 = 1;
          for ( i = 0; i < (unsigned __int8)byte_969B8[v5]; ++i )
          {
            if ( ((unsigned __int8)v7 & (unsigned __int8)byte_106FE0[a3]) != 0 )
            {
              ++v3;
            }
            v7 *= 2;
          }
          ++v5;
          ++v6;
        }
        while ( v5 < v14 );
      }
      v9 = 1;
      v10 = 0;
      if ( !byte_969A8[v14] )
      {
        do
        {
          if ( ((unsigned __int8)v9 & (unsigned __int8)byte_106FE0[4 * v14 + a3]) != 0 )
          {
            ++v3;
          }
          ++v10;
          v9 *= 2;
        }
        while ( v10 <= -v13 );
      }
    }
  }
  return v3;
}

//----- (0004D92C) --------------------------------------------------------
P_Wnd8SW __fastcall sub_4D92C(P_Wnd8SW a1)
{
  Q_A2Ctor_sub_2C830(&a1->a);
  Q_ShipCtor_sub_48B90(&a1->Ship);
  a1->a.procs = (P_Procs)off_9607C;
  a1->Unknown_B8[0] = 0xFF;
  a1->Unknown_B8[1] = 0;
  *(_DWORD *)&a1->Unknown_B8[2] = 0xFFFFFFFF;
  *(_DWORD *)&a1->Unknown_B8[6] = 0xFFFFFFFF;
  *(_DWORD *)&a1->Unknown_B8[0xA] = 0;
  a1->pShip = 0;
  *(_DWORD *)&a1->Unknown_B8[0xE] = 0;
  sub_4DA5C(a1);
  return a1;
}
/* Orphan comments:
Need optimization:
remove here
lea     edx, [eax-0CDh]
*/
// 9607C: using guessed type int (*off_9607C[2])();

//----- (0004DA08) --------------------------------------------------------
int __fastcall sub_4DA08(int a1, char a2, int a3, int a4)
{
  char *v5; // eax
  int v7; // eax
  P_TypeA2 v8; // eax
  P_TypeA2 v9; // ebx

  if ( (a2 & 4) != 0 )
  {
    v5 = _wcpp_2_dtor_array_store_((void *)a1, (rt_type_sig_clss *)&unk_96068);
    operator delete[](v5);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_9607C;
    v7 = Q_ShipDtor_sub_48C58();
    v8 = Q_A2Dtor_sub_2C848((P_TypeA2)(v7 - 0xCD), 1);
    v9 = v8;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v8);
    }
    return (int)v9;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 9607C: using guessed type int (*off_9607C[2])();

//----- (0004DA5C) --------------------------------------------------------
void __fastcall __spoils<> sub_4DA5C(P_Wnd8SW result)
{
  if ( dword_96ACC )
  {
    result->Unknown_B7 = 0x4C;
    dword_96ACC = 0;
  }
}
// 96ACC: using guessed type int dword_96ACC;

//----- (0004DA7C) --------------------------------------------------------
int __fastcall sub_4DA7C(int a1, int a2, int a3, int a4)
{
  int v4; // ebp
  int result; // eax
  int v7; // [esp+8h] [ebp-10h]

  sub_4DA5C((P_Wnd8SW)a1);
  *(_DWORD *)(a1 + 0xAB) = a2;
  *(_DWORD *)(a1 + 0xC9) = a3;
  if ( a3 == 0xFFFFFFFF )
  {
    v4 = a1 + 0xCD;
    v7 = *(_DWORD *)(a1 + 0xAB);
    *(_DWORD *)(a1 + 0xCD) = *(_DWORD *)v7;
    *(_DWORD *)(a1 + 0xD1) = *(_DWORD *)(v7 + 4);
    *(_DWORD *)(a1 + 0xD5) = *(_DWORD *)(v7 + 8);
    *(_DWORD *)(a1 + 0xD9) = *(_DWORD *)(v7 + 0xC);
    *(_DWORD *)(a1 + 0xDD) = *(_DWORD *)(v7 + 0x10);
    *(_DWORD *)(a1 + 0xE1) = *(_DWORD *)(v7 + 0x14);
    *(_DWORD *)(a1 + 0xE5) = *(_DWORD *)(v7 + 0x18);
    *(_DWORD *)(a1 + 0xE9) = *(_DWORD *)(v7 + 0x1C);
    *(_DWORD *)(a1 + 0xED) = *(_DWORD *)(v7 + 0x20);
    *(_DWORD *)(a1 + 0xF1) = *(_DWORD *)(v7 + 0x24);
    *(_DWORD *)(a1 + 0xF5) = *(_DWORD *)(v7 + 0x28);
    *(_DWORD *)(a1 + 0xF9) = *(_DWORD *)(v7 + 0x2C);
    *(_DWORD *)(a1 + 0xFD) = *(_DWORD *)(v7 + 0x30);
    qmemcpy((void *)(a1 + 0x101), (const void *)(v7 + 0x34), 0x29u);
    *(_DWORD *)(a1 + 0x126) = *(_DWORD *)(v7 + 0x59);
    *(_DWORD *)(a1 + 0x126) = *(_DWORD *)(v7 + 0x59);
    *(_BYTE *)(a1 + 0x12A) = *(_BYTE *)(v7 + 0x5D);
    *(_DWORD *)(a1 + 0x12B) = *(_DWORD *)(v7 + 0x5E);
    *(_BYTE *)(a1 + 0x12F) = *(_BYTE *)(v7 + 0x62);
    *(_DWORD *)(a1 + 0x130) = *(_DWORD *)(v7 + 0x63);
    *(_BYTE *)(a1 + 0x134) = *(_BYTE *)(v7 + 0x67);
    *(_DWORD *)(a1 + 0x135) = *(_DWORD *)(v7 + 0x68);
    *(_DWORD *)(a1 + 0x135) = *(_DWORD *)(v7 + 0x68);
    *(_DWORD *)(a1 + 0x135) = *(_DWORD *)(v7 + 0x68);
    *(_DWORD *)(a1 + 0x135) = *(_DWORD *)(v7 + 0x68);
    *(_DWORD *)(a1 + 0x139) = *(_DWORD *)(v7 + 0x6C);
    *(_DWORD *)(a1 + 0x13D) = *(_DWORD *)(v7 + 0x70);
    *(_DWORD *)(a1 + 0x141) = *(_DWORD *)(v7 + 0x74);
    *(float *)(a1 + 0x145) = *(float *)(v7 + 0x78);
    *(_DWORD *)(a1 + 0x149) = *(_DWORD *)(v7 + 0x7C);
    *(float *)(a1 + 0x14D) = *(float *)(v7 + 0x80);
    *(_DWORD *)(a1 + 0x151) = *(_DWORD *)(v7 + 0x84);
    *(_DWORD *)(a1 + 0x155) = *(_DWORD *)(v7 + 0x88);
    *(_DWORD *)(a1 + 0x159) = *(_DWORD *)(v7 + 0x8C);
    *(_DWORD *)(a1 + 0x15D) = *(_DWORD *)(v7 + 0x90);
    *(_DWORD *)(a1 + 0x161) = *(_DWORD *)(v7 + 0x94);
    *(_DWORD *)(a1 + 0x165) = *(_DWORD *)(v7 + 0x98);
    *(_WORD *)(a1 + 0x169) = *(_WORD *)(v7 + 0x9C);
    *(float *)(a1 + 0x16B) = *(float *)(v7 + 0x9E);
    *(_DWORD *)(a1 + 0x16F) = *(_DWORD *)(v7 + 0xA2);
    *(float *)(a1 + 0x173) = *(float *)(v7 + 0xA6);
    *(_BYTE *)(a1 + 0x177) = *(_BYTE *)(v7 + 0xAA);
    _wcpp_2_assign_array_(sub_4B780);
    *(_DWORD *)(v4 + 0x15A) = *(_DWORD *)(v7 + 0x15A);
    *(_DWORD *)(v4 + 0x15E) = *(_DWORD *)(v7 + 0x15E);
  }
  result = a4;
  *(_DWORD *)(a1 + 0x233) = a4;
  return result;
}
// 78B30: using guessed type _DWORD __stdcall _wcpp_2_assign_array_(_DWORD);

//----- (0004DD14) --------------------------------------------------------
char __fastcall sub_4DD14(int a1)
{
  int v2; // eax
  int v3; // edi
  int v4; // kr04_4
  int resReq; // eax
  int Unknown_48; // edx
  unsigned __int16 v7; // ax

  LOBYTE(v2) = sub_2ED4C(*(P_Wnd10LB *)(a1 + 0xC5));
  v3 = 0;
  if ( *(int *)(a1 + 0xB7) > 0 )
  {
    v4 = 0;
    do
    {
      LOBYTE(v2) = V_Gizmos[v4].cat;
      if ( (_BYTE)v2 == *(_BYTE *)(a1 + 0xBC) )
      {
        resReq = (unsigned __int8)V_Gizmos[v4].resReq;
        if ( resReq == 0xFF
          || (Unknown_48 = V_ResTree.items[resReq].Unknown_48, v2 = 1 << V_RaceIndex, ((1 << V_RaceIndex) & Unknown_48) != 0) )
        {
          v7 = sub_2EA8C(*(_DWORD *)(a1 + 0xC5), (const char *)a1, 0xFFFFFFFF, 0);
          LOBYTE(v2) = sub_2EC50(*(_DWORD *)(a1 + 0xC5), v7, v3);
        }
      }
      ++v3;
      ++v4;
    }
    while ( v3 < *(_DWORD *)(a1 + 0xB7) );
  }
  return v2;
}

//----- (0004DDB0) --------------------------------------------------------
unsigned int __fastcall sub_4DDB0(P_Wnd8SW a1, __int16 a2, int a3, int a4)
{
  char v5; // al
  P_Procs v6; // ebx
  int v7; // ebx
  unsigned int result; // eax
  T_TypeA2 *Wnd_sub_56DA8; // eax
  P_Ship pShip; // ecx
  double Unknown_80; // st7
  double z; // st7
  int i; // esi
  int magic12345678; // edi
  int v15; // edx
  P_Procs v16; // ebx
  int r; // edx
  P_Procs procs; // ebx

  if ( (unsigned __int16)a2 < 0x32u )
  {
    if ( (unsigned __int16)a2 >= 5u )
    {
      if ( (unsigned __int16)a2 <= 5u )
      {
        if ( a1->a.a1.i && a3 >= a1->a.a1.pane.x0 && a3 <= a1->a.a1.pane.x1 && a4 >= a1->a.a1.pane.y0 && a4 <= a1->a.a1.pane.y1 )
        {
          if ( *(_DWORD *)&a1->Unknown_D1[4] == 0xFFFFFFFF )
          {
            return 0xFFFFFFFF;
          }
          if ( dword_96AD0 >= 0 )
          {
            if ( !a1->pShip )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x1D8);
            }
            if ( Q_Ship_RemoveGizmo_sub_492F8(a1->pShip, dword_96AD0) )
            {
              r = (__int16)a1->a.a1.r;
              if ( r != 0xFFFFFFFF )
              {
                Q_StartSample_sub_4FB90(&V_SoundSystem, r);
              }
              *(_DWORD *)&a1->Unknown_B8[2] = 0xFFFFFFFF;
              procs = a1->a.procs;
              *(_DWORD *)a1->Unknown_D1 = 0xFFFFFFFF;
              ((void (*)(void))procs->proc4)();
            }
          }
          return 0xFFFFFFFF;
        }
      }
      else
      {
        if ( (unsigned __int16)a2 < 7u )
        {
          if ( *(_DWORD *)&a1->Unknown_D1[4] == 0xFFFFFFFF )
          {
            return 0xFFFFFFFF;
          }
          sub_567BC(&WinMgr, a1->a.a1.index, 8);
          if ( a1->a.a1.j && a1->a.a1.i && (dword_96AD0 >= 0 || a1->a.a1._mouseFocus) )
          {
            dword_96AD0 = 0xFFFFFFFF;
            ((void (__fastcall *)(P_Wnd8SW, _DWORD))a1->a.procs->proc4)(a1, 0);
          }
          else
          {
            dword_96AD0 = 0xFFFFFFFF;
          }
          return 0xFFFFFFFF;
        }
        if ( (unsigned __int16)a2 <= 7u )
        {
          if ( *(_DWORD *)&a1->Unknown_D1[4] == 0xFFFFFFFF )
          {
            return 0xFFFFFFFF;
          }
          sub_56728(&WinMgr, a1->a.a1.index, 4, 8, 0, 0);
          if ( (a1->a.a1._mouseFocus & a1->a.a1.i & a1->a.a1.j) == 0xFFFFFFFF )
          {
            ((void (*)(void))a1->a.procs->proc5)();
          }
          return 0xFFFFFFFF;
        }
        if ( a2 != 8 )
        {
          return sub_2F424(&a1->a, a2, a3, a4);
        }
        if ( *(_DWORD *)&a1->Unknown_D1[4] != 0xFFFFFFFF )
        {
          if ( !a1->pShip )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x13D);
          }
          dword_96AD0 = sub_4D7A8(a3, a4, a1->pShip->hullSize);
          ((void (__fastcall *)(P_Wnd8SW, _DWORD))a1->a.procs->proc4)(a1, 0);
          return 0;
        }
      }
      return 0;
    }
    if ( (unsigned __int16)a2 < 2u )
    {
      if ( a2 == 1 )
      {
        if ( a1->pShip )
        {
          sub_4DA5C(a1);
        }
        else
        {
          a1->pShip = &stru_108FE8;
        }
        *(_DWORD *)&a1->Unknown_B8[6] = 0xFFFFFFFF;
        *(_DWORD *)a1->Unknown_D1 = 0;
        Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&WinMgr, "GIZLIST", 0);
        *(_DWORD *)&a1->Unknown_B8[0xA] = Wnd_sub_56DA8;
        if ( !Wnd_sub_56DA8 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x153);
        }
        *(_DWORD *)(*(_DWORD *)&a1->Unknown_B8[0xA] + 0xAB) = 0;
        Q_A10_SetProc_sub_2F1C8(*(P_Wnd10LB *)&a1->Unknown_B8[0xA], sub_4D724);
        *(_WORD *)(*(_DWORD *)&a1->Unknown_B8[0xA] + 0x8C9) = 0x40;
        sub_2E9CC(*(P_Wnd10LB *)&a1->Unknown_B8[0xA], 0);
        *(_BYTE *)(*(_DWORD *)&a1->Unknown_B8[0xA] + 0xC6) = 0xF2;
        if ( a1->Unknown_B8[0] == (char)0xFF )
        {
          sub_4E644((int)a1, 4, 0, a4);
        }
        else
        {
          sub_4DD14((int)a1);
        }
        *(_DWORD *)&a1->Unknown_B8[2] = 0xFFFFFFFF;
        a1->a.a1.j = 0xFFFFFFFF;
        a1->a.a1.i = 0xFFFFFFFF;
        ((void (__fastcall *)(P_Wnd8SW, _DWORD))a1->a.procs->proc4)(a1, 0);
        sub_2D258(&a1->a, a2);
        return 0;
      }
    }
    else
    {
      if ( (unsigned __int16)a2 <= 2u )
      {
        a1->a.a1.j = 0;
        a1->a.a1.i = 0;
        pShip = a1->pShip;
        dword_96AD0 = 0xFFFFFFFF;
        if ( &stru_108FE8 != pShip )
        {
          stru_108FE8.Unknown_0 = pShip->Unknown_0;
          stru_108FE8.Unknown_4 = pShip->Unknown_4;
          stru_108FE8.Unknown_8 = pShip->Unknown_8;
          stru_108FE8.Unknown_C = pShip->Unknown_C;
          stru_108FE8.Unknown_10 = pShip->Unknown_10;
          stru_108FE8.Unknown_14 = pShip->Unknown_14;
          stru_108FE8.Unknown_18 = pShip->Unknown_18;
          stru_108FE8.Unknown_1C = pShip->Unknown_1C;
          stru_108FE8.Unknown_20 = pShip->Unknown_20;
          stru_108FE8.Unknown_24 = pShip->Unknown_24;
          stru_108FE8.Unknown_28 = pShip->Unknown_28;
          stru_108FE8.Unknown_2C = pShip->Unknown_2C;
          stru_108FE8.Unknown_30 = pShip->Unknown_30;
          qmemcpy(stru_108FE8.name, pShip->name, 0x1Eu);
          stru_108FE8._dayBuilt = pShip->_dayBuilt;
          stru_108FE8.raceIndex = pShip->raceIndex;
          stru_108FE8.locationType = pShip->locationType;
          stru_108FE8.pLocation.pPlanet = pShip->pLocation.pPlanet;
          stru_108FE8.pLocation.pPlanet = pShip->pLocation.pPlanet;
          stru_108FE8.pLocation.pPlanet = pShip->pLocation.pPlanet;
          stru_108FE8.Unknown_5D = pShip->Unknown_5D;
          stru_108FE8.Unknown_5E = pShip->Unknown_5E;
          stru_108FE8.Unknown_62 = pShip->Unknown_62;
          stru_108FE8.pHullCell = pShip->pHullCell;
          stru_108FE8.Unknown_67 = pShip->Unknown_67;
          stru_108FE8.Unknown_68 = pShip->Unknown_68;
          stru_108FE8.Unknown_68 = pShip->Unknown_68;
          stru_108FE8.Unknown_68 = pShip->Unknown_68;
          stru_108FE8.Unknown_68 = pShip->Unknown_68;
          stru_108FE8.Unknown_6C = pShip->Unknown_6C;
          stru_108FE8.Unknown_70 = pShip->Unknown_70;
          stru_108FE8.Unknown_74 = pShip->Unknown_74;
          stru_108FE8.Unknown_78 = pShip->Unknown_78;
          stru_108FE8.Unknown_7C = pShip->Unknown_7C;
          Unknown_80 = pShip->Unknown_80;
          stru_108FE8.Unknown_84 = pShip->Unknown_84;
          stru_108FE8.Unknown_88 = pShip->Unknown_88;
          stru_108FE8.hullStrength = pShip->hullStrength;
          stru_108FE8.Unknown_90 = pShip->Unknown_90;
          stru_108FE8.Unknown_94 = pShip->Unknown_94;
          stru_108FE8.Unknown_98 = pShip->Unknown_98;
          stru_108FE8.Unknown_9C = pShip->Unknown_9C;
          stru_108FE8.Unknown_80 = Unknown_80;
          stru_108FE8.vector.x = pShip->vector.x;
          stru_108FE8.vector.y = pShip->vector.y;
          z = pShip->vector.z;
          stru_108FE8.hullSize = pShip->hullSize;
          stru_108FE8.vector.z = z;
          _wcpp_2_assign_array_(sub_4B780);
          stru_108FE8.hullCellsNum = pShip->hullCellsNum;
          stru_108FE8.gizmosNum = pShip->gizmosNum;
        }
        for ( i = 0; (__int16)i < (__int16)a1->a.a1.childrenCnt; ++i )
        {
          magic12345678 = (*a1->a.a1.children)[(__int16)i][1].magic12345678;
          (*(void (**)(void))(magic12345678 + 8))();
        }
        if ( !*(_DWORD *)a1->Unknown_D1 )
        {
          a1->pShip = 0;
          return 0;
        }
        return 0;
      }
      if ( a2 == 4 )
      {
        result = a1->a.a1.i;
        if ( !result )
        {
          return result;
        }
        if ( a3 >= a1->a.a1.pane.x0 && a3 <= a1->a.a1.pane.x1 && a4 >= a1->a.a1.pane.y0 && a4 <= a1->a.a1.pane.y1 )
        {
          if ( *(_DWORD *)&a1->Unknown_D1[4] == 0xFFFFFFFF )
          {
            return 0xFFFFFFFF;
          }
          if ( dword_96AD0 >= 0 )
          {
            if ( !a1->pShip )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x1B2);
            }
            if ( sub_492AC(&a1->pShip->Unknown_0, a1->Unknown_B8[0], dword_96AD0) )
            {
              v15 = (__int16)a1->a.a1.r;
              if ( v15 != 0xFFFFFFFF )
              {
                Q_StartSample_sub_4FB90(&V_SoundSystem, v15);
              }
              *(_DWORD *)&a1->Unknown_B8[2] = 0xFFFFFFFF;
              v16 = a1->a.procs;
              *(_DWORD *)a1->Unknown_D1 = 0xFFFFFFFF;
              ((void (*)(void))v16->proc4)();
            }
          }
          return 0xFFFFFFFF;
        }
        return 0;
      }
    }
    return sub_2F424(&a1->a, a2, a3, a4);
  }
  if ( (unsigned __int16)a2 <= 0x32u )
  {
    if ( *(_DWORD *)&a1->Unknown_D1[4] != 0xFFFFFFFF )
    {
      if ( sub_4E69C((int)a1) )
      {
        *(_DWORD *)&a1->Unknown_B8[6] = 0xFFFFFFFF;
      }
      ((void (__fastcall *)(P_Wnd8SW, _DWORD))a1->a.procs->proc4)(a1, 0);
      return 0;
    }
    return 0;
  }
  if ( (unsigned __int16)a2 >= 0x36u )
  {
    if ( (unsigned __int16)a2 <= 0x36u )
    {
      sub_4E644((int)a1, 2, a3, a4);
      return 0;
    }
    if ( (unsigned __int16)a2 < 0x39u )
    {
      if ( a2 == 0x37 )
      {
        sub_4E644((int)a1, 4, a3, a4);
        return 0;
      }
      return sub_2F424(&a1->a, a2, a3, a4);
    }
    if ( (unsigned __int16)a2 <= 0x39u )
    {
      sub_4E644((int)a1, 5, a3, a4);
      return 0;
    }
    if ( (unsigned __int16)a2 < 0x1C01u )
    {
      return sub_2F424(&a1->a, a2, a3, a4);
    }
    if ( (unsigned __int16)a2 > 0x1C01u )
    {
      if ( a2 == 0x1C02 )
      {
        v7 = (char)sub_2ECA4(*(_DWORD *)&a1->Unknown_B8[0xA], a3);
        sub_56B60(&WinMgr, 5, v7, 4);
        return 0xFFFFFFFF;
      }
      return sub_2F424(&a1->a, a2, a3, a4);
    }
    v5 = sub_2ECA4(*(_DWORD *)&a1->Unknown_B8[0xA], a3);
    if ( v5 != a1->Unknown_B8[0] )
    {
      v6 = a1->a.procs;
      a1->Unknown_B8[0] = v5;
      ((void (__fastcall *)(P_Wnd8SW, _DWORD))v6->proc4)(a1, 0);
    }
    return 0;
  }
  if ( (unsigned __int16)a2 < 0x34u )
  {
    sub_4E644((int)a1, 0, a3, a4);
    return 0;
  }
  else
  {
    if ( (unsigned __int16)a2 <= 0x34u )
    {
      sub_4E644((int)a1, 1, a3, a4);
    }
    else
    {
      sub_4E644((int)a1, 3, a3, a4);
    }
    return 0;
  }
}
// 78B30: using guessed type _DWORD __stdcall _wcpp_2_assign_array_(_DWORD);
// 96AD0: using guessed type int dword_96AD0;

//----- (0004E644) --------------------------------------------------------
int __fastcall sub_4E644(int result, char a2, int a3, int a4)
{
  int v4; // ebx
  int v5; // eax

  v4 = result;
  if ( a2 >= 0 && a2 < 6 && a2 != *(_BYTE *)(result + 0xBC) )
  {
    *(_BYTE *)(result + 0xBC) = a2;
    sub_4DD14(result);
    v5 = *(_DWORD *)(v4 + 0xC5);
    *(_BYTE *)(v4 + 0xBB) = 0xFF;
    if ( *(_WORD *)(v5 + 0x8C7) )
    {
      *(_BYTE *)(v4 + 0xBB) = sub_2ECA4(v5, 0);
    }
    return (*(int (**)(void))(*(_DWORD *)(v4 + 0xA7) + 0xC))();
  }
  return result;
}

//----- (0004E69C) --------------------------------------------------------
unsigned int __fastcall sub_4E69C(int a1)
{
  unsigned int v2; // ebp
  int v3; // ebx
  unsigned int v4; // esi
  T_Ship *v5; // eax

  v2 = 0;
  v3 = *(char *)(*(_DWORD *)(a1 + 0xAB) + 0xAA);
  v4 = 0;
  if ( !*(_DWORD *)(a1 + 0xC9) )
  {
    while ( !v4 )
    {
      if ( ++v3 >= 4 )
      {
        v3 = 0;
      }
      if ( (v3 != 2 || ((1 << V_RaceIndex) & V_ResTree.items[0x13].Unknown_48) != 0)
        && (v3 != 3 || ((1 << V_RaceIndex) & V_ResTree.items[0x1F].Unknown_48) != 0) )
      {
        v5 = *(T_Ship **)(a1 + 0xAB);
        if ( v3 == v5->hullSize )
        {
          v4 = 0xFFFFFFFF;
          v2 = 0;
        }
        else if ( sub_493BC(v5, v3) )
        {
          v4 = 0xFFFFFFFF;
          v2 = 0xFFFFFFFF;
          *(_DWORD *)(a1 + 0xBD) = 0xFFFFFFFF;
        }
      }
    }
  }
  return v2;
}

//----- (0004E758) --------------------------------------------------------
void __fastcall sub_4E758(_DWORD *a1)
{
  int v1; // esi
  int v2; // eax
  int v3; // kr04_4
  int v4; // edi
  int v5; // esi
  int v6; // eax
  unsigned __int16 v7; // dx
  unsigned __int16 v8; // ax
  char v9; // bh
  void *ShapeTable_sub_1B084; // eax
  void *v11; // eax
  void *v12; // ecx
  _DWORD *v13; // ebx
  P_Planet pCurPlanet; // edx
  int v15; // eax
  int TurnsToComplete_sub_46C20; // eax
  int v17; // eax
  char *sub_1CEA8; // eax
  int v19; // eax
  int v20; // eax
  int v21; // kr0C_4
  int v22; // kr14_4
  int v23; // kr1C_4
  int v24; // edx
  int v25; // esi
  LONG v26; // [esp-Ch] [ebp-7Eh]
  LONG v27; // [esp-Ch] [ebp-7Eh]
  __int16 v28; // [esp-Ch] [ebp-7Eh]
  LONG v29; // [esp-8h] [ebp-7Ah]
  int v30; // [esp-8h] [ebp-7Ah]
  LONG v31; // [esp-4h] [ebp-76h]
  char s[52]; // [esp+0h] [ebp-72h] BYREF
  char v33[52]; // [esp+34h] [ebp-3Eh] BYREF
  PANE pane; // [esp+68h] [ebp-Ah] BYREF
  PANE v35; // [esp+7Ch] [ebp+Ah] BYREF
  int v36[5]; // [esp+90h] [ebp+1Eh]
  PANE a2; // [esp+A4h] [ebp+32h] BYREF
  _DWORD *v38; // [esp+B8h] [ebp+46h]
  int v39; // [esp+BCh] [ebp+4Ah]
  int v40; // [esp+C0h] [ebp+4Eh]
  int v41; // [esp+C4h] [ebp+52h]
  LONG v42; // [esp+C8h] [ebp+56h]
  int v43; // [esp+CCh] [ebp+5Ah]
  int v44; // [esp+D0h] [ebp+5Eh]
  int v45; // [esp+D4h] [ebp+62h]
  void *shape_table; // [esp+D8h] [ebp+66h]
  LONG shape_number; // [esp+DCh] [ebp+6Ah]
  int v48; // [esp+E0h] [ebp+6Eh]
  int v49; // [esp+E4h] [ebp+72h]
  LONG hotY; // [esp+E8h] [ebp+76h]
  int v51; // [esp+ECh] [ebp+7Ah]
  unsigned __int8 v52; // [esp+F0h] [ebp+7Eh]

  v38 = a1;
  if ( !*(_DWORD *)((char *)a1 + 0xAB) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x24A);
  }
  v1 = *(char *)(*(_DWORD *)((char *)v38 + 0xAB) + 0xAA);
  pane.window = (WINDOW *)&V_Type6_stru_D8654;
  pane.x0 = 0x14A;
  pane.y0 = 0x72;
  pane.x1 = 0x1DC;
  pane.y1 = 0x1D8;
  v43 = v1;
  VFX_pane_wipe(&pane, 0);
  pane.y1 = 0x1D8;
  pane.x1 = 0x149;
  pane.x0 = 7;
  pane.y0 = 0x159;
  v2 = VFX_pane_wipe(&pane, 0);
  LOWORD(v2) = word_FFED8;
  v40 = 0;
  v51 = v2;
  v45 = 0;
  v3 = 0;
  do
  {
    v4 = 0x12 * (v45 + (unsigned __int8)byte_969A8[v45]) + 0xA6;
    v5 = 0x24 * ((unsigned __int8)byte_969A8[v45] - v45) + 0x193;
    v6 = (unsigned __int8)byte_969B8[v45];
    v52 = 1;
    v49 = v6;
    v39 = 0;
    if ( v6 > 0 )
    {
      v48 = v43;
      v41 = 7 * v40;
      while ( (v52 & (unsigned __int8)byte_106FE0[v48]) == 0 )
      {
LABEL_12:
        v52 *= 2;
        v5 += 0x24;
        v4 += 0x12;
        if ( ++v39 >= v49 )
        {
          goto LABEL_4;
        }
      }
      if ( dword_96AD0 >= 0 && dword_96AD0 == v40 )
      {
        if ( *((_BYTE *)v38 + 0xBB) != 0xFF )
        {
          v31 = v4;
          v29 = v5;
          v26 = *((char *)v38 + 0xBB);
          v7 = v51;
LABEL_23:
          ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, v7);
          VFX_shape_draw(&V_Type6_stru_D8654.pane, ShapeTable_sub_1B084, v26, v29, v31);
          v41 += 7;
          ++v40;
          goto LABEL_12;
        }
        v31 = v4;
        v29 = v5;
        v8 = *((_WORD *)v38 + 0xC);
        v26 = 1;
      }
      else
      {
        if ( !*(_DWORD *)((char *)v38 + 0xAB) )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x28D);
        }
        v9 = *(_BYTE *)(v41 + *(_DWORD *)((char *)v38 + 0xAB) + 0xAB);
        if ( v9 != (char)0xFF )
        {
          if ( v9 >= 0x4C )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x291);
          }
          v31 = v4;
          v29 = v5;
          v26 = *(char *)(v41 + *(_DWORD *)((char *)v38 + 0xAB) + 0xAB);
          v7 = v51;
          goto LABEL_23;
        }
        v31 = v4;
        v29 = v5;
        v8 = *((_WORD *)v38 + 0xC);
        v26 = 0;
      }
      v7 = v8;
      goto LABEL_23;
    }
LABEL_4:
    ++v45;
    ++v3;
  }
  while ( v45 < 0xE );
  sub_55274(&WinMgr, v38[2], v38[3], v38[4], v38[5]);
  if ( *((_BYTE *)v38 + 0xBB) != 0xFF )
  {
    a2.window = (WINDOW *)&V_Type6_stru_D8654;
    a2.y1 = 105;
    a2.x0 = 315;
    a2.y0 = 7;
    a2.x1 = 476;
    VFX_pane_wipe(&a2, 0xF2);
    v30 = (a2.x1 - a2.x0) >> 1;
    v27 = *((char *)v38 + 0xBB);
    v11 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v51);
    VFX_shape_draw(&a2, v11, v27, v30, 0x3A);
    WinMgr.SmallFont.pane = a2;
    sprintf(s, "%s", V_Gizmos[*((char *)v38 + 0xBB)].name);
    sub_2B8A8(&WinMgr.SmallFont, 3, 3, s, 0x42, 0xF3, 0xFF, 0);
    sub_552CC(&WinMgr, &a2);
  }
  if ( *(_DWORD *)((char *)v38 + 0xC1) )
  {
    pane.window = (WINDOW *)&V_Type6_stru_D8654;
    pane.x1 = 321;
    pane.x0 = 7;
    pane.y0 = 114;
    pane.y1 = 336;
    VFX_pane_wipe(&pane, 0);
    v12 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFECA[V_RaceIndex]);
    if ( !v12 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x2CB);
    }
    VFX_shape_draw(&pane, v12, *(char *)(*(_DWORD *)((char *)v38 + 0xAB) + 0xAA), 0, 0);
    *(_DWORD *)((char *)v38 + 0xC1) = 0;
  }
  if ( *(_DWORD *)((char *)v38 + 0xBD) )
  {
    pane.window = (WINDOW *)&V_Type6_stru_D8654;
    pane.x1 = 304;
    pane.x0 = 7;
    pane.y0 = 7;
    pane.y1 = 102;
    VFX_pane_wipe(&pane, 0);
    sub_552CC(&WinMgr, &pane);
    Q_WINMGR_CPP_sub_53E38(&pane, 3, 3, V_RaceIndex);
    qmemcpy(v33, &unk_96AD4, 0x32u);
    if ( *(T_Ship **)((char *)v38 + 0xAB) != &stru_108FE8 && *(_DWORD *)((char *)v38 + 0x22F) == 0xFFFFFFFF )
    {
      v13 = v38;
      pCurPlanet = V_Game.pCurPlanet;
      v15 = sub_4A18C(*(P_Ship *)((char *)v38 + 0xAB));
      if ( *(_DWORD *)((char *)v13 + 0xC9) == 0xFFFFFFFF )
      {
        v15 = sub_4EE00((int)v13);
      }
      TurnsToComplete_sub_46C20 = Q_GetTurnsToComplete_sub_46C20(v15, pCurPlanet->buildingProgress, pCurPlanet->industry);
      if ( TurnsToComplete_sub_46C20 != 0xFFFF )
      {
        if ( TurnsToComplete_sub_46C20 == 1 )
        {
          v17 = 0x1C;                                  // 28: ""
        }
        else
        {
          v17 = 0x1D;                                  // 29: "s"
        }
        Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v17);
        sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x87);// 135: " (%d Day%s)"
        sprintf(v33, sub_1CEA8);
      }
    }
    sprintf(
      s,
      "%s \"%s\"%s",
      V_SpecNames[V_Game.races[V_RaceIndex].Unknown_01],
      (const char *)(*(_DWORD *)((char *)v38 + 0xAB) + 0x34),
      v33);
    v28 = 4 * V_Game.races[V_RaceIndex].Unknown_02 + 0x13;
    WinMgr.LargeFont.pane = pane;
    sub_2B8A8(&WinMgr.LargeFont, 0, 3, s, 2, v28, 0xFFFFFFFF, 0);
    shape_table = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEE6);
    v36[0] = **(_DWORD **)((char *)v38 + 0xAB);
    v36[1] = *(_DWORD *)(*(_DWORD *)((char *)v38 + 0xAB) + 4);
    v36[2] = *(_DWORD *)(*(_DWORD *)((char *)v38 + 0xAB) + 0x10);
    v36[3] = *(_DWORD *)(*(_DWORD *)((char *)v38 + 0xAB) + 0x20);
    v19 = *(_DWORD *)((char *)v38 + 0xAB);
    v42 = 7;
    v20 = *(_DWORD *)(v19 + 0x18);
    v35 = pane;
    v36[4] = v20;
    hotY = 0x14;
    v44 = 0;
    v21 = 0;
    v22 = 0;
    v23 = 0;
    do
    {
      v35.x1 = v35.x0 + 0x27;
      v24 = *(int *)((char *)v36 + v44);
      if ( v24 > 0 )
      {
        v35.x1 += 0xE * v24 / 4;
      }
      v25 = 0;
      shape_number = v42;
      do
      {
        ++v25;
        VFX_shape_draw(&v35, shape_table, shape_number, v4 + 0xE * v23++, hotY);
      }
      while ( v25 < 0xF );
      ++v42;
      ++v21;
      ++v22;
    }
    while ( v44 != 0x14 );
    *(_DWORD *)((char *)v38 + 0xBD) = 0;
  }
  sub_2D218(v38);
}
// 96AD0: using guessed type int dword_96AD0;
// FFECA: using guessed type __int16 word_FFECA[7];

//----- (0004EE00) --------------------------------------------------------
int __fastcall sub_4EE00(int a1)
{
  int v2; // ebx
  int GizmosCost_sub_4A144; // ecx
  int v4; // ecx

  v2 = 0x2710;
  if ( *(_DWORD *)(a1 + 0xC9) == 0xFFFFFFFF )
  {
    if ( *(_DWORD *)(a1 + 0xAB) )
    {
      GizmosCost_sub_4A144 = Q_ShipGetGizmosCost_sub_4A144(*(P_Ship *)(a1 + 0xAB));
      v4 = GizmosCost_sub_4A144 - Q_ShipGetGizmosCost_sub_4A144((P_Ship)(a1 + 0xCD));
      v2 = 0x1E;
      if ( v4 > 0 )
      {
        return v4 + 0x1E;
      }
    }
  }
  return v2;
}

//----- (0004EE50) --------------------------------------------------------
char *sub_4EE50()
{
  char *result; // eax

  _wcpp_2_mod_register_(&dword_96B08);
  result = (char *)sub_4EE74(&V_SoundSystem);
  dword_96B10 = 1;
  return result;
}
// 96B08: using guessed type _DWORD dword_96B08;
// 96B10: using guessed type int dword_96B10;

//----- (0004EE74) --------------------------------------------------------
P_SoundSystem __fastcall sub_4EE74(P_SoundSystem result)
{
  Q_InitFileInfo_sub_1BB78(&result->fileinfo);
  result->MDI_installed = 0;
  result->DIG_installed = 0;
  result->AIL_started = 0;
  result->_notstarted1 = 0;
  result->_notstarted2 = 0;
  result->a = 0;
  result->playing = 0;
  result->c = 0xFFFFFFFF;
  result->z1[0] = 0;
  result->Unknown_FF[0] = 0;
  result->Unknown_1FE[0] = 0;
  result->mdidrv = 0;
  result->digdrv = 0;
  result->digitalMusicBuf1 = 0;
  result->digitalMusicBuf2 = 0;
  result->smplCnt = 0;
  result->Unknown_CA8 = 0;
  result->Unknown_CAA = 0;
  memset(result->Unknown_BB4, 0, sizeof(result->Unknown_BB4));
  memset(result->Unknown_C68, 0, sizeof(result->Unknown_C68));
  memset(result->files, 0, sizeof(result->files));
  result->tracks = 0;
  result->volume = 0x64;
  result->volume2 = 0x7F;
  result->Unknown_700 = 0;
  result->Unknown_BB2 = 0;
  return result;
}

//----- (0004EF94) --------------------------------------------------------
T_SoundSystem *__fastcall sub_4EF94(T_SoundSystem *a1)
{
  Q_StopSoundSystem_sub_4FE8C(a1);
  Q_CloseFileAndDelete_sub_1BBC8(&a1->fileinfo);
  return a1;
}

//----- (0004EFB0) --------------------------------------------------------
LONG __fastcall Q_StartSoundSystem_sub_4EFB0(T_SoundSystem *a1, int aDIG, int aMDI)
{
  LONG result; // eax

  AIL_startup();
  a1->AIL_started = TRUE;
  if ( aDIG == TRUE )
  {
    result = AIL_install_DIG_INI();
    a1->digdrv = (DIG_DRIVER *)result;
    if ( !result )
    {
      return result;
    }
    Q_AllocateSamples_sub_4F5E8(a1, 8);
    sub_4FF94(a1);
    a1->DIG_installed = TRUE;
  }
  if ( aMDI == TRUE )
  {
    result = AIL_install_MDI_INI();
    a1->mdidrv = (MDI_DRIVER *)result;
    if ( !result )
    {
      return result;
    }
    sub_4F184(a1, 8);
    a1->MDI_installed = TRUE;
  }
  return TRUE;
}

//----- (0004F088) --------------------------------------------------------
HMDIDRIVER __fastcall sub_4F088(char *path, char *a2, char *a3, char *a4)
{
  int v7; // kr0C_4
  int v9; // kr2C_4
  char v10; // al
  char v11; // al
  int v12; // kr14_4
  char *v13; // kr30_4
  int v14; // kr34_4
  char v15; // al
  char v16; // al
  int v17; // kr1C_4
  char *v18; // kr38_4
  int v19; // kr3C_4
  char v20; // al
  char v21; // al
  int v22; // kr24_4
  char *v23; // kr40_4
  int v24; // kr44_4
  char v25; // al
  char v26; // al
  HMDIDRIVER result; // eax
  IO_PARMS v29; // [esp+0h] [ebp-24h] BYREF

  v7 = 0;
  v9 = 0;
  do
  {
    v10 = a2[2 * v7];
    path[2 * v9] = v10;
    if ( !v10 )
    {
      break;
    }
    v11 = a2[2 * v7 + 1];
    path[2 * v9 + 1] = v11;
    ++v7;
    ++v9;
  }
  while ( v11 );
  v12 = 0;
  v13 = &path[strlen(path)];
  v14 = 0;
  do
  {
    v15 = asc_929AC[2 * v12];
    v13[2 * v14] = v15;
    if ( !v15 )
    {
      break;
    }
    v16 = asc_929AC[2 * v12 + 1];
    v13[2 * v14 + 1] = v16;
    ++v12;
    ++v14;
  }
  while ( v16 );
  v17 = 0;
  v18 = &path[strlen(path)];
  v19 = 0;
  do
  {
    v20 = a3[2 * v17];
    v18[2 * v19] = v20;
    if ( !v20 )
    {
      break;
    }
    v21 = a3[2 * v17 + 1];
    v18[2 * v19 + 1] = v21;
    ++v17;
    ++v19;
  }
  while ( v21 );
  v22 = 0;
  v23 = path + 0x1FE;
  v24 = 0;
  do
  {
    v25 = a4[2 * v22];
    v23[2 * v24] = v25;
    if ( !v25 )
    {
      break;
    }
    v26 = a4[2 * v22 + 1];
    v23[2 * v24 + 1] = v26;
    ++v22;
    ++v24;
  }
  while ( v26 );
  AIL_set_GTL_filename_prefix(path + 0x1FE);
  memset(&v29, 0, sizeof(v29));
  v29.IO = 0x240;
  v29.IRQ = 9;
  result = AIL_install_MDI_driver_file(path, &v29);
  *(_DWORD *)(path + 0x21B) = result;
  if ( result )
  {
    sub_4F184((P_SoundSystem)path, 8);
    result = (HMDIDRIVER)0xFFFFFFFF;
    *(_DWORD *)(path + 0x207) = 0xFFFFFFFF;
  }
  return result;
}

//----- (0004F184) --------------------------------------------------------
int __fastcall sub_4F184(P_SoundSystem a1, int a2)
{
  __int16 i; // si
  HSEQUENCE sequence_handle; // edx

  if ( a1->Unknown_CA8 )
  {
    return 0;
  }
  if ( a2 > 8 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0xDA);
  }
  for ( i = 0; i < a2; *(_DWORD *)&a1->Unknown_C68[8 * i + 4] = 0 )
  {
    sequence_handle = AIL_allocate_sequence_handle(a1->mdidrv);
    *(_DWORD *)&a1->Unknown_C68[8 * i] = sequence_handle;
    if ( !sequence_handle )
    {
      break;
    }
    ++i;
  }
  a1->Unknown_CA8 = i;
  return a1->Unknown_CA8;
}

//----- (0004F32C) --------------------------------------------------------
void __fastcall sub_4F32C(P_SoundSystem a1, __int16 a2, int a3)
{
  HSEQUENCE *v4; // [esp+0h] [ebp-14h]

  if ( a1->_notstarted2 != 0xFFFFFFFF && a1->MDI_installed )
  {
    if ( a2 < 0 || a2 >= a1->Unknown_CA8 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x12A);
    }
    if ( !*(_DWORD *)&a1->Unknown_C68[8 * a2 + 4] )
    {
      sprintf("Thank you for playing Ascendancy.", "Attempt play Sequence Track %d with NULL data.\n\n", a2);
      Q_debugbreak_exit_sub_2624C();
    }
    v4 = (HSEQUENCE *)((char *)a1 + 8 * a2);
    if ( AIL_sequence_status(v4[0x31A]) == 4 )
    {
      if ( a3 != 0xFFFFFFFF )
      {
        return;
      }
      AIL_stop_sequence(v4[0x31A]);
    }
    AIL_start_sequence(*(HSEQUENCE *)&a1->Unknown_C68[8 * a2]);
  }
}
// 4F3A4: conditional instruction was optimized away because ecx.4!=0

//----- (0004F45C) --------------------------------------------------------
void __fastcall sub_4F45C(P_SoundSystem a1, __int16 a2)
{
  HSEQUENCE *v2; // esi

  if ( a2 < 0 || a2 >= a1->Unknown_CA8 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x152);
  }
  v2 = (HSEQUENCE *)((char *)a1 + 8 * a2);
  if ( v2[0x31B] )
  {
    AIL_end_sequence(v2[0x31A]);
  }
}

//----- (0004F4D4) --------------------------------------------------------
void __fastcall sub_4F4D4(int a1, __int16 a2)
{
  int v2; // eax

  if ( a2 < 0 || a2 >= *(__int16 *)(a1 + 0xCA8) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x166);
  }
  if ( *(_DWORD *)(a1 + 8 * a2 + 0xC6C) )
  {
    AIL_end_sequence(*(HSEQUENCE *)(a1 + 8 * a2 + 0xC68));
    if ( *(_DWORD *)(v2 + 8 * a2 + 0xC6C) )
    {
      MEM_free(*(void **)(v2 + 8 * a2 + 0xC6C));
    }
  }
}
// 4F525: variable 'v2' is possibly undefined

//----- (0004F534) --------------------------------------------------------
HDIGDRIVER __fastcall sub_4F534(_DWORD *a1, char *a2, char *a3)
{
  BYTE *v5; // edx
  int v6; // kr0C_4
  char *v7; // kr20_4
  int v8; // kr24_4
  char v9; // al
  char v10; // al
  int v11; // kr14_4
  const char *v12; // kr28_4
  int v13; // kr2C_4
  char v14; // al
  char v15; // al
  int v16; // kr1C_4
  const char *v17; // kr30_4
  int v18; // kr34_4
  char v19; // al
  char v20; // al
  HDIGDRIVER result; // eax
  const char *v22; // [esp-4h] [ebp-14h]

  v5 = (char *)a1 + 0xFF;
  v22 = (char *)a1 + 0xFF;
  v6 = 0;
  v7 = (char *)a1 + 0xFF;
  v8 = 0;
  do
  {
    v9 = a2[2 * v6];
    v7[2 * v8] = v9;
    if ( !v9 )
    {
      break;
    }
    v10 = a2[2 * v6 + 1];
    v7[2 * v8 + 1] = v10;
    ++v6;
    ++v8;
  }
  while ( v10 );
  v11 = 0;
  v12 = &v22[strlen(v22)];
  v13 = 0;
  do
  {
    v14 = asc_92A57[2 * v11];
    v12[2 * v13] = v14;
    if ( !v14 )
    {
      break;
    }
    v15 = asc_92A57[2 * v11 + 1];
    v12[2 * v13 + 1] = v15;
    ++v11;
    ++v13;
  }
  while ( v15 );
  v16 = 0;
  v17 = &v22[strlen(v22)];
  v18 = 0;
  do
  {
    v19 = a3[2 * v16];
    v17[2 * v18] = v19;
    if ( !v19 )
    {
      break;
    }
    v20 = a3[2 * v16 + 1];
    v17[2 * v18 + 1] = v20;
    ++v16;
    ++v18;
  }
  while ( v20 );
  result = AIL_install_DIG_driver_file(v5, 0);
  *(_DWORD *)((char *)a1 + 0x21F) = result;
  if ( result )
  {
    Q_AllocateSamples_sub_4F5E8((P_SoundSystem)a1, 8);
    sub_4FF94((P_SoundSystem)a1);
    result = (HDIGDRIVER)0xFFFFFFFF;
    *(_DWORD *)((char *)a1 + 0x20B) = 0xFFFFFFFF;
  }
  return result;
}

//----- (0004F5E8) --------------------------------------------------------
int __fastcall Q_AllocateSamples_sub_4F5E8(P_SoundSystem a1, int a2)
{
  WORD i; // si
  SAMPLE *sample_handle; // eax

  if ( a1->smplCnt )
  {
    return 0;
  }
  if ( a2 > 8 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x199);
  }
  for ( i = 0; i < a2; ++i )
  {
    sample_handle = AIL_allocate_sample_handle(a1->digdrv);
    a1->smpl[i] = sample_handle;
    if ( !sample_handle )
    {
      break;
    }
  }
  a1->smplCnt = i;
  return a1->smplCnt;
}

//----- (0004F65C) --------------------------------------------------------
unsigned int __fastcall Q_LoadMusic_sub_4F65C(P_SoundSystem a1, const char *aMusicFName)
{
  SAMPLE *smpl; // esi
  void *pBuf; // eax
  int v7; // edx
  void *digitalMusicBuf1; // ebx
  __int16 i; // si
  int v10; // ecx
  int v11; // eax
  DIG_DRIVER *digdrv; // [esp-Ch] [ebp-80h]
  char fname[80]; // [esp+0h] [ebp-74h] BYREF
  int lines; // [esp+50h] [ebp-24h] BYREF
  int bufSize; // [esp+54h] [ebp-20h]
  T_OpenedFile *files; // [esp+58h] [ebp-1Ch]
  FILE *fp; // [esp+5Ch] [ebp-18h]

  if ( a1->DIG_installed != TRUE )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x1B4);
  }
  if ( a1->smplCnt <= 0 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x1B5);
  }
  if ( !a1->DIG_installed || a1->smplCnt < 8 )
  {
    return 0;
  }
  if ( a1->a == 0xFFFFFFFF )
  {
    return 0xFFFFFFFF;
  }
  smpl = a1->smpl[0];
  AIL_init_sample(smpl);
  AIL_set_sample_type(smpl, 0, 0);
  AIL_set_sample_playback_rate(smpl, 22050);
  digdrv = a1->digdrv;
  bufSize = 0xC800;
  if ( AIL_minimum_sample_buffer_size(digdrv, 22050, 0) >= 0xC800 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x1C9);
  }
  pBuf = Q_Allocate_sub_2628C(2 * bufSize, 4, "DigitalMusicBuf");
  v7 = bufSize;
  a1->digitalMusicBuf1 = pBuf;
  digitalMusicBuf1 = a1->digitalMusicBuf1;
  a1->digitalMusicBuf2 = (char *)pBuf + v7;
  if ( !digitalMusicBuf1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x1D0);
  }
  if ( !a1->digitalMusicBuf1 )
  {
    return 0;
  }
  if ( aMusicFName )
  {
    fp = Q_OpenFile_sub_1BB10(aMusicFName, 0);
    if ( !fp )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x1DB);
    }
    fscanf(fp, "%d", &lines);
    if ( lines > 0x20 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x1E2);
    }
    i = 0;
    files = a1->files;
    while ( i < lines )
    {
      fscanf(fp, "%s", fname);
      if ( strlen(fname) >= 0x18 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x1E8);
      }
      v10 = i;
      strncpy(files[v10].fname, fname, 0x18u);
      a1->files[v10].fname[0x17] = 0;
      ++i;
      a1->files[v10].fpos = 0;
    }
    a1->tracks = lines;
    fclose(fp);
  }
  a1->a = 0xFFFFFFFF;
  a1->c = 0;
  *(_DWORD *)&a1->z2[4] = 0;
  v11 = bufSize;
  a1->z2[8] = 0;
  *(_DWORD *)a1->z2 = v11;
  return 0xFFFFFFFF;
}
// 4F738: conditional instruction was optimized away because eax.4<C800

//----- (0004F8CC) --------------------------------------------------------
MACRO_VFX_BOOL __fastcall sub_4F8CC(P_SoundSystem a1, __int16 track, int setpos)
{
  MACRO_VFX_BOOL result; // eax
  SAMPLE *v5; // ebp

  if ( a1->c == 0xFFFFFFFF || !a1->DIG_installed )
  {
    return FALSE;
  }
  if ( track < 0 || track >= a1->tracks )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x200);
  }
  if ( a1->current != 0xFFFFFFFF )
  {
    a1->files[a1->current].fpos = Q_GetFilePos_sub_1BEA0(&a1->fileinfo);
  }
  Q_StopSample_sub_4FA1C(a1);
  v5 = a1->smpl[0];
  AIL_init_sample(v5);
  AIL_set_sample_type(v5, 0, 0);
  AIL_set_sample_playback_rate(v5, 22050);
  Q_SetVolume_sub_4FF4C(a1, a1->volume);
  if ( Q_OpenFile_sub_1BBFC(&a1->fileinfo, a1->files[track].fname, O_BINARY, 0) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x214);
  }
  if ( setpos == TRUE )
  {
    Q_SetFilePos_sub_1BF0C(&a1->fileinfo, a1->files[track].fpos);
  }
  a1->playing = TRUE;
  result = TRUE;
  a1->current = track;
  return result;
}

//----- (0004FA1C) --------------------------------------------------------
void __fastcall Q_StopSample_sub_4FA1C(P_SoundSystem a1)
{
  SAMPLE *v2; // [esp-10h] [ebp-14h]

  if ( a1->playing == TRUE )
  {
    v2 = a1->smpl[0];
    a1->playing = FALSE;
    AIL_stop_sample(v2);
    a1->files[a1->current].fpos = Q_GetFilePos_sub_1BEA0(&a1->fileinfo);
  }
}

//----- (0004FAB4) --------------------------------------------------------
void __fastcall sub_4FAB4(int a1)
{
  SAMPLE *v2; // edi
  LONG v3; // eax
  signed int v4; // ebx
  int File_sub_1BF94; // eax

  if ( *(_DWORD *)(a1 + 0x22B) != 0xFFFFFFFF && *(_DWORD *)(a1 + 0x20B) )
  {
    v2 = *(SAMPLE **)(a1 + 0x358);
    v3 = AIL_sample_buffer_ready(v2);
    if ( v3 != 0xFFFFFFFF )
    {
      *(_DWORD *)(a1 + 0x233) = 0;
      *(_BYTE *)(a1 + 0x237) = v3;
    }
    v4 = *(_DWORD *)(a1 + 0x22F) - *(_DWORD *)(a1 + 0x233);
    if ( v4 > 0x1400 )
    {
      v4 = 0x1400;
    }
    if ( v4 )
    {
      File_sub_1BF94 = Q_ReadFile_sub_1BF94(
                         (P_FileInfo)(a1 + 0x240),
                         (void *)(*(_DWORD *)(a1 + 0x233) + *(_DWORD *)(a1 + 4 * *(char *)(a1 + 0x237) + 0x238)),
                         v4);
      *(_DWORD *)(a1 + 0x233) += File_sub_1BF94;
      if ( File_sub_1BF94 )
      {
        AIL_load_sample_buffer(
          v2,
          *(char *)(a1 + 0x237),
          *(void **)(a1 + 4 * *(char *)(a1 + 0x237) + 0x238),
          File_sub_1BF94 + *(_DWORD *)(a1 + 0x233));
      }
      else
      {
        sub_1BECC((int *)(a1 + 0x240), 0, 0);
        Q_StopSample_sub_4FA1C((P_SoundSystem)a1);
      }
    }
  }
}

//----- (0004FB90) --------------------------------------------------------
void __fastcall Q_StartSample_sub_4FB90(P_SoundSystem a1, __int16 a2)
{
  int v2; // ebp
  int v3; // kr04_4
  SAMPLE *v4; // esi
  int v5; // edx
  char *Unknown_BB4; // kr08_4
  int v7; // kr0C_4
  char *v8; // [esp+0h] [ebp-1Ch]

  if ( a1->_notstarted1 != 0xFFFFFFFF )
  {
    if ( a1->DIG_installed )
    {
      v8 = sub_50140(a1, a2);
      if ( v8 )
      {
        v2 = 1;
        v3 = 0;
        while ( v2 < a1->smplCnt )
        {
          v4 = a1->smpl[v3 + 1];
          if ( AIL_sample_status(v4) != 4 )
          {
            AIL_init_sample(v4);
            AIL_set_sample_type(v4, *((__int16 *)v8 + 8), 0);
            AIL_set_sample_address(v4, *((void **)v8 + 2), *((_DWORD *)v8 + 3));
            AIL_set_sample_playback_rate(v4, *((__int16 *)v8 + 9));
            AIL_set_sample_volume(v4, a1->volume2);
            AIL_set_sample_loop_count(v4, 1);
            AIL_start_sample(v4);
            v5 = 0;
            *(_DWORD *)v8 = v4;
            Unknown_BB4 = a1->Unknown_BB4;
            v7 = 0;
            do
            {
              if ( &Unknown_BB4[0x16 * v7] != v8 && v4 == *(SAMPLE **)&Unknown_BB4[0x16 * v7] )
              {
                *(_DWORD *)&Unknown_BB4[0x16 * v7] = 0;
              }
              ++v5;
              ++v7;
            }
            while ( v5 < 6 );
            return;
          }
          ++v2;
          ++v3;
        }
      }
    }
  }
}

//----- (0004FE8C) --------------------------------------------------------
void __fastcall Q_StopSoundSystem_sub_4FE8C(P_SoundSystem a1)
{
  __int16 i; // bx
  int v3; // ebp
  int v4; // kr04_4

  if ( a1->AIL_started == 0xFFFFFFFF )
  {
    for ( i = 0; i < a1->Unknown_CA8; ++i )
    {
      sub_4F4D4((int)a1, i);
    }
    v3 = 0;
    v4 = 0;
    while ( v3 < a1->smplCnt )
    {
      ++v3;
      AIL_stop_sample(a1->smpl[v4++]);
    }
    sub_262CC(*(void **)&a1->Unknown_BB4[4]);
    AIL_shutdown();
    a1->AIL_started = 0;
  }
}

//----- (0004FF08) --------------------------------------------------------
void __fastcall Q_SetNoSound_sub_4FF08(P_SoundSystem a1)
{
  sub_4FF1C(a1);
  sub_4FF28(a1);
}

//----- (0004FF1C) --------------------------------------------------------
void __fastcall sub_4FF1C(P_SoundSystem a1)
{
  a1->_notstarted2 = TRUE;
}

//----- (0004FF28) --------------------------------------------------------
void __fastcall sub_4FF28(P_SoundSystem a1)
{
  a1->_notstarted1 = TRUE;
}

//----- (0004FF4C) --------------------------------------------------------
void __fastcall Q_SetVolume_sub_4FF4C(P_SoundSystem a1, char a2)
{
  if ( a2 >= 0 )
  {
    a1->volume = a2;
  }
  AIL_set_sample_volume(a1->smpl[0], a1->volume);
}

//----- (0004FF94) --------------------------------------------------------
int __fastcall sub_4FF94(P_SoundSystem a1)
{
  int v2; // esi
  int v3; // edi
  FILE *fp; // ebp
  int v5; // kr04_4
  char *sub_2628C; // eax
  P_SoundSystem v7; // edx
  char *v8; // ecx
  int v9; // ebx
  P_SoundSystem v10; // kr08_4
  int v11; // kr0C_4
  char *Unknown_BB4; // kr18_4
  int v13; // kr1C_4
  P_SoundSystem v14; // edx
  P_SoundSystem v15; // esi
  int v16; // edx
  P_SoundSystem v17; // kr10_4
  int v18; // kr14_4
  __int16 *Unknown_702; // kr20_4
  int v20; // kr24_4
  int v22; // [esp+0h] [ebp-28h] BYREF
  int v23; // [esp+4h] [ebp-24h] BYREF
  P_SoundSystem v24; // [esp+8h] [ebp-20h]
  int v25; // [esp+Ch] [ebp-1Ch]

  v24 = a1;
  v2 = 0;
  v3 = 0;
  fp = Q_OpenFile_sub_1BB10("soundfx.txt", 0);
  v25 = 0;
  v5 = 0;
  do
  {
    fscanf(fp, "%d %d", &v22, &v23);
    *(_DWORD *)&a1->Unknown_C38[4 * v5 + 0x18] = v2;
    *(_DWORD *)&a1->Unknown_C38[4 * v5 + 0x24] = v2 + v22 - 1;
    *(_DWORD *)&a1->Unknown_C38[4 * v5 + 0xC] = v23;
    v25 += v23 * v22;
    if ( v3 > 0 && *(_DWORD *)&a1->Unknown_C38[4 * v5 + 0xC] < *(_DWORD *)&a1->Unknown_C38[4 * v5 + 8] )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x347);
    }
    ++v3;
    v2 += v22;
    ++v5;
  }
  while ( v3 < 3 );
  if ( v2 != 6 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x34D);
  }
  sub_2628C = (char *)Q_Allocate_sub_2628C(v25, 1, "SFX CACHE");
  v7 = v24;
  v8 = sub_2628C;
  v9 = 0;
  v10 = v24;
  v11 = 0;
  Unknown_BB4 = v24->Unknown_BB4;
  v13 = 0;
  do
  {
    *(_DWORD *)&Unknown_BB4[0x16 * v13] = 0;
    *(_WORD *)&Unknown_BB4[0x16 * v13 + 0x10] = 0;
    *(_WORD *)&Unknown_BB4[0x16 * v13 + 0x12] = 0x5622;
    *(_WORD *)&Unknown_BB4[0x16 * v13 + 0x14] = 0xFFFF;
    if ( v9 > *(_DWORD *)&v7->Unknown_C38[0x24] )
    {
      v7 = (P_SoundSystem)((char *)v7 + 4);
    }
    *(_DWORD *)&v10->Unknown_BB4[0x16 * v11 + 4] = v8;
    ++v9;
    v8 += *(_DWORD *)&v7->Unknown_C38[0xC];
    ++v11;
    ++v13;
  }
  while ( v9 < 6 );
  fscanf(fp, "%d", &v22);
  v14 = v24;
  v24->Unknown_700 = v22;
  if ( (unsigned __int16)v14->Unknown_700 >= 0x64u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x369);
  }
  v15 = v24;
  v16 = 0;
  v17 = v24;
  v18 = 0;
  Unknown_702 = v24->Unknown_702;
  v20 = 0;
  while ( v16 < (unsigned __int16)v15->Unknown_700 )
  {
    ++v16;
    fscanf(fp, "%s", &Unknown_702[5 * v20]);
    v17->Unknown_702[v18++ + 0x1F4] = 0xFFFF;
    ++v20;
  }
  return fclose(fp);
}

//----- (00050140) --------------------------------------------------------
char *__fastcall sub_50140(P_SoundSystem a1, __int16 a2)
{
  int v4; // edx
  P_SoundSystem v5; // ecx
  int v6; // eax
  int k; // kr04_4
  int m; // kr0C_4
  int v9; // edi
  int v10; // ecx
  int v11; // kr14_4
  unsigned int v12; // edx
  int v13; // edx
  int v14; // ecx
  int v15; // kr1C_4
  int v16; // ebp
  int v17; // kr24_4
  int v18; // edi
  int v19; // ebp
  int v20; // eax
  int i; // kr2C_4
  int j; // kr34_4
  unsigned __int16 Unknown_BB2; // di
  char *v24; // edx
  T_FileInfo v25; // [esp+0h] [ebp-178h] BYREF
  char s[52]; // [esp+118h] [ebp-60h] BYREF
  int v27; // [esp+14Ch] [ebp-2Ch]
  char *v28; // [esp+150h] [ebp-28h]
  int v29; // [esp+154h] [ebp-24h]
  int FileLength_sub_1BE28; // [esp+158h] [ebp-20h]
  P_SoundSystem v31; // [esp+15Ch] [ebp-1Ch]
  int v32; // [esp+160h] [ebp-18h]

  LOWORD(v32) = a2;
  if ( a1->_notstarted1 == TRUE || !a1->DIG_installed )
  {
    return 0;
  }
  if ( (v32 & 0x8000u) != 0 || (__int16)v32 >= (int)(unsigned __int16)a1->Unknown_700 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x37B);
  }
  v28 = 0;
  if ( (v32 & 0x8000u) != 0 || (__int16)v32 >= (int)(unsigned __int16)a1->Unknown_700 )
  {
    return v28;
  }
  v4 = a1->Unknown_702[(__int16)v32 + 0x1F4];
  if ( v4 == 0xFFFFFFFF )
  {
    sprintf(s, "data\\%s.voc", (const char *)&a1->Unknown_702[5 * (__int16)v32]);
    Q_InitFileInfo_sub_1BB78(&v25);
    Q_OpenFile_sub_1BBFC(&v25, s, 0x200, 0);
    v12 = 0;
    FileLength_sub_1BE28 = Q_GetFileLength_sub_1BE28(&v25);
    v10 = 0;
    v11 = 0;
    while ( FileLength_sub_1BE28 >= *(_DWORD *)&a1->Unknown_C38[4 * v11 + 0xC] )
    {
      ++v10;
      ++v11;
      if ( v10 >= 3 )
      {
        goto LABEL_23;
      }
    }
    v12 = 0xFFFFFFFF;
LABEL_23:
    if ( v12 != 0xFFFFFFFF )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x3AD);
    }
    v13 = v10;
    v14 = *(_DWORD *)&a1->Unknown_C38[4 * v10 + 0x18];
    v27 = 0xFFFFFFFF;
    v15 = 0;
    if ( v14 <= *(_DWORD *)&a1->Unknown_C38[4 * v13 + 0x24] )
    {
      while ( *(__int16 *)&a1->Unknown_BB4[0x16 * v14 + 0x14 + 0x16 * v15] != 0xFFFFFFFF )
      {
        ++v14;
        ++v15;
        if ( v14 > *(_DWORD *)&a1->Unknown_C38[4 * v13 + 0x24] )
        {
          goto LABEL_30;
        }
      }
      v27 = v14;
    }
LABEL_30:
    if ( v27 == 0xFFFFFFFF )
    {
      v31 = a1;
      v16 = 0;
      v29 = 4 * v13;
      v17 = 0;
      while ( v16 < (unsigned __int16)a1->Unknown_BB2 )
      {
        v18 = a1->Unknown_702[*(unsigned __int16 *)v31->Unknown_C38 + 0x1F4];
        if ( v18 >= *(_DWORD *)&a1->Unknown_C38[v29 + 0x18]
          && v18 <= *(_DWORD *)&a1->Unknown_C38[v29 + 0x24]
          && (!*(_DWORD *)&a1->Unknown_BB4[0x16 * v18] || AIL_sample_status(*(HSAMPLE *)&a1->Unknown_BB4[0x16 * v18]) != 4) )
        {
          v27 = v18;
          break;
        }
        ++v16;
        ++v17;
      }
    }
    if ( v27 != 0xFFFFFFFF )
    {
      v19 = *(__int16 *)&a1->Unknown_BB4[0x16 * v27 + 0x14];
      v28 = &a1->Unknown_BB4[0x16 * v27];
      if ( v19 != 0xFFFFFFFF )
      {
        v20 = 0;
        for ( i = 0; v20 < (unsigned __int16)a1->Unknown_BB2 && *(unsigned __int16 *)&a1->Unknown_C38[2 * i] != v19; ++i )
        {
          ++v20;
        }
        for ( j = 0; ; ++j )
        {
          Unknown_BB2 = a1->Unknown_BB2;
          if ( v20 >= Unknown_BB2 )
          {
            break;
          }
          *(_WORD *)&a1->Unknown_C38[2 * v20 + 2 + 2 * j] = *(_WORD *)&a1->Unknown_C38[2 * v20 + 4 + 2 * j];
          ++v20;
        }
        a1->Unknown_BB2 = Unknown_BB2 - 1;
        a1->Unknown_702[v19 + 0x1F4] = 0xFFFF;
      }
      Q_CfileLoad_sub_1BF1C(&v25, *((void **)v28 + 1));
      v24 = v28;
      *((_DWORD *)v28 + 2) = *((_DWORD *)v28 + 1) + 0x2A;
      *((_DWORD *)v24 + 3) = FileLength_sub_1BE28 - 0x2B;
      *((_WORD *)v24 + 0xA) = v32;
      a1->Unknown_702[(__int16)v32 + 0x1F4] = v27;
      LOWORD(v24) = a1->Unknown_BB2;
      a1->Unknown_BB2 = (_WORD)v24 + 1;
      *(_WORD *)&a1->Unknown_C38[2 * (unsigned __int16)v24] = v32;
    }
    Q_CloseFileAndDelete_sub_1BBC8(&v25);
    return v28;
  }
  v5 = a1;
  v28 = &a1->Unknown_BB4[0x16 * v4];
  v6 = 0;
  for ( k = 0; v6 < (unsigned __int16)a1->Unknown_BB2 && *(unsigned __int16 *)&v5->Unknown_C38[2 * k] != (__int16)v32; ++k )
  {
    ++v6;
  }
  for ( m = 0; ; ++m )
  {
    v9 = (unsigned __int16)a1->Unknown_BB2;
    if ( v6 >= (unsigned __int16)v9 )
    {
      break;
    }
    *(_WORD *)&a1->Unknown_C38[2 * v6 + 2 + 2 * m] = *(_WORD *)&a1->Unknown_C38[2 * v6 + 4 + 2 * m];
    ++v6;
  }
  *(_WORD *)&a1->Unknown_BB4[2 * v9 + 0x82] = v32;
  return v28;
}

//----- (00050530) --------------------------------------------------------
UWORD __fastcall sub_50530(T_Type5 *a1, P_Planet pPlanet, int a3, int a4)
{
  T_Star *v6; // esi
  void *ShapeTable_sub_1B084; // eax
  void *v8; // ecx
  int racesBits; // edi
  char *name; // ecx
  int v11; // edx
  char *sub_1CEA8; // eax
  int z7; // ebx
  PANE *v14; // esi
  __int16 v15; // cx
  char *v16; // eax
  unsigned int DaysToCompletePlanetItem_sub_358BC; // edx
  char *v18; // kr04_4
  int v19; // kr08_4
  int v20; // kr28_4
  char v21; // al
  char v22; // al
  int v23; // eax
  char *v24; // eax
  char *v25; // eax
  char *v26; // kr0C_4
  int v27; // kr10_4
  int v28; // kr30_4
  char v29; // al
  char v30; // al
  char *v31; // esi
  int v32; // kr18_4
  char *v33; // kr34_4
  int v34; // kr38_4
  char v35; // al
  char v36; // al
  int v37; // esi
  unsigned __int16 v38; // di
  int v39; // eax
  void *v40; // eax
  void *v41; // eax
  int v42; // eax
  void *v43; // eax
  int v44; // eax
  void *v45; // eax
  int v46; // eax
  int v47; // esi
  int i; // kr20_4
  UWORD result; // ax
  void *v50; // eax
  LONG v51; // [esp-10h] [ebp-F4h]
  LONG v52; // [esp-10h] [ebp-F4h]
  LONG v53; // [esp-10h] [ebp-F4h]
  LONG v54; // [esp-10h] [ebp-F4h]
  LONG v55; // [esp-8h] [ebp-ECh]
  LONG x_4c; // [esp+4h] [ebp-E0h]
  __int64 v57; // [esp+8h] [ebp-DCh]
  unsigned __int64 v58; // [esp+8h] [ebp-DCh]
  __int64 v59; // [esp+8h] [ebp-DCh]
  LONG v60; // [esp+Ch] [ebp-D8h]
  char s[100]; // [esp+10h] [ebp-D4h] BYREF
  char v62[60]; // [esp+74h] [ebp-70h] BYREF
  LONG v63; // [esp+B0h] [ebp-34h]
  LONG hotY; // [esp+B4h] [ebp-30h]
  int v65; // [esp+B8h] [ebp-2Ch]
  int v66; // [esp+BCh] [ebp-28h]
  PANE *pane; // [esp+C0h] [ebp-24h]
  int v68; // [esp+C4h] [ebp-20h]
  char *string; // [esp+C8h] [ebp-1Ch]
  char a2[4]; // [esp+CCh] [ebp-18h]
  int v71; // [esp+D0h] [ebp-14h]
  LONG shape_number; // [esp+D4h] [ebp-10h]

  pane = (PANE *)a1;
  v6 = &V_Game.stars[pPlanet->starIndex];
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_96B2A);
  if ( !ShapeTable_sub_1B084 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x41);
  }
  VFX_shape_draw(pane, ShapeTable_sub_1B084, v6->type, 0x4B, 0x4B);
  v8 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_96B2C);
  if ( !v8 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x45);
  }
  VFX_shape_draw(pane, v8, pPlanet->size + 5 * pPlanet->type, 0xC8, 0x4B);
  v68 = 4 * V_Game.races[V_RaceIndex].Unknown_02 + 0x13;
  v65 = v68;
  if ( a4 )
  {
    if ( V_Mouse.x >= 0x96 )
    {
      v68 = 0xF3;
    }
    else
    {
      v65 = 0xF3;
    }
  }
  racesBits = v6->racesBits;
  if ( racesBits == 1 << V_RaceIndex || v6 == V_Game.races[V_RaceIndex].star && ((1 << V_RaceIndex) & racesBits) != 0 )
  {
    Q_WINMGR_CPP_sub_53E38(pane, 4, 0xA, V_RaceIndex);
  }
  name = V_Game.stars[pPlanet->starIndex].name;
  WinMgr.SmallFont.pane = *pane;
  sub_2B8A8(&WinMgr.SmallFont, 0x78, 0x12, name, 0, v65, 0xFF, 0);
  string = pPlanet->name;
  v66 = (__int16)v68;
  WinMgr.LargeFont.pane = *pane;
  sub_2B8A8(&WinMgr.LargeFont, 0x113, 0xF, pPlanet->name, 0, v68, 0xFF, 0);
  v11 = sub_2B4F4(&WinMgr.LargeFont.pVfxFont, pPlanet->name) + 0x127;
  HIDWORD(v57) = dword_10469C[pPlanet->type];
  LODWORD(v57) = dword_104688[pPlanet->size];
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x88);// 136: "(%s %s Planet)"
  sprintf(s, sub_1CEA8, v57);
  WinMgr.SmallFont.pane = *pane;
  sub_2B8A8(&WinMgr.SmallFont, v11, 0x10, s, 0, v66, 0xFF, 0);
  z7 = pPlanet->z7;
  v63 = 0x1E;
  if ( z7 == 0xFFFFFFFF )
  {
    v14 = pane;
    v15 = v66;
    v16 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x89);    // 137: "Self-Managed"
    WinMgr.SmallFont.pane = *v14;
    v63 = 0x27;
    sub_2B8A8(&WinMgr.SmallFont, 0x113, 0x1E, v16, 0, v15, 0xFF, 0);
  }
  if ( pPlanet->buildingPlanetItemIndex == 0xFF )
  {
    v26 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x8D);    // 141: "No Project"
    v27 = 0;
    v28 = 0;
    do
    {
      v29 = v26[2 * v27];
      s[2 * v28] = v29;
      if ( !v29 )
      {
        break;
      }
      v30 = v26[2 * v27 + 1];
      s[2 * v28 + 1] = v30;
      ++v27;
      ++v28;
    }
    while ( v30 );
    if ( pPlanet->word42 == pPlanet->word4C )
    {
      v31 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x8E);  // 142: "   (No Free Population)"
      v32 = 0;
      v33 = &s[strlen(s)];
      v34 = 0;
      do
      {
        v35 = v31[2 * v32];
        v33[2 * v34] = v35;
        if ( !v35 )
        {
          break;
        }
        v36 = v31[2 * v32 + 1];
        v33[2 * v34 + 1] = v36;
        ++v32;
        ++v34;
      }
      while ( v36 );
    }
    v68 = 0xF3;
  }
  else
  {
    qmemcpy(v62, &unk_96B30, sizeof(v62));
    if ( (V_PlanetItems.item[pPlanet->buildingPlanetItemIndex].flags & 2) == 0 )
    {
      DaysToCompletePlanetItem_sub_358BC = (unsigned __int16)Q_GetDaysToCompletePlanetItem_sub_358BC(pPlanet);
      if ( (unsigned __int16)DaysToCompletePlanetItem_sub_358BC == 0xFFFF )
      {
        v18 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x8A);// 138: " - No Progress"
        v19 = 0;
        v20 = 0;
        do
        {
          v21 = v18[2 * v19];
          v62[2 * v20] = v21;
          if ( !v21 )
          {
            break;
          }
          v22 = v18[2 * v19 + 1];
          v62[2 * v20 + 1] = v22;
          ++v19;
          ++v20;
        }
        while ( v22 );
      }
      else
      {
        if ( DaysToCompletePlanetItem_sub_358BC == 1 )
        {
          v23 = 0x1C;                                  // 28: ""
        }
        else
        {
          v23 = 0x1D;                                  // 29: "s"
        }
        v58 = __PAIR64__((unsigned int)Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v23), DaysToCompletePlanetItem_sub_358BC);
        v24 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x8B);// 139: " - %d day%s until completion"
        sprintf(v62, v24, v58);
      }
    }
    HIDWORD(v59) = v62;
    LODWORD(v59) = V_PlanetItems.item[pPlanet->buildingPlanetItemIndex].name;
    v25 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x8C);    // 140: "Building %s%s"
    sprintf(s, v25, v59);
  }
  WinMgr.SmallFont.pane = *pane;
  sub_2B8A8(&WinMgr.SmallFont, 0x113, v63, s, 0, v68, 0xFF, 0);
  v37 = 0;
  v63 = 0x19;
  v38 = word_FFEDC;
  *(_DWORD *)a2 = (unsigned __int16)word_96B6C;
  do
  {
    v39 = sub_35930(pPlanet, a2[v37]);
    if ( v39 != 0xFFFF )
    {
      v39 = *((_WORD *)pPlanet->pUnknown_10 + 2 * v39 + 1) & 1;
      if ( v39 )
      {
        v55 = v63;
        v51 = (unsigned __int8)a2[v37];
        v40 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, v38);
        VFX_shape_transform(pane, v40, v51, 0xF5, v55, V_BigBuffer, 0, 0x4000, 0x4000, 0);
        v63 += 0x19;
      }
    }
    ++v37;
  }
  while ( v37 < 2 );
  LOWORD(v39) = word_FFEEC;
  v71 = v39;
  string = (char *)pPlanet->research;
  string = (char *)(int)pow((double)(int)string, 0.75);
  shape_number = (LONG)string;
  if ( (unsigned __int16)string > 0x14u )
  {
    shape_number = 0x14;
  }
  v52 = (unsigned __int16)shape_number;
  v41 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v71);
  VFX_shape_transform(pane, v41, v52, 0x118, 0x3C, V_BigBuffer, 0, 0x8000, 0x8000, 0);
  LOWORD(v42) = word_FFEEE;
  v71 = v42;
  string = (char *)pPlanet->industry;
  string = (char *)(int)pow((double)(int)string, 0.75);
  shape_number = (LONG)string;
  if ( (unsigned __int16)string > 0x14u )
  {
    shape_number = 0x14;
  }
  v53 = (unsigned __int16)shape_number;
  v43 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v71);
  VFX_shape_transform(pane, v43, v53, 0x15E, 0x3C, V_BigBuffer, 0, 0x8000, 0x8000, 0);
  LOWORD(v44) = word_FFEF0;
  v71 = v44;
  LOWORD(v44) = pPlanet->prosperity;
  shape_number = v44;
  if ( (unsigned __int16)v44 > 0x14u )
  {
    shape_number = 0x14;
  }
  v54 = (unsigned __int16)shape_number;
  v45 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v71);
  VFX_shape_transform(pane, v45, v54, 0x1A4, 0x3C, V_BigBuffer, 0, 0x8000, 0x8000, 0);
  LOWORD(v46) = word_FFEF8;
  hotY = 0x3C;
  v71 = v46;
  shape_number = 6;
  v47 = 0;
  for ( i = 0; ; ++i )
  {
    result = pPlanet->maximumPopulation;
    if ( v47 >= result )
    {
      break;
    }
    if ( v47 == (unsigned __int16)pPlanet->word4C )
    {
      shape_number = 7;
    }
    if ( v47 == pPlanet->word42 )
    {
      shape_number = 8;
    }
    v60 = hotY;
    x_4c = (unsigned __int16)shape_number;
    v50 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v71);
    VFX_shape_draw(pane, v50, x_4c, 5 * i + 0x1EA, v60);
    if ( v47 % 0xA == 9 )
    {
      hotY += 5;
    }
    ++v47;
  }
  return result;
}
// 50A78: variable 'v39' is possibly undefined
// 50B38: variable 'v42' is possibly undefined
// 50BF8: variable 'v44' is possibly undefined
// 50C99: variable 'v46' is possibly undefined
// 96B6C: using guessed type __int16 word_96B6C;
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEEC: using guessed type __int16 word_FFEEC;
// FFEEE: using guessed type __int16 word_FFEEE;
// FFEF0: using guessed type __int16 word_FFEF0;
// 50530: using guessed type char s[100];
// 50530: using guessed type char var_70[60];

//----- (00050D70) --------------------------------------------------------
void __fastcall sub_50D70(PPANE pPANE, P_Ship pShip, int a3, int a4)
{
  void *ShapeTable_sub_1B084; // eax
  P_Planet pvPlanet3; // esi
  char *v7; // eax
  void *v8; // eax
  P_Star vpStar; // ecx
  char *v10; // eax
  void *v11; // eax
  void **pPlanet; // edx
  float *v13; // esi
  float *v14; // eax
  P_Ship v15; // ebx
  double v16; // st7
  char v17; // ah
  char *name; // edi
  int v19; // esi
  P_Star v20; // eax
  int v21; // eax
  char *v22; // eax
  P_Planet pvPlanet1; // esi
  char *sub_1CEA8; // eax
  void *v25; // eax
  P_Planet pvPlanet2; // esi
  char *v27; // eax
  void *v28; // eax
  __int8 Unknown_5D; // bh
  P_Ship v30; // edx
  char *v31; // eax
  char *v32; // edi
  char *v33; // kr08_4
  int v34; // kr0C_4
  int v35; // kr2C_4
  char v36; // al
  char v37; // al
  int v38; // esi
  int v39; // kr14_4
  int Unknown_18; // eax
  int v41; // kr1C_4
  int v42; // kr34_4
  int v43; // kr44_4
  void *v44; // eax
  int v45; // edi
  int v46; // edi
  void *v47; // eax
  int Unknown_98; // eax
  int v49; // kr24_4
  int v50; // kr3C_4
  int v51; // kr4C_4
  int v52; // ebx
  __int16 v53; // si
  void *v54; // eax
  LONG v55; // [esp-4h] [ebp-174h]
  LONG v56; // [esp-4h] [ebp-174h]
  char *v57; // [esp+4h] [ebp-16Ch]
  __int16 x_4; // [esp+4h] [ebp-16Ch]
  LONG x_4a; // [esp+4h] [ebp-16Ch]
  LONG x_4b; // [esp+4h] [ebp-16Ch]
  char s[200]; // [esp+8h] [ebp-168h] BYREF
  PANE pane; // [esp+D0h] [ebp-A0h] BYREF
  int v63[5]; // [esp+E4h] [ebp-8Ch]
  int v64[3]; // [esp+F8h] [ebp-78h] BYREF
  float v65; // [esp+104h] [ebp-6Ch]
  float v66; // [esp+108h] [ebp-68h]
  float v67; // [esp+10Ch] [ebp-64h]
  LONG v68[2]; // [esp+110h] [ebp-60h]
  int v69[2]; // [esp+118h] [ebp-58h]
  int v70[3]; // [esp+120h] [ebp-50h]
  int v71; // [esp+12Ch] [ebp-44h]
  float v72; // [esp+130h] [ebp-40h]
  float v73; // [esp+134h] [ebp-3Ch]
  int v74; // [esp+138h] [ebp-38h]
  P_Ship vpShip; // [esp+13Ch] [ebp-34h]
  LONG v76; // [esp+140h] [ebp-30h]
  LONG x1; // [esp+144h] [ebp-2Ch]
  int v78; // [esp+148h] [ebp-28h]
  int v79; // [esp+14Ch] [ebp-24h]
  LONG shape_number; // [esp+150h] [ebp-20h]
  LONG hotY; // [esp+154h] [ebp-1Ch]
  int v82; // [esp+158h] [ebp-18h]
  int v83; // [esp+15Ch] [ebp-14h]
  int v84; // [esp+160h] [ebp-10h]

  vpShip = pShip;
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_96B6E);
  VFX_shape_draw(pPANE, ShapeTable_sub_1B084, pShip->hullSize, 0x41, 0x32);
  v83 = 4 * V_Game.races[V_RaceIndex].Unknown_02 + 0x13;
  if ( a4 )
  {
    v83 = 0xF3;
  }
  switch ( vpShip->locationType )
  {
    case 1u:
      pvPlanet1 = vpShip->pLocation.pPlanet;
      sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x93);// 147: "Under Construction at %s"
      sprintf(s, sub_1CEA8, pvPlanet1->name);
      v25 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_96B72);
      VFX_shape_draw(pPANE, v25, pvPlanet1->size + 5 * pvPlanet1->type, 0x24E, 0x31);
      break;
    case 2u:
      pvPlanet2 = vpShip->pLocation.pPlanet;
      v27 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x94);  // 148: "Being Refitted at %s"
      sprintf(s, v27, pvPlanet2->name);
      v28 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_96B72);
      VFX_shape_draw(pPANE, v28, 5 * pvPlanet2->type + pvPlanet2->size, 0x24E, 0x31);
      break;
    case 3u:
      pvPlanet3 = vpShip->pLocation.pPlanet;
      v7 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x8F);   // 143: "Orbiting %s"
      sprintf(s, v7, pvPlanet3->name);
      v8 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_96B72);
      VFX_shape_draw(pPANE, v8, pvPlanet3->size + 5 * pvPlanet3->type, 0x24E, 0x31);
      break;
    case 4u:
      vpStar = vpShip->pLocation.pStar;
      v10 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x90);  // 144: "in %s System"
      sprintf(s, v10, vpStar->name);
      v11 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_96B70);
      VFX_shape_draw(pPANE, v11, vpStar->type, 0x24E, 0x31);
      break;
    case 5u:
      pPlanet = (void **)vpShip->pLocation.pPlanet;
      v13 = (float *)pPlanet[1];
      v14 = (float *)*pPlanet;
      v70[2] = (int)v64;
      v65 = 0.0;
      v66 = 0.0;
      v67 = 0.0;
      v65 = v14[2] - v13[2];
      v66 = v14[3] - v13[3];
      v67 = v14[4] - v13[4];
      *(float *)v64 = v65;
      *(float *)&v64[1] = v66;
      *(float *)&v64[2] = v67;
      v15 = vpShip;
      v16 = sqrt(v66 * v66 + v65 * v65 + v67 * v67);
      v71 = v15->Unknown_C + vpShip->Unknown_8;
      v72 = v16;
      v17 = *((_BYTE *)pPlanet + 0x23);
      v73 = (float)v71;
      if ( (v17 & 1) != 0 )
      {
        v73 = v73 * 0.33333334;
      }
      if ( V_Game.races[vpShip->raceIndex].ability == 0x12 )
      {
        if ( v73 < 1.0 )
        {
          v73 = 1.0;
        }
        v73 = v73 * 2.0;
      }
      v71 = (int)((v72 - vpShip->vector.x) / v73);
      name = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x91); // 145: "Unknown"
      v19 = v71 + 1;
      if ( (LODWORD(vpShip->vector.y) & 0x7FFFFFFF) != 0 )
      {
        v20 = (P_Star)pPlanet[1];
      }
      else
      {
        v20 = (P_Star)*pPlanet;
      }
      if ( ((1 << V_RaceIndex) & (unsigned __int8)v20->Unknown_17) != 0 )
      {
        name = v20->name;
      }
      if ( v71 )
      {
        v21 = 0x1D;                                    // 29: "s"
      }
      else
      {
        v21 = 0x1C;                                    // 28: ""
      }
      v57 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v21);
      v22 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x92);  // 146: "In Starlane to %s System\nETA - %d Day%s"
      sprintf(s, v22, name, v19, v57);
      break;
    default:
      sprintf(s, "Bad m_LocationType");
      break;
  }
  Unknown_5D = vpShip->Unknown_5D;
  if ( Unknown_5D && Unknown_5D != 7 && vpShip->locationType == 4 )
  {
    v30 = vpShip;
    v31 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x95);    // 149: "\nMoving to Planet"
    if ( v30->Unknown_5D == 1 )
    {
      v31 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x96);  // 150: "\nMoving to Starlane"
    }
    v32 = &s[strlen(s)];
    v33 = v31;
    v34 = 0;
    v35 = 0;
    do
    {
      v36 = v33[2 * v34];
      v32[2 * v35] = v36;
      if ( !v36 )
      {
        break;
      }
      v37 = v33[2 * v34 + 1];
      v32[2 * v35 + 1] = v37;
      ++v34;
      ++v35;
    }
    while ( v37 );
  }
  v71 = (__int16)v83;
  WinMgr.SmallFont.pane = *pPANE;
  sub_2B8A8(&WinMgr.SmallFont, 0x17C, 5, s, 0, v83, 0xFF, 0x8E);
  sprintf(s, "%s", vpShip->name);
  WinMgr.LargeFont.pane = *pPANE;
  sub_2B8A8(&WinMgr.LargeFont, 0x96, 5, s, 0, v71, 0xFF, 0);
  v38 = 0;
  v74 = sub_4A8CC(vpShip);
  v39 = 0;
  do
  {
    if ( v38 >= v74 )
    {
      break;
    }
    x_4 = vpShip->raceIndex;
    ++v38;
    v44 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEE6);
    sub_53EB8(pPANE, v44, 6, 9 * v39++ + 0x103, 6, x_4);
  }
  while ( v38 < 9 );
  v63[0] = vpShip->Unknown_0;
  v63[1] = vpShip->Unknown_4;
  v63[2] = vpShip->Unknown_10;
  v63[3] = vpShip->Unknown_20;
  Unknown_18 = vpShip->Unknown_18;
  hotY = 0x19;
  v63[4] = Unknown_18;
  v78 = 0;
  pane = *pPANE;
  LOWORD(Unknown_18) = word_FFEE6;
  v84 = Unknown_18;
  v76 = 7;
  v41 = 0;
  v42 = 0;
  v43 = 0;
  do
  {
    pane.x1 = pane.x0 + 0x95;
    v45 = *(int *)((char *)v63 + v78);
    if ( v45 > 0 )
    {
      pane.x1 += 0xE * v45 / 4;
    }
    v46 = 0;
    shape_number = v76;
    do
    {
      x_4a = hotY;
      v55 = shape_number;
      v47 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v84);
      ++v46;
      VFX_shape_draw(&pane, v47, v55, v38 + 0xE * v43++, x_4a);
    }
    while ( v46 < 0xE );
    ++v76;
    ++v41;
    ++v42;
  }
  while ( v78 != 0x14 );
  v70[0] = vpShip->hullStrength;
  v70[1] = vpShip->Unknown_88;
  Unknown_98 = vpShip->Unknown_98;
  v79 = 0;
  v69[0] = Unknown_98;
  x1 = 0x16B;
  v69[1] = sub_4A8FC(vpShip);
  v68[1] = 0xB;
  v68[0] = 8;
  v49 = 0;
  v50 = 0;
  v51 = 0;
  do
  {
    if ( *(int *)((char *)v69 + v79) > 0 )
    {
      if ( *(int *)((char *)v70 + v79) >= 0 )
      {
        v52 = *(int *)((char *)v69 + v79);
        if ( *(int *)((char *)v70 + v79) > v52 )
        {
          *(int *)((char *)v70 + v79) = v52;
        }
      }
      else
      {
        *(int *)((char *)v70 + v79) = 0;
      }
      v53 = 0;
      v82 = v79;
      while ( v53 < 7 )
      {
        x_4b = 0xE * v53 + 5;
        v56 = *(LONG *)((char *)v68 + v82);
        v54 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)v84);
        ++v53;
        VFX_shape_draw(pPANE, v54, v56, 0x15E, x_4b);
      }
      sub_2BB74(pPANE, 0xE * v49 + 0x15E, 4, x1, 0x66 - 0x62 * *(int *)((char *)v70 + v82) / *(int *)((char *)v69 + v82), 0, 0xFFFFFFFF);
    }
    ++v49;
    ++v50;
    ++v51;
  }
  while ( v79 != 8 );
}
// 50D70: using guessed type char s[200];

//----- (00051610) --------------------------------------------------------
void __fastcall sub_51610(T_Type5 *a1, LONG a2, int a3, int a4)
{
  void *ShapeTable_sub_1B084; // eax
  void *v6; // eax

  if ( a4 == 0xFFFFFFFF )
  {
    VFX_pane_wipe((PANE *)a1, 0x96);
  }
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF4);
  VFX_shape_draw((PANE *)a1, ShapeTable_sub_1B084, a2, 0x38, 0x37);
  v6 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEE2);
  VFX_shape_draw((PANE *)a1, v6, 7, 0x38, 0x37);
}

//----- (00051674) --------------------------------------------------------
void __fastcall __spoils<> Q_WndSWCtor_sub_51674(P_WndSW a1)
{
  Q_A2Ctor_sub_2C830(&a1->a.a);
  a1->a.a.procs = (P_Procs)off_96128;
  Q_A11_sub_516D4(&a1->a);
}
// 96128: using guessed type int (*off_96128[5])();

//----- (00051690) --------------------------------------------------------
T_TypeA2 *__fastcall Q_WndSWDtor_sub_51690(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, &C_WndSW);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_96128;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 96128: using guessed type int (*off_96128[5])();

//----- (000516D4) --------------------------------------------------------
void __fastcall __spoils<> Q_A11_sub_516D4(P_TypeA11 result)
{
  result->Unknown_AB = 0;
}

//----- (000516E0) --------------------------------------------------------
void __fastcall sub_516E0(_DWORD *a1)
{
  int v1; // ebx
  int v2; // edx
  int v3; // kr04_4
  int v4; // eax
  int v5; // eax
  char *v6; // eax
  UBYTE Unknown_02; // al
  char *v8; // [esp-14h] [ebp-6Ch]
  int v9; // [esp-10h] [ebp-68h]
  char *v10; // [esp-Ch] [ebp-64h]
  char *sub_1CEA8; // [esp-4h] [ebp-5Ch]
  char s[80]; // [esp+0h] [ebp-58h] BYREF
  PANE *p_x0; // [esp+50h] [ebp-8h]
  _DWORD *v14; // [esp+54h] [ebp-4h]

  v14 = a1;
  v1 = 0;
  v2 = 0;
  if ( V_Game.starsNum > 0 )
  {
    v3 = 0;
    do
    {
      if ( V_Game.stars[v3].racesBits == 1 << V_RaceIndex && &V_Game.stars[v3] != V_Game.races[V_RaceIndex].star )
      {
        ++v1;
      }
      ++v2;
      ++v3;
    }
    while ( (__int16)v2 < V_Game.starsNum );
  }
  if ( ((1 << V_RaceIndex) & V_Game.races[V_RaceIndex].star->racesBits) != 0 )
  {
    ++v1;
  }
  if ( v1 == 1 )
  {
    v4 = 0x1C;
  }
  else
  {
    v4 = 0x1D;
  }
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v4);
  if ( *(_WORD *)(*(_DWORD *)((char *)v14 + 0xAB) + 0x8C7) == 1 )
  {
    v5 = 0x1C;
  }
  else
  {
    v5 = 0x1D;
  }
  v10 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v5);
  v9 = *(unsigned __int16 *)(*(_DWORD *)((char *)v14 + 0xAB) + 0x8C7);
  v8 = V_SpecNames[V_Game.races[V_RaceIndex].Unknown_01];
  v6 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x97);
  sprintf(s, v6, v8, v9, v10, v1, sub_1CEA8);
  Unknown_02 = V_Game.races[V_RaceIndex].Unknown_02;
  p_x0 = (PANE *)&CONTAINING_RECORD(v14, PANE, window)->x0;
  WinMgr.LargeFont.pane = *(PANE *)(v14 + 1);
  sub_2B8A8(&WinMgr.LargeFont, 0x19, 9, s, 2, 4 * Unknown_02 + 0x13, 0xFF, 0);
  Q_WINMGR_CPP_sub_53E38(p_x0, 3, 3, V_RaceIndex);
  sub_2D218(v14);
}

//----- (00051894) --------------------------------------------------------
unsigned int __fastcall sub_51894(int a1, __int16 a2, __int16 a3, LONG a4)
{
  T_TypeA2 *Wnd_sub_56DA8; // eax
  WORD i; // di
  T_Planet *v8; // esi
  unsigned __int16 v9; // ax
  T_Planet *v10; // eax

  if ( (unsigned __int16)a2 < 2u )
  {
    if ( a2 != 1 )
    {
      return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
    }
    if ( !*(_DWORD *)(a1 + 0xAB) )
    {
      Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&WinMgr, "STATPLANLST", 0);
      *(_DWORD *)(a1 + 0xAB) = Wnd_sub_56DA8;
      if ( !Wnd_sub_56DA8 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x1CB);
      }
      *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0xAB) = 0;
      *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8C9) = 0x8D;
      Q_A10_SetProc_sub_2F1C8(*(P_Wnd10LB *)(a1 + 0xAB), sub_50530);
      sub_2F1D8(*(_DWORD *)(a1 + 0xAB), (int)sub_10A14);
      *(_BYTE *)(*(_DWORD *)(a1 + 0xAB) + 0xC5) = 0;
      *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0xBB) = 0xFFFFFFFF;
    }
    if ( (unsigned __int16)word_96B2C == 0xFFFF )
    {
      LOWORD(word_96B2C) = sub_1B270(&WinMgr.t13, "DATA\\planets.shp", 0);
      if ( (unsigned __int16)word_96B2C == 0xFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x1D9);
      }
    }
    if ( (unsigned __int16)word_96B2A == 0xFFFF )
    {
      LOWORD(word_96B2A) = sub_1B270(&WinMgr.t13, "DATA\\suns.shp", 0);
      if ( (unsigned __int16)word_96B2A == 0xFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x1E0);
      }
    }
    sub_2ED4C(*(P_Wnd10LB *)(a1 + 0xAB));
    for ( i = 0; i < V_Game.planetsNum; ++i )
    {
      v8 = &V_Game.planets[i];
      if ( v8->raceIndex == V_RaceIndex )
      {
        v9 = sub_2EA8C(*(_DWORD *)(a1 + 0xAB), (const char *)v8, 0x96, 0);
        sub_2EC50(*(_DWORD *)(a1 + 0xAB), v9, v8->dayColonized);
      }
    }
    sub_2F1E0(*(_DWORD *)(a1 + 0xAB));
    sub_2ECDC(*(_DWORD *)(a1 + 0xAB), *(_WORD *)(a1 + 0xAF));
    return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
  }
  else if ( (unsigned __int16)a2 <= 2u )
  {
    *(_WORD *)(a1 + 0xAF) = *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8CD);
    return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
  }
  else
  {
    if ( a2 != 0x1C01 )
    {
      return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
    }
    v10 = (T_Planet *)sub_2ED14(*(_DWORD *)(a1 + 0xAB), a3);
    if ( V_Mouse.x <= 0x96 )
    {
      V_Game.pCurStar = &V_Game.stars[v10->starIndex];
      sub_56B60(&WinMgr, 1, 0x10, 1);
    }
    else
    {
      V_Game.pCurPlanet = v10;
      sub_56B60(&WinMgr, 1, 0x11, 1);
    }
    *(_WORD *)(a1 + 0xAF) = *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8CD);
    return 0;
  }
}

//----- (00051B64) --------------------------------------------------------
void __fastcall __spoils<> Q_WndFWCtor_sub_51B64(P_WndFW a1)
{
  Q_A2Ctor_sub_2C830(&a1->a.a);
  a1->a.a.procs = (P_Procs)off_96110;
  Q_A11_sub_516D4(&a1->a);
}
// 96110: using guessed type int (*off_96110[5])();

//----- (00051B80) --------------------------------------------------------
T_TypeA2 *__fastcall Q_WndFWDtor_sub_51B80(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, &C_WndFW);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_96110;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 96110: using guessed type int (*off_96110[5])();

//----- (00051BC4) --------------------------------------------------------
void __fastcall sub_51BC4(_DWORD *a1)
{
  int v1; // eax
  int v2; // edx
  const char *v3; // eax
  char *sub_1CEA8; // eax
  UBYTE Unknown_02; // al
  char *v6; // [esp-10h] [ebp-68h]
  int v7; // [esp-Ch] [ebp-64h]
  const char *v8; // [esp-8h] [ebp-60h]
  char s[80]; // [esp+0h] [ebp-58h] BYREF
  _DWORD *v10; // [esp+50h] [ebp-8h]
  PANE *p_x0; // [esp+54h] [ebp-4h]

  v10 = a1;
  v1 = sub_3EFE0(&V_Game.races[V_RaceIndex]);
  v2 = v1;
  if ( v1 >= 0 )
  {
    if ( v1 > 0x64 )
    {
      v2 = 0x64;
    }
  }
  else
  {
    v2 = 0;
  }
  if ( *(_WORD *)(*(_DWORD *)((char *)v10 + 0xAB) + 0x8C7) == 1 )
  {
    v3 = (const char *)&unk_92C97;
  }
  else
  {
    v3 = "s";
  }
  v8 = v3;
  v7 = *(unsigned __int16 *)(*(_DWORD *)((char *)v10 + 0xAB) + 0x8C7);
  v6 = V_SpecNames[V_Game.races[V_RaceIndex].Unknown_01];
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x98);// Static text 152
  sprintf(s, sub_1CEA8, v6, v7, v8, v2);
  Unknown_02 = V_Game.races[V_RaceIndex].Unknown_02;
  p_x0 = (PANE *)&CONTAINING_RECORD(v10, PANE, window)->x0;
  WinMgr.LargeFont.pane = *(PANE *)(v10 + 1);
  sub_2B8A8(&WinMgr.LargeFont, 0x19, 9, s, 2, 4 * Unknown_02 + 0x13, 0xFF, 0);
  Q_WINMGR_CPP_sub_53E38(p_x0, 3, 3, V_RaceIndex);
  sub_2D218(v10);
}

//----- (00051D24) --------------------------------------------------------
unsigned int __fastcall sub_51D24(int a1, __int16 a2, LONG a3, LONG a4)
{
  unsigned int result; // eax
  T_TypeA2 *Wnd_sub_56DA8; // eax
  int ShipsNum_sub_40224; // ebp
  int v8; // esi
  unsigned __int16 v9; // ax
  LONG v10; // ecx
  LONG v11; // ebx
  __int16 v12; // dx
  int v13; // eax
  int v14; // esi
  T_TypeA2 *v15; // eax
  int v16[107]; // [esp+0h] [ebp-1C8h] BYREF
  LONG v17; // [esp+1ACh] [ebp-1Ch]
  LONG v18; // [esp+1B0h] [ebp-18h]
  __int16 v19; // [esp+1B4h] [ebp-14h]
  __int16 i; // [esp+1B8h] [ebp-10h]

  v19 = a2;
  v18 = a3;
  v17 = a4;
  if ( (unsigned __int16)a2 < 2u )
  {
    if ( a2 != 1 )
    {
      return sub_2F424((T_TypeA2 *)a1, v19, v18, v17);
    }
    if ( !*(_DWORD *)(a1 + 0xAB) )
    {
      Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&WinMgr, "STATSHIPLST", 0);
      *(_DWORD *)(a1 + 0xAB) = Wnd_sub_56DA8;
      if ( !Wnd_sub_56DA8 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x259);
      }
      *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0xAB) = 0;
      *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8C9) = 0x6A;
      Q_A10_SetProc_sub_2F1C8(*(P_Wnd10LB *)(a1 + 0xAB), sub_50D70);
      sub_2F1D8(*(_DWORD *)(a1 + 0xAB), (int)sub_10A14);
      *(_BYTE *)(*(_DWORD *)(a1 + 0xAB) + 0xC5) = 0;
    }
    LOWORD(word_96B6E) = word_FFEBC[V_RaceIndex];
    if ( (unsigned __int16)word_96B72 == 0xFFFF )
    {
      LOWORD(word_96B72) = sub_1B270(&WinMgr.t13, "DATA\\planets.shp", 0);
      if ( (unsigned __int16)word_96B72 == 0xFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x269);
      }
    }
    if ( (unsigned __int16)word_96B70 == 0xFFFF )
    {
      LOWORD(word_96B70) = sub_1B270(&WinMgr.t13, "DATA\\suns.shp", 0);
      if ( (unsigned __int16)word_96B70 == 0xFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x270);
      }
    }
    sub_2ED4C(*(P_Wnd10LB *)(a1 + 0xAB));
    ShipsNum_sub_40224 = Q_Race_GetShipsNum_sub_40224(&V_Game.races[V_RaceIndex], (P_Ship *)v16, 0);
    for ( i = 0; i < ShipsNum_sub_40224; ++i )
    {
      v8 = v16[i];
      v9 = sub_2EA8C(*(_DWORD *)(a1 + 0xAB), (const char *)v8, 0x64, 0);
      sub_2EC50(*(_DWORD *)(a1 + 0xAB), v9, *(_DWORD *)(v8 + 0x52));
    }
    v10 = v17;
    sub_2F1E0(*(_DWORD *)(a1 + 0xAB));
    v11 = v18;
    sub_2ECDC(*(_DWORD *)(a1 + 0xAB), *(_WORD *)(a1 + 0xAF));
    return sub_2F424((T_TypeA2 *)a1, v19, v11, v10);
  }
  else if ( (unsigned __int16)a2 <= 2u )
  {
    v12 = v19;
    *(_WORD *)(a1 + 0xAF) = *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8CD);
    return sub_2F424((T_TypeA2 *)a1, v12, a3, a4);
  }
  else
  {
    if ( a2 != 0x1C01 )
    {
      return sub_2F424((T_TypeA2 *)a1, v19, v18, v17);
    }
    v13 = sub_2ED14(*(_DWORD *)(a1 + 0xAB), v18);
    v14 = v13;
    if ( a4 == 5 )
    {
      v15 = Q_FindWnd_sub_56DA8(&WinMgr, "SHIPDESSCREEN", 0);
      sub_4DA7C((int)v15, v14, 0, 0xFFFFFFFF);
      sub_56B60(&WinMgr, 1, 8, 1);
      *(_WORD *)(a1 + 0xAF) = *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8CD);
      return 0xFFFFFFFF;
    }
    else
    {
      switch ( *(_BYTE *)(v13 + 0x58) )
      {
        case 1:
        case 2:
        case 3:
          V_Game.pCurPlanet = *(P_Planet *)(v13 + 0x59);
          sub_56B60(&WinMgr, 1, 0x11, 1);
          *(_WORD *)(a1 + 0xAF) = *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8CD);
          result = 0xFFFFFFFF;
          break;
        case 4:
          V_Game.pCurStar = *(P_Star *)(v13 + 0x59);
          sub_56B60(&WinMgr, 1, 0x10, 1);
          *(_WORD *)(a1 + 0xAF) = *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8CD);
          result = 0xFFFFFFFF;
          break;
        case 5:
          sub_56B60(&WinMgr, 3, 0, 0);
          result = 0xFFFFFFFF;
          break;
        default:
          result = 0;
          break;
      }
    }
  }
  return result;
}
// FFEBC: using guessed type __int16 word_FFEBC[7];
// 51D24: using guessed type int var_1C8[107];

//----- (000520EC) --------------------------------------------------------
void __fastcall __spoils<> Q_WndNGCtor_sub_520EC(P_WndNG a1)
{
  Q_A2Ctor_sub_2C830(&a1->a);
  a1->a.procs = (P_Procs)off_960F8;
  Q_WndNG_sub_5214C(a1);
}
// 960F8: using guessed type int (*off_960F8[5])();

//----- (00052108) --------------------------------------------------------
T_TypeA2 *__fastcall Q_WndNGDtor_sub_52108(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, &C_WndNG);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_960F8;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 960F8: using guessed type int (*off_960F8[5])();

//----- (0005214C) --------------------------------------------------------
void __fastcall Q_WndNG_sub_5214C(P_WndNG result)
{
  result->Unknown_AF = 0;
  result->Unknown_AB = 0;
  result->Unknown_B3 = 0;
  result->Unknown_B5 = 0;
}

//----- (00052174) --------------------------------------------------------
int __fastcall sub_52174(int a1)
{
  int v1; // ecx
  int v2; // esi
  FILE *v3; // edi
  int v4; // kr04_4

  *(_DWORD *)(a1 + 0xAF) = &unk_109DF8;
  v1 = *(_DWORD *)(a1 + 0xAF);
  v2 = 0;
  v3 = Q_OpenFile_sub_1BB10("newgame.txt", 0);
  v4 = 0;
  do
  {
    fgets((char *)(v1 + 0xC8 * v4), 0xC7, v3);
    ++v2;
    ++v4;
  }
  while ( v2 < 0x15 );
  return fclose(v3);
}

//----- (000521C0) --------------------------------------------------------
void __fastcall sub_521C0(int a1, int edx0)
{
  char *sub_1CEA8; // eax
  int v4; // edi
  void *ShapeTable_sub_1B084; // ecx
  void *v6; // ecx
  unsigned __int16 v7; // ax
  void *v8; // eax
  int v9; // ebx
  char *v10; // eax
  int v11; // eax
  int v12; // edx
  int i; // kr04_4
  char *v14; // eax
  int v15; // ebx
  int j; // kr0C_4
  char *v17; // eax
  int v18; // ebx
  int k; // kr14_4
  char *v20; // eax
  char *v21; // eax
  __int16 v22; // si
  int v23; // kr1C_4
  int v24; // kr24_4
  LONG v25; // ebx
  void *v26; // eax
  LONG v27; // [esp-Ch] [ebp-15Ch]
  int v28; // [esp-Ch] [ebp-15Ch]
  int v29; // [esp-8h] [ebp-158h]
  int v30; // [esp-4h] [ebp-154h]
  int v31; // [esp-4h] [ebp-154h]
  char s[280]; // [esp+0h] [ebp-150h] BYREF
  PANE pane; // [esp+118h] [ebp-38h] BYREF
  int a2[3]; // [esp+12Ch] [ebp-24h]
  int v35; // [esp+138h] [ebp-18h]

  v35 = edx0;
  sub_52714(a1);
  pane.window = *(WINDOW **)(a1 + 4);
  pane.x0 = 0x1F6;
  pane.y0 = 7;
  pane.x1 = 0x278;
  pane.y1 = 0x24;
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x99);// 153: "Player Species"
  sprintf(s, sub_1CEA8);
  WinMgr.LargeFont.pane = pane;
  v4 = v35;
  sub_2B8A8(&WinMgr.LargeFont, 0, 0, s, 3, 0xF3, 0xFF, 0x6E);
  if ( !v4 )
  {
    pane = *(PANE *)(a1 + 4);
    VFX_pane_wipe((PANE *)(a1 + 4), 0);
    pane.y1 = 0x23;
    WinMgr.LargeFont.pane = pane;
    sub_2B8A8(
      &WinMgr.LargeFont,
      0,
      0,
      V_SpecNames[*(__int16 *)(a1 + 0xB3)],
      3,
      (unsigned __int8)byte_96779[*(__int16 *)(a1 + 0xB5)],
      0xFF,
      0);
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF4);
    if ( !ShapeTable_sub_1B084 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x325);
    }
    VFX_shape_draw((PANE *)(a1 + 4), ShapeTable_sub_1B084, *(__int16 *)(a1 + 0xB3), 0x4B, 0x55);
    v6 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEE2);
    if ( !v6 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x329);
    }
    VFX_shape_draw((PANE *)(a1 + 4), v6, *(__int16 *)(a1 + 0xB5), 0x4B, 0x55);
    v7 = sub_1B270(&WinMgr.t13, "DATA\\smhome.shp", 0xFFFFFFFF);
    if ( v7 == 0xFFFF )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x334);
    }
    v27 = *(__int16 *)(a1 + 0xB3);
    v8 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, v7);
    VFX_shape_draw((PANE *)(a1 + 4), v8, v27, 0x48, 0xCD);
    Q_WINMGR_CPP_sub_53E38((PANE *)(a1 + 4), 0x6B, 0xC1, V_RaceIndex);
    if ( !*(_DWORD *)(a1 + 0xAF) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x340);
    }
    if ( *(__int16 *)(a1 + 0xB3) >= 0x15 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x341);
    }
    v9 = *(__int16 *)(a1 + 0xB3);
    v30 = *(_DWORD *)(a1 + 0xAF) + 0xC8 * v9;
    v10 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x9A);    // 154: "The %s %s"
    sprintf(s, v10, V_SpecNames[v9], v30);
    pane.y0 = 0x109;
    pane.y1 = *(_DWORD *)(a1 + 0x14);
    v11 = *(__int16 *)(a1 + 0xB5);
    WinMgr.SmallFont.pane = pane;
    sub_2B8A8(&WinMgr.SmallFont, 0, 0, s, 0, (unsigned __int8)byte_96779[v11], 0xFF, 0x96);
    v12 = 0x9B;                                        // 155: "Vacuous"
    for ( i = 0; i != 5; ++i )
    {
      v14 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v12++);
      *(_DWORD *)&s[4 * i + 0xF0] = v14;
    }
    v15 = 0xA0;                                        // 160: "Peaceful"
    for ( j = 0; j != 3; ++j )
    {
      v17 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v15++);
      *((_DWORD *)&pane + j + 5) = v17;
    }
    v18 = 0xA3;                                        // 163: "Three"
    for ( k = 0; k != 5; ++k )
    {
      v20 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v18++);
      *(_DWORD *)&s[4 * k + 0x104] = v20;
    }
    pane.x0 = 0x11;
    pane.y0 = 0x145;
    pane.x1 = 0x144;
    pane.y1 = 0x172;
    v31 = a2[*(__int16 *)(a1 + 0xBB)];
    v29 = *(_DWORD *)&s[4 * *(__int16 *)(a1 + 0xB9) + 0xF8];
    v28 = *(_DWORD *)&s[4 * *(__int16 *)(a1 + 0xB7) + 0xF0];
    v21 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xA8);    // 168: "%s Star Cluster\n%s Species\n%s Atmosphere"
    sprintf(s, v21, v28, v29, v31);
    WinMgr.LargeFont.pane = pane;
    sub_2B8A8(&WinMgr.LargeFont, 0, 0, s, 0x82, 0xFFFFFFFF, 0, 0xFA);
    sub_552CC(&WinMgr, (PANE *)(a1 + 4));
    pane.window = V_Type6_stru_D8654.pane.window;
    pane.x1 = 0x18B;
    pane.y1 = 0x1CF;
    pane.x0 = 0x17D;
    pane.y0 = 0x1B1;
    v22 = 0;
    v23 = 0;
    v24 = 0;
    while ( v22 < 7 )
    {
      v25 = *(__int16 *)(a1 + 0xB3);
      v26 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEE0);
      sub_53F40((T_Type5 *)&pane, v26, v25, 0, 0, v22);
      if ( v22 == *(_WORD *)(a1 + 0xB5) )
      {
        sub_2BB74(&pane, 0, 0, 0xE, 0x18, 0xF3u, 0);
      }
      ++v22;
      ++v23;
      ++v24;
    }
    sub_55274(&WinMgr, 0x17B, 0x1A4, 0x1ED, 0x1D8);
  }
}
// 521C0: using guessed type int a2[3];

//----- (000526D8) --------------------------------------------------------
unsigned int sub_526D8()
{
  if ( V_Mouse.x <= 0x1F6 || V_Mouse.x >= 0x278 || V_Mouse.y <= 0x17D || V_Mouse.y >= 0x1D8 )
  {
    return 0;
  }
  else
  {
    return 0xFFFFFFFF;
  }
}

//----- (00052714) --------------------------------------------------------
int __fastcall sub_52714(int a1)
{
  LONG v1; // edx
  int v2; // eax
  int v3; // edi
  char *v4; // esi
  int v5; // kr04_4
  int v6; // ecx
  int v7; // edx
  int v8; // ebx
  char v9; // ah
  _DWORD *v10; // ebp
  void *ShapeTable_sub_1B084; // eax
  void *v12; // eax
  char *sub_1CEA8; // eax
  LONG v15; // [esp-20h] [ebp-60h]
  PANE pane; // [esp+0h] [ebp-40h] BYREF
  int v17; // [esp+14h] [ebp-2Ch]
  int v18; // [esp+18h] [ebp-28h]
  T_TypeA2 *v19; // [esp+1Ch] [ebp-24h]
  int v20; // [esp+20h] [ebp-20h]
  int v21; // [esp+24h] [ebp-1Ch]

  v17 = a1;
  pane.window = V_Type6_stru_D8654.pane.window;
  pane.x0 = 0x1F6;
  pane.y0 = 0x17D;
  pane.x1 = 0x278;
  v1 = 0xF2;
  pane.y1 = 0x1D8;
  if ( sub_526D8() == 0xFFFFFFFF )
  {
    v1 = 0x96;
  }
  VFX_pane_wipe(&pane, v1);
  sub_55274(&WinMgr, 0x1F6, 0x17D, 0x278, 0x1D8);
  v19 = sub_56E18(&WinMgr, "COSMOSWnd", 3, 0);
  if ( !v19 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x3BB);
  }
  HIWORD(v2) = HIWORD(v19);
  v3 = 0;
  LOWORD(v2) = v19[8].a1.e;
  v21 = v2;
  if ( (__int16)v2 > 0 )
  {
    v4 = (char *)&v19[2].a1.e + 2;
    v5 = 0;
    do
    {
      v8 = *(_DWORD *)&v4[4 * v5];
      v9 = *(_BYTE *)(v8 + 4);
      v20 = (int)(*(float *)(v8 + 0xD) + -1500.0);
      if ( !v9 )
      {
        v6 = 3;
        v10 = *(_DWORD **)v8;
        if ( v20 <= 0xDC )
        {
          if ( v20 <= 0 )
          {
            if ( v20 > (int)0xFFFFFF24 )
            {
              v6 = 2;
            }
          }
          else
          {
            v6 = 1;
          }
        }
        else
        {
          v6 = 0;
        }
        v7 = *(__int16 *)(v8 + 7);
        v18 = 5;
        VFX_shape_draw(&pane, (void *)v19[1].a1.magic12345678, 4 * *v10 + v6, *(__int16 *)(v8 + 5) / 5 + 5, v7 / 5 + 5);
      }
      ++v3;
      ++v5;
    }
    while ( (__int16)v3 < (__int16)v21 );
  }
  v15 = *(__int16 *)(v17 + 0xB3);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF4);
  VFX_shape_transform(&pane, ShapeTable_sub_1B084, v15, 0x62, 0x24, V_BigBuffer, 0, 0x8000, 0x8000, 0);
  v12 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEF2);
  sub_53EB8(&pane, v12, 3, 0x62, 0x24, 0);
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xA9);// 169: "Begin New Game"
  WinMgr.LargeFont.pane = pane;
  return sub_2B8A8(&WinMgr.LargeFont, 0x41, 0x50, sub_1CEA8, 0xC, 0xFFFFFFFF, 0xFF, 0);
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (0005294C) --------------------------------------------------------
unsigned int __fastcall sub_5294C(int a1, __int16 dx0, LONG a3, LONG a4)
{
  T_TypeA2 *v6; // eax
  int j; // kr04_4
  T_Wnd2COSW *v8; // eax
  WORD *p_Unknown_74; // eax
  T_TypeA2 *v10; // eax
  int v11; // eax
  T_TypeA2 *Wnd_sub_56DA8; // eax
  __int16 i; // si
  int v14; // eax
  int v15; // eax
  int v16; // eax
  __int16 v17; // bx
  __int16 v18; // edx^2
  LONG v19; // ecx
  LONG v20; // ebx
  __int16 v21; // dx
  int v22; // ecx
  int v23; // ebx
  int v24; // ebx
  _WORD v25[3]; // [esp+0h] [ebp-42h]
  int v26; // [esp+6h] [ebp-3Ch]
  int v27; // [esp+Ah] [ebp-38h]
  int v28; // [esp+Eh] [ebp-34h]
  int v29; // [esp+12h] [ebp-30h]
  PANE a2; // [esp+16h] [ebp-2Ch] BYREF
  LONG v31; // [esp+2Ah] [ebp-18h]
  LONG v32; // [esp+2Eh] [ebp-14h]
  __int16 v33; // [esp+32h] [ebp-10h]

  v33 = dx0;
  v32 = a3;
  v31 = a4;
  *(_DWORD *)&v25[1] = dword_96B74[0];
  v26 = dword_96B74[1];
  v27 = dword_96B74[2];
  v28 = dword_96B74[3];
  v29 = dword_96B74[4];
  if ( (unsigned __int16)dx0 < 0x1F5u )
  {
    if ( (unsigned __int16)dx0 < 2u )
    {
      if ( dx0 == 1 )
      {
        Q_SaveGam_sub_54048("resume.gam");
        dword_96BC0 = 0xFFFFFFFF;
        v11 = *(_DWORD *)(a1 + 0xAB);
        *(_DWORD *)&WinMgr.z5[8] = 0;
        if ( !v11 )
        {
          Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&WinMgr, "RACELIST", 0);
          *(_DWORD *)(a1 + 0xAB) = Wnd_sub_56DA8;
          if ( !Wnd_sub_56DA8 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x463);
          }
          *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0xAB) = 0;
          *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8C9) = 0x6D;
          Q_A10_SetProc_sub_2F1C8(*(P_Wnd10LB *)(a1 + 0xAB), sub_51610);
          sub_2E9CC(*(P_Wnd10LB *)(a1 + 0xAB), 0);
          *(_BYTE *)(*(_DWORD *)(a1 + 0xAB) + 0xC6) = 0xF2;
        }
        sub_2ED4C(*(P_Wnd10LB *)(a1 + 0xAB));
        for ( i = 0; i < 0x15; ++i )
        {
          sub_2EA8C(*(_DWORD *)(a1 + 0xAB), (const char *)i, 0x73, 0);
        }
        v14 = *(_DWORD *)(a1 + 0x67);
        *(_WORD *)(a1 + 0xB7) = 2;
        *(_DWORD *)(*(_DWORD *)v14 + 0x72) = 2;
        v15 = *(_DWORD *)(a1 + 0x67);
        *(_WORD *)(a1 + 0xB9) = 5;
        *(_DWORD *)(*(_DWORD *)(v15 + 4) + 0x72) = 7;
        v16 = *(_DWORD *)(a1 + 0x67);
        *(_WORD *)(a1 + 0xBB) = 1;
        *(_DWORD *)(*(_DWORD *)(v16 + 8) + 0x72) = 0xB;
        v17 = *(_WORD *)(a1 + 0xB9);
        V_Game.Unknown_D8A[0x2A] = 1;
        *(_WORD *)(a1 + 0xB3) = 0;
        sub_1E10C(&V_Game, v25[2 * *(__int16 *)(a1 + 0xB7) + 1], v17, *(_WORD *)(a1 + 0xB3));
        *(_WORD *)(a1 + 0xB5) = 0;
        V_RaceIndex = 0;
        V_Game.races[0].Unknown_01 = 0;
        sub_1EE08(&V_Game, *(_WORD *)(a1 + 0xB5));
        a2.window = *(WINDOW **)(a1 + 4);
        a2.y1 = 0x1D8;
        a2.x0 = 0x17B;
        a2.y0 = 0x1A4;
        a2.x1 = 0x1ED;
        VFX_pane_wipe(&a2, 0xF2);
        sub_552CC(&WinMgr, &a2);
        v18 = v33;
        v19 = v31;
        v20 = v32;
        sub_52174(a1);
        return sub_2F424((T_TypeA2 *)a1, v18, v20, v19);
      }
    }
    else
    {
      if ( (unsigned __int16)dx0 <= 2u )
      {
        return sub_2F424((T_TypeA2 *)a1, v33, a3, a4);
      }
      if ( (unsigned __int16)dx0 >= 4u )
      {
        if ( (unsigned __int16)dx0 <= 5u )
        {
          if ( a3 <= 0x17B || a3 >= 0x1ED || a4 <= 0x1A4 || a4 >= 0x1D8 )
          {
            if ( sub_526D8() == 0xFFFFFFFF )
            {
              Q_StartSample_sub_4FB90(&V_SoundSystem, 0);
              sub_1F404(&V_Game);
              sub_1F038(&V_Game);
              v6 = Q_FindWnd_sub_56DA8(&WinMgr, "BatModeWnd", 0);
              for ( j = 0; j != 0x64; ++j )
              {
                *(_DWORD *)((char *)&v6[0x1D].a1.shapeFrame + 4 * j + 1) = 0;
              }
              v8 = (T_Wnd2COSW *)Q_FindWnd_sub_56DA8(&WinMgr, "COSMOSWnd", 0);
              sub_2280C(v8);
              p_Unknown_74 = &Q_FindWnd_sub_56DA8(&WinMgr, "RESWIN", 0)[1].a1.Unknown_74;
              *((_DWORD *)p_Unknown_74 + 1) = 0;
              *((_DWORD *)p_Unknown_74 + 2) = 0;
              *(_DWORD *)p_Unknown_74 = 0x3F800000;
              *((_DWORD *)p_Unknown_74 + 3) = 0;
              *((_DWORD *)p_Unknown_74 + 4) = 0x3F800000;
              *((_DWORD *)p_Unknown_74 + 5) = 0;
              *((_DWORD *)p_Unknown_74 + 6) = 0;
              *((_DWORD *)p_Unknown_74 + 7) = 0;
              *((_DWORD *)p_Unknown_74 + 8) = 0x3F800000;
              v10 = Q_FindWnd_sub_56DA8(&WinMgr, "RACECONTROLS", 0);
              if ( !v10 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x444);
              }
              sub_2DD70((int)v10);
              V_Game.Unknown_D8A[0x2A] = *(_BYTE *)(a1 + 0xBB);
              sub_1EEA4(&V_Game);
              dword_96BC0 = 0;
              sub_56B60(&WinMgr, 1, 0xC, 0);
              return 0xFFFFFFFF;
            }
            else
            {
              return 0;
            }
          }
          else
          {
            Q_StartSample_sub_4FB90(&V_SoundSystem, 0);
            *(_WORD *)(a1 + 0xB5) = (a3 - 0x17B) / 0x10;
            sub_1EE08(&V_Game, *(_WORD *)(a1 + 0xB5));
            (*(void (__cdecl **)(_DWORD, int, int, int, int))(*(_DWORD *)(a1 + 0xA7) + 0xC))(*(_DWORD *)&v25[1], v26, v27, v28, v29);
            return 0xFFFFFFFF;
          }
        }
        if ( dx0 == 0xC )
        {
          if ( a3 > 0x17B && a3 < 0x1ED && a4 > 0x1A4 && a4 < 0x1D8 )
          {
            sub_56B60(&WinMgr, 5, (int)"pcolor", 0);
            return 0xFFFFFFFF;
          }
          if ( sub_526D8() == 0xFFFFFFFF )
          {
            sub_56B60(&WinMgr, 5, (int)"beghelp", 0);
            return 0xFFFFFFFF;
          }
        }
      }
    }
    return sub_2F424((T_TypeA2 *)a1, v33, v32, v31);
  }
  if ( (unsigned __int16)dx0 <= 0x1F5u )
  {
    if ( ++*(_WORD *)(a1 + 0xB7) == 5 )
    {
      *(_WORD *)(a1 + 0xB7) = 0;
    }
    v22 = *(__int16 *)(a1 + 0xB3);
    v23 = *(__int16 *)(a1 + 0xB9);
    sub_1E10C(&V_Game, v25[2 * *(__int16 *)(a1 + 0xB7) + 1], v23, v22);
    sub_24D30((int)WinMgr.wnds[dword_96BAC].a2, dword_96BAC, v23, v22);
    (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    *(_DWORD *)(**(_DWORD **)(a1 + 0x67) + 0x72) = *(__int16 *)(a1 + 0xB7);
    (*(void (__cdecl **)(_DWORD, int, int, int, int))(*(_DWORD *)(**(_DWORD **)(a1 + 0x67) + 0xA7) + 0xC))(
      *(_DWORD *)&v25[1],
      v26,
      v27,
      v28,
      v29);
    return 0xFFFFFFFF;
  }
  if ( (unsigned __int16)dx0 < 0x1F9u )
  {
    if ( dx0 == 0x1F7 )
    {
      if ( ++*(_WORD *)(a1 + 0xB9) == 8 )
      {
        *(_WORD *)(a1 + 0xB9) = 3;
      }
      v24 = *(__int16 *)(a1 + 0xB3);
      sub_1E70C(&V_Game, *(_WORD *)(a1 + 0xB9), v24);
      sub_24D30((int)WinMgr.wnds[dword_96BAC].a2, dword_96BAC, v24, a4);
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
      *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4) + 0x72) = *(__int16 *)(a1 + 0xB9) + 2;
      (*(void (__cdecl **)(_DWORD, int, int, int, int))(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4) + 0xA7) + 0xC))(
        *(_DWORD *)&v25[1],
        v26,
        v27,
        v28,
        v29);
      return 0xFFFFFFFF;
    }
    return sub_2F424((T_TypeA2 *)a1, v33, v32, v31);
  }
  if ( (unsigned __int16)dx0 <= 0x1F9u )
  {
    if ( ++*(_WORD *)(a1 + 0xBB) == 3 )
    {
      *(_WORD *)(a1 + 0xBB) = 0;
    }
    (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 8) + 0x72) = *(__int16 *)(a1 + 0xBB) + 0xA;
    (*(void (__cdecl **)(_DWORD, int, int, int, int))(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 8) + 0xA7) + 0xC))(
      *(_DWORD *)&v25[1],
      v26,
      v27,
      v28,
      v29);
    return 0xFFFFFFFF;
  }
  else
  {
    if ( (unsigned __int16)dx0 <= 0x1FAu || dx0 != 0x1C01 )
    {
      return sub_2F424((T_TypeA2 *)a1, v33, v32, v31);
    }
    if ( *(__int16 *)(a1 + 0xB3) != a3 )
    {
      v21 = *(_WORD *)(a1 + 0xB9);
      *(_WORD *)(a1 + 0xB3) = v32;
      sub_1E70C(&V_Game, v21, *(_WORD *)(a1 + 0xB3));
      (*(void (__cdecl **)(_DWORD, int, int, int, int))(*(_DWORD *)(a1 + 0xA7) + 0xC))(*(_DWORD *)&v25[1], v26, v27, v28, v29);
    }
    return 0xFFFFFFFF;
  }
}
// 96B74: using guessed type _DWORD dword_96B74[5];
// 96BAC: using guessed type int dword_96BAC;
// 96BC0: using guessed type int dword_96BC0;

//----- (00053000) --------------------------------------------------------
void __fastcall Q_NormVector3D_sub_53000(T_Vector3D *a1)
{
  double v2; // st7
  float len; // [esp+Ch] [ebp-8h]

  len = sqrt(a1->y * a1->y + a1->x * a1->x + a1->z * a1->z);
  if ( len > 0.0 )
  {
    v2 = 1.0 / len;
    a1->x = a1->x * v2;
    a1->y = a1->y * v2;
    a1->z = v2 * a1->z;
  }
}

//----- (00053054) --------------------------------------------------------
void __fastcall sub_53054(float *a1, float a2)
{
  Q_NormVector3D_sub_53000((T_Vector3D *)a1);
  *a1 = *a1 * a2;
  a1[1] = a1[1] * a2;
  a1[2] = a2 * a1[2];
}

//----- (00053078) --------------------------------------------------------
unsigned int __fastcall sub_53078(_DWORD *a1)
{
  if ( (*a1 & 0x7FFFFFFF) != 0 || (a1[1] & 0x7FFFFFFF) != 0 || (a1[2] & 0x7FFFFFFF) != 0 )
  {
    return 0;
  }
  else
  {
    return 0xFFFFFFFF;
  }
}

//----- (0005309C) --------------------------------------------------------
double __fastcall sub_5309C(float *a1, float *a2)
{
  double x; // st7
  float v4; // [esp+8h] [ebp-4h]
  float v5; // [esp+8h] [ebp-4h]

  v4 = a1[1] * a2[1] + *a1 * *a2 + a1[2] * a2[2];
  v5 = v4 / sqrt(a1[1] * a1[1] + *a1 * *a1 + a1[2] * a1[2]);
  x = v5 / sqrt(a2[1] * a2[1] + *a2 * *a2 + a2[2] * a2[2]);
  return acos(x) * 57.29578;
}

//----- (00053114) --------------------------------------------------------
float *__fastcall sub_53114(float *result, float *a2)
{
  float v2; // [esp+0h] [ebp-1Ch]
  float v3; // [esp+4h] [ebp-18h]
  float v4; // [esp+8h] [ebp-14h]

  v2 = *result;
  v3 = result[1];
  v4 = result[2];
  *result = v3 * a2[1] + *result * *a2 + v4 * a2[2];
  result[1] = v3 * a2[4] + v2 * a2[3] + v4 * a2[5];
  result[2] = v3 * a2[7] + v2 * a2[6] + v4 * a2[8];
  return result;
}

//----- (0005323C) --------------------------------------------------------
P_Vector3D __fastcall sub_5323C(P_Vector3D result, float a2)
{
  P_Vector3D v5; // edx
  double v6; // st7
  float v7; // [esp+Ch] [ebp-14h]

  v5 = result;
  if ( (LODWORD(a2) & 0x7FFFFFFF) != 0 )
  {
    v7 = cos(a2 * 0.017453292);
    v6 = sin(a2 * 0.017453292);
    result = (P_Vector3D)LODWORD(v5->y);
    v5->y = *(float *)&result * v7 - v5->z * v6;
    v5->z = v6 * *(float *)&result + v5->z * v7;
  }
  return result;
}
// 5323C: could not find valid save-restore pair for esi

//----- (000532AC) --------------------------------------------------------
void __fastcall Q_RotateVectorY_sub_532AC(T_Vector3D *vector, float degrees)
{
  double b; // st7
  float x; // [esp+8h] [ebp-18h]
  float a; // [esp+Ch] [ebp-14h]

  if ( (LODWORD(degrees) & 0x7FFFFFFF) != 0 )
  {
    a = cos(degrees * 0.017453292);
    b = sin(degrees * 0.017453292);
    x = vector->x;
    vector->x = vector->z * b + vector->x * a;
    vector->z = vector->z * a - b * x;
  }
}
// 532AC: could not find valid save-restore pair for esi

//----- (00053318) --------------------------------------------------------
float *__fastcall sub_53318(float *result, float a2)
{
  float *v5; // edx
  double v6; // st7
  float v7; // [esp+8h] [ebp-18h]
  float v8; // [esp+Ch] [ebp-14h]

  v5 = result;
  if ( (LODWORD(a2) & 0x7FFFFFFF) != 0 )
  {
    v8 = cos(a2 * 0.017453292);
    v6 = sin(a2 * 0.017453292);
    result = *(float **)v5;
    v7 = *v5;
    *v5 = *v5 * v8 - v5[1] * v6;
    v5[1] = v6 * v7 + v5[1] * v8;
  }
  return result;
}
// 53318: could not find valid save-restore pair for esi

//----- (00053384) --------------------------------------------------------
float *__fastcall sub_53384(float *result, float *a2, float *a3)
{
  *a3 = a2[1] * result[1] + *a2 * *result + a2[2] * result[2] + a2[3];
  a3[1] = a2[5] * result[1] + a2[4] * *result + a2[6] * result[2] + a2[7];
  a3[2] = a2[9] * result[1] + a2[8] * *result + a2[0xA] * result[2] + a2[0xB];
  return result;
}

//----- (000533D4) --------------------------------------------------------
void __fastcall sub_533D4(P_Vector3D a1, float a2, int a3, int a4, int a5, int a6)
{
  double v6; // st5
  double v7; // st7

  v6 = 1.0 / a1->z;
  v7 = a2 * a1->y * v6;
  *(_WORD *)a5 = (int)(a1->x * a2 * v6 + 0.5);
  *(_WORD *)a6 = (int)(v7 + 0.5);
  *(_WORD *)a5 += a3;
  *(_WORD *)a6 += a4;
}

//----- (00053440) --------------------------------------------------------
void __fastcall sub_53440(T_Vector3D *pVector)
{
  int v1; // ebx
  int v3; // eax
  int v4; // ett
  int v5; // eax
  int v6; // ett
  int v7; // eax
  int v8; // ett

  v1 = dword_96B88;
  if ( pVector->x < 0.0 )
  {
    v3 = -dword_96B88;
  }
  else
  {
    v3 = dword_96B88;
  }
  v4 = (int)((double)(v3 / 2) + pVector->x);
  pVector->x = (float)(dword_96B88 * (v4 / dword_96B88));
  if ( pVector->y < 0.0 )
  {
    v5 = -v1;
  }
  else
  {
    v5 = v1;
  }
  v6 = (int)((double)(v5 / 2) + pVector->y);
  pVector->y = (float)(v1 * (v6 / v1));
  if ( pVector->z < 0.0 )
  {
    v7 = -v1;
  }
  else
  {
    v7 = v1;
  }
  v8 = (int)((double)(v7 / 2) + pVector->z);
  pVector->z = (float)(v1 * (v8 / v1));
  dword_96B88 = v1;
}
// 96B88: using guessed type int dword_96B88;

//----- (0005353C) --------------------------------------------------------
void __fastcall sub_5353C(float *a1, int a2, int a3, int a4, int a5)
{
  if ( (a5 & 0x7FFFFFFF) != 0 )
  {
    sub_5323C((P_Vector3D)a1 + 2, *(float *)&a5);
    sub_53644(a1, (int)a1, a5, a4);
  }
}

//----- (00053564) --------------------------------------------------------
void __fastcall sub_53564(float *a1, int edx0, int a3, int a4, int a2)
{
  if ( (a2 & 0x7FFFFFFF) != 0 )
  {
    Q_RotateVectorY_sub_532AC((T_Vector3D *)a1 + 2, *(float *)&a2);
    sub_53754(a1, (int)a1, a2, a4);
  }
}

//----- (0005358C) --------------------------------------------------------
void __userpurge sub_5358C(P_Wnd9RW1 a1@<eax>, float a2)
{
  if ( (LODWORD(a2) & 0x7FFFFFFF) != 0 )
  {
    sub_53318(&a1->matrix_00.vector2.x, a2);
    sub_53864(&a1->matrix_00);
  }
}

//----- (000535B4) --------------------------------------------------------
void __fastcall sub_535B4(P_Wnd9RW1 a1, float a2)
{
  if ( (LODWORD(a2) & 0x7FFFFFFF) != 0 )
  {
    sub_5323C(&a1->matrix_00.vector3, a2);
    sub_5323C(&a1->matrix_00.vector2, a2);
    sub_53864(&a1->matrix_00);
  }
}

//----- (000535E4) --------------------------------------------------------
void __userpurge sub_535E4(P_Wnd9RW1 a1@<eax>, float degrees)
{
  if ( (LODWORD(degrees) & 0x7FFFFFFF) != 0 )
  {
    Q_RotateVectorY_sub_532AC(&a1->matrix_00.vector3, degrees);
    Q_RotateVectorY_sub_532AC(&a1->matrix_00.vector2, degrees);
    sub_53864(&a1->matrix_00);
  }
}

//----- (00053644) --------------------------------------------------------
void __fastcall sub_53644(float *a1, int a2, int a3, int a4)
{
  double v5; // st7
  double v6; // st6
  double v7; // st7
  double v8; // st6
  float v9; // [esp+0h] [ebp-48h]
  float v10; // [esp+4h] [ebp-44h]
  float v11; // [esp+8h] [ebp-40h]
  float v12; // [esp+Ch] [ebp-3Ch] BYREF
  float v13; // [esp+10h] [ebp-38h]
  float v14; // [esp+14h] [ebp-34h]
  float v15; // [esp+18h] [ebp-30h]
  float v16; // [esp+1Ch] [ebp-2Ch]
  float v17; // [esp+20h] [ebp-28h]
  float v18; // [esp+24h] [ebp-24h] BYREF
  float v19; // [esp+28h] [ebp-20h]
  float v20; // [esp+2Ch] [ebp-1Ch]
  float *v21; // [esp+30h] [ebp-18h]
  float *v22; // [esp+34h] [ebp-14h]

  Q_NormVector3D_sub_53000((T_Vector3D *)a1);
  v21 = &v12;
  v15 = 0.0;
  v16 = 0.0;
  v17 = 0.0;
  v15 = a1[7] * a1[2] - a1[8] * a1[1];
  v16 = a1[8] * *a1 - a1[6] * a1[2];
  v5 = a1[6] * a1[1];
  v6 = a1[7] * *a1;
  v12 = v15;
  v17 = v5 - v6;
  v13 = v16;
  v14 = v17;
  a1[3] = v15;
  a1[4] = v13;
  a1[5] = v14;
  Q_NormVector3D_sub_53000((T_Vector3D *)a1 + 1);
  v22 = &v18;
  v9 = a1[1] * a1[5] - a1[2] * a1[4];
  v10 = a1[2] * a1[3] - *a1 * a1[5];
  v7 = *a1 * a1[4];
  v8 = a1[1] * a1[3];
  v18 = v9;
  v11 = v7 - v8;
  v19 = v10;
  v20 = v11;
  a1[6] = v9;
  a1[7] = v19;
  a1[8] = v20;
  Q_NormVector3D_sub_53000((T_Vector3D *)a1 + 2);
}

//----- (00053754) --------------------------------------------------------
void __fastcall sub_53754(float *a1, int a2, int a3, int a4)
{
  float *v5; // edx
  double v6; // st7
  double v7; // st6
  double v8; // st7
  double v9; // st6
  float v10; // [esp+0h] [ebp-48h]
  float v11; // [esp+4h] [ebp-44h]
  float v12; // [esp+8h] [ebp-40h]
  float v13; // [esp+Ch] [ebp-3Ch] BYREF
  float v14; // [esp+10h] [ebp-38h]
  float v15; // [esp+14h] [ebp-34h]
  float v16; // [esp+18h] [ebp-30h]
  float v17; // [esp+1Ch] [ebp-2Ch]
  float v18; // [esp+20h] [ebp-28h]
  float v19; // [esp+24h] [ebp-24h] BYREF
  float v20; // [esp+28h] [ebp-20h]
  float v21; // [esp+2Ch] [ebp-1Ch]
  float *v22; // [esp+30h] [ebp-18h]
  float *v23; // [esp+34h] [ebp-14h]

  v5 = a1 + 3;
  Q_NormVector3D_sub_53000((T_Vector3D *)a1 + 1);
  v16 = 0.0;
  v17 = 0.0;
  v18 = 0.0;
  v22 = &v13;
  v16 = v5[1] * a1[8] - v5[2] * a1[7];
  v17 = v5[2] * a1[6] - *v5 * a1[8];
  v6 = *v5 * a1[7];
  v7 = v5[1] * a1[6];
  v13 = v16;
  v18 = v6 - v7;
  v14 = v17;
  v15 = v18;
  *a1 = v16;
  a1[1] = v14;
  a1[2] = v15;
  Q_NormVector3D_sub_53000((T_Vector3D *)a1);
  v23 = &v19;
  v10 = a1[1] * v5[2] - a1[2] * v5[1];
  v11 = a1[2] * *v5 - *a1 * v5[2];
  v8 = *a1 * v5[1];
  v9 = a1[1] * *v5;
  v19 = v10;
  v12 = v8 - v9;
  v20 = v11;
  v21 = v12;
  a1[6] = v10;
  a1[7] = v20;
  a1[8] = v21;
  Q_NormVector3D_sub_53000((T_Vector3D *)a1 + 2);
}

//----- (00053864) --------------------------------------------------------
void __fastcall sub_53864(P_Matrix a1)
{
  T_Vector3D *p_vector3; // edx
  T_Vector3D *p_vector2; // ecx
  double v4; // st7
  double v5; // st6
  double v6; // st7
  double v7; // st6
  float v8; // [esp+0h] [ebp-48h]
  float v9; // [esp+4h] [ebp-44h]
  float v10; // [esp+8h] [ebp-40h]
  float v11; // [esp+Ch] [ebp-3Ch] BYREF
  float v12; // [esp+10h] [ebp-38h]
  float v13; // [esp+14h] [ebp-34h]
  float v14; // [esp+18h] [ebp-30h]
  float v15; // [esp+1Ch] [ebp-2Ch]
  float v16; // [esp+20h] [ebp-28h]
  float v17; // [esp+24h] [ebp-24h] BYREF
  float v18; // [esp+28h] [ebp-20h]
  float v19; // [esp+2Ch] [ebp-1Ch]
  float *v20; // [esp+30h] [ebp-18h]
  float *v21; // [esp+34h] [ebp-14h]

  p_vector3 = &a1->vector3;
  p_vector2 = &a1->vector2;
  Q_NormVector3D_sub_53000(&a1->vector3);
  v14 = 0.0;
  v15 = 0.0;
  v16 = 0.0;
  v20 = &v11;
  v14 = p_vector2->y * p_vector3->z - p_vector2->z * p_vector3->y;
  v15 = p_vector2->z * p_vector3->x - p_vector2->x * p_vector3->z;
  v4 = p_vector2->x * p_vector3->y;
  v5 = p_vector2->y * p_vector3->x;
  v11 = v14;
  v16 = v4 - v5;
  v12 = v15;
  v13 = v16;
  a1->vector1.x = v14;
  a1->vector1.y = v12;
  a1->vector1.z = v13;
  Q_NormVector3D_sub_53000(&a1->vector1);
  v21 = &v17;
  v8 = p_vector3->y * a1->vector1.z - p_vector3->z * a1->vector1.y;
  v9 = p_vector3->z * a1->vector1.x - p_vector3->x * a1->vector1.z;
  v6 = p_vector3->x * a1->vector1.y;
  v7 = p_vector3->y * a1->vector1.x;
  v17 = v8;
  v10 = v6 - v7;
  v18 = v9;
  v19 = v10;
  p_vector2->x = v8;
  p_vector2->y = v18;
  p_vector2->z = v19;
  Q_NormVector3D_sub_53000(p_vector2);
}

//----- (00053B08) --------------------------------------------------------
float *__fastcall sub_53B08(float *result, float *a2, float *a3, float *a4)
{
  *result = a3[1] * a2[1] + *a3 * *a2 + a3[2] * a2[2];
  result[1] = a3[4] * a2[1] + a3[3] * *a2 + a3[5] * a2[2];
  result[2] = a3[7] * a2[1] + a3[6] * *a2 + a3[8] * a2[2];
  result[4] = a3[1] * a2[4] + *a3 * a2[3] + a3[2] * a2[5];
  result[5] = a3[3] * a2[3] + a3[4] * a2[4] + a3[5] * a2[5];
  result[6] = a3[6] * a2[3] + a3[7] * a2[4] + a3[8] * a2[5];
  result[8] = a3[1] * a2[7] + *a3 * a2[6] + a3[2] * a2[8];
  result[9] = a3[3] * a2[6] + a3[4] * a2[7] + a3[5] * a2[8];
  result[0xA] = a3[6] * a2[6] + a3[7] * a2[7] + a3[8] * a2[8];
  result[3] = a4[1] * a2[1] + *a4 * *a2 + a4[2] * a2[2];
  result[7] = a4[1] * a2[4] + *a4 * a2[3] + a4[2] * a2[5];
  result[0xB] = a4[1] * a2[7] + *a4 * a2[6] + a4[2] * a2[8];
  return result;
}

//----- (00053D22) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __cdecl sub_53D22(int a1)
{
  int v5; // edx
  unsigned int v6; // kr00_4
  int result; // eax
  __int16 v8; // [esp-Ah] [ebp-16h]
  void *retaddr; // [esp+10h] [ebp+4h]

  v6 = __readeflags();
  _disable();
  __asm { int     31h; DPMI Services   ax=func xxxxh }
  DMPI_selector_dword_53D1C = v5;
  DMPI_real_mode_segment_base_word_53D0C = 0x100;
  word_53CEA = 0;
  word_53D06 = 0x4F01;
  word_53D02 = a1;
  word_53D0E = 0;
  __asm { pushfw }
  word_53D0A = v8;
  __asm
  {
    int     31h; DPMI Services   ax=func xxxxh
    int     31h; DPMI Services   ax=func xxxxh
  }
  result = 0;
  _ZF = (BYTE1(retaddr) & 2) == 0;
  _disable();
  if ( !_ZF )
  {
    _enable();
  }
  __writeeflags(v6);
  return result;
}
// 53D37: write access to const memory at 53D1C has been detected
// 53D3D: write access to const memory at 53D0C has been detected
// 53D43: write access to const memory at 53CEA has been detected
// 53D51: write access to const memory at 53D06 has been detected
// 53D5A: write access to const memory at 53D02 has been detected
// 53D60: write access to const memory at 53D0E has been detected
// 53D6D: write access to const memory at 53D0A has been detected
// 53D37: variable 'v5' is possibly undefined
// 53D6D: variable 'v8' is possibly undefined
// 53CEA: using guessed type __int16 word_53CEA;
// 53D02: using guessed type __int16 word_53D02;
// 53D06: using guessed type __int16 word_53D06;
// 53D0A: using guessed type __int16 word_53D0A;
// 53D0C: using guessed type __int16 DMPI_real_mode_segment_base_word_53D0C;
// 53D0E: using guessed type __int16 word_53D0E;
// 53D1C: using guessed type int DMPI_selector_dword_53D1C;

//----- (00053DC0) --------------------------------------------------------
void sub_53DC0()
{
  _wcpp_2_mod_register_(&dword_96B8C);
  Q_WinMgrCtor_sub_54344(&WinMgr);
  dword_96B94 = 1;
}
// 96B8C: using guessed type _DWORD dword_96B8C;
// 96B94: using guessed type int dword_96B94;

//----- (00053DE4) --------------------------------------------------------
void __cdecl Q_Timer_sub_53DE4()
{
  ++V_Timer_dword_132B58;
}
// 132B58: using guessed type int V_Timer_dword_132B58;

//----- (00053DEC) --------------------------------------------------------
int Q_CheckFreeMemory_sub_53DEC()
{
  int chunk; // edx
  int largest; // ecx
  MACRO_VFX_BOOL finished; // edi
  void *tmp; // eax

  chunk = 0x2000000;
  largest = 0;
  finished = FALSE;
  do
  {
    tmp = malloc(largest + chunk);
    if ( tmp )
    {
      largest += chunk;
    }
    if ( largest == 0x2000000 || chunk < 0x1000 )
    {
      finished = TRUE;
    }
    free(tmp);
    chunk >>= 1;
  }
  while ( finished == FALSE );
  return largest;
}

//----- (00053E38) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_sub_53E38(PANE *pane, LONG hotX, LONG hotY, __int16 a4)
{
  void *shapeTable; // ebp

  if ( a4 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xD0);
  }
  shapeTable = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEE0);
  if ( !shapeTable )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xD5);
  }
  sub_53EB8(pane, shapeTable, V_Game.races[a4].Unknown_01, hotX, hotY, a4);
}

//----- (00053EB8) --------------------------------------------------------
void __fastcall sub_53EB8(PANE *pane, void *shape_table, LONG shape_number, LONG hotX, LONG hotY, __int16 a6)
{
  __int16 v9; // ax
  UBYTE v10; // dl
  int v11; // ecx

  v9 = 0;
  v10 = 4 * V_Game.races[a6].Unknown_02 + 0x13;
  while ( v9 < 4 )
  {
    v11 = 0x13 - v9++;
    (*WinMgr.hazeTableMapRaces)[v11] = v10--;
  }
  VFX_shape_lookaside((UBYTE *)WinMgr.hazeTableMapRaces);
  VFX_shape_translate_draw(pane, shape_table, shape_number, hotX, hotY);
}

//----- (00053F40) --------------------------------------------------------
void __fastcall sub_53F40(T_Type5 *a1, void *a2, LONG a3, LONG a4, int a5, char a6)
{
  __int16 v8; // ax
  UBYTE v9; // dl
  int v10; // ecx

  v8 = 0;
  v9 = 4 * a6 + 0x13;
  while ( v8 < 4 )
  {
    v10 = 0x13 - v8++;
    (*WinMgr.hazeTableMapRaces)[v10] = v9--;
  }
  VFX_shape_lookaside((UBYTE *)WinMgr.hazeTableMapRaces);
  VFX_shape_translate_draw((PANE *)a1, a2, a3, a4, a5);
}

//----- (00053FB0) --------------------------------------------------------
void __fastcall Q_LoadGam_sub_53FB0(const char *fname)
{
  char *sub_1CEA8; // eax
  T_FileInfo fi; // [esp+0h] [ebp-18Ch] BYREF
  char buf[116]; // [esp+118h] [ebp-74h] BYREF

  Q_InitFileInfo_sub_1BB78(&fi);
  if ( Q_OpenFile_sub_1BBFC(&fi, fname, O_BINARY, 0) )
  {
    sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xAA);// 170: "Unable to open file."
    Q_ShowMsgBox_sub_556CC(&WinMgr, sub_1CEA8);
  }
  else
  {
    Q_ReadFile_sub_1BF94(&fi, buf, 0x74u);
    Q_LoadGam_sub_21AA0(&V_Game, &fi);
    sub_56BE8(&WinMgr, 0xD, 0, 0, 0);
    Q_WinMgr_CallProc6_sub_5A294(&WinMgr, &fi, TRUE);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&fi);
}

//----- (00054048) --------------------------------------------------------
T_FileInfo *__fastcall Q_SaveGam_sub_54048(const char *fname)
{
  int i; // edx
  int v2; // kr04_4
  int v3; // kr1C_4
  int v4; // eax
  int v5; // kr0C_4
  int v6; // kr24_4
  int v7; // eax
  int v8; // kr14_4
  int v9; // ebx
  T_FileInfo *result; // eax
  char *v1; // eax
  T_FileInfo fi; // [esp-118h] [ebp-198h] BYREF
  T_SavBlock0Header v13; // [esp+0h] [ebp-80h] BYREF

  Q_InitFileInfo_sub_1BB78(&fi);
  if ( Q_OpenFile_sub_1BCA8(&fi, fname) )
  {
    v1 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xAA);     // 170: "Unable to open file."
    Q_ShowMsgBox_sub_556CC(&WinMgr, v1);
    result = &fi;
    Q_CloseFileAndDelete_sub_1BBC8(&fi);
  }
  else
  {
    v13.day = V_Game.day;
    v13.races = V_Game.racesNum;
    i = 0;
    v13._playerRaceIndex = V_RaceIndex;
    v2 = 0;
    v3 = 0;
    while ( i < V_Game.racesNum )
    {
      ++i;
      v13.z1[v3++] = V_Game.races[v2++].Unknown_01;
    }
    v4 = 0;
    v5 = 0;
    v6 = 0;
    while ( v4 < V_Game.racesNum )
    {
      ++v4;
      v13.z2[v6++] = V_Game.races[v5++].Unknown_02;
    }
    v7 = 0;
    v8 = 0;
    while ( v7 < V_Game.racesNum )
    {
      v9 = (char)V_Game.races[V_RaceIndex].Unknown_1C0[v7++];
      v13.z3[v8++] = v9;
    }
    v13.playerShipsNum = Q_Race_GetShipsNum_sub_40224(&V_Game.races[V_RaceIndex], 0, 0);
    v13.playerPlanetsNum = Q_Race_GetPlanetsNum_sub_402E0(&V_Game.races[V_RaceIndex]);
    v13.playerTechsNum = Q_Race_GetTechsNum_sub_40664(&V_Game.races[V_RaceIndex]);
    Q_CFILE_CPP_dos_write_sub_1C098(&fi.fh, &v13, 0x74u);
    Q_SaveGam_sub_21374(&V_Game, &fi);
    Q_WinMgr_CallProc6_sub_5A294(&WinMgr, &fi, FALSE);
    result = &fi;
    Q_CloseFileAndDelete_sub_1BBC8(&fi);
  }
  return result;
}
// 541F4: returning address of temporary local variable '%0x0'

//----- (00054208) --------------------------------------------------------
LONG __fastcall sub_54208(PANE *source)
{
  LONG result; // eax
  UBYTE *v2; // [esp+0h] [ebp-3Ch] BYREF
  LONG v3; // [esp+4h] [ebp-38h]
  LONG v4; // [esp+8h] [ebp-34h]
  int v5; // [esp+Ch] [ebp-30h]
  int v6; // [esp+10h] [ebp-2Ch]
  PANE target; // [esp+14h] [ebp-28h] BYREF

  v2 = V_BigBuffer;
  v3 = source->x1 - source->x0;
  v4 = source->y1 - source->y0;
  v5 = 0;
  v6 = 0;
  if ( v4 * v3 >= 160000 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x13E);
  }
  target.x1 = v3;
  target.y1 = v4;
  target.window = (WINDOW *)&v2;
  target.x0 = 0;
  target.y0 = 0;
  result = VFX_pane_copy(source, 0, 0, &target, 0, 0, 0xFFFFFFFF);
  if ( result )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x147);
  }
  return result;
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (000542B0) --------------------------------------------------------
LONG __fastcall Q_WINMGR_CPP_sub_542B0(PANE *target)
{
  UBYTE *v2; // [esp+0h] [ebp-3Ch] BYREF
  LONG v3; // [esp+4h] [ebp-38h]
  LONG v4; // [esp+8h] [ebp-34h]
  int v5; // [esp+Ch] [ebp-30h]
  int v6; // [esp+10h] [ebp-2Ch]
  PANE source; // [esp+14h] [ebp-28h] BYREF

  v2 = V_BigBuffer;
  v3 = target->x1 - target->x0;
  v4 = target->y1 - target->y0;
  v5 = 0;
  v6 = 0;
  if ( v4 * v3 >= 160000 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x158);
  }
  source.x1 = v3;
  source.y1 = v4;
  source.window = (WINDOW *)&v2;
  source.x0 = 0;
  source.y0 = 0;
  return VFX_pane_copy(&source, 0, 0, target, 0, 0, 0xFFFFFFFF);
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (00054344) --------------------------------------------------------
void __fastcall __spoils<> Q_WinMgrCtor_sub_54344(P_WinMgr a1)
{
  sub_2B2C0(&a1->SmallFont);
  sub_2B2C0(&a1->LargeFont);
  sub_1ACC0((int)a1->t13.z1);
  sub_54448(a1);
}

//----- (00054374) --------------------------------------------------------
void __fastcall Q_WinMgrDtor_sub_54374(P_WinMgr pWinMgr)
{
  __int16 i; // cx
  T_TypeA2 *a2; // eax
  __int16 j; // dx
  int v5; // edx
  T_WinMgr *v6; // eax

  for ( i = 0; i < 0x400; ++i )
  {
    if ( pWinMgr->wnds[i].a2 )
    {
      sub_2627C(pWinMgr->wnds[i].a2);
    }
    a2 = pWinMgr->wnds[i].a2;
    if ( a2 )
    {
      a2->procs->proc1(a2, 2);
    }
  }
  for ( j = 0; j < 6; ++j )
  {
    if ( *(_DWORD *)&pWinMgr->z1c[4 * j] )
    {
      sub_2627C(*(void **)&pWinMgr->z1c[4 * j]);
    }
    operator delete[](*(void **)&pWinMgr->z1c[4 * j]);
  }
  if ( pWinMgr->aaa == 0xFFFFFFFF )
  {
    v5 = 0xFFFFFFFF;
    v6 = pWinMgr;
LABEL_17:
    sub_59934(v6, v5);
    goto LABEL_18;
  }
  if ( pWinMgr->bbb == 0xFFFFFFFF )
  {
    v6 = pWinMgr;
    v5 = 0;
    goto LABEL_17;
  }
LABEL_18:
  sub_54664(pWinMgr);
  sub_1ACF4(&pWinMgr->t13);
  sub_2B2E0(&pWinMgr->LargeFont);
  sub_2B2E0(&pWinMgr->SmallFont);
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);

//----- (00054448) --------------------------------------------------------
T_Type4 *__fastcall sub_54448(P_WinMgr a1)
{
  __int16 i; // ax
  int v3; // edx
  T_Type4 *result; // eax

  *(_WORD *)&a1->z1e[0x594] = 0;
  a1->wndCnt = 0;
  a1->Unknown_4228 = 0xFFFF;
  *(_WORD *)&a1->z2[0x20] = 0;
  *(_WORD *)&a1->z2[0x22] = 0;
  a1->Unknown_422A[0x141] = 0;
  a1->counter1 = 0;
  a1->winEventSmallNum = 0;
  *(_DWORD *)a1->z1aa = 0xFFFFFFFF;
  a1->timer = 0xFFFFFFFF;
  a1->gameEventsNum = 0;
  a1->Unknown_475C = 0;
  a1->j = 1.0;
  V_Timer_dword_132B58 = 0;
  memset(a1->Unknown_3066, 0, 0x11C0u);
  memset(a1, 0, 0x3000u);
  memset(a1->b1, 0, sizeof(a1->b1));
  memset(a1->winEventsSmall, 0, sizeof(a1->winEventsSmall));
  memset(a1->z1c, 0, 0x18u);
  memset(a1->z2, 0xFFFFFFFF, 0x20u);
  for ( i = 0; i < 0x20; ++i )
  {
    v3 = 0x47 * i;
    a1->Unknown_3066[v3] = 0xFFFF;
    a1->Unknown_3066[v3 + 0x42] = 0xFFFF;
  }
  a1->Unknown_489E = 0;
  a1->Unknown_48A2 = 0;
  *(_DWORD *)&a1->z5[4] = 0;
  *(_DWORD *)&a1->z5[8] = 0;
  a1->h = 0;
  a1->i = 0xFFFFFFFF;
  a1->aaa = 0;
  a1->bbb = 0;
  a1->z3[0] = 0;
  memset(a1->Unknown_21D82, 0x10, 0);
  result = a1->t4;
  *(_DWORD *)a1->Unknown_21D82 = 0x3C;
  a1->type4counter = 0;
  memset(a1->t4, 0, sizeof(a1->t4));
  return result;
}
// 132B58: using guessed type int V_Timer_dword_132B58;

//----- (000545EC) --------------------------------------------------------
unsigned int __fastcall Q_WINMGR_CPP_StartTimer_sub_545EC(P_WinMgr a1)
{
  HTIMER timer; // ebx
  HTIMER v3; // eax
  HTIMER v4; // edi

  timer = a1->timer;
  V_Timer_dword_132B58 = 0;
  if ( timer == 0xFFFFFFFF )
  {
    v3 = AIL_register_timer((AILTIMERCB)Q_Timer_sub_53DE4);
    a1->timer = v3;
    if ( v3 == 0xFFFFFFFF )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x1E5);
    }
    v4 = a1->timer;
    if ( v4 == 0xFFFFFFFF )
    {
      return 0;
    }
    AIL_set_timer_frequency(v4, 100u);
    AIL_start_timer(a1->timer);
  }
  return 0xFFFFFFFF;
}
// 132B58: using guessed type int V_Timer_dword_132B58;

//----- (00054664) --------------------------------------------------------
void __fastcall sub_54664(P_WinMgr a1)
{
  if ( a1->timer != 0xFFFFFFFF )
  {
    AIL_stop_timer(a1->timer);
    AIL_release_timer_handle(a1->timer);
    a1->timer = 0xFFFFFFFF;
  }
}

//----- (0005469C) --------------------------------------------------------
int __fastcall sub_5469C(P_WinMgr pWinMgr)
{
  int x; // ecx
  int Shift; // edi
  int v4; // eax
  int v5; // edx
  T_Wnd20HW *Wnd_sub_56DA8; // ecx
  LONG right; // eax
  unsigned int v8; // eax
  int leftClicked; // ebx
  WORD v10; // ax
  P_Wnd13DBGWND pWnd13DBGWND; // eax
  int aaa; // edx
  int Unknown_4228; // eax
  unsigned int v14; // esi
  int v15; // ebx
  char v16; // dl
  int result; // eax
  int v18; // [esp-4h] [ebp-30h]
  char s[44]; // [esp+0h] [ebp-2Ch] BYREF

  if ( pWinMgr->aaa == 0xFFFFFFFF || pWinMgr->bbb == 0xFFFFFFFF )
  {
    ++pWinMgr->_time;
  }
  Shift = V_Keyboard.Shift;
  pWinMgr->z3[1] = 0xFFFFFFFF;
  if ( !Shift || *(_DWORD *)((char *)&loc_24DA4 + (_DWORD)pWinMgr) || pWinMgr->Unknown_489E )
  {
    if ( *(_DWORD *)((char *)&loc_24DA4 + (_DWORD)pWinMgr) )
    {
      if ( !V_Keyboard.Shift )
      {
        *(_DWORD *)((char *)&loc_24DA4 + (_DWORD)pWinMgr) = 0;
        Q_GSYSTEM_CPP_sub_2C7D0(&V_Type6_stru_D8654, 0, 0);
        x = *(_DWORD *)pWinMgr->z1aa;
        if ( x != 0xFFFFFFFF )
        {
          sub_56D30(pWinMgr, x, 6, 0, 0);
          x = 0;
          sub_56D30(pWinMgr, *(_DWORD *)pWinMgr->z1aa, 7, 0, 0);
        }
      }
    }
  }
  else
  {
    *(_DWORD *)((char *)&loc_24DA4 + (_DWORD)pWinMgr) = 0xFFFFFFFF;
    Q_GSYSTEM_CPP_sub_2C7D0(&V_Type6_stru_D8654, 1, 0);
  }
  v4 = 0xFFFFFFFF;
  if ( !*(_DWORD *)((char *)&loc_24DA4 + (_DWORD)pWinMgr) && !pWinMgr->Unknown_489E && pWinMgr->Unknown_4228 )
  {
    if ( V_Mouse.y )
    {
      if ( V_Mouse.y == 0x1DF )
      {
        x = V_Mouse.x;
        if ( V_Mouse.x )
        {
          if ( V_Mouse.x == 0x27F )
          {
            v4 = 3;
          }
        }
        else
        {
          x = 0;
          v4 = 2;
        }
      }
    }
    else if ( V_Mouse.x )
    {
      if ( V_Mouse.x == 0x27F )
      {
        v4 = 1;
      }
    }
    else
    {
      v4 = 0;
    }
  }
  if ( v4 != pWinMgr->i )
  {
    v5 = 0;
    pWinMgr->i = v4;
    if ( v4 != 0xFFFFFFFF )
    {
      v5 = v4 + 4;
    }
    x = 0;
    sub_5A270(pWinMgr, v5, 0, 0);
  }
  if ( V_Mouse.moved == 0xFFFFFFFF )
  {
    if ( V_Mouse.moved == pWinMgr->aaa && pWinMgr->z3[1] )
    {
      x = 0;
      sub_59C80(pWinMgr, 0, 1, 0, V_Mouse.x, V_Mouse.y, 0);
      pWinMgr->z3[1] = 0;
    }
    sub_5691C(pWinMgr);
  }
  if ( !pWinMgr->Unknown_489E )
  {
    if ( pWinMgr->winEventSmallNum )
    {
      sub_56824(pWinMgr);
    }
    if ( pWinMgr->counter1 )
    {
      sub_56694(pWinMgr);
    }
  }
  if ( V_Keyboard.Pressed == 0xFFFFFFFF )
  {
    if ( V_Keyboard.Pressed == pWinMgr->aaa && (!V_Keyboard.Alt || V_Keyboard.ScanCode != 0x13 && V_Keyboard.ScanCode != 0x19) )
    {
      x = V_Keyboard.Flags;
      sub_59C80(
        pWinMgr,
        0,
        3,
        V_Keyboard.Flags,
        (unsigned __int16)V_Keyboard.ScanCode,
        (unsigned __int16)V_Keyboard.ASCIIChar,
        V_Keyboard.Alt);
    }
    if ( pWinMgr->bbb == 0xFFFFFFFF && V_Keyboard.Ctrl && V_Keyboard.ScanCode == 0x19 )
    {
      v18 = dword_132B1C;
      pWinMgr->bbb = 0;
      sprintf(s, "info%02d", v18);
      Wnd_sub_56DA8 = (T_Wnd20HW *)Q_FindWnd_sub_56DA8(pWinMgr, "HELPWINDOW", 0);
      Q_ShowHelpTopic_sub_2FCB0(Wnd_sub_56DA8, byte_132B20, s);
      sub_552F8(pWinMgr, &Wnd_sub_56DA8->a2, 0);
      V_Keyboard.Alt = 0;
      dword_132B14 = V_Mouse.left;
      right = V_Mouse.right;
      pWinMgr->bbb = 0xFFFFFFFF;
      dword_132B18 = right;
      x = 0;
      V_Keyboard.ScanCode = 0;
      ++dword_132B1C;
    }
    v8 = 0xFFFFFFFF;
    if ( V_Keyboard.Alt == 0xFFFFFFFF || V_Keyboard.ScanCode == 1 )
    {
      v8 = sub_54D64(pWinMgr);
    }
    if ( v8 == 0xFFFFFFFF )
    {
      x = (unsigned __int16)V_Keyboard.ScanCode;
      sub_56BE8(pWinMgr, 3, (unsigned __int16)V_Keyboard.ASCIIChar, (unsigned __int16)V_Keyboard.ScanCode, 0);
    }
  }
  leftClicked = V_Mouse.leftClicked;
  if ( V_Mouse.leftClicked == 0xFFFFFFFF )
  {
    if ( V_Mouse.leftClicked == pWinMgr->aaa && !V_Keyboard.Alt )
    {
      v10 = 0;
      if ( V_Mouse.left && V_Keyboard.Shift )
      {
        v10 = 1;
      }
      x = v10;
      leftClicked = 2;
      sub_59C80(pWinMgr, 0, 2, v10, 0, V_Mouse.left, 0);
    }
    if ( V_Mouse.left )
    {
      if ( pWinMgr->i == 0xFFFFFFFF )
      {
        if ( V_Keyboard.Alt == 0xFFFFFFFF )
        {
          leftClicked = V_Mouse.y;
          x = V_Mouse.x;
          dword_132B10 = VFX_pixel_read(&V_Type6_stru_D8654.pane, V_Mouse.x, V_Mouse.y);
          pWnd13DBGWND = pWinMgr->pWnd13DBGWND;
          if ( pWnd13DBGWND->a2.a1.j )
          {
            x = 0;
            leftClicked = 0;
            ((void (*)(void))pWnd13DBGWND->a2.procs->proc3)();
          }
        }
        else if ( *(_DWORD *)((char *)&loc_24DA4 + (_DWORD)pWinMgr) != 0xFFFFFFFF || pWinMgr->Unknown_489E )
        {
          x = V_Mouse.y;
          leftClicked = V_Mouse.x;
          sub_56BE8(pWinMgr, 4, V_Mouse.x, V_Mouse.y, 0);
        }
        else
        {
          x = V_Mouse.y;
          leftClicked = V_Mouse.x;
          sub_56BE8(pWinMgr, 0xC, V_Mouse.x, V_Mouse.y, 0);
        }
      }
      else if ( pWinMgr->Unknown_489E )
      {
        pWinMgr->Unknown_489E = 0;
        pWinMgr->Unknown_48A2 = 0xFFFFFFFF;
      }
      else
      {
        Q_StartSample_sub_4FB90(&V_SoundSystem, 0);
        x = 0;
        leftClicked = 0;
        sub_5A270(pWinMgr, 0, 0, 0);
        pWinMgr->i = 0xFFFFFFFF;
        sub_570AC(pWinMgr, 0xFFFFFFFF);
      }
    }
  }
  if ( V_Mouse.rightClicked == 0xFFFFFFFF )
  {
    aaa = pWinMgr->aaa;
    if ( aaa == V_Mouse.rightClicked )
    {
      x = 0;
      aaa ^= V_Mouse.rightClicked;
      leftClicked = 2;
      sub_59C80(pWinMgr, aaa, 2, 0, 1, V_Mouse.right, 0);
    }
    if ( V_Mouse.right )
    {
      if ( *(_DWORD *)((char *)&loc_24DA4 + (_DWORD)pWinMgr) == 0xFFFFFFFF )
      {
        *(_DWORD *)((char *)&loc_24DA4 + (_DWORD)pWinMgr) = 0;
        Q_GSYSTEM_CPP_PreloadMouseShp_sub_2C744(&V_Type6_stru_D8654, (char *)aaa, leftClicked, x);
      }
      else
      {
        sub_56BE8(pWinMgr, 5, V_Mouse.x, V_Mouse.y, 0);
      }
    }
  }
  while ( pWinMgr->Unknown_422A[0x141] > 0 )
  {
    sub_55E80(pWinMgr);
  }
  if ( pWinMgr->gameEventsNum && pWinMgr->Unknown_4228 == 1 && !pWinMgr->Unknown_489E )
  {
    sub_55B74(pWinMgr);
  }
  if ( *(int *)((char *)&pWinMgr->wnds[0].a + (_DWORD)&loc_24D9B + 1) == 0xFFFFFFFF && !pWinMgr->gameEventsNum && !pWinMgr->Unknown_489E )
  {
    sub_56B60(pWinMgr, 7, 0, 0);
  }
  if ( V_SoundSystem.a == 0xFFFFFFFF && !V_SoundSystem.c )
  {
    if ( !V_SoundSystem.playing )
    {
      Unknown_4228 = pWinMgr->Unknown_4228;
      if ( Unknown_4228 != 7 && Unknown_4228 != 0xD && Unknown_4228 != 6 )
      {
        LOWORD(v14) = 0xFFFF;
        v15 = 0;
        if ( word_96BB0 != 0xFFFFFFFF && V_SoundSystem.files[word_96BB0].fpos )
        {
          v15 = 0xFFFFFFFF;
          LOWORD(v14) = word_96BB0;
          dword_96BB4 = 0;
        }
        if ( (__int16)v14 == 0xFFFFFFFF )
        {
          if ( word_96BB0 == 0xFFFFFFFF )
          {
            LOWORD(v14) = 0;
          }
          else
          {
            v14 = (V_Mouse.x + V_Timer_dword_132B58) % 5u;
            if ( (_WORD)v14 == word_96BB0 )
            {
              v14 = (word_96BB0 + 1) % 5;
            }
          }
        }
        sub_4F8CC(&V_SoundSystem, v14, v15);
        word_96BB0 = v14;
      }
    }
    if ( dword_96BB4 != 0xFFFFFFFF )
    {
      v16 = dword_96BB4++;
      Q_SetVolume_sub_4FF4C(&V_SoundSystem, v16);
      if ( dword_96BB4 == 0x64 )
      {
        dword_96BB4 = 0xFFFFFFFF;
      }
    }
  }
  do
  {
    if ( V_SoundSystem.a == 0xFFFFFFFF && V_SoundSystem.a == V_SoundSystem.playing )
    {
      if ( V_SoundSystem.playing == V_SoundSystem.c )
      {
        Q_StopSample_sub_4FA1C(&V_SoundSystem);
      }
      else
      {
        sub_4FAB4((int)&V_SoundSystem);
      }
    }
  }
  while ( (unsigned int)(V_Timer_dword_132B58 - dword_132B34) < 3 );
  result = V_Timer_dword_132B58;
  dword_132B34 = V_Timer_dword_132B58;
  return result;
}
// 54B66: variable 'x' is possibly undefined
// 96BB0: using guessed type __int16 word_96BB0;
// 96BB4: using guessed type int dword_96BB4;
// 132B10: using guessed type int dword_132B10;
// 132B14: using guessed type int dword_132B14;
// 132B18: using guessed type int dword_132B18;
// 132B1C: using guessed type int dword_132B1C;
// 132B34: using guessed type int dword_132B34;
// 132B58: using guessed type int V_Timer_dword_132B58;

//----- (00054D64) --------------------------------------------------------
unsigned int __fastcall sub_54D64(P_WinMgr a1)
{
  if ( V_Keyboard.ScanCode >= 0x20u )
  {
    if ( V_Keyboard.ScanCode <= 0x20u )
    {
      if ( V_NougatLfExists_dword_A0CFC == 0xFFFFFFFF )
      {
        dword_132B5C = ~dword_132B5C;
      }
    }
    else
    {
      if ( V_Keyboard.ScanCode >= 0x26u )
      {
        if ( V_Keyboard.ScanCode <= 0x26u )
        {
          if ( !a1->Unknown_489E && a1->Unknown_4228 != 8 )
          {
            sub_56E9C(a1, 4, 0xFFFFFFFF);
            return 0;
          }
        }
        else
        {
          if ( V_Keyboard.ScanCode >= 0x31u )
          {
            if ( V_Keyboard.ScanCode <= 0x31u )
            {
              V_SoundSystem._notstarted1 = ~V_SoundSystem._notstarted1;
              return 0;
            }
            if ( V_Keyboard.ScanCode == 0x32 )
            {
              V_SoundSystem.c = ~V_SoundSystem.c;
              return 0;
            }
            return 0xFFFFFFFF;
          }
          if ( V_Keyboard.ScanCode != 0x2D )
          {
            return 0xFFFFFFFF;
          }
          if ( !a1->Unknown_489E )
          {
            Q_GameLoop_dword_96774 = 0;
            return 0;
          }
        }
        return 0;
      }
      if ( V_Keyboard.ScanCode > 0x21u )
      {
        if ( V_Keyboard.ScanCode != 0x22 )
        {
          return 0xFFFFFFFF;
        }
        sub_1B4D0((P_WinMgr)((char *)a1 + (_DWORD)&loc_24DAD + 3));
        sub_31C18(*(int *)((char *)&a1->wnds[0].a + (_DWORD)&loc_27C93 + 1), *(int *)((char *)&a1->wnds[0].a + (_DWORD)&loc_27C93 + 5));
        sub_1ACE8((int)a1 + (_DWORD)&loc_24DAD + 3);
        return 0;
      }
      if ( V_NougatLfExists_dword_A0CFC == 0xFFFFFFFF )
      {
        if ( V_NougatLfExists_dword_A0CFC == *(_DWORD *)((char *)&loc_24D98 + (_DWORD)a1) )
        {
          *(_DWORD *)((char *)&loc_24D98 + (_DWORD)a1) = 0;
        }
        else
        {
          *(_DWORD *)((char *)&loc_24D98 + (_DWORD)a1) = V_NougatLfExists_dword_A0CFC;
        }
        return 0;
      }
    }
    return 0;
  }
  if ( V_Keyboard.ScanCode < 0x12u )
  {
    if ( V_Keyboard.ScanCode )
    {
      if ( V_Keyboard.ScanCode > 1u )
      {
        if ( V_Keyboard.ScanCode != 0x11 )
        {
          return 0xFFFFFFFF;
        }
        if ( V_NougatLfExists_dword_A0CFC == 0xFFFFFFFF )
        {
          sub_552F8(a1, *(P_TypeA2 *)((char *)&a1->wnds[0].a + (_DWORD)&loc_21D90 + 2), 0);
          return 0;
        }
        return 0;
      }
      if ( a1->Unknown_489E )
      {
        a1->Unknown_489E = 0;
        a1->Unknown_48A2 = 0;
        return 0;
      }
      if ( a1->Unknown_4228 != 0x11 )
      {
        sub_570AC(a1, 0xFFFFFFFF);
        return 0;
      }
    }
    return 0xFFFFFFFF;
  }
  if ( V_Keyboard.ScanCode <= 0x12u )
  {
    if ( V_NougatLfExists_dword_A0CFC == 0xFFFFFFFF )
    {
      *(int *)((char *)&a1->wnds[0].a + (_DWORD)&loc_24D9E + 2) = ~*(int *)((char *)&a1->wnds[0].a + (_DWORD)&loc_24D9E + 2);
      return 0;
    }
    return 0;
  }
  if ( V_Keyboard.ScanCode < 0x19u )
  {
    if ( V_Keyboard.ScanCode != 0x13 )
    {
      return 0xFFFFFFFF;
    }
    if ( a1->bbb || V_NougatLfExists_dword_A0CFC != 0xFFFFFFFF )
    {
      return 0;
    }
    if ( a1->aaa )
    {
      sub_59934(a1, V_NougatLfExists_dword_A0CFC);
    }
    else
    {
      srand(0);
      *(int *)((char *)&a1->wnds[0].a + (_DWORD)&loc_24DAA + 2) = 0x3F800000;
      sub_59908((int)a1);
    }
    return 0;
  }
  else
  {
    if ( V_Keyboard.ScanCode > 0x19u )
    {
      if ( V_Keyboard.ScanCode != 0x1F )
      {
        return 0xFFFFFFFF;
      }
      if ( !a1->Unknown_489E && a1->Unknown_4228 != 8 )
      {
        sub_56E9C(a1, 2, 0xFFFFFFFF);
      }
      return 0;
    }
    if ( a1->aaa || V_NougatLfExists_dword_A0CFC != 0xFFFFFFFF )
    {
      return 0;
    }
    if ( a1->bbb )
    {
      sub_59934(a1, 0);
    }
    else
    {
      sub_59988(a1, "WINEVENT.BIN", 0);
    }
    return 0;
  }
}
// 54D64: could not find valid save-restore pair for esi
// 96774: using guessed type int Q_GameLoop_dword_96774;
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// 132B5C: using guessed type int dword_132B5C;

//----- (0005508C) --------------------------------------------------------
void __fastcall sub_5508C(P_WinMgr a1)
{
  int v1; // esi
  unsigned int v2; // ebx
  int v3; // ebx
  char s[40]; // [esp+0h] [ebp-2Ch] BYREF
  P_WinMgr v5; // [esp+28h] [ebp-4h]

  v5 = a1;
  if ( *(_DWORD *)a1->z5 == 0xFFFFFFFF )
  {
    if ( ++dword_10AE60 == 0xA )
    {
      v1 = dword_10AE68;
      dword_10AE64 = V_Timer_dword_132B58;
      dword_10AE68 = V_Timer_dword_132B58;
      v2 = V_Timer_dword_132B58 - v1;
      dword_10AE60 = 0;
      if ( V_Timer_dword_132B58 == v1 )
      {
        v2 = 1;
      }
      sprintf("FPS DUDE", "FPS %lu  %lu", 0x3E8 / v2, v2);
    }
    sub_2B3E0(&WinMgr.LargeFont, 25, 10, 150, 30);
    sub_2B8A8(&WinMgr.LargeFont, 0, 0, "FPS DUDE", 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
  }
  if ( dword_132B5C )
  {
    v3 = 0;
    if ( V_Mouse.y < 0xF0 )
    {
      v3 = 0x1CC;
    }
    sprintf(s, "(%d,%d)", V_Mouse.x, V_Mouse.y);
    WinMgr.LargeFont.pane = V_Type6_stru_D8654.pane;
    sub_2B8A8(&WinMgr.LargeFont, 0, v3, s, 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
  }
  if ( V_Mouse.initialized == 1 )
  {
    MOUSE_pane_list_refresh(v5->pPaneList);
  }
  else
  {
    sub_5BA38(v5->pPaneList);
  }
  sub_5B71C(v5->pPaneList);
  if ( dword_132B60 == 0xFFFFFFFF )
  {
    Q_FadePalette_sub_2C5E4(&V_Type6_stru_D8654, dword_132B64);
    if ( ++dword_132B64 > 0x40 )
    {
      dword_132B64 = 0;
      dword_132B60 = 0;
    }
  }
}
// 10AE60: using guessed type int dword_10AE60;
// 10AE64: using guessed type int dword_10AE64;
// 10AE68: using guessed type int dword_10AE68;
// 132B58: using guessed type int V_Timer_dword_132B58;
// 132B5C: using guessed type int dword_132B5C;
// 132B60: using guessed type int dword_132B60;
// 132B64: using guessed type int dword_132B64;

//----- (00055214) --------------------------------------------------------
void __fastcall sub_55214(T_WinMgr *a1, LONG x1, LONG y1, LONG x2, int y2)
{
  PANE pane; // [esp+0h] [ebp-18h] BYREF
  P_WinMgr v6; // [esp+14h] [ebp-4h]

  v6 = a1;
  pane.x0 = x1;
  pane.y1 = y2;
  pane.y0 = y1;
  pane.x1 = x2;
  pane.window = a1->window;
  VFX_pane_wipe(&pane, 0);
  sub_55274(v6, x1, y1, x2, y2);
}

//----- (00055274) --------------------------------------------------------
void __fastcall sub_55274(P_WinMgr a1, int x1, int y1, int x2, int y2)
{
  if ( sub_5B7C2(&a1->pPaneList->array, (int)a1->window, x1, y1, x2, y2) == 0xFFFFFFFF )
  {
    sub_5B71C(a1->pPaneList);
    sub_5B7C2(&a1->pPaneList->array, (int)a1->window, 0, 0, 639, 479);
  }
}

//----- (000552CC) --------------------------------------------------------
void __fastcall sub_552CC(P_WinMgr a1, PANE *a2)
{
  if ( a2 )
  {
    sub_55274(a1, a2->x0, a2->y0, a2->x1, a2->y1);
  }
  else
  {
    sub_55274(a1, 0, 0, 639, 479);
  }
}

//----- (000552F8) --------------------------------------------------------
int __fastcall sub_552F8(P_WinMgr a1, P_TypeA2 a2, int a3)
{
  MACRO_VFX_BOOL v4; // ebx
  T_TypeA2 *Wnd_sub_56DA8; // eax
  P_Procs procs; // ebx
  int v7; // ecx
  __int16 childrenCnt; // di
  __int16 i; // cx
  __int16 j; // si
  int index; // edx
  int v12; // edi
  int result; // eax
  PANE pane; // [esp+0h] [ebp-20h] BYREF
  int v15; // [esp+14h] [ebp-Ch]
  int v16; // [esp+18h] [ebp-8h]
  P_TypeA2 v17; // [esp+1Ch] [ebp-4h]

  v17 = a2;
  v16 = a3;
  if ( a1->Unknown_489E )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x4CC);
  }
  v4 = V_FlashPopExists;
  v15 = *(_DWORD *)&a1->z5[4];
  *(_DWORD *)&a1->z5[4] = 0;
  if ( v4 == FALSE )
  {
    Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(a1, "NEXTTURNCONT", 0);
    procs = Wnd_sub_56DA8->procs;
    Wnd_sub_56DA8[1].a1.magic12345678 = 0;
    ((void (*)(void))procs->proc4)();
  }
  v7 = *(_DWORD *)a1->z1aa;
  if ( v7 != 0xFFFFFFFF )
  {
    sub_56D30(a1, v7, 6, 0, 0);
  }
  *(_DWORD *)a1->z1aa = 0xFFFFFFFF;
  memset(byte_132B38, 1, sizeof(byte_132B38));
  sub_56BE8(a1, 0xF, 0, 0, 0xFFFFFFFF);
  if ( dword_96BB8 == 0xFFFFFFFF )
  {
    sub_54208(&v17->a1.pane);
  }
  if ( sub_57220(a1, v17->a1.index, a1->Unknown_4228) != 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x4EE);
  }
  childrenCnt = v17->a1.childrenCnt;
  for ( i = 0; i < childrenCnt; ++i )
  {
    if ( sub_57220(a1, (*v17->a1.children)[i]->index, a1->Unknown_4228) != 0xFFFFFFFF )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x4F4);
    }
  }
  v17->procs->proc3(v17, 0xC8, 0, 0);
  v17->procs->proc3(v17, 1, 0, 0);
  sub_55618(a1);
  v17->procs->proc3(v17, 2, 0, 0);
  for ( j = 0; j < childrenCnt; ++j )
  {
    index = (*v17->a1.children)[j]->index;
    sub_57310(a1, index, a1->Unknown_4228, v16);
  }
  pane = v17->a1.pane;
  sub_57310(a1, v17->a1.index, a1->Unknown_4228, v16);
  v12 = dword_96BB8;
  *(_DWORD *)a1->z1aa = 0xFFFFFFFF;
  if ( v12 == 0xFFFFFFFF )
  {
    Q_WINMGR_CPP_sub_542B0(&pane);
  }
  sub_56BE8(a1, 0xE, 0, 0, 0xFFFFFFFF);
  sub_552CC(a1, 0);
  if ( V_FlashPopExists == 0xFFFFFFFF )
  {
    *(int *)((char *)&a1->wnds[0].a + (_DWORD)&loc_24D9B + 1) = v15;
  }
  result = a1->Unknown_48A2;
  dword_96BB8 = 0xFFFFFFFF;
  return result;
}
// 96BB8: using guessed type int dword_96BB8;

//----- (00055554) --------------------------------------------------------
LONG __fastcall sub_55554(int a1, _DWORD *a2)
{
  int v3; // [esp+0h] [ebp-60h] BYREF
  int v4; // [esp+4h] [ebp-5Ch]
  int v5; // [esp+18h] [ebp-48h]
  int v6; // [esp+1Ch] [ebp-44h]
  int v7; // [esp+30h] [ebp-30h]
  int v8; // [esp+34h] [ebp-2Ch]
  int v9; // [esp+48h] [ebp-18h]
  int v10; // [esp+4Ch] [ebp-14h]

  v5 = 0x27F;
  v7 = 0x27F;
  v8 = 0x1DF;
  v10 = 0x1DF;
  v3 = 0;
  v4 = 0;
  v6 = 0;
  v9 = 0;
  sub_62DA5((WINDOW *)&V_Type6_stru_D8654.pane, 4, (int)&v3, (int)V_Type6_stru_D8654.hazeTables);
  v3 = a2[1] + 0x14;
  v4 = a2[2] + 0x14;
  v5 = a2[3] + 0x14;
  v6 = a2[2] + 0x14;
  v7 = a2[3] + 0x14;
  v8 = a2[4] + 0x14;
  v9 = a2[1] + 0x14;
  v10 = a2[4] + 0x14;
  return sub_62DA5((WINDOW *)&V_Type6_stru_D8654.pane, 4, (int)&v3, (int)(*V_Type6_stru_D8654.hazeTables)[7]);
}

//----- (00055618) --------------------------------------------------------
void __fastcall sub_55618(P_WinMgr a1)
{
  int v2; // ebx

  if ( a1->Unknown_489E )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x57E);
  }
  a1->Unknown_489E = 0xFFFFFFFF;
  v2 = Q_GameLoop_dword_96774;
  a1->Unknown_48A2 = 0;
  if ( v2 == 0xFFFFFFFF )
  {
    do
    {
      if ( a1->Unknown_489E != 0xFFFFFFFF )
      {
        break;
      }
      if ( WinMgr.bbb == 0xFFFFFFFF )
      {
        sub_59B80(&WinMgr);
      }
      else
      {
        Q_ProcessInput_sub_2656C();
      }
      sub_5469C(&WinMgr);
      sub_5508C(&WinMgr);
      if ( WinMgr.bbb )
      {
        sub_59A54(&WinMgr);
      }
    }
    while ( Q_GameLoop_dword_96774 == 0xFFFFFFFF );
  }
  V_Mouse.leftClicked = 0;
  V_Mouse.rightClicked = 0;
  V_Keyboard.Pressed = 0;
}
// 96774: using guessed type int Q_GameLoop_dword_96774;

//----- (000556CC) --------------------------------------------------------
void __fastcall Q_ShowMsgBox_sub_556CC(P_WinMgr a1, char *a2)
{
  T_TypeA3 *ctrBox; // eax
  T_TypeA3 *v5; // edx
  T_TypeA2 *ctrBox_1; // ecx
  T_TypeA2 *ctrBut; // eax
  P_TypeA2 ctrBut_1; // edx
  char *sub_1CEA8; // kr00_4
  int v10; // kr04_4
  char *name; // kr08_4
  int v12; // kr0C_4
  char v13; // al
  char v14; // al
  WINDOW *window; // eax

  ctrBox = (T_TypeA3 *)operator new(0xB3u);
  if ( ctrBox )
  {
    Q_A3_sub_2FA18(ctrBox);
  }
  Q_RegisterData_sub_2625C(ctrBox, 2, "MSGBOX");
  v5 = ctrBox;
  ctrBox_1 = &ctrBox->a2;
  Q_WINMGR_CPP_RegisterWindow_sub_2C978(&ctrBox->a2.a1);
  v5->a2.a1._mouseFocus = 0;
  v5->a2.a1.pane.y0 = 0x32;
  v5->a2.a1.pane.y1 = 0x12C;
  v5->controls = a2;
  v5->a2.a1.pane.x0 = v5->a2.a1.pane.y0;
  v5->a2.a1.pane.x1 = v5->a2.a1.pane.y1;
  v5->a2.a1.pane.window = a1->window;
  ctrBut = (T_TypeA2 *)operator new(0xABu);
  if ( ctrBut )
  {
    Q_A2Ctor_sub_2C830(ctrBut);
  }
  Q_RegisterData_sub_2625C(ctrBut, 2, "MSGBOXBUTTON");
  ctrBut_1 = ctrBut;
  Q_WINMGR_CPP_RegisterWindow_sub_2C978(&ctrBut->a1);
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1E);// 30: "OK"
  v10 = 0;
  name = ctrBut_1->a1.name;
  v12 = 0;
  do
  {
    v13 = sub_1CEA8[2 * v10];
    name[2 * v12] = v13;
    if ( !v13 )
    {
      break;
    }
    v14 = sub_1CEA8[2 * v10 + 1];
    name[2 * v12 + 1] = v14;
    ++v10;
    ++v12;
  }
  while ( v14 );
  ctrBut_1->a1.pane.y0 = 0x104;
  ctrBut_1->a1.pane.y1 = 0x122;
  ctrBut_1->a1.pane.x0 = ctrBut_1->a1.pane.y0;
  ctrBut_1->a1.pane.x1 = ctrBut_1->a1.pane.y1;
  window = a1->window;
  ctrBut_1->a1._mouseFocus = 0xFFFFFFFF;
  ctrBut_1->a1.sendMessage = 0xC9;
  ctrBut_1->a1.pane.window = window;
  ctrBut_1->a1.parentIndex = ctrBox_1->a1.index;
  Q_GWINDOW_CPP_LinkChild_sub_2C990(&ctrBox_1->a1, &ctrBut_1->a1);
  sub_552F8(a1, ctrBox_1, 0xFFFFFFFF);
}

//----- (000557D4) --------------------------------------------------------
const char *__fastcall sub_557D4(T_WinMgr *eax0, char *s2, const char *a3, __int16 a4)
{
  T_TypeA2 *v5; // eax
  T_TypeA2 *v6; // ecx
  T_TypeA2 *v7; // ebp
  int v8; // ebx
  int v9; // eax
  P_WinMgr v10; // eax
  T_TypeA2 *v11; // eax
  T_TypeA1 *p_a1; // ebx
  char *sub_1CEA8; // kr00_4
  int v14; // kr04_4
  char *name; // kr08_4
  int v16; // kr0C_4
  char v17; // al
  char v18; // al
  char *v19; // eax
  WINDOW *window; // eax
  T_TypeA2 *v21; // eax
  P_TypeA1 v22; // edx
  P_TypeA1 v23; // edx
  LONG v24; // eax
  LONG v25; // ebx
  int index; // eax
  void *ShapeTable_sub_1B084; // eax
  PANE pane; // [esp+0h] [ebp-3Ch] BYREF
  T_TypeA2 *v30; // [esp+14h] [ebp-28h]
  int v31; // [esp+18h] [ebp-24h]
  const char *v32; // [esp+1Ch] [ebp-20h]
  LONG FontHeight_sub_2B594; // [esp+20h] [ebp-1Ch]
  P_WinMgr a1; // [esp+24h] [ebp-18h]
  P_TypeA1 v35; // [esp+28h] [ebp-14h]
  __int16 v36; // [esp+2Ch] [ebp-10h]

  a1 = eax0;
  v32 = a3;
  v36 = a4;
  FontHeight_sub_2B594 = Q_FONT_CPP_GetFontHeight_sub_2B594(&WinMgr.LargeFont);
  v31 = 5 * FontHeight_sub_2B594 + 5;
  v5 = (T_TypeA2 *)operator new(0xABu);
  if ( v5 )
  {
    Q_A2Ctor_sub_2C830(v5);
  }
  Q_RegisterData_sub_2625C(v5, 2, "INPUTBOX");
  v6 = v5;
  v7 = v5;
  Q_WINMGR_CPP_RegisterWindow_sub_2C978(&v5->a1);
  strncpy(v6->a1.name, s2, 0x13u);
  v8 = v31;
  v6->a1.pane.x0 = 0xF2;
  v6->a1.pane.x1 = 0x18D;
  v9 = (0x1E0 - v8) / 2;
  v6->a1.name[0x13] = 0;
  v6->a1.s = 0xFFFF;
  v6->a1.pane.y0 = v9;
  v6->a1.pane.y1 = v8 + v9;
  v10 = a1;
  v6->a1.t = 5;
  v6->a1.pane.window = v10->window;
  v11 = (T_TypeA2 *)operator new(0xABu);
  if ( v11 )
  {
    Q_A2Ctor_sub_2C830(v11);
  }
  Q_RegisterData_sub_2625C(v11, 2, "MSGBOXBUTTON");
  p_a1 = &v11->a1;
  v30 = v11;
  Q_WINMGR_CPP_RegisterWindow_sub_2C978(&v11->a1);
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1E);// 30: "OK"
  v14 = 0;
  name = p_a1->name;
  v16 = 0;
  do
  {
    v17 = sub_1CEA8[2 * v14];
    name[2 * v16] = v17;
    if ( !v17 )
    {
      break;
    }
    v18 = sub_1CEA8[2 * v14 + 1];
    name[2 * v16 + 1] = v18;
    ++v14;
    ++v16;
  }
  while ( v18 );
  p_a1->s = 0xFFFF;
  p_a1->t = 2;
  v19 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1E);      // 30: "OK"
  p_a1->pane.x0 = v7->a1.pane.x1 - sub_2B4F4(&WinMgr.LargeFont.pVfxFont, v19) - 0xA;
  p_a1->pane.x1 = v7->a1.pane.x1 - 3;
  p_a1->pane.y0 = v7->a1.pane.y1 - FontHeight_sub_2B594 - 5;
  p_a1->pane.y1 = v7->a1.pane.y1 - 2;
  window = a1->window;
  p_a1->_mouseFocus = 0xFFFFFFFF;
  p_a1->u = 0xFFFFFFFF;
  p_a1->sendMessage = 0xC9;
  p_a1->pane.window = window;
  p_a1->parentIndex = v7->a1.index;
  Q_GWINDOW_CPP_LinkChild_sub_2C990(&v7->a1, p_a1);
  v21 = (T_TypeA2 *)operator new(0xC1u);
  if ( v21 )
  {
    v21 = sub_2F48C(v21);
  }
  Q_RegisterData_sub_2625C(v21, 2, "EDITWND");
  v35 = &v21->a1;
  if ( !v21 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x5F7);
  }
  Q_WINMGR_CPP_RegisterWindow_sub_2C978(v35);
  v22 = v35;
  v35->pane.x0 = v7->a1.pane.x0 + 0xF;
  v22->pane.x1 = v7->a1.pane.x1 - 0xF;
  v23 = v35;
  v24 = FontHeight_sub_2B594 + v7->a1.pane.y0 + 8;
  v25 = FontHeight_sub_2B594;
  v35->pane.y0 = v24;
  v23->pane.y1 = v25 + v24 + 8;
  v23->pane.window = a1->window;
  LOWORD(v25) = v36;
  index = v7->a1.index;
  v23->sendMessage = 0;
  v23->parentIndex = index;
  sub_2F9A4((int)v23, v32, v25);
  Q_GWINDOW_CPP_LinkChild_sub_2C990(&v7->a1, v35);
  pane = v7->a1.pane;
  dword_96BB8 = 0;
  pane.x0 -= 8;
  pane.x1 += 8;
  pane.y0 -= 8;
  pane.y1 += 7;
  sub_54208(&pane);
  sub_552CC(a1, &pane);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, (unsigned __int16)word_FFEEA);
  VFX_shape_draw(&pane, ShapeTable_sub_1B084, 1, 0, 0);
  sub_552F8(a1, v7, 0);
  Q_WINMGR_CPP_sub_542B0(&pane);
  sub_552CC(a1, &pane);
  sub_57530(a1, v30->a1.index, 0);
  sub_57530(a1, v35->index, 0);
  sub_57530(a1, v7->a1.index, 0);
  return v32;
}
// 96BB8: using guessed type int dword_96BB8;

//----- (00055AEC) --------------------------------------------------------
MACRO_VFX_BOOL __fastcall Q_AddGameEvent_sub_55AEC(P_WinMgr pWinMgr, int eventId, void *p1, void *p2)
{
  int gameEventsNum; // edx

  if ( V_FlashPopExists == TRUE )
  {
    return FALSE;
  }
  gameEventsNum = pWinMgr->gameEventsNum;
  if ( gameEventsNum == 32 )
  {
    return FALSE;
  }
  pWinMgr->gameEvents[gameEventsNum].eventId = eventId;
  pWinMgr->gameEvents[pWinMgr->gameEventsNum].p1 = p1;
  pWinMgr->gameEvents[pWinMgr->gameEventsNum++].p2 = p2;
  return TRUE;
}

//----- (00055B74) --------------------------------------------------------
void __fastcall sub_55B74(P_WinMgr pWinMgr)
{
  P_Wnd23EW pWnd23EW; // eax
  P_Wnd23EW v3; // ebp
  __int16 v4; // di
  __int16 *v5; // ebp
  unsigned int eventId; // ecx
  char *p1; // eax
  bool v8; // zf
  __int16 v9; // dx
  WORD gameEventsNum; // bx
  int v11; // [esp+8h] [ebp-20h]
  void *p2; // [esp+Ch] [ebp-1Ch]

  if ( dword_10AE6C == 0xFFFFFFFF || !pWinMgr->gameEventsNum || pWinMgr->Unknown_4228 != 1 )
  {
    return;
  }
  pWnd23EW = (P_Wnd23EW)Q_FindWnd_sub_56DA8(pWinMgr, "EVENTWIN", 0);
  v3 = pWnd23EW;
  if ( !pWnd23EW )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x63B);
  }
  sub_26874(pWnd23EW, &pWinMgr->gameEvents[pWinMgr->Unknown_475C]);
  dword_10AE6C = 0xFFFFFFFF;
  v11 = 0;
  if ( V_FlashPopExists == FALSE )
  {
    v11 = sub_552F8(pWinMgr, &v3->a2, 0);
  }
  v4 = 0;
  dword_10AE6C = 0;
  if ( !v11 )
  {
    goto LABEL_47;
  }
  eventId = pWinMgr->gameEvents[pWinMgr->Unknown_475C].eventId;
  p1 = (char *)pWinMgr->gameEvents[pWinMgr->Unknown_475C].p1;
  p2 = pWinMgr->gameEvents[pWinMgr->Unknown_475C].p2;
  if ( eventId < ASCEND_EP_BADSHIPENTERS )
  {
    if ( eventId >= ASCEND_EP_SHIPARRIVE )
    {
      goto LABEL_16;
    }
    if ( !pWinMgr->gameEvents[pWinMgr->Unknown_475C].eventId )
    {
      v8 = 1;
      goto LABEL_45;
    }
    if ( eventId > 1 )
    {
      v4 = 0xD;
      byte_968DD = (char)pWinMgr->gameEvents[pWinMgr->Unknown_475C].p1;
      goto LABEL_47;
    }
    goto LABEL_10;
  }
  if ( eventId <= ASCEND_EP_BADSHIPENTERS )
  {
    goto LABEL_16;
  }
  if ( eventId >= 0x14 )
  {
    if ( eventId > 0x14 )
    {
      if ( eventId < 0x17 )
      {
        v8 = eventId == ASCEND_EP_22_XENO_COMPLETE;
      }
      else
      {
        if ( eventId <= 0x17 )
        {
          v4 = 0xD;
          byte_968DD = (char)pWinMgr->gameEvents[pWinMgr->Unknown_475C].p2;
          goto LABEL_47;
        }
        v8 = eventId == ASCEND_EP_25_FIRST_LAB;
      }
LABEL_45:
      if ( v8 )
      {
        v4 = 0x14;
      }
      goto LABEL_47;
    }
LABEL_16:
    if ( p1[0x58] != 4 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x6A8);
    }
    v5 = *(__int16 **)(p1 + 0x59);
    if ( (eventId == ASCEND_EP_FINDRACE || eventId == ASCEND_EP_RACEFINDUS) && v11 != 2 )
    {
      v4 = 0xD;
      if ( sub_45958(&V_Game.races[(_DWORD)p2].index, 2, v5, 0) )
      {
        V_Game.races[(_DWORD)p2].Unknown_1E9 = 1;
        V_Game.races[(_DWORD)p2].Unknown_1EA = (int)v5;
      }
      else
      {
        V_Game.races[(_DWORD)p2].Unknown_1E9 = 0;
      }
      byte_968DD = (char)p2;
    }
    else
    {
      v4 = 0x10;
      V_Game.pCurStar = *(P_Star *)(p1 + 0x59);
    }
    goto LABEL_47;
  }
  if ( eventId >= ASCEND_EP_16_ENTERED_ORBIT )
  {
    if ( eventId <= ASCEND_EP_18_REFIT_COMPLETE )
    {
      v4 = 0x11;
      V_Game.pCurPlanet = (P_Planet)pWinMgr->gameEvents[pWinMgr->Unknown_475C].p2;
    }
    else if ( v11 == 1 )
    {
      v4 = 0x10;
      V_Game.pCurStar = (P_Star)pWinMgr->gameEvents[pWinMgr->Unknown_475C].p1;
    }
    else if ( p2 == (void *)7 )
    {
      sub_56B60(pWinMgr, 7, 0, 0);
    }
    else
    {
      *(_DWORD *)&pWinMgr->z5[4] = 0xFFFFFFFF;
    }
    goto LABEL_47;
  }
  if ( eventId == ASCEND_EP_15_HAS_FREE_POPULATION )
  {
LABEL_10:
    v4 = 0x11;
    V_Game.pCurPlanet = (P_Planet)pWinMgr->gameEvents[pWinMgr->Unknown_475C].p1;
  }
LABEL_47:
  v9 = pWinMgr->Unknown_475C + 1;
  gameEventsNum = pWinMgr->gameEventsNum;
  pWinMgr->Unknown_475C = v9;
  if ( v9 == gameEventsNum )
  {
    pWinMgr->Unknown_475C = 0;
    pWinMgr->gameEventsNum = 0;
  }
  if ( v4 )
  {
    sub_56B60(pWinMgr, 1, v4, 1);
  }
}
// 968DD: using guessed type char byte_968DD;
// 10AE6C: using guessed type int dword_10AE6C;

//----- (00055E80) --------------------------------------------------------
void __fastcall sub_55E80(P_WinMgr pWinMgr)
{
  char *s_1; // edx
  __int16 v3; // ax
  int v4; // eax
  int v5; // ecx
  T_Star *v6; // ebx
  int v7; // ecx
  __int16 i; // si
  T_Star *v9; // eax
  T_Wnd20HW *v10; // ecx
  T_Wnd20HW *v11; // esi
  __int8 v12; // bl
  char *v13; // edi
  char *v14; // esi
  char v15; // al
  char v16; // al
  int v17; // eax
  T_Wnd20HW *v18; // esi
  __int8 v19; // dl
  char *v20; // edi
  char *v21; // esi
  char v22; // al
  char v23; // al
  int v24; // eax
  UBYTE v25; // al
  T_Wnd20HW *v26; // eax
  char format[576]; // [esp+0h] [ebp-524h] BYREF
  char v28[576]; // [esp+258h] [ebp-2CCh] BYREF
  char s[4]; // [esp+4B0h] [ebp-74h] BYREF
  char helptopic[4]; // [esp+4CCh] [ebp-58h] BYREF
  char v31[4]; // [esp+4E8h] [ebp-3Ch] BYREF
  char *Unknown_04; // [esp+504h] [ebp-20h]
  char *v33; // [esp+508h] [ebp-1Ch]
  __int8 *v34; // [esp+50Ch] [ebp-18h]
  __int8 *Unknown_C95; // [esp+510h] [ebp-14h]
  int v36; // [esp+514h] [ebp-10h]
  T_Wnd20HW *Wnd_sub_56DA8; // [esp+518h] [ebp-Ch]
  int v38; // [esp+51Ch] [ebp-8h]
  __int16 v39; // [esp+520h] [ebp-4h]

  HIWORD(s_1) = 0;
  qmemcpy(&pWinMgr->Unknown_422A[0xA1], &pWinMgr->Unknown_422A[1], 0x140u);
  v3 = pWinMgr->Unknown_422A[0x141];
  v39 = 0;
  v38 = (unsigned __int16)v3;
  pWinMgr->Unknown_422A[0x141] = 0;
  if ( v3 > 0 )
  {
    do
    {
      v4 = 5 * v39;
      LOWORD(s_1) = pWinMgr->Unknown_422A[v4 + 0xA1];
      v5 = *(_DWORD *)&pWinMgr->Unknown_422A[v4 + 0xA2];
      v36 = *(_DWORD *)&pWinMgr->Unknown_422A[v4 + 0xA4];
      switch ( (__int16)s_1 )
      {
        case 0:
          break;
        case 1:
          s_1 = (char *)(__int16)v5;
          sub_56E9C(pWinMgr, v5, (v36 == 0) - 1);
          break;
        case 2:
          HIWORD(s_1) = 0;
          Q_GameLoop_dword_96774 = 0;
          break;
        case 3:
          HIWORD(s_1) = 0xFFFF;
          sub_570AC(pWinMgr, 0xFFFFFFFF);
          break;
        case 4:
          if ( !pWinMgr->aaa && !pWinMgr->bbb )
          {
            s_1 = "WINEVENT.BIN";
            sub_59988(pWinMgr, "WINEVENT.BIN", 0xFFFFFFFF);
          }
          break;
        case 5:
          switch ( v36 )
          {
            case 1:
              s_1 = "ABILITYWIN";
              Wnd_sub_56DA8 = (T_Wnd20HW *)Q_FindWnd_sub_56DA8(pWinMgr, "ABILITYWIN", 0);
              Q_ShowHelpTopicAbil_sub_33884(Wnd_sub_56DA8, "ABILITYWIN", 0, v5);
              break;
            case 2:
              v10 = (T_Wnd20HW *)Q_FindWnd_sub_56DA8(pWinMgr, "HELPWINDOW", 0);
              Wnd_sub_56DA8 = v10;
              sprintf(s, "STATE%02d", pWinMgr->Unknown_4228);
              s_1 = "help.txt";
              Q_ShowHelpTopic_sub_2FCB0(v10, "help.txt", s);
              break;
            case 3:
              s_1 = "help.txt";
              Wnd_sub_56DA8 = (T_Wnd20HW *)Q_FindWnd_sub_56DA8(pWinMgr, "HELPWINDOW", 0);
              Q_ShowHelpTopic_sub_2FCB0(Wnd_sub_56DA8, "help.txt", "NOINTRO");
              break;
            case 4:
              sprintf(helptopic, "gizmo%02d", v5);
              s_1 = "gizhelp.txt";
              v11 = (T_Wnd20HW *)Q_FindWnd_sub_56DA8(pWinMgr, "HELPWINDOW", 0);
              Wnd_sub_56DA8 = v11;
              Q_ShowHelpTopic_sub_2FCB0(v11, "gizhelp.txt", helptopic);
              v12 = v11->Unknown_C95[0];
              Unknown_C95 = v11->Unknown_C95;
              Unknown_04 = v11->Unknown_C91[0].Unknown_04;
              if ( v12 != 1 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x784);
              }
              if ( *Unknown_04 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x785);
              }
              v13 = format;
              v14 = *(char **)(Unknown_C95 + 5);
              do
              {
                v15 = *v14;
                *v13 = *v14;
                if ( !v15 )
                {
                  break;
                }
                v16 = v14[1];
                v14 += 2;
                v13[1] = v16;
                v13 += 2;
              }
              while ( v16 );
              sprintf(*(char **)(Unknown_C95 + 5), format, &V_Gizmos[v5]);
              v17 = (int)Unknown_04;
              *(_WORD *)(Unknown_04 + 1) = 0x1C;
              *(_WORD *)(v17 + 3) = v5;
              break;
            case 5:
              sprintf(v31, "plitem%02d", v5);
              v18 = (T_Wnd20HW *)Q_FindWnd_sub_56DA8(pWinMgr, "HELPWINDOW", 0);
              Wnd_sub_56DA8 = v18;
              Q_ShowHelpTopic_sub_2FCB0(v18, "planhelp.txt", v31);
              v19 = v18->Unknown_C95[0];
              v34 = v18->Unknown_C95;
              v33 = v18->Unknown_C91[0].Unknown_04;
              if ( v19 != 1 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x79F);
              }
              if ( *v33 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x7A0);
              }
              v20 = v28;
              v21 = *(char **)(v34 + 5);
              do
              {
                v22 = *v21;
                *v20 = *v21;
                if ( !v22 )
                {
                  break;
                }
                v23 = v21[1];
                v21 += 2;
                v20[1] = v23;
                v20 += 2;
              }
              while ( v23 );
              s_1 = *(char **)(v34 + 5);
              sprintf(s_1, v28, V_PlanetItems.item[v5].name);
              if ( v5 == 0x17 )
              {
                s_1 = v33;
                v25 = V_RaceIndex;
                *(_WORD *)(v33 + 3) = 0;
                *(_WORD *)(s_1 + 1) = v25 + 0xE;
              }
              else
              {
                v24 = (int)v33;
                *(_WORD *)(v33 + 1) = 0x1E;
                *(_WORD *)(v24 + 3) = v5;
              }
              break;
            default:
              s_1 = "HELPWINDOW";
              v26 = (T_Wnd20HW *)Q_FindWnd_sub_56DA8(pWinMgr, "HELPWINDOW", 0);
              Wnd_sub_56DA8 = v26;
              if ( v5 )
              {
                s_1 = "help.txt";
                Q_ShowHelpTopic_sub_2FCB0(v26, "help.txt", (char *)v5);
              }
              break;
          }
          if ( !pWinMgr->Unknown_489E )
          {
            HIWORD(s_1) = HIWORD(Wnd_sub_56DA8);
            sub_552F8(pWinMgr, &Wnd_sub_56DA8->a2, 0);
          }
          if ( v36 == 1 )
          {
            s_1 = (char *)Q_FindWnd_sub_56DA8(pWinMgr, "COSMOSWnd", 0)->a1.index;
            sub_56D30(pWinMgr, (int)s_1, 0xD, 0, 0);
          }
          break;
        case 6:
          pWinMgr->Unknown_489E = 0;
          pWinMgr->Unknown_48A2 = v5;
          break;
        case 7:
          v6 = sub_20B3C(&V_Game);
          if ( v6 )
          {
            v7 = 7;
            if ( *(int *)((char *)&pWinMgr->wnds[0].a + (_DWORD)&loc_24D9B + 1) == 0xFFFFFFFF )
            {
              v7 = 8;
            }
            HIWORD(s_1) = 0;
            Q_AddGameEvent_sub_55AEC(pWinMgr, 0x13, v6, (void *)v7);
          }
          else
          {
            sub_20C94(&V_Game, (int)s_1, 0, v5);
            if ( *(int *)((char *)&pWinMgr->wnds[0].a + (_DWORD)&loc_24D9E + 2) == 0xFFFFFFFF )
            {
              for ( i = 0; i < V_Game.racesNum; ++i )
              {
                if ( i != V_RaceIndex )
                {
                  sub_46130(&V_Game.races[V_RaceIndex].index, i, 0xFFFFFFFF);
                  sub_45F60(&V_Game.races[V_RaceIndex].index, i, 0xFFFFFFFF);
                }
              }
            }
            HIWORD(s_1) = 0;
            sub_56BE8(pWinMgr, 0xD, 0, 0, 0);
            sub_5508C(pWinMgr);
          }
          break;
        case 8:
          v9 = sub_20B3C(&V_Game);
          if ( !v9 || V_FlashPopExists )
          {
            *(_DWORD *)&pWinMgr->z5[4] = ~*(_DWORD *)&pWinMgr->z5[4];
          }
          else
          {
            HIWORD(s_1) = 0;
            Q_AddGameEvent_sub_55AEC(pWinMgr, 0x13, v9, (void *)(__int16)s_1);
          }
          break;
        default:
          s_1 = "..\\winmgr.cpp";
          Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x7D7);
          break;
      }
      ++v39;
    }
    while ( v39 < (__int16)v38 );
  }
}
// 96774: using guessed type int Q_GameLoop_dword_96774;
// 55E80: using guessed type char var_74[4];
// 55E80: using guessed type char var_58[4];
// 55E80: using guessed type char var_3C[4];

//----- (00056400) --------------------------------------------------------
void __fastcall sub_56400(T_WinMgr *a1, int a2, __int16 a3, int a4, int a5, int a6)
{
  __int16 i; // kr00_2
  int v9; // eax

  if ( a1->counter1 == 0x10 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x7ED);
  }
  if ( a1->aaa == 0xFFFFFFFF || a1->bbb == 0xFFFFFFFF )
  {
    a6 = 0;
  }
  for ( i = 0; i < 0x10; ++i )
  {
    if ( !a1->b1[i].a )
    {
      a1->b1[i].a = a2;
      a1->b1[i].c = a4;
      a1->b1[i].b = a3;
      a1->b1[i].d = a5;
      v9 = V_Timer_dword_132B58;
      a1->b1[i].e = a6;
      a1->b1[i].f = a6 + v9;
      ++a1->counter1;
      break;
    }
  }
  sub_59C80(a1, a2, 4, a3, a4, a5, 0);
}
// 132B58: using guessed type int V_Timer_dword_132B58;

//----- (000564C0) --------------------------------------------------------
void __fastcall sub_564C0(T_WinMgr *a1, int a2, __int16 a3)
{
  __int16 i; // dx

  for ( i = 0; i < 0x10; ++i )
  {
    if ( a2 == a1->b1[i].a && (a3 == 0xFFFFFFFF || a3 == a1->b1[i].b) )
    {
      a1->b1[i].a = 0;
      --a1->counter1;
    }
  }
  sub_59C80(a1, a2, 5, a3, 0, 0, 0);
}

//----- (00056528) --------------------------------------------------------
int __fastcall sub_56528(int a1, int a2, __int16 a3)
{
  __int16 i; // ax

  for ( i = 0; i < 0x10; ++i )
  {
    if ( a2 == *(_DWORD *)(a1 + 0x16 * i + 0x44AE) && a3 == *(_WORD *)(a1 + 0x16 * i + 0x44B2) )
    {
      return *(_DWORD *)(a1 + 0x16 * i + 0x44BC);
    }
  }
  return 0xFFFF;
}

//----- (00056564) --------------------------------------------------------
unsigned int __fastcall sub_56564(int a1, int a2, __int16 a3, int a4)
{
  __int16 i; // dx

  for ( i = 0; i < 0x10; ++i )
  {
    if ( a2 == *(_DWORD *)(a1 + 0x16 * i + 0x44AE) && a3 == *(_WORD *)(a1 + 0x16 * i + 0x44B2) )
    {
      *(_DWORD *)(a1 + 0x16 * i + 0x44BC) = a4;
      return 0xFFFFFFFF;
    }
  }
  return 0;
}

//----- (00056694) --------------------------------------------------------
int __fastcall sub_56694(T_WinMgr *a1)
{
  __int16 counter1; // di
  int result; // eax
  T_SomeStruct5 *v4; // esi
  void (__fastcall *a)(int, int); // edx
  T_SomeStruct5 *b1; // [esp+4h] [ebp-20h]
  __int16 v7; // [esp+8h] [ebp-1Ch]

  counter1 = a1->counter1;
  v7 = 0;
  b1 = a1->b1;
  while ( 1 )
  {
    result = v7;
    if ( v7 >= 0x10 || counter1 <= 0 )
    {
      break;
    }
    v4 = &b1[v7];
    a = (void (__fastcall *)(int, int))v4->a;
    if ( v4->a )
    {
      if ( (unsigned int)V_Timer_dword_132B58 >= v4->f )
      {
        if ( v4->b == 0x29A )
        {
          a(v4->c, v4->d);
        }
        else
        {
          sub_56D30(a1, (int)a, v4->b, v4->c, v4->d);
        }
        v4->f += v4->e;
      }
      --counter1;
    }
    ++v7;
  }
  return result;
}
// 132B58: using guessed type int V_Timer_dword_132B58;

//----- (00056728) --------------------------------------------------------
void __fastcall sub_56728(P_WinMgr a1, int hwnd, int f, WORD msg, int p1, int p2)
{
  __int16 i; // kr00_2

  if ( a1->winEventSmallNum == 16 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x8C6);
  }
  for ( i = 0; i < 16; ++i )
  {
    if ( !a1->winEventsSmall[i].hwnd )
    {
      a1->winEventsSmall[i].hwnd = hwnd;
      a1->winEventsSmall[i].f = f;
      a1->winEventsSmall[i].msg = msg;
      a1->winEventsSmall[i].p1 = p1;
      a1->winEventsSmall[i].p2 = p2;
      ++a1->winEventSmallNum;
      break;
    }
  }
  sub_59C80(a1, hwnd, 6, msg, p1, p2, f);
}

//----- (000567BC) --------------------------------------------------------
void __fastcall sub_567BC(P_WinMgr a1, int a2, __int16 a3)
{
  __int16 i; // dx

  for ( i = 0; i < 16; ++i )
  {
    if ( a2 == a1->winEventsSmall[i].hwnd && (a3 == 0xFFFFFFFF || a3 == a1->winEventsSmall[i].msg) )
    {
      a1->winEventsSmall[i].hwnd = 0;
      --a1->winEventSmallNum;
    }
  }
  sub_59C80(a1, a2, 7, a3, 0, 0, 0);
}

//----- (00056824) --------------------------------------------------------
void __fastcall sub_56824(T_WinMgr *a1)
{
  int hwnd; // edi
  int v3; // [esp+0h] [ebp-28h]
  int v4; // [esp+4h] [ebp-24h]
  __int16 i; // [esp+8h] [ebp-20h]
  WORD winEventSmallNum; // [esp+Ch] [ebp-1Ch]

  winEventSmallNum = a1->winEventSmallNum;
  v4 = 0;
  v3 = 0;
  if ( V_Mouse.leftClicked == 0xFFFFFFFF )
  {
    v4 = 1;
  }
  if ( V_Mouse.rightClicked == 0xFFFFFFFF )
  {
    LOBYTE(v4) = v4 | 2;
  }
  if ( V_Mouse.moved == 0xFFFFFFFF )
  {
    LOBYTE(v3) = 4;
  }
  for ( i = 0; i < 0x10 && winEventSmallNum > 0; ++i )
  {
    hwnd = a1->winEventsSmall[i].hwnd;
    if ( hwnd )
    {
      if ( (v4 & a1->winEventsSmall[i].f) != 0 )
      {
        sub_56D30(a1, a1->winEventsSmall[i].hwnd, a1->winEventsSmall[i].msg, a1->winEventsSmall[i].p1, a1->winEventsSmall[i].p2);
      }
      if ( (v3 & a1->winEventsSmall[i].f) != 0 )
      {
        sub_56D30(a1, hwnd, a1->winEventsSmall[i].msg, V_Mouse.x, V_Mouse.y);
      }
      --winEventSmallNum;
    }
  }
}

//----- (0005691C) --------------------------------------------------------
P_WinMgr __fastcall sub_5691C(P_WinMgr result)
{
  P_WinMgr v1; // esi
  LONG x; // edi
  int v3; // edx
  LONG y; // ebp
  T_TypeA2 *a2; // ecx
  __int16 v6; // dx
  T_TypeA2 *v7; // ebx
  int Unknown_4228; // edx
  __int16 v9; // cx
  int v10; // eax
  T_TypeA2 *v11; // edx
  unsigned int v12; // [esp+4h] [ebp-28h]
  int wndIndex; // [esp+8h] [ebp-24h]
  P_WinMgr v14; // [esp+Ch] [ebp-20h]
  __int16 v15; // [esp+10h] [ebp-1Ch]

  v1 = result;
  x = V_Mouse.x;
  v3 = *(_DWORD *)result->z1aa;
  y = V_Mouse.y;
  if ( v3 == 0xFFFFFFFF )
  {
    goto LABEL_17;
  }
  a2 = result->wnds[v3].a2;
  if ( V_Mouse.x > a2->a1.pane.x1 || V_Mouse.x < a2->a1.pane.x0 || V_Mouse.y > a2->a1.pane.y1 || V_Mouse.y < a2->a1.pane.y0 )
  {
    sub_56D30(result, *(_DWORD *)result->z1aa, 8, V_Mouse.x, V_Mouse.y);
    result = (P_WinMgr)sub_56D30(v1, *(_DWORD *)v1->z1aa, 6, 0, 0);
    *(_DWORD *)v1->z1aa = 0xFFFFFFFF;
LABEL_17:
    Unknown_4228 = v1->Unknown_4228;
    if ( Unknown_4228 >= 0 )
    {
      v9 = 0x1F;
      v12 = 0;
      v15 = v1->Unknown_3066[0x47 * Unknown_4228 + 1];
      while ( 1 )
      {
        result = (P_WinMgr)v15;
        if ( v15 <= 0 || v12 )
        {
          break;
        }
        if ( v9 < 0 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x992);
        }
        v10 = *(_DWORD *)&v1->Unknown_3066[0x47 * v1->Unknown_4228 + 2 + 2 * v9];
        wndIndex = v10;
        if ( v10 )
        {
          v11 = v1->wnds[v10].a2;
          if ( v11->a1.zz == 0xFFFFFFFF
            && x <= v11->a1.pane.x1
            && x >= v11->a1.pane.x0
            && y <= v11->a1.pane.y1
            && y >= v11->a1.pane.y0
            && v11->a1.i == 0xFFFFFFFF )
          {
            v12 = 0xFFFFFFFF;
          }
          --v15;
        }
        --v9;
      }
      if ( v12 == 0xFFFFFFFF )
      {
        *(_DWORD *)v1->z1aa = wndIndex;
        return (P_WinMgr)sub_56D30(v1, wndIndex, 7, 0, 0);
      }
    }
    return result;
  }
  result = (P_WinMgr)(__int16)a2->a1.childrenCnt;
  if ( a2->a1.childrenCnt )
  {
    v6 = 0;
    if ( (__int16)a2->a1.childrenCnt > 0 )
    {
      while ( 1 )
      {
        result = (P_WinMgr)(*a2->a1.children)[v6];
        v14 = result;
        if ( *(T_TypeA2 **)((char *)&result->wnds[4].a2 + 1) )
        {
          v7 = result->wnds[1].a2;
          result = (P_WinMgr)((char *)result + 4);
          if ( V_Mouse.x <= (int)v7
            && V_Mouse.x >= (int)result->wnds[0].a2
            && V_Mouse.y <= (int)result->wnds[1].a2
            && V_Mouse.y >= result->wnds[0].c )
          {
            break;
          }
        }
        if ( ++v6 >= (__int16)a2->a1.childrenCnt )
        {
          return result;
        }
      }
      sub_56D30(v1, *(_DWORD *)v1->z1aa, 8, V_Mouse.x, V_Mouse.y);
      sub_56D30(v1, *(_DWORD *)v1->z1aa, 6, 0, 0);
      sub_56D30(v1, *(int *)((char *)&v14->wnds[5].a2 + 1), 7, 0, 0);
      result = *(P_WinMgr *)((char *)&v14->wnds[5].a2 + 1);
      *(_DWORD *)v1->z1aa = result;
    }
  }
  return result;
}
// 56B46: variable 'wndIndex' is possibly undefined

//----- (00056B60) --------------------------------------------------------
int __fastcall sub_56B60(P_WinMgr a1, __int16 a2, int a3, int a4)
{
  int v5; // edx
  int result; // eax

  if ( a1->Unknown_422A[0x141] == 0x20 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x9B5);
  }
  a1->Unknown_422A[5 * a1->Unknown_422A[0x141] + 1] = a2;
  *(_DWORD *)&a1->Unknown_422A[5 * a1->Unknown_422A[0x141] + 2] = a3;
  v5 = a1->Unknown_422A[0x141];
  result = 5 * v5;
  *(_DWORD *)&a1->Unknown_422A[5 * v5 + 4] = a4;
  ++a1->Unknown_422A[0x141];
  return result;
}

//----- (00056BE8) --------------------------------------------------------
void __fastcall sub_56BE8(P_WinMgr pWinMgr, __int16 a2, int a3, int a4, int a5)
{
  int Unknown_4228; // edx
  __int16 v7; // si
  int v8; // ecx
  int v9; // eax
  T_TypeA2 *v10; // eax
  unsigned int v11; // edx
  __int16 v13; // [esp+Ch] [ebp-10h]

  Unknown_4228 = pWinMgr->Unknown_4228;
  if ( Unknown_4228 >= 0 )
  {
    v7 = 0x1F;
    v8 = 0;
    v13 = pWinMgr->Unknown_3066[0x47 * Unknown_4228 + 1];
    while ( v13 > 0 && !v8 )
    {
      v8 = 0;
      if ( v7 < 0 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x9EA);
      }
      v9 = *(_DWORD *)&pWinMgr->Unknown_3066[0x47 * pWinMgr->Unknown_4228 + 2 + 2 * v7];
      if ( v9 )
      {
        v10 = pWinMgr->wnds[v9].a2;
        if ( !a5 || byte_132B38[v7] )
        {
          if ( (v10->a1.i || a2 == 1 || a2 == 0xE) && (!v10->a1.parentIndex || a2 > 2) )
          {
            v11 = 0xFFFFFFFF;
          }
          else
          {
            v11 = 0;
          }
          if ( v11 )
          {
            if ( a5 )
            {
              byte_132B38[v7] = 1;
            }
            v8 = ((int (*)(void))v10->procs->proc3)();
          }
          else if ( a5 )
          {
            byte_132B38[v7] = 0;
          }
        }
        --v13;
      }
      --v7;
    }
  }
}

//----- (00056D30) --------------------------------------------------------
int __fastcall sub_56D30(P_WinMgr pWinMgr, int wndIndex, WORD message, int param1, int param2)
{
  int result; // eax

  if ( pWinMgr->Unknown_4228 < 0 )
  {
    return 0;
  }
  pWinMgr->wnds[wndIndex].a2->procs->proc3(pWinMgr->wnds[wndIndex].a2, message, param1, param2);
  return result;
}

//----- (00056D70) --------------------------------------------------------
T_TypeA2 *__fastcall sub_56D70(T_WinMgr *a1, char *a2, __int16 a3, int a4, int param2)
{
  T_TypeA2 *result; // eax
  int v7; // [esp+0h] [ebp-Eh] BYREF

  result = Q_FindWnd_sub_56DA8(a1, a2, (_WORD *)&v7 + 1);
  if ( result )
  {
    sub_56D30(a1, SHIWORD(v7), a3, a4, param2);
    return (T_TypeA2 *)0xFFFFFFFF;
  }
  return result;
}

//----- (00056DA8) --------------------------------------------------------
T_TypeA2 *__fastcall Q_FindWnd_sub_56DA8(P_WinMgr pWinMgr, char *name, _WORD *index)
{
  WORD j; // si
  __int16 i; // cx
  T_TypeA2 *a2; // edx

  j = 0;
  for ( i = 0; ; ++i )
  {
    if ( i >= 1024 || j > pWinMgr->wndCnt )
    {
      return 0;
    }
    a2 = pWinMgr->wnds[i].a2;
    if ( a2 )
    {
      ++j;
      if ( !strncmp(name, a2->a1.name, 10u) )
      {
        break;
      }
    }
  }
  if ( index )
  {
    *index = i;
  }
  return pWinMgr->wnds[i].a2;
}

//----- (00056E18) --------------------------------------------------------
T_TypeA2 *__fastcall sub_56E18(P_WinMgr a1, char *s1, __int16 a3, _WORD *a4)
{
  WORD i; // cx
  int v7; // edi
  T_TypeA2 *a2; // edx

  if ( a3 < *(__int16 *)&a1->z1e[0x594] )
  {
    for ( i = 0; i < a1->Unknown_3066[0x47 * a3 + 1]; ++i )
    {
      v7 = *(_DWORD *)&a1->Unknown_3066[0x47 * a3 + 2 + 2 * i];
      a2 = a1->wnds[v7].a2;
      if ( a2 && !strncmp(s1, a2->a1.name, 0xAu) )
      {
        if ( a4 )
        {
          *a4 = v7;
        }
        return a1->wnds[v7].a2;
      }
    }
  }
  return 0;
}

//----- (00056E9C) --------------------------------------------------------
P_WinMgr __fastcall sub_56E9C(P_WinMgr a1, WORD a2, int a3)
{
  P_WinMgr v3; // esi
  int Unknown_4228; // ebx
  int v6; // edx
  int v7; // edx
  int v8; // ebx
  int v9; // eax
  __int16 v10; // ax
  PANE_LIST *pPaneList; // eax
  int v12; // eax

  v3 = a1;
  if ( a2 != a1->Unknown_4228 )
  {
    if ( a2 < 0 || a2 >= 0x20 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xA9B);
    }
    Unknown_4228 = a1->Unknown_4228;
    if ( Unknown_4228 >= 0 )
    {
      v6 = a1->Unknown_3066[0x47 * Unknown_4228];
      if ( v6 != 0xFFFFFFFF )
      {
        sub_4F45C(&V_SoundSystem, v6);
      }
    }
    v7 = v3->Unknown_3066[0x47 * a2];
    if ( v7 != 0xFFFFFFFF )
    {
      sub_4F32C(&V_SoundSystem, v7, 0);
    }
    v8 = v3->Unknown_4228;
    if ( v8 >= 0 && *(_DWORD *)&v3->_wndStates[v8][4] )
    {
      (*(void (__fastcall **)(_DWORD, WORD *))&v3->_wndStates[v8][4])(v3->Unknown_4228, &v3->Unknown_3066[0x47 * v8]);
    }
    v9 = *(_DWORD *)v3->z1aa;
    if ( v9 != 0xFFFFFFFF )
    {
      sub_56D30(v3, v9, 6, 0, 0);
    }
    sub_56BE8(v3, 2, 0, 0, 0);
    if ( a3 == 0xFFFFFFFF && v3->Unknown_4228 >= 0 )
    {
      v10 = *(_WORD *)&v3->z2[0x22];
      *(_WORD *)&v3->z2[0x22] = v10 + 1;
      *(_WORD *)&v3->z2[2 * v10] = v3->Unknown_4228;
      if ( *(_WORD *)&v3->z2[0x22] == 0x10 )
      {
        *(_WORD *)&v3->z2[0x22] = 0;
      }
      ++*(_WORD *)&v3->z2[0x20];
    }
    v3->Unknown_4228 = a2;
    if ( !v3->Unknown_4228 && dword_96BC0 == 0xFFFFFFFF && !access("resume.gam", 0) )
    {
      Q_LoadGam_sub_53FB0("resume.gam");
    }
    pPaneList = v3->pPaneList;
    dword_96BC0 = 0;
    sub_5B71C(pPaneList);
    sub_55214(v3, 0, 0, 0x27F, 0x1DF);
    v12 = 0x8E * a2;
    if ( *(_DWORD *)&v3->_wndStates[v12 / 0x8Eu][0] )
    {
      (*(void (__fastcall **)(_DWORD, WORD *))&v3->_wndStates[v12 / 0x8Eu][0])(a2, &v3->Unknown_3066[v12 / 2u]);
    }
    sub_56BE8(v3, 1, 0, 0, 0);
    *(_DWORD *)v3->z1aa = 0xFFFFFFFF;
    return sub_5691C(v3);
  }
  return a1;
}
// 96BC0: using guessed type int dword_96BC0;

//----- (000570AC) --------------------------------------------------------
int __fastcall sub_570AC(P_WinMgr a1, int a2)
{
  __int16 v4; // dx
  int v5; // ecx

  if ( !*(_WORD *)&a1->z2[0x20] )
  {
    return 0;
  }
  if ( *(_WORD *)&a1->z2[0x22] )
  {
    v4 = *(_WORD *)&a1->z2[0x22] - 1;
  }
  else
  {
    v4 = 0xF;
  }
  v5 = v4;
  LOWORD(v5) = *(_WORD *)&a1->z2[2 * v4];
  if ( a2 == 0xFFFFFFFF )
  {
    *(_WORD *)&a1->z2[0x22] = v4;
    *(_WORD *)&a1->z2[2 * *(__int16 *)&a1->z2[0x22]] = 0xFFFF;
    --*(_WORD *)&a1->z2[0x20];
    sub_56E9C(a1, v5, 0);
  }
  return v5;
}

//----- (000571B8) --------------------------------------------------------
int __fastcall Q_WINMGR_CPP_RegisterWindow_sub_571B8(P_WinMgr a1, P_TypeA1 a2)
{
  __int16 i; // dx
  int result; // eax

  if ( !a2 || a1->wndCnt == 1023 )
  {
    return 0;
  }
  for ( i = 1; ; ++i )
  {
    result = i;
    if ( i >= 1024 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xB37);
    }
    if ( !a1->wnds[i].a )
    {
      break;
    }
  }
  a1->wnds[i].a = 1;
  a1->wnds[i].a2 = (T_TypeA2 *)a2;
  ++a1->wndCnt;
  a2->magic12345678 = 0x12345678;
  return result;
}

//----- (00057220) --------------------------------------------------------
unsigned int __fastcall sub_57220(P_WinMgr a1, int index, __int16 state)
{
  if ( state < 0 || state >= 0x20 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xB42);
  }
  if ( index >= 0x400 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xB43);
  }
  if ( !index || a1->Unknown_3066[0x47 * state + 1] == 0x20 )
  {
    return 0;
  }
  LOWORD(a1) = 0;
  if ( a1->Unknown_3066[0x47 * state + 1] )
  {
    while ( (__int16)a1 < 0x20 )
    {
      if ( !*(_DWORD *)&a1->Unknown_3066[0x47 * state + 2 + 2 * (__int16)a1] )
      {
        *(_DWORD *)&a1->Unknown_3066[0x47 * state + 2 + 2 * (__int16)a1] = index;
        ++a1->Unknown_3066[0x47 * state + 1];
        break;
      }
      LOWORD(a1) = (_WORD)a1 + 1;
    }
  }
  else
  {
    ++*(_WORD *)&a1->z1e[0x594];
    a1->Unknown_3066[0x47 * state + 1] = 1;
    *(_DWORD *)&a1->Unknown_3066[0x47 * state + 2] = index;
  }
  ++a1->wnds[index].a;
  if ( (__int16)a1 >= 0x20 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xB65);
  }
  return 0xFFFFFFFF;
}

//----- (00057310) --------------------------------------------------------
unsigned int __fastcall sub_57310(P_WinMgr a1, int a2, __int16 a3, int a4)
{
  __int16 i; // cx
  int v7; // ebx

  if ( a3 < 0 || a3 >= 0x20 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xB75);
  }
  if ( a2 >= 0x400 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xB76);
  }
  if ( !a2 || !a1->Unknown_3066[0x47 * a3 + 1] )
  {
    return 0;
  }
  for ( i = 0; i < 0x20; ++i )
  {
    v7 = *(_DWORD *)&a1->Unknown_3066[0x47 * a3 + 2 + 2 * i];
    if ( a2 == v7 )
    {
      *(_DWORD *)&a1->Unknown_3066[0x47 * a3 + 2 + 2 * i] = 0;
      --a1->Unknown_3066[0x47 * a3 + 1];
      --a1->wnds[v7].a;
      if ( a4 )
      {
        sub_57530(a1, a2, 0);
      }
      break;
    }
  }
  if ( i < 0x20 )
  {
    return 0xFFFFFFFF;
  }
  else
  {
    return 0;
  }
}

//----- (0005748C) --------------------------------------------------------
unsigned int __fastcall sub_5748C(P_WinMgr a1, __int16 stateNumber, __int16 a3)
{
  char *v3; // esi
  unsigned int result; // eax

  if ( stateNumber < 0 || stateNumber >= 0x20 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xBA8);
  }
  v3 = (char *)a1 + 0x8E * stateNumber;
  if ( *((unsigned __int16 *)v3 + 0x1875) != 0xFFFF )
  {
    return 0;
  }
  result = 0xFFFFFFFF;
  *((_WORD *)v3 + 0x1875) = a3;
  return result;
}

//----- (000574F0) --------------------------------------------------------
void __fastcall Q_SetProc1_sub_574F0(P_WinMgr a1, __int16 index, void *proc)
{
  *(_DWORD *)&a1->_wndStates[index][0] = proc;
}

//----- (00057510) --------------------------------------------------------
void __fastcall Q_SetProc2_sub_57510(P_WinMgr a1, __int16 index, void *proc)
{
  *(_DWORD *)&a1->_wndStates[index][4] = proc;
}

//----- (00057530) --------------------------------------------------------
void __fastcall sub_57530(P_WinMgr a1, int wndIndex, int a3)
{
  int v5; // edx
  int v6; // eax
  int v7; // eax
  int v8; // eax

  if ( wndIndex >= 1024 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xBDB);
  }
  if ( wndIndex )
  {
    v5 = a1->wnds[wndIndex].a - 1;
    a1->wnds[wndIndex].a = v5;
    if ( !v5 || a3 )
    {
      sub_2627C(a1->wnds[wndIndex].a2);
      v7 = *(_DWORD *)(v6 + 0xC * wndIndex + 4);
      if ( v7 )
      {
        (**(void (***)(void))(v7 + 0xA7))();
      }
      v8 = wndIndex;
      a1->wnds[v8].a2 = 0;
      a1->wnds[v8].a = 0;
      --a1->wndCnt;
    }
  }
}
// 57583: variable 'v6' is possibly undefined

//----- (000575BC) --------------------------------------------------------
void __fastcall sub_575BC(P_WinMgr a1)
{
  void *v2; // eax
  T_HazeTable *v3; // ecx
  _BYTE *v4; // edx
  int i; // eax
  void *v6; // eax
  T_HazeTable *v7; // ecx
  _BYTE *v8; // edx
  int j; // eax

  v2 = operator new[](0x100u);
  Q_RegisterData_sub_2625C(v2, 1, "WMGR MAPFOCUS");
  v3 = (T_HazeTable *)v2;
  if ( !v2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xBF7);
  }
  v4 = v2;
  for ( i = 0; i < 0x100; ++i )
  {
    *v4++ = i;
  }
  (*v3)[0xF2] = 0x96;
  a1->hazeTableMapFocus = v3;
  v6 = operator new[](0x100u);
  Q_RegisterData_sub_2625C(v6, 1, "WMGR MAPRACES");
  v7 = (T_HazeTable *)v6;
  if ( !v6 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xC01);
  }
  v8 = v6;
  for ( j = 0; j < 0x100; ++j )
  {
    *v8++ = j;
  }
  a1->hazeTableMapRaces = v7;
  a1->pPaneList = sub_5B617(0x80u);
  Q_WINMGR_CPP_LoadWindowsTxt_sub_57670(a1, "windows.txt");
}

//----- (00057670) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_LoadWindowsTxt_sub_57670(P_WinMgr pType3, const char *fname)
{
  FILE *fp0; // edx
  FILE *fp; // esi
  int largestMem; // ecx
  char *v6; // ebx
  T_TypeA1 *pTypeA1; // eax
  int v8; // edx
  T_TypeA1 *v9; // edx
  char *pName; // ebp
  T_TypeA2 *v11; // ecx
  T_TypeA1 *v12; // edx
  __int16 mm; // cx
  P_TypeA1 v14; // edx
  WORD v15; // ax
  P_TypeA1 v16; // edx
  P_TypeA1 v17; // edx
  int y; // ecx
  WORD *p_Unknown_76; // ebp
  WORD *v20; // ebx
  T_Wnd1FLIC *v21; // eax
  int v22; // ebp
  char *name; // edx
  T_TypeA2 *Wnd_sub_56DA8; // eax
  int i; // ecx
  int v26; // ebx
  int j; // ecx
  WINDOW *window; // eax
  WORD racesNum; // dx
  int v30; // eax
  WORD v31; // bx
  char v32; // dh
  T_TypeA3 *v33; // eax
  T_TypeA3 *v34; // ebp
  char *v35; // edx
  T_TypeA2 *v36; // eax
  __int16 k; // cx
  WORD v38; // ax
  P_Wnd4BM v39; // eax
  P_Wnd4BM v40; // ebp
  char *v41; // edx
  T_TypeA2 *v42; // eax
  int ii; // ecx
  WINDOW *v44; // eax
  __int16 jj; // cx
  WORD v46; // ax
  P_Wnd10LB vpWnd10LB; // eax
  P_Wnd10LB v48; // ebp
  char *v49; // edx
  T_TypeA2 *v50; // eax
  int kk; // ecx
  __int16 v52; // ax
  signed __int16 l; // cx
  unsigned __int16 v54; // bx
  P_Wnd13DBGWND v55; // eax
  P_Wnd13DBGWND v56; // ecx
  WINDOW *v57; // eax
  P_Wnd8SW v58; // eax
  P_Wnd8SW v59; // ebp
  char *v60; // edx
  T_TypeA2 *v61; // eax
  P_Wnd2COSW vpWnd2COSW; // eax
  char *v63; // edx
  P_Wnd2COSW vpWnd2COSW__; // ebp
  T_TypeA2 *v65; // eax
  WORD *v66; // [esp-Ch] [ebp-3C8h]
  WORD *v67; // [esp-Ch] [ebp-3C8h]
  WORD *v68; // [esp-4h] [ebp-3C0h]
  WORD *v69; // [esp-4h] [ebp-3C0h]
  char v70[108]; // [esp+0h] [ebp-3BCh] BYREF
  char v71[108]; // [esp+80h] [ebp-33Ch] BYREF
  char bufc2[108]; // [esp+100h] [ebp-2BCh] BYREF
  char bufc4[108]; // [esp+180h] [ebp-23Ch] BYREF
  char bufc3[108]; // [esp+200h] [ebp-1BCh] BYREF
  char v75[108]; // [esp+280h] [ebp-13Ch] BYREF
  char v76[32]; // [esp+300h] [ebp-BCh] BYREF
  char bufc1[32]; // [esp+334h] [ebp-88h] BYREF
  WORD v78[7]; // [esp+368h] [ebp-54h] BYREF
  int bufi; // [esp+378h] [ebp-44h] BYREF
  P_TypeA1 a1a; // [esp+37Ch] [ebp-40h]
  int v81; // [esp+380h] [ebp-3Ch]
  P_Type13 p_t13; // [esp+384h] [ebp-38h]
  P_Type13 v83; // [esp+388h] [ebp-34h]
  T_Font *p_SmallFont; // [esp+38Ch] [ebp-30h]
  T_Font *p_LargeFont; // [esp+390h] [ebp-2Ch]
  WORD *p_Unknown_78; // [esp+394h] [ebp-28h]
  WORD *p_Unknown_72; // [esp+398h] [ebp-24h]
  int m; // [esp+39Ch] [ebp-20h]
  int bufi2; // [esp+3A0h] [ebp-1Ch] BYREF
  int v90; // [esp+3A4h] [ebp-18h] BYREF
  __int16 wndType; // [esp+3A8h] [ebp-14h]
  int winItems; // [esp+3ACh] [ebp-10h]
  int v93; // [esp+3B0h] [ebp-Ch]
  __int16 numControls; // [esp+3B4h] [ebp-8h] BYREF
  WORD n; // [esp+3B8h] [ebp-4h]

  fp0 = Q_OpenFile_sub_1BB10(fname, 0);
  fp = fp0;
  if ( fp0 )
  {
    // MEM_REQ        2300000
    fscanf(fp0, "%s %d", bufc1, &bufi);
    largestMem = Q_CheckFreeMemory_sub_53DEC();
    if ( largestMem <= bufi )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xC27);
    }
    Q_CACHE_CPP_ShapeCache_sub_1AD1C(&pType3->t13, largestMem - 200000);
    Q_GWINDOW_CPP_LoadGwshareTxt_sub_2D2CC();
    p_t13 = &pType3->t13;
    p_LargeFont = &pType3->LargeFont;
    v83 = &pType3->t13;
    p_SmallFont = &pType3->SmallFont;
    while ( 1 )
    {
      fscanf(fp, "%s %d", bufc1, &bufi);
      if ( bufi == 0xFFFFFFFF )
      {
        // END            -1
        fclose(fp);
        return;
      }
      wndType = bufi;
      if ( (unsigned int)bufi < 9 )
      {
        if ( (unsigned int)bufi < 3 )
        {
          if ( !bufi )
          {
            goto LABEL_16;
          }
          if ( (unsigned int)bufi <= 1 )
          {
            // TYPE           1
            // Intro
            v21 = (T_Wnd1FLIC *)operator new(0xA09u);
            if ( v21 )
            {
              Q_Wnd1FLICCtor_sub_2AE80(v21);
            }
            Q_RegisterData_sub_2625C(v21, 2, "FLIC");
            v22 = (int)v21;
            name = v21->a.a1.name;
            Q_WINMGR_CPP_RegisterWindow_sub_2C978(&v21->a.a1);
            // INTROFLIC
            fscanf(fp, "%s %s", bufc1, name);
            fscanf(fp, "%s", bufc1);
            fscanf(fp, "%s", bufc1);
            if ( strcmp(bufc1, "NONE") )
            {
              Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(pType3, bufc1, 0);
              if ( !Wnd_sub_56DA8 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xCF8);
              }
              *(_DWORD *)(v22 + 0x63) = Wnd_sub_56DA8->a1.index;
              Q_GWINDOW_CPP_LinkChild_sub_2C990(&Wnd_sub_56DA8->a1, (P_TypeA1)v22);
            }
            fscanf(fp, "%s %d", bufc1, &bufi2);
            for ( i = 0; (__int16)i < (__int16)bufi2; ++i )
            {
              fscanf(fp, "%d", &bufi);
              if ( !sub_57220(pType3, *(_DWORD *)(v22 + 0x41), bufi) )
              {
                Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xD02);
              }
            }
            fscanf(fp, "%s %d", bufc1, v22 + 8);
            fscanf(fp, "%s %d", bufc1, v22 + 0xC);
            fscanf(fp, "%s %d", bufc1, v22 + 0x10);
            fscanf(fp, "%s %d", bufc1, v22 + 0x14);
            fscanf(fp, "%s %s", bufc1, v75);
            sub_2AF04(v22, v75);
            fscanf(fp, "%s %d", bufc1, &bufi);
            *(_WORD *)(v22 + 0xA01) = bufi;
            fscanf(fp, "%s %d", bufc1, &bufi);
            *(_WORD *)(v22 + 0xA03) = bufi;
            fscanf(fp, "%s %d", bufc1, &bufi);
            *(_WORD *)(v22 + 0xA05) = bufi;
            fscanf(fp, "%s %d", bufc1, &bufi);
            *(_WORD *)(v22 + 0xA07) = bufi;
            fscanf(fp, "%s %d", bufc1, &bufi);
            v26 = bufi;
            if ( bufi != 0xFFFFFFFF )
            {
              *(_DWORD *)(v22 + 0x9E5) = 0xFFFFFFFF;
              *(_DWORD *)(v22 + 0x9E9) = v26;
            }
            fscanf(fp, "%s %d", bufc1, v22 + 0x45);
            fscanf(fp, "%s %d", bufc1, v22 + 0x47);
            fscanf(fp, "%s %d", bufc1, v22 + 0x4B);
            fscanf(fp, "%s %s", bufc1, v22 + 0x4F);
            fscanf(fp, "%s %d", bufc1, &bufi);
            *(_WORD *)(v22 + 0x9F5) = bufi;
            fscanf(fp, "%s %d", bufc1, &bufi);
            if ( bufi )
            {
              *(_DWORD *)(v22 + 0x9F1) = 0xFFFFFFFF;
            }
            *(_DWORD *)(v22 + 4) = pType3->window;
          }
          else
          {
            // TYPE           2
            // Cosmos Window (Galactic Display)
            vpWnd2COSW = (P_Wnd2COSW)operator new(0x596u);
            if ( vpWnd2COSW )
            {
              vpWnd2COSW = Q_Wnd2COSWCtor_sub_224A4(vpWnd2COSW);
            }
            Q_RegisterData_sub_2625C(vpWnd2COSW, 2, "COSW");
            v63 = vpWnd2COSW->a.a1.name;
            vpWnd2COSW__ = vpWnd2COSW;
            Q_WINMGR_CPP_RegisterWindow_sub_2C978(&vpWnd2COSW->a.a1);
            dword_96BAC = *(_DWORD *)(v63 + 0x21);
            // NAME           COSMOSWnd
            fscanf(fp, "%s %s", bufc1, v63);
            // PARENT
            fscanf(fp, "%s", bufc1);
            // NONE
            fscanf(fp, "%s", bufc1);
            if ( strcmp(bufc1, "NONE") )
            {
              v65 = Q_FindWnd_sub_56DA8(pType3, bufc1, 0);
              if ( !v65 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xD41);
              }
              vpWnd2COSW__->a.a1.parentIndex = v65->a1.index;
              Q_GWINDOW_CPP_LinkChild_sub_2C990(&v65->a1, &vpWnd2COSW__->a.a1);
            }
            // STATE          4 1 3 7 13
            fscanf(fp, "%s %d", bufc1, &bufi2);
            for ( j = 0; (__int16)j < (__int16)bufi2; ++j )
            {
              fscanf(fp, "%d", &bufi);
              if ( !sub_57220(pType3, vpWnd2COSW__->a.a1.index, bufi) )
              {
                Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xD4B);
              }
            }
            fscanf(fp, "%s %d", bufc1, &vpWnd2COSW__->a.a1.pane.x0);
            fscanf(fp, "%s %d", bufc1, &vpWnd2COSW__->a.a1.pane.y0);
            fscanf(fp, "%s %d", bufc1, &vpWnd2COSW__->a.a1.pane.x1);
            fscanf(fp, "%s %d", bufc1, &vpWnd2COSW__->a.a1.pane.y1);
            // BACKGRNDCOLOR
            fscanf(fp, "%s %d", bufc1, &bufi);
            vpWnd2COSW__->backgroundColor = bufi;
            // STAR_SHAPES
            fscanf(fp, "%s %s", bufc1, v70);
            // SHIP_SHAPES
            fscanf(fp, "%s %s", bufc1, v71);
            Q_COSWND_CPP_sub_22644(vpWnd2COSW__, v70, v71);
            // NUM_STARS
            fscanf(fp, "%s %d", bufc1, &bufi);
            // NUM_LANES
            fscanf(fp, "%s %d", bufc1, &v90);
            // SMALLSEED
            fscanf(fp, "%s %d", bufc1, &bufi);
            // MEDIUMSEED
            fscanf(fp, "%s %d", bufc1, &bufi);
            // LARGESEED
            fscanf(fp, "%s %d", bufc1, &bufi);
            // HUGESEED
            fscanf(fp, "%s %d", bufc1, &bufi);
            // CURSORSHAPE
            fscanf(fp, "%s %d", bufc1, &bufi);
            vpWnd2COSW__->cursorShape = bufi;
            fscanf(fp, "%s %d", bufc1, &vpWnd2COSW__->a.a1.sendMessage);
            fscanf(fp, "%s %d", bufc1, &vpWnd2COSW__->a.a1.sendParam1);
            fscanf(fp, "%s %d", bufc1, &vpWnd2COSW__->a.a1.sendParam2);
            fscanf(fp, "%s %s", bufc1, vpWnd2COSW__->a.a1.helpIndex);
            window = pType3->window;
            vpWnd2COSW__->a.a1.d = 0xFFFF;
            vpWnd2COSW__->a.a1.e = 0;
            racesNum = V_Game.racesNum;
            vpWnd2COSW__->Unknown_D9 = 0;
            vpWnd2COSW__->a.a1.pane.window = window;
            v30 = 0;
            if ( racesNum > 0 )
            {
              do
              {
                v31 = V_Game.racesNum;
                v32 = (1 << v30++) | vpWnd2COSW__->Unknown_D9;
                vpWnd2COSW__->Unknown_D9 = v32;
              }
              while ( (__int16)v30 < v31 );
            }
          }
        }
        else if ( (unsigned int)bufi <= 3 )
        {
          // TYPE           3
          v33 = (T_TypeA3 *)operator new(0xB3u);
          if ( v33 )
          {
            Q_A3_sub_2D9C4(v33);
          }
          Q_RegisterData_sub_2625C(v33, 2, "CTW");
          v34 = v33;
          v35 = v33->a2.a1.name;
          Q_WINMGR_CPP_RegisterWindow_sub_2DA68(&v33->a2.a1);
          // NAME = RACECONTROLS
          fscanf(fp, "%s %s", bufc1, v35);
          // PARENT
          fscanf(fp, "%s", bufc1);
          fscanf(fp, "%s", bufc1);
          if ( strcmp(bufc1, "NONE") )
          {
            v36 = Q_FindWnd_sub_56DA8(pType3, bufc1, 0);
            if ( !v36 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xD8D);
            }
            v34->a2.a1.parentIndex = v36->a1.index;
            Q_GWINDOW_CPP_LinkChild_sub_2C990(&v36->a1, &v34->a2.a1);
          }
          // STATE
          fscanf(fp, "%s %d", bufc1, &bufi2);
          for ( k = 0; k < (__int16)bufi2; ++k )
          {
            fscanf(fp, "%d", &bufi);
            if ( !sub_57220(pType3, v34->a2.a1.index, bufi) )
            {
              Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xD97);
            }
            if ( !k )
            {
              v38 = pType3->Unknown_3066[0x47 * bufi + 0x42];
              v34->a2.a1.e = 0;
              v34->a2.a1.d = v38;
            }
          }
          fscanf(fp, "%s %d", bufc1, &v34->a2.a1.pane.x0);
          fscanf(fp, "%s %d", bufc1, &v34->a2.a1.pane.y0);
          fscanf(fp, "%s %d", bufc1, &v34->a2.a1.pane.x1);
          fscanf(fp, "%s %d", bufc1, &v34->a2.a1.pane.y1);
          // SHAPEFRAME
          fscanf(fp, "%s %d", bufc1, &bufi);
          v34->a2.a1.shapeFrame = bufi;
          v34->a2.a1.r = 0;
          fscanf(fp, "%s %d", bufc1, &v34->a2.a1.sendMessage);
          fscanf(fp, "%s %d", bufc1, &v34->a2.a1.sendParam1);
          fscanf(fp, "%s %d", bufc1, &v34->a2.a1.sendParam2);
          fscanf(fp, "%s %s", bufc1, v34->a2.a1.helpIndex);
          v34->a2.a1.pane.window = pType3->window;
          // NUMCONTROLS
          fscanf(fp, "%s %d", bufc1, &numControls);
          if ( sub_2DA80(v34, numControls) == FALSE )
          {
            Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xDB9);
          }
          for ( m = 0; (__int16)m < numControls; ++m )
          {
            // RACE1CONTROL
            fscanf(fp, "%s %d", bufc1, &bufi);
            v78[0] = bufi;
            fscanf(fp, "%d", &bufi);
            v78[1] = bufi;
            fscanf(fp, "%d", &bufi);
            v78[3] = bufi;
            fscanf(fp, "%d", &bufi);
            v78[2] = bufi;
            fscanf(fp, "%d", &bufi);
            v78[4] = bufi;
            fscanf(fp, "%d", &bufi);
            v78[5] = bufi;
            fscanf(fp, "%d", &bufi);
            v78[6] = bufi;
            if ( !sub_2DAC8(v34, 0, 0, v78) )
            {
              Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xDD4);
            }
          }
          for ( n = 0; n < V_Game.racesNum; ++n )
          {
            sub_2DAC8(v34, 1 << n, 1, 0);
          }
        }
        else if ( (unsigned int)bufi < 5 )
        {
          // TYPE           4
          // Battle Mode Window (System Display)
          v39 = (P_Wnd4BM)operator new(0x504Eu);
          if ( v39 )
          {
            Q_Wnd4BMCtor_sub_15ED4(v39);
          }
          Q_RegisterData_sub_2625C(v39, 2, "BM");
          v40 = v39;
          v41 = v39->a.a1.name;
          Q_WINMGR_CPP_RegisterWindow_sub_2C978(&v39->a.a1);
          // NAME           BatModeWnd
          fscanf(fp, "%s %s", bufc1, v41);
          // PARENT
          fscanf(fp, "%s", bufc1);
          fscanf(fp, "%s", bufc1);
          if ( strcmp(bufc1, "NONE") )
          {
            v42 = Q_FindWnd_sub_56DA8(pType3, bufc1, 0);
            if ( !v42 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xDE9);
            }
            v40->a.a1.parentIndex = v42->a1.index;
            Q_GWINDOW_CPP_LinkChild_sub_2C990(&v42->a1, &v40->a.a1);
          }
          fscanf(fp, "%s %d", bufc1, &bufi2);
          for ( ii = 0; (__int16)ii < (__int16)bufi2; ++ii )
          {
            fscanf(fp, "%d", &bufi);
            if ( !sub_57220(pType3, v40->a.a1.index, bufi) )
            {
              Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xDF3);
            }
          }
          fscanf(fp, "%s %d", bufc1, &v40->a.a1.pane.x0);
          fscanf(fp, "%s %d", bufc1, &v40->a.a1.pane.y0);
          fscanf(fp, "%s %d", bufc1, &v40->a.a1.pane.x1);
          fscanf(fp, "%s %d", bufc1, &v40->a.a1.pane.y1);
          // BACKGRNDCOLOR
          fscanf(fp, "%s %d", bufc1, &bufi);
          v40->backgroundColor = bufi;
          // CURSORSHAPE
          fscanf(fp, "%s %d", bufc1, &bufi);
          v40->cursorShape = bufi;
          sub_18370(v40);
          fscanf(fp, "%s %d", bufc1, &v40->a.a1.sendMessage);
          fscanf(fp, "%s %d", bufc1, &v40->a.a1.sendParam1);
          fscanf(fp, "%s %d", bufc1, &v40->a.a1.sendParam2);
          fscanf(fp, "%s %s", bufc1, v40->a.a1.helpIndex);
          v44 = pType3->window;
          v40->a.a1.d = 0xFFFF;
          v40->a.a1.e = 0;
          v40->a.a1.pane.window = v44;
        }
        else
        {
          if ( (unsigned int)bufi <= 7 )
          {
            goto LABEL_16;
          }
          // TYPE           8
          // Ship Design Screen
          v58 = (P_Wnd8SW)operator new(0x237u);
          if ( v58 )
          {
            v58 = sub_4D92C(v58);
          }
          Q_RegisterData_sub_2625C(v58, 2, "SW");
          v59 = v58;
          v60 = v58->a.a1.name;
          Q_WINMGR_CPP_RegisterWindow_sub_2C978(&v58->a.a1);
          fscanf(fp, "%s %s", bufc1, v60);
          fscanf(fp, "%s", bufc1);
          fscanf(fp, "%s", bufc1);
          if ( strcmp(bufc1, "NONE") )
          {
            v61 = Q_FindWnd_sub_56DA8(pType3, bufc1, 0);
            if ( !v61 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xE21);
            }
            v59->a.a1.parentIndex = v61->a1.index;
            Q_GWINDOW_CPP_LinkChild_sub_2C990(&v61->a1, &v59->a.a1);
          }
          fscanf(fp, "%s %d", bufc1, &bufi2);
          for ( jj = 0; jj < (__int16)bufi2; ++jj )
          {
            fscanf(fp, "%d", &bufi);
            if ( !sub_57220(pType3, v59->a.a1.index, bufi) )
            {
              Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xE2B);
            }
            if ( !jj )
            {
              v46 = pType3->Unknown_3066[0x47 * bufi + 0x42];
              v59->a.a1.e = 0;
              v59->a.a1.d = v46;
            }
          }
          fscanf(fp, "%s %d", bufc1, &bufi);
          if ( bufi )
          {
            v59->a.a1._mouseFocus = 0xFFFFFFFF;
          }
          fscanf(fp, "%s %d", bufc1, &v59->a.a1.pane.x0);
          fscanf(fp, "%s %d", bufc1, &v59->a.a1.pane.y0);
          fscanf(fp, "%s %d", bufc1, &v59->a.a1.pane.x1);
          fscanf(fp, "%s %d", bufc1, &v59->a.a1.pane.y1);
          fscanf(fp, "%s %d", bufc1, &bufi);
          v59->a.a1.r = bufi;
          fscanf(fp, "%s %d", bufc1, &v59->a.a1.sendMessage);
          fscanf(fp, "%s %d", bufc1, &v59->a.a1.sendParam1);
          fscanf(fp, "%s %d", bufc1, &v59->a.a1.sendParam2);
          fscanf(fp, "%s %s", bufc1, v59->a.a1.helpIndex);
          v59->a.a1.pane.window = pType3->window;
        }
      }
      else
      {
        if ( (unsigned int)bufi <= 9 )
        {
          goto LABEL_16;
        }
        if ( (unsigned int)bufi < 14 )
        {
          if ( (unsigned int)bufi < 11 )
          {
            // TYPE           10
            // List
            vpWnd10LB = (P_Wnd10LB)operator new(0x902u);
            if ( vpWnd10LB )
            {
              Q_Wnd10LBCtor_sub_2E248(vpWnd10LB);
            }
            Q_RegisterData_sub_2625C(vpWnd10LB, 2, "LB");
            v48 = vpWnd10LB;
            v49 = vpWnd10LB->a.a1.name;
            Q_WINMGR_CPP_RegisterWindow_sub_2E3BC(&vpWnd10LB->a.a1);
            fscanf(fp, "%s %s", bufc1, v49);
            fscanf(fp, "%s", bufc1);
            fscanf(fp, "%s", bufc1);
            if ( strcmp(bufc1, "NONE") )
            {
              v50 = Q_FindWnd_sub_56DA8(pType3, bufc1, 0);
              if ( !v50 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xE5E);
              }
              v48->a.a1.parentIndex = v50->a1.index;
              Q_GWINDOW_CPP_LinkChild_sub_2C990(&v50->a1, &v48->a.a1);
            }
            fscanf(fp, "%s %d", bufc1, &bufi2);
            for ( kk = 0; (__int16)kk < (__int16)bufi2; ++kk )
            {
              fscanf(fp, "%d", &bufi);
              if ( !sub_57220(pType3, v48->a.a1.index, bufi) )
              {
                Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xE68);
              }
            }
            fscanf(fp, "%s %d", bufc1, &bufi);
            if ( bufi )
            {
              v48->a.a1._mouseFocus = 0xFFFFFFFF;
            }
            fscanf(fp, "%s %d", bufc1, &v48->a.a1.pane.x0);
            fscanf(fp, "%s %d", bufc1, &v48->a.a1.pane.y0);
            fscanf(fp, "%s %d", bufc1, &v48->a.a1.pane.x1);
            fscanf(fp, "%s %d", bufc1, &v48->a.a1.pane.y1);
            fscanf(fp, "%s %d", bufc1, &bufi);
            v48->a.a1.shapeFrame = bufi;
            fscanf(fp, "%s %d", bufc1, &bufi);
            v48->a.a1.r = bufi;
            fscanf(fp, "%s %d", bufc1, &v48->a.a1.sendMessage);
            fscanf(fp, "%s %d", bufc1, &v48->a.a1.sendParam1);
            fscanf(fp, "%s %d", bufc1, &v48->a.a1.sendParam2);
            fscanf(fp, "%s %s", bufc1, v48->a.a1.helpIndex);
            v48->a.a1.pane.window = pType3->window;
          }
          else
          {
            if ( (unsigned int)bufi <= 12 )
            {
              goto LABEL_16;
            }
            // TYPE           13
            // Debug Window
            v55 = (P_Wnd13DBGWND)operator new(0xC0u);
            if ( v55 )
            {
              Q_Wnd13DBGWNDCtor_sub_5A594(v55);
            }
            Q_RegisterData_sub_2625C(v55, 2, "DBGWND");
            v56 = v55;
            if ( !v55 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xE8E);
            }
            Q_WINMGR_CPP_RegisterWindow_sub_5A5F4(&v55->a2.a1);
            pType3->pWnd13DBGWND = v56;
            // NAME           WMGRDEBUG
            fscanf(fp, "%s %s", bufc1, v56->a2.a1.name);
            fscanf(fp, "%s %d", bufc1, &v56->a2.a1.pane.x0);
            fscanf(fp, "%s %d", bufc1, &v56->a2.a1.pane.y0);
            fscanf(fp, "%s %d", bufc1, &v56->a2.a1.pane.x1);
            fscanf(fp, "%s %d", bufc1, &v56->a2.a1.pane.y1);
            fscanf(fp, "%s %d", bufc1, &v56->cX0);
            fscanf(fp, "%s %d", bufc1, &v56->cY0);
            fscanf(fp, "%s %d", bufc1, &v56->cX1);
            fscanf(fp, "%s %d", bufc1, &v56->cY1);
            fscanf(fp, "%s %s", bufc1, v76);
            v56->a2.a1.d = Q_CACHE_CPP_sub_1ADAC(p_t13, v76);
            v57 = pType3->window;
            v56->a2.a1.pane.window = v57;
            v56->window = v57;
          }
        }
        else
        {
          if ( (unsigned int)bufi <= 27 )
          {
            goto LABEL_16;
          }
          if ( (unsigned int)bufi < 100 )
          {
            if ( (unsigned int)bufi < 29 || (unsigned int)bufi > 32 )
            {
LABEL_262:
              Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xEF2);
            }
LABEL_16:
            if ( bufi )
            {
              switch ( bufi )
              {
                case 5:
                  // Races Window
                  v6 = "RW";
                  pTypeA1 = (T_TypeA1 *)operator new(0xABu);
                  if ( pTypeA1 )
                  {
                    sub_25BF8((P_TypeA2)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 6:
                  // Race Selection Window
                  v6 = "RSW";
                  pTypeA1 = (T_TypeA1 *)operator new(0xB1u);
                  if ( pTypeA1 )
                  {
                    Q_WndRSWCtor_sub_25CB8((P_WndRSW)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 7:
                  // Planet Window
                  v6 = "PW";
                  pTypeA1 = (T_TypeA1 *)operator new(0x18Cu);
                  if ( pTypeA1 )
                  {
                    Q_WndPW_sub_372B0((P_WndPW)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 11:
                  // Load Window
                  v6 = "LW";
                  pTypeA1 = (T_TypeA1 *)operator new(0xFE0u);
                  if ( pTypeA1 )
                  {
                    Q_WndLW_sub_31200((P_WndLW)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 12:
                  // Intelligence Window
                  v6 = "IW";
                  pTypeA1 = (T_TypeA1 *)operator new(0xAFu);
                  if ( pTypeA1 )
                  {
                    Q_WndIW_sub_33598((P_WndIW)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 9:
                  // Research Window
                  pTypeA1 = (T_TypeA1 *)operator new(0x9DDu);
                  v81 = 2;
                  if ( pTypeA1 )
                  {
                    Q_A2Ctor_sub_2C830((P_TypeA2)pTypeA1);
                    sub_1B4F0((P_Wnd9RW1)&pTypeA1[1].pane);
                    _wcpp_2_ctor_array_(&pTypeA1[1].Unknown_7A[0x22], 0x64u, &C_Vector3D);
                    v9 = pTypeA1;
                    pTypeA1[1].magic12345678 = (int)off_96018;
                    sub_46CAC((P_Wnd9RW)pTypeA1);
                    pTypeA1 = v9;
                  }
                  v8 = v81;
                  v6 = "RW";
                  break;
                case 14:
                  // Planet Square Window
                  v6 = "PSW";
                  pTypeA1 = (T_TypeA1 *)operator new(0xADu);
                  if ( pTypeA1 )
                  {
                    Q_Wnd14PSWCtor_sub_39D80((P_Wnd14PSW)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 15:
                  // Number of turns
                  v6 = "NT";
                  pTypeA1 = (T_TypeA1 *)operator new(0xAFu);
                  if ( pTypeA1 )
                  {
                    Q_WndNT_sub_2F2F4((P_WndNT)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 16:
                  // Status Window (Planet Status Screen)
                  v6 = "SW";
                  pTypeA1 = (T_TypeA1 *)operator new(0xB1u);
                  if ( pTypeA1 )
                  {
                    Q_WndSWCtor_sub_51674((P_WndSW)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 17:
                  // Fleet Window (Ship Status Screen)
                  v6 = "FW";
                  pTypeA1 = (T_TypeA1 *)operator new(0xB1u);
                  if ( pTypeA1 )
                  {
                    Q_WndFWCtor_sub_51B64((P_WndFW)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 18:
                  // New Game Display
                  v6 = "NG";
                  pTypeA1 = (T_TypeA1 *)operator new(0xBDu);
                  if ( pTypeA1 )
                  {
                    Q_WndNGCtor_sub_520EC((P_WndNG)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 19:
                  // Battle Control Window
                  v8 = 2;
                  pTypeA1 = (T_TypeA1 *)operator new(0x108u);
                  if ( pTypeA1 )
                  {
                    Q_WndBC_sub_10A3C((P_WndBC)pTypeA1);
                  }
                  v6 = "BC";
                  break;
                case 20:
                  // Help Window
                  v6 = "HW";
                  pTypeA1 = (T_TypeA1 *)operator new(0xDAFu);
                  if ( pTypeA1 )
                  {
                    Q_A2_sub_2FC50((P_TypeA2)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 21:
                  // Negotiation Window
                  v8 = 2;
                  pTypeA1 = (T_TypeA1 *)operator new(0xC3u);
                  if ( pTypeA1 )
                  {
                    Q_WndNW_sub_3201C((P_WndNW)pTypeA1);
                  }
                  v6 = "NW";
                  break;
                case 22:
                  // Ability Window
                  v6 = "AW";
                  pTypeA1 = (T_TypeA1 *)operator new(0xDAFu);
                  if ( pTypeA1 )
                  {
                    Q_WndAW_sub_33830((P_WndAW)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 23:
                  // Event Window
                  v6 = "EW";
                  pTypeA1 = (T_TypeA1 *)operator new(0xDB3u);
                  if ( pTypeA1 )
                  {
                    Q_Wnd23EWCtor_sub_267A0((P_Wnd23EW)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 24:
                  // End Game Window
                  v6 = "EW";
                  pTypeA1 = (T_TypeA1 *)operator new(0xABu);
                  if ( pTypeA1 )
                  {
                    Q_A2_sub_27BF8((P_TypeA2)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 25:
                  // Toggle Window
                  v6 = "TW";
                  pTypeA1 = (T_TypeA1 *)operator new(0xAFu);
                  if ( pTypeA1 )
                  {
                    Q_A4_sub_2D464((P_TypeA4TogWnd)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 26:
                  // Alien Diplomacy (Communication Display)
                  v6 = "MW";
                  pTypeA1 = (T_TypeA1 *)operator new(0xB3u);
                  if ( pTypeA1 )
                  {
                    Q_A3_sub_2FA18((P_TypeA3)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 29:
                  // Planet Research, Prosperity, Production, Industry, Population, Project
                  v6 = "GSW";
                  pTypeA1 = (T_TypeA1 *)operator new(0xABu);
                  if ( pTypeA1 )
                  {
                    Q_A2_sub_395EC((P_TypeA2)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 30:
                  // Start Game
                  v6 = "EW";
                  pTypeA1 = (T_TypeA1 *)operator new(0xABu);
                  if ( pTypeA1 )
                  {
                    Q_A2_sub_2712C((T_TypeA2 *)pTypeA1);
                  }
                  v8 = 2;
                  break;
                case 31:
                  // Abandon Button
                  v6 = "pcw";
                  v8 = 2;
                  pTypeA1 = (T_TypeA1 *)operator new(0xABu);
                  if ( pTypeA1 )
                  {
                    Q_A2Ctor_sub_2C830((P_TypeA2)pTypeA1);
                    pTypeA1[1].magic12345678 = (int)off_961DC;
                  }
                  break;
                case 32:
                  // My Items (Player Items in this system)
                  v6 = "miw";
                  v8 = 2;
                  pTypeA1 = (T_TypeA1 *)operator new(0xABu);
                  if ( pTypeA1 )
                  {
                    Q_A2Ctor_sub_2C830((P_TypeA2)pTypeA1);
                    pTypeA1[1].magic12345678 = (int)off_961C4;
                  }
                  break;
                default:
                  goto LABEL_111;
              }
            }
            else
            {
              // TYPE           0
              v6 = "GW";
              pTypeA1 = (T_TypeA1 *)operator new(0xABu);
              if ( pTypeA1 )
              {
                Q_A2Ctor_sub_2C830((P_TypeA2)pTypeA1);
              }
              v8 = 2;
            }
            Q_RegisterData_sub_2625C(pTypeA1, v8, v6);
            a1a = pTypeA1;
LABEL_111:
            pName = a1a->name;
            Q_WINMGR_CPP_RegisterWindow_sub_2C978(a1a);
            // NAME
            fscanf(fp, "%s %s", bufc1, pName);
            // PARENT
            fscanf(fp, "%s", bufc1);
            fscanf(fp, "%s", bufc1);
            if ( strcmp(bufc1, "NONE") )
            {
              v11 = Q_FindWnd_sub_56DA8(pType3, bufc1, 0);
              if ( !v11 )
              {
                sub_2620C("%s bad parent", (char)pName);
                sub_261B8(0, "..\\winmgr.cpp", 0xC8D);
              }
              v12 = a1a;
              a1a->parentIndex = v11->a1.index;
              Q_GWINDOW_CPP_LinkChild_sub_2C990(&v11->a1, v12);
            }
            // STATE
            fscanf(fp, "%s %d", bufc1, &bufi2);
            for ( mm = 0; mm < (__int16)bufi2; ++mm )
            {
              fscanf(fp, "%d", &bufi);
              if ( !sub_57220(pType3, a1a->index, bufi) )
              {
                Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xC97);
              }
              if ( !mm )
              {
                v14 = a1a;
                v15 = pType3->Unknown_3066[0x47 * bufi + 0x42];
                a1a->e = 0;
                v14->d = v15;
              }
            }
            // MOUSEFOCUS
            fscanf(fp, "%s %d", bufc1, &bufi);
            if ( bufi )
            {
              a1a->_mouseFocus = TRUE;
            }
            if ( wndType == 25 )
            {
              // BUTTONSTATE
              fscanf(fp, "%s %d", bufc1, &bufi);
              if ( bufi )
              {
                a1a[1].pane.window = (WINDOW *)0xFFFFFFFF;
              }
            }
            fscanf(fp, "%s %d", bufc1, &a1a->pane.x0);
            fscanf(fp, "%s %d", bufc1, &a1a->pane.y0);
            fscanf(fp, "%s %d", bufc1, &a1a->pane.x1);
            fscanf(fp, "%s %d", bufc1, &a1a->pane.y1);
            fscanf(fp, "%s %d", bufc1, &bufi);
            v16 = a1a;
            a1a->shapeFrame = bufi;
            if ( wndType == 0xF )
            {
              fscanf(fp, "%s %d", bufc1, &bufi);
              v16[1].pane.window = (WINDOW *)bufi;
            }
            fscanf(fp, "%s %d", bufc1, &bufi);
            v17 = a1a;
            a1a->r = bufi;
            fscanf(fp, "%s %d", bufc1, &v17->sendMessage);
            fscanf(fp, "%s %d", bufc1, &v17->sendParam1);
            fscanf(fp, "%s %d", bufc1, &v17->sendParam2);
            fscanf(fp, "%s %s", bufc1, v17->helpIndex);
            // WINITEMS
            fscanf(fp, "%s %d", bufc1, &bufi);
            y = (int)v17->y;
            v93 = 0;
            winItems = bufi;
            if ( (__int16)bufi > 0 )
            {
              p_Unknown_76 = &v17->Unknown_76;
              p_Unknown_78 = &v17->Unknown_78;
              p_Unknown_72 = &v17->Unknown_72;
              do
              {
                fscanf(fp, "%s %d", bufc1, &bufi);
                if ( bufi )
                {
                  if ( bufi == 1 )
                  {
                    // SHAPEITEM      1
                    v69 = p_Unknown_78;
                    v67 = p_Unknown_72;
                    *(_BYTE *)y = 1;
                    fscanf(fp, "%s %d %d %d", bufc1, v67, p_Unknown_76, v69);
                    *(_DWORD *)(y + 1) = (unsigned __int16)sub_1B270(&WinMgr.t13, bufc1, 0xFFFFFFFF);
                  }
                  else
                  {
                    Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xCE1);
                  }
                }
                else
                {
                  // TEXTITEM       0
                  v68 = p_Unknown_78;
                  v66 = p_Unknown_72;
                  *(_BYTE *)y = 0;
                  fscanf(fp, "%s %d %d %d", bufc1, v66, p_Unknown_76, v68);
                  *(_DWORD *)(y + 1) = sub_2D334(bufc1);
                }
                v20 = p_Unknown_78;
                sub_2D400((int)a1a, y);
                p_Unknown_76 = (WORD *)((char *)p_Unknown_76 + 0xD);
                y += 0xD;
                p_Unknown_78 = (WORD *)((char *)v20 + 0xD);
                ++v93;
                p_Unknown_72 = (WORD *)((char *)p_Unknown_72 + 0xD);
              }
              while ( (__int16)v93 < (__int16)winItems );
            }
            a1a->pane.window = pType3->window;
          }
          else if ( (unsigned int)bufi <= 100 )
          {
            // TYPE           100
            // STATENUMBER    0
            // SHAPEFILE      DATA\0OPENING.SHP
            fscanf(fp, "%s %d", bufc1, &bufi);
            fscanf(fp, "%s %s", bufc1, bufc4);
            v52 = Q_CACHE_CPP_sub_1ADAC(v83, bufc4);
            if ( !sub_5748C(pType3, bufi, v52) )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xECA);
            }
          }
          else
          {
            if ( (unsigned int)bufi < 200 )
            {
              goto LABEL_262;
            }
            if ( (unsigned int)bufi <= 200 )
            {
              // HAZEVIBLES     200
              // NUMTABLES      23
              fscanf(fp, "%s %d", bufc1, &bufi);
              l = 0;
              Q_AllocateHazeTables_sub_2C08C(&V_Type6_stru_D8654, bufi);
              while ( l < bufi )
              {
                v54 = l;
                fscanf(fp, "%s %s", bufc1, bufc2);
                ++l;
                Q_LoadHazeTables_sub_2C0C0(&V_Type6_stru_D8654, bufc2, v54);
              }
            }
            else
            {
              if ( bufi != 300 )
              {
                goto LABEL_262;
              }
              // FONTS          300
              // SMALLFONT      DATA\SMFONT.FNT
              fscanf(fp, "%s %s", bufc1, bufc3);
              if ( sub_2B360((void **)&p_SmallFont->pVfxFont, bufc3) != TRUE )
              {
                Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xEE6);
              }
              pType3->SmallFont.Unknown_1C = 0;
              // LARGEFONT      DATA\BIGFONT.FNT
              fscanf(fp, "%s %s", bufc1, bufc3);
              if ( sub_2B360((void **)&p_LargeFont->pVfxFont, bufc3) != TRUE )
              {
                Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xEEB);
              }
              pType3->LargeFont.Unknown_1C = 0;
            }
          }
        }
      }
    }
  }
}
// 96018: using guessed type int (*off_96018[5])();
// 961C4: using guessed type int (*off_961C4[2])();
// 961DC: using guessed type int (*off_961DC[2])();
// 96BAC: using guessed type int dword_96BAC;
// 57670: using guessed type char anonymous_3[108];
// 57670: using guessed type char anonymous_4[108];
// 57670: using guessed type char bufc2[108];
// 57670: using guessed type char bufc4[108];
// 57670: using guessed type char anonymous_7[108];
// 57670: using guessed type char anonymous_8[32];

//----- (00059828) --------------------------------------------------------
void __fastcall Q_LoadAscendCfg_sub_59828(P_WinMgr a1)
{
  T_FileInfo v2; // [esp-124h] [ebp-128h] BYREF

  Q_InitFileInfo_sub_1BB78(&v2);
  if ( !Q_OpenFile_sub_1BBFC(&v2, "ascend.cfg", O_BINARY, 0) )
  {
    Q_ReadFile_sub_1BF94(&v2, &V_SoundSystem._notstarted1, 4u);
    Q_ReadFile_sub_1BF94(&v2, &V_SoundSystem.c, 4u);
    Q_ReadFile_sub_1BF94(&v2, &a1->j, 4u);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v2);
}

//----- (0005989C) --------------------------------------------------------
T_FileInfo *__fastcall Q_SaveAscendCfg_sub_5989C(P_WinMgr a1)
{
  T_FileInfo *result; // eax
  T_FileInfo v3; // [esp-120h] [ebp-124h] BYREF

  Q_InitFileInfo_sub_1BB78(&v3);
  if ( !Q_OpenFile_sub_1BCA8(&v3, "ascend.cfg") )
  {
    Q_CFILE_CPP_dos_write_sub_1C098(&v3.fh, &V_SoundSystem._notstarted1, 4u);
    Q_CFILE_CPP_dos_write_sub_1C098(&v3.fh, &V_SoundSystem.c, 4u);
    Q_CFILE_CPP_dos_write_sub_1C098(&v3.fh, &a1->j, 4u);
  }
  result = &v3;
  Q_CloseFileAndDelete_sub_1BBC8(&v3);
  return result;
}
// 598F2: returning address of temporary local variable '%0x0'

//----- (00059908) --------------------------------------------------------
int __fastcall sub_59908(int result)
{
  if ( !*(_DWORD *)(result + 0x48A6) && !*(_DWORD *)(result + 0x48AA) )
  {
    *(_DWORD *)(result + 0x48A6) = 0xFFFFFFFF;
    *(_DWORD *)(result + 0x48BA) = 0;
    *(_DWORD *)(result + 0x48B6) = 0;
  }
  return result;
}

//----- (00059934) --------------------------------------------------------
void __fastcall sub_59934(P_WinMgr a1, int toTxt)
{
  if ( a1->aaa == 0xFFFFFFFF || a1->bbb == 0xFFFFFFFF )
  {
    if ( a1->aaa == 0xFFFFFFFF )
    {
      a1->aaa = 0;
      Q_WINMGR_CPP_WriteWinEventBin_sub_59DE0(a1);
      if ( toTxt )
      {
        Q_WINMGR_CPP_WinEventBinToTxt_sub_59E88(a1, "WINEVENT.BIN", "WINEVENT.TXT");
      }
    }
    a1->bbb = 0;
  }
}

//----- (00059988) --------------------------------------------------------
unsigned int __fastcall sub_59988(P_WinMgr a1, char *a2, int a3)
{
  int v4; // kr08_4
  int v5; // kr18_4
  char v6; // al
  char v7; // al
  int v8; // kr10_4
  char *v9; // kr1C_4
  int v10; // kr20_4
  char v11; // al
  char v12; // al
  int aaa; // ecx
  unsigned int result; // eax

  v4 = 0;
  v5 = 0;
  do
  {
    v6 = a2[2 * v4];
    byte_132B20[2 * v5] = v6;
    if ( !v6 )
    {
      break;
    }
    v7 = a2[2 * v4 + 1];
    byte_132B20[2 * v5 + 1] = v7;
    ++v4;
    ++v5;
  }
  while ( v7 );
  v8 = 0;
  v9 = &byte_132B20[strlen(byte_132B20) - 4];
  v10 = 0;
  do
  {
    v11 = aTxt[2 * v8];
    v9[2 * v10] = v11;
    if ( !v11 )
    {
      break;
    }
    v12 = aTxt[2 * v8 + 1];
    v9[2 * v10 + 1] = v12;
    ++v8;
    ++v10;
  }
  while ( v12 );
  dword_132B14 = V_Mouse.left;
  aaa = a1->aaa;
  dword_132B18 = V_Mouse.right;
  if ( aaa == 0xFFFFFFFF || a1->bbb == 0xFFFFFFFF )
  {
    return 0;
  }
  result = sub_59CFC(a1, a2);
  if ( result )
  {
    a1->bbb = 0xFFFFFFFF;
    a1->_time = 0;
    result = 0xFFFFFFFF;
    a1->Unknown_48BE = 0;
    a1->z3[0] = a3;
    dword_132B1C = 0;
  }
  return result;
}
// 132B14: using guessed type int dword_132B14;
// 132B18: using guessed type int dword_132B18;
// 132B1C: using guessed type int dword_132B1C;

//----- (00059A54) --------------------------------------------------------
P_WinMgr __fastcall sub_59A54(P_WinMgr a1)
{
  P_WinMgr v1; // ecx
  unsigned int v2; // edi
  LONG y; // ebp
  LONG v4; // eax
  int v5; // eax
  T_Wnd20HW *Wnd_sub_56DA8; // esi
  unsigned int v7; // eax
  LONG x; // [esp+0h] [ebp-1Ch]

  v1 = a1;
  if ( a1->bbb )
  {
    x = V_Mouse.x;
    V_Mouse.left = dword_132B14;
    v2 = 0xFFFFFFFF;
    V_Mouse.right = dword_132B18;
    y = V_Mouse.y;
    Q_ProcessInput_sub_2656C();
    if ( V_Keyboard.Pressed == 0xFFFFFFFF
      || V_Mouse.leftClicked == 0xFFFFFFFF && V_Mouse.left
      || V_Mouse.rightClicked == 0xFFFFFFFF && V_Mouse.right )
    {
      v4 = V_Mouse.x;
      v1->bbb = 0;
      y = V_Mouse.y;
      x = v4;
      v5 = 0;
      if ( !v1->Unknown_489E )
      {
        Wnd_sub_56DA8 = (T_Wnd20HW *)Q_FindWnd_sub_56DA8(v1, "HELPWINDOW", 0);
        Q_ShowHelpTopic_sub_2FCB0(Wnd_sub_56DA8, "help.txt", "endtut");
        v5 = sub_552F8(v1, &Wnd_sub_56DA8->a2, 0);
      }
      if ( v5 )
      {
        v7 = time(0);
        srand(v7);
        v2 = 0;
        LODWORD(v1->j) = dword_96BBC;
      }
      else
      {
        v1->bbb = 0xFFFFFFFF;
      }
    }
    if ( v2 )
    {
      V_Mouse.y = y;
      V_Mouse.moved = 0;
      V_Mouse.x = x;
    }
    dword_132B14 = V_Mouse.left;
    a1 = (P_WinMgr)V_Mouse.right;
    dword_132B18 = V_Mouse.right;
  }
  return a1;
}
// 96BBC: using guessed type int dword_96BBC;
// 132B14: using guessed type int dword_132B14;
// 132B18: using guessed type int dword_132B18;

//----- (00059B80) --------------------------------------------------------
void __fastcall sub_59B80(T_WinMgr *a1)
{
  T_WinEvent *winEvents; // esi
  int Unknown_48BE; // eax
  int v4; // eax
  unsigned __int16 v5; // dx
  int v6; // edx
  int winEventsNum; // ebx

  winEvents = a1->winEvents;
  V_Mouse.leftClicked = 0;
  V_Mouse.rightClicked = 0;
  V_Mouse.moved = 0;
  V_Keyboard.Pressed = 0;
  while ( 1 )
  {
    Unknown_48BE = a1->Unknown_48BE;
    if ( a1->_time < (unsigned int)a1->winEvents[Unknown_48BE].time )
    {
      break;
    }
    v4 = (int)&winEvents[Unknown_48BE];
    v5 = *(_WORD *)(v4 + 8);
    if ( !v5 )
    {
      goto LABEL_5;
    }
    if ( v5 <= 3u )
    {
      sub_265A8(v4);
    }
    else if ( v5 > 7u )
    {
LABEL_5:
      sprintf(
        "Thank you for playing Ascendancy.",
        "\nBad Trace Event: %d of %d\n\nEVENT[%d] HWND[%0d] MSG[%d] P1[%d] P2[%d]\n",
        a1->Unknown_48BE,
        a1->winEventsNum,
        *(__int16 *)(v4 + 8),
        *(_DWORD *)(v4 + 4),
        *(__int16 *)(v4 + 0xA),
        *(_DWORD *)(v4 + 0xC),
        *(_DWORD *)(v4 + 0x10));
      Q_debugbreak_exit_sub_2624C();
    }
    v6 = a1->Unknown_48BE + 1;
    winEventsNum = a1->winEventsNum;
    a1->Unknown_48BE = v6;
    if ( v6 >= winEventsNum )
    {
      if ( a1->z3[0] != 0xFFFFFFFF )
      {
        sub_59934(a1, 0);
        return;
      }
      a1->Unknown_48BE = 0;
      a1->_time = 0;
    }
  }
}

//----- (00059C80) --------------------------------------------------------
void __fastcall sub_59C80(P_WinMgr a1, int hwnd, WORD eventType, WORD msg, int p1, int p2, int f)
{
  T_WinEvent *v8; // edx
  int v9; // edi

  if ( a1->aaa == 0xFFFFFFFF && !a1->bbb )
  {
    v8 = &a1->winEvents[a1->winEventsNum];
    v8->time = a1->_time;
    v8->hwnd = hwnd;
    v8->eventType = eventType;
    v8->msg = msg;
    v8->p1 = p1;
    v8->p2 = p2;
    v8->f = f;
    v9 = a1->winEventsNum + 1;
    a1->winEventsNum = v9;
    if ( v9 == 5000 )
    {
      sub_59934(a1, FALSE);
    }
  }
}

//----- (00059CFC) --------------------------------------------------------
unsigned int __fastcall sub_59CFC(P_WinMgr a1, const char *a2)
{
  unsigned int v3; // ebx
  unsigned int v4; // eax
  T_FileInfo v6; // [esp+0h] [ebp-124h] BYREF

  Q_InitFileInfo_sub_1BB78(&v6);
  if ( a1->aaa == 0xFFFFFFFF )
  {
    Q_CloseFileAndDelete_sub_1BBC8(&v6);
    return 0;
  }
  else
  {
    if ( Q_OpenFile_sub_1BBFC(&v6, a2, 0x200, 0) )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x104F);
    }
    if ( (unsigned int)Q_GetFileLength_sub_1BE28(&v6) > 0x1D4D0 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x1052);
    }
    Q_ReadFile_sub_1BF94(&v6, a1->Unknown_21D82, 16u);
    v4 = Q_ReadFile_sub_1BF94(&v6, a1->winEvents, 120000u);
    a1->winEventsNum = v4 / 0x18;
    if ( v4 % 0x18 )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x1059);
    }
    v3 = 0xFFFFFFFF;
    a1->Unknown_48BE = 0;
    Q_CloseFileAndDelete_sub_1BBC8(&v6);
  }
  return v3;
}

//----- (00059DE0) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_WriteWinEventBin_sub_59DE0(P_WinMgr a1)
{
  T_FileInfo fi; // [esp-124h] [ebp-128h] BYREF

  Q_InitFileInfo_sub_1BB78(&fi);
  if ( a1->aaa != 0xFFFFFFFF )
  {
    if ( Q_OpenFile_sub_1BBFC(&fi, "WINEVENT.BIN", 0x21, 0) )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x106C);
    }
    Q_CFILE_CPP_dos_write_sub_1C098(&fi.fh, a1->Unknown_21D82, 0x10u);
    Q_CFILE_CPP_dos_write_sub_1C098(&fi.fh, a1->winEvents, 0x18 * a1->winEventsNum);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&fi);
}

//----- (00059E88) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_WinEventBinToTxt_sub_59E88(P_WinMgr a1, char *binname, char *txtname)
{
  FILE *fp; // ecx
  __int16 i; // bx
  const char *v6; // eax
  const char *v7; // eax
  const char *v8; // eax
  const char *v9; // eax
  T_WinEvent *vEvt; // edx
  const char *v11; // [esp-4h] [ebp-8h]

  if ( !a1->aaa && !a1->bbb )
  {
    fp = fopen(txtname, "w");
    if ( !fp )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x107D);
    }
    if ( sub_59CFC(a1, binname) != 0xFFFFFFFF )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x1080);
    }
    for ( i = 0; i < a1->winEventsNum; ++i )
    {
      vEvt = &a1->winEvents[i];
      switch ( vEvt->eventType )
      {
        case 1:
          fprintf(fp, " TIME[%05lu]  EVT_MOUSE_POS    : ", vEvt->time);
          fprintf(fp, " Moved to (%03d,%03d)\n", vEvt->p1, vEvt->p2);
          break;
        case 2:
          fprintf(fp, " TIME[%05lu]  EVT_MOUSE_BUTTON :  ", vEvt->time);
          if ( vEvt->p2 )
          {
            v6 = "DOWN";
          }
          else
          {
            v6 = "UP";
          }
          v11 = v6;
          if ( vEvt->p1 )
          {
            v7 = "Right";
          }
          else
          {
            v7 = "Left";
          }
          fprintf(fp, "%s Button %s\n", v7, v11);
          break;
        case 3:
          fprintf(fp, " TIME[%05lu]  EVT_KEYBOARD     : ", vEvt->time);
          fprintf(fp, " '%c'  (%04d)\n", SLOBYTE(vEvt->p2), vEvt->p1);
          break;
        case 4:
        case 5:
          if ( vEvt->eventType == 4 )
          {
            v8 = "EVT_REQ_CONT";
          }
          else
          {
            v8 = "EVT_CAN_CONT";
          }
          fprintf(fp, " TIME[%05lu]  %-15s: ", vEvt->time, v8);
          fprintf(fp, " HWND[%04d] MSG[%04d] P1[%04d] P2[%04d]\n", vEvt->hwnd, vEvt->msg, vEvt->p1, vEvt->p2);
          break;
        case 6:
        case 7:
          if ( vEvt->eventType == 6 )
          {
            v9 = "EVT_REQ_CHANGE";
          }
          else
          {
            v9 = "EVT_CAN_CHANGE";
          }
          fprintf(fp, " TIME[%05lu]  %-15s: ", vEvt->time, v9);
          fprintf(fp, " HWND[%04d] MSG[%04d] P1[%04d] P2[%04d] F[%04d]\n", vEvt->hwnd, vEvt->msg, vEvt->p1, vEvt->p2, vEvt->f);
          break;
        default:
          fprintf(fp, " *** Unrecognized event type : %d\n", vEvt->eventType);
          break;
      }
    }
    fclose(fp);
  }
}

//----- (0005A094) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_sub_5A094(P_WinMgr a1, void *aData, int a3, char *name)
{
  __int16 i; // kr00_2
  char *v6; // edi

  if ( a1->type4counter == 384 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x10CB);
  }
  for ( i = 0; ; ++i )
  {
    if ( i >= 384 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x10DD);
    }
    if ( !a1->t4[i].pData )
    {
      break;
    }
  }
  a1->t4[i].pData = aData;
  a1->t4[i].a = a3;
  v6 = a1->t4[i].name;
  strncpy(v6, name, 19u);
  a1->t4[i].name[19] = 0;
  strupr(v6);
  a1->t4[i].time = V_Timer_dword_132B58;
  ++a1->type4counter;
}
// 132B58: using guessed type int V_Timer_dword_132B58;

//----- (0005A144) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_sub_5A144(P_WinMgr a1, void *pdata)
{
  __int16 i; // kr00_2

  if ( pdata )
  {
    for ( i = 0; i < 0x180; ++i )
    {
      if ( pdata == a1->t4[i].pData )
      {
        a1->t4[i].pData = 0;
        --a1->type4counter;
        return;
      }
    }
    Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x10F1);
  }
}

//----- (0005A194) --------------------------------------------------------
char *__fastcall sub_5A194(int a1, int a2, _DWORD *a3, _DWORD *a4)
{
  __int16 v6; // dx
  __int16 v7; // ax

  v6 = *(_WORD *)(a1 + 0x24D96);
  v7 = 0;
  if ( v6 <= 0 )
  {
    return 0;
  }
  while ( a2 != *(_DWORD *)((char *)&loc_21DB2 + 0x20 * v7 + a1) )
  {
    if ( ++v7 >= *(__int16 *)(a1 + 0x24D96) )
    {
      return 0;
    }
  }
  if ( a3 )
  {
    *a3 = *(_DWORD *)((char *)&loc_21D96 + 0x20 * v7 + a1);
  }
  if ( a4 )
  {
    *a4 = *(_DWORD *)(0x20 * v7 + a1 + 0x21D9A);
  }
  return (char *)&loc_21D96 + 0x20 * v7 + a1 + 8;
}

//----- (0005A270) --------------------------------------------------------
void __fastcall sub_5A270(T_WinMgr *a1, int a2, int a3, int a4)
{
  if ( !a1->h || a4 == 0xFFFFFFFF )
  {
    Q_GSYSTEM_CPP_sub_2C7D0(&V_Type6_stru_D8654, a2, a3);
  }
}

//----- (0005A294) --------------------------------------------------------
void __fastcall Q_WinMgr_CallProc6_sub_5A294(P_WinMgr a1, P_FileInfo pfi, int read)
{
  int i; // kr04_4

  for ( i = 0; i != 0x400; ++i )
  {
    if ( a1->wnds[i].a )
    {
      a1->wnds[i].a2->procs->proc6(a1->wnds[i].a2, pfi, read);
    }
  }
}

//----- (0005A320) --------------------------------------------------------
void __fastcall Q_Proc_sub_5A320(__int16 a1)
{
  unsigned __int16 v1; // cx
  void *ShapeTable_sub_1B084; // eax

  switch ( a1 )
  {
    case 1:
      v1 = sub_1B270(&WinMgr.t13, "DATA\\1starmap.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 2:
    case 4:
    case 0xA:
    case 0xE:
    case 0xF:
    case 0x12:
      v1 = sub_1B270(&WinMgr.t13, "DATA\\10status.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 3:
      v1 = sub_1B270(&WinMgr.t13, "DATA\\3cfgnew.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 7:
      v1 = sub_1B270(&WinMgr.t13, "DATA\\7racesel.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 8:
      v1 = sub_1B270(&WinMgr.t13, "DATA\\8shipdes.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 9:
      v1 = sub_1B270(&WinMgr.t13, "DATA\\9ENDGAME.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 0xC:
      v1 = sub_1B270(&WinMgr.t13, "DATA\\12start.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 0xD:
      v1 = sub_1B270(&WinMgr.t13, "DATA\\13negot.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 0x10:
      v1 = sub_1B270(&WinMgr.t13, "DATA\\16battle.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 0x14:
      v1 = sub_1B270(&WinMgr.t13, "DATA\\20res.tmp", 0xFFFFFFFF);
LABEL_12:
      if ( v1 == 0xFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x1168);
      }
      ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, v1);
      VFX_shape_draw(&V_Type6_stru_D8654.pane, ShapeTable_sub_1B084, 0, 0, 0);
      break;
    default:
      return;
  }
}

//----- (0005A47C) --------------------------------------------------------
int __fastcall sub_5A47C(T_Type5 *a1, const char *a2, int a3, int a4)
{
  __int16 v5; // ax
  __int16 v7; // [esp+2h] [ebp-10h]

  v5 = 0xF2;
  v7 = word_96BC4[a3];
  if ( a4 == 0xFFFFFFFF )
  {
    v5 = 0x96;
  }
  VFX_pane_wipe((PANE *)a1, v5);
  WinMgr.LargeFont.pane = (PANE)*a1;
  return sub_2B8A8(&WinMgr.LargeFont, 1, 1, a2, 0x40, v7, 0xFF, 0);
}
// 96BC4: using guessed type __int16 word_96BC4[8];

//----- (0005A4E4) --------------------------------------------------------
LONG __fastcall sub_5A4E4(_DWORD *a1, LONG a2, int a3, int a4)
{
  __int16 v5; // bx
  __int16 v6; // ax
  PANE v8; // [esp+0h] [ebp-30h] BYREF
  char s[12]; // [esp+14h] [ebp-1Ch] BYREF
  LONG color; // [esp+20h] [ebp-10h]

  v5 = 0xF3;
  color = a2;
  sprintf(s, "%03d", a2);
  v6 = 0xF2;
  if ( a2 == dword_132B10 )
  {
    v6 = 0xFE;
    v5 = 0;
  }
  if ( a4 )
  {
    v6 = 0xF1;
  }
  WinMgr.LargeFont.pane = *(PANE *)a1;
  sub_2B8A8(&WinMgr.LargeFont, 1, 1, s, 0x40, v5, v6, 0);
  v8 = *(PANE *)a1;
  v8.x0 += 0x23;
  --v8.y1;
  ++v8.y0;
  return VFX_pane_wipe(&v8, color);
}
// 132B10: using guessed type int dword_132B10;

//----- (0005A594) --------------------------------------------------------
void __fastcall __spoils<> Q_Wnd13DBGWNDCtor_sub_5A594(P_Wnd13DBGWND a1)
{
  Q_A2Ctor_sub_2C830(&a1->a2);
  a1->a2.procs = (P_Procs)off_961AC;
}
// 961AC: using guessed type int (*off_961AC[5])();

//----- (0005A5AC) --------------------------------------------------------
T_TypeA2 *__fastcall Q_Wnd13DBGWNDDtor_sub_5A5AC(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, &C_Wnd13DBGWND);
    operator delete[](v3);
    return a1;
  }
  else
  {
    a1->procs = (P_Procs)off_961AC;
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 961AC: using guessed type int (*off_961AC[5])();

//----- (0005A5F4) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_5A5F4(P_TypeA1 a1)
{
  a1->index = Q_WINMGR_CPP_RegisterWindow_sub_571B8(&WinMgr, a1);
}

//----- (0005A60C) --------------------------------------------------------
unsigned int __fastcall sub_5A60C(int a1, __int16 a2, __int16 a3, LONG a4)
{
  T_Wnd10LB *Wnd_sub_56DA8; // eax
  T_Wnd10LB *v7; // ecx
  T_Wnd10LB *v8; // eax
  T_Wnd10LB *v9; // ecx
  T_Wnd10LB *v10; // eax
  T_Wnd10LB *v11; // ecx
  T_Wnd10LB *v12; // eax
  T_Wnd10LB *v13; // ecx
  T_Wnd10LB *v14; // eax
  T_Wnd10LB *v15; // ecx
  char v16; // ah
  T_TypeA2 *v17; // eax
  T_Wnd10LB *v18; // eax
  T_Wnd10LB *v19; // ecx

  if ( (unsigned __int16)a2 < 0x3EBu )
  {
    if ( (unsigned __int16)a2 < 0xC8u )
    {
      if ( a2 && ((unsigned __int16)a2 <= 2u || (unsigned __int16)a2 >= 6u && (unsigned __int16)a2 <= 7u) )
      {
        return sub_2F424((T_TypeA2 *)a1, a2, a3, a4);
      }
      return 0;
    }
    if ( (unsigned __int16)a2 <= 0xC8u )
    {
      *(_BYTE *)(a1 + 0xBF) = 0;
      Wnd_sub_56DA8 = (T_Wnd10LB *)Q_FindWnd_sub_56DA8(&WinMgr, "DBGWNDLIST", 0);
      v7 = Wnd_sub_56DA8;
      if ( !Wnd_sub_56DA8 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x11D1);
      }
      sub_2ED4C(Wnd_sub_56DA8);
      v7->Unknown_AB = 0xFFFFFFFF;
      Q_A10_SetProc_sub_2F1C8(v7, sub_5A47C);
      if ( !v7->Unknown_8E6 && !sub_2F228((int)v7, 0x2000u, 0) )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x11D9);
      }
      sub_5AE68(a1, (int)v7);
      return 0;
    }
    else if ( (unsigned __int16)a2 <= 0xCAu )
    {
      sub_56B60(&WinMgr, 6, a2, 0);
      return 0xFFFFFFFF;
    }
    else if ( a2 == 0x3EA )
    {
      if ( *(_BYTE *)(a1 + 0xBF) )
      {
        *(_BYTE *)(a1 + 0xBF) = 0;
        v8 = (T_Wnd10LB *)Q_FindWnd_sub_56DA8(&WinMgr, "DBGWNDLIST", 0);
        v9 = v8;
        if ( !v8 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x11F0);
        }
        v8->Unknown_AB = 0xFFFFFFFF;
        Q_A10_SetProc_sub_2F1C8(v8, sub_5A47C);
        sub_2ED4C(v9);
        sub_5AE68(a1, (int)v9);
        (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
      }
      return 0xFFFFFFFF;
    }
    else
    {
      return 0;
    }
  }
  else if ( (unsigned __int16)a2 <= 0x3EBu )
  {
    if ( *(_BYTE *)(a1 + 0xBF) != 1 )
    {
      *(_BYTE *)(a1 + 0xBF) = 1;
      v10 = (T_Wnd10LB *)Q_FindWnd_sub_56DA8(&WinMgr, "DBGWNDLIST", 0);
      v11 = v10;
      if ( !v10 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x1204);
      }
      v10->Unknown_AB = 0xFFFFFFFF;
      Q_A10_SetProc_sub_2F1C8(v10, sub_5A47C);
      sub_2ED4C(v11);
      sub_5AB2C(a1, (int)v11);
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    }
    return 0xFFFFFFFF;
  }
  else if ( (unsigned __int16)a2 < 0x3EEu )
  {
    if ( (unsigned __int16)a2 <= 0x3ECu )
    {
      if ( *(_BYTE *)(a1 + 0xBF) != 2 )
      {
        *(_BYTE *)(a1 + 0xBF) = 2;
        v12 = (T_Wnd10LB *)Q_FindWnd_sub_56DA8(&WinMgr, "DBGWNDLIST", 0);
        v13 = v12;
        if ( !v12 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x1218);
        }
        v12->Unknown_AB = 0xFFFFFFFF;
        Q_A10_SetProc_sub_2F1C8(v12, sub_5A47C);
        sub_2ED4C(v13);
        sub_5AF30(a1, (int)v13);
        (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
      }
      return 0xFFFFFFFF;
    }
    else
    {
      if ( *(_BYTE *)(a1 + 0xBF) != 3 )
      {
        *(_BYTE *)(a1 + 0xBF) = 3;
        v18 = (T_Wnd10LB *)Q_FindWnd_sub_56DA8(&WinMgr, "DBGWNDLIST", 0);
        v19 = v18;
        if ( !v18 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x122B);
        }
        v18->Unknown_AB = 0;
        Q_A10_SetProc_sub_2F1C8(v18, sub_5A4E4);
        sub_2ED4C(v19);
        sub_5B200(a1, (int)v19);
        (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
      }
      return 0xFFFFFFFF;
    }
  }
  else
  {
    if ( (unsigned __int16)a2 > 0x3EEu )
    {
      if ( (unsigned __int16)a2 >= 0x3F1u )
      {
        if ( (unsigned __int16)a2 <= 0x3F1u )
        {
          if ( *(_BYTE *)(a1 + 0xBF) == 3 )
          {
            v17 = Q_FindWnd_sub_56DA8(&WinMgr, "DBGWNDLIST", 0);
            if ( !v17 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x1262);
            }
            sub_2ECDC((int)v17, dword_132B10);
            (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
          }
          return 0xFFFFFFFF;
        }
        else if ( a2 == 0x1C01 )
        {
          v16 = *(_BYTE *)(a1 + 0xBF);
          if ( v16 == 3 )
          {
            if ( a4 == 5 )
            {
              (*WinMgr.hazeTableMapFocus)[0xF2] = a3;
            }
          }
          else if ( v16 == 4 )
          {
            sub_4F8CC(&V_SoundSystem, a3, 0);
          }
          return 0xFFFFFFFF;
        }
        else
        {
          return 0;
        }
      }
      return 0;
    }
    if ( *(_BYTE *)(a1 + 0xBF) != 4 )
    {
      *(_BYTE *)(a1 + 0xBF) = 4;
      v14 = (T_Wnd10LB *)Q_FindWnd_sub_56DA8(&WinMgr, "DBGWNDLIST", 0);
      v15 = v14;
      if ( !v14 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x123E);
      }
      v14->Unknown_AB = 0xFFFFFFFF;
      Q_A10_SetProc_sub_2F1C8(v14, sub_5A47C);
      sub_2ED4C(v15);
      sub_5B244(a1, (int)v15);
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    }
    return 0xFFFFFFFF;
  }
}
// 132B10: using guessed type int dword_132B10;

//----- (0005AA08) --------------------------------------------------------
void __fastcall sub_5AA08(int a1)
{
  void *ShapeTable_sub_1B084; // eax
  char v2; // dl
  const char *v3; // esi
  int v4; // kr04_4
  int v5; // kr0C_4
  char v6; // al
  char v7; // al
  char v8[20]; // [esp+0h] [ebp-18h] BYREF
  _DWORD *v9; // [esp+14h] [ebp-4h]

  v9 = (_DWORD *)a1;
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&WinMgr.t13, *(unsigned __int16 *)(a1 + 0x18));
  VFX_shape_draw((PANE *)(v9 + 1), ShapeTable_sub_1B084, 0, 0, 0);
  VFX_pane_wipe((PANE *)((char *)v9 + 0xAB), 0xF2);
  v2 = *((_BYTE *)v9 + 0xBF);
  if ( v2 )
  {
    if ( v2 == 1 )
    {
      v3 = "MEMORY    ";
    }
    else if ( v2 == 2 )
    {
      v3 = "CACHE     ";
    }
    else
    {
      v3 = "PALETTE   ";
    }
  }
  else
  {
    v3 = "WINDOWS   ";
  }
  v4 = 0;
  v5 = 0;
  do
  {
    v6 = v3[2 * v4];
    v8[2 * v5] = v6;
    if ( !v6 )
    {
      break;
    }
    v7 = v3[2 * v4 + 1];
    v8[2 * v5 + 1] = v7;
    ++v4;
    ++v5;
  }
  while ( v7 );
  sub_2B3E0(
    &WinMgr.LargeFont,
    *(_DWORD *)((char *)v9 + 0xAF),
    *(_DWORD *)((char *)v9 + 0xB3),
    *(_DWORD *)((char *)v9 + 0xB7),
    *(_DWORD *)((char *)v9 + 0xB3) + 0x32);
  sub_2B8A8(&WinMgr.LargeFont, 1, 1, v8, 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
  sub_2D218(v9);
}
// 5AA08: using guessed type char var_18[20];

//----- (0005AB04) --------------------------------------------------------
int __fastcall sub_5AB04(const char **a1, const char **a2)
{
  return strncmp(*a1, *a2, 6u);
}

//----- (0005AB2C) --------------------------------------------------------
void __fastcall sub_5AB2C(int a1, int a2)
{
  int v2; // ebp
  int v3; // edi
  char *v4; // eax
  unsigned __int16 v5; // ax
  __int16 v6; // cx
  unsigned __int16 v7; // ax
  int v8; // edi
  unsigned __int16 v9; // ax
  unsigned __int16 v10; // ax
  int v11; // ecx
  unsigned __int16 v12; // ax
  int v13; // edi
  unsigned __int16 v14; // ax
  unsigned __int16 v15; // ax
  unsigned __int16 v16; // ax
  char s[80]; // [esp+0h] [ebp-98h] BYREF
  struct _heapinfo v18; // [esp+50h] [ebp-48h] BYREF
  int v19; // [esp+60h] [ebp-38h] BYREF
  int v20; // [esp+64h] [ebp-34h] BYREF
  int v21; // [esp+68h] [ebp-30h]
  int v22; // [esp+6Ch] [ebp-2Ch]
  int v23; // [esp+70h] [ebp-28h]
  int v24; // [esp+74h] [ebp-24h]
  int v25; // [esp+78h] [ebp-20h]
  int v26; // [esp+7Ch] [ebp-1Ch]
  __int16 v27; // [esp+80h] [ebp-18h]

  *(_BYTE *)(a1 + 0xBF) = 1;
  v2 = 0;
  v22 = 0;
  v21 = 0;
  v23 = 0;
  LOWORD(v25) = 0;
  LOWORD(v26) = 0;
  v27 = 0;
  LOWORD(v24) = 0;
  if ( heapchk() )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x12A9);
  }
  HIWORD(v18._pentry) = 0;
  LODWORD(v18._pentry) = 0;
  while ( !heapwalk(&v18) )
  {
    if ( v18._useflag )
    {
      v2 += v18._size;
    }
    else
    {
      v3 = LODWORD(v18._pentry) + 4;
      v4 = sub_5A194((int)&WinMgr, LODWORD(v18._pentry) + 4, &v19, &v20);
      if ( v4 )
      {
        switch ( v19 )
        {
          case 1:
          case 4:
          case 5:
            sprintf(s, "%06lu S%07lu %s", v20, v18._size, v4);
            v9 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
            sub_2EC50(a2, v9, v19);
            break;
          case 2:
            sprintf(s, "%06lu S%07lu WND[%s]", v20, v18._size, (const char *)(v3 + 0x20));
            v5 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
            v6 = v24;
            sub_2EC50(a2, v5, v19);
            LOWORD(v24) = v6 + 1;
            v21 += v18._size;
            break;
          case 3:
            sprintf(s, "%06lu S%07lu %s", v20, v18._size, v4);
            v7 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
            v8 = v23;
            sub_2EC50(a2, v7, v19);
            v23 = v18._size + v8;
            LOWORD(v25) = v25 + 1;
            break;
          default:
            Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x12E3);
            break;
        }
      }
      else
      {
        ++v27;
      }
      v22 += v18._size;
      LOWORD(v26) = v26 + 1;
    }
  }
  sprintf(s, "** %d WNDS USING %lu BYTES", (__int16)v24, v21);
  v10 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  v11 = v23;
  sub_2EC50(a2, v10, 0);
  sprintf(s, "** %d SHAPES USING %lu BYTES", (__int16)v25, v11);
  v12 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  v13 = v22;
  sub_2EC50(a2, v12, 0);
  sprintf(s, "** %d ITEMS IN HEAP USE %lu BYTES", (__int16)v26, v13);
  v14 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  sub_2EC50(a2, v14, 0);
  sprintf(s, "** %d ITEMS ARE UNIDENTIFIED", v27);
  v15 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  sub_2EC50(a2, v15, 0);
  sprintf(s, "** TOTAL FREE IN HEAP %lu BYTES", v2);
  v16 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  sub_2EC50(a2, v16, 0);
  sub_2F1D8(a2, (int)sub_5AB04);
  sub_2F1E0(a2);
}

//----- (0005AE68) --------------------------------------------------------
int __fastcall sub_5AE68(int a1, int edx0)
{
  int Unknown_4228; // edx
  __int16 v4; // si
  __int16 v5; // di
  int result; // eax
  int v7; // eax
  T_TypeA2 *a2; // edx
  char v9; // bl
  char s[72]; // [esp+0h] [ebp-48h] BYREF

  Unknown_4228 = WinMgr.Unknown_4228;
  *(_BYTE *)(a1 + 0xBF) = 0;
  v4 = 0x1F;
  v5 = WinMgr.Unknown_3066[0x47 * Unknown_4228 + 1];
  while ( 1 )
  {
    result = v5;
    if ( v5 <= 0 )
    {
      break;
    }
    if ( v4 < 0 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x131E);
    }
    v7 = *(_DWORD *)&WinMgr.Unknown_3066[0x47 * WinMgr.Unknown_4228 + 2 + 2 * v4];
    if ( v7 )
    {
      a2 = WinMgr.wnds[v7].a2;
      if ( a2->a1.parentIndex )
      {
        v9 = 0x43;
      }
      else
      {
        v9 = 0x20;
      }
      sprintf(s, "%c HWND%03d %s", v9, v7, a2->a1.name);
      --v5;
      sub_2EA8C(edx0, s, 0xFFFFFFFF, 0);
    }
    --v4;
  }
  return result;
}

//----- (0005AF30) --------------------------------------------------------
unsigned int __fastcall sub_5AF30(int a1, int a2)
{
  int v3; // edi
  int v4; // kr04_4
  int v5; // kr14_4
  int v6; // edx
  unsigned __int16 v7; // ax
  int v8; // ecx
  int v9; // ebp
  int v10; // kr0C_4
  int v11; // kr1C_4
  int v12; // edx
  unsigned __int16 v13; // ax
  unsigned __int16 v14; // ax
  unsigned __int16 v15; // ax
  unsigned __int16 v16; // ax
  unsigned __int16 v17; // ax
  unsigned __int16 v18; // dx
  char s[100]; // [esp+0h] [ebp-94h] BYREF
  T_Type13 *v21; // [esp+64h] [ebp-30h]
  T_Type13 *name; // [esp+68h] [ebp-2Ch]
  T_Type13 *v23; // [esp+6Ch] [ebp-28h]
  T_Type13 *p_t13; // [esp+70h] [ebp-24h]
  T_Type13 *v25; // [esp+74h] [ebp-20h]
  T_Type13 *v26; // [esp+78h] [ebp-1Ch]
  int v27; // [esp+7Ch] [ebp-18h]

  v3 = 0;
  p_t13 = &WinMgr.t13;
  v27 = 0;
  name = (T_Type13 *)WinMgr.t13.name;
  v25 = &WinMgr.t13;
  v4 = 0;
  v5 = 0;
  while ( p_t13->b > v27 )
  {
    sprintf(
      s,
      "%07d %s",
      WinMgr.t13.z2[*(unsigned __int16 *)&WinMgr.t13.z3[2 * v4]],
      (const char *)name + 0x32 * *(unsigned __int16 *)&WinMgr.t13.z3[2 * v4]);
    v6 = v25->z2[0];
    strupr(s);
    v3 += v6;
    v7 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
    v8 = v27;
    sub_2EC50(a2, v7, 1);
    v27 = v8 + 1;
    ++v4;
    ++v5;
  }
  sub_2EA8C(a2, " ", 0xFFFFFFFF, 0);
  v23 = (T_Type13 *)p_t13->name;
  v9 = 0;
  v21 = p_t13;
  v26 = p_t13;
  v10 = 0;
  v11 = 0;
  do
  {
    if ( v21->name[0][0] )
    {
      sprintf(s, "%s", (const char *)v23 + 0x32 * v9);
      v12 = v26->z2[0];
      strupr(s);
      v3 += v12;
      v13 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
      sub_2EC50(a2, v13, 0);
    }
    ++v9;
    ++v10;
    ++v11;
  }
  while ( v9 < 0xC8 );
  sub_2EA8C(a2, " ", 0xFFFFFFFF, 0);
  sprintf(s, "%03d ITEMS IN CACHE", p_t13->a);
  v14 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  sub_2EC50(a2, v14, 0);
  sprintf(s, "%03d ITEMS LOADED", p_t13->b);
  v15 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  sub_2EC50(a2, v15, 0);
  sub_2EA8C(a2, " ", 0xFFFFFFFF, 0);
  sprintf(s, "%07d TOTAL CACHE SIZE", p_t13->size);
  v16 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  sub_2EC50(a2, v16, 0);
  sprintf(s, "%07d USED", v3);
  v17 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  sub_2EC50(a2, v17, 0);
  sprintf(s, "%07d FREE", p_t13->size - v3);
  v18 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  return sub_2EC50(a2, v18, 0);
}

//----- (0005B200) --------------------------------------------------------
int __fastcall sub_5B200(int a1, int a2)
{
  __int16 i; // si
  int result; // eax

  *(_BYTE *)(a1 + 0xBF) = 3;
  for ( i = 0; i < 0x100; result = sub_2EA8C(a2, (const char *)i++, 0xFFFFFFFF, 0) )
  {
    ;
  }
  return result;
}

//----- (0005B244) --------------------------------------------------------
int __fastcall sub_5B244(int result, int a2)
{
  int i; // esi
  char s[96]; // [esp+0h] [ebp-60h] BYREF

  *(_BYTE *)(result + 0xBF) = 4;
  for ( i = 0; (__int16)i < V_SoundSystem.tracks; result = sub_2EA8C(a2, s, 0xFFFFFFFF, 0) )
  {
    sprintf(s, "%02d. %-24s (%d)", (__int16)i, V_SoundSystem.files[(__int16)i].fname, V_SoundSystem.files[(__int16)i].fpos);
    ++i;
  }
  return result;
}

//----- (0005B2B0) --------------------------------------------------------
T_TypeA2 *__fastcall sub_5B2B0(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_96184);
    operator delete[](v3);
    return a1;
  }
  else
  {
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (0005B2F0) --------------------------------------------------------
T_TypeA2 *__fastcall sub_5B2F0(T_TypeA2 *result)
{
  Q_A2Ctor_sub_2C830(result);
  result->procs = (P_Procs)off_961C4;
  return result;
}
// 961C4: using guessed type int (*off_961C4[2])();

//----- (0005B300) --------------------------------------------------------
T_TypeA2 *__fastcall sub_5B300(T_TypeA2 *a1, char a2)
{
  char *v3; // eax
  P_TypeA2 v5; // eax
  P_TypeA2 v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = _wcpp_2_dtor_array_store_(a1, (rt_type_sig_clss *)&unk_96198);
    operator delete[](v3);
    return a1;
  }
  else
  {
    v5 = Q_A2Dtor_sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (0005B340) --------------------------------------------------------
T_TypeA2 *__fastcall sub_5B340(T_TypeA2 *result)
{
  Q_A2Ctor_sub_2C830(result);
  result->procs = (P_Procs)off_961DC;
  return result;
}
// 961DC: using guessed type int (*off_961DC[2])();

//----- (0005B50C) --------------------------------------------------------
BOOL __fastcall sub_5B50C(_DWORD *a1, _DWORD *a2)
{
  if ( *a1 != *a2 )
  {
    return 0;
  }
  if ( a1[4] < a2[2] )
  {
    return 0;
  }
  if ( a1[2] > a2[4] )
  {
    return 0;
  }
  if ( a1[3] < a2[1] )
  {
    return 0;
  }
  if ( a1[1] > a2[3] )
  {
    return 0;
  }
  if ( a1[1] < a2[1] )
  {
    return 0;
  }
  if ( a1[3] > a2[3] )
  {
    return 0;
  }
  if ( a1[2] >= a2[2] )
  {
    return a1[4] <= a2[4];
  }
  return 0;
}

//----- (0005B617) --------------------------------------------------------
PANE_LIST *__fastcall sub_5B617(size_t a1)
{
  PANE_LIST *ptr; // [esp+8h] [ebp-4h]

  ptr = (PANE_LIST *)malloc(0xCu);
  if ( !ptr )
  {
    return 0;
  }
  ptr->flags = (ULONG *)calloc(a1, 4u);
  if ( ptr->flags )
  {
    ptr->array = (PANE *)calloc(a1, 0x14u);
    if ( ptr->array )
    {
      ptr->size = a1;
      sub_5B71C(ptr);
      return ptr;
    }
    else
    {
      free(ptr->flags);
      free(ptr);
      return 0;
    }
  }
  else
  {
    free(ptr);
    return 0;
  }
}

//----- (0005B71C) --------------------------------------------------------
unsigned int __fastcall sub_5B71C(PPANE_LIST a1)
{
  unsigned int result; // eax
  unsigned int i; // [esp+4h] [ebp-4h]

  for ( i = 0; ; ++i )
  {
    result = i;
    if ( i >= a1->size )
    {
      break;
    }
    a1->flags[i] = 0;
  }
  return result;
}

//----- (0005B7C2) --------------------------------------------------------
unsigned int __fastcall sub_5B7C2(_DWORD *a1, int a2, int x1, int y1, int x2, int y2)
{
  int v6; // kr04_4
  int *v10; // [esp+14h] [ebp-10h]
  int *v11; // [esp+18h] [ebp-Ch]
  unsigned int v12; // [esp+1Ch] [ebp-8h]
  unsigned int i; // [esp+20h] [ebp-4h]

  for ( i = 0; i < a1[2] && *(_DWORD *)(4 * i + a1[1]); ++i )
  {
    ;
  }
  if ( i == a1[2] )
  {
    return 0xFFFFFFFF;
  }
  *(_DWORD *)(4 * i + a1[1]) = 1;
  v11 = (int *)(0x14 * i + *a1);
  *v11 = a2;
  v11[1] = x1;
  v11[2] = y1;
  v11[3] = x2;
  v11[4] = y2;
  v12 = 0;
  v10 = (int *)*a1;
  v6 = 0;
  while ( v12 < a1[2] )
  {
    if ( *(_DWORD *)(4 * v12 + a1[1]) && v11 != v10 && sub_5B50C(v11, v10) )
    {
      *(_DWORD *)(4 * i + a1[1]) = 2;
      return i;
    }
    ++v12;
    ++v6;
  }
  return i;
}

//----- (0005BA38) --------------------------------------------------------
unsigned int __fastcall sub_5BA38(PPANE_LIST a1)
{
  unsigned int result; // eax
  unsigned int i; // [esp+8h] [ebp-4h]

  for ( i = 0; ; ++i )
  {
    result = i;
    if ( i >= a1->size )
    {
      break;
    }
    if ( a1->flags[i] == 1 )
    {
      VFX_pane_refresh(&a1->array[i], a1->array[i].x0, a1->array[i].y0, a1->array[i].x1, a1->array[i].y1);
    }
  }
  return result;
}

//----- (0005BAC0) --------------------------------------------------------
int __fastcall sub_5BAC0(_DWORD *a1, int a2)
{
  unsigned __int8 *v3; // [esp+14h] [ebp-24h]
  int v4; // [esp+18h] [ebp-20h]
  unsigned int m; // [esp+1Ch] [ebp-1Ch]
  BOOL v6; // [esp+20h] [ebp-18h]
  unsigned int k; // [esp+24h] [ebp-14h]
  unsigned int i; // [esp+28h] [ebp-10h]
  unsigned int j; // [esp+2Ch] [ebp-Ch]
  unsigned int v10; // [esp+30h] [ebp-8h]
  unsigned int v11; // [esp+34h] [ebp-4h]

  v11 = a1[1] + 1;
  v10 = a1[2] + 1;
  v4 = 4 * v10;
  for ( i = 0; i < v10; ++i )
  {
    v3 = (unsigned __int8 *)(i * v11 + *a1);
    for ( j = 0; j < v11; j = k )
    {
      v6 = *v3 == a2;
      for ( k = j + 1; k < v11; ++k )
      {
        if ( (*++v3 == a2) != v6 )
        {
          break;
        }
      }
      for ( m = k - j; m > 0x7F; m -= 0x7F )
      {
        ++v4;
      }
      ++v4;
    }
  }
  return v4;
}

//----- (0005BBE4) --------------------------------------------------------
char *__fastcall sub_5BBE4(void **a1, char *a2, int a3)
{
  int v3; // eax
  char *v4; // eax
  char *v5; // eax
  char *s2; // [esp+Ch] [ebp-34h]
  _DWORD *ptr; // [esp+18h] [ebp-28h]
  char *v11; // [esp+1Ch] [ebp-24h]
  unsigned __int8 *v12; // [esp+20h] [ebp-20h]
  unsigned int m; // [esp+24h] [ebp-1Ch]
  BOOL v14; // [esp+28h] [ebp-18h]
  bool v15; // [esp+28h] [ebp-18h]
  unsigned int k; // [esp+2Ch] [ebp-14h]
  unsigned int i; // [esp+30h] [ebp-10h]
  unsigned int j; // [esp+34h] [ebp-Ch]
  unsigned int v19; // [esp+38h] [ebp-8h]
  unsigned int v20; // [esp+3Ch] [ebp-4h]

  s2 = a2;
  v20 = (unsigned int)a1[1] + 1;
  v19 = (unsigned int)a1[2] + 1;
  if ( a2 == *a1 )
  {
    if ( sub_5BAC0(a1, a3) > v19 * v20 )
    {
      return 0;
    }
  }
  else if ( !a2 )
  {
    v3 = sub_5BAC0(a1, a3);
    s2 = (char *)malloc(v3);
    if ( !s2 )
    {
      return 0;
    }
  }
  ptr = malloc(4 * v19);
  if ( !ptr )
  {
    return 0;
  }
  v11 = s2;
  for ( i = 0; i < v19; ++i )
  {
    v12 = (unsigned __int8 *)*a1 + i * v20;
    ptr[i] = v11 - s2 + 4 * v19;
    for ( j = 0; j < v20; j = k )
    {
      v14 = *v12 == a3;
      for ( k = j + 1; k < v20; ++k )
      {
        if ( (*++v12 == a3) != v14 )
        {
          break;
        }
      }
      v15 = v14 << 7;
      for ( m = k - j; m > 0x7F; m -= 0x7F )
      {
        v4 = v11++;
        *v4 = v15 | 0x7F;
      }
      v5 = v11++;
      *v5 = m | v15;
    }
  }
  memmove(&s2[4 * v19], s2, v11 - s2);
  memmove(s2, ptr, 4 * v19);
  free(ptr);
  return s2;
}

//----- (0005BDDC) --------------------------------------------------------
void __fastcall sub_5BDDC(void *a1)
{
  free(a1);
}

// nfuncs=1980 queued=830 decompiled=830 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 830 function(s)"

/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Watcom C++
*/

#include <math.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

void __noreturn sub_10000(); // weak
void __fastcall Q_BATCON_CPP_sub_10010(PANE *pane, int, int, int);
void __fastcall Q_BATCON_CPP_sub_10668(PANE *pane, char *a2, int powerState, int a4);
int __fastcall sub_10878(_DWORD *, int, int, int);
int __fastcall sub_10A14(int, int);
void __fastcall __spoils<> Q_A8_sub_10A3C(P_TypeA8 a1);
int __fastcall sub_10A80(int a1, char a2);
void __fastcall __spoils<> Q_A8_sub_10AC4(P_TypeA8 result);
int __fastcall sub_10B24(int, unsigned __int16, int, int *);
void __fastcall sub_11870(int a1, int a2);
int __fastcall sub_11BA4(int);
int __fastcall sub_12140(int);
void __fastcall sub_12238(int, int);
void __fastcall sub_1229C(int, int);
unsigned int __fastcall sub_12368(int, int);
void __fastcall sub_1240C(int, int);
char *__fastcall sub_12440(int);
int __fastcall sub_12480(float *, float *, float);
unsigned int __fastcall sub_12618(int);
void __fastcall sub_12674(int);
// int __usercall sub_126F8@<eax>(int@<eax>, int@<edx>, int@<ebp>);
int __fastcall sub_12AE4(int, int);
void __fastcall sub_12B4C(int, int);
unsigned int __fastcall sub_12C98(int, int, int);
unsigned int __fastcall sub_12E88(int);
// int __usercall sub_12F7C@<eax>(int@<eax>, int ebp0@<ebp>);
unsigned int __fastcall sub_13370(int, int, int);
unsigned int __fastcall sub_136C4(int);
unsigned int __fastcall sub_1380C(int);
void __fastcall sub_139E0(int, int);
void __fastcall sub_13A28(int, int);
void __fastcall sub_13AD8(int, int);
_DWORD *__fastcall sub_13BC0(_DWORD *result, _DWORD *);
_DWORD *__fastcall sub_13BF0(_DWORD *result);
unsigned int __fastcall sub_13C10(int);
unsigned int __fastcall sub_14224(int);
int __fastcall sub_142D8(int);
int __fastcall sub_14490(int);
unsigned int __fastcall sub_145C0(int);
unsigned int __fastcall sub_147CC(int);
unsigned int __fastcall sub_14B18(int, int, int);
unsigned int __fastcall sub_15078(int);
unsigned int __fastcall sub_15164(int);
unsigned int __fastcall sub_152E4(int, int, int, int);
void __fastcall sub_15630(int, int);
void __fastcall sub_156C0(int a1, int a2, unsigned __int16 shpNum);
int __fastcall sub_1577C(int);
int __fastcall sub_15788(int result);
int __fastcall sub_15794(int result, int);
int __fastcall sub_157B4(const void *, const void *); // idb
void __fastcall sub_157EC(size_t *);
char *__fastcall sub_15808(int, int, int);
int __fastcall sub_15948(int, int);
int __fastcall sub_15D20(int);
int __fastcall sub_15D2C(int result);
int __fastcall sub_15D38(int result, const void *);
int __fastcall sub_15D74(int result, int);
int __fastcall sub_15DA4(int result, int, unsigned __int16);
void __fastcall sub_15E1C(int *, int);
int __fastcall sub_15ED4(T_TypeA2 *);
void *__fastcall sub_1604C(int a1, char a2);
int __fastcall sub_16120(int);
int __fastcall sub_16348(int, unsigned __int16, int, signed int);
void __fastcall sub_16D6C(int, int, int, int);
void __fastcall sub_16FC0(int, int edx0, int, int);
void __fastcall sub_171D0(int, int, int);
char *__fastcall sub_17204(int, int, int);
void __fastcall sub_17260(int result);
void __fastcall sub_172B0(int);
int __fastcall sub_173F4(int, int, int, int);
int __fastcall sub_17430(int);
void __fastcall sub_17E50(int, int, int, int);
float *__fastcall sub_17E88(int, int);
void __fastcall sub_17F54(int);
void __fastcall sub_17FF0(int, int, int, int);
void __fastcall sub_181F0(int);
void __fastcall sub_1826C(int, int, unsigned __int16, unsigned __int16);
void __fastcall sub_182B8(int, int);
unsigned int __fastcall sub_18370(int);
int __fastcall sub_185CC(int);
void __fastcall sub_186B8(int, int, int);
int __fastcall sub_187EC(int);
void __fastcall sub_18C2C(int, int);
void __fastcall sub_18CA8(int, int);
void __fastcall sub_1936C(int);
int __fastcall sub_19AE8(int);
__int64 __fastcall sub_19E2C(int, unsigned int, int);
int __fastcall sub_1A9C0(int);
int __fastcall sub_1A9E0(int);
int __fastcall sub_1AA00(int);
int __fastcall Q_NC_sub_1AA20(int);
_DWORD *__fastcall sub_1AA40(float *, float *);
__int64 __fastcall sub_1AA90(int);
_DWORD *__fastcall sub_1AAC0(int);
_DWORD *__fastcall sub_1ABE0(_DWORD *);
float *__fastcall sub_1AC70(float *result, int, int, int);
_DWORD *__fastcall sub_1ACA0(_DWORD *result);
int __fastcall sub_1ACC0(int, int, int);
int __fastcall sub_1ACE8(int result);
int __fastcall sub_1ACF4(int);
void __fastcall Q_CACHE_CPP_ShapeCache_sub_1AD1C(P_Type13 a1, int a2);
int __fastcall sub_1ADAC(P_Type13 a1, const char *filename);
int __fastcall sub_1AEB0(unsigned int, unsigned __int16, const char *);
int __fastcall sub_1B000(unsigned int, unsigned __int16);
void *__fastcall Q_CACHE_CPP_GetShapeTable_sub_1B084(unsigned int, int);
int __fastcall sub_1B270(T_Type13 *, const char *, int);
int __fastcall sub_1B2DC(unsigned int, int);
int __fastcall sub_1B354(unsigned int, unsigned __int16);
_DWORD *__fastcall sub_1B498(_DWORD *result);
_DWORD *__fastcall sub_1B4D0(_DWORD *);
_DWORD *__fastcall sub_1B4F0(_DWORD *);
_DWORD *__fastcall Q_NC_sub_1B670(_DWORD *, int, int, int, int, int, int, int);
void __fastcall sub_1B808(_DWORD *, int, int, int, int, int, int, int);
void __fastcall sub_1B834(int, int);
float *__fastcall sub_1B864(int, int, int, int);
float *__fastcall sub_1B958(int, float *, int, int);
void __fastcall Q_NC_sub_1BA90(float *, int, int, int, int);
void __fastcall Q_NC_sub_1BAB0(int, int, int, int, float degrees);
void __fastcall sub_1BAF0(float *, int, int, int, int);
FILE *__fastcall Q_OpenFile_sub_1BB10(const char *aFName, fpos_t *endOffset);
void __fastcall __spoils<> Q_InitFileInfo_sub_1BB78(P_FileInfo a1);
void __fastcall Q_CloseFileAndDelete_sub_1BBC8(P_FileInfo a1);
BOOL __fastcall Q_OpenFile_sub_1BBFC(P_FileInfo a1, const char *aFName, int aOFlags, int preload);
BOOL __fastcall Q_OpenFile_sub_1BCA8(T_FileInfo *, const char *);
BOOL __fastcall Q_CFILE_CPP_OpenFile_sub_1BCBC(T_FileInfo *a1, int aOFlags);
int __fastcall Q_CloseFile_sub_1BE00(P_FileInfo a1);
int __fastcall Q_GetFileLength_sub_1BE28(P_FileInfo a1);
int __fastcall Q_GetFilePos_sub_1BEA0(P_FileInfo a1);
int __fastcall sub_1BECC(int *, int offset, int);
int __fastcall Q_SetFilePos_sub_1BF0C(P_FileInfo a1, int offset);
void *__fastcall Q_CfileLoad_sub_1BF1C(T_FileInfo *, void *);
int __fastcall Q_ReadFile_sub_1BF94(P_FileInfo a1, void *aBuf, unsigned int aReadLen);
unsigned int __fastcall sub_1BFD4(int *, void *buf, unsigned int, unsigned int, int);
unsigned int __fastcall Q_CFILE_CPP_dos_write_sub_1C098(int *phandle, void *buf, unsigned int size);
void __fastcall Q_CFILE_CPP_IndexOneCob_sub_1C278(P_CobFiles a1, char *CobFileName);
void __fastcall Q_CobFilesLoad_sub_1C3C4(P_CobFiles a1);
void Q_AtExitFunc_sub_1C410(void); // idb
int __fastcall main(int argc, char *argv[]);
void Q_Proc_sub_1CC94();
int Q_CORN_CPP_StaticTxtLoad_sub_1CD3C();
char *__fastcall Q_CORN_CPP_StaticTxtRead_sub_1CEA8(int aTextIndex);
int sub_1CEF0();
void __fastcall sub_1CF14(unsigned __int8 a1);
void __fastcall sub_1CF40(P_Star pStar);
T_Type15 *__fastcall sub_1CF68(int a1, int a2);
__int16 __fastcall sub_1D234(int a1, P_Planet a2, __int16 a3);
unsigned int __fastcall sub_1D3E8(int, int, int);
unsigned int __fastcall sub_1D538(int, int);
int __fastcall sub_1D654(__int16 *, int, int);
void __fastcall sub_1D734(int, int);
int __fastcall sub_1D794(__int16 *, _DWORD *);
unsigned int __fastcall sub_1D834(int, __int16);
void __fastcall Q_ReadWriteStar_sub_1D920(P_Star pStar, P_FileInfo pfi, int read);
int __fastcall sub_1DA04(int, int);
int __fastcall sub_1DA4C(int, __int16, int, int);
int __fastcall sub_1DB70(T_Star *a1, __int16 a2, int *a3, int a4);
int __fastcall sub_1DE64(int);
int __fastcall sub_1E03C(int);
char __fastcall sub_1E094(int);
void __fastcall sub_1E10C(P_Game pGame, __int16 stars, __int16 races, unsigned __int8 a4);
int __fastcall sub_1E150(P_Game a1, __int16 sectors);
int __fastcall sub_1E2A0(P_Game a1, __int16 stars);
void __fastcall sub_1E70C(P_Game pGame, __int16 races, unsigned __int8 a3);
char __fastcall sub_1EE08(P_Game pGame, char a2);
__int16 __fastcall sub_1EEA4(P_Game a1);
void __fastcall sub_1EFC0(P_Game a1);
unsigned int __fastcall sub_1F038(P_Game a1);
int __fastcall sub_1F404(P_Game a1);
int sub_1F91C();
int __fastcall sub_1FB34(P_Game a1);
void __fastcall sub_1FD18(P_Game a1, int a2);
int __fastcall sub_1FD90(int, int, int);
int __fastcall sub_1FDF0(int, int, int, int);
int __fastcall sub_1FFE0(int, int);
void __fastcall sub_2016C(P_Game a1, int a2, __int16 a3);
void __fastcall sub_201D8(P_Game a1);
T_Type15 *__fastcall sub_205A0(P_Game a1, int a2, int a3);
T_Ship *__fastcall sub_20684(int a1, __int16 a2);
__int16 __fastcall sub_20720(int, int);
char __fastcall sub_207A0(int);
int __fastcall sub_20B3C(int);
char __fastcall sub_20C94(int, int, int, T_TypeA1 *);
int __fastcall sub_2106C(int result);
void __fastcall sub_21170(int);
void __fastcall sub_211EC(int, int, int);
void __fastcall sub_21314(int);
void __fastcall Q_SaveGam_sub_21374(P_Game pGame, P_FileInfo pfi);
__int16 __fastcall Q_LoadGam_sub_21AA0(P_Game, T_FileInfo *);
WORD __fastcall sub_220CC(P_Game);
int __fastcall sub_22260(int);
int __fastcall sub_22280(int);
int __fastcall sub_222A0(int);
int __fastcall sub_222C0(int);
int __fastcall sub_222E0(int);
int __fastcall sub_22300(int);
int __fastcall sub_22320(int);
_DWORD *__fastcall sub_22360(int);
char *__fastcall sub_223B0(int);
char *__fastcall sub_223E0(int);
int __fastcall sub_22400(int result);
int __fastcall sub_22430(const void *, const void *); // idb
void __fastcall Q_Proc_sub_22468();
char *__fastcall sub_224A4(int);
char *__fastcall sub_22588(char *, char);
unsigned int __fastcall Q_COSWND_CPP_sub_22644(int, const char *, const char *);
_DWORD *__fastcall sub_2280C(int, int, int, int);
void __fastcall sub_23BF0(int, int);
int __fastcall sub_23FD4(int);
void __fastcall sub_24154(int, int, int, int, float);
void __fastcall sub_24198(int, int, int, int);
void __fastcall sub_2422C(int, int, int, int);
int __fastcall sub_24948(int result, int, int);
int __fastcall sub_24BE0(int);
int __fastcall sub_24D30(int, int, int, int);
__int64 __fastcall sub_24FCC(int, T_FileInfo *, int);
int __fastcall sub_254A4(int);
int __fastcall sub_254B0(int result);
int __fastcall sub_254BC(int result, int);
void __fastcall sub_254DC(size_t *);
void __fastcall sub_254F8(int *, int);
void __fastcall __spoils<> sub_25BF8(P_TypeA2 a1);
int __fastcall sub_25C08(int a1, char a2);
void __fastcall sub_25C4C(unsigned int, int);
int __fastcall sub_25CB8(int result);
int __fastcall sub_25CD4(int a1, char a2);
void __fastcall sub_25D18(int result, LONG);
int __fastcall sub_25FB4(int result);
unsigned int __fastcall sub_26000(int, __int16, __int16, int);
int __fastcall sub_26140(int);
char *__fastcall sub_26150(int);
int Q_StopSystems_sub_26160();
void Q_debugbreak_sub_26194();
void __fastcall __noreturn Q_AssertLogBreakExit_sub_26198(int ignore, const char *sourcefile, int line);
void __fastcall Q_AssertLogBreakExit_sub_261A8(int ignore, const char *sourcefile, int line);
int __fastcall sub_261B8(int result, const char *, int);
__int64 __cdecl sub_2620C(char *format, char);
void __noreturn Q_debugbreak_exit_sub_2624C();
void __fastcall __spoils<edx,ebx> Q_RegisterData_sub_2625C(void *aData, int a2, char *name);
void __fastcall sub_2627C(void *);
void *__fastcall Q_Allocate_sub_2628C(size_t, int, char *);
void *__fastcall sub_262B0(size_t num, size_t size, int a3, char *name);
void __fastcall sub_262CC(void *ptr);
void sub_262F0();
void sub_26314();
void sub_2631C();
void Q_Null_sub_26328();
void Q_StopMouse_sub_2632C();
int Q_StartMouse_sub_2633C();
void __fastcall Q_ProcessKeyboard_sub_26360();
void __fastcall Q_ProcessMouse_sub_264B4();
int __fastcall Q_ProcessInput_sub_2656C();
void __fastcall sub_265A8(int);
void __fastcall __spoils<> Q_A5_sub_267A0(P_TypeA5 a1);
int __fastcall sub_267BC(int a1, char a2);
void __fastcall __spoils<> Q_A5_sub_26800(P_TypeA5 result);
char __fastcall sub_26874(int, __int16 *);
unsigned int __fastcall sub_270F4(int, __int16, int, int);
void __fastcall __spoils<> Q_A2_sub_2712C(T_TypeA2 *a1);
int __fastcall sub_2713C(int a1, char a2);
unsigned int __fastcall sub_27184(int, __int16, int, int);
__int64 __fastcall sub_271FC(int);
void __fastcall __spoils<> Q_A2_sub_27BF8(P_TypeA2 a1);
int __fastcall sub_27C08(int a1, char a2);
unsigned int __fastcall sub_27C50(int, __int16, int, int);
void __fastcall sub_27D18(int, int, int, int);
void __cdecl callback_fn();
int __fastcall sub_28C4C(__int16 *, __int16 *);
int __fastcall Q_NC_sub_28C58(int result, __int16);
void __fastcall __spoils<> sub_28C74(P_Type2 a1);
void __fastcall sub_28DA4(int);
UBYTE *__fastcall sub_28EB4(int, const char *, int, int, int);
int __fastcall sub_29038(int, size_t, unsigned int, int, int, int);
unsigned int __fastcall Q_NC_sub_291F8(int);
unsigned int __fastcall Q_NC_sub_2936C(int);
unsigned int __fastcall sub_296B4(int, int, int, int);
void __fastcall sub_29B24(_DWORD *);
unsigned __int16 __fastcall sub_29C6C(int, _WORD *);
int __fastcall sub_29D54(int, unsigned __int8 *);
void __fastcall sub_29F58(int, const void *);
void __fastcall Q_NC_sub_29FF8(int, _WORD *);
FILE *__fastcall sub_2A1DC(int, const char *);
void __fastcall sub_2AA88(int);
int __fastcall Q_FLIC_CPP_StartTimer_sub_2AC84(int, ULONG hertz);
void __fastcall sub_2AD08(int);
__int16 __cdecl sub_2AD40(unsigned __int16 *, int, LONG y);
int __cdecl Q_NC_sub_2AE48(unsigned __int16);
__int16 Q_NC_sub_2AE69();
void __fastcall __spoils<> sub_2AE80(P_TypeA9 a1);
int __fastcall sub_2AEB0(int a1, char a2);
UBYTE *__fastcall sub_2AF04(int, const char *);
int __fastcall sub_2AF3C(int);
unsigned int __fastcall sub_2AFF0(int, __int16, int, int);
void __fastcall __spoils<> sub_2B2C0(_DWORD *);
void **__fastcall sub_2B2E0(void **);
unsigned int __fastcall sub_2B2FC(int a1, const char *aFName);
unsigned int __fastcall sub_2B360(void **a1, const char *aFName);
_DWORD *__fastcall sub_2B3E0(_DWORD *result, int, int, int, int);
int __fastcall sub_2B3F4(int, char *s2, char *s1, int);
int __fastcall sub_2B4F4(_DWORD *, char *string);
LONG __fastcall sub_2B594(int *);
int __fastcall sub_2B5BC(int *, char *);
void __fastcall Q_FONT_CPP_sub_2B610(_DWORD *, LONG, LONG, char *, int, int, __int16);
void __fastcall Q_NC_sub_2B804(LONG *, int);
LONG __fastcall Q_NC_sub_2B838(int, __int16, __int16);
int __fastcall sub_2B8A8(int a1, int a2, int a3, const char *text, __int16 a5, __int16 a6, __int16 a7, int a8);
void sub_2BB50();
void __fastcall sub_2BB74(PANE *pane, LONG a2, LONG y1, LONG x1, LONG y0, unsigned __int8 a6, int a7);
void __fastcall Q_GSYSTEM_CPP_sub_2BC40(PANE *pane, void *shape_table, LONG shape_number, int *hotX, int *hotY);
void __fastcall sub_2BCF4(int, unsigned __int8);
void __fastcall sub_2BD04(P_Type6, char, char *);
void __fastcall sub_2BD4C(P_Type6 a1);
T_Type6 *__fastcall sub_2BD7C(T_Type6 *);
unsigned int __fastcall sub_2BD88(P_Type6 a1, const char *a2, const char *a3);
unsigned int __fastcall Q_GSYSTEM_CPP_sub_2BFDC(P_Type6 a1, int a2, int a3, int a4);
void __fastcall Q_AllocateHazeTables_sub_2C08C(P_Type6 a1, unsigned __int16 numTables);
int __fastcall Q_LoadHazeTables_sub_2C0C0(P_Type6 a1, const char *a2, unsigned __int16 num);
unsigned int __fastcall Q_LoadPal_sub_2C158(P_Type6 a1, const char *aFName, int a3, unsigned __int16 a4);
int __fastcall sub_2C1E0(int, unsigned __int16, unsigned __int16, unsigned int);
void __fastcall Q_PaletteSet_sub_2C224(P_Type6 a1, unsigned __int16 from, __int16 count, RGB *palette);
void __fastcall Q_NC_sub_2C264(T_Type6 *);
void __fastcall Q_NC_sub_2C280(P_Type6, signed __int16, __int16);
void __fastcall Q_PaletteGet_sub_2C2B0(P_Type6 a1, unsigned __int16 from, __int16 count, RGB *palette);
void __fastcall sub_2C2F8(T_Type6 *, char *);
void __fastcall sub_2C418(P_Type6 a1, int a2, __int16 a3);
void __fastcall sub_2C4C0(P_Type6 a1, int a2, int a3);
void __fastcall Q_NC_sub_2C5C0(T_Type6 *);
void __fastcall Q_FadePalette_sub_2C5E4(P_Type6, char);
void __fastcall sub_2C670(int, int, int, char *);
void __fastcall Q_StopVideoSystem_sub_2C6CC(P_Type6 a1);
void __fastcall Q_GSYSTEM_CPP_PreloadMouseShp_sub_2C744(P_Type6 a1, char *a2, int a3, int a4);
void __fastcall Q_GSYSTEM_CPP_sub_2C7D0(T_Type6 *a1, int a2, int a3);
void __fastcall __spoils<> Q_A2_sub_2C830(P_TypeA2 a1);
int __fastcall sub_2C848(int, char);
void __fastcall __spoils<> Q_A1_sub_2C8E4(P_TypeA1 result);
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_2C978(P_TypeA1 a1);
unsigned int __fastcall Q_GWINDOW_CPP_LinkChild_sub_2C990(P_TypeA1 a1, P_TypeA1 a2);
unsigned int __fastcall sub_2CA0C(int, int, _DWORD *);
int __fastcall Q_NC_sub_2CA58(int);
_DWORD *__fastcall sub_2CA78(_DWORD *result, __int16, __int16);
void __fastcall sub_2CD24(unsigned int, int);
void __fastcall sub_2CF28(unsigned int);
unsigned int __fastcall sub_2D0F4(unsigned int, int);
void __fastcall sub_2D218(_DWORD *);
int __fastcall sub_2D258(int result, __int16);
int Q_GWINDOW_CPP_LoadGwshareTxt_sub_2D2CC();
int __fastcall sub_2D334(const char *);
char *__fastcall sub_2D3D0(int);
unsigned int __fastcall sub_2D400(int, int);
void __fastcall __spoils<> Q_A4_sub_2D464(P_TypeA4 a1);
int __fastcall sub_2D480(int a1, char a2);
void __fastcall __spoils<> Q_A4_sub_2D4C4(P_TypeA4 result);
unsigned int __fastcall sub_2D4D0(_DWORD *, __int16, int, int);
void __fastcall sub_2D528(int, int);
void __fastcall sub_2D79C(int);
int __fastcall sub_2D99C(int, unsigned int count, int);
void __fastcall __spoils<> Q_A3_sub_2D9C4(P_TypeA3 a1);
int __fastcall sub_2D9FC(int a1, char a2);
void __fastcall __spoils<> Q_A1_sub_2DA60(P_TypeA1 result);
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_2DA68(P_TypeA1 a1);
MACRO_VFX_BOOL __fastcall sub_2DA80(P_TypeA3, __int16 numControls);
unsigned int __fastcall sub_2DAC8(P_TypeA3 a1, __int16 a2, __int16 a3, int a4);
int __fastcall sub_2DB54(int result, __int16, __int16);
int __fastcall sub_2DBE4(int, int, int);
int __fastcall sub_2DCA0(int result, __int16);
int __fastcall Q_NC_sub_2DD2C(int, __int16, __int16);
int __fastcall sub_2DD70(int);
unsigned int __fastcall sub_2DDB8(int, __int16);
unsigned int __fastcall sub_2DE68(T_TypeA3 *, __int16, LONG, LONG);
// void __usercall sub_2E084(int@<eax>, __int16@<si>);
int __fastcall sub_2E1B4(int, unsigned int count, int);
int __fastcall sub_2E208(_DWORD *, const char *, int, int);
T_TypeA2 *__fastcall sub_2E248(T_TypeA2 *);
int __fastcall sub_2E264(int a1, char a2);
int __fastcall sub_2E2B8(int);
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_2E3BC(P_TypeA1 a1);
unsigned int __fastcall sub_2E3D4(int, __int16, signed int, signed int);
void __fastcall sub_2E6C0(int);
void __fastcall sub_2E868(int, int);
int __fastcall sub_2E9CC(int, char);
int __fastcall sub_2EA8C(int, const char *, __int16, int);
unsigned int __fastcall sub_2EC50(int, unsigned __int16, int);
int __fastcall sub_2ECA4(int, unsigned __int16);
int __fastcall sub_2ECDC(int result, unsigned __int16);
int __fastcall sub_2ED14(int, unsigned __int16);
int __fastcall sub_2ED4C(int);
void __fastcall sub_2EDC8(int, unsigned int, unsigned int);
void __fastcall sub_2F090(int, unsigned int, unsigned int, __int16);
int __fastcall sub_2F1C8(int result, int);
int __fastcall sub_2F1D8(int result, int);
void __fastcall sub_2F1E0(int);
int __fastcall sub_2F228(int, size_t, int);
void __fastcall sub_2F2B4(int);
T_TypeA2 *__fastcall sub_2F2F4(T_TypeA2 *result);
int __fastcall sub_2F30C(int a1, char a2);
void __fastcall sub_2F354(int);
int __fastcall sub_2F414(int);
unsigned int __fastcall sub_2F420(int, __int16, int, int);
unsigned int __fastcall sub_2F424(int, __int16, int, int);
unsigned int __fastcall sub_2F478(int, __int16, int, int);
T_TypeA2 *__fastcall sub_2F48C(T_TypeA2 *);
int __fastcall sub_2F4A8(int a1, char a2);
int __fastcall sub_2F4EC(int result);
void __fastcall sub_2F540(int);
unsigned int __fastcall sub_2F6B0(int, __int16, char, unsigned int);
int __fastcall sub_2F8A4(int, int);
// char __usercall sub_2F8F8@<al>(int@<eax>, __int16@<dx>, char@<bl>, int@<edi>);
int __fastcall sub_2F9A4(int, const char *, __int16);
void __fastcall __spoils<> Q_A3_sub_2FA18(P_TypeA3 a1);
int __fastcall sub_2FA34(int a1, char a2);
void __fastcall __spoils<> Q_A3_sub_2FA78(P_TypeA3 result);
void __fastcall sub_2FA98(int);
void __fastcall sub_2FBA4(int, int);
int __fastcall sub_2FC3C(int);
void __fastcall __spoils<> Q_A2_sub_2FC50(P_TypeA2 a1);
int __fastcall sub_2FC68(int a1, char a2);
int __fastcall sub_2FCB0(_DWORD *, char *, char *);
unsigned int __fastcall sub_2FD68(int, __int16, int, int);
void __fastcall Q_HELPWIN_CPP_FgetsLine_sub_2FE58(FILE *fp, char *line);
int __fastcall sub_2FEB8(int a1);
void __fastcall sub_30774(int);
int __fastcall sub_30A90(T_Type5 *, int edx0, int, int);
int __fastcall sub_31158(_DWORD *, int, int, int);
T_TypeA2 *__fastcall sub_31200(T_TypeA2 *result);
int __fastcall sub_3121C(int a1, char a2);
unsigned int __fastcall sub_31268(int, unsigned __int16, int, int);
void __fastcall sub_3160C(int);
void __fastcall sub_316A8(int, int);
int __fastcall sub_317D0(int);
int __fastcall sub_318A0(unsigned __int16, unsigned __int8);
unsigned __int8 __fastcall sub_31934(int a1);
int __fastcall sub_31A34(unsigned __int16, char);
int sub_31B08();
int __fastcall sub_31C18(int result, int);
void __fastcall Q_AppendRomanNum_sub_31E60(char *a1, int number);
int __fastcall sub_31FB0(_DWORD *, const char *, int, int);
void __fastcall __spoils<> Q_A7_sub_3201C(P_TypeA7 a1);
int __fastcall sub_32038(int a1, char a2);
void __fastcall __spoils<> Q_A7_sub_3207C(P_TypeA7 result);
unsigned int __fastcall sub_320B8(int, __int16, int, int);
void __fastcall sub_32414(int);
void *__fastcall sub_32658(int);
int __fastcall sub_32714(int, int, __int16);
int __fastcall sub_32800(int, int);
__int64 __fastcall sub_32A1C(int);
__int64 __fastcall sub_32A48(int, int, __int16, int, int);
__int64 __fastcall sub_32B44(int, int, __int16);
__int64 __fastcall sub_32BDC(int, char);
__int64 __fastcall sub_32C14(int, char);
char *__fastcall sub_32C48(int, char, int, int);
int __fastcall sub_32E84(int, int, int, int);
int __fastcall sub_32FD8(int, FILE *, int);
void __fastcall sub_330DC(T_Type5 *, unsigned __int8 *);
void __fastcall __spoils<> sub_33598(P_TypeA4 a1);
int __fastcall sub_335B4(int a1, char a2);
void __fastcall __spoils<> sub_335F8(P_TypeA4 result);
unsigned int __fastcall sub_33604(int, __int16, int, int);
void __fastcall sub_33674(int);
void __fastcall __spoils<> Q_A6_sub_33830(P_TypeA6 a1);
int __fastcall sub_33840(int a1, char a2);
int __fastcall sub_33884(_DWORD *, int, int, int);
unsigned int __fastcall sub_338DC(int, __int16, int, int);
void __fastcall sub_33A68(int);
UWORD __fastcall Q_PLANET_CPP_sub_33AF0(P_Planet a1, unsigned __int16 size, unsigned __int16 type, int a4);
void __fastcall Q_PLANET_CPP_LoadPlanItemTxt_sub_33D30();
int __fastcall sub_3407C(P_Planet a1);
int __fastcall sub_3420C(T_Planet *a1);
unsigned int __fastcall sub_34368(P_Planet a1, unsigned __int8 a2, unsigned __int16 a3);
void __fastcall sub_34774(P_Planet a1, unsigned __int8 a2, int a3, int a4);
int __fastcall sub_347CC(P_Planet a1, unsigned __int8 a2);
UWORD __fastcall sub_34A44(T_Planet *, _DWORD *, _DWORD *, _DWORD *);
int __fastcall sub_34AE4(P_Planet a1, unsigned __int8 a2, int a3);
unsigned int __fastcall sub_34B0C(P_Planet, int edx0, UBYTE bl0, unsigned __int8 cl0);
UWORD __fastcall sub_34E70(P_Planet);
int __fastcall sub_352E0(P_Planet pPlanet);
__int16 __fastcall Q_GetPlanetItemCost_sub_3583C(P_Planet pPlanet, unsigned __int16 a2, unsigned __int8 planetItemIndex);
int __fastcall Q_GetDaysToCompletePlanetItem_sub_358BC(P_Planet pPlanet);
int __fastcall sub_358F0(P_Planet a1);
UWORD __fastcall sub_35930(P_Planet a1, char a2);
int __fastcall sub_35968(P_Planet a1, int a2, int a3);
unsigned int __fastcall sub_35A00(P_Planet a1, unsigned __int16 a2);
T_Ship *__fastcall sub_35A70(P_Planet pPlanet, unsigned __int16 a2);
unsigned __int16 __fastcall sub_35B04(int, unsigned __int16, int);
unsigned int __fastcall sub_35BB4(T_Planet *, int);
unsigned int __fastcall sub_35C38(T_Planet *a1, T_Ship *a2);
char __fastcall sub_35DA4(P_Planet a1);
char __fastcall sub_35E24(P_Planet a1);
int __fastcall sub_35ED8(T_Planet *);
int __fastcall sub_35FE0(P_Planet a1);
int __fastcall sub_36050(P_Planet a1);
int __fastcall sub_360D8(P_Planet a1);
int __fastcall sub_36158(P_Planet a1);
int __fastcall sub_361B8(T_Planet *);
unsigned int __fastcall sub_3623C(T_Planet *);
void __fastcall sub_362C8(P_Planet, T_Vector3D *);
unsigned int __fastcall sub_362E0(P_Planet);
void __fastcall sub_3636C(int, int);
int __fastcall sub_363B0(T_Planet *);
int __fastcall sub_364B4(T_Planet *, __int16);
void __fastcall sub_366C8(P_Planet a1, char a2, _DWORD *a3, _DWORD *a4, _DWORD *a5);
int __fastcall sub_3676C(T_Planet *a1, int a2);
__int16 __fastcall sub_36A5C(T_Planet *a1, int a2, __int16 a3);
unsigned int __fastcall sub_36CD4(T_Planet *a1, unsigned __int16 dx0, int *a3);
UWORD __fastcall sub_37040(P_Planet a1);
void __fastcall Q_ReadWritePlanet_sub_370B8(P_Planet pPlanet, P_FileInfo pfi, int read);
T_TypeA2 *__fastcall sub_372B0(T_TypeA2 *, int, int, int);
int __fastcall sub_372CC(int a1, char a2);
int __fastcall sub_37310(int, int, int, int);
int __fastcall sub_37380(int, int);
int __fastcall sub_373E0(int, int);
int __fastcall sub_3745C(T_Type5 *, unsigned __int8 *, int, int);
int __fastcall sub_37568(int, unsigned __int16, int, unsigned int);
void __fastcall sub_384B0(int);
char __fastcall sub_39390(int, unsigned __int8, __int16 *, _WORD *);
__int16 __fastcall sub_393F4(int, unsigned __int16, _WORD *, _WORD *);
char *__fastcall sub_394BC(int);
int __fastcall sub_395C4(int, unsigned int count, int);
void __fastcall __spoils<> Q_A2_sub_395EC(P_TypeA2 result);
int __fastcall sub_395FC(int a1, char a2);
unsigned int __fastcall sub_39644(int, __int16, int, int);
void __fastcall sub_396F0(int, int);
T_TypeA2 *__fastcall sub_39D80(T_TypeA2 *);
int __fastcall sub_39D9C(int a1, char a2);
char *sub_39DE0();
unsigned int __fastcall sub_39E3C(int, __int16 dx0, int, int);
void __fastcall sub_3A6BC(int);
void __fastcall sub_3B120(P_Race pRace);
void __fastcall sub_3B188(P_Race pRace);
int __fastcall sub_3B1FC(_BYTE *, char, __int16);
char __fastcall sub_3B220(int, int, int, int);
char __fastcall Q_NC_sub_3B38C(unsigned __int8 *);
int __fastcall sub_3B56C(unsigned __int8 *, __int16 *);
void __fastcall sub_3B5B8(unsigned __int8 *);
unsigned int __fastcall sub_3C12C(unsigned __int8 *, _DWORD *);
char __fastcall sub_3C1C0(unsigned __int8 *, int *, int);
int __fastcall sub_3C2E8(unsigned __int8 *, int *, int);
T_Star *__fastcall Q_NC_sub_3C4EC(T_Star *a1, int a2);
char __fastcall sub_3C670(_BYTE *);
int __fastcall sub_3C968(int);
int __fastcall sub_3CB60(unsigned __int8 *, T_Planet *, unsigned __int8);
unsigned int __fastcall Q_NC_sub_3CC90(_BYTE *, unsigned __int8);
unsigned int __fastcall sub_3CCE4(_BYTE *a1, P_Planet a2_1);
void __fastcall sub_3D8F0(int a1, P_Planet a2);
unsigned int __fastcall sub_3E020(int eax0, P_Planet, unsigned __int8 bl0);
int __fastcall sub_3E1CC(int eax0, P_Planet);
unsigned int __fastcall sub_3E520(int a1, P_Planet a2);
int __fastcall sub_3E800(_BYTE *, unsigned __int16 *);
__int16 __fastcall sub_3EA7C(_BYTE *);
char __fastcall sub_3EBDC(unsigned __int8 *, int);
size_t __fastcall sub_3EFE0(int);
__int16 __fastcall sub_3F060(unsigned __int8 *, _DWORD *, int, unsigned __int8);
unsigned int __fastcall sub_3F324(int, char, char, char, int, char, _DWORD *, unsigned __int8);
unsigned int __fastcall sub_3F3F8(unsigned __int8 *, char, char, char, char, char, _DWORD *, unsigned __int8);
unsigned int __fastcall sub_3F784(int, char, char, char, char, char, _DWORD *, unsigned __int8);
unsigned int __fastcall sub_3FBAC(int, char, char, char, char, char, _DWORD *, unsigned __int8);
int __fastcall sub_40084(int, _DWORD *, int, char);
T_Ship *__fastcall sub_40144(unsigned __int8 *a1, int a2);
int __fastcall compar(const void *, const void *); // idb
size_t __fastcall sub_40224(unsigned __int8 *, _DWORD *, _DWORD *);
int __fastcall sub_402E0(_BYTE *);
int __fastcall sub_403C0(unsigned __int8 *, int);
int __fastcall sub_40590(_BYTE *);
unsigned int __fastcall sub_405F4(_BYTE *);
int __fastcall sub_40664(_BYTE *);
int __fastcall sub_406C4(unsigned __int8 *, __int16 *, int);
// int __userpurge sub_41268@<eax>(unsigned __int8 *@<eax>, __int16@<dx>, int@<ecx>, int@<ebx>, int@<ebp>, int, __int16, int, int, int, int, int);
unsigned int __fastcall sub_43184(int, int, int);
char __fastcall sub_43374(unsigned __int8 *, int);
unsigned int __fastcall sub_433E0(int, __int16, int);
int __fastcall sub_434E4(char *, int);
int __fastcall sub_43B7C(int, __int16);
void __fastcall Q_ReadWriteRace_sub_43BDC(P_Race pRace, P_FileInfo fi, int read);
int __fastcall Q_RACENEG_CPP_sub_43C80(int);
unsigned int __fastcall sub_44024(_BYTE *, char);
T_Race *__fastcall sub_44080(unsigned __int8 *);
int __fastcall sub_44238(int, __int16, _BYTE *, __int16);
char __fastcall sub_44434(unsigned __int8 *, __int16, _DWORD *);
int __fastcall sub_44A2C(_BYTE *, int, char, _BYTE *);
char __fastcall sub_44BCC(int, __int16 *, char, int, int *);
void __fastcall sub_450B0(unsigned __int8 *, __int16, char, char, int, int);
// int __usercall sub_45848@<eax>(unsigned __int8 *@<eax>, int@<edx>, int@<ebx>, __int16 *@<edi>);
int __fastcall sub_45958(unsigned __int8 *, char, __int16 *, _DWORD *);
int __fastcall sub_45A0C(_BYTE *, int, int, __int16);
unsigned int __fastcall sub_45A54(unsigned __int8 *, int, int);
unsigned int __fastcall sub_45D50(unsigned __int8 *, int, int);
unsigned int __fastcall sub_45E64(_BYTE *, __int16);
void __fastcall sub_45F60(_BYTE *, __int16, int);
unsigned int __fastcall sub_46034(_BYTE *, __int16);
void __fastcall sub_46130(_BYTE *, __int16, int);
unsigned int __fastcall sub_46208(_BYTE *, __int16);
int __fastcall sub_46304(_BYTE *, __int16, int);
void sub_46470();
void __fastcall __spoils<eax,edx> Q_RESEARCH_CPP_LoadResTreeTxt_sub_46480(P_ResTree a1, const char *fname);
int __fastcall sub_466FC(unsigned int);
unsigned int __fastcall sub_468BC(unsigned int result);
unsigned int __fastcall sub_46900(char *, char);
unsigned int __fastcall sub_4694C(int, unsigned __int16, __int16);
int __fastcall sub_469F0(int, unsigned __int16);
__int16 __fastcall sub_46A94(unsigned __int16 *, unsigned __int16, int);
void __fastcall Q_ReadWriteResTree_sub_46BB0(P_ResTree a1, P_FileInfo a2, int read);
void __fastcall __spoils<> sub_46C10(P_ResTree a1);
int __fastcall Q_GetTurnsToComplete_sub_46C20(int cost, int done, int production);
void *__fastcall sub_46C48(int a1, char a2);
int __fastcall sub_46CAC(int, int, int, int);
int __fastcall sub_47088(int);
unsigned int __fastcall sub_47224(int, unsigned __int16, int, unsigned int);
int __fastcall sub_47A64(const void *, const void *); // idb
void __fastcall sub_47ABC(int);
int __fastcall sub_48B14(int, unsigned int count, int);
int __fastcall sub_48B40(T_TypeA2 *, int, int, int);
void __fastcall sub_48B90(P_Ship pShip);
int __cdecl sub_48C58();
void __fastcall sub_48C5C(P_Ship pShip, char);
void Q_SHIP_CPP_LoadGizmosTxt_sub_48C84();
void __fastcall sub_48EAC(P_Ship pShip);
void __fastcall sub_49148(P_Ship pShip, char a2);
unsigned int __fastcall sub_492AC(_DWORD *, char, int);
unsigned int __fastcall sub_492F8(_DWORD *, int);
unsigned int __fastcall sub_49328(int a1, char a2);
unsigned int __fastcall sub_4937C(int a1, char a2);
void __fastcall sub_493BC(T_Ship *a1, char a2);
void __fastcall sub_49494(int, float *);
unsigned int __fastcall sub_4960C(int, int);
unsigned int __fastcall sub_49648(int, __int16 **);
void __fastcall sub_496BC(int, _DWORD *);
void __fastcall sub_496E0(_DWORD *);
int __fastcall sub_49828(T_Ship *a1);
__int16 __fastcall sub_49940(int);
int __fastcall sub_49A40(int, int);
T_Gizmo *__fastcall sub_49A8C(int a1, char *a2);
int __fastcall sub_49B3C(int, int);
int __fastcall sub_49B68(int, int);
int __fastcall sub_49CC4(int, int);
int __fastcall sub_4A0D0(int, int);
int __fastcall sub_4A144(int);
int __fastcall sub_4A18C(int);
int __fastcall sub_4A1CC(int, __int16);
char __fastcall sub_4A36C(int, char, __int16);
int __fastcall sub_4A404(int, char);
_BYTE *__fastcall sub_4A480(int, unsigned __int16, int);
unsigned int __fastcall sub_4A534(int, char);
unsigned int __fastcall sub_4A564(int);
int __fastcall sub_4A5B8(int result);
int __fastcall sub_4A6AC(int, int, int, int);
int __fastcall sub_4A8CC(int);
int __fastcall sub_4A8FC(int);
int __fastcall sub_4A988(int);
int __fastcall sub_4AA78(int, int);
int __fastcall sub_4AAEC(int, int);
void __fastcall Q_ReadWriteShip_sub_4AE8C(P_Ship pShip, P_FileInfo pfi, int read);
int __fastcall sub_4B5C0(int result, int);
int __fastcall sub_4B5E0(_DWORD *, int);
int __fastcall sub_4B780(int result, int);
int __fastcall sub_4B7A0(int, int, int, __int16);
int __fastcall sub_4B944(int, int);
int __fastcall sub_4C7FC(int, int);
int __fastcall sub_4CAB8(int, int);
int __fastcall sub_4CDF8(int, int);
void sub_4D700();
int __fastcall sub_4D724(T_Type5 *, int, LONG, int);
unsigned int __fastcall sub_4D7A8(int, int, int);
char *__fastcall sub_4D92C(int);
void *__fastcall sub_4DA08(int a1, char a2, int a3, int a4);
int __fastcall sub_4DA5C(int result);
int __fastcall sub_4DA7C(int, int, int, int);
char __fastcall sub_4DD14(int);
unsigned int __fastcall sub_4DDB0(int, __int16, int, int);
int __fastcall sub_4E644(int result, char, int, int);
unsigned int __fastcall sub_4E69C(int);
void __fastcall sub_4E758(_DWORD *);
int __fastcall sub_4EE00(int);
char *sub_4EE50();
P_SoundSystem __fastcall sub_4EE74(P_SoundSystem);
int __fastcall sub_4EF94(T_SoundSystem *);
LONG __fastcall Q_StartSoundSystem_sub_4EFB0(T_SoundSystem *, int aDIG, int aMDI);
HMDIDRIVER __fastcall sub_4F088(char *path, char *, char *, char *);
int __fastcall sub_4F184(P_SoundSystem a1, int a2);
void __fastcall sub_4F32C(int, __int16, int);
void __fastcall sub_4F45C(int, __int16);
void __fastcall sub_4F4D4(int, __int16);
HDIGDRIVER __fastcall sub_4F534(_DWORD *, char *, char *);
int __fastcall Q_AllocateSamples_sub_4F5E8(P_SoundSystem a1, int a2);
unsigned int __fastcall Q_LoadMusic_sub_4F65C(P_SoundSystem a1, const char *aMusicFName);
MACRO_VFX_BOOL __fastcall sub_4F8CC(P_SoundSystem, __int16 track, int setpos);
void __fastcall Q_StopSample_sub_4FA1C(P_SoundSystem a1);
void __fastcall sub_4FAB4(int);
void __fastcall Q_StartSample_sub_4FB90(P_SoundSystem a1, __int16 a2);
void __fastcall Q_StopSoundSystem_sub_4FE8C(P_SoundSystem a1);
void __fastcall Q_SetNoSound_sub_4FF08(P_SoundSystem a1);
void __fastcall sub_4FF1C(P_SoundSystem a1);
void __fastcall sub_4FF28(P_SoundSystem a1);
void __fastcall Q_SetVolume_sub_4FF4C(P_SoundSystem a1, char a2);
int __fastcall sub_4FF94(P_SoundSystem a1);
char *__fastcall sub_50140(P_SoundSystem, __int16);
UWORD __fastcall sub_50530(T_Type5 *a1, P_Planet pPlanet, int a3, int a4);
void __fastcall sub_50D70(_DWORD *, int, int, int);
void __fastcall sub_51610(T_Type5 *, LONG, int, int);
T_TypeA2 *__fastcall sub_51674(T_TypeA2 *);
int __fastcall sub_51690(int a1, char a2);
int __fastcall sub_516D4(int result);
void __fastcall sub_516E0(_DWORD *);
unsigned int __fastcall sub_51894(int, __int16, __int16, int);
T_TypeA2 *__fastcall sub_51B64(T_TypeA2 *);
int __fastcall sub_51B80(int a1, char a2);
void __fastcall sub_51BC4(_DWORD *);
unsigned int __fastcall sub_51D24(int, __int16, int, int);
T_TypeA2 *__fastcall sub_520EC(T_TypeA2 *);
int __fastcall sub_52108(int a1, char a2);
int __fastcall sub_5214C(int result);
int __fastcall sub_52174(int);
void __fastcall sub_521C0(int, int edx0);
unsigned int sub_526D8();
int __fastcall sub_52714(int);
unsigned int __fastcall sub_5294C(int, __int16 dx0, int, int);
void __fastcall Q_NormVector3D_sub_53000(T_Vector3D *a1);
void __fastcall sub_53054(float *, float);
unsigned int __fastcall sub_53078(_DWORD *);
double __fastcall sub_5309C(float *, float *);
float *__fastcall sub_53114(float *result, float *);
int __fastcall sub_5323C(int result, float);
void __fastcall Q_RotateVectorY_sub_532AC(T_Vector3D *vector, float degrees);
float *__fastcall sub_53318(float *result, float);
float *__fastcall sub_53384(float *result, float *, float *);
int __fastcall sub_533D4(float *, float, int, int, int, int);
void __fastcall sub_53440(T_Vector3D *a1);
void __fastcall sub_5353C(float *, int, int, int, int);
void __fastcall sub_53564(float *, int, int, int, int);
void __fastcall sub_5358C(float *, int, int, int, int);
void __fastcall sub_535B4(float *, int, int, int, int);
void __fastcall sub_535E4(float *, int, int, int, int);
void __fastcall sub_53644(float *, int, int, int);
void __fastcall sub_53754(float *, int, int, int);
void __fastcall sub_53864(float *, int, int, int);
float *__fastcall sub_53B08(float *result, float *, float *, float *);
int __cdecl sub_53D22(int);
int __fastcall sub_53DC0(int, int, int);
void __cdecl Q_Timer_sub_53DE4();
int Q_CheckFreeMemory_sub_53DEC();
void __fastcall Q_WINMGR_CPP_sub_53E38(PANE *pane, LONG hotX, LONG hotY, __int16 a4);
void __fastcall sub_53EB8(PANE *pane, void *shape_table, LONG shape_number, LONG hotX, LONG hotY, __int16 a6);
void __fastcall sub_53F40(T_Type5 *, void *, LONG, LONG, int, char);
void __fastcall Q_LoadGam_sub_53FB0(const char *fname);
int __fastcall Q_SaveGam_sub_54048(const char *fname);
LONG __fastcall sub_54208(PANE *, int, int, int);
LONG __fastcall Q_WINMGR_CPP_sub_542B0(PANE *target);
int __fastcall sub_54344(int, int, int);
char *__fastcall sub_54374(T_Type3 *);
__int64 __fastcall sub_54448(int);
unsigned int __fastcall Q_WINMGR_CPP_StartTimer_sub_545EC(P_Type3 a1);
void __fastcall sub_54664(int);
int __fastcall sub_5469C(T_Type3 *a1);
unsigned int __fastcall sub_54D64(P_Type3 a1);
void __fastcall sub_5508C(P_Type3);
void __fastcall sub_55214(T_Type3 *, LONG x1, LONG y1, LONG x2, int y2);
void __fastcall sub_55274(P_Type3 a1, int x1, int y1, int x2, int y2);
void __fastcall sub_552CC(P_Type3 a1, PANE *a2);
int __fastcall sub_552F8(P_Type3 a1, P_TypeA2 a2, int a3);
LONG __fastcall sub_55554(int, _DWORD *);
void __fastcall sub_55618(P_Type3 a1);
void __fastcall Q_ShowMsgBox_sub_556CC(P_Type3 a1, char *a2);
const char *__fastcall sub_557D4(T_Type3 *eax0, char *s2, const char *, __int16);
unsigned int __fastcall sub_55AEC(P_Type3 a1, __int16 a2, int a3, int a4);
char __fastcall sub_55B74(int);
void __fastcall sub_55E80(int);
void __fastcall sub_56400(T_Type3 *, int, __int16, int, int, int);
void __fastcall sub_564C0(T_Type3 *, int, __int16);
int __fastcall sub_56528(int, int, __int16);
unsigned int __fastcall sub_56564(int, int, __int16, int);
int __fastcall sub_56694(T_Type3 *);
void __fastcall sub_56728(int, int, int, __int16, int, int);
void __fastcall sub_567BC(P_Type3 a1, int a2, __int16 a3);
void __fastcall sub_56824(int);
int __fastcall sub_5691C(int result);
int __fastcall sub_56B60(P_Type3 a1, __int16 a2, int a3, int a4);
void __fastcall sub_56BE8(P_Type3 a1, __int16 a2, int a3, int a4, int a5);
int __fastcall sub_56D30(P_Type3 a1, int a2, int a3, int a4, int a5);
T_TypeA1 *__fastcall sub_56D70(T_Type3 *, char *, __int16, int, int);
T_TypeA1 *__fastcall Q_FindWnd_sub_56DA8(P_Type3, char *name, _WORD *);
T_TypeA1 *__fastcall sub_56E18(P_Type3, char *s1, __int16, _WORD *);
P_Type3 __fastcall sub_56E9C(P_Type3 a1, __int16 a2, int a3);
int __fastcall sub_570AC(int, int);
int __fastcall Q_WINMGR_CPP_RegisterWindow_sub_571B8(P_Type3 a1, P_TypeA1 a2);
unsigned int __fastcall sub_57220(P_Type3 a1, int a2, __int16 a3);
unsigned int __fastcall sub_57310(P_Type3 a1, int a2, __int16 a3, int a4);
unsigned int __fastcall sub_5748C(int, __int16, __int16);
void __fastcall Q_SetProc1_sub_574F0(P_Type3 a1, __int16 index, void *proc);
void __fastcall Q_SetProc2_sub_57510(P_Type3 a1, __int16 index, void *proc);
int __fastcall sub_57530(int result, int, int);
FILE *__fastcall sub_575BC(P_Type3);
FILE *__fastcall Q_WINMGR_CPP_LoadWindowsTxt_sub_57670(P_Type3 a1, const char *a2);
void __fastcall Q_LoadAscendCfg_sub_59828(P_Type3);
int __fastcall Q_SaveAscendCfg_sub_5989C(P_Type3 a1);
int __fastcall sub_59908(int result);
void __fastcall sub_59934(P_Type3, int);
unsigned int __fastcall sub_59988(P_Type3, char *, int);
P_Type3 __fastcall sub_59A54(P_Type3 a1);
void __fastcall sub_59B80(T_Type3 *);
void __fastcall sub_59C80(P_Type3 a1, int a2, __int16 a3, __int16 a4, int a5, int a6, int a7);
unsigned int __fastcall sub_59CFC(P_Type3 a1, const char *a2);
void __fastcall sub_59DE0(P_Type3 a1);
char *__fastcall sub_59E88(P_Type3 a1, char *a2, char *filename);
void __fastcall Q_WINMGR_CPP_sub_5A094(P_Type3 a1, void *aData, int a3, char *name);
void __fastcall Q_WINMGR_CPP_sub_5A144(P_Type3 a1, void *a2);
char *__fastcall sub_5A194(int, int, _DWORD *, _DWORD *);
void __fastcall sub_5A270(T_Type3 *a1, int a2, int a3, int a4);
void __fastcall sub_5A294(P_Type3 a1);
void __fastcall Q_Proc_sub_5A320(__int16);
int __fastcall sub_5A47C(T_Type5 *, const char *, int, int);
LONG __fastcall sub_5A4E4(_DWORD *, LONG, int, int);
T_TypeA2 *__fastcall sub_5A594(T_TypeA2 *result);
int __fastcall sub_5A5AC(int a1, char a2);
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_5A5F4(P_TypeA1 a1);
unsigned int __fastcall sub_5A60C(int, __int16, __int16, int);
void __fastcall sub_5AA08(int);
int __fastcall sub_5AB04(const char **, const char **);
void __fastcall sub_5AB2C(int, int);
int __fastcall sub_5AE68(int, int);
unsigned int __fastcall sub_5AF30(int, int);
int __fastcall sub_5B200(int, int);
int __fastcall sub_5B244(int result, int);
int __fastcall sub_5B2B0(int a1, char a2);
T_TypeA2 *__fastcall sub_5B2F0(T_TypeA2 *result);
void *__fastcall sub_5B300(int a1, char a2);
T_TypeA2 *__fastcall sub_5B340(T_TypeA2 *result);
BOOL __fastcall sub_5B50C(_DWORD *, _DWORD *);
_DWORD *__fastcall sub_5B617(size_t);
unsigned int __fastcall sub_5B71C(int);
unsigned int __fastcall sub_5B7C2(_DWORD *a1, int a2, int x1, int y1, int x2, int y2);
unsigned int __fastcall sub_5BA38(_DWORD *);
int __fastcall sub_5BAC0(_DWORD *, int);
char *__fastcall sub_5BBE4(void **, char *, int);
void __fastcall sub_5BDDC(void *);
// BYTE *__cdecl VFX_driver_name(void *VFXScanDLL);
// LONG __cdecl VFX_register_driver(void *DLLbase);
// LONG __cdecl VFX_pixel_write(PANE *pane, LONG x, LONG y, ULONG color);
// LONG __cdecl VFX_pixel_read(PANE *pane, LONG x, LONG y);
// LONG __cdecl VFX_line_draw(PANE *pane, LONG x0, LONG y0, LONG x1, LONG y1, LONG mode, LONG parm);
// void __cdecl VFX_shape_draw(PANE *pane, void *shape_table, LONG shape_number, LONG hotX, LONG hotY);
// void __cdecl VFX_shape_lookaside(UBYTE *table);
// void __cdecl VFX_shape_translate_draw(PANE *pane, void *shape_table, LONG shape_number, LONG hotX, LONG hotY);
// void __cdecl VFX_shape_transform(PANE *pane, void *shape_table, LONG shape_number, LONG hotX, LONG hotY, void *buffer, LONG rot, LONG x_scale, LONG y_scale, LONG flags);
// void __cdecl VFX_shape_visible_rectangle(void *shape_table, LONG shape_number, LONG hotX, LONG hotY, LONG mirror, RECT *rectangle);
// LONG __cdecl VFX_pane_wipe(PANE *pane, LONG color);
// LONG __cdecl VFX_pane_copy(PANE *source, LONG sx, LONG sy, PANE *target, LONG tx, LONG ty, LONG fill);
// void __cdecl VFX_ellipse_draw(PANE *pane, LONG xc, LONG yc, LONG width, LONG height, LONG color);
// void __cdecl VFX_ellipse_fill(PANE *pane, LONG xc, LONG yc, LONG width, LONG height, LONG color);
// LONG __cdecl VFX_font_height(void *font);
// LONG __cdecl VFX_character_width(void *font, LONG character);
// LONG __cdecl VFX_character_draw(PANE *pane, LONG x, LONG y, void *font, LONG character, UBYTE *color_translate);
// void __cdecl VFX_string_draw(PANE *pane, LONG x, LONG y, void *font, char *string, UBYTE *color_translate);
// LONG __cdecl VFX_GIF_draw(PANE *pane, UBYTE *GIF_buffer, void *GIF_scratch);
// LONG __cdecl VFX_shape_resolution(void *shape_table, LONG shape_num);
// LONG __cdecl VFX_shape_count(void *shape_table);
// void __cdecl VFX_window_fade(WINDOW *buffer, RGB *palette, LONG intervals);
// int __cdecl sub_61800(_DWORD *, int, int);
// LONG __cdecl sub_62DA5(WINDOW *, int, int, int);
// void MOUSE_show(void);
// void MOUSE_hide(void);
// void __fastcall MOUSE_set_pointer(void *table, LONG shape);
// void __fastcall MOUSE_status(LONG *mx, LONG *my, LONG *ml, LONG *mr, LONG *mc);
// void __fastcall MOUSE_force_move(LONG new_x, LONG new_y);
// void __fastcall MOUSE_pane_list_refresh(PANE_LIST *list);
// LONG __fastcall MOUSE_init(LONG xsize, LONG ysize);
// void MOUSE_shutdown(void);
// void *__cdecl DLL_load(void *source, ULONG flags, void *dll);
// void __cdecl AIL_startup();
// void __cdecl AIL_shutdown();
// HTIMER __cdecl AIL_register_timer(AILTIMERCB callback_fn);
// void __cdecl AIL_set_timer_frequency(HTIMER timer, ULONG hertz);
// void __cdecl AIL_start_timer(HTIMER timer);
// void __cdecl AIL_stop_timer(HTIMER timer);
// void __cdecl AIL_release_timer_handle(HTIMER timer);
// LONG __cdecl AIL_install_DIG_INI();
// HDIGDRIVER __cdecl AIL_install_DIG_driver_file(BYTE *filename, IO_PARMS *IO);
// HSAMPLE __cdecl AIL_allocate_sample_handle(HDIGDRIVER dig);
// void __cdecl AIL_init_sample(HSAMPLE S);
// void __cdecl AIL_set_sample_address(HSAMPLE S, void *start, ULONG len);
// void __cdecl AIL_set_sample_type(HSAMPLE S, LONG format, ULONG flags);
// void __cdecl AIL_start_sample(HSAMPLE S);
// void __cdecl AIL_stop_sample(HSAMPLE S);
// void __cdecl AIL_set_sample_playback_rate(HSAMPLE S, LONG playback_rate);
// void __cdecl AIL_set_sample_volume(HSAMPLE S, LONG volume);
// void __cdecl AIL_set_sample_loop_count(HSAMPLE S, LONG loop_count);
// ULONG __cdecl AIL_sample_status(HSAMPLE S);
// LONG __cdecl AIL_minimum_sample_buffer_size(HDIGDRIVER dig, LONG playback_rate, LONG format);
// LONG __cdecl AIL_sample_buffer_ready(HSAMPLE S);
// void __cdecl AIL_load_sample_buffer(HSAMPLE S, ULONG buff_num, void *buffer, ULONG len);
// LONG __cdecl AIL_install_MDI_INI();
// HMDIDRIVER __cdecl AIL_install_MDI_driver_file(BYTE *filename, IO_PARMS *IO);
// HSEQUENCE __cdecl AIL_allocate_sequence_handle(HMDIDRIVER mdi);
// void __cdecl AIL_start_sequence(HSEQUENCE S);
// void __cdecl AIL_stop_sequence(HSEQUENCE S);
// void __cdecl AIL_end_sequence(HSEQUENCE S);
// ULONG __cdecl AIL_sequence_status(HSEQUENCE S);
// void __cdecl AIL_set_GTL_filename_prefix(BYTE *prefix);
// __int16 UVB_sub_7501C();
// FILE *__usercall UVB_sub_75098@<eax>(int@<eax>, int@<edx>, int@<ecx>, int@<ebx>, char *, int);
// int sprintf(char *s, const char *format, ...);
// int __fastcall _wcpp_2_dtor_array_store_(int, int);
// void __fastcall operator delete[](void *); weak
// void __fastcall operator delete(void *); weak
// int __fastcall strcmp(const char *s1, const char *s2);
// double __fastcall sqrt(double x);
// void _CHP();
// void *__fastcall memset(void *s, int c, size_t n);
// void __fastcall qsort(void *base, size_t nmemb, size_t size, int (__fastcall *compar)(const void *, const void *));
// int __fastcall _wcpp_2_ctor_array_(_DWORD, _DWORD, _DWORD); weak
// int sscanf(const char *s, const char *format, ...);
// int __fastcall fclose(FILE *fp);
// double __fastcall cos(double x);
// double __fastcall sin(double x);
// double __fastcall tan(double x);
// void *__fastcall operator new[](size_t size);
// int __fastcall _wcpp_2_dtor_array_(_DWORD, _DWORD, _DWORD); weak
// int __fastcall stricmp(const char *s1, const char *s2);
// FILE *__fastcall fdopen(int handle, const char *mode);
// int __fastcall fgetpos(FILE *fp, fpos_t *pos);
// char *__fastcall strncpy(char *s1, const char *s2, size_t n);
// int __fastcall filelength(int handle);
// int open(const char *path, int oflag, ...);
// int __fastcall lseek(int handle, int offset, int origin);
// int __fastcall close(int handle);
// int __fastcall tell(int handle);
// volatile int *__fastcall _get_errno_ptr();
// int __fastcall read(int handle, void *buf, unsigned int len);
// unsigned int __usercall dos_write@<eax>(int handle@<eax>, const void *buf@<ebx>, unsigned int count@<edx>, unsigned int *bytes);
// void __fastcall _assert(int, char *, char *, int);
// int __fastcall write(int handle, const void *buf, unsigned int len);
// FILE *__fastcall fopen(const char *filename, const char *mode);
// int fscanf(FILE *fp, const char *format, ...);
// clock_t clock(void);
// int printf(const char *format, ...);
// int __fastcall atexit(void (*func)(void));
// int getch(void);
// void __fastcall exit(int status);
// int heapchk(void);
// time_t __fastcall time(time_t *timer);
// int rand(void);
// void __fastcall srand(unsigned int seed);
// int __fastcall access(const char *path, int mode);
// char *__fastcall fgets(char *s, int n, FILE *fp);
// int __fastcall _wcpp_2_mod_register_(_DWORD); weak
// int fprintf(FILE *fp, const char *format, ...);
// int __fastcall vsprintf(char *s, const char *format, __va_list arg);
// void *__fastcall malloc(size_t size);
// void *__fastcall calloc(size_t n, size_t size);
// void __fastcall free(void *ptr);
// int __fastcall strnicmp(const char *s1, const char *s2, size_t n);
// int __fastcall atoi(const char *nptr);
// char *__fastcall strdup(const char *string);
// void __fastcall delay(unsigned int milliseconds);
// unsigned int __fastcall dos_getftime(int handle, unsigned __int16 *date, unsigned __int16 *time);
// int __fastcall strncmp(const char *s1, const char *s2, size_t n);
// double __fastcall pow(double x, double y);
// _DWORD __stdcall _wcpp_2_assign_array_(_DWORD); weak
// int __fastcall _wcpp_2_copy_array_(int, int, int, int);
// double __fastcall acos(double x);
// void *__fastcall operator new(size_t size);
// char *__fastcall strupr(char *string);
// int __fastcall heapwalk(struct _heapinfo *entry);
// void *__fastcall memmove(void *s1, const void *s2, size_t n);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN loc_18241; // weak
_UNKNOWN loc_18247; // weak
_UNKNOWN loc_18253; // weak
_UNKNOWN loc_1825F; // weak
_UNKNOWN loc_1829D; // weak
_UNKNOWN locret_1B66C; // weak
_UNKNOWN loc_21D46; // weak
_UNKNOWN loc_21D90; // weak
_UNKNOWN loc_21D96; // weak
_UNKNOWN loc_21DB2; // weak
_UNKNOWN loc_24D98; // weak
_UNKNOWN loc_24D9B; // weak
_UNKNOWN loc_24D9E; // weak
_UNKNOWN loc_24DA4; // weak
_UNKNOWN loc_24DAA; // weak
_UNKNOWN loc_24DAD; // weak
_UNKNOWN loc_27100; // weak
_UNKNOWN loc_27281; // weak
_UNKNOWN loc_272D8; // weak
_UNKNOWN loc_27C93; // weak
_UNKNOWN loc_3067B; // weak
_UNKNOWN loc_306F3; // weak
_UNKNOWN loc_30700; // weak
_UNKNOWN loc_32DCD; // weak
_UNKNOWN loc_32DDA; // weak
_UNKNOWN loc_493DC; // weak
__int16 word_53CEA = 0; // weak
__int16 word_53D02 = 0; // weak
__int16 word_53D06 = 0; // weak
__int16 word_53D0A = 0; // weak
__int16 DMPI_real_mode_segment_base_word_53D0C = 0; // weak
__int16 word_53D0E = 0; // weak
int DMPI_selector_dword_53D1C = 0; // weak
double dbl_9017F = 0.0000152587890625; // weak
double dbl_901BB = 0.3333333333333333; // weak
float flt_901C3 = 0.015625; // weak
float flt_901C7 = 20.0; // weak
float flt_901E5 = 1280.0; // weak
double dbl_9022A = -20.0; // weak
double dbl_90232 = 0.05; // weak
double dbl_9023A = 20.0; // weak
double dbl_90242 = 0.0000152587890625; // weak
float flt_9024A = 0.050000001; // weak
float flt_9026C = -0.039999999; // weak
double dbl_90270 = 0.2; // weak
float flt_90278 = 0.039999999; // weak
float flt_9027C = 2.0; // weak
float flt_90280 = 32.0; // weak
float flt_902A0 = 96.0; // weak
double dbl_902A4 = 3.2; // weak
double dbl_902C8 = 3.2; // weak
float flt_90308 = 0.050000001; // weak
double dbl_9030C = 3.2; // weak
float flt_90314 = 50.0; // weak
float flt_90334 = 0.2; // weak
float flt_90338 = 0.03125; // weak
float flt_9033C = 32.0; // weak
float flt_9034E = -0.039999999; // weak
double dbl_90352 = 0.04; // weak
float flt_903A5 = 0.000015258789; // weak
float flt_903A9 = 0.000015258789; // weak
float flt_903AD = 2.5; // weak
double dbl_903B1 = 0.5; // weak
float flt_903B9 = 2.0; // weak
float flt_90432 = 10.0; // weak
double dbl_90436 = 1.25; // weak
double dbl_9043E = 0.1; // weak
double dbl_90446 = 0.8; // weak
float flt_9045D = 0.00125; // weak
float flt_90461 = 0.0020000001; // weak
float flt_90465 = 0.00125; // weak
float flt_9049E = 0.5; // weak
float flt_904A2 = 16384.0; // weak
float flt_904A6 = 0.125; // weak
float flt_904AA = -1.0; // weak
float flt_904AE = 131072.0; // weak
float flt_904C1 = 0.5; // weak
float flt_904C5 = 0.33333334; // weak
float flt_904C9 = 0.5; // weak
float flt_904CD = 2.0; // weak
float flt_904E0 = 50.0; // weak
float flt_904E4 = -50.0; // weak
float flt_904E8 = 0.0099999998; // weak
float flt_905FA = 32.0; // weak
float flt_90646 = 0.5; // weak
float flt_9064A = 0.03125; // weak
float flt_9064E = 0.0062500001; // weak
float flt_90652 = 960.0; // weak
float flt_90656 = 0.125; // weak
float flt_9065A = -32.0; // weak
float flt_9066D = -440.0; // weak
float flt_907F4 = 0.5; // weak
float flt_90A84 = 0.0011363636; // weak
float flt_90A88 = 1000.0; // weak
float flt_90A8C = 2000.0; // weak
float flt_90AF2 = -200.0; // weak
double dbl_90D6E = 1.5; // weak
double dbl_90D76 = 1.25; // weak
float flt_9103C = 20.0; // weak
float flt_91040 = 60.0; // weak
float flt_91060 = 0.5; // weak
float flt_910EA = -1500.0; // weak
double dbl_91DD9 = 4000000.0; // weak
double dbl_91E43 = 0.95; // weak
float flt_91E91 = -3200.0; // weak
float flt_91E95 = 1280.0; // weak
_UNKNOWN unk_920AA; // weak
float flt_920F0 = 0.050000001; // weak
double dbl_920F4 = 0.6666666666666666; // weak
double dbl_92150 = 6.28318530716; // weak
float flt_92158 = 0.5; // weak
float flt_9215C = 2.0; // weak
float flt_92160 = -0.5; // weak
float flt_92164 = -2.0; // weak
float flt_92168 = -4.0; // weak
float flt_9216C = -6.0; // weak
double dbl_9232C = 1.2; // weak
float flt_92334 = 1440.0; // weak
float flt_92338 = 10000.0; // weak
float flt_9233C = 600.0; // weak
double dbl_9259A = 0.9; // weak
double dbl_925A2 = 2.0; // weak
double dbl_925AA = 0.9; // weak
double dbl_925B2 = 1.6; // weak
double dbl_925BA = 0.85; // weak
double dbl_925C2 = 1.7; // weak
float flt_92658 = 10.0; // weak
double dbl_9265C = 1.25; // weak
double dbl_92664 = 0.1; // weak
double dbl_9266C = 0.8; // weak
_UNKNOWN unk_92696; // weak
float flt_92697 = 0.25; // weak
float flt_9269B = 0.5; // weak
float flt_926DB = -1.0; // weak
double dbl_926EB = 10.0; // weak
double dbl_926F3 = 20.0; // weak
double dbl_9275B = 0.95; // weak
double dbl_92763 = 0.825; // weak
float flt_92777 = 0.0062500001; // weak
float flt_9277B = 32.0; // weak
float flt_9277F = 5.0; // weak
float flt_927BF = 0.33333334; // weak
float flt_927C3 = 2.0; // weak
float flt_927C7 = 0.1; // weak
float flt_927CB = 2.0; // weak
float flt_927E7 = 1600.0; // weak
float flt_928C7 = 2.0; // weak
double dbl_928CB = 0.75; // weak
float flt_928D3 = 64.0; // weak
float flt_928E6 = 2.0; // weak
double dbl_928EA = 0.75; // weak
float flt_92C3A = 0.33333334; // weak
float flt_92C3E = 2.0; // weak
_UNKNOWN unk_92C97; // weak
float flt_92D77 = -1500.0; // weak
double dbl_92DD4 = 0.5; // weak
_UNKNOWN unk_959A4; // weak
int (*off_959B8[5])() = { &sub_10A80, &sub_2CA78, &sub_10B24, &sub_11870, &sub_2CF28 }; // weak
_UNKNOWN unk_959D8; // weak
float flt_959F4 = 0.017453292; // weak
_UNKNOWN unk_95A28; // weak
_UNKNOWN unk_95A3C; // weak
int (*off_95A50[6])() = { &sub_1604C, &sub_2CA78, &sub_16348, &sub_18CA8, &sub_2CF28, &sub_19E2C }; // weak
float flt_95A68 = 0.017453292; // weak
_UNKNOWN unk_95A8C; // weak
_UNKNOWN unk_95AA0; // weak
_UNKNOWN unk_95AB4; // weak
_UNKNOWN unk_95AC8; // weak
_UNKNOWN unk_95ADC; // weak
_UNKNOWN unk_95AF0; // weak
_UNKNOWN unk_95B04; // weak
_UNKNOWN unk_95B34; // weak
_UNKNOWN unk_95B48; // weak
_UNKNOWN unk_95B70; // weak
int (*off_95B84[5])() = { &sub_25CD4, &sub_2CA78, &sub_26000, &sub_25D18, &sub_25FB4 }; // weak
int (*off_95B9C[5])() = { &sub_25C08, &sub_2CA78, &sub_2F424, &sub_25C4C, &sub_2CF28 }; // weak
int (*off_95BB4[2])() = { &sub_22588, &sub_2CA78 }; // weak
_UNKNOWN unk_95C04; // weak
_UNKNOWN unk_95C18; // weak
_UNKNOWN unk_95C2C; // weak
int (*off_95C40[5])() = { &sub_27C08, &sub_2CA78, &sub_27C50, &sub_27D18, &sub_2CF28 }; // weak
int (*off_95C58[5])() = { &sub_2713C, &sub_2CA78, &sub_27184, &sub_271FC, &sub_2CF28 }; // weak
int (*off_95C70[5])() = { &sub_267BC, &sub_2CA78, &sub_270F4, &sub_27124, &sub_2CF28 }; // weak
_UNKNOWN unk_95CA0; // weak
int (*off_95CB4[3])() = { &sub_2AEB0, &sub_2CA78, &sub_2AFF0 }; // weak
_UNKNOWN unk_95D04; // weak
_UNKNOWN unk_95D18; // weak
_UNKNOWN unk_95D2C; // weak
_UNKNOWN unk_95D40; // weak
_UNKNOWN unk_95D54; // weak
_UNKNOWN unk_95D68; // weak
_UNKNOWN unk_95D7C; // weak
int (*off_95D90[5])() = { &sub_2FA34, &sub_2CA78, &sub_2F420, &sub_2FA98, &sub_2CF28 }; // weak
int (*off_95DA8[4])() = { &sub_2F4A8, &sub_2CA78, &sub_2F6B0, &sub_2F540 }; // weak
int (*off_95DC0[5])() = { &sub_2F30C, &sub_2CA78, &sub_2F478, &sub_2F354, &sub_2F414 }; // weak
int (*off_95DD8[5])() = { &sub_2E264, &sub_2CA78, &sub_2E3D4, &sub_2E6C0, &sub_2CF28 }; // weak
int (*off_95DF0[5])() = { &sub_2D9FC, &sub_2DB54, &sub_2DE68, &sub_2E084, &sub_2CF28 }; // weak
int (*off_95E08[5])() = { &sub_2D480, &sub_2CA78, &sub_2D4D0, &sub_2D528, &sub_2D79C }; // weak
int (*off_95E20[5])() = { &sub_2C848, &sub_2CA78, &sub_2F424, &sub_2CD24, &sub_2CF28 }; // weak
_UNKNOWN unk_95E40; // weak
int (*off_95E54[5])() = { &sub_2FC68, &sub_2CA78, &sub_2FD68, &sub_30774, &sub_2CF28 }; // weak
_UNKNOWN unk_95E74; // weak
int (*off_95E88[5])() = { &sub_3121C, &sub_2CA78, &sub_31268, &sub_3160C, &sub_2CF28 }; // weak
_UNKNOWN unk_95EB0; // weak
_UNKNOWN unk_95EC4; // weak
_UNKNOWN unk_95ED8; // weak
int (*off_95EEC[5])() = { &sub_33840, &sub_2CA78, &sub_338DC, &sub_33A68, &sub_2CF28 }; // weak
int (*off_95F04[5])() = { &sub_335B4, &sub_2CA78, &sub_33604, &sub_33674, &sub_2CF28 }; // weak
int (*off_95F1C[5])() = { &sub_32038, &sub_2CA78, &sub_320B8, &sub_32414, &sub_2CF28 }; // weak
_UNKNOWN unk_95F44; // weak
_UNKNOWN unk_95F58; // weak
int (*off_95F6C[5])() = { &sub_395FC, &sub_2CA78, &sub_39644, &sub_396F0, &sub_2CF28 }; // weak
int (*off_95F84[5])() = { &sub_372CC, &sub_2CA78, &sub_37568, &sub_384B0, &sub_2CF28 }; // weak
_UNKNOWN unk_95FA4; // weak
int (*off_95FB8[5])() = { &sub_39D9C, &sub_2CA78, &sub_39E3C, &sub_3A6BC, &sub_2CF28 }; // weak
_UNKNOWN unk_96004; // weak
int (*off_96018[5])() = { &sub_46C48, &sub_2CA78, &sub_47224, &sub_47ABC, &sub_2CF28 }; // weak
_UNKNOWN unk_96038; // weak
_UNKNOWN unk_96068; // weak
int (*off_9607C[5])() = { &sub_4DA08, &sub_2CA78, &sub_4DDB0, &sub_4E758, &sub_2CF28 }; // weak
_UNKNOWN unk_960BC; // weak
_UNKNOWN unk_960D0; // weak
_UNKNOWN unk_960E4; // weak
int (*off_960F8[5])() = { &sub_52108, &sub_2CA78, &sub_5294C, &sub_521C0, &sub_2CF28 }; // weak
int (*off_96110[5])() = { &sub_51B80, &sub_2CA78, &sub_51D24, &sub_51BC4, &sub_2CF28 }; // weak
int (*off_96128[5])() = { &sub_51690, &sub_2CA78, &sub_51894, &sub_516E0, &sub_2CF28 }; // weak
float flt_96144 = 57.29578; // weak
_UNKNOWN unk_9615C; // weak
_UNKNOWN unk_96184; // weak
_UNKNOWN unk_96198; // weak
int (*off_961AC[5])() = { &sub_5A5AC, &sub_2CA78, &sub_5A60C, &sub_5AA08, &sub_2CF28 }; // weak
int (*off_961C4[5])() = { &sub_5B2B0, &sub_2CA78, &sub_2F424, &sub_1240C, &sub_2FC3C }; // weak
int (*off_961DC[5])() = { &sub_5B300, &sub_2CA78, &sub_2F424, &sub_2FBA4, &sub_2FC3C }; // weak
char aDataRacea03Haz[17] = "DATA\\RACEA03.HAZ"; // weak
int off_964E0 = 592479; // idb
_UNKNOWN unk_964E4; // weak
int dword_964EC = 0; // weak
__int16 word_964F0[5] = { 10, 25, 40, 55, 70 };
__int16 word_964FA[13] = { 30, 30, 30, 30, 20, 20, 20, 20, 20, 20, 15, 15, 15 };
__int16 word_96514[13] = { 16, 4, 6, 4, 8, 13, 11, 8, 5, 6, 2, 9, 8 };
__int16 word_9652E[13] = { 6, 6, 6, 6, 4, 4, 4, 4, 4, 4, 3, 3, 3 };
int dword_96548[21] = { 4, 4, 3, 4, 3, 4, 3, 3, 4, 3, 3, 3, 4, 4, 4, 3, 4, 3, 2, 3, 3 }; // weak
int dword_9659C[21] = { 5, 1, 1, 6, 3, 2, 8, 6, 4, 4, 10, 2, 7, 8, 9, 7, 3, 5, 3, 7, 9 }; // weak
char byte_965F8[5] = { '\x05', '\x05', '\x05', '\x0E', '\x0E' }; // weak
int dword_965FD = -33549042; // weak
_DWORD dword_96654[5] = { 0, 0, 0, 0, 0 }; // weak
char s[] = "Thank you for playing Ascendancy."; // idb
_UNKNOWN unk_96768; // weak
int dword_96770 = 0; // weak
int Q_GameLoop_dword_96774 = -1; // weak
char byte_96778 = '\xF3'; // weak
char byte_96779[7] = { '\x13', '\x17', '\x1B', '\x1F', '#', '\'', '+' }; // weak
_UNKNOWN unk_96780; // weak
int dword_96788 = 0; // weak
char V_Romans100[10][5] =
{
  { '\0', '\0', '\0', '\0', '\0' },
  "C",
  "CC",
  "CCC",
  "CD",
  "D",
  "DC",
  "DCC",
  "DCCC",
  "CM"
};
char V_Romans10[10][5] =
{
  { '\0', '\0', '\0', '\0', '\0' },
  "X",
  "XX",
  "XXX",
  "XL",
  "L",
  "LX",
  "LXX",
  "LXXX",
  "XC"
};
char V_Romans1[10][5] =
{
  { '\0', '\0', '\0', '\0', '\0' },
  "I",
  "II",
  "III",
  "IV",
  "V",
  "VI",
  "VII",
  "VIII",
  "IX"
};
__int16 word_9682E[5] = { 207, 297, 252, 207, 297 }; // weak
__int16 word_96838[4] = { 358, 358, 403, 442 }; // weak
int dword_96840 = -65094; // weak
int V_PlanItem50 = 100; // weak
char *off_96850[5] = { "PLRES", "PLIND", "PLPRO", "PLPOP", "PLBUILD" }; // weak
_DWORD dword_96864[2] = { 50397184, 33686273 }; // weak
_UNKNOWN unk_9686C; // weak
_UNKNOWN unk_968A8; // weak
char byte_968DC = '\x01'; // weak
char byte_968DD = '\xFF'; // weak
__int16 word_968E8[21] =
{
  0,
  0,
  0,
  0,
  0,
  60,
  100,
  62,
  77,
  90,
  150,
  140,
  63,
  66,
  72,
  0,
  92,
  100,
  0,
  89,
  68
}; // weak
_UNKNOWN unk_96912; // weak
_UNKNOWN unk_96918; // weak
_UNKNOWN unk_9691E; // weak
_UNKNOWN unk_9696C; // weak
_UNKNOWN unk_96994; // weak
void *off_9699E = (void *)0x50000; // weak
char byte_969A8[] = { '\0' }; // weak
char byte_969B8[16] =
{
  '\x02',
  '\x03',
  '\x03',
  '\x03',
  '\x03',
  '\x03',
  '\x03',
  '\x04',
  '\x05',
  '\x05',
  '\x05',
  '\x05',
  '\x03',
  '\x01',
  '\0',
  '\0'
}; // weak
char byte_969C8[16] =
{
  '\x03',
  '\a',
  '\a',
  '\a',
  '\a',
  '\a',
  '\a',
  '\x0F',
  '\x1F',
  '\x1F',
  '\x1F',
  '\x1F',
  '\a',
  '\x01',
  '\0',
  '\0'
}; // weak
_DWORD dword_969D8[4] = { 70, 170, 240, 410 }; // weak
_UNKNOWN unk_96AC0; // weak
int dword_96AC8 = 0; // weak
int dword_96ACC = -1; // weak
int dword_96AD0 = -1; // weak
_UNKNOWN unk_96AD4; // weak
_UNKNOWN unk_96B08; // weak
int dword_96B10 = 0; // weak
int word_96B2A = -1; // idb
int word_96B2C = 65535; // idb
_UNKNOWN unk_96B30; // weak
__int16 word_96B6C = 6166; // weak
int word_96B6E = -1; // idb
int word_96B70 = -1; // idb
int word_96B72 = 1048575; // idb
_DWORD dword_96B74[5] = { 15, 25, 50, 75, 100 }; // weak
int dword_96B88 = 5; // weak
_UNKNOWN unk_96B8C; // weak
int dword_96B94 = 0; // weak
int dword_96BAC = -1; // weak
__int16 word_96BB0 = -1; // weak
int dword_96BB4 = -1; // weak
int dword_96BB8 = -1; // weak
int dword_96BBC = 1065353216; // weak
int dword_96BC0 = -1; // weak
__int16 word_96BC4[8] = { 243, 19, 27, 31, 23, 39, 35, 15 }; // weak
VFX_DESC *(__cdecl *VFX_describe_driver)() = NULL;
void (__cdecl *VFX_init_driver)() = NULL;
void (__cdecl *VFX_shutdown_driver)() = NULL;
void (__cdecl *VFX_area_wipe)(LONG x0, LONG y0, LONG x1, LONG y1, LONG color) = NULL;
void (__cdecl *VFX_wait_vblank_leading)() = NULL;
void (__cdecl *VFX_window_read)(WINDOW *destination, LONG x0, LONG y0, LONG x1, LONG y1) = NULL;
void (__cdecl *VFX_DAC_read)(LONG color_number, RGB *triplet) = NULL;
void (__cdecl *VFX_DAC_write)(LONG color_number, RGB *triplet) = NULL;
void (__cdecl *VFX_pane_refresh)(PANE *target, LONG x0, LONG y0, LONG x1, LONG y1) = NULL;
void (__cdecl *VFX_line_address)(LONG x, LONG y, UBYTE **addr, ULONG *nbytes) = NULL;
void (__fastcall *MEM_free)(void *ptr) = &free;
int dword_9A234 = 0; // weak
int dword_9A238 = 0; // weak
PANE stru_9A23C = { NULL, 0, 0, 0, 0 }; // idb
int V_CobFilesLoaded = 0; // weak
T_CobFiles V_CobFiles =
{
  {
    {
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0',
      '\0'
    },
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    {  }
  }
};
int dword_A0CF8; // weak
int V_NougatLfExists_dword_A0CFC; // weak
int V_FlashPopExists_dword_A0D00; // weak
T_StaticStrings V_StaticStrings_dword_A0D04;
T_Game V_Game;
__int16 word_D845C; // weak
char byte_D8460[100]; // weak
char byte_D84C4[258]; // weak
int dword_D85C6[]; // weak
__int16 word_D85CA[]; // weak
PANE stru_D85E4; // idb
T_Keyboard V_Keyboard;
T_Mouse V_Mouse;
int dword_D8650; // weak
T_Type6 V_Type6_stru_D8654;
UBYTE V_BigBuffer[94816]; // weak
__int16 word_FFE9E[]; // weak
__int16 word_FFEA0[7]; // weak
__int16 word_FFEAE[7]; // weak
__int16 word_FFEBC[7]; // weak
__int16 word_FFECA[7]; // weak
int word_FFED8; // idb
int word_FFEDA; // idb
int word_FFEDC; // idb
int word_FFEDE; // idb
int word_FFEE0; // idb
int word_FFEE2; // idb
int word_FFEE6; // idb
__int16 word_FFEE8; // weak
int word_FFEEA; // idb
__int16 word_FFEEC; // weak
__int16 word_FFEEE; // weak
__int16 word_FFEF0; // weak
int word_FFEF2; // idb
int word_FFEF4; // idb
int word_FFEF6; // idb
int word_FFEF8; // idb
_UNKNOWN unk_FFF04; // weak
int dword_100302; // weak
int dword_100308; // weak
WINDOW V_Window1; // idb
void *buf; // idb
int dword_100324; // weak
int dword_100328; // weak
void *dword_10032C; // idb
__int16 word_100330; // weak
__int16 word_100332; // weak
char byte_100334; // weak
char byte_100335; // weak
int dword_100338; // weak
int dword_10033C; // weak
char byte_100340[16]; // weak
__int16 word_100350; // weak
_UNKNOWN unk_100744; // weak
_UNKNOWN unk_100EC4; // weak
char byte_101DC4[16]; // weak
_UNKNOWN unk_101DD4; // weak
_UNKNOWN unk_102554; // weak
_UNKNOWN unk_103454; // weak
__int16 word_103F94; // weak
T_PlanetItems V_PlanetItems;
T_PlanetCfg V_PlanetCfg;
int dword_10467C; // weak
char *dword_104680; // idb
int dword_104684[]; // weak
int dword_104688[4]; // weak
int dword_104698[]; // weak
int dword_10469C[10]; // weak
int dword_1046C4[]; // weak
int dword_1046E8[100]; // weak
int dword_104878[100]; // weak
int dword_104A08[100]; // weak
int dword_104B98[]; // weak
int dword_104BC0[9]; // weak
__int16 word_104BE8; // weak
UBYTE byte_104BEA;
int dword_104BEC[100]; // weak
int dword_104D7C[99]; // weak
int dword_104F09; // weak
int dword_104F6D; // weak
int dword_104FD1; // weak
int dword_105035; // weak
int dword_10509C; // weak
int dword_1050A0; // weak
T_Name20 V_SpecNames[21];
int V_Day1; // weak
int V_Day2; // weak
int V_Day3; // weak
int V_ResTreeTxtLoaded; // weak
T_ResTree V_ResTree;
__int16 word_106FB4[7]; // weak
int dword_106FC2; // weak
int dword_106FCC; // weak
int dword_106FD0; // weak
int dword_106FD4; // weak
int dword_106FD8; // weak
int dword_106FDC; // weak
char byte_106FE0[56]; // weak
__int16 word_107018; // weak
int dword_10701C; // weak
T_Gizmos V_Gizmos;
int dword_10906C; // weak
_UNKNOWN unk_109070; // weak
_UNKNOWN unk_109074; // weak
_UNKNOWN unk_109078; // weak
_UNKNOWN unk_10907C; // weak
_UNKNOWN unk_109080; // weak
_UNKNOWN unk_109084; // weak
_UNKNOWN unk_109086; // weak
_UNKNOWN unk_10908A; // weak
_UNKNOWN unk_10908E; // weak
_UNKNOWN unk_109092; // weak
_UNKNOWN unk_109142; // weak
_UNKNOWN unk_109146; // weak
T_SoundSystem V_SoundSystem;
_UNKNOWN unk_109DF8; // weak
int dword_10AE60; // weak
int dword_10AE64; // weak
int dword_10AE68; // weak
int dword_10AE6C; // weak
T_Type3 V_Type3_stru_10AE70;
int dword_132B10; // weak
int dword_132B14; // weak
int dword_132B18; // weak
int dword_132B1C; // weak
char byte_132B20[20]; // weak
int dword_132B34; // weak
char byte_132B38[32]; // weak
int V_Timer_dword_132B58; // weak
int dword_132B5C; // weak
int dword_132B60; // weak
int dword_132B64; // weak


//----- (00010000) --------------------------------------------------------
void __noreturn sub_10000()
{
  while ( 1 )
  {
    __debugbreak();
  }
}
// 10000: using guessed type void __noreturn sub_10000();

//----- (00010010) --------------------------------------------------------
void __fastcall Q_BATCON_CPP_sub_10010(PANE *pane, int a2, int a3, int a4)
{
  void *shapeTable; // eax
  void *shapeTable_1; // ebp
  LONG shapeNumber; // edi
  int v8; // ecx
  const char *v9; // ecx
  LONG *p_x0; // esi
  unsigned __int16 v11; // dx
  void *ShapeTable_sub_1B084; // esi
  int v13; // eax
  PANE *v14; // esi
  const char *v15; // ecx
  void *v16; // ebp
  LONG v17; // ecx
  int v18; // esi
  int v19; // edi
  int v20; // eax
  int v21; // esi
  int v22; // edi
  int v23; // esi
  LONG v24; // edi
  __int16 v25; // si
  int v26; // edx
  int v27; // ebx
  __int16 v28; // [esp-Ch] [ebp-8Ch]
  LONG v29; // [esp-8h] [ebp-88h]
  LONG v30; // [esp-4h] [ebp-84h]
  PANE v31; // [esp+0h] [ebp-80h] BYREF
  int v32[5]; // [esp+14h] [ebp-6Ch]
  int v33[2]; // [esp+28h] [ebp-58h]
  LONG v34[2]; // [esp+30h] [ebp-50h]
  LONG v35[2]; // [esp+38h] [ebp-48h]
  LONG hotX; // [esp+40h] [ebp-40h] BYREF
  LONG hotY; // [esp+44h] [ebp-3Ch] BYREF
  int v38; // [esp+48h] [ebp-38h]
  int v39; // [esp+4Ch] [ebp-34h]
  int v40; // [esp+50h] [ebp-30h]
  int v41; // [esp+54h] [ebp-2Ch]
  int v42; // [esp+58h] [ebp-28h]
  int v43; // [esp+5Ch] [ebp-24h]
  LONG x1; // [esp+60h] [ebp-20h]
  LONG shape_number; // [esp+64h] [ebp-1Ch]
  LONG v46; // [esp+68h] [ebp-18h]
  PANE *panea; // [esp+6Ch] [ebp-14h]
  LONG v48; // [esp+70h] [ebp-10h]
  LONG v49; // [esp+74h] [ebp-Ch]
  PANE *pane_1; // [esp+78h] [ebp-8h]
  PANE *v51; // [esp+7Ch] [ebp-4h]

  pane_1 = pane;
  v42 = 0;
  if ( a4 )
  {
    VFX_pane_wipe(pane, 0x96);
    v42 = 0x96;
  }
  if ( a3 < 0 )
  {
    shapeTable = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                   (unsigned int)&V_Type3_stru_10AE70.t13,
                   (unsigned __int16)word_FFEDA);
    shapeTable_1 = shapeTable;
    if ( !shapeTable )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x46);
    }
    shapeNumber = 5 * *(unsigned __int16 *)(a2 + 0x16) + *(unsigned __int16 *)(a2 + 0x14);
    Q_GSYSTEM_CPP_sub_2BC40(pane_1, shapeTable, shapeNumber, &hotX, &hotY);
    v38 = a2;
    VFX_shape_draw(pane_1, shapeTable_1, shapeNumber, hotX, hotY);
    v8 = *(unsigned __int8 *)(a2 + 0x57);
    v39 = 0xF3;
    if ( v8 != 0xFF )
    {
      Q_WINMGR_CPP_sub_53E38(pane_1, 2, 4, v8);
      v39 = 4 * V_Game.races[*(unsigned __int8 *)(a2 + 0x57)].Unknown_02 + 0x13;
    }
    v28 = v39;
    v9 = (const char *)(v38 + 0x24);
    V_Type3_stru_10AE70.pane.window = pane_1->window;
    p_x0 = &pane_1->x0;
    V_Type3_stru_10AE70.pane.x0 = pane_1->x0;
    V_Type3_stru_10AE70.pane.y0 = *++p_x0;
    V_Type3_stru_10AE70.pane.x1 = *++p_x0;
    V_Type3_stru_10AE70.pane.y1 = p_x0[1];
    sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0x12, 7, v9, 0, v28, 0xFF, 0);
    return;
  }
  v11 = word_FFEBC[*(__int16 *)(a2 + 0x56)];
  v43 = a2;
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, v11);
  if ( !ShapeTable_sub_1B084 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x5C);
  }
  v13 = *(__int16 *)(v43 + 0x56);
  v40 = 0;
  if ( v13 == byte_104BEA || sub_4AAEC(v43, byte_104BEA) > 0 )
  {
    v40 = 0xFFFFFFFF;
  }
  Q_GSYSTEM_CPP_sub_2BC40(pane_1, ShapeTable_sub_1B084, *(char *)(v43 + 0xAA), &hotX, &hotY);
  if ( v40 != 0xFFFFFFFF )
  {
    goto LABEL_25;
  }
  if ( *(int *)(v43 + 0x88) > 0 )
  {
    if ( 4 * *(_DWORD *)(v43 + 0x8C) < *(_DWORD *)(v43 + 0x98) || *(int *)(v43 + 0x8C) < 5 )
    {
      VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[8]);
      VFX_shape_translate_draw(pane_1, ShapeTable_sub_1B084, *(char *)(v43 + 0xAA), hotX, hotY);
      goto LABEL_26;
    }
    if ( !V_Game.races[*(__int16 *)(v43 + 0x56)].Unknown_01 )
    {
      VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[3]);
      VFX_shape_translate_draw(pane_1, ShapeTable_sub_1B084, *(char *)(v43 + 0xAA), hotX, hotY);
      goto LABEL_26;
    }
    if ( V_Game.races[*(__int16 *)(v43 + 0x56)].Unknown_01 != 0xD )
    {
      VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[6]);
      VFX_shape_translate_draw(pane_1, ShapeTable_sub_1B084, *(char *)(v43 + 0xAA), hotX, hotY);
      goto LABEL_26;
    }
LABEL_25:
    VFX_shape_draw(pane_1, ShapeTable_sub_1B084, *(char *)(v43 + 0xAA), hotX, hotY);
    goto LABEL_26;
  }
  VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[0x16]);
  VFX_shape_translate_draw(pane_1, ShapeTable_sub_1B084, *(char *)(v43 + 0xAA), hotX, hotY);
LABEL_26:
  v14 = pane_1;
  Q_WINMGR_CPP_sub_53E38(pane_1, 2, 4, *(_WORD *)(v43 + 0x56));
  v15 = (const char *)(v43 + 0x34);
  V_Type3_stru_10AE70.pane.window = v14->window;
  v14 = (PANE *)((char *)v14 + 4);
  V_Type3_stru_10AE70.pane.x0 = (LONG)v14->window;
  v14 = (PANE *)((char *)v14 + 4);
  V_Type3_stru_10AE70.pane.y0 = (LONG)v14->window;
  v14 = (PANE *)((char *)v14 + 4);
  V_Type3_stru_10AE70.pane.x1 = (LONG)v14->window;
  V_Type3_stru_10AE70.pane.y1 = v14->x0;
  sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0x12, 7, v15, 0, 0xF, 0xFF, 0);
  v16 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEE6);
  if ( !v16 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0xA4);
  }
  if ( v40 == 0xFFFFFFFF )
  {
    v19 = 0x12;
    v18 = 0;
    v41 = sub_4A8CC(v43);
    do
    {
      if ( v18 >= v41 )
      {
        break;
      }
      v17 = v19;
      ++v18;
      v19 += 5;
      sub_53EB8(pane_1, v16, 0, v17, 0x11, *(_WORD *)(v43 + 0x56));
    }
    while ( v18 < 0xA );
    v32[0] = *(_DWORD *)v43;
    v32[1] = *(_DWORD *)(v43 + 4);
    v32[2] = *(_DWORD *)(v43 + 0x10);
    v32[3] = *(_DWORD *)(v43 + 0x20);
    v49 = 0x1F;
    v20 = *(_DWORD *)(v43 + 0x18);
    v46 = 0;
    v32[4] = v20;
    shape_number = 0;
    v31 = *pane_1;
    do
    {
      v31.x1 = v31.x0 + 1;
      v21 = v32[shape_number / 4u];
      v22 = 2;
      if ( v21 > 0 )
      {
        v31.x1 += 8 * v21 / 4;
      }
      v23 = 0;
      v48 = v46 + 1;
      do
      {
        v29 = v22;
        ++v23;
        v22 += 8;
        VFX_shape_draw(&v31, v16, v48, v29, v49);
      }
      while ( v23 < 0xF );
      v49 += 9;
      shape_number += 4;
      ++v46;
    }
    while ( v46 < 5 );
    v33[0] = *(_DWORD *)(v43 + 0x8C);
    v33[1] = *(_DWORD *)(v43 + 0x88);
    v24 = 0x7C;
    v35[0] = *(_DWORD *)(v43 + 0x98);
    panea = 0;
    v35[1] = sub_4A8FC(v43);
    v34[0] = 2;
    v34[1] = 5;
    x1 = 0x82;
    do
    {
      v26 = *(LONG *)((char *)v35 + (_DWORD)panea);
      if ( v26 > 0 )
      {
        v27 = *(int *)((char *)v33 + (_DWORD)panea);
        if ( v27 >= 0 )
        {
          if ( v27 > v26 )
          {
            *(int *)((char *)v33 + (_DWORD)panea) = *(LONG *)((char *)v35 + (_DWORD)panea);
          }
          v25 = 0;
          v51 = panea;
        }
        else
        {
          *(int *)((char *)v33 + (_DWORD)panea) = 0;
          v25 = 0;
          v51 = panea;
        }
        while ( v25 < 9 )
        {
          v30 = 8 * v25++ + 9;
          VFX_shape_draw(pane_1, v16, *(LONG *)((char *)v34 + (_DWORD)v51), v24, v30);
        }
        sub_2BB74(
          pane_1,
          v24,
          8,
          x1,
          0x50 - 0x48 * *(int *)((char *)v33 + (_DWORD)v51) / *(LONG *)((char *)v35 + (_DWORD)v51),
          v42,
          0xFFFFFFFF);
      }
      v24 += 8;
      x1 += 8;
      panea = (PANE *)((char *)panea + 4);
    }
    while ( panea != (PANE *)8 );
  }
}
// FFEBC: using guessed type __int16 word_FFEBC[7];

//----- (00010668) --------------------------------------------------------
void __fastcall Q_BATCON_CPP_sub_10668(PANE *pane, char *a2, int powerState, int a4)
{
  void *shapeTable; // edi
  char *v6; // esi
  UBYTE Unknown_02; // al
  int v8; // eax
  char *text; // eax
  char s[68]; // [esp+0h] [ebp-60h] BYREF
  LONG hotY; // [esp+50h] [ebp-10h] BYREF
  LONG hotX; // [esp+54h] [ebp-Ch] BYREF
  int ps; // [esp+58h] [ebp-8h]
  char *shapeNumber; // [esp+5Ch] [ebp-4h]

  shapeNumber = a2;
  ps = powerState;
  shapeTable = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFED8);
  if ( !shapeTable )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0xEA);
  }
  v6 = shapeNumber;
  if ( a4 && !ps && (V_Gizmos[*shapeNumber].flags & 0x80) == 0 )
  {
    VFX_pane_wipe(pane, 0x96);
  }
  if ( *shapeNumber == (char)0xFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0xFB);
  }
  Q_GSYSTEM_CPP_sub_2BC40(pane, shapeTable, *shapeNumber, &hotX, &hotY);
  if ( ps == 2 || ps == 3 )
  {
    VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[7]);
    VFX_shape_translate_draw(pane, shapeTable, *v6, hotX, hotY);
  }
  else
  {
    VFX_shape_draw(pane, shapeTable, *v6, hotX, hotY);
  }
  if ( *(_DWORD *)(v6 + 3) )
  {
    if ( (V_Gizmos[*v6].flags & 0x20) != 0 )
    {
      sub_2BB74(
        pane,
        1,
        1,
        pane->x1 - pane->x0 - 1,
        pane->y1 - pane->y0 - 1,
        4 * V_Game.races[byte_104BEA].Unknown_02 + 0x13,
        0);
    }
  }
  sprintf(s, "%s", V_Gizmos[*v6].name);
  Unknown_02 = V_Game.races[byte_104BEA].Unknown_02;
  V_Type3_stru_10AE70.pane = *pane;
  sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 5, 2, s, 0, 4 * Unknown_02 + 0x13, 0xFF, 0);
  if ( ps == 2 )
  {
    v8 = 0;                                            // 0: "(depleted)"
  }
  else
  {
    if ( ps != 3 )
    {
      return;
    }
    v8 = 1;                                            // 1: "(insufficient power)"
  }
  text = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v8);
  V_Type3_stru_10AE70.pane = *pane;
  sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 5, 0xC, text, 0, 0xF, 0xFF, 0);
}

//----- (00010878) --------------------------------------------------------
int __fastcall sub_10878(_DWORD *a1, int a2, int a3, int a4)
{
  void *ShapeTable_sub_1B084; // edi
  UBYTE Unknown_02; // al
  int result; // eax
  __int16 v8; // dx
  char *sub_1CEA8; // eax
  char s[80]; // [esp+0h] [ebp-68h] BYREF
  LONG hotX; // [esp+50h] [ebp-18h] BYREF
  LONG hotY; // [esp+54h] [ebp-14h] BYREF
  int v13; // [esp+58h] [ebp-10h]

  v13 = a3;
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           (unsigned __int16)word_FFEDC);
  if ( !ShapeTable_sub_1B084 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x122);
  }
  if ( a4 && !v13 )
  {
    VFX_pane_wipe((PANE *)a1, 0x96);
  }
  Q_GSYSTEM_CPP_sub_2BC40((PANE *)a1, ShapeTable_sub_1B084, *(unsigned __int8 *)(a2 + 1), &hotX, &hotY);
  if ( v13 == 1 )
  {
    VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[7]);
    VFX_shape_translate_draw((PANE *)a1, ShapeTable_sub_1B084, *(unsigned __int8 *)(a2 + 1), hotX, hotY);
  }
  else
  {
    VFX_shape_draw((PANE *)a1, ShapeTable_sub_1B084, *(unsigned __int8 *)(a2 + 1), hotX, hotY);
  }
  sprintf(s, "%s", V_PlanetItems.item[*(unsigned __int8 *)(a2 + 1)].name);
  Unknown_02 = V_Game.races[byte_104BEA].Unknown_02;
  V_Type3_stru_10AE70.pane = *(PANE *)a1;
  result = sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 5, 2, s, 0, 4 * Unknown_02 + 0x13, 0xFF, 0);
  if ( v13 == 1 )
  {
    v8 = 4 * V_Game.races[byte_104BEA].Unknown_02;
    sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0); // 0: "(depleted)"
    V_Type3_stru_10AE70.pane = *(PANE *)a1;
    return sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 5, 0xC, sub_1CEA8, 0, v8 + 0x13, 0xFF, 0);
  }
  return result;
}

//----- (00010A14) --------------------------------------------------------
int __fastcall sub_10A14(int a1, int a2)
{
  int v2; // ecx
  int v3; // esi
  int result; // eax

  v2 = *(_DWORD *)(a1 + 4);
  v3 = *(_DWORD *)(a2 + 4);
  result = 0xFFFFFFFF;
  if ( v2 > v3 )
  {
    return 1;
  }
  if ( v2 == v3 )
  {
    return 0;
  }
  return result;
}

//----- (00010A3C) --------------------------------------------------------
void __fastcall __spoils<> Q_A8_sub_10A3C(P_TypeA8 a1)
{
  Q_A2_sub_2C830(&a1->a2);
  a1->j2 = 0;
  a1->j3 = 0;
  a1->j4 = 0;
  a1->a2.b = (int)off_959B8;
  Q_A8_sub_10AC4(a1);
}
// 959B8: using guessed type int (*off_959B8[5])();

//----- (00010A80) --------------------------------------------------------
int __fastcall sub_10A80(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_959A4);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_959B8;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 959B8: using guessed type int (*off_959B8[5])();

//----- (00010AC4) --------------------------------------------------------
void __fastcall __spoils<> Q_A8_sub_10AC4(P_TypeA8 result)
{
  result->b = 0;
  result->c = 0;
  result->d = 0;
  result->e = 0;
  result->f = 0;
  result->g = 0;
  result->i = 0;
}

//----- (00010B24) --------------------------------------------------------
int __fastcall sub_10B24(int a1, unsigned __int16 a2, int a3, int *a4)
{
  int result; // eax
  T_TypeA1 *Wnd_sub_56DA8; // eax
  T_TypeA1 *v9; // eax
  char *h1; // ebx
  int v11; // eax
  __int16 i; // ax
  int v13; // edx
  int v14; // edx
  int v15; // eax
  char v16; // al
  unsigned __int8 v17; // al
  int v18; // ecx
  char v19; // bh
  int v20; // edx
  int **v21; // edi
  int v22; // eax
  int v23; // edx
  int v24; // eax
  int v25; // ebx
  char v26; // al
  int v27; // eax
  int v28; // edx
  int v29; // eax
  int v30; // eax
  char *v31; // eax
  char *v32; // esi
  T_Gizmo *v33; // eax
  int v34; // edx
  int v35; // edx
  int v36; // eax
  int v37; // edx
  char *v38; // eax
  int v39; // ebx
  char v40; // cl
  int *v41; // ecx
  int v42; // [esp-4h] [ebp-9Ch]
  char v43; // [esp+0h] [ebp-98h] BYREF
  int v44; // [esp+1h] [ebp-97h]
  char v45; // [esp+5h] [ebp-93h]
  int *v46; // [esp+6h] [ebp-92h]
  int v47; // [esp+Ah] [ebp-8Eh]
  int v48; // [esp+Eh] [ebp-8Ah]
  int v49; // [esp+12h] [ebp-86h]
  int v50; // [esp+16h] [ebp-82h]
  int v51; // [esp+1Ah] [ebp-7Eh]
  int v52; // [esp+1Eh] [ebp-7Ah]
  int v53; // [esp+22h] [ebp-76h]
  char v54; // [esp+28h] [ebp-70h]
  int v55; // [esp+29h] [ebp-6Fh]
  char v56; // [esp+2Dh] [ebp-6Bh]
  int v57; // [esp+2Eh] [ebp-6Ah]
  int v58; // [esp+32h] [ebp-66h]
  int v59; // [esp+36h] [ebp-62h]
  int v60; // [esp+3Ah] [ebp-5Eh]
  int v61; // [esp+3Eh] [ebp-5Ah]
  int v62; // [esp+42h] [ebp-56h]
  int v63; // [esp+46h] [ebp-52h]
  int v64; // [esp+4Ah] [ebp-4Eh]
  char v65; // [esp+50h] [ebp-48h]
  int v66; // [esp+51h] [ebp-47h]
  char v67; // [esp+55h] [ebp-43h]
  int *v68; // [esp+56h] [ebp-42h]
  int v69; // [esp+5Ah] [ebp-3Eh]
  int v70; // [esp+5Eh] [ebp-3Ah]
  int v71; // [esp+62h] [ebp-36h]
  int v72; // [esp+66h] [ebp-32h]
  int v73; // [esp+6Ah] [ebp-2Eh]
  int v74; // [esp+6Eh] [ebp-2Ah]
  int v75; // [esp+72h] [ebp-26h]
  int *v76; // [esp+78h] [ebp-20h]
  int *v77; // [esp+7Ch] [ebp-1Ch]
  int *v78; // [esp+80h] [ebp-18h]
  int v79; // [esp+84h] [ebp-14h]
  char v80; // [esp+88h] [ebp-10h]

  v79 = a3;
  if ( a2 < 0x327u )
  {
    if ( a2 >= 0x322u )
    {
      if ( a2 > 0x322u )
      {
        if ( a2 < 0x325u )
        {
          if ( a2 != 0x324 )
          {
            return sub_2F424(a1, a2, v79, (int)a4);
          }
          if ( *(_BYTE *)(a1 + 0xB9) != 1 )
          {
            *(_BYTE *)(a1 + 0xB9) = 1;
            sub_12140(a1);
            (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
          }
          return 0xFFFFFFFF;
        }
        else if ( a2 <= 0x325u )
        {
          if ( *(_BYTE *)(a1 + 0xB9) != 4 )
          {
            *(_BYTE *)(a1 + 0xB9) = 4;
            sub_12140(a1);
            (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
          }
          return 0xFFFFFFFF;
        }
        else
        {
          *(_DWORD *)(a1 + 0xBF) = 0;
          if ( !a3 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x2E1);
          }
          if ( !a4 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x2E2);
          }
          if ( *(_WORD *)(a1 + 0xD4) )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x2E4);
          }
          v40 = *(_BYTE *)(a1 + 0xAB);
          if ( v40 == 3 )
          {
            v47 = 0;
            v48 = 0;
            v49 = 0;
            v51 = 0;
            v52 = 0;
            v50 = 0;
            v43 = 2;
            *(_BYTE *)(*(_DWORD *)(a1 + 0xAC) + 0x5D) = 0;
            v41 = a4;
            if ( *(_BYTE *)(a1 + 0xB0) )
            {
              v43 = 1;
              v44 = *(_DWORD *)(a1 + 0xB1);
              v45 = 0;
              v46 = *(int **)(a1 + 0xAC);
            }
            else
            {
              v43 = 0;
              v80 = v79;
              switch ( (_BYTE)v79 )
              {
                case 5:
                  v45 = 3;
                  v47 = *a4;
                  v48 = a4[1];
                  v49 = a4[2];
                  *(_DWORD *)(a1 + 0xC8) = *a4;
                  v41 = (int *)(a1 + 0xC8);
                  *(_DWORD *)(a1 + 0xCC) = a4[1];
                  *(_DWORD *)(a1 + 0xD0) = a4[2];
                  *(_BYTE *)(*(_DWORD *)(a1 + 0xAC) + 0x5D) = 7;
                  *(_DWORD *)(*(_DWORD *)(a1 + 0xAC) + 0x5E) = 0;
                  break;
                case 2:
                  v46 = a4;
                  v45 = 1;
                  *(_BYTE *)(*(_DWORD *)(a1 + 0xAC) + 0x5D) = 3;
                  *(_DWORD *)(*(_DWORD *)(a1 + 0xAC) + 0x5E) = a4;
                  break;
                case 4:
                  v45 = 2;
                  v46 = a4;
                  *(_BYTE *)(*(_DWORD *)(a1 + 0xAC) + 0x5D) = 1;
                  v22 = *a4;
                  if ( (char *)*a4 == V_Game.h1 )
                  {
                    v22 = a4[1];
                  }
                  *(_DWORD *)(*(_DWORD *)(a1 + 0xAC) + 0x5E) = v22;
                  break;
              }
              v23 = *(_DWORD *)(a1 + 0xAC);
              *(_BYTE *)(v23 + 0x62) = v43;
              *(_DWORD *)(v23 + 0x63) = v44;
              *(_BYTE *)(v23 + 0x67) = v45;
              v23 += 0x62;
              *(_DWORD *)(v23 + 6) = v46;
              *(_DWORD *)(v23 + 0xA) = v47;
              *(_DWORD *)(v23 + 0xE) = v48;
              *(_DWORD *)(v23 + 0x12) = v49;
              *(_DWORD *)(v23 + 0x16) = v50;
              *(_DWORD *)(v23 + 0x1A) = v51;
              *(_DWORD *)(v23 + 0x1E) = v52;
              *(_DWORD *)(v23 + 0x22) = v53;
              sub_49B3C(*(_DWORD *)(a1 + 0xAC), 0);
              v24 = *(_DWORD *)(a1 + 0xAC);
              if ( (*(_BYTE *)(v24 + 0x84) & 8) == 0 )
              {
                *(_DWORD *)(a1 + 0xBF) = v24;
                *(_DWORD *)(a1 + 0xC4) = v41;
                *(_BYTE *)(a1 + 0xC3) = v80;
              }
            }
          }
          else if ( v40 == 2 )
          {
            if ( *(_BYTE *)(a1 + 0xB0) != 2 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x33B);
            }
            if ( (_BYTE)v79 != 3 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x33C);
            }
          }
          *(_BYTE *)(a1 + 0xB9) = 1;
          sub_12140(a1);
          *(_BYTE *)(a1 + 0xB0) = 0;
          v25 = *(_DWORD *)(a1 + 0xA7);
          *(_DWORD *)(a1 + 0xB1) = 0;
          (*(void (__fastcall **)(int, _DWORD))(v25 + 0xC))(a1, 0);
          sub_12674(*(_DWORD *)(a1 + 0xBB));
          return 0;
        }
      }
      v18 = 0;
      v19 = *(_BYTE *)(a1 + 0xAB);
      *(_DWORD *)(a1 + 0xBF) = 0;
      if ( v19 == 3 && (_BYTE)v79 )
      {
        v69 = 0;
        v70 = 0;
        v71 = 0;
        *(_DWORD *)(&v43 + 0xFFFFFFF6 + 0x70) = 0;
        *(_DWORD *)(&v43 + 0xFFFFFFF6 + 0x74) = 0;
        *(_DWORD *)(&v43 + 0xFFFFFFF6 + 0x78) = 0;
        v65 = 1;
        v66 = *(_DWORD *)(a1 + 0xB1);
        v67 = 5;
        if ( (unsigned __int8)v79 < 3u )
        {
          if ( (_BYTE)v79 == 2 )
          {
            v67 = 1;
            v68 = a4;
          }
        }
        else if ( (unsigned __int8)v79 <= 3u )
        {
          v68 = a4;
          v67 = 0;
        }
        else if ( (_BYTE)v79 == 4 && *(_BYTE *)(a1 + 0xB0) == 1 )
        {
          v68 = a4;
          v67 = 2;
        }
        v20 = *(_DWORD *)(a1 + 0xAC);
        *(_BYTE *)(v20 + 0x62) = v65;
        *(_DWORD *)(v20 + 0x63) = v66;
        *(_BYTE *)(v20 + 0x67) = v67;
        v20 += 0x62;
        *(_DWORD *)(v20 + 6) = v68;
        *(_DWORD *)(v20 + 0xA) = v69;
        *(_DWORD *)(v20 + 0xE) = v70;
        *(_DWORD *)(v20 + 0x12) = v71;
        *(_DWORD *)(v20 + 0x16) = v72;
        *(_DWORD *)(v20 + 0x1A) = v73;
        *(_DWORD *)(v20 + 0x1E) = v74;
        *(_DWORD *)(v20 + 0x22) = v75;
        sub_49B3C(*(_DWORD *)(a1 + 0xAC), 0);
        if ( (*(_BYTE *)(*(_DWORD *)(a1 + 0xAC) + 0x84) & 1) == 0 )
        {
          return v18;
        }
      }
      else
      {
        if ( *(_BYTE *)(a1 + 0xAB) != 2 )
        {
          return v18;
        }
        if ( (_BYTE)v79 != 3 )
        {
          return v18;
        }
        v77 = a4;
        v21 = (int **)(*(_DWORD *)(a1 + 0xAC) + 0x6B);
        v76 = *(int **)(a1 + 0xB1);
        *v21++ = v76;
        *v21 = v77;
        v21[1] = v78;
        sub_3676C(*(T_Planet **)(a1 + 0xAC), 0);
        if ( (*(_BYTE *)(*(_DWORD *)(a1 + 0xAC) + 0x73) & 1) == 0 )
        {
          return v18;
        }
      }
      return 0xFFFFFFFF;
    }
    if ( a2 < 0xDu )
    {
      if ( a2 != 1 )
      {
        return sub_2F424(a1, a2, v79, (int)a4);
      }
      Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "BatModeWnd", 0);
      *(_DWORD *)(a1 + 0xBB) = Wnd_sub_56DA8;
      if ( !Wnd_sub_56DA8 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x184);
      }
      v9 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "BatListWnd", 0);
      *(_DWORD *)(a1 + 0xB5) = v9;
      if ( !v9 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x187);
      }
      *(_DWORD *)(*(_DWORD *)(a1 + 0xB5) + 0xAB) = 0;
      sub_2E9CC(*(_DWORD *)(a1 + 0xB5), 0);
      *(_BYTE *)(*(_DWORD *)(a1 + 0xB5) + 0xC5) = 0;
      sub_2ED4C(*(_DWORD *)(a1 + 0xB5));
      *(_DWORD *)(a1 + 0x39) = 0xFFFFFFFF;
      h1 = V_Game.h1;
      *(_DWORD *)(a1 + 0x35) = 0xFFFFFFFF;
      *(_DWORD *)(a1 + 0xBF) = 0;
      sub_1D734((int)h1, a1 + 0xDA);
      *(_WORD *)(a1 + 0xD4) = 0;
      *(_DWORD *)(a1 + 0x104) = 0;
      *(_DWORD *)(a1 + 0xD6) = v11;
      if ( ((1 << byte_104BEA) & ((unsigned __int8)h1[0x15] | (unsigned __int8)h1[0x14])) != 0 )
      {
        *(_BYTE *)(a1 + 0xB9) = 1;
      }
      else
      {
        *(_BYTE *)(a1 + 0xB9) = 4;
      }
      *(_BYTE *)(a1 + 0xBA) = 0;
      for ( i = 0; ; ++i )
      {
        v13 = i;
        if ( i >= *(_DWORD *)(a1 + 0xD6) )
        {
          break;
        }
        *(_DWORD *)(a1 + 4 * v13 + 0xE8) = 0xFFFFFFFF;
      }
      sub_2D258(a1, a2);
      sub_12140(a1);
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
      return 0;
    }
    if ( a2 <= 0xDu )
    {
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
      return 0;
    }
    if ( a2 != 0x320 )
    {
      return sub_2F424(a1, a2, v79, (int)a4);
    }
    *(_BYTE *)(a1 + 0xB0) = 0;
    v16 = v79;
    *(_DWORD *)(a1 + 0xB1) = 0;
    *(_BYTE *)(a1 + 0xAB) = v16;
    v17 = *(_BYTE *)(a1 + 0xAB);
    *(_DWORD *)(a1 + 0xAC) = a4;
    if ( v17 < 2u )
    {
      if ( !v17 )
      {
        *(_BYTE *)(a1 + 0xB9) = 1;
        goto LABEL_55;
      }
    }
    else
    {
      if ( v17 <= 2u )
      {
        *(_BYTE *)(a1 + 0xB9) = 3;
        goto LABEL_55;
      }
      if ( v17 == 3 )
      {
        *(_BYTE *)(a1 + 0xB9) = 2;
        goto LABEL_55;
      }
    }
    Q_AssertLogBreakExit_sub_261A8(0, "..\\batcon.cpp", 0x263);
LABEL_55:
    sub_12140(a1);
    (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
    return 0xFFFFFFFF;
  }
  if ( a2 <= 0x327u )
  {
    if ( *(_BYTE *)(*(_DWORD *)(a1 + 0xBB) + 0xB7) != 4
      && ((1 << byte_104BEA) & (*((unsigned __int8 *)V_Game.h1 + 0x14) | *((unsigned __int8 *)V_Game.h1 + 0x15))) != 0
      && !*(_DWORD *)(a1 + 0x104)
      && !*(_WORD *)(a1 + 0xD4) )
    {
      sub_1229C(a1, 0xFFFFFFFF);
      return 0;
    }
    return 0;
  }
  if ( a2 < 0x32Bu )
  {
    if ( a2 < 0x329u )
    {
      if ( *(_BYTE *)(*(_DWORD *)(a1 + 0xBB) + 0xB7) != 4
        && ((1 << byte_104BEA) & (*((unsigned __int8 *)V_Game.h1 + 0x15) | *((unsigned __int8 *)V_Game.h1 + 0x14))) != 0
        && !*(_DWORD *)(a1 + 0x104)
        && !*(_WORD *)(a1 + 0xD4) )
      {
        *(_WORD *)(a1 + 0xD4) = 0xFFFF;
        *(_DWORD *)(a1 + 0x104) = 0xFFFFFFFF;
        sub_1229C(a1, 0xFFFFFFFF);
        return 0;
      }
    }
    else
    {
      if ( a2 > 0x329u )
      {
        if ( *(_BYTE *)(a1 + 0xBA) )
        {
          *(_BYTE *)(a1 + 0xBA) = 0;
          sub_11BA4(a1);
        }
        return 0xFFFFFFFF;
      }
      if ( *(_BYTE *)(*(_DWORD *)(a1 + 0xBB) + 0xB7) != 4 )
      {
        v14 = *(_DWORD *)(a1 + 0xBF);
        if ( v14 )
        {
          if ( *(_BYTE *)(v14 + 0x58) == 4 && V_Game.h1 == *(char **)(*(_DWORD *)(a1 + 0xBF) + 0x59) )
          {
            *(_BYTE *)(a1 + 0xAB) = 3;
            *(_BYTE *)(a1 + 0xB0) = 0;
            v15 = *(_DWORD *)(a1 + 0xBF);
            *(_DWORD *)(a1 + 0xB1) = 0;
            *(_DWORD *)(a1 + 0xAC) = v15;
            (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 8))();
            return 0;
          }
        }
      }
    }
    return 0;
  }
  if ( a2 <= 0x32Bu )
  {
    if ( *(_BYTE *)(a1 + 0xBA) != 1 )
    {
      *(_BYTE *)(a1 + 0xBA) = 1;
      sub_11BA4(a1);
    }
    return 0xFFFFFFFF;
  }
  if ( a2 < 0x32Du )
  {
    if ( *(_BYTE *)(a1 + 0xBA) != 4 )
    {
      *(_BYTE *)(a1 + 0xBA) = 4;
      sub_11BA4(a1);
    }
    return 0xFFFFFFFF;
  }
  if ( a2 <= 0x32Du )
  {
    if ( *(_BYTE *)(a1 + 0xBA) != 5 )
    {
      *(_BYTE *)(a1 + 0xBA) = 5;
      sub_11BA4(a1);
    }
    return 0xFFFFFFFF;
  }
  if ( a2 < 0x1C01u )
  {
    return sub_2F424(a1, a2, v79, (int)a4);
  }
  if ( a2 <= 0x1C01u )
  {
    if ( *(_BYTE *)(*(_DWORD *)(a1 + 0xBB) + 0xB7) != 4 )
    {
      v26 = *(_BYTE *)(a1 + 0xB9) - 1;
      *(_DWORD *)(a1 + 0xBF) = 0;
      switch ( v26 )
      {
        case 0:
        case 3:
          if ( a4 == (int *)4 )
          {
            if ( sub_2ECA4(*(_DWORD *)(a1 + 0xB5), v79) >= 0 )
            {
              *(_BYTE *)(a1 + 0xAB) = 3;
              *(_BYTE *)(a1 + 0xB9) = 2;
            }
            else
            {
              *(_BYTE *)(a1 + 0xAB) = 2;
              *(_BYTE *)(a1 + 0xB9) = 3;
            }
            sub_12140(a1);
            v27 = sub_2ED14(*(_DWORD *)(a1 + 0xB5), v79);
            v42 = 0;
            v28 = *(_DWORD *)(a1 + 0xBB);
            *(_DWORD *)(a1 + 0xAC) = v27;
            sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v28 + 0x41), 0x53, 0, v42);
            (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
            result = 0xFFFFFFFF;
          }
          else
          {
            v29 = sub_2ED14(*(_DWORD *)(a1 + 0xB5), v79);
            v30 = sub_12AE4(*(_DWORD *)(a1 + 0xBB), v29);
            if ( !v30 )
            {
              return 0xFFFFFFFF;
            }
            sub_17E88(*(_DWORD *)(a1 + 0xBB), v30);
            sub_18C2C(*(_DWORD *)(a1 + 0xBB), 0);
            result = 0xFFFFFFFF;
          }
          break;
        case 1:
          if ( sub_2ECA4(*(_DWORD *)(a1 + 0xB5), v79) )
          {
            return 0xFFFFFFFF;
          }
          v31 = (char *)sub_2ED14(*(_DWORD *)(a1 + 0xB5), v79);
          v32 = v31;
          if ( *v31 == (char)0xFF )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x39C);
          }
          v33 = &V_Gizmos[*v31];
          if ( (v33->flags & 0x80) != 0 )
          {
            return 0xFFFFFFFF;
          }
          v34 = v33->flags & 0x20;
          if ( (_BYTE)v34 )
          {
            sub_49A8C(*(_DWORD *)(a1 + 0xAC), v32);
          }
          else
          {
            *(_BYTE *)(a1 + 0xB0) = 1;
            *(_DWORD *)(a1 + 0xB1) = v32;
            if ( (v33->flags & 0x40) != 0 )
            {
              v58 = v34;
              v59 = v34;
              v60 = v34;
              v61 = v34;
              v62 = v34;
              v63 = v34;
              v54 = 1;
              v55 = *(_DWORD *)(a1 + 0xB1);
              v56 = 5;
              v35 = *(_DWORD *)(a1 + 0xAC) + 0x62;
              *(_BYTE *)v35 = 1;
              *(_DWORD *)(v35 + 1) = v55;
              *(_BYTE *)(v35 + 5) = v56;
              *(_DWORD *)(v35 + 6) = v57;
              *(_DWORD *)(v35 + 0xA) = v58;
              *(_DWORD *)(v35 + 0xE) = v59;
              *(_DWORD *)(v35 + 0x12) = v60;
              *(_DWORD *)(v35 + 0x16) = v61;
              *(_DWORD *)(v35 + 0x1A) = v62;
              *(_DWORD *)(v35 + 0x1E) = v63;
              *(_DWORD *)(v35 + 0x22) = v64;
              *(_BYTE *)(a1 + 0xB0) = 0;
              *(_DWORD *)(a1 + 0xB1) = 0;
              *(_BYTE *)(a1 + 0xB9) = 1;
              sub_12140(a1);
              sub_12674(*(_DWORD *)(a1 + 0xBB));
            }
            else
            {
              sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(*(_DWORD *)(a1 + 0xBB) + 0x41), 0x51, 0, v34);
            }
          }
          (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
          return 0xFFFFFFFF;
        case 2:
          if ( sub_2ECA4(*(_DWORD *)(a1 + 0xB5), v79) )
          {
            return 0xFFFFFFFF;
          }
          v36 = sub_2ED14(*(_DWORD *)(a1 + 0xB5), v79);
          v42 = 0;
          *(_BYTE *)(a1 + 0xB0) = 2;
          v37 = *(_DWORD *)(a1 + 0xBB);
          *(_DWORD *)(a1 + 0xB1) = v36;
          sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v37 + 0x41), 0x51, 0, v42);
          return 0xFFFFFFFF;
        default:
          return 0xFFFFFFFF;
      }
      return result;
    }
    return 0;
  }
  if ( a2 != 0x1C02 )
  {
    return sub_2F424(a1, a2, v79, (int)a4);
  }
  switch ( *(_BYTE *)(a1 + 0xB9) )
  {
    case 2:
      v38 = (char *)sub_2ED14(*(_DWORD *)(a1 + 0xB5), v79);
      sub_56B60(&V_Type3_stru_10AE70, 5, *v38, 4);
      result = 0xFFFFFFFF;
      break;
    case 3:
      v39 = *(unsigned __int8 *)(sub_2ED14(*(_DWORD *)(a1 + 0xB5), v79) + 1);
      sub_56B60(&V_Type3_stru_10AE70, 5, v39, 5);
      goto LABEL_122;
    default:
LABEL_122:
      result = 0xFFFFFFFF;
      break;
  }
  return result;
}
// 10C71: variable 'v11' is possibly undefined

//----- (00011870) --------------------------------------------------------
void __fastcall sub_11870(int a1, int a2)
{
  LONG v3; // esi
  char v4; // ah
  int v5; // esi
  int v6; // edx
  int v7; // ebx
  void *ShapeTable_sub_1B084; // eax
  char v9; // bl
  void *v10; // eax
  __int16 v11; // ax
  unsigned __int8 v12; // cl
  LONG v13; // [esp-20h] [ebp-A0h]
  char s[40]; // [esp+0h] [ebp-80h] BYREF
  PANE pane3; // [esp+28h] [ebp-58h] BYREF
  PANE pane2; // [esp+3Ch] [ebp-44h] BYREF
  PANE pane1; // [esp+50h] [ebp-30h] BYREF
  __int16 v18; // [esp+64h] [ebp-1Ch]
  __int16 v19; // [esp+68h] [ebp-18h]

  if ( a2 != 0x1C01 )
  {
    sub_11BA4(a1);
  }
  pane1.window = *(WINDOW **)(a1 + 4);
  pane1.x0 = 466;
  pane1.y0 = 0;
  pane1.x1 = 639;
  pane1.y1 = 141;
  VFX_pane_wipe(&pane1, 0);
  v3 = 0xA;
  v4 = *(_BYTE *)(a1 + 0xB9);
  if ( v4 == 2 || v4 == 3 )
  {
    v5 = *(_DWORD *)(a1 + 0xB5) + 4;
    pane3.window = *(WINDOW **)v5;
    v5 += 4;
    pane3.x0 = *(_DWORD *)v5;
    v5 += 4;
    pane3.y0 = *(_DWORD *)v5;
    v5 += 4;
    pane3.x1 = *(_DWORD *)v5;
    pane3.y1 = *(_DWORD *)(v5 + 4);
    pane3.y0 = 7;
    pane3.y1 = *(unsigned __int16 *)(*(_DWORD *)(a1 + 0xB5) + 0x8C9) + 8;
    if ( *(_BYTE *)(a1 + 0xB9) == 2 )
    {
      v6 = *(_DWORD *)(a1 + 0xAC);
      v7 = 0;
      v3 = 0xB;
    }
    else
    {
      v7 = 0xFFFFFFFF;
      v6 = *(_DWORD *)(a1 + 0xAC);
      v3 = 0x13;
    }
    Q_BATCON_CPP_sub_10010(&pane3, v6, v7, 0);
  }
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           *(unsigned __int16 *)(a1 + 0x18));
  VFX_shape_draw(&pane1, ShapeTable_sub_1B084, v3, 0, 0);
  sub_2D218((_DWORD *)a1);
  sub_552CC(&V_Type3_stru_10AE70, &pane1);
  v9 = *(_BYTE *)(a1 + 0xB9);
  if ( v9 == 1 || v9 == 4 )
  {
    pane2.window = *(WINDOW **)(a1 + 4);
    pane2.x0 = 0x1DA;
    pane2.y0 = 7;
    pane2.x1 = 0x278;
    pane2.y1 = 0x25;
    v13 = *(_DWORD *)V_Game.h1;
    v10 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
            (unsigned int)&V_Type3_stru_10AE70.t13,
            *(unsigned __int16 *)(*(_DWORD *)(a1 + 0xBB) + 0x19C8));
    VFX_shape_transform(&pane2, v10, v13, 0xF, 0xF, V_BigBuffer, 0, 0x3333, 0x3333, 0);
    v11 = 0;
    v19 = 0xF3;
    v18 = 0xFFFF;
    if ( V_Game.racesNum > 0 )
    {
      while ( 1 )
      {
        if ( *(_DWORD *)V_Game.races[v11].z != 0xFFFFFFFF )
        {
          v12 = V_Game.h1[0x14];
          if ( v12 )
          {
            if ( ((1 << v11) | v12) == 1 << v11
              || V_Game.h1 == (char *)V_Game.races[v11].star && ((1 << v11) & v12) != 0 )
            {
              break;
            }
          }
        }
        if ( ++v11 >= V_Game.racesNum )
        {
          goto LABEL_20;
        }
      }
      v18 = v11;
    }
LABEL_20:
    if ( v18 != 0xFFFFFFFF )
    {
      v19 = 4 * V_Game.races[v11].Unknown_02 + 0x13;
      Q_WINMGR_CPP_sub_53E38(&pane2, 0x8D, 3, v11);
    }
    sprintf(s, "%s", (const char *)V_Game.h1 + 0x1C);
    *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = pane2;
    sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0x28, 5, s, 0, v19, 0xFF, 0x6C);
    sprintf(s, "%s", &byte_D84C4[0x14 * *(_DWORD *)V_Game.h1]);
    V_Type3_stru_10AE70.pane = pane2;
    sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0x28, 0x12, s, 0, 0xF3, 0xFF, 0x6C);
    sub_552CC(&V_Type3_stru_10AE70, &pane2);
  }
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// 11870: using guessed type _DWORD pane3[2];

//----- (00011BA4) --------------------------------------------------------
int __fastcall sub_11BA4(int a1)
{
  int v2; // ebp
  int v3; // edi
  unsigned __int16 v4; // ax
  __int16 i; // di
  int v6; // edx
  unsigned __int16 v7; // ax
  char *v9; // edi
  int v10; // ebx
  char cat; // ah
  int v12; // ebp
  char v13; // al
  T_Gizmo *v14; // ebp
  unsigned __int16 v15; // dx
  T_Planet *v16; // edi
  int v17; // edx
  int v18; // ebp
  __int16 v19; // di
  int v20; // ebp
  int v21; // edx
  unsigned __int16 v22; // ax
  __int16 k; // di
  int v24; // edx
  unsigned __int16 v25; // ax
  int v26[107]; // [esp+0h] [ebp-39Ch] BYREF
  int v27[107]; // [esp+1ACh] [ebp-1F0h] BYREF
  int v28; // [esp+358h] [ebp-44h]
  int v29; // [esp+35Ch] [ebp-40h]
  int a3; // [esp+360h] [ebp-3Ch] BYREF
  int a4; // [esp+364h] [ebp-38h] BYREF
  int result; // [esp+368h] [ebp-34h] BYREF
  int result_4; // [esp+36Ch] [ebp-30h]
  int v34; // [esp+370h] [ebp-2Ch]
  int v35; // [esp+374h] [ebp-28h]
  int v36; // [esp+378h] [ebp-24h]
  __int16 v37; // [esp+37Ch] [ebp-20h]
  __int16 j; // [esp+380h] [ebp-1Ch]

  sub_2ED4C(*(_DWORD *)(a1 + 0xB5));
  switch ( *(_BYTE *)(a1 + 0xB9) )
  {
    case 1:
      *(_WORD *)(*(_DWORD *)(a1 + 0xB5) + 0x8C9) = 0x54;
      sub_2F1C8(*(_DWORD *)(a1 + 0xB5), (int)Q_BATCON_CPP_sub_10010);
      v37 = 0;
      v2 = sub_1D794((__int16 *)V_Game.h1, v26);
      while ( v37 < v2 )
      {
        v3 = v26[v37];
        if ( *(_BYTE *)(v3 + 0x58) == 4 )
        {
          if ( *(__int16 *)(v3 + 0x56) >= 7 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x4AC);
          }
          if ( *(_WORD *)(v3 + 0x56) == byte_104BEA )
          {
            v4 = sub_2EA8C(*(_DWORD *)(a1 + 0xB5), (const char *)v26[v37], 0xFFFFFFFF, 0);
            sub_2EC50(*(_DWORD *)(a1 + 0xB5), v4, v37);
          }
        }
        ++v37;
      }
      for ( i = 0; i < *((__int16 *)V_Game.h1 + 0x2D); ++i )
      {
        v6 = *(_DWORD *)&V_Game.h1[4 * i + 0x46];
        if ( *(_BYTE *)(v6 + 0x57) == byte_104BEA )
        {
          v7 = sub_2EA8C(*(_DWORD *)(a1 + 0xB5), (const char *)v6, 0xFFFFFFFF, 0);
          sub_2EC50(*(_DWORD *)(a1 + 0xB5), v7, i | 0x80000000);
        }
      }
      goto LABEL_15;
    case 2:
      if ( *(_BYTE *)(a1 + 0xAB) != 3 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x4D8);
      }
      if ( !*(_DWORD *)(a1 + 0xAC) )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x4D9);
      }
      *(_WORD *)(*(_DWORD *)(a1 + 0xB5) + 0x8C9) = 0x54;
      sub_2F1C8(*(_DWORD *)(a1 + 0xB5), (int)Q_BATCON_CPP_sub_10668);
      result_4 = *(_DWORD *)(a1 + 0xAC);
      v29 = *(_DWORD *)(result_4 + 0x88);
      if ( *(_WORD *)(result_4 + 0x56) == byte_104BEA || sub_4AAEC(result_4, byte_104BEA) == 2 )
      {
        v9 = (char *)(result_4 + 0xAB);
        LOWORD(v36) = 0;
        while ( (__int16)v36 < *(_DWORD *)(result_4 + 0x15A) )
        {
          if ( *v9 != (char)0xFF )
          {
            if ( (v12 = *v9, v13 = V_Gizmos[v12].cat, v14 = &V_Gizmos[v12], v13 == *(_BYTE *)(a1 + 0xBA))
              && (v14->flags & 0x80) == 0
              || *(_BYTE *)(a1 + 0xBA) == 4 && (v14->flags & 0x80) != 0 )
            {
              v15 = sub_2EA8C(*(_DWORD *)(a1 + 0xB5), v9, 0xFFFFFFFF, 0);
              v28 = *(__int16 *)(result_4 + 0x56);
              v10 = 0;
              if ( byte_104BEA == v28 )
              {
                if ( (v14->flags & 0x20) == 0 )
                {
                  if ( !v14->numUses || *(_WORD *)(v9 + 1) )
                  {
                    if ( v29 < v14->power )
                    {
                      v10 = 3;
                    }
                  }
                  else
                  {
                    v10 = 2;
                  }
                }
              }
              else
              {
                v10 = 1;
              }
              if ( (v14->flags & 0x80) != 0 )
              {
                v10 = *v9 + 0x1F4;
              }
              cat = v14->cat;
              if ( cat == 2 )
              {
                v10 = *v9 + 0x258;
              }
              else if ( cat == 4 )
              {
                v10 = *v9 + 0x2BC;
              }
              sub_2EC50(*(_DWORD *)(a1 + 0xB5), v15, v10);
            }
          }
          v9 += 7;
          LOWORD(v36) = v36 + 1;
        }
      }
      goto LABEL_15;
    case 3:
      *(_WORD *)(*(_DWORD *)(a1 + 0xB5) + 0x8C9) = 0x54;
      sub_2F1C8(*(_DWORD *)(a1 + 0xB5), (int)sub_10878);
      v16 = *(T_Planet **)(a1 + 0xAC);
      if ( *(_BYTE *)(a1 + 0xAB) != 2 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x51F);
      }
      if ( !v16 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x520);
      }
      if ( byte_104BEA == v16->byte57 )
      {
        for ( j = 0; j < (int)v16->word1A; ++j )
        {
          v17 = (int)v16->a + 4 * j;
          v34 = 4 * j;
          v18 = 0;
          if ( (*(_WORD *)(v17 + 2) & 1) != 0 && (V_PlanetItems.item[*(unsigned __int8 *)(v17 + 1)].flags & 4) != 0 )
          {
            v35 = sub_2EA8C(*(_DWORD *)(a1 + 0xB5), (const char *)v17, 0xFFFFFFFF, 0);
            sub_366C8(v16, *((_BYTE *)v16->a + v34 + 1), &a3, &a4, &result);
            if ( result && !((int)*(unsigned __int16 *)((char *)v16->a + v34 + 2) >> 8) )
            {
              v18 = 1;
            }
            sub_2EC50(*(_DWORD *)(a1 + 0xB5), v35, v18);
          }
        }
      }
      goto LABEL_15;
    case 4:
      *(_WORD *)(*(_DWORD *)(a1 + 0xB5) + 0x8C9) = 0x54;
      sub_2F1C8(*(_DWORD *)(a1 + 0xB5), (int)Q_BATCON_CPP_sub_10010);
      v19 = 0;
      v20 = sub_1D794((__int16 *)V_Game.h1, v27);
      while ( v19 < v20 )
      {
        v21 = v27[v19];
        if ( *(_BYTE *)(v21 + 0x58) == 4 && *(_WORD *)(v21 + 0x56) != byte_104BEA )
        {
          v22 = sub_2EA8C(*(_DWORD *)(a1 + 0xB5), (const char *)v21, 0xFFFFFFFF, 0);
          sub_2EC50(*(_DWORD *)(a1 + 0xB5), v22, v19);
        }
        ++v19;
      }
      for ( k = 0; k < *((__int16 *)V_Game.h1 + 0x2D); ++k )
      {
        v24 = *(_DWORD *)&V_Game.h1[4 * k + 0x46];
        if ( byte_104BEA != *(_BYTE *)(v24 + 0x57) )
        {
          v25 = sub_2EA8C(*(_DWORD *)(a1 + 0xB5), (const char *)v24, 0xFFFFFFFF, 0);
          sub_2EC50(*(_DWORD *)(a1 + 0xB5), v25, k | 0x80000000);
        }
      }
LABEL_15:
      sub_2F1D8(*(_DWORD *)(a1 + 0xB5), (int)sub_10A14);
      sub_2F1E0(*(_DWORD *)(a1 + 0xB5));
      break;
    default:
      return (*(int (**)(void))(*(_DWORD *)(*(_DWORD *)(a1 + 0xB5) + 0xA7) + 0xC))();
  }
  return (*(int (**)(void))(*(_DWORD *)(*(_DWORD *)(a1 + 0xB5) + 0xA7) + 0xC))();
}
// 11BA4: using guessed type int var_39C[107];
// 11BA4: using guessed type int var_1F0[107];

//----- (00012140) --------------------------------------------------------
int __fastcall sub_12140(int a1)
{
  __int16 i; // si
  unsigned int v3; // edx
  char v4; // ah
  __int16 j; // bx
  int v6; // eax
  int result; // eax
  int v8; // eax
  unsigned int v9; // [esp+4h] [ebp-1Ch]

  for ( i = 0; i < *(__int16 *)(a1 + 0x6B); ++i )
  {
    if ( !strcmp((const char *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * i) + 0x20), "My^Items") )
    {
      break;
    }
  }
  if ( i >= *(__int16 *)(a1 + 0x6B) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batcon.cpp", 0x58C);
  }
  v3 = 0xFFFFFFFF;
  v4 = *(_BYTE *)(a1 + 0xB9);
  v9 = 0;
  if ( v4 == 2 )
  {
    v3 = 0;
  }
  else if ( v4 == 3 )
  {
    v9 = 0xFFFFFFFF;
  }
  for ( j = 0; ; ++j )
  {
    result = j;
    if ( j >= 9 )
    {
      break;
    }
    if ( v9 )
    {
      v6 = i + j;
      *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * v6) + 0x35) = 0;
      *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * v6) + 0x39) = 0;
    }
    else
    {
      v8 = i + j;
      if ( j >= 5 )
      {
        *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * v8) + 0x35) = ~v3;
        *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * v8) + 0x39) = ~v3;
      }
      else
      {
        *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * v8) + 0x35) = v3;
        *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * v8) + 0x39) = v3;
      }
    }
  }
  return result;
}

//----- (00012238) --------------------------------------------------------
void __fastcall sub_12238(int a1, int a2)
{
  if ( *(_BYTE *)(a1 + 0xAB) == 3 )
  {
    sub_49B3C(*(_DWORD *)(a1 + 0xAC), 1);
  }
  else if ( *(_BYTE *)(a1 + 0xAB) == 2 )
  {
    sub_3676C(*(T_Planet **)(a1 + 0xAC), 1);
  }
  *(_BYTE *)(a1 + 0xAB) = 0;
  *(_DWORD *)(a1 + 0xAC) = 0;
  if ( a2 == 0xFFFFFFFF )
  {
    sub_11BA4(a1);
  }
  sub_1229C(a1, a2);
}

//----- (0001229C) --------------------------------------------------------
void __fastcall sub_1229C(int a1, int a2)
{
  __int16 *h1; // esi
  _BYTE v4[5]; // [esp+0h] [ebp-1Ch] BYREF

  h1 = (__int16 *)V_Game.h1;
  while ( (__int16)++*(_WORD *)(a1 + 0xD4) < *(_DWORD *)(a1 + 0xD6) || sub_12368(a1, a2) )
  {
    v4[0] = 0;
    *(_DWORD *)(a1 + 4 * *(__int16 *)(a1 + 0xD4) + 0xE8) = sub_406C4(
                                                             &V_Game.races[*(__int16 *)(a1
                                                                                      + 2 * *(__int16 *)(a1 + 0xD4)
                                                                                      + 0xDA)].Unknown_00,
                                                             h1,
                                                             (int)v4);
    if ( v4[0] )
    {
      *(_DWORD *)(a1 + 0xAB) = *(_DWORD *)v4;
      *(_BYTE *)(a1 + 0xAF) = v4[4];
      if ( v4[0] == 3 )
      {
        sub_49B3C(*(int *)&v4[1], 0);
      }
      else
      {
        sub_3676C(*(T_Planet **)&v4[1], 0);
      }
      if ( a2 == 0xFFFFFFFF )
      {
        sub_12674(*(_DWORD *)(a1 + 0xBB));
      }
      else
      {
        sub_12238(a1, a2);
      }
      return;
    }
  }
}

//----- (00012368) --------------------------------------------------------
unsigned int __fastcall sub_12368(int a1, int a2)
{
  __int16 *h1; // esi
  unsigned int v4; // edi
  __int16 i; // ax
  char *v6; // eax
  __int16 v7; // cx
  int v8; // eax
  T_Race *v9; // eax

  h1 = (__int16 *)V_Game.h1;
  v4 = 0;
  if ( *(_DWORD *)(a1 + 0x104) == 0xFFFFFFFF )
  {
    for ( i = 0; i < *(_DWORD *)(a1 + 0xD6); ++i )
    {
      if ( *(_DWORD *)(a1 + 4 * i + 0xE8) == 0xFFFFFFFF )
      {
        v4 = 0xFFFFFFFF;
        break;
      }
    }
  }
  v6 = V_Game.h1;
  *(_DWORD *)(a1 + 0x104) = v4;
  sub_1D734((int)v6, a1 + 0xDA);
  *(_WORD *)(a1 + 0xD4) = 0;
  v7 = 0;
  *(_DWORD *)(a1 + 0xD6) = v8;
  while ( v7 < *(_DWORD *)(a1 + 0xD6) )
  {
    v9 = &V_Game.races[*(__int16 *)(a1 + 2 * v7++ + 0xDA)];
    sub_3B56C(&v9->Unknown_00, h1);
  }
  if ( a2 == 0xFFFFFFFF )
  {
    (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
  }
  return v4;
}
// 123C0: variable 'v8' is possibly undefined

//----- (0001240C) --------------------------------------------------------
void __fastcall sub_1240C(int a1, int a2)
{
  sub_2FBA4(a1, a2);
  Q_WINMGR_CPP_sub_53E38((PANE *)(a1 + 4), 3, 3, byte_104BEA);
}

//----- (00012440) --------------------------------------------------------
char *__fastcall sub_12440(int a1)
{
  _DWORD *v1; // eax

  v1 = (_DWORD *)(a1 + 0xA);
  *v1 = 0;
  v1 += 3;
  v1[0xFFFFFFFE] = 0;
  v1[0xFFFFFFFF] = 0;
  v1[1] = 0;
  v1[2] = 0;
  *v1 = 0;
  return (char *)v1 + 0xFFFFFFEA;
}

//----- (00012480) --------------------------------------------------------
int __fastcall sub_12480(float *a1, float *a2, float a3)
{
  double v6; // st7
  double v7; // st7
  float v9; // [esp+8h] [ebp-80h] BYREF
  float v10; // [esp+Ch] [ebp-7Ch]
  float v11; // [esp+10h] [ebp-78h]
  float v12; // [esp+14h] [ebp-74h] BYREF
  float v13; // [esp+18h] [ebp-70h]
  float v14; // [esp+1Ch] [ebp-6Ch]
  int v15[3]; // [esp+20h] [ebp-68h] BYREF
  float v16; // [esp+2Ch] [ebp-5Ch]
  int v17; // [esp+30h] [ebp-58h]
  int v18; // [esp+34h] [ebp-54h]
  float v19; // [esp+38h] [ebp-50h]
  float v20; // [esp+3Ch] [ebp-4Ch]
  float v21; // [esp+40h] [ebp-48h]
  int v22[3]; // [esp+44h] [ebp-44h] BYREF
  float v23; // [esp+50h] [ebp-38h]
  float v24; // [esp+54h] [ebp-34h]
  float v25; // [esp+58h] [ebp-30h]
  float v26; // [esp+5Ch] [ebp-2Ch]
  int v27; // [esp+60h] [ebp-28h]
  int v28; // [esp+64h] [ebp-24h]
  int *v29; // [esp+68h] [ebp-20h]
  float *v30; // [esp+6Ch] [ebp-1Ch]
  int *v31; // [esp+70h] [ebp-18h]
  float *v32; // [esp+74h] [ebp-14h]
  float v33; // [esp+7Ch] [ebp-Ch]

  v30 = &v12;
  v23 = 0.0;
  v24 = 0.0;
  v25 = 0.0;
  v23 = *a2 - *a1;
  v24 = a2[1] - a1[1];
  v25 = a2[2] - a1[2];
  v12 = v23;
  v13 = v24;
  v14 = v25;
  v33 = sqrt(v24 * v24 + v23 * v23 + v25 * v25);
  if ( a3 >= (double)v33 )
  {
    *a1 = *a2;
    a1[1] = a2[1];
    a1[2] = a2[2];
    return 0xFFFFFFFF;
  }
  else
  {
    v26 = v12 * a3;
    *(float *)&v27 = v13 * a3;
    *(float *)&v28 = a3 * v14;
    v6 = 1.0 / v33;
    v29 = v22;
    *(float *)v22 = v26;
    v22[1] = v27;
    v22[2] = v28;
    v16 = v26 * v6;
    v31 = v15;
    *(float *)&v17 = *(float *)&v27 * v6;
    *(float *)v15 = v16;
    v19 = 0.0;
    v15[1] = v17;
    *(float *)&v18 = v6 * *(float *)&v28;
    v20 = 0.0;
    v15[2] = v18;
    v21 = 0.0;
    v32 = &v9;
    v19 = *a1 + v16;
    v20 = a1[1] + *(float *)&v17;
    v7 = a1[2];
    v9 = v19;
    v21 = v7 + *(float *)&v18;
    v10 = v20;
    v11 = v21;
    *a1 = v19;
    a1[1] = v10;
    a1[2] = v11;
    return 0;
  }
}

//----- (00012618) --------------------------------------------------------
unsigned int __fastcall sub_12618(int a1)
{
  int v2; // esi
  void *ShapeTable_sub_1B084; // eax
  unsigned int v4; // ebp
  LONG v5; // esi
  unsigned __int16 v7; // [esp+0h] [ebp-1Ch]

  v7 = *(_WORD *)(a1 + 5);
  v2 = *(_DWORD *)(a1 + 7);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, v7);
  v4 = 0;
  v5 = v2 + 1;
  if ( v5 >= VFX_shape_count(ShapeTable_sub_1B084) )
  {
    v4 = 0xFFFFFFFF;
    LOWORD(v5) = 0;
  }
  sub_156C0(a1, v7, v5);
  return v4;
}

//----- (00012674) --------------------------------------------------------
void __fastcall sub_12674(int a1)
{
  *(_BYTE *)(a1 + 0x4F37) = 0xFF;
  *(_DWORD *)(a1 + 0xB3) = 0;
  *(_WORD *)(a1 + 0x5034) = 0;
  *(_BYTE *)(a1 + 0xB7) = 4;
  sub_56400(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0x52, 0, 0, 0);
}

//----- (000126F8) --------------------------------------------------------
int __usercall sub_126F8@<eax>(int a1@<eax>, int a2@<edx>, int a3@<ebp>)
{
  unsigned int v4; // edi
  int v5; // edx
  char v6; // al
  char v7; // bl
  int v8; // edx
  int v9; // edx
  int v10; // edx
  __int16 *v11; // ebx
  int v12; // esi
  int i; // ebx
  int v14; // esi
  int j; // ebx
  __int64 v16; // rax
  int v17; // edx
  int v18; // esi

  v4 = 0;
  if ( *(_BYTE *)(a1 + 0x4F37) != 0xFF )
  {
    goto LABEL_42;
  }
  sub_187EC(a1);
  sub_18C2C(a1, 0);
  v5 = *(_DWORD *)(a1 + 0xAB);
  *(_DWORD *)(a1 + 0x4F38) = 0;
  v6 = 0;
  v7 = *(_BYTE *)(v5 + 0xAB);
  v8 = v5 + 0xAB;
  if ( v7 != 3 )
  {
    if ( v7 != 2 )
    {
      goto LABEL_41;
    }
    v6 = 0x34;
    if ( *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v8 + 1) + 0x6B) + 1) == 0x11 )
    {
      *(_BYTE *)(a1 + 0x4F37) = 3;
      goto LABEL_41;
    }
    goto LABEL_40;
  }
  v9 = *(_DWORD *)(v8 + 1);
  v7 = *(_BYTE *)(v9 + 0x62);
  v10 = v9 + 0x62;
  if ( v7 )
  {
    if ( v7 != 1 )
    {
      goto LABEL_41;
    }
    v6 = **(_BYTE **)(v10 + 1);
    switch ( v6 )
    {
      case '4':
        *(_BYTE *)(a1 + 0x4F37) = 3;
        goto LABEL_41;
      case '7':
        *(_BYTE *)(a1 + 0x4F37) = 4;
        goto LABEL_41;
      case ' ':
        *(_BYTE *)(a1 + 0x4F37) = 5;
        goto LABEL_41;
      case '8':
      case 'J':
        *(_BYTE *)(a1 + 0x4F37) = 6;
        goto LABEL_41;
      case ':':
        *(_BYTE *)(a1 + 0x4F37) = 7;
        goto LABEL_41;
      case '.':
        *(_BYTE *)(a1 + 0x4F37) = 8;
        goto LABEL_41;
      case '<':
        *(_BYTE *)(a1 + 0x4F37) = 9;
        goto LABEL_41;
      case ';':
      case 'D':
        *(_BYTE *)(a1 + 0x4F37) = 0xA;
        goto LABEL_41;
      case '-':
        *(_BYTE *)(a1 + 0x4F37) = 0xB;
        goto LABEL_41;
      case '(':
      case '\'':
        *(_BYTE *)(a1 + 0x4F37) = 0xC;
        goto LABEL_41;
      case '$':
        *(_BYTE *)(a1 + 0x4F37) = 0xD;
        goto LABEL_41;
      case 'H':
        *(_BYTE *)(a1 + 0x4F37) = 0xE;
        goto LABEL_41;
      case '&':
        *(_BYTE *)(a1 + 0x4F37) = 0xF;
        goto LABEL_41;
    }
    if ( (V_Gizmos[v6].flags & 0x40) == 0 )
    {
      *(_BYTE *)(a1 + 0x4F37) = 2;
      goto LABEL_41;
    }
LABEL_40:
    *(_BYTE *)(a1 + 0x4F37) = v7;
    goto LABEL_41;
  }
  *(_BYTE *)(a1 + 0x4F37) = 0;
LABEL_41:
  v11 = (__int16 *)(a1 + 4 * v6);
  Q_CACHE_CPP_GetShapeTable_sub_1B084(
    (unsigned int)&V_Type3_stru_10AE70.t13,
    *(unsigned __int16 *)(a1 + 2 * v11[0xD49] + 0x19C6));
  Q_CACHE_CPP_GetShapeTable_sub_1B084(
    (unsigned int)&V_Type3_stru_10AE70.t13,
    *(unsigned __int16 *)(a1 + 2 * v11[0xD4A] + 0x19C6));
  sub_50140(&V_SoundSystem, v11[0xDE7]);
  a2 = v11[0xDE8];
  sub_50140(&V_SoundSystem, a2);
LABEL_42:
  v12 = a1;
  for ( i = 0; i < *(__int16 *)(a1 + 0x5034); ++i )
  {
    a2 = *(_DWORD *)(v12 + 0x4F44);
    sub_12B4C(a1, a2);
    v12 += 4;
  }
  switch ( *(_BYTE *)(a1 + 0x4F37) )
  {
    case 0xFF:
      v4 = 0xFFFFFFFF;
      break;
    case 0:
      v4 = sub_12C98(a1, a2, i);
      break;
    case 1:
      v4 = sub_12E88(a1);
      break;
    case 2:
      v4 = sub_12F7C(a1, a3);
      break;
    case 3:
      v4 = sub_13370(a1, a2, i);
      break;
    case 4:
      v4 = sub_136C4(a1);
      break;
    case 5:
      v4 = sub_1380C(a1);
      break;
    case 6:
      v4 = sub_13C10(a1);
      break;
    case 7:
      v4 = sub_14224(a1);
      break;
    case 8:
      v4 = sub_142D8(a1);
      break;
    case 9:
      v4 = sub_14490(a1);
      break;
    case 0xA:
      v4 = sub_145C0(a1);
      break;
    case 0xB:
      v4 = sub_147CC(a1);
      break;
    case 0xC:
      v4 = sub_14B18(a1, a2, i);
      break;
    case 0xD:
      v4 = sub_15078(a1);
      break;
    case 0xE:
      v4 = sub_15164(a1);
      break;
    case 0xF:
      v4 = sub_152E4(a1, a2, i, a1);
      break;
    default:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\batfx.cpp", 0xF8);
      break;
  }
  if ( *(_DWORD *)(a1 + 0x5036) == 0xFFFFFFFF )
  {
    v4 = 0xFFFFFFFF;
    *(_DWORD *)(a1 + 0x5036) = 0;
  }
  sub_18C2C(a1, 1);
  v14 = a1;
  for ( j = 0; j < *(__int16 *)(a1 + 0x5034); ++j )
  {
    sub_12B4C(a1, *(_DWORD *)(v14 + 0x4F44));
    v14 += 4;
  }
  LODWORD(v16) = (*(int (__fastcall **)(int, int))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 1);
  ++*(_DWORD *)(a1 + 0x4F38);
  if ( v4 == 0xFFFFFFFF )
  {
    v17 = *(_DWORD *)(a1 + 0x41);
    *(_BYTE *)(a1 + 0xB7) = 0;
    sub_564C0(&V_Type3_stru_10AE70, v17, 0x52);
    sub_12238(*(_DWORD *)(a1 + 0xAB), 0xFFFFFFFF);
    sub_187EC(a1);
    sub_18C2C(a1, 0);
    *(_BYTE *)(a1 + 0x4F37) = 0xFF;
    v16 = (unsigned int)a1;
    while ( SHIDWORD(v16) < *(__int16 *)(a1 + 0x5034) )
    {
      v18 = *(_DWORD *)(v16 + 0x4F44);
      LODWORD(v16) = v16 + 4;
      ++HIDWORD(v16);
      *(_BYTE *)(v18 + 0x33) &= 1u;
    }
  }
  return v16;
}

//----- (00012AE4) --------------------------------------------------------
int __fastcall sub_12AE4(int a1, int a2)
{
  int v4; // edi
  int v5; // edx
  int v6; // eax

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x122);
  }
  v4 = 0;
  v5 = 0;
  if ( *(int *)(a1 + 0x1D32) > 0 )
  {
    v6 = *(_DWORD *)(a1 + 0x1D2A);
    while ( a2 != *(_DWORD *)(v6 + 1) )
    {
      ++v5;
      v6 += 0x35;
      if ( v5 >= *(_DWORD *)(a1 + 0x1D32) )
      {
        goto LABEL_10;
      }
    }
    v4 = v6;
  }
LABEL_10:
  if ( !v4 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x12F);
  }
  return v4;
}

//----- (00012B4C) --------------------------------------------------------
void __fastcall sub_12B4C(int a1, int a2)
{
  int v2; // ebx
  int v3; // esi
  int v4; // ecx
  LONG v5; // eax
  int v6; // eax
  LONG v7; // ebx
  double v8; // st7
  double v9; // st6
  double v10; // st5
  int v11; // [esp+Ch] [ebp-18h]

  if ( *(_BYTE *)a2 == 8 )
  {
    v2 = *(_DWORD *)(a2 + 1);
    if ( *(_WORD *)(a2 + 0x27) >= *(_WORD *)(v2 + 0x27) )
    {
      v3 = *(_DWORD *)(a1 + 8);
      stru_9A23C.x0 = v3 + *(__int16 *)(v2 + 0x27);
      v4 = *(__int16 *)(a2 + 0x27);
    }
    else
    {
      v3 = *(__int16 *)(v2 + 0x27);
      stru_9A23C.x0 = *(_DWORD *)(a1 + 8) + *(__int16 *)(a2 + 0x27);
      v4 = *(_DWORD *)(a1 + 8);
    }
    stru_9A23C.x1 = v3 + v4;
    if ( *(_WORD *)(a2 + 0x29) >= *(_WORD *)(v2 + 0x29) )
    {
      v6 = *(_DWORD *)(a1 + 0xC);
      v7 = *(__int16 *)(v2 + 0x29) + v6;
      v5 = *(__int16 *)(a2 + 0x29) + v6;
      stru_9A23C.y0 = v7;
    }
    else
    {
      stru_9A23C.y0 = *(__int16 *)(a2 + 0x29) + *(_DWORD *)(a1 + 0xC);
      v5 = *(__int16 *)(v2 + 0x29) + *(_DWORD *)(a1 + 0xC);
    }
    stru_9A23C.y1 = v5;
  }
  else
  {
    v11 = *(__int16 *)(a2 + 0x29) + *(_DWORD *)(a1 + 0xC);
    v8 = (double)*(unsigned int *)(a2 + 0xF) * dbl_9017F;
    v9 = (double)(*(__int16 *)(a2 + 0x27) + *(_DWORD *)(a1 + 8));
    stru_9A23C.x0 = (int)((double)*(__int16 *)(a2 + 0x13) * v8 + v9);
    v10 = (double)v11;
    stru_9A23C.y0 = (int)((double)*(__int16 *)(a2 + 0x15) * v8 + v10);
    stru_9A23C.x1 = (int)(v9 + (double)*(__int16 *)(a2 + 0x17) * v8);
    stru_9A23C.y1 = (int)(v8 * (double)*(__int16 *)(a2 + 0x19) + v10);
  }
  sub_552CC(&V_Type3_stru_10AE70, &stru_9A23C);
}
// 9017F: using guessed type double dbl_9017F;

//----- (00012C98) --------------------------------------------------------
unsigned int __fastcall sub_12C98(int a1, int a2, int a3)
{
  int v4; // edi
  unsigned int v5; // ebp
  char v6; // ah
  int v7; // edi
  int v8; // edi
  char v9; // dl
  int v10; // eax
  int v11; // eax
  int v13; // edi
  void *ShapeTable_sub_1B084; // eax
  int v15; // edi
  int v16; // ecx
  unsigned __int16 v17; // [esp+0h] [ebp-1Ch]

  v4 = *(_DWORD *)(a1 + 0xAB);
  v5 = 0;
  v6 = *(_BYTE *)(v4 + 0xAB);
  v7 = v4 + 0xAB;
  if ( v6 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x16B);
  }
  v8 = *(_DWORD *)(v7 + 1);
  v9 = *(_BYTE *)(v8 + 0x67);
  if ( v9 != 3 && v9 != 1 && v9 != 2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x171);
  }
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 1;
    v10 = sub_12AE4(a1, v8);
    *(_DWORD *)(a1 + 0x4F44) = v10;
    *(_BYTE *)(v10 + 0x33) = 0x12;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(_DWORD *)(a1 + 0x4F80) = *(_DWORD *)(v8 + 0x9E);
    *(_DWORD *)(a1 + 0x4F84) = *(_DWORD *)(v8 + 0xA2);
    *(_DWORD *)(a1 + 0x4F88) = *(_DWORD *)(v8 + 0xA6);
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    if ( *(_DWORD *)(v8 + 0x94) )
    {
      if ( *(_DWORD *)(v8 + 0x88) )
      {
        Q_StartSample_sub_4FB90(&V_SoundSystem, 7);
      }
    }
  }
  if ( *(_DWORD *)(a1 + 0x4F3C) )
  {
    v17 = 7;
    if ( (*(_BYTE *)(*(_DWORD *)(v8 + 0x68) + 0x23) & 1) != 0 )
    {
      v17 = 8;
    }
    v13 = *(_DWORD *)(a1 + 0x4F3C);
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                             (unsigned int)&V_Type3_stru_10AE70.t13,
                             *(unsigned __int16 *)(a1 + 2 * v17 + 0x19C6));
    v15 = v13 >> 2;
    v16 = VFX_shape_count(ShapeTable_sub_1B084) - 1;
    if ( v15 <= v16 || v15 > 2 * v16 )
    {
      if ( v15 > 2 * v16 )
      {
        v5 = 0xFFFFFFFF;
        LOWORD(v15) = 0;
      }
    }
    else
    {
      LOWORD(v15) = 2 * v16 - v15;
    }
    sub_1826C(a1, *(_DWORD *)(a1 + 0x4F48), v17, v15);
    ++*(_DWORD *)(a1 + 0x4F3C);
  }
  else if ( sub_12480((float *)(a1 + 0x4F80), (float *)(v8 + 0x78), 20.0) == 0xFFFFFFFF )
  {
    if ( (*(_BYTE *)(v8 + 0x84) & 8) == 0
      || *(_BYTE *)(v8 + 0x67) != 2
      || sub_4960C(v8, *(_DWORD *)(v8 + 0x68)) != 0xFFFFFFFF )
    {
      return 0xFFFFFFFF;
    }
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) |= 8u;
    *(_WORD *)(a1 + 0x5034) = 2;
    v11 = sub_12AE4(a1, *(_DWORD *)(v8 + 0x68));
    *(_DWORD *)(a1 + 0x4F3C) = 1;
    *(_DWORD *)(a1 + 0x4F48) = v11;
  }
  return v5;
}

//----- (00012E88) --------------------------------------------------------
unsigned int __fastcall sub_12E88(int a1)
{
  int v2; // ebp
  int v3; // edi
  char v4; // ah
  int v5; // ebp
  int v6; // eax
  char v7; // bl
  _BYTE *v8; // edx
  int v9; // eax
  int v10; // ebp

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = 0;
  v4 = *(_BYTE *)(v2 + 0xAB);
  v5 = v2 + 0xAB;
  if ( v4 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x1BA);
  }
  v6 = *(_DWORD *)(v5 + 1);
  v7 = **(_BYTE **)(v6 + 0x63);
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    v8 = *(_BYTE **)(a1 + 0x1D2A);
    *(_WORD *)(a1 + 0x5034) = 1;
    v8 += 0x35;
    *(_DWORD *)(a1 + 0x4F44) = v8;
    *v8 = 7;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) = 0x12;
    v9 = v6 + 0x9E;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(_DWORD *)(a1 + 0x4F80) = *(_DWORD *)v9;
    *(_DWORD *)(a1 + 0x4F84) = *(_DWORD *)(v9 + 4);
    v10 = a1 + 4 * v7;
    *(float *)(a1 + 0x4F88) = *(float *)(v9 + 8);
    sub_1826C(a1, *(_DWORD *)(a1 + 0x4F44), *(_WORD *)(v10 + 0x1A92), 0);
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(v10 + 0x1BCE));
  }
  if ( (*(_BYTE *)(a1 + 0x4F38) & 3) == 0 && sub_12618(*(_DWORD *)(a1 + 0x4F44)) == 0xFFFFFFFF )
  {
    return 0xFFFFFFFF;
  }
  return v3;
}

//----- (00012F7C) --------------------------------------------------------
int __usercall sub_12F7C@<eax>(int a1@<eax>, int ebp0@<ebp>)
{
  int v3; // edx
  char v4; // bl
  int v5; // ebp
  int v6; // ebp
  int *v7; // edi
  int v8; // ebp
  char v9; // al
  char v10; // cl
  _BYTE *v11; // eax
  int v12; // edi
  __int16 v14; // di
  unsigned __int16 v15; // ax
  _BYTE *v16; // eax
  char v17; // bl
  int v18; // eax
  float x_4; // [esp+4h] [ebp-7Ch]
  float v20; // [esp+8h] [ebp-78h] BYREF
  _DWORD *a2; // [esp+Ch] [ebp-74h]
  _DWORD *a3; // [esp+10h] [ebp-70h]
  _DWORD *a4; // [esp+14h] [ebp-6Ch]
  float v24; // [esp+18h] [ebp-68h]
  float v25; // [esp+1Ch] [ebp-64h]
  int v26[3]; // [esp+20h] [ebp-60h] BYREF
  float v27; // [esp+2Ch] [ebp-54h]
  int v28; // [esp+30h] [ebp-50h]
  int v29; // [esp+34h] [ebp-4Ch]
  int v30; // [esp+38h] [ebp-48h] BYREF
  __int64 result; // [esp+3Ch] [ebp-44h] BYREF
  _DWORD v32[2]; // [esp+48h] [ebp-38h] BYREF
  int v33; // [esp+50h] [ebp-30h]
  float v34; // [esp+54h] [ebp-2Ch]
  int v35; // [esp+58h] [ebp-28h]
  int v36; // [esp+5Ch] [ebp-24h]
  _BYTE *v37; // [esp+60h] [ebp-20h]
  char v38; // [esp+64h] [ebp-1Ch]

  v33 = 0;
  v3 = *(_DWORD *)(a1 + 0xAB) + 0xAB;
  *(float *)&a4 = 0.0;
  v24 = 0.0;
  v25 = 0.0;
  v20 = 0.0;
  *(float *)&a2 = 0.0;
  *(float *)&a3 = 0.0;
  v32[0] = 0;
  v4 = *(_BYTE *)v3;
  v38 = 0;
  if ( v4 == 3 )
  {
    v5 = *(_DWORD *)(v3 + 1);
    a4 = *(_DWORD **)(v5 + 0x9E);
    v24 = *(float *)(v5 + 0xA2);
    v25 = *(float *)(v5 + 0xA6);
    v20 = *(float *)(v5 + 0x78);
    a2 = *(_DWORD **)(v5 + 0x7C);
    a3 = *(_DWORD **)(v5 + 0x80);
    v36 = **(char **)(v5 + 0x63);
    v35 = *(_DWORD *)(v5 + 0x84);
    v38 = *(_BYTE *)(v5 + 0x67);
    ebp0 = *(_DWORD *)(v5 + 0x68);
    v32[0] = V_Gizmos[v36].range;
  }
  else if ( v4 == 2 )
  {
    v6 = *(_DWORD *)(v3 + 1);
    a4 = *(_DWORD **)v6;
    v24 = *(float *)(v6 + 4);
    v7 = (int *)(v6 + 0x6B);
    v25 = *(float *)(v6 + 8);
    v8 = *(_DWORD *)(v6 + 0x6F);
    v20 = *(float *)(v8 + 0x9E);
    a2 = *(_DWORD **)(v8 + 0xA2);
    a3 = *(_DWORD **)(v8 + 0xA6);
    v35 = v7[2];
    ebp0 = v7[1];
    v9 = *(_BYTE *)(*v7 + 1);
    HIDWORD(result) = *(_DWORD *)(v3 + 1);
    sub_366C8((P_Planet)HIDWORD(result), v9, v32, &v30, &result);
    v10 = *(_BYTE *)(*v7 + 1);
    switch ( v10 )
    {
      case 0x1C:
        v36 = 0x4C;
        break;
      case 0x1D:
        v36 = 0x4D;
        break;
      case 0x1E:
        v36 = 0x4E;
        break;
    }
  }
  else
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\batfx.cpp", 0x20E);
  }
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 2;
    v11 = *(_BYTE **)(a1 + 0x1D2A);
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    v11 += 0x35;
    *(_DWORD *)(a1 + 0x4F44) = v11;
    *v11 = 7;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) = 0x12;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(float *)(a1 + 0x4F80) = *(float *)&a4;
    *(float *)(a1 + 0x4F84) = v24;
    v12 = v36;
    *(float *)(a1 + 0x4F88) = v25;
    sub_1826C(a1, *(_DWORD *)(a1 + 0x4F44), *(_WORD *)(a1 + 4 * v12 + 0x1A92), 0);
    *(_DWORD *)(a1 + 0x4F48) = sub_12AE4(a1, ebp0);
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v12 + 0x1BCE));
  }
  if ( *(_DWORD *)(a1 + 0x4F3C) )
  {
    v14 = 1;
    v34 = 1.0;
    v15 = 4;
    if ( (v35 & 4) != 0 || v36 == 0x3D )
    {
      v16 = *(_BYTE **)(a1 + 0x4F48);
      if ( *v16 == 2 )
      {
        LOWORD(v16) = *(char *)(ebp0 + 0xAA);
        v37 = v16;
        v34 = (double)(__int16)v16 * dbl_901BB + 1.0;
      }
      v14 = 5;
      v17 = v36;
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) |= 8u;
      v15 = (char)(((v17 & 1) == 0) + 5);
      if ( v36 != 0x3D )
      {
        goto LABEL_29;
      }
      v18 = 0x3D;
    }
    else
    {
      if ( (v35 & 2) == 0 && (v35 & 0x10) == 0 && v38 != 1 && v38 != 2 )
      {
        goto LABEL_29;
      }
      v18 = v36;
    }
    v14 = *(_WORD *)(a1 + 4 * v18 + 0x1BD0);
    v15 = *(_WORD *)(a1 + 4 * v18 + 0x1A94);
LABEL_29:
    if ( *(_DWORD *)(a1 + 0x4F3C) == 1 )
    {
      sub_1826C(a1, *(_DWORD *)(a1 + 0x4F44), v15, 0);
      Q_StartSample_sub_4FB90(&V_SoundSystem, v14);
      *(_DWORD *)(a1 + 0x4F3C) = 2;
    }
    if ( (*(_BYTE *)(a1 + 0x4F38) & 3) == 0 && sub_12618(*(_DWORD *)(a1 + 0x4F44)) == 0xFFFFFFFF )
    {
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) |= 8u;
      v33 = 0xFFFFFFFF;
    }
    *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) = v34;
    return v33;
  }
  v27 = v20 - *(float *)&a4;
  v32[1] = v26;
  *(float *)&v28 = *(float *)&a2 - v24;
  *(float *)&v29 = *(float *)&a3 - v25;
  *(float *)v26 = v27;
  v26[1] = v28;
  v26[2] = v29;
  x_4 = sqrt(*(float *)&v28 * *(float *)&v28 + v27 * v27 + *(float *)&v29 * *(float *)&v29) * flt_901C3 + flt_901C7;
  if ( sub_12480((float *)(a1 + 0x4F80), &v20, x_4) != 0xFFFFFFFF )
  {
    sub_12618(*(_DWORD *)(a1 + 0x4F44));
    return v33;
  }
  *(_DWORD *)(a1 + 0x4F3C) = 1;
  return v33;
}
// 901BB: using guessed type double dbl_901BB;
// 901C3: using guessed type float flt_901C3;
// 901C7: using guessed type float flt_901C7;

//----- (00013370) --------------------------------------------------------
unsigned int __fastcall sub_13370(int a1, int a2, int a3)
{
  int v4; // ebp
  int v5; // eax
  int v6; // esi
  char v7; // dl
  int v8; // edi
  int *v9; // ebx
  _BYTE *v10; // eax
  int v11; // eax
  int v12; // eax
  double v13; // st7
  double v14; // st7
  float v16; // [esp+8h] [ebp-6Ch] BYREF
  float v17; // [esp+Ch] [ebp-68h]
  float v18; // [esp+10h] [ebp-64h]
  float v19; // [esp+14h] [ebp-60h]
  float v20; // [esp+18h] [ebp-5Ch]
  float v21; // [esp+1Ch] [ebp-58h]
  float v22; // [esp+20h] [ebp-54h] BYREF
  float v23; // [esp+24h] [ebp-50h]
  float v24; // [esp+28h] [ebp-4Ch]
  float v25; // [esp+2Ch] [ebp-48h]
  float v26; // [esp+30h] [ebp-44h]
  float v27; // [esp+34h] [ebp-40h]
  float v28; // [esp+38h] [ebp-3Ch]
  float v29; // [esp+3Ch] [ebp-38h]
  float v30; // [esp+40h] [ebp-34h]
  int v31; // [esp+44h] [ebp-30h]
  float *v32; // [esp+48h] [ebp-2Ch]
  float *v33; // [esp+4Ch] [ebp-28h]
  float v34; // [esp+50h] [ebp-24h]
  int v35; // [esp+54h] [ebp-20h]
  float v36; // [esp+58h] [ebp-1Ch]

  v4 = 0;
  v5 = *(_DWORD *)(a1 + 0xAB) + 0xAB;
  v25 = 0.0;
  v26 = 0.0;
  v27 = 0.0;
  v6 = 0;
  v7 = *(_BYTE *)v5;
  v35 = 0;
  if ( v7 == 3 )
  {
    v8 = *(_DWORD *)(v5 + 1);
    if ( *(_BYTE *)(v8 + 0x67) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x27D);
    }
    v6 = *(_DWORD *)(v8 + 0x68);
    v35 = sub_12AE4(a1, *(_DWORD *)(v5 + 1));
    v25 = *(float *)(v8 + 0x9E);
    v26 = *(float *)(v8 + 0xA2);
    v27 = *(float *)(v8 + 0xA6);
    v31 = 0x20 * V_Gizmos[0x34].special1;
    v34 = (float)(0x20 * V_Gizmos[0x34].special1);
  }
  else if ( v7 == 2 )
  {
    v9 = *(int **)(v5 + 1);
    v6 = *(int *)((char *)v9 + 0x6F);
    v35 = sub_12AE4(a1, (int)v9);
    v25 = *(float *)v9;
    v26 = *((float *)v9 + 1);
    v27 = *((float *)v9 + 2);
    v34 = 3200.0;
  }
  else
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\batfx.cpp", 0x28E);
  }
  sub_12AE4(a1, v6);
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 2;
    v10 = *(_BYTE **)(a1 + 0x1D2A);
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    v10 += 0x35;
    *(_DWORD *)(a1 + 0x4F44) = v10;
    *v10 = 8;
    *(_DWORD *)(*(_DWORD *)(a1 + 0x4F44) + 1) = v35;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) |= 0x12u;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(float *)(a1 + 0x4F80) = v25;
    *(float *)(a1 + 0x4F84) = v26;
    *(float *)(a1 + 0x4F88) = v27;
    v11 = sub_12AE4(a1, v6);
    *(_DWORD *)(a1 + 0x4F48) = v11;
    *(_BYTE *)(v11 + 0x33) = 0x12;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x34) = 1;
    *(_DWORD *)(a1 + 0x4F8C) = *(_DWORD *)(v6 + 0x9E);
    *(_DWORD *)(a1 + 0x4F90) = *(_DWORD *)(v6 + 0xA2);
    *(_DWORD *)(a1 + 0x4F94) = *(_DWORD *)(v6 + 0xA6);
    Q_StartSample_sub_4FB90(&V_SoundSystem, 1);
  }
  v12 = *(_DWORD *)(a1 + 0x4F3C);
  if ( !v12 )
  {
    if ( sub_12480((float *)(a1 + 0x4F80), (float *)(a1 + 0x4F8C), 40.0) == 0xFFFFFFFF )
    {
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) |= 2u;
      v19 = 0.0;
      v20 = 0.0;
      v21 = 0.0;
      v32 = &v22;
      v19 = *(float *)(a1 + 0x4F8C) - v25;
      v20 = *(float *)(a1 + 0x4F90) - v26;
      v21 = *(float *)(a1 + 0x4F94) - v27;
      v22 = v19;
      v23 = v20;
      v24 = v21;
      v13 = sqrt(v20 * v20 + v19 * v19 + v21 * v21);
      v14 = v13 - v34;
      v36 = v14;
      if ( v14 < flt_901E5 )
      {
        v36 = 1280.0;
      }
      sub_53054(&v22, v36);
      v33 = &v16;
      v28 = v25 + v22;
      v16 = v28;
      v29 = v26 + v23;
      v17 = v29;
      v30 = v27 + v24;
      v18 = v30;
      *(float *)(a1 + 0x4F98) = v28;
      *(float *)(a1 + 0x4F9C) = v17;
      *(float *)(a1 + 0x4FA0) = v18;
      *(_DWORD *)(a1 + 0x4F3C) = 1;
      return 0;
    }
    return v4;
  }
  if ( v12 != 1 )
  {
    return 0xFFFFFFFF;
  }
  if ( sub_12480((float *)(a1 + 0x4F8C), (float *)(a1 + 0x4F98), 4.0) == 0xFFFFFFFF )
  {
    *(_DWORD *)(a1 + 0x4F3C) = 2;
  }
  *(_DWORD *)(a1 + 0x4F80) = *(_DWORD *)(a1 + 0x4F8C);
  *(float *)(a1 + 0x4F84) = *(float *)(a1 + 0x4F90);
  *(_DWORD *)(a1 + 0x4F88) = *(_DWORD *)(a1 + 0x4F94);
  return 0;
}
// 901E5: using guessed type float flt_901E5;

//----- (000136C4) --------------------------------------------------------
unsigned int __fastcall sub_136C4(int a1)
{
  int v2; // edi
  int v3; // esi
  char v4; // ah
  int v5; // edi
  _DWORD *v6; // ebx
  int v7; // edi
  int v8; // eax
  int v9; // eax
  int v10; // ebx
  int v12; // [esp+0h] [ebp-24h]
  int v13; // [esp+4h] [ebp-20h]
  int v14; // [esp+8h] [ebp-1Ch]

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = 0;
  v4 = *(_BYTE *)(v2 + 0xAB);
  v5 = v2 + 0xAB;
  if ( v4 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x2D8);
  }
  v6 = *(_DWORD **)(v5 + 1);
  v7 = v6[0x1A];
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 2;
    v8 = sub_12AE4(a1, (int)v6);
    *(_DWORD *)(a1 + 0x4F44) = v8;
    *(_BYTE *)(v8 + 0x33) = 0x14;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(_DWORD *)(a1 + 0x4F80) = *(_DWORD *)((char *)v6 + 0x9E);
    *(_DWORD *)(a1 + 0x4F84) = *(_DWORD *)((char *)v6 + 0xA2);
    *(_DWORD *)(a1 + 0x4F88) = *(_DWORD *)((char *)v6 + 0xA6);
    v9 = sub_12AE4(a1, v7);
    *(_DWORD *)(a1 + 0x4F48) = v9;
    *(_BYTE *)(v9 + 0x33) = 0x14;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x34) = 1;
    *(_DWORD *)(a1 + 0x4F8C) = *(_DWORD *)(v7 + 0x9E);
    *(_DWORD *)(a1 + 0x4F90) = *(_DWORD *)(v7 + 0xA2);
    *(_DWORD *)(a1 + 0x4F94) = *(_DWORD *)(v7 + 0xA6);
  }
  v10 = *(_DWORD *)(a1 + 0x4F38);
  if ( v10 == 0x14 )
  {
    v12 = *(_DWORD *)(a1 + 0x4F8C);
    v13 = *(_DWORD *)(a1 + 0x4F90);
    v14 = *(_DWORD *)(a1 + 0x4F94);
    *(_DWORD *)(a1 + 0x4F8C) = *(_DWORD *)(a1 + 0x4F80);
    *(_DWORD *)(a1 + 0x4F90) = *(_DWORD *)(a1 + 0x4F84);
    *(_DWORD *)(a1 + 0x4F94) = *(_DWORD *)(a1 + 0x4F88);
    *(_DWORD *)(a1 + 0x4F80) = v12;
    *(_DWORD *)(a1 + 0x4F84) = v13;
    *(_DWORD *)(a1 + 0x4F88) = v14;
  }
  else if ( v10 == 0x29 )
  {
    return 0xFFFFFFFF;
  }
  return v3;
}

//----- (0001380C) --------------------------------------------------------
unsigned int __fastcall sub_1380C(int a1)
{
  int v2; // ecx
  int v3; // edi
  char v4; // ah
  int v5; // ecx
  int v6; // eax
  int v7; // ebp
  int v8; // edx
  _BYTE *v9; // eax
  int v10; // eax
  double v11; // st7
  int v12; // eax
  int v13; // edx
  int v14; // ebx
  _BYTE *v15; // eax
  int v17[3]; // [esp+0h] [ebp-30h] BYREF
  int v18; // [esp+Ch] [ebp-24h]
  int v19; // [esp+10h] [ebp-20h]
  char v20; // [esp+14h] [ebp-1Ch]

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = 0;
  v4 = *(_BYTE *)(v2 + 0xAB);
  v5 = v2 + 0xAB;
  if ( v4 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x30D);
  }
  v6 = *(_DWORD *)(v5 + 1);
  v19 = v6;
  if ( *(_BYTE *)(v6 + 0x67) != 2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x312);
  }
  v7 = *(_DWORD *)(v6 + 0x68);
  v17[0] = *(_DWORD *)(v6 + 0x78);
  v17[1] = *(_DWORD *)(v6 + 0x7C);
  v17[2] = *(_DWORD *)(v6 + 0x80);
  v8 = *(_DWORD *)(a1 + 0x4F38);
  v20 = **(_BYTE **)(v6 + 0x63);
  if ( !v8 )
  {
    *(_WORD *)(a1 + 0x5034) = 2;
    v9 = *(_BYTE **)(a1 + 0x1D2A);
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    v9 += 0x35;
    *(_DWORD *)(a1 + 0x4F44) = v9;
    *v9 = 7;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) = 0x12;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    v10 = v19 + 0x9E;
    *(float *)(a1 + 0x4F80) = *(float *)(v19 + 0x9E);
    *(_DWORD *)(a1 + 0x4F84) = *(_DWORD *)(v10 + 4);
    v11 = *(float *)(v10 + 8);
    v12 = 4 * v20;
    *(float *)(a1 + 0x4F88) = v11;
    v18 = a1 + v12;
    sub_1826C(a1, *(_DWORD *)(a1 + 0x4F44), *(_WORD *)(a1 + v12 + 0x1A92), 0);
    v13 = v18;
    *(_DWORD *)(a1 + 0x4F48) = sub_12AE4(a1, v7);
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(v13 + 0x1BCE));
  }
  v14 = *(_DWORD *)(a1 + 0x4F3C);
  if ( v14 )
  {
    *(_DWORD *)(a1 + 0x4F3C) = v14 + 1;
    if ( v14 + 1 > 0x14 )
    {
      return 0xFFFFFFFF;
    }
  }
  else if ( sub_12480((float *)(a1 + 0x4F80), (float *)v17, 40.0) == 0xFFFFFFFF )
  {
    v15 = *(_BYTE **)(a1 + 0x4F44);
    *(_DWORD *)(a1 + 0x4F3C) = 1;
    *v15 = 0xFF;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) |= 4u;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v20 + 0x1BD0));
  }
  return v3;
}

//----- (000139E0) --------------------------------------------------------
void __fastcall sub_139E0(int a1, int a2)
{
  switch ( *(_BYTE *)(a1 + 0x4F37) )
  {
    case 4:
      sub_13A28(a1, a2);
      break;
    case 5:
      sub_13AD8(a1, a2);
      break;
    case 7:
    case 0xA:
    case 0xC:
    case 0xD:
    case 0xE:
      sub_15630(a1, a2);
      break;
    default:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\batfx.cpp", 0x362);
      break;
  }
}

//----- (00013A28) --------------------------------------------------------
void __fastcall sub_13A28(int a1, int a2)
{
  double v3; // st7
  void *ShapeTable_sub_1B084; // eax
  LONG v5; // [esp-20h] [ebp-3Ch]
  LONG v6; // [esp-1Ch] [ebp-38h]
  LONG v7; // [esp-18h] [ebp-34h]
  LONG v8; // [esp-Ch] [ebp-28h]
  float v9; // [esp+8h] [ebp-14h]

  if ( *(_BYTE *)a2 != 2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfx.cpp", 0x36B);
  }
  if ( *(int *)(a1 + 0x4F38) >= 0x14 )
  {
    v3 = (double)*(int *)(a1 + 0x4F38) + dbl_9022A;
  }
  else
  {
    v3 = dbl_9023A - (double)*(int *)(a1 + 0x4F38);
  }
  v9 = v3 * dbl_90232;
  v8 = (int)((double)*(int *)(a2 + 0xF) * v9);
  v7 = *(__int16 *)(a2 + 0x29);
  v6 = *(__int16 *)(a2 + 0x27);
  v5 = *(_DWORD *)(a2 + 7);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           *(unsigned __int16 *)(a2 + 5));
  VFX_shape_transform((PANE *)(a1 + 4), ShapeTable_sub_1B084, v5, v6, v7, V_BigBuffer, 0, v8, v8, 0);
}
// 9022A: using guessed type double dbl_9022A;
// 90232: using guessed type double dbl_90232;
// 9023A: using guessed type double dbl_9023A;
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (00013AD8) --------------------------------------------------------
void __fastcall sub_13AD8(int a1, int a2)
{
  void *ShapeTable_sub_1B084; // eax
  PANE *v4; // edi
  LONG v5; // [esp-20h] [ebp-44h]
  LONG v6; // [esp-1Ch] [ebp-40h]
  LONG v7; // [esp-18h] [ebp-3Ch]
  LONG v8; // [esp-8h] [ebp-2Ch]
  LONG width; // [esp+10h] [ebp-14h]
  int widtha; // [esp+10h] [ebp-14h]

  width = *(_DWORD *)(a1 + 0x4F3C);
  if ( width > 0xA )
  {
    width = 0x14 - width;
    sub_1826C(a1, a2, *(_WORD *)(a1 + 0x1B14), 2u);
  }
  v8 = *(_DWORD *)(a2 + 0xF);
  v7 = *(__int16 *)(a2 + 0x29);
  v6 = *(__int16 *)(a2 + 0x27);
  v5 = *(_DWORD *)(a2 + 7);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           *(unsigned __int16 *)(a2 + 5));
  v4 = (PANE *)(a1 + 4);
  VFX_shape_transform(v4, ShapeTable_sub_1B084, v5, v6, v7, V_BigBuffer, 0, v8, v8, 0);
  widtha = (int)((double)*(unsigned int *)(a2 + 0xF)
               * dbl_90242
               * (double)((*(__int16 *)(a2 + 0x17) - *(__int16 *)(a2 + 0x13)) * width)
               * flt_9024A);
  VFX_ellipse_fill(v4, *(__int16 *)(a2 + 0x27), *(__int16 *)(a2 + 0x29), widtha, widtha, 0x96);
}
// 90242: using guessed type double dbl_90242;
// 9024A: using guessed type float flt_9024A;
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (00013BC0) --------------------------------------------------------
_DWORD *__fastcall sub_13BC0(_DWORD *result, _DWORD *a2)
{
  *result = *a2;
  result[1] = a2[1];
  result[2] = a2[2];
  return result;
}

//----- (00013BF0) --------------------------------------------------------
_DWORD *__fastcall sub_13BF0(_DWORD *result)
{
  *result = 0;
  result[1] = 0;
  result[2] = 0;
  return result;
}

//----- (00013C10) --------------------------------------------------------
unsigned int __fastcall sub_13C10(int a1)
{
  int v2; // ecx
  char v3; // ah
  int v4; // ecx
  int v5; // ecx
  int v6; // ebp
  char v7; // al
  char v8; // bl
  int v9; // edi
  _BYTE *v10; // eax
  _DWORD *v11; // ecx
  unsigned int v12; // ebx
  int v13; // edx
  int v14; // eax
  float *v15; // ecx
  float *v16; // edx
  double v17; // st7
  int v18; // eax
  float *v19; // edx
  int v20; // ebp
  int v21; // eax
  int v23; // eax
  double special1; // st7
  double v25; // st7
  int v26; // edi
  int v27; // ebx
  int v28; // ecx
  int v29; // edx
  int v30; // edx
  double v31; // st7
  double v32; // st7
  int v33; // edx
  int v34[107]; // [esp+8h] [ebp-238h] BYREF
  float v35; // [esp+1B4h] [ebp-8Ch]
  float v36; // [esp+1B8h] [ebp-88h]
  float v37; // [esp+1BCh] [ebp-84h]
  float v38; // [esp+1C0h] [ebp-80h]
  float v39; // [esp+1C4h] [ebp-7Ch]
  float v40; // [esp+1C8h] [ebp-78h]
  float v41; // [esp+1CCh] [ebp-74h] BYREF
  float v42; // [esp+1D0h] [ebp-70h]
  float v43; // [esp+1D4h] [ebp-6Ch]
  float v44; // [esp+1D8h] [ebp-68h] BYREF
  float v45; // [esp+1DCh] [ebp-64h]
  float v46; // [esp+1E0h] [ebp-60h]
  float v47; // [esp+1E4h] [ebp-5Ch]
  float v48; // [esp+1E8h] [ebp-58h]
  float v49; // [esp+1ECh] [ebp-54h]
  float *v50; // [esp+1F0h] [ebp-50h]
  int v51; // [esp+1F4h] [ebp-4Ch]
  float v52; // [esp+1F8h] [ebp-48h]
  float *v53; // [esp+1FCh] [ebp-44h]
  int v54; // [esp+200h] [ebp-40h]
  float v55; // [esp+204h] [ebp-3Ch]
  int v56; // [esp+208h] [ebp-38h]
  int v57; // [esp+20Ch] [ebp-34h]
  int v58; // [esp+210h] [ebp-30h]
  float v59; // [esp+214h] [ebp-2Ch]
  float v60; // [esp+218h] [ebp-28h]
  float v61; // [esp+21Ch] [ebp-24h]
  int v62; // [esp+220h] [ebp-20h]
  char v63; // [esp+224h] [ebp-1Ch]

  v2 = *(_DWORD *)(a1 + 0xAB);
  v54 = 0;
  v3 = *(_BYTE *)(v2 + 0xAB);
  v4 = v2 + 0xAB;
  if ( v3 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x31);
  }
  v5 = *(_DWORD *)(v4 + 1);
  v6 = 0;
  v7 = **(_BYTE **)(v5 + 0x63);
  v56 = 1;
  v63 = v7;
  if ( v7 == 0x4A )
  {
    if ( *(_BYTE *)(v5 + 0x67) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x3A);
    }
    v6 = *(_DWORD *)(v5 + 0x68);
    v56 = 2;
  }
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    v8 = v63;
    v9 = sub_1D794(*(__int16 **)(v5 + 0x59), v34);
    *(_WORD *)(a1 + 0x5034) = 1;
    if ( v8 == 0x4A )
    {
      *(_WORD *)(a1 + 0x5034) = 2;
      *(_DWORD *)(a1 + 0x4F44) = sub_12AE4(a1, v6);
      v10 = (_BYTE *)(*(_DWORD *)(a1 + 0x1D2A) + 0x35);
      *(_DWORD *)(a1 + 0x4F48) = v10;
      *v10 = 7;
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) = 0x12;
      v11 = (_DWORD *)(v5 + 0x9E);
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x34) = 1;
      *(_DWORD *)(a1 + 0x4F8C) = *v11;
      *(_DWORD *)(a1 + 0x4F90) = v11[1];
      *(_DWORD *)(a1 + 0x4F94) = v11[2];
      sub_1826C(a1, *(_DWORD *)(a1 + 0x4F48), *(_WORD *)(a1 + 4 * v63 + 0x1A92), 0);
      if ( v9 <= 0 )
      {
        goto LABEL_18;
      }
    }
    else
    {
      *(_DWORD *)(a1 + 0x4F44) = sub_12AE4(a1, *(_DWORD *)(v5 + 0x59));
      if ( v9 <= 0 )
      {
LABEL_18:
        v18 = v63;
        *(_DWORD *)(a1 + 0x4F3C) = 0;
        Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v18 + 0x1BCE));
        goto LABEL_19;
      }
    }
    v12 = 0;
    v57 = a1 + 0x4F80;
    v58 = 4 * v9;
    do
    {
      if ( *(__int16 *)(a1 + 0x5034) >= 0xF )
      {
        break;
      }
      v13 = v34[v12 / 4];
      if ( *(_BYTE *)(v13 + 0x58) == 4 && v13 != v6 )
      {
        v14 = sub_12AE4(a1, v13);
        *(_BYTE *)(v14 + 0x33) |= 0x12u;
        *(_BYTE *)(v14 + 0x34) = *(_BYTE *)(a1 + 0x5034);
        v15 = (float *)v34[v12 / 4];
        v16 = (float *)(a1 + 0x4F80 + 0xC * *(char *)(v14 + 0x34));
        v17 = *(float *)((char *)v15 + 0x9E);
        v15 = (float *)((char *)v15 + 0x9E);
        *v16 = v17;
        v16[1] = v15[1];
        v16[2] = v15[2];
        LOWORD(v16) = *(_WORD *)(a1 + 0x5034);
        *(_WORD *)(a1 + 0x5034) = (_WORD)v16 + 1;
        *(_DWORD *)(a1 + 4 * (__int16)v16 + 0x4F44) = v14;
      }
      v12 += 4;
    }
    while ( (int)v12 < v58 );
    goto LABEL_18;
  }
LABEL_19:
  v19 = (float *)(v6 + 0x9E);
  v20 = *(_DWORD *)(a1 + 0x4F3C);
  if ( v20 )
  {
    if ( v20 == 1 )
    {
      *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) = *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) + flt_90278;
      v21 = *(_DWORD *)(a1 + 0x4F44);
      dword_9A234 = 0;
      if ( *(float *)(v21 + 0xB) >= (double)flt_9027C )
      {
        *(_DWORD *)(a1 + 0x4F3C) = 2;
        return v54;
      }
    }
    else if ( v20 == 2 )
    {
      v47 = 0.0;
      v48 = 0.0;
      v49 = 0.0;
      if ( v63 == 0x4A )
      {
        v47 = *v19;
        v48 = v19[1];
        v49 = v19[2];
      }
      v23 = v63;
      special1 = (double)V_Gizmos[v23].special1;
      v62 = 0x20 * V_Gizmos[v23].special2;
      v55 = special1;
      v52 = (float)v62;
      v25 = v55 - *(float *)&dword_9A234;
      v59 = v25;
      if ( v25 > dbl_90270 )
      {
        v59 = 0.2;
      }
      v26 = a1 + 0x4F80;
      v51 = 0xFFFFFFFF;
      v27 = v56;
      *(float *)&dword_9A234 = *(float *)&dword_9A234 + v59;
      v28 = a1 + 4 * v56;
      while ( v27 < *(__int16 *)(a1 + 0x5034) )
      {
        v30 = *(char *)(*(_DWORD *)(v28 + 0x4F44) + 0x34);
        v50 = &v41;
        v35 = 0.0;
        v36 = 0.0;
        v37 = 0.0;
        v35 = *(float *)(v26 + 0xC * v30) - v47;
        v36 = *(float *)(v26 + 0xC * v30 + 4) - v48;
        v37 = *(float *)(v26 + 0xC * v30 + 8) - v49;
        v41 = v35;
        v42 = v36;
        v43 = v37;
        v31 = sqrt(v36 * v36 + v35 * v35 + v37 * v37);
        v60 = v31;
        if ( v31 > v52 )
        {
          v32 = v60 - v59 * flt_90280;
          v61 = v32;
          if ( v32 >= v52 )
          {
            v51 = 0;
          }
          else
          {
            v61 = v52;
          }
          v29 = 0xC * v30;
          sub_53054(&v41, v61);
          v53 = &v44;
          v38 = v47 + v41;
          v44 = v38;
          v39 = v48 + v42;
          v45 = v39;
          v40 = v49 + v43;
          v46 = v40;
          *(float *)(v29 + v26) = v38;
          *(float *)(v29 + v26 + 4) = v45;
          *(float *)(v29 + v26 + 8) = v46;
        }
        v28 += 4;
        ++v27;
      }
      if ( *(float *)&dword_9A234 >= (double)v55 || v51 == 0xFFFFFFFF )
      {
        *(_DWORD *)(a1 + 0x4F3C) = 3;
        return v54;
      }
    }
    else
    {
      *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) = *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) + flt_9026C;
      v33 = *(_DWORD *)(a1 + 0x4F44);
      if ( *(float *)(v33 + 0xB) <= 1.0 )
      {
        *(_DWORD *)(v33 + 0xB) = 0x3F800000;
        return 0xFFFFFFFF;
      }
    }
  }
  else
  {
    if ( v63 == 0x4A )
    {
      if ( sub_12480((float *)(a1 + 0x4F8C), v19, 10.0) != 0xFFFFFFFF )
      {
        sub_12618(*(_DWORD *)(a1 + 0x4F48));
        return v54;
      }
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) |= 8u;
    }
    *(_DWORD *)(a1 + 0x4F3C) = 1;
  }
  return v54;
}
// 9026C: using guessed type float flt_9026C;
// 90270: using guessed type double dbl_90270;
// 90278: using guessed type float flt_90278;
// 9027C: using guessed type float flt_9027C;
// 90280: using guessed type float flt_90280;
// 9A234: using guessed type int dword_9A234;

//----- (00014224) --------------------------------------------------------
unsigned int __fastcall sub_14224(int a1)
{
  int v2; // edi
  int v3; // esi
  char v4; // ah
  int v5; // edi
  int v6; // edx
  char v7; // bl
  int v8; // eax
  int v9; // eax

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = 0;
  v4 = *(_BYTE *)(v2 + 0xAB);
  v5 = v2 + 0xAB;
  if ( v4 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0xCC);
  }
  v6 = *(_DWORD *)(v5 + 1);
  v7 = **(_BYTE **)(v6 + 0x63);
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 1;
    v8 = sub_12AE4(a1, v6);
    *(_DWORD *)(a1 + 0x4F44) = v8;
    *(_BYTE *)(v8 + 0x33) |= 4u;
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    *(_DWORD *)(a1 + 0x4F40) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v7 + 0x1BCE));
  }
  v9 = *(_DWORD *)(a1 + 0x4F38);
  *(_DWORD *)(a1 + 0x4F40) += v9 & 1;
  if ( v9 == 0x24 )
  {
    return 0xFFFFFFFF;
  }
  return v3;
}

//----- (000142D8) --------------------------------------------------------
int __fastcall sub_142D8(int a1)
{
  int v2; // esi
  char v3; // ah
  int v4; // esi
  int v5; // ebx
  int v6; // edx
  int v7; // eax
  double v8; // st7
  int v9; // edx
  double v10; // st7
  double v11; // st6
  float v13; // [esp+8h] [ebp-40h] BYREF
  float v14; // [esp+Ch] [ebp-3Ch]
  float v15; // [esp+10h] [ebp-38h]
  float v16; // [esp+14h] [ebp-34h]
  float v17; // [esp+18h] [ebp-30h]
  float v18; // [esp+1Ch] [ebp-2Ch]
  float *v19; // [esp+20h] [ebp-28h]
  float v20; // [esp+24h] [ebp-24h]
  float v21; // [esp+28h] [ebp-20h]
  float v22; // [esp+2Ch] [ebp-1Ch]
  char v23; // [esp+30h] [ebp-18h]

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = *(_BYTE *)(v2 + 0xAB);
  v4 = v2 + 0xAB;
  if ( v3 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0xF5);
  }
  v5 = *(_DWORD *)(v4 + 1);
  v6 = *(_DWORD *)(a1 + 0x4F38);
  v23 = **(_BYTE **)(v5 + 0x63);
  if ( !v6 )
  {
    *(_WORD *)(a1 + 0x5034) = 1;
    v7 = sub_12AE4(a1, v5);
    *(_DWORD *)(a1 + 0x4F44) = v7;
    *(_BYTE *)(v7 + 0x33) |= 0x12u;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(float *)(a1 + 0x4F80) = *(float *)(v5 + 0x9E);
    *(_DWORD *)(a1 + 0x4F84) = *(_DWORD *)(v5 + 0xA2);
    *(_DWORD *)(a1 + 0x4F88) = *(_DWORD *)(v5 + 0xA6);
    v16 = 0.0;
    v17 = 0.0;
    v18 = 0.0;
    v19 = &v13;
    v16 = -*(float *)(v5 + 0x9E);
    v17 = -*(float *)(v5 + 0xA2);
    v8 = -*(float *)(v5 + 0xA6);
    v13 = v16;
    v18 = v8;
    v14 = v17;
    v15 = v18;
    *(float *)(a1 + 0x4F8C) = v16;
    *(float *)(a1 + 0x4F90) = v14;
    *(float *)(a1 + 0x4F94) = v15;
    v9 = v23;
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v9 + 0x1BCE));
  }
  v10 = *(float *)(a1 + 0x4F90) * *(float *)(a1 + 0x4F90) + *(float *)(a1 + 0x4F8C) * *(float *)(a1 + 0x4F8C);
  v11 = *(float *)(a1 + 0x4F94) * *(float *)(a1 + 0x4F94);
  v22 = 0.0;
  v21 = sqrt(v10 + v11);
  v20 = sqrt(
          *(float *)(a1 + 0x4F84) * *(float *)(a1 + 0x4F84)
        + *(float *)(a1 + 0x4F80) * *(float *)(a1 + 0x4F80)
        + *(float *)(a1 + 0x4F88) * *(float *)(a1 + 0x4F88));
  if ( v21 > 1.0 )
  {
    v22 = (v21 - v20) * flt_902A0 / v21;
  }
  if ( v22 < dbl_902A4 )
  {
    v22 = 3.2;
  }
  return sub_12480((float *)(a1 + 0x4F80), (float *)(a1 + 0x4F8C), v22);
}
// 902A0: using guessed type float flt_902A0;
// 902A4: using guessed type double dbl_902A4;

//----- (00014490) --------------------------------------------------------
int __fastcall sub_14490(int a1)
{
  int v2; // esi
  char v3; // ah
  int v4; // esi
  int v5; // esi
  _DWORD *v6; // ebx
  int v7; // eax
  float v9; // [esp+0h] [ebp-1Ch]
  char v10; // [esp+4h] [ebp-18h]

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = *(_BYTE *)(v2 + 0xAB);
  v4 = v2 + 0xAB;
  if ( v3 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x127);
  }
  v5 = *(_DWORD *)(v4 + 1);
  if ( *(_BYTE *)(v5 + 0x67) != 2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x12B);
  }
  v6 = *(_DWORD **)(v5 + 0x68);
  v10 = **(_BYTE **)(v5 + 0x63);
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 1;
    v7 = sub_12AE4(a1, v5);
    *(_DWORD *)(a1 + 0x4F44) = v7;
    *(_BYTE *)(v7 + 0x33) |= 0x12u;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(_DWORD *)(a1 + 0x4F80) = *(_DWORD *)(v5 + 0x9E);
    *(_DWORD *)(a1 + 0x4F84) = *(_DWORD *)(v5 + 0xA2);
    *(_DWORD *)(a1 + 0x4F88) = *(_DWORD *)(v5 + 0xA6);
    *(_DWORD *)(a1 + 0x4F8C) = v6[5];
    *(_DWORD *)(a1 + 0x4F90) = v6[6];
    *(_DWORD *)(a1 + 0x4F94) = v6[7];
    if ( *(_DWORD *)(v5 + 0x59) == *v6 )
    {
      *(_DWORD *)(a1 + 0x4F8C) = v6[2];
      *(_DWORD *)(a1 + 0x4F90) = v6[3];
      *(_DWORD *)(a1 + 0x4F94) = v6[4];
    }
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v10 + 0x1BCE));
  }
  v9 = (double)*(int *)(a1 + 0x4F38) * dbl_902C8;
  return sub_12480((float *)(a1 + 0x4F80), (float *)(a1 + 0x4F8C), v9);
}
// 902C8: using guessed type double dbl_902C8;

//----- (000145C0) --------------------------------------------------------
unsigned int __fastcall sub_145C0(int a1)
{
  int v2; // ecx
  char v3; // ah
  int v4; // ecx
  int v5; // ecx
  int v6; // edi
  char v7; // bl
  int v8; // eax
  _BYTE *v9; // eax
  _DWORD *v10; // ecx
  int v11; // eax
  int v12; // eax
  int v13; // edi
  int v15; // ebx
  int v16; // [esp+0h] [ebp-1Ch]

  v2 = *(_DWORD *)(a1 + 0xAB);
  v16 = 0;
  v3 = *(_BYTE *)(v2 + 0xAB);
  v4 = v2 + 0xAB;
  if ( v3 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x158);
  }
  v5 = *(_DWORD *)(v4 + 1);
  if ( *(_BYTE *)(v5 + 0x67) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x15C);
  }
  v6 = *(_DWORD *)(v5 + 0x68);
  v7 = **(_BYTE **)(v5 + 0x63);
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 3;
    v8 = sub_12AE4(a1, v5);
    *(_DWORD *)(a1 + 0x4F44) = v8;
    *(_BYTE *)(v8 + 0x33) |= 4u;
    v9 = (_BYTE *)(*(_DWORD *)(a1 + 0x1D2A) + 0x35);
    *(_DWORD *)(a1 + 0x4F48) = v9;
    *v9 = 7;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) = 0x1A;
    v10 = (_DWORD *)(v5 + 0x9E);
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x34) = 1;
    *(_DWORD *)(a1 + 0x4F8C) = *v10;
    *(_DWORD *)(a1 + 0x4F90) = v10[1];
    *(_DWORD *)(a1 + 0x4F94) = v10[2];
    sub_1826C(a1, *(_DWORD *)(a1 + 0x4F48), *(_WORD *)(a1 + 4 * v7 + 0x1A92), 0);
    v11 = sub_12AE4(a1, v6);
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    *(_DWORD *)(a1 + 0x4F40) = 0;
    *(_DWORD *)(a1 + 0x4F4C) = v11;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v7 + 0x1BCE));
  }
  v12 = *(_DWORD *)(a1 + 0x4F3C);
  if ( !v12 )
  {
    v13 = (*(_DWORD *)(a1 + 0x4F38) & 1) + *(_DWORD *)(a1 + 0x4F40);
    *(_DWORD *)(a1 + 0x4F40) = v13;
    if ( v13 == 0x12 )
    {
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) &= ~4u;
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) &= ~8u;
      *(_DWORD *)(a1 + 0x4F3C) = 1;
      *(_DWORD *)(a1 + 0x4F40) = 0;
    }
    return v16;
  }
  if ( v12 != 1 )
  {
    v15 = (*(_DWORD *)(a1 + 0x4F38) & 1) + *(_DWORD *)(a1 + 0x4F40);
    *(_DWORD *)(a1 + 0x4F40) = v15;
    if ( v15 == 0x12 )
    {
      return 0xFFFFFFFF;
    }
    return v16;
  }
  if ( sub_12480((float *)(a1 + 0x4F8C), (float *)(v6 + 0x9E), 20.0) == 0xFFFFFFFF )
  {
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) |= 8u;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F4C) + 0x33) |= 4u;
    *(_DWORD *)(a1 + 0x4F3C) = 2;
  }
  else
  {
    sub_12618(*(_DWORD *)(a1 + 0x4F48));
  }
  return 0;
}

//----- (000147CC) --------------------------------------------------------
unsigned int __fastcall sub_147CC(int a1)
{
  int v2; // edi
  char v3; // ah
  int v4; // edi
  int v5; // ecx
  int v6; // edx
  int v7; // ebp
  _BYTE *v8; // eax
  int v9; // eax
  double v10; // st7
  double v11; // st7
  int v12; // edx
  float *v13; // edx
  double v14; // st7
  float v16; // [esp+4h] [ebp-84h]
  int v17[3]; // [esp+8h] [ebp-80h] BYREF
  float v18; // [esp+14h] [ebp-74h] BYREF
  float v19; // [esp+18h] [ebp-70h]
  float v20; // [esp+1Ch] [ebp-6Ch]
  float v21; // [esp+20h] [ebp-68h] BYREF
  float v22; // [esp+24h] [ebp-64h]
  float v23; // [esp+28h] [ebp-60h]
  float v24; // [esp+2Ch] [ebp-5Ch]
  float v25; // [esp+30h] [ebp-58h]
  float v26; // [esp+34h] [ebp-54h]
  float v27; // [esp+38h] [ebp-50h]
  float v28; // [esp+3Ch] [ebp-4Ch]
  float v29; // [esp+40h] [ebp-48h]
  float v30; // [esp+44h] [ebp-44h]
  float v31; // [esp+48h] [ebp-40h]
  float v32; // [esp+4Ch] [ebp-3Ch]
  float *v33; // [esp+50h] [ebp-38h]
  int *v34; // [esp+54h] [ebp-34h]
  T_Gizmo *v35; // [esp+58h] [ebp-30h]
  int v36; // [esp+5Ch] [ebp-2Ch]
  int v37; // [esp+60h] [ebp-28h]
  float v38; // [esp+64h] [ebp-24h]
  float *v39; // [esp+68h] [ebp-20h]
  int v40; // [esp+6Ch] [ebp-1Ch]

  v2 = *(_DWORD *)(a1 + 0xAB);
  v37 = 0;
  v3 = *(_BYTE *)(v2 + 0xAB);
  v4 = v2 + 0xAB;
  if ( v3 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x1AC);
  }
  v5 = *(_DWORD *)(v4 + 1);
  if ( *(_BYTE *)(v5 + 0x67) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x1B0);
  }
  v6 = **(char **)(v5 + 0x63);
  v35 = &V_Gizmos[v6];
  v7 = *(_DWORD *)(v5 + 0x68);
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    v8 = *(_BYTE **)(a1 + 0x1D2A);
    *(_WORD *)(a1 + 0x5034) = 2;
    v8 += 0x35;
    *(_DWORD *)(a1 + 0x4F44) = v8;
    *v8 = 7;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) |= 0x12u;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(float *)(a1 + 0x4F80) = *(float *)(v5 + 0x9E);
    *(float *)(a1 + 0x4F84) = *(float *)(v5 + 0xA2);
    *(float *)(a1 + 0x4F88) = *(float *)(v5 + 0xA6);
    v36 = a1 + 4 * v6;
    sub_1826C(a1, *(_DWORD *)(a1 + 0x4F44), *(_WORD *)(v36 + 0x1A92), 0);
    v9 = sub_12AE4(a1, v7);
    *(_DWORD *)(a1 + 0x4F48) = v9;
    *(_BYTE *)(v9 + 0x33) |= 0x12u;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x34) = 1;
    *(float *)(a1 + 0x4F8C) = *(float *)(v7 + 0x9E);
    *(_DWORD *)(a1 + 0x4F90) = *(_DWORD *)(v7 + 0xA2);
    *(_DWORD *)(a1 + 0x4F94) = *(_DWORD *)(v7 + 0xA6);
    v39 = &v18;
    v30 = 0.0;
    v31 = 0.0;
    v32 = 0.0;
    v30 = *(float *)(a1 + 0x4F8C) - *(float *)(a1 + 0x4F80);
    v31 = *(float *)(a1 + 0x4F90) - *(float *)(a1 + 0x4F84);
    v10 = *(float *)(a1 + 0x4F94) - *(float *)(a1 + 0x4F88);
    v18 = v30;
    v32 = v10;
    v19 = v31;
    v20 = v32;
    *(float *)(a1 + 0x4F98) = v30;
    *(float *)(a1 + 0x4F9C) = v19;
    *(float *)(a1 + 0x4FA0) = v20;
    v40 = 0x20 * v35->special1;
    v16 = (float)v40;
    sub_53054((float *)(a1 + 0x4F98), v16);
    v24 = 0.0;
    v25 = 0.0;
    v26 = 0.0;
    v33 = &v21;
    v24 = *(float *)(a1 + 0x4F8C) + *(float *)(a1 + 0x4F98);
    v25 = *(float *)(a1 + 0x4F90) + *(float *)(a1 + 0x4F9C);
    v11 = *(float *)(a1 + 0x4F94) + *(float *)(a1 + 0x4FA0);
    v21 = v24;
    v26 = v11;
    v22 = v25;
    v23 = v26;
    *(float *)(a1 + 0x4F98) = v24;
    *(float *)(a1 + 0x4F9C) = v22;
    *(float *)(a1 + 0x4FA0) = v23;
    v12 = v36;
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(v12 + 0x1BCE));
  }
  v13 = (float *)(a1 + 0x4F8C);
  if ( *(_DWORD *)(a1 + 0x4F3C) )
  {
    v34 = v17;
    v27 = 0.0;
    v28 = 0.0;
    v29 = 0.0;
    v27 = *(float *)(a1 + 0x4F98) - *v13;
    v28 = *(float *)(a1 + 0x4F9C) - *(float *)(a1 + 0x4F90);
    v29 = *(float *)(a1 + 0x4FA0) - *(float *)(a1 + 0x4F94);
    *(float *)v17 = v27;
    *(float *)&v17[1] = v28;
    *(float *)&v17[2] = v29;
    v14 = sqrt(v28 * v28 + v27 * v27 + v29 * v29) * flt_90308;
    v38 = v14;
    if ( v14 >= dbl_9030C )
    {
      if ( v38 > (double)flt_90314 )
      {
        v38 = 50.0;
      }
    }
    else
    {
      v38 = 3.2;
    }
    if ( sub_12480((float *)(a1 + 0x4F8C), (float *)(a1 + 0x4F98), v38) == 0xFFFFFFFF )
    {
      return 0xFFFFFFFF;
    }
  }
  else
  {
    sub_12618(*(_DWORD *)(a1 + 0x4F44));
    if ( sub_12480((float *)(a1 + 0x4F80), v13, 50.0) == 0xFFFFFFFF )
    {
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) |= 8u;
      *(_DWORD *)(a1 + 0x4F3C) = 1;
    }
  }
  return v37;
}
// 90308: using guessed type float flt_90308;
// 9030C: using guessed type double dbl_9030C;
// 90314: using guessed type float flt_90314;

//----- (00014B18) --------------------------------------------------------
unsigned int __fastcall sub_14B18(int a1, int a2, int a3)
{
  int v4; // ecx
  char v5; // ah
  int v6; // ecx
  int v7; // ecx
  int v8; // ebp
  int v9; // edi
  _BYTE *v10; // eax
  char v11; // bl
  _DWORD *v12; // ecx
  unsigned int v13; // ebx
  int v14; // edx
  int v15; // eax
  float *v16; // ecx
  float *v17; // edx
  double v18; // st7
  char v19; // bh
  int v20; // eax
  float *v21; // edx
  int v22; // ebp
  int v23; // eax
  int v25; // edi
  int v26; // ecx
  int v27; // ebx
  int v28; // edx
  int v29; // edx
  double v30; // st7
  int v31; // ecx
  float v32; // [esp+4h] [ebp-228h]
  int v33[107]; // [esp+8h] [ebp-224h] BYREF
  float v34; // [esp+1B4h] [ebp-78h]
  float v35; // [esp+1B8h] [ebp-74h]
  float v36; // [esp+1BCh] [ebp-70h]
  float v37; // [esp+1C0h] [ebp-6Ch]
  float v38; // [esp+1C4h] [ebp-68h]
  float v39; // [esp+1C8h] [ebp-64h]
  float v40; // [esp+1CCh] [ebp-60h] BYREF
  float v41; // [esp+1D0h] [ebp-5Ch]
  float v42; // [esp+1D4h] [ebp-58h]
  float v43; // [esp+1D8h] [ebp-54h] BYREF
  float v44; // [esp+1DCh] [ebp-50h]
  float v45; // [esp+1E0h] [ebp-4Ch]
  float v46; // [esp+1E4h] [ebp-48h]
  float v47; // [esp+1E8h] [ebp-44h]
  float v48; // [esp+1ECh] [ebp-40h]
  int v49; // [esp+1F0h] [ebp-3Ch]
  float *v50; // [esp+1F4h] [ebp-38h]
  float special1; // [esp+1F8h] [ebp-34h]
  float *v52; // [esp+1FCh] [ebp-30h]
  int v53; // [esp+200h] [ebp-2Ch]
  int v54; // [esp+204h] [ebp-28h]
  int v55; // [esp+208h] [ebp-24h]
  float v56; // [esp+20Ch] [ebp-20h]
  char v57; // [esp+210h] [ebp-1Ch]

  v4 = *(_DWORD *)(a1 + 0xAB);
  v53 = 0;
  v5 = *(_BYTE *)(v4 + 0xAB);
  v6 = v4 + 0xAB;
  if ( v5 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x1F9);
  }
  v7 = *(_DWORD *)(v6 + 1);
  v8 = v7;
  v57 = **(_BYTE **)(v7 + 0x63);
  if ( v57 == 0x28 )
  {
    if ( *(_BYTE *)(v7 + 0x67) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x201);
    }
    v8 = *(_DWORD *)(v7 + 0x68);
  }
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    v9 = sub_1D794(*(__int16 **)(v7 + 0x59), v33);
    *(_WORD *)(a1 + 0x5034) = 2;
    *(_DWORD *)(a1 + 0x4F44) = sub_12AE4(a1, v8);
    v10 = (_BYTE *)(*(_DWORD *)(a1 + 0x1D2A) + 0x35);
    *(_DWORD *)(a1 + 0x4F48) = v10;
    v11 = v57;
    *v10 = 0xFF;
    if ( v11 == 0x28 )
    {
      **(_BYTE **)(a1 + 0x4F48) = 7;
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) = 0x12;
      v12 = (_DWORD *)(v7 + 0x9E);
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x34) = 1;
      *(_DWORD *)(a1 + 0x4F8C) = *v12;
      *(_DWORD *)(a1 + 0x4F90) = v12[1];
      *(_DWORD *)(a1 + 0x4F94) = v12[2];
      sub_1826C(a1, *(_DWORD *)(a1 + 0x4F48), *(_WORD *)(a1 + 4 * v57 + 0x1A92), 0);
    }
    if ( v9 > 0 )
    {
      v13 = 0;
      v49 = a1 + 0x4F80;
      v55 = 4 * v9;
      do
      {
        if ( *(__int16 *)(a1 + 0x5034) >= 0xF )
        {
          break;
        }
        v14 = v33[v13 / 4];
        if ( *(_BYTE *)(v14 + 0x58) == 4 && v14 != v8 )
        {
          v15 = sub_12AE4(a1, v14);
          *(_BYTE *)(v15 + 0x33) |= 0x12u;
          *(_BYTE *)(v15 + 0x34) = *(_BYTE *)(a1 + 0x5034);
          v16 = (float *)v33[v13 / 4];
          v17 = (float *)(a1 + 0x4F80 + 0xC * *(char *)(v15 + 0x34));
          v18 = *(float *)((char *)v16 + 0x9E);
          v16 = (float *)((char *)v16 + 0x9E);
          *v17 = v18;
          v17[1] = v16[1];
          v17[2] = v16[2];
          LOWORD(v17) = *(_WORD *)(a1 + 0x5034);
          *(_WORD *)(a1 + 0x5034) = (_WORD)v17 + 1;
          *(_DWORD *)(a1 + 4 * (__int16)v17 + 0x4F44) = v15;
        }
        v13 += 4;
      }
      while ( (int)v13 < v55 );
    }
    v19 = v57;
    *(_DWORD *)(a1 + 0x4F3C) = 1;
    if ( v19 == 0x28 )
    {
      *(_DWORD *)(a1 + 0x4F3C) = 0;
    }
    v20 = v57;
    *(_DWORD *)(a1 + 0x4F40) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v20 + 0x1BCE));
    dword_9A238 = 0;
  }
  v21 = (float *)(v8 + 0x9E);
  v22 = *(_DWORD *)(a1 + 0x4F3C);
  if ( v22 )
  {
    if ( v22 == 1 )
    {
      v23 = *(_DWORD *)(a1 + 0x4F44);
      *(_DWORD *)(a1 + 0x4F40) += *(_DWORD *)(a1 + 0x4F38) & 1;
      *(_BYTE *)(v23 + 0x33) |= 4u;
      if ( *(_DWORD *)(a1 + 0x4F40) == 9 )
      {
        *(_DWORD *)(a1 + 0x4F3C) = 2;
        return v53;
      }
    }
    else if ( v22 == 2 )
    {
      v46 = *v21;
      v47 = v21[1];
      v48 = v21[2];
      v25 = a1 + 0x4F80;
      v26 = 2;
      v27 = a1 + 8;
      special1 = (float)V_Gizmos[v57].special1;
      v54 = 0xFFFFFFFF;
      *(float *)&dword_9A238 = *(float *)&dword_9A238 + flt_90334;
      while ( v26 < *(__int16 *)(a1 + 0x5034) )
      {
        v29 = *(char *)(*(_DWORD *)(v27 + 0x4F44) + 0x34);
        v50 = &v40;
        v34 = 0.0;
        v35 = 0.0;
        v36 = 0.0;
        v34 = *(float *)(v25 + 0xC * v29) - v46;
        v35 = *(float *)(v25 + 0xC * v29 + 4) - v47;
        v36 = *(float *)(v25 + 0xC * v29 + 8) - v48;
        v40 = v34;
        v41 = v35;
        v42 = v36;
        v30 = sqrt(v35 * v35 + v34 * v34 + v36 * v36) * flt_90338 + flt_90334;
        v56 = v30;
        if ( v30 < special1 )
        {
          v54 = 0;
        }
        else
        {
          v56 = special1;
        }
        v28 = 0xC * v29;
        v32 = v56 * flt_9033C;
        sub_53054(&v40, v32);
        v52 = &v43;
        v37 = v46 + v40;
        v43 = v37;
        v38 = v47 + v41;
        v44 = v38;
        v39 = v48 + v42;
        v45 = v39;
        *(float *)(v28 + v25) = v37;
        *(float *)(v28 + v25 + 4) = v44;
        v27 += 4;
        ++v26;
        *(float *)(v28 + v25 + 8) = v45;
      }
      if ( *(float *)&dword_9A238 >= (double)special1 || v54 == 0xFFFFFFFF )
      {
        *(_DWORD *)(a1 + 0x4F3C) = 3;
        return v53;
      }
    }
    else
    {
      v31 = (*(_DWORD *)(a1 + 0x4F38) & 1) + *(_DWORD *)(a1 + 0x4F40);
      *(_DWORD *)(a1 + 0x4F40) = v31;
      if ( v31 == 0x12 )
      {
        return 0xFFFFFFFF;
      }
    }
  }
  else
  {
    sub_12618(*(_DWORD *)(a1 + 0x4F48));
    if ( sub_12480((float *)(a1 + 0x4F8C), v21, 10.0) == 0xFFFFFFFF )
    {
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) |= 8u;
      *(_DWORD *)(a1 + 0x4F3C) = 1;
    }
  }
  return v53;
}
// 90334: using guessed type float flt_90334;
// 90338: using guessed type float flt_90338;
// 9033C: using guessed type float flt_9033C;
// 9A238: using guessed type int dword_9A238;

//----- (00015078) --------------------------------------------------------
unsigned int __fastcall sub_15078(int a1)
{
  int v2; // edi
  int v3; // esi
  char v4; // ah
  int v5; // edi
  int v6; // edx
  char v7; // bl
  int v8; // eax

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = 0;
  v4 = *(_BYTE *)(v2 + 0xAB);
  v5 = v2 + 0xAB;
  if ( v4 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x283);
  }
  v6 = *(_DWORD *)(v5 + 1);
  v7 = **(_BYTE **)(v6 + 0x63);
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 1;
    v8 = sub_12AE4(a1, v6);
    *(_DWORD *)(a1 + 0x4F44) = v8;
    *(_BYTE *)(v8 + 0x33) |= 4u;
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    *(_DWORD *)(a1 + 0x4F40) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 4 * v7 + 0x1BCE));
  }
  if ( *(_DWORD *)(a1 + 0x4F3C) )
  {
    *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) = *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) + flt_9034E;
    if ( *(float *)(*(_DWORD *)(a1 + 0x4F44) + 0xB) < dbl_90352 )
    {
      return 0xFFFFFFFF;
    }
  }
  else
  {
    *(_DWORD *)(a1 + 0x4F40) += (*(_BYTE *)(a1 + 0x4F38) & 3) == 0;
    if ( *(_DWORD *)(a1 + 0x4F40) == 9 )
    {
      *(_DWORD *)(a1 + 0x4F3C) = 1;
    }
  }
  return v3;
}
// 9034E: using guessed type float flt_9034E;
// 90352: using guessed type double dbl_90352;

//----- (00015164) --------------------------------------------------------
unsigned int __fastcall sub_15164(int a1)
{
  int v2; // ecx
  unsigned int v3; // edi
  char v4; // ah
  int v5; // ecx
  int v6; // ebx
  int v7; // eax
  _BYTE *v8; // eax
  int v9; // ebp
  int v10; // edx

  v2 = *(_DWORD *)(a1 + 0xAB);
  v3 = 0;
  v4 = *(_BYTE *)(v2 + 0xAB);
  v5 = v2 + 0xAB;
  if ( v4 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x2B5);
  }
  v6 = *(_DWORD *)(v5 + 1);
  if ( !*(_DWORD *)(a1 + 0x4F38) )
  {
    *(_WORD *)(a1 + 0x5034) = 2;
    v7 = sub_12AE4(a1, v6);
    *(_DWORD *)(a1 + 0x4F44) = v7;
    *(_BYTE *)(v7 + 0x33) |= 4u;
    v8 = (_BYTE *)(*(_DWORD *)(a1 + 0x1D2A) + 0x35);
    *(_DWORD *)(a1 + 0x4F48) = v8;
    *v8 = 0xFF;
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    *(_DWORD *)(a1 + 0x4F40) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 0x1CEE));
  }
  v9 = *(_DWORD *)(a1 + 0x4F3C);
  if ( v9 )
  {
    if ( v9 == 1 )
    {
      if ( (*(_BYTE *)(a1 + 0x4F38) & 3) == 0 && sub_12618(*(_DWORD *)(a1 + 0x4F48)) == 0xFFFFFFFF )
      {
        v3 = 0xFFFFFFFF;
      }
      *(_DWORD *)(*(_DWORD *)(a1 + 0x4F48) + 0xB) = 0x40A00000;
    }
  }
  else
  {
    v10 = (*(_DWORD *)(a1 + 0x4F38) & 1) + *(_DWORD *)(a1 + 0x4F40);
    *(_DWORD *)(a1 + 0x4F40) = v10;
    if ( v10 == 9 )
    {
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) |= 8u;
      **(_BYTE **)(a1 + 0x4F48) = 7;
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x33) |= 0x10u;
      *(_BYTE *)(*(_DWORD *)(a1 + 0x4F48) + 0x34) = 1;
      *(float *)(a1 + 0x4F8C) = *(float *)(v6 + 0x9E);
      *(_DWORD *)(a1 + 0x4F90) = *(_DWORD *)(v6 + 0xA2);
      *(_DWORD *)(a1 + 0x4F94) = *(_DWORD *)(v6 + 0xA6);
      sub_1826C(a1, *(_DWORD *)(a1 + 0x4F48), *(_WORD *)(a1 + 0x1BB2), 0);
      *(_DWORD *)(*(_DWORD *)(a1 + 0x4F48) + 0xB) = 0x40A00000;
      *(_DWORD *)(a1 + 0x4F3C) = 1;
      return 0;
    }
  }
  return v3;
}

//----- (000152E4) --------------------------------------------------------
unsigned int __fastcall sub_152E4(int a1, int a2, int a3, int a4)
{
  int v5; // esi
  char v6; // ah
  int v7; // esi
  int v8; // ebx
  _BYTE *v9; // eax
  int v10; // edx
  int v11; // eax
  int v12; // esi
  int v13; // edx
  unsigned int v14; // eax
  int v15; // ebp
  int v16; // edx
  int v17; // ebx
  int v18; // ebx
  _BYTE *v19; // eax
  int v21; // eax
  unsigned __int16 v22; // si
  char v23; // al
  int v24; // eax
  int v25[107]; // [esp+0h] [ebp-1DCh] BYREF
  T_Gizmo *v26; // [esp+1ACh] [ebp-30h]
  int v27; // [esp+1B0h] [ebp-2Ch]
  int v28; // [esp+1B4h] [ebp-28h]
  int v29; // [esp+1B8h] [ebp-24h]
  int v30; // [esp+1BCh] [ebp-20h]
  char v31; // [esp+1C0h] [ebp-1Ch]

  v5 = *(_DWORD *)(a1 + 0xAB);
  v27 = 0;
  v6 = *(_BYTE *)(v5 + 0xAB);
  v7 = v5 + 0xAB;
  if ( v6 != 3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batfxa.cpp", 0x2FA);
  }
  v28 = *(_DWORD *)(v7 + 1);
  v8 = *(_DWORD *)(a1 + 0x4F38);
  v31 = 0x26;
  v26 = &V_Gizmos[0x26];
  if ( !v8 )
  {
    *(_WORD *)(a1 + 0x5034) = 1;
    v9 = *(_BYTE **)(a1 + 0x1D2A);
    *(_DWORD *)(a1 + 0x4F44) = v9;
    *v9 = 0xFF;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x33) |= 0x12u;
    v10 = v28 + 0x9E;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x4F44) + 0x34) = 0;
    *(_DWORD *)(a1 + 0x4F80) = *(_DWORD *)v10;
    *(_DWORD *)(a1 + 0x4F84) = *(_DWORD *)(v10 + 4);
    *(float *)(a1 + 0x4F88) = *(float *)(v10 + 8);
    *(_DWORD *)(a1 + 0x4F3C) = 0;
    Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(a1 + 0x1C66));
  }
  if ( **(_BYTE **)(a1 + 0x4F44) == 0xFF )
  {
    v11 = sub_1D794(*(__int16 **)(v28 + 0x59), v25);
    v12 = (unsigned __int8)*(_DWORD *)(a1 + 0x4F3C);
    v13 = v11;
    if ( v12 < v11 )
    {
      v14 = 4 * v12;
      v15 = *(__int16 *)(v28 + 0x56);
      v29 = 4 * v13;
      while ( 1 )
      {
        v16 = v25[v14 / 4];
        v17 = *(__int16 *)(v16 + 0x56);
        if ( *(_BYTE *)(v16 + 0x58) == 4 && v15 != v17 && V_Game.races[v15].Unknown_1C0[v17] == 2 )
        {
          break;
        }
        v14 += 4;
        ++v12;
        if ( (int)v14 >= v29 )
        {
          goto LABEL_15;
        }
      }
      *(_WORD *)(a1 + 0x5034) = 2;
      v18 = v25[v14 / 4];
      *(_DWORD *)(a1 + 0x4F8C) = *(_DWORD *)(v18 + 0x9E);
      *(_DWORD *)(a1 + 0x4F90) = *(_DWORD *)(v18 + 0xA2);
      *(_DWORD *)(a1 + 0x4F94) = *(_DWORD *)(v18 + 0xA6);
      **(_BYTE **)(a1 + 0x4F44) = 7;
      *(_DWORD *)(a1 + 0x4F48) = sub_12AE4(a1, v25[v14 / 4]);
      sub_1826C(a1, *(_DWORD *)(a1 + 0x4F44), *(_WORD *)(a1 + 4 * v31 + 0x1A92), 0);
      *(_DWORD *)(a1 + 0x4F3C) = v12 + 1;
    }
LABEL_15:
    if ( **(_BYTE **)(a1 + 0x4F44) == 0xFF )
    {
      v27 = 0xFFFFFFFF;
    }
  }
  v19 = *(_BYTE **)(a1 + 0x4F44);
  if ( *v19 == 0xFF )
  {
    return 0xFFFFFFFF;
  }
  if ( (*(_BYTE *)(a1 + 0x4F3D) & 1) != 0 )
  {
    if ( (*(_BYTE *)(a1 + 0x4F38) & 3) == 0 && sub_12618((int)v19) == 0xFFFFFFFF )
    {
      **(_BYTE **)(a1 + 0x4F44) = 0xFF;
      *(_DWORD *)(a1 + 0x4F3C) = (unsigned __int8)*(_DWORD *)(a1 + 0x4F3C);
      return v27;
    }
  }
  else
  {
    sub_12618((int)v19);
    if ( sub_12480((float *)(a1 + 0x4F80), (float *)(a1 + 0x4F8C), 50.0) == 0xFFFFFFFF )
    {
      v21 = *(_DWORD *)(a1 + 0x4F48);
      LOWORD(v30) = 1;
      v22 = 4;
      v23 = sub_4B7A0(*(_DWORD *)(v21 + 1), 0, v26->special1, *(_WORD *)(v28 + 0x56));
      if ( (v23 & 4) != 0 )
      {
        v24 = *(_DWORD *)(a1 + 0x4F48);
        LOWORD(v30) = 5;
        v22 = 5;
        *(_BYTE *)(v24 + 0x33) |= 8u;
      }
      else if ( (v23 & 2) != 0 )
      {
        v22 = *(_WORD *)(a1 + 4 * v31 + 0x1A94);
        LOWORD(v30) = *(_WORD *)(a1 + 4 * v31 + 0x1BD0);
      }
      sub_1826C(a1, *(_DWORD *)(a1 + 0x4F44), v22, 0);
      Q_StartSample_sub_4FB90(&V_SoundSystem, v30);
      *(_BYTE *)(a1 + 0x4F3D) |= 1u;
    }
  }
  return v27;
}

//----- (00015630) --------------------------------------------------------
void __fastcall sub_15630(int a1, int a2)
{
  int v3; // eax
  void *ShapeTable_sub_1B084; // eax
  LONG v5; // [esp-20h] [ebp-30h]
  LONG v6; // [esp-1Ch] [ebp-2Ch]
  LONG v7; // [esp-18h] [ebp-28h]
  LONG v8; // [esp-8h] [ebp-18h]

  v3 = *(_DWORD *)(a1 + 0x4F40);
  if ( v3 > 9 )
  {
    v3 = 0x12 - v3;
  }
  if ( v3 >= 0 )
  {
    if ( v3 > 9 )
    {
      v3 = 9;
    }
  }
  else
  {
    v3 = 0;
  }
  VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[v3 + 0xB]);
  v8 = *(_DWORD *)(a2 + 0xF);
  v7 = *(__int16 *)(a2 + 0x29);
  v6 = *(__int16 *)(a2 + 0x27);
  v5 = *(_DWORD *)(a2 + 7);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           *(unsigned __int16 *)(a2 + 5));
  VFX_shape_transform((PANE *)(a1 + 4), ShapeTable_sub_1B084, v5, v6, v7, V_BigBuffer, 0, v8, v8, 1);
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (000156C0) --------------------------------------------------------
void __fastcall sub_156C0(int a1, int a2, unsigned __int16 shpNum)
{
  void *ShapeTable_sub_1B084; // ebp
  RECT rect; // [esp+0h] [ebp-24h] BYREF
  int v6; // [esp+10h] [ebp-14h]

  v6 = a2;
  *(_DWORD *)(a1 + 0xB) = 0x3F800000;
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           (unsigned __int16)v6);
  if ( shpNum >= VFX_shape_count(ShapeTable_sub_1B084) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x38);
  }
  VFX_shape_visible_rectangle(ShapeTable_sub_1B084, shpNum, 0, 0, 0, &rect);
  if ( rect.x0 > 1000000 || rect.x0 < -1000000 )
  {
    memset(&rect, 0, sizeof(rect));
  }
  *(_WORD *)(a1 + 0x13) = rect.x0;
  *(_WORD *)(a1 + 0x15) = rect.y0;
  *(_WORD *)(a1 + 0x17) = rect.x1;
  *(_WORD *)(a1 + 0x19) = rect.y1;
  *(_WORD *)(a1 + 5) = v6;
  *(_DWORD *)(a1 + 7) = shpNum;
}

//----- (0001577C) --------------------------------------------------------
int __fastcall sub_1577C(int a1)
{
  sub_15788(a1);
  return a1;
}

//----- (00015788) --------------------------------------------------------
int __fastcall sub_15788(int result)
{
  *(_DWORD *)(result + 0x800) = 0;
  return result;
}

//----- (00015794) --------------------------------------------------------
int __fastcall sub_15794(int result, int a2)
{
  int v2; // ebx

  v2 = *(_DWORD *)(result + 0x800);
  if ( v2 < 0x200 )
  {
    if ( a2 )
    {
      *(_DWORD *)(result + 4 * v2) = a2;
      ++*(_DWORD *)(result + 0x800);
    }
  }
  return result;
}

//----- (000157B4) --------------------------------------------------------
int __fastcall sub_157B4(const void *a1, const void *a2)
{
  int v2; // edx
  float v4; // [esp+0h] [ebp-8h]
  float v5; // [esp+4h] [ebp-4h]

  v5 = *(float *)(*(_DWORD *)a1 + 0x2F);
  v4 = *(float *)(*(_DWORD *)a2 + 0x2F);
  v2 = 0;
  if ( v5 > (double)v4 )
  {
    return 0xFFFFFFFF;
  }
  if ( v5 < (double)v4 )
  {
    return 1;
  }
  return v2;
}

//----- (000157EC) --------------------------------------------------------
void __fastcall sub_157EC(size_t *a1)
{
  qsort(a1, a1[0x200], 4u, sub_157B4);
}

//----- (00015808) --------------------------------------------------------
char *__fastcall sub_15808(int a1, int a2, int a3)
{
  int v3; // edi
  char **v4; // esi
  char *v5; // ecx
  float v7; // [esp+Ch] [ebp-24h]
  float v8; // [esp+10h] [ebp-20h]
  float v9; // [esp+18h] [ebp-18h]
  float v10; // [esp+1Ch] [ebp-14h]
  float v11; // [esp+20h] [ebp-10h]

  v3 = *(_DWORD *)(a1 + 0x800) - 1;
  v4 = (char **)(a1 + 4 * v3);
  while ( (v3 & 0x8000u) == 0 )
  {
    if ( !v4 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x9E);
    }
    v5 = *v4;
    if ( **v4 >= 9 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0xA2);
    }
    if ( *v5 == 5 )
    {
      if ( (*(__int16 *)(v5 + 0x27) - a2) * (*(__int16 *)(v5 + 0x27) - a2)
         + (*(__int16 *)(v5 + 0x29) - a3) * (*(__int16 *)(v5 + 0x29) - a3) < 0x50 )
      {
        return *v4;
      }
    }
    else if ( *v5 != 4 )
    {
      v8 = (double)*(unsigned int *)(v5 + 0xF) * flt_903A5;
      v7 = (float)*(__int16 *)(v5 + 0x27);
      v9 = (float)a2;
      if ( (double)*(__int16 *)(v5 + 0x13) * v8 + v7 <= v9 )
      {
        v11 = (float)*(__int16 *)(v5 + 0x29);
        v10 = (float)a3;
        if ( (double)*(__int16 *)(v5 + 0x15) * v8 + v11 <= v10
          && (double)*(__int16 *)(v5 + 0x17) * v8 + v7 >= v9
          && (double)*(__int16 *)(v5 + 0x19) * v8 + v11 >= v10 )
        {
          return *v4;
        }
      }
    }
    LOWORD(v3) = v3 - 1;
    v4 += 0xFFFFFFFF;
  }
  return 0;
}
// 903A5: using guessed type float flt_903A5;

//----- (00015948) --------------------------------------------------------
int __fastcall sub_15948(int a1, int a2)
{
  PANE *v2; // ebp
  unsigned int v3; // eax
  LONG v4; // eax
  int v5; // edx
  int v6; // edi
  __int64 v7; // rax
  double v8; // st7
  void *ShapeTable_sub_1B084; // eax
  double v10; // st6
  int result; // eax
  _BYTE *v12; // esi
  LONG v13; // [esp-20h] [ebp-88h]
  LONG v14; // [esp-1Ch] [ebp-84h]
  LONG v15; // [esp-18h] [ebp-80h]
  LONG v16; // [esp-8h] [ebp-70h]
  int v17; // [esp-4h] [ebp-6Ch]
  int v19; // [esp+Ch] [ebp-5Ch]
  int v20; // [esp+18h] [ebp-50h]
  float v22; // [esp+20h] [ebp-48h]
  int v23; // [esp+24h] [ebp-44h]
  _BYTE **v24; // [esp+2Ch] [ebp-3Ch]
  int v25; // [esp+30h] [ebp-38h]
  __int16 v26; // [esp+40h] [ebp-28h]
  int v27; // [esp+4Ah] [ebp-1Eh]

  v24 = (_BYTE **)a1;
  v26 = 0;
  v2 = (PANE *)(a2 + 4);
  while ( 1 )
  {
    result = v26;
    if ( v26 >= *(_DWORD *)(a1 + 0x800) )
    {
      break;
    }
    v12 = *v24;
    if ( (**v24 != 4 || *(_DWORD *)(a2 + 0x504A)) && *v12 != 0xFF )
    {
      if ( *(_DWORD *)(v12 + 0x23) && (*(_DWORD *)(a2 + 0x5042) || *v12 == 6) && (v12[0x33] & 2) == 0 )
      {
        v3 = 0xFFFFFFFF;
      }
      else
      {
        v3 = 0;
      }
      if ( v3 )
      {
        v4 = 0x72;
        if ( *(_DWORD *)(v12 + 0x1F) )
        {
          v4 = 0x90;
        }
        if ( *v12 == 6 && *(_BYTE *)(a2 + 0xB7) == 3 )
        {
          v4 = 0xF3;
        }
        VFX_line_draw(
          v2,
          *(__int16 *)(v12 + 0x2B),
          *(__int16 *)(v12 + 0x2D),
          *(__int16 *)(v12 + 0x27),
          *(__int16 *)(v12 + 0x29),
          0,
          v4);
      }
      if ( (v12[0x33] & 8) == 0 )
      {
        if ( (v12[0x33] & 4) != 0 )
        {
          sub_139E0(a2, (int)v12);
        }
        else
        {
          v5 = *(unsigned __int16 *)(v12 + 5);
          if ( (unsigned __int16)v5 != 0xFFFF )
          {
            if ( *v12 == 8 )
            {
              v25 = v12[0x33] & 4;
              v6 = *(_DWORD *)(v12 + 1);
              v23 = v25;
              v7 = *(__int16 *)(v12 + 0x27) - *(__int16 *)(v6 + 0x27);
              v19 = (HIDWORD(v7) ^ v7) - HIDWORD(v7);
              if ( 2 * v19 )
              {
                v8 = flt_903AD / (double)(2 * v19);
                v25 = (int)((double)v19 * v8 + dbl_903B1);
                v23 = (int)(v8 * (double)v19 + dbl_903B1);
              }
              VFX_line_draw(
                v2,
                v25 + *(__int16 *)(v12 + 0x27),
                v23 + *(__int16 *)(v12 + 0x29),
                v25 + *(__int16 *)(v6 + 0x27),
                v23 + *(__int16 *)(v6 + 0x29),
                0,
                0x6A);
              VFX_line_draw(
                v2,
                *(__int16 *)(v12 + 0x27) - v25,
                *(__int16 *)(v12 + 0x29) - v23,
                *(__int16 *)(v6 + 0x27) - v25,
                *(__int16 *)(v6 + 0x29) - v23,
                0,
                0x6A);
              VFX_line_draw(
                v2,
                *(__int16 *)(v12 + 0x27),
                *(__int16 *)(v12 + 0x29),
                *(__int16 *)(v6 + 0x27),
                *(__int16 *)(v6 + 0x29),
                0,
                0x6D);
            }
            else
            {
              v17 = v12[0x33] & 4;
              v16 = *(_DWORD *)(v12 + 0xF);
              v15 = *(__int16 *)(v12 + 0x29);
              v14 = *(__int16 *)(v12 + 0x27);
              v13 = *(_DWORD *)(v12 + 7);
              ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, v5);
              VFX_shape_transform(v2, ShapeTable_sub_1B084, v13, v14, v15, V_BigBuffer, v17, v16, v16, v17);
            }
          }
        }
      }
      v22 = (double)*(unsigned int *)(v12 + 0xF) * flt_903A9;
      if ( *v12 == 1 && sub_361B8(*(T_Planet **)(v12 + 1)) == 0xFFFFFFFF )
      {
        v20 = (int)((double)*(__int16 *)(v12 + 0x17) * v22 + flt_903B9);
        VFX_ellipse_draw(
          v2,
          *(__int16 *)(v12 + 0x27),
          *(__int16 *)(v12 + 0x29),
          (__int16)v20,
          (__int16)v20,
          4 * V_Game.races[*(unsigned __int8 *)(*(_DWORD *)(v12 + 1) + 0x57)].Unknown_02 + 0x13);
      }
      if ( v12 == *(_BYTE **)(a2 + 0xB3) )
      {
        v10 = (double)*(__int16 *)(v12 + 0x27);
        HIWORD(v27) = (int)((double)*(__int16 *)(v12 + 0x13) * v22 + v10);
        sub_2BB74(
          v2,
          v27 >> 0x10,
          (__int16)(int)((double)*(__int16 *)(v12 + 0x15) * v22 + (double)*(__int16 *)(v12 + 0x29)),
          (__int16)(int)(v10 + (double)*(__int16 *)(v12 + 0x17) * v22),
          (__int16)(int)(v22 * (double)*(__int16 *)(v12 + 0x19) + (double)*(__int16 *)(v12 + 0x29)),
          0xF3u,
          0);
      }
    }
    ++v26;
    ++v24;
  }
  return result;
}
// 15C73: variable 'v27' is possibly undefined
// 903A9: using guessed type float flt_903A9;
// 903AD: using guessed type float flt_903AD;
// 903B1: using guessed type double dbl_903B1;
// 903B9: using guessed type float flt_903B9;
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (00015D20) --------------------------------------------------------
int __fastcall sub_15D20(int a1)
{
  sub_15D2C(a1);
  return a1;
}

//----- (00015D2C) --------------------------------------------------------
int __fastcall sub_15D2C(int result)
{
  *(_DWORD *)(result + 0x1900) = 0;
  return result;
}

//----- (00015D38) --------------------------------------------------------
int __fastcall sub_15D38(int result, const void *a2)
{
  int v2; // ebx
  int v4; // edx

  v2 = result;
  v4 = *(_DWORD *)(result + 0x1900);
  if ( v4 < 0x40 )
  {
    result = 0x64 * v4;
    qmemcpy((void *)(v2 + 0x64 * v4), a2, 0x64u);
    ++*(_DWORD *)(v2 + 0x1900);
  }
  return result;
}

//----- (00015D74) --------------------------------------------------------
int __fastcall sub_15D74(int result, int a2)
{
  int v2; // esi
  int i; // ecx

  v2 = result;
  for ( i = 0; i < *(_DWORD *)(v2 + 0x1900); ++i )
  {
    result = sub_15DA4(v2, a2, i);
  }
  return result;
}

//----- (00015DA4) --------------------------------------------------------
int __fastcall sub_15DA4(int result, int a2, unsigned __int16 a3)
{
  int v4; // edx
  int v5; // ecx
  int v6; // eax

  if ( a3 < *(int *)(result + 0x1900) )
  {
    v4 = result + 0x64 * a3;
    v5 = *(_DWORD *)(v4 + 0x60);
    if ( v5 < 0 || v5 >= 7 )
    {
      v6 = 0;
    }
    else
    {
      v6 = V_Game.races[v5].Unknown_02 + 1;
    }
    return sub_62DA5((WINDOW *)(a2 + 4), 4, v4, (v6 << 8) + 0x1F00 + *(_DWORD *)(a2 + 0x19BE));
  }
  return result;
}

//----- (00015E1C) --------------------------------------------------------
void __fastcall sub_15E1C(int *a1, int a2)
{
  int *v2; // ebp
  int v3; // eax
  LONG *v4; // esi
  int j; // edi
  LONG v6; // [esp-18h] [ebp-3Ch]
  LONG v7; // [esp-14h] [ebp-38h]
  int i; // [esp+4h] [ebp-20h]
  int parm; // [esp+Ch] [ebp-18h]

  v2 = a1;
  for ( i = 0; i < a1[0x640]; ++i )
  {
    v3 = v2[0x18];
    if ( v3 < 0 || v3 >= 7 )
    {
      parm = 0x6D;
    }
    else
    {
      parm = 4 * V_Game.races[v3].Unknown_02 + 0x13;
    }
    v4 = v2;
    for ( j = 0; j < 4; VFX_line_draw((PANE *)(a2 + 4), v6, v7, v2[6 * (j & 3)], v2[6 * (j & 3) + 1], 0, parm) )
    {
      ++j;
      v7 = v4[1];
      v6 = *v4;
      v4 += 6;
    }
    v2 += 0x19;
  }
  JUMPOUT(0x15ED0);
}
// 15ECF: control flows out of bounds to 15ED0

//----- (00015ED4) --------------------------------------------------------
int __fastcall sub_15ED4(T_TypeA2 *a1)
{
  int v1; // eax
  int v2; // eax
  _DWORD *v3; // eax
  int v4; // eax
  int v5; // eax
  int v6; // eax
  int v7; // eax
  _DWORD *v8; // eax
  int v9; // edx

  Q_A2_sub_2C830(a1);
  v1 = _wcpp_2_ctor_array_((char *)&a1[1].a1.pane.x1 + 3, 0x64, &unk_959D8);
  v2 = _wcpp_2_ctor_array_(v1 + 0x4B0, 0x64, &unk_95A3C);
  v3 = (_DWORD *)(_wcpp_2_ctor_array_(v2 + 0xFA0, 0x64, &unk_959D8) + 0x7FC);
  *v3 = 0;
  v3 += 5;
  v3[0xFFFFFFFC] = 0;
  v3[0xFFFFFFFD] = 0;
  v3[1] = 0;
  v3[2] = 0;
  *v3 = 0;
  v4 = sub_1577C((int)(v3 + 6));
  v5 = sub_1577C(v4 + 0x804);
  v6 = sub_1577C(v5 + 0x804);
  v7 = sub_15D20(v6 + 0x804);
  v8 = sub_1B4F0((_DWORD *)(v7 + 0x1904)) + 0x26;
  *v8 = 0;
  v8 += 3;
  v8[0xFFFFFFFE] = 0;
  v8[0xFFFFFFFF] = 0;
  *v8 = 0;
  v8 += 3;
  v8[0xFFFFFFFE] = 0;
  v8[0xFFFFFFFF] = 0;
  *v8 = 0;
  v8 += 3;
  v8[0xFFFFFFFE] = 0;
  v8[0xFFFFFFFF] = 0;
  *v8 = 0;
  v8 += 0xFFFFFFFA;
  v8[7] = 0;
  v8[8] = 0;
  v8[1] = 0;
  v8[2] = 0;
  *v8 = 0x3F800000;
  v8[3] = 0;
  v8[4] = 0x3F800000;
  v8[5] = 0;
  v8[6] = 0;
  v8[7] = 0;
  v8[8] = 0x3F800000;
  v9 = _wcpp_2_ctor_array_((char *)v8 + 0x96, 0xF, &unk_959D8) - 0x4F80;
  *(_DWORD *)(v9 + 0xA7) = off_95A50;
  sub_16120(v9);
  return v9;
}
// 77394: using guessed type int __fastcall _wcpp_2_ctor_array_(_DWORD, _DWORD, _DWORD);
// 95A50: using guessed type int (*off_95A50[6])();

//----- (0001604C) --------------------------------------------------------
void *__fastcall sub_1604C(int a1, char a2)
{
  void *v4; // eax
  void *v6; // edx
  int v7; // eax
  int v8; // eax
  int v9; // eax
  int v10; // eax
  int v11; // eax
  int v12; // eax
  int v13; // eax
  int v14; // eax
  int v15; // eax
  void *v16; // eax
  void *v17; // ebx

  if ( (a2 & 4) != 0 )
  {
    v4 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95A28);
    operator delete[](v4);
    return (void *)a1;
  }
  else
  {
    v6 = *(void **)(a1 + 0x19BE);
    *(_DWORD *)(a1 + 0xA7) = off_95A50;
    if ( v6 )
    {
      sub_2627C(v6);
    }
    operator delete[](*(void **)(a1 + 0x19BE));
    v7 = sub_1A9C0(a1 + 0x4F80);
    v8 = ((int (__fastcall *)(int, _DWORD))locret_1B66C)(v7 - 0x13A, 0);
    v9 = sub_15D2C(v8 - 0x1904);
    v10 = sub_15788(v9 - 0x804);
    v11 = sub_15788(v10 - 0x804);
    v12 = sub_15788(v11 - 0x804);
    v13 = sub_1A9E0(v12 - 0x828);
    v14 = sub_1AA00(v13 - 0xFA0);
    v15 = sub_1A9E0(v14 - 0x4B0);
    v16 = (void *)sub_2C848(v15 - 0xBE, 1);
    v17 = v16;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v16);
    }
    return v17;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95A50: using guessed type int (*off_95A50[6])();

//----- (00016120) --------------------------------------------------------
int __fastcall sub_16120(int a1)
{
  int v1; // ebp
  int v2; // edx
  FILE *v3; // eax
  FILE *v4; // ecx
  int v5; // eax
  int v6; // edi
  int v7; // esi
  _WORD *v8; // ebx
  char s[200]; // [esp+0h] [ebp-12Ch] BYREF
  char v11[60]; // [esp+C8h] [ebp-64h] BYREF
  int v12; // [esp+104h] [ebp-28h] BYREF
  int v13; // [esp+108h] [ebp-24h] BYREF
  int v14; // [esp+10Ch] [ebp-20h] BYREF
  int v15; // [esp+110h] [ebp-1Ch] BYREF

  v1 = a1;
  *(_DWORD *)(a1 + 0xAB) = 0;
  *(_DWORD *)(a1 + 0x1D2A) = 0;
  v2 = a1 + 0x190;
  *(_DWORD *)(a1 + 0x19BE) = 0;
  do
  {
    a1 += 4;
    *(_DWORD *)(a1 + 0x137A) = 0;
  }
  while ( a1 != v2 );
  *(_DWORD *)(v1 + 0x1D1E) = 0;
  *(_DWORD *)(v1 + 0x1D22) = 0;
  *(_DWORD *)(v1 + 0x1D26) = 0;
  *(_DWORD *)(v1 + 0xB3) = 0;
  *(_DWORD *)(v1 + 0xAF) = 0;
  *(_BYTE *)(v1 + 0xB7) = 0;
  *(_BYTE *)(v1 + 0x4F2E) = 0;
  *(_DWORD *)(v1 + 0xB8) = 2;
  *(_WORD *)(v1 + 0xBC) = 0xFFFF;
  *(_DWORD *)(v1 + 0x4F2F) = 0;
  *(_DWORD *)(v1 + 0x4F33) = 0;
  *(_DWORD *)(v1 + 0x503A) = 0xFFFFFFFF;
  *(_DWORD *)(v1 + 0x5042) = 0xFFFFFFFF;
  *(_DWORD *)(v1 + 0x5046) = 0xFFFFFFFF;
  *(_DWORD *)(v1 + 0x504A) = 0xFFFFFFFF;
  v3 = Q_OpenFile_sub_1BB10("batfx.txt", 0);
  v4 = v3;
  if ( !v3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x1E4);
  }
  Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v3, s);
  sscanf(s, "%d", &v12);
  v5 = v12;
  *(_DWORD *)(v1 + 0x1A8E) = v12;
  if ( v5 >= 0x64 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x1EA);
  }
  v6 = 0;
  if ( *(int *)(v1 + 0x1A8E) > 0 )
  {
    v7 = v1;
    do
    {
      Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v4, s);
      sscanf(s, "%s", v11);
      *(_WORD *)(v7 + 0x19C6) = sub_1B270(&V_Type3_stru_10AE70.t13, v11, 0xFFFFFFFF);
      ++v6;
      v7 += 2;
    }
    while ( v6 < *(_DWORD *)(v1 + 0x1A8E) );
  }
  v8 = (_WORD *)v1;
  do
  {
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v4, s);
    sscanf(s, "%d %d %d %d", &v12, &v13, &v14, &v15);
    v8[0xD49] = v12;
    v8[0xD4A] = v13;
    v8[0xDE7] = v14;
    v8 += 2;
    v8[0xDE6] = v15;
  }
  while ( v8 != (_WORD *)(v1 + 0x13C) );
  return fclose(v4);
}
// 16120: using guessed type char var_64[60];

//----- (00016348) --------------------------------------------------------
int __fastcall sub_16348(int a1, unsigned __int16 a2, int a3, signed int a4)
{
  int result; // eax
  int v7; // edx
  char v8; // ah
  int v9; // ebx
  int v10; // edx
  int v11; // edx
  int v12; // eax
  int v13; // edx
  int v14; // edx
  int v15; // eax
  int v16; // ebx
  signed int v17; // esi
  int v18; // edi
  int v19; // ecx
  char v20; // ah
  char *v21; // edx
  char v22; // bl
  char v23; // al
  LONG v24; // edi
  int v25; // eax
  char v26; // ah
  char v27; // ch
  char v28; // bl
  char v29; // dl
  int v30; // edx
  char v31; // cl
  int v32; // edx
  int v33; // ecx
  int v34; // eax
  int v35; // edx
  int v36; // ebx
  int v37; // eax
  int v38; // eax
  int v39; // [esp-4h] [ebp-24h]
  int v40; // [esp-4h] [ebp-24h]
  _BYTE v41[5]; // [esp+8h] [ebp-18h]
  int v42; // [esp+10h] [ebp-10h]

  v42 = a3;
  if ( a2 < 0x3Au )
  {
    if ( a2 >= 6u )
    {
      if ( a2 <= 6u )
      {
        sub_5A270(&V_Type3_stru_10AE70, 0, 0, 0);
        sub_567BC(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 8);
        return 0xFFFFFFFF;
      }
      if ( a2 < 0xDu )
      {
        if ( a2 <= 7u )
        {
          if ( !V_Type3_stru_10AE70.wnds[dword_96BAC].a1 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x3B7);
          }
          sub_17260(a1);
          sub_56728((int)&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 4, 8, 0, 0);
          return 0xFFFFFFFF;
        }
        if ( a2 != 8 )
        {
          return sub_2F424(a1, a2, a3, a4);
        }
        if ( *(_BYTE *)(a1 + 0xB7) != 4 )
        {
          v15 = a3;
          v16 = *(_DWORD *)(a1 + 8);
          if ( v15 < v16
            || v15 > *(_DWORD *)(a1 + 0x10)
            || (v17 = *(_DWORD *)(a1 + 0xC), a4 < v17)
            || a4 > *(_DWORD *)(a1 + 0x14) )
          {
            *(_DWORD *)(a1 + 0xAF) = 0;
            *(_DWORD *)(a1 + 0x1D0E) = 0x49742400;
            sub_18C2C(a1, 0);
            return 0;
          }
          if ( !*(_DWORD *)(a1 + 0x4F2F) )
          {
            v18 = a4 - v17;
            v19 = v42 - v16;
            sub_17204(a1, v42 - v16, v18);
            if ( !*(_DWORD *)(a1 + 0xAF) )
            {
              v20 = *(_BYTE *)(a1 + 0xB7);
              if ( v20 == 2 )
              {
                sub_16FC0(a1, v19, v18, v19);
              }
              else if ( v20 == 3 )
              {
                sub_171D0(a1, v19, v18);
              }
            }
            sub_18C2C(a1, 0);
            if ( *(_BYTE *)(a1 + 0xB7) == 1 )
            {
              v21 = *(char **)(a1 + 0xAF);
              if ( v21 )
              {
                v22 = *v21;
                v23 = 0;
                if ( *v21 == 2 )
                {
                  v23 = 3;
                }
                else if ( v22 == 3 )
                {
                  v23 = 4;
                }
                else if ( v22 == 1 )
                {
                  v23 = 2;
                }
                v24 = 0x6B;
                if ( sub_56D30(
                       &V_Type3_stru_10AE70,
                       *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0x41),
                       0x322,
                       v23,
                       *(_DWORD *)(*(_DWORD *)(a1 + 0xAF) + 1)) == 0xFFFFFFFF )
                {
                  v24 = 0xF3;
                }
                VFX_line_draw(
                  (PANE *)(a1 + 4),
                  *(__int16 *)(*(_DWORD *)(a1 + 0xB3) + 0x27),
                  *(__int16 *)(*(_DWORD *)(a1 + 0xB3) + 0x29),
                  *(__int16 *)(*(_DWORD *)(a1 + 0xAF) + 0x27),
                  *(__int16 *)(*(_DWORD *)(a1 + 0xAF) + 0x29),
                  0,
                  v24);
                return 0;
              }
            }
          }
        }
      }
      else
      {
        if ( a2 > 0xDu )
        {
          if ( a2 < 0x32u || a2 > 0x33u && (a2 < 0x36u || a2 > 0x37u) )
          {
            return sub_2F424(a1, a2, a3, a4);
          }
          if ( *(_DWORD *)(a1 + 0x39) != 0xFFFFFFFF )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x2E5);
          }
          v25 = 0;
          if ( a2 == 0x32 )
          {
            v26 = *(_BYTE *)(a1 + 0x4F2F);
            if ( (v26 & 1) != 0 )
            {
              if ( (v26 & 2) != 0 )
              {
                *(_BYTE *)(a1 + 0x4F2F) = v26 & 0xFD;
              }
              else
              {
                *(_BYTE *)(a1 + 0x4F2F) = v26 & 0xFE;
                sub_18C2C(a1, 0);
              }
            }
            else
            {
              *(_BYTE *)(a1 + 0x4F2F) = v26 & 0xFC | 1;
            }
            v25 = 3;
          }
          if ( a2 == 0x33 )
          {
            v27 = *(_BYTE *)(a1 + 0x4F2F);
            if ( (v27 & 1) != 0 )
            {
              if ( (v27 & 2) != 0 )
              {
                *(_BYTE *)(a1 + 0x4F2F) = v27 & 0xFE;
                sub_18C2C(a1, 0);
              }
              else
              {
                *(_BYTE *)(a1 + 0x4F2F) = v27 | 2;
              }
            }
            else
            {
              *(_BYTE *)(a1 + 0x4F2F) = v27 | 3;
            }
            v25 = 3;
          }
          if ( a2 == 0x36 )
          {
            v28 = *(_BYTE *)(a1 + 0x4F2F);
            if ( (v28 & 4) != 0 )
            {
              if ( (v28 & 8) != 0 )
              {
                *(_BYTE *)(a1 + 0x4F2F) = v28 & 0xF7;
              }
              else
              {
                *(_BYTE *)(a1 + 0x4F2F) = v28 & 0xFB;
              }
            }
            else
            {
              *(_BYTE *)(a1 + 0x4F2F) = v28 & 0xF3 | 4;
            }
            v25 = 0xC;
          }
          if ( a2 == 0x37 )
          {
            v29 = *(_BYTE *)(a1 + 0x4F2F);
            if ( (v29 & 4) != 0 )
            {
              if ( (v29 & 8) != 0 )
              {
                *(_BYTE *)(a1 + 0x4F2F) = v29 & 0xFB;
              }
              else
              {
                *(_BYTE *)(a1 + 0x4F2F) = v29 | 8;
              }
            }
            else
            {
              *(_BYTE *)(a1 + 0x4F2F) = v29 | 0xC;
            }
            v25 = 0xC;
          }
          if ( v42 == 4 )
          {
            sub_56728((int)&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 1, 0x3B, v25, 0);
          }
          return 0xFFFFFFFF;
        }
        if ( *(_BYTE *)(a1 + 0xB7) != 4 )
        {
          sub_187EC(a1);
          sub_18C2C(a1, 0);
          return 0;
        }
      }
      return 0;
    }
    if ( a2 < 3u )
    {
      if ( !a2 )
      {
        return sub_2F424(a1, a2, a3, a4);
      }
      if ( a2 <= 1u )
      {
        *(_DWORD *)(a1 + 0xAB) = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "BatControlWnd", 0);
        v7 = *(_DWORD *)(a1 + 0x41);
        sub_56400(&V_Type3_stru_10AE70, v7, 0x3A, 0, 0, 0);
        sub_186B8(a1, v7, a3);
        sub_2F424(a1, a2, a3, a4);
        *(_DWORD *)(a1 + 0x4F2F) = 0;
        return 0;
      }
      else
      {
        if ( *(_BYTE *)(a1 + 0xB7) == 4 )
        {
          sub_12238(*(_DWORD *)(a1 + 0xAB), 0);
        }
        sub_564C0(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0xFFFFFFFF);
        sub_185CC(a1);
        sub_2F424(a1, a2, a3, a4);
        return 0;
      }
    }
    if ( a2 <= 3u )
    {
      if ( (unsigned int)a4 < 0xD )
      {
        if ( a4 != 0xC )
        {
          return 0;
        }
        if ( *(float *)V_Type3_stru_10AE70.j > dbl_9043E )
        {
          *(float *)V_Type3_stru_10AE70.j = *(float *)V_Type3_stru_10AE70.j * dbl_90446;
          return 0;
        }
      }
      else if ( (unsigned int)a4 <= 0xD )
      {
        if ( *(float *)V_Type3_stru_10AE70.j < (double)flt_90432 )
        {
          *(float *)V_Type3_stru_10AE70.j = *(float *)V_Type3_stru_10AE70.j * dbl_90436;
          return 0;
        }
      }
      else if ( (unsigned int)a4 >= 0x1C )
      {
        if ( (unsigned int)a4 > 0x1C && a4 != 0x39 )
        {
          return 0;
        }
        if ( *(_BYTE *)(a1 + 0xB7) == 4 )
        {
          *(_DWORD *)(a1 + 0x5036) = 0xFFFFFFFF;
        }
      }
      return 0;
    }
    if ( a2 > 4u )
    {
      if ( *(_BYTE *)(a1 + 0xB7) == 4 )
      {
        result = 0xFFFFFFFF;
        *(_DWORD *)(a1 + 0x5036) = 0xFFFFFFFF;
        return result;
      }
      if ( a3 >= *(_DWORD *)(a1 + 8)
        && a3 <= *(_DWORD *)(a1 + 0x10)
        && a4 >= *(_DWORD *)(a1 + 0xC)
        && a4 <= *(_DWORD *)(a1 + 0x14) )
      {
        Q_StartSample_sub_4FB90(&V_SoundSystem, 0);
        if ( *(_DWORD *)(a1 + 0xAF) )
        {
          sub_16D6C(a1, a3, a4, 0);
        }
        else if ( *(_DWORD *)(a1 + 0xB3) )
        {
          v40 = *(_DWORD *)(a1 + 0xAF);
          v14 = *(_DWORD *)(a1 + 0xAB);
          *(_DWORD *)(a1 + 0xB3) = 0;
          sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v14 + 0x41), 0x320, 0, v40);
          *(_BYTE *)(a1 + 0xB7) = 0;
        }
        sub_18C2C(a1, 0);
        sub_17260(a1);
        return 0xFFFFFFFF;
      }
      return 0;
    }
    if ( *(_BYTE *)(a1 + 0xB7) == 4 )
    {
      return 0xFFFFFFFF;
    }
    if ( a3 < *(_DWORD *)(a1 + 8)
      || a3 > *(_DWORD *)(a1 + 0x10)
      || a4 < *(_DWORD *)(a1 + 0xC)
      || a4 > *(_DWORD *)(a1 + 0x14) )
    {
      return 0;
    }
    Q_StartSample_sub_4FB90(&V_SoundSystem, 0);
    if ( *(_DWORD *)(a1 + 0xAF) )
    {
      sub_16D6C(a1, a3, a4, 1);
    }
    else
    {
      v8 = *(_BYTE *)(a1 + 0xB7);
      if ( v8 == 2 )
      {
        if ( *(unsigned __int16 *)(a1 + 0xBC) == 0xFFFF )
        {
          *(_BYTE *)(a1 + 0xB7) = 0;
        }
        else
        {
          v9 = a4 - *(_DWORD *)(a1 + 0xC);
          v10 = v42 - *(_DWORD *)(a1 + 8);
          *(_BYTE *)(a1 + 0xB7) = 3;
          sub_171D0(a1, v10, v9);
        }
      }
      else
      {
        if ( v8 == 3 )
        {
          v11 = *(_DWORD *)(a1 + 0xAB);
          *(_BYTE *)(a1 + 0xB7) = 0;
          sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v11 + 0x41), 0x326, 5, a1 + 0x1D0A);
          *(_DWORD *)(a1 + 0xB3) = 0;
          sub_187EC(a1);
          v12 = a1;
LABEL_43:
          sub_18C2C(v12, 0);
          return 0xFFFFFFFF;
        }
        if ( v8 )
        {
          return 0xFFFFFFFF;
        }
        v39 = *(_DWORD *)(a1 + 0xAF);
        v13 = *(_DWORD *)(a1 + 0xAB);
        *(_DWORD *)(a1 + 0xB3) = 0;
        sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v13 + 0x41), 0x320, 0, v39);
      }
    }
    v12 = a1;
    goto LABEL_43;
  }
  if ( a2 <= 0x3Au )
  {
    LOBYTE(a3) = *(_BYTE *)(a1 + 0x4F2F);
    if ( (a3 & 1) != 0 )
    {
      if ( (a3 & 2) != 0 )
      {
        v30 = 2;
      }
      else
      {
        v30 = 0xFFFFFFFE;
      }
      sub_17E50(a1, v30, a3, a4);
    }
    v31 = *(_BYTE *)(a1 + 0x4F2F);
    if ( (v31 & 4) != 0 )
    {
      if ( (v31 & 8) != 0 )
      {
        v32 = 0xA;
      }
      else
      {
        v32 = 0xFFFFFFF6;
      }
      sub_182B8(a1, v32);
    }
    if ( (*(_BYTE *)(a1 + 0x4F2F) & 5) != 0 )
    {
      goto LABEL_123;
    }
    return 0;
  }
  if ( a2 < 0x4Cu )
  {
    if ( a2 >= 0x47u )
    {
      if ( a2 <= 0x47u )
      {
        *(_DWORD *)(a1 + 0x4F2F) = 0;
        sub_17F54(a1);
        sub_18C2C(a1, 0);
        return 0xFFFFFFFF;
      }
      else
      {
        if ( a2 < 0x4Au )
        {
          return sub_2F424(a1, a2, a3, a4);
        }
        if ( a2 <= 0x4Au )
        {
          *(_DWORD *)(a1 + 0x503A) = ~*(_DWORD *)(a1 + 0x503A);
          sub_18C2C(a1, 0);
        }
        return 0;
      }
    }
    if ( a2 <= 0x3Bu )
    {
      *(_DWORD *)(a1 + 0x4F2F) &= ~a3;
      if ( (a3 & 1) != 0 )
      {
        sub_18C2C(a1, 0);
      }
      sub_567BC(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0x3B);
      return 0xFFFFFFFF;
    }
    if ( a2 != 0x46 )
    {
      return sub_2F424(a1, a2, a3, a4);
    }
    return 0;
  }
  if ( a2 <= 0x4Cu )
  {
    v33 = ~*(_DWORD *)(a1 + 0x5042);
    *(_DWORD *)(a1 + 0x5046) = v33;
    *(_DWORD *)(a1 + 0x5042) = v33;
    sub_18C2C(a1, 0);
    return 0;
  }
  if ( a2 < 0x52u )
  {
    if ( a2 < 0x50u )
    {
      return sub_2F424(a1, a2, a3, a4);
    }
    if ( a2 > 0x50u )
    {
      *(_BYTE *)(a1 + 0xB7) = 1;
      return 0;
    }
    if ( a3 >= 1 && *((__int16 *)V_Game.h1 + 0x2D) >= a3 )
    {
      V_Game.planet = *(T_Planet **)&V_Game.h1[4 * a3 + 0x42];
      sub_56B60(&V_Type3_stru_10AE70, 1, 0x11, 1);
      return 0;
    }
    return 0;
  }
  if ( a2 <= 0x52u )
  {
    sub_126F8(a1, a3, a1);
    return 0;
  }
  if ( a2 <= 0x53u )
  {
    *(_DWORD *)v41 = *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0xAB);
    if ( !v41[0] )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x39A);
    }
    v41[4] = *(_BYTE *)(*(_DWORD *)(a1 + 0xAB) + 0xAF);
    v34 = sub_12AE4(a1, *(int *)&v41[1]);
    *(_DWORD *)(a1 + 0xB3) = v34;
    v35 = *(__int16 *)(v34 + 0x27);
    if ( v35 < 0
      || (v36 = *(__int16 *)(v34 + 0x29), v36 < 0)
      || v35 > *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8)
      || v36 > *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC) )
    {
      sub_17E88(a1, *(_DWORD *)(a1 + 0xB3));
    }
    v37 = *(_DWORD *)(a1 + 0xB3);
    if ( *(_BYTE *)v37 == 2 )
    {
      v38 = *(_DWORD *)(v37 + 1);
      if ( *(_WORD *)(v38 + 0x56) == byte_104BEA && *(int *)(v38 + 0x88) > 0 )
      {
        *(_BYTE *)(a1 + 0xB7) = 2;
      }
    }
LABEL_123:
    sub_18C2C(a1, 0);
    return 0;
  }
  if ( a2 != 0x54 )
  {
    return sub_2F424(a1, a2, a3, a4);
  }
  sub_172B0(a1);
  return 0;
}
// 90432: using guessed type float flt_90432;
// 90436: using guessed type double dbl_90436;
// 9043E: using guessed type double dbl_9043E;
// 90446: using guessed type double dbl_90446;
// 96BAC: using guessed type int dword_96BAC;

//----- (00016D6C) --------------------------------------------------------
void __fastcall sub_16D6C(int a1, int a2, int a3, int a4)
{
  unsigned int v5; // ebp
  char v6; // bh
  char v7; // al
  int v8; // edi
  char *v9; // eax
  char v10; // dl
  int v11; // eax
  char v12; // ch
  int v13; // ebx
  char v14; // bh
  int v15; // eax
  int v16; // edx
  char v17; // al
  char v18; // ah

  if ( !*(_DWORD *)(a1 + 0xAF) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x3D7);
  }
  v5 = 0;
  if ( !a4 )
  {
    sub_17E88(a1, *(_DWORD *)(a1 + 0xAF));
    goto LABEL_32;
  }
  if ( *(_BYTE *)(a1 + 0xB7) == 1 )
  {
    v6 = **(_BYTE **)(a1 + 0xAF);
    v7 = 0;
    switch ( v6 )
    {
      case 2:
        v7 = 3;
        break;
      case 1:
        v7 = 2;
        break;
      case 3:
        v7 = 4;
        break;
    }
    v8 = v7;
    if ( sub_56D30(
           &V_Type3_stru_10AE70,
           *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0x41),
           0x322,
           v7,
           *(_DWORD *)(*(_DWORD *)(a1 + 0xAF) + 1)) == 0xFFFFFFFF )
    {
      *(_BYTE *)(a1 + 0xB7) = 0;
      sub_56D30(
        &V_Type3_stru_10AE70,
        *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0x41),
        0x326,
        v8,
        *(_DWORD *)(*(_DWORD *)(a1 + 0xAF) + 1));
      *(_DWORD *)(a1 + 0xB3) = 0;
    }
  }
  else
  {
    v9 = *(char **)(a1 + 0xAF);
    v10 = *v9;
    if ( *v9 != 2 )
    {
      if ( v10 == 1 )
      {
        v12 = *(_BYTE *)(a1 + 0xB7);
        if ( v12 != 2 && v12 != 3 )
        {
          v13 = *(_DWORD *)(a1 + 0xB3);
          if ( v9 != (char *)v13 || v12 )
          {
            v5 = 0xFFFFFFFF;
            *(_DWORD *)(a1 + 0xB3) = *(_DWORD *)(a1 + 0xAF);
          }
          else
          {
            V_Game.planet = *(T_Planet **)(v13 + 1);
            *(_DWORD *)(a1 + 0xAF) = 0;
            sub_56B60(&V_Type3_stru_10AE70, 1, 0x11, 1);
          }
          goto LABEL_32;
        }
        *(_BYTE *)(a1 + 0xB7) = 0;
        sub_56D30(
          &V_Type3_stru_10AE70,
          *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0x41),
          0x326,
          2,
          *(_DWORD *)(*(_DWORD *)(a1 + 0xAF) + 1));
      }
      else
      {
        if ( v10 != 3 )
        {
          goto LABEL_32;
        }
        v14 = *(_BYTE *)(a1 + 0xB7);
        v15 = *(_DWORD *)(v9 + 1);
        if ( v14 != 2 && v14 != 3 )
        {
          goto LABEL_32;
        }
        v16 = *(_DWORD *)(a1 + 0xAB);
        *(_BYTE *)(a1 + 0xB7) = 0;
        sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v16 + 0x41), 0x326, 4, v15);
      }
      sub_187EC(a1);
      sub_18C2C(a1, 0);
      goto LABEL_32;
    }
    if ( !*(_BYTE *)(a1 + 0xB7) )
    {
      *(_DWORD *)(a1 + 0xB3) = v9;
      v11 = *(_DWORD *)(v9 + 1);
      v5 = 0xFFFFFFFF;
      if ( *(_WORD *)(v11 + 0x56) == byte_104BEA && *(int *)(v11 + 0x88) > 0 )
      {
        *(_BYTE *)(a1 + 0xB7) = 2;
      }
    }
  }
LABEL_32:
  if ( v5 == 0xFFFFFFFF )
  {
    v17 = 0;
    v18 = **(_BYTE **)(a1 + 0xB3);
    if ( v18 == 2 )
    {
      v17 = 3;
    }
    else if ( v18 == 1 )
    {
      v17 = 2;
    }
    sub_56D30(
      &V_Type3_stru_10AE70,
      *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0x41),
      0x320,
      v17,
      *(_DWORD *)(*(_DWORD *)(a1 + 0xB3) + 1));
  }
  sub_17260(a1);
}

//----- (00016FC0) --------------------------------------------------------
void __fastcall sub_16FC0(int a1, int edx0, int a3, int a4)
{
  int v5; // eax
  double v6; // st7
  T_Vector3D *v7; // ecx
  float a2; // [esp+0h] [ebp-90h]
  float v9; // [esp+4h] [ebp-8Ch]
  int v10; // [esp+8h] [ebp-88h]
  int v11; // [esp+Ch] [ebp-84h]
  float v12; // [esp+10h] [ebp-80h] BYREF
  float v13; // [esp+14h] [ebp-7Ch]
  float v14; // [esp+18h] [ebp-78h]
  float v15; // [esp+1Ch] [ebp-74h] BYREF
  float v16; // [esp+20h] [ebp-70h]
  float v17; // [esp+24h] [ebp-6Ch]
  float v18; // [esp+28h] [ebp-68h]
  float v19; // [esp+2Ch] [ebp-64h]
  int v20; // [esp+30h] [ebp-60h]
  T_Vector3D result; // [esp+34h] [ebp-5Ch] BYREF
  float v22; // [esp+40h] [ebp-50h]
  float v23; // [esp+44h] [ebp-4Ch]
  float v24; // [esp+48h] [ebp-48h]
  int v25[3]; // [esp+4Ch] [ebp-44h] BYREF
  int v26[3]; // [esp+58h] [ebp-38h] BYREF
  float v27; // [esp+64h] [ebp-2Ch] BYREF
  float v28; // [esp+68h] [ebp-28h]
  float v29; // [esp+6Ch] [ebp-24h]
  int v30; // [esp+70h] [ebp-20h]
  int v31; // [esp+74h] [ebp-1Ch]
  int *v32; // [esp+78h] [ebp-18h]
  float v33; // [esp+7Ch] [ebp-14h]
  int *v34; // [esp+80h] [ebp-10h]
  float *v35; // [esp+84h] [ebp-Ch]
  float v36; // [esp+88h] [ebp-8h]

  v30 = edx0 - *(__int16 *)(a1 + 0x4F22);
  v5 = *(__int16 *)(a1 + 0x4F24);
  result.x = (float)v30;
  v32 = v25;
  v31 = v5 - a3;
  result.y = 0.0;
  result.z = (float)(v5 - a3);
  v33 = *(float *)(a1 + 0x4F16);
  v18 = result.x * v33;
  v19 = 0.0 * v33;
  *(float *)v25 = v18;
  *(float *)&v20 = result.z * v33;
  *(float *)&v25[1] = v19;
  result.x = v18 * flt_9045D;
  v25[2] = v20;
  result.y = v19;
  result.z = *(float *)&v20 * flt_90461;
  v12 = *(float *)(a1 + 0x4E5E);
  v13 = *(float *)(a1 + 0x4E62);
  v14 = *(float *)(a1 + 0x4E66);
  v13 = 0.0;
  v27 = 0.0;
  v29 = 1.0;
  v28 = 0.0;
  v36 = sub_5309C(&v12, &v27);
  v9 = v13 * v29 - v14 * v28;
  *(float *)&v10 = v14 * v27 - v12 * v29;
  v34 = v26;
  *(float *)v26 = v9;
  v26[1] = v10;
  *(float *)&v11 = v12 * v28 - v13 * v27;
  v26[2] = v11;
  if ( *(float *)&v10 >= 0.0 )
  {
    a2 = -v36;
    Q_RotateVectorY_sub_532AC(&result, a2);
  }
  else
  {
    Q_RotateVectorY_sub_532AC(&result, v36);
  }
  v35 = &v15;
  v22 = 0.0;
  v23 = 0.0;
  v24 = 0.0;
  v22 = result.x + *(float *)(a1 + 0x1D1E);
  v23 = result.y + *(float *)(a1 + 0x1D22);
  v6 = result.z + *(float *)(a1 + 0x1D26);
  v15 = v22;
  v24 = v6;
  v16 = v23;
  v17 = v24;
  *(float *)(a1 + 0x1D0A) = v22;
  *(float *)(a1 + 0x1D0E) = v16;
  v7 = (T_Vector3D *)(a1 + 0x1D0A);
  v7->z = v17;
  sub_53440(v7);
}
// 9045D: using guessed type float flt_9045D;
// 90461: using guessed type float flt_90461;

//----- (000171D0) --------------------------------------------------------
void __fastcall sub_171D0(int a1, int a2, int a3)
{
  double v3; // st7
  T_Vector3D *v4; // eax

  v3 = (double)(a3 - 0xF0) * *(float *)(a1 + 0x4F16) * flt_90465 + *(float *)(a1 + 0x1D22);
  v4 = (T_Vector3D *)(a1 + 0x1D0A);
  v4->y = v3;
  sub_53440(v4);
}
// 90465: using guessed type float flt_90465;

//----- (00017204) --------------------------------------------------------
char *__fastcall sub_17204(int a1, int a2, int a3)
{
  char *result; // eax

  result = sub_15808(a1 + 0x1D36, a2, a3);
  *(_DWORD *)(a1 + 0xAF) = result;
  if ( !result )
  {
    result = sub_15808(a1 + 0x253A, a2, a3);
    *(_DWORD *)(a1 + 0xAF) = result;
  }
  if ( !*(_DWORD *)(a1 + 0xAF) )
  {
    result = sub_15808(a1 + 0x2D3E, a2, a3);
    *(_DWORD *)(a1 + 0xAF) = result;
  }
  return result;
}

//----- (00017260) --------------------------------------------------------
void __fastcall sub_17260(int result)
{
  char v1; // bl
  int v2; // edx

  if ( *(_DWORD *)V_Type3_stru_10AE70.z1aa == *(_DWORD *)(result + 0x41) )
  {
    v1 = *(_BYTE *)(result + 0xB7);
    v2 = *(_DWORD *)(result + 0xB8);
    if ( v1 == 1 )
    {
      v2 += 8;
    }
    else if ( v1 == 2 || v1 == 3 )
    {
      v2 += 6;
    }
    if ( *(_DWORD *)(result + 0xAF) )
    {
      ++v2;
    }
    sub_5A270(&V_Type3_stru_10AE70, v2, 0, 0);
  }
}

//----- (000172B0) --------------------------------------------------------
void __fastcall sub_172B0(int a1)
{
  _BYTE *v2; // edx
  int v3; // eax
  char *v4; // esi
  int v5; // edi
  int v6; // eax
  int v7; // eax
  int v8; // eax
  T_TypeA1 *Wnd_sub_56DA8; // ecx
  char *v10; // esi
  char *i; // edi
  char v12; // al
  char v13; // al
  int v14; // eax
  int v15; // edx
  char s[176]; // [esp+0h] [ebp-B0h] BYREF

  v2 = *(_BYTE **)(a1 + 0xB3);
  if ( v2 )
  {
    v3 = *(_DWORD *)(a1 + 0xB3);
    v4 = 0;
    v5 = 0;
    if ( *v2 == 2 && (v6 = *(_DWORD *)(v3 + 1), *(_WORD *)(v6 + 0x56) == byte_104BEA) )
    {
      v4 = "abanship";
      v5 = v6 + 0x34;
    }
    else
    {
      v7 = *(_DWORD *)(a1 + 0xB3);
      if ( *(_BYTE *)v7 == 1 )
      {
        v8 = *(_DWORD *)(v7 + 1);
        if ( byte_104BEA == *(_BYTE *)(v8 + 0x57) )
        {
          v4 = "abanplan";
          v5 = v8 + 0x24;
        }
      }
    }
    if ( v4 )
    {
      Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "HELPWINDOW", 0);
      sub_2FCB0(Wnd_sub_56DA8, "help.txt", v4);
      v10 = s;
      sprintf(s, (const char *)Wnd_sub_56DA8[0x13].i, v5);
      i = (char *)Wnd_sub_56DA8[0x13].i;
      do
      {
        v12 = *v10;
        *i = *v10;
        if ( !v12 )
        {
          break;
        }
        v13 = v10[1];
        v10 += 2;
        i[1] = v13;
        i += 2;
      }
      while ( v13 );
      if ( sub_552F8(&V_Type3_stru_10AE70, (P_TypeA2)Wnd_sub_56DA8, 0) )
      {
        v14 = *(_DWORD *)(a1 + 0xB3);
        if ( *(_BYTE *)v14 == 2 )
        {
          sub_49940(*(_DWORD *)(v14 + 1));
        }
        else
        {
          sub_37040(*(P_Planet *)(v14 + 1));
        }
        *(_DWORD *)(a1 + 0xB3) = 0;
        v15 = *(_DWORD *)(a1 + 0xAB);
        *(_BYTE *)(a1 + 0xB7) = 0;
        sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v15 + 0x41), 0x320, 0, 0);
        sub_187EC(a1);
        sub_18C2C(a1, 0);
      }
    }
  }
}

//----- (000173F4) --------------------------------------------------------
int __fastcall sub_173F4(int a1, int a2, int a3, int a4)
{
  sub_1B958(a1 + 0x4E46, (float *)(a1 + 0x1D1E), a1, a4);
  return sub_17430(a1);
}

//----- (00017430) --------------------------------------------------------
int __fastcall sub_17430(int eax0)
{
  int v2; // esi
  int *v3; // edi
  int result; // eax
  double v5; // st7
  int v6; // ebx
  char v7; // dl
  char v8; // bh
  float z; // eax
  int v10; // eax
  int v11; // edx
  int v12; // eax
  double v13; // st7
  char v14; // al
  double v15; // st7
  float *v16; // edx
  float v17; // eax
  int v18; // eax
  float *v19; // ebx
  int v20; // edx
  double v21; // st7
  int v22; // eax
  int v23[3]; // [esp+0h] [ebp-180h]
  int v24[25]; // [esp+14h] [ebp-16Ch] BYREF
  int v25[12]; // [esp+78h] [ebp-108h] BYREF
  T_Vector3D v26; // [esp+A8h] [ebp-D8h] BYREF
  T_Vector3D v27; // [esp+B4h] [ebp-CCh] BYREF
  float v28; // [esp+C0h] [ebp-C0h]
  float v29; // [esp+C4h] [ebp-BCh]
  int v30; // [esp+C8h] [ebp-B8h]
  T_Vector3D a1; // [esp+CCh] [ebp-B4h] BYREF
  T_Vector3D v32[2]; // [esp+D8h] [ebp-A8h] BYREF
  T_Vector3D v33; // [esp+F0h] [ebp-90h] BYREF
  T_Vector3D v34; // [esp+FCh] [ebp-84h] BYREF
  float v35; // [esp+108h] [ebp-78h] BYREF
  float v36; // [esp+10Ch] [ebp-74h]
  int v37; // [esp+110h] [ebp-70h]
  __int64 v38; // [esp+114h] [ebp-6Ch]
  float v39; // [esp+11Ch] [ebp-64h]
  float *v40; // [esp+120h] [ebp-60h]
  T_Vector3D *v41; // [esp+124h] [ebp-5Ch]
  int v42; // [esp+128h] [ebp-58h]
  T_Vector3D *v43; // [esp+12Ch] [ebp-54h]
  int v44; // [esp+130h] [ebp-50h]
  T_Vector3D *v45; // [esp+134h] [ebp-4Ch]
  int v46; // [esp+138h] [ebp-48h]
  int v47; // [esp+13Ch] [ebp-44h]
  int v48; // [esp+140h] [ebp-40h]
  float *v49; // [esp+144h] [ebp-3Ch]
  int v50; // [esp+148h] [ebp-38h]
  float v51; // [esp+14Ch] [ebp-34h]
  int v52; // [esp+150h] [ebp-30h]
  float v53; // [esp+154h] [ebp-2Ch]
  float *v54; // [esp+158h] [ebp-28h]
  float v55; // [esp+15Ch] [ebp-24h]
  int v56; // [esp+160h] [ebp-20h] BYREF
  __int16 v57[14]; // [esp+164h] [ebp-1Ch] BYREF

  v2 = *(_DWORD *)(eax0 + 0x1D2A);
  memset(v32, 0, 0xC);
  memset(&v33, 0, sizeof(v33));
  memset(&a1, 0, sizeof(a1));
  _wcpp_2_ctor_array_(v25, 4, &unk_959D8);
  memset(&v33, 0, sizeof(v33));
  sub_53384(&v33.x, (float *)(eax0 + 0x4E86), &v32[0].x);
  v25[0] = 0x41800000;
  v25[2] = 0x41800000;
  v25[3] = 0x41800000;
  v33 = v32[0];
  v25[0xB] = 0x41800000;
  v3 = v25;
  v25[1] = 0;
  v25[4] = 0;
  v25[7] = 0;
  v25[5] = 0xC1800000;
  v25[6] = 0xC1800000;
  v25[8] = 0xC1800000;
  v25[9] = 0xC1800000;
  v25[0xA] = 0;
  v45 = &v26;
  do
  {
    sub_53384((float *)v3, (float *)(eax0 + 0x4E86), &v32[0].x);
    v40 = &v35;
    v28 = v32[0].x - v33.x;
    v35 = v28;
    v29 = v32[0].y - v33.y;
    v36 = v29;
    *(float *)&v30 = v32[0].z - v33.z;
    v37 = v30;
    *(float *)v3 = v28;
    *((float *)v3 + 1) = v36;
    v3 += 3;
    result = v37;
    v3[0xFFFFFFFF] = v37;
  }
  while ( v3 != (int *)v45 );
  v5 = *(float *)(eax0 + 0x4F2A) * flt_9049E;
  v6 = *(_DWORD *)(eax0 + 0x1D32);
  v44 = 0;
  v51 = v5;
  if ( v6 > 0 )
  {
    v46 = eax0 + 0x1D36;
    v48 = eax0 + 0x253A;
    v52 = eax0 + 0x3542;
    v50 = eax0 + 0x2D3E;
    v49 = (float *)(eax0 + 0x4E46);
    v54 = (float *)(eax0 + 0x1D1E);
    v47 = eax0 + 0x4F80;
    do
    {
      if ( *(_BYTE *)v2 != 6
        || ((v7 = *(_BYTE *)(eax0 + 0xB7), v7 == 2) || v7 == 3)
        && !*(_DWORD *)(eax0 + 0xAF)
        && *(_DWORD *)(eax0 + 0x1D0E) != 0x49742400 )
      {
        if ( *(_BYTE *)v2 != 0xFF )
        {
          v8 = *(_BYTE *)v2;
          *(_DWORD *)(v2 + 0x1B) = 0xFFFFFFFF;
          if ( v8 == 4 )
          {
            v32[0] = *(T_Vector3D *)(*(_DWORD *)(v2 + 1) + 1);
            sub_53114(&v32[0].x, v49);
            if ( v32[0].z > 0.0 )
            {
              sub_533D4(
                &v32[0].x,
                *(float *)(eax0 + 0x4E6E),
                *(__int16 *)(eax0 + 0x4F22),
                *(__int16 *)(eax0 + 0x4F24),
                (int)v57,
                (int)&v56);
              *(_WORD *)(v2 + 0x27) = v57[0];
              *(_WORD *)(v2 + 0x29) = v56;
              z = v32[0].z;
              *(_DWORD *)(v2 + 0x1B) = 0;
              *(_DWORD *)(v2 + 0x23) = 0;
              *(float *)(v2 + 0x2F) = z;
              v10 = v50;
              *(_DWORD *)(v2 + 0xF) = sub_10000;
              sub_15794(v10, v2);
            }
          }
          else
          {
            v12 = *(_BYTE *)(v2 + 0x33) & 0x10;
            v42 = 0xFFFFFFFF;
            if ( v12 )
            {
              a1 = *(T_Vector3D *)(0xC * *(char *)(v2 + 0x34) + v47);
            }
            else
            {
              switch ( *(_BYTE *)v2 )
              {
                case 0:
                  memset(&a1, 0, sizeof(a1));
                  break;
                case 1:
                  a1 = *(T_Vector3D *)*(_DWORD *)(v2 + 1);
                  break;
                case 2:
                  a1 = *(T_Vector3D *)(*(_DWORD *)(v2 + 1) + 0x9E);
                  v42 = *(__int16 *)(*(_DWORD *)(v2 + 1) + 0x56);
                  break;
                case 3:
                  v16 = *(float **)(v2 + 1);
                  if ( (*(_BYTE *)(v2 + 0x33) & 1) != 0 )
                  {
                    a1.x = v16[2];
                    a1.y = v16[3];
                    v17 = v16[4];
                  }
                  else
                  {
                    a1.x = v16[5];
                    a1.y = v16[6];
                    v17 = v16[7];
                  }
                  a1.z = v17;
                  break;
                case 6:
                  a1 = *(T_Vector3D *)(eax0 + 0x1D0A);
                  sub_53440(&a1);
                  break;
                default:
                  Q_AssertLogBreakExit_sub_261A8(0, "..\\batmode.cpp", 0x53E);
                  break;
              }
            }
            v33 = a1;
            sub_53384(&v33.x, (float *)(eax0 + 0x4E86), &v32[0].x);
            v33.y = *(float *)(eax0 + 0x1D22);
            v41 = &v27;
            memset(&v32[1], 0, sizeof(T_Vector3D));
            v32[1].x = v33.x - *v54;
            v32[1].y = v33.y - v54[1];
            v32[1].z = v33.z - v54[2];
            v27 = v32[1];
            v33 = v32[1];
            v13 = sqrt(v32[1].y * v32[1].y + v32[1].x * v32[1].x + v32[1].z * v32[1].z);
            *(_DWORD *)(v2 + 0x23) = (v13 >= v51) - 1;
            if ( v32[0].z > (double)*(float *)(eax0 + 0x4E72) && v32[0].z < (double)*(float *)(eax0 + 0x4E76) )
            {
              sub_533D4(
                &v32[0].x,
                *(float *)(eax0 + 0x4E6E),
                *(__int16 *)(eax0 + 0x4F22),
                *(__int16 *)(eax0 + 0x4F24),
                (int)v57,
                (int)&v56);
              *(_WORD *)(v2 + 0x27) = v57[0];
              *(_WORD *)(v2 + 0x29) = v56;
              *(float *)(v2 + 0x2F) = v32[0].z;
              v14 = *(_BYTE *)v2;
              *(_DWORD *)(v2 + 0x1B) = 0;
              if ( v14 == 7 )
              {
                *(float *)(v2 + 0x2F) = *(float *)(v2 + 0x2F) + flt_904AA;
              }
              v15 = *(float *)(eax0 + 0x4F1A) * flt_904A2;
              v55 = 131072.0;
              v53 = v15;
              if ( *(float *)(v2 + 0x2F) >= (double)*(float *)(eax0 + 0x4E72) )
              {
                v55 = v53 / *(float *)(v2 + 0x2F);
              }
              if ( v55 >= (double)flt_904A2 )
              {
                if ( v55 > (double)flt_904AE )
                {
                  v55 = 131072.0;
                }
              }
              else
              {
                v55 = 16384.0;
              }
              v38 = (__int64)(v55 * *(float *)(v2 + 0xB));
              *(_DWORD *)(v2 + 0xF) = v38;
              v18 = *(_DWORD *)(v2 + 0x23);
              v39 = *(float *)(eax0 + 0x4F16) * flt_904A6 + *(float *)(eax0 + 0x1D22);
              if ( v18 )
              {
                if ( (*(_BYTE *)(v2 + 0x33) & 2) == 0 )
                {
                  v33.x = a1.x;
                  v33.z = a1.z;
                  v33.y = v39;
                  sub_53384(&v33.x, (float *)(eax0 + 0x4E86), &v32[0].x);
                  v33 = v32[0];
                  sub_533D4(
                    &v32[0].x,
                    *(float *)(eax0 + 0x4E6E),
                    *(__int16 *)(eax0 + 0x4F22),
                    *(__int16 *)(eax0 + 0x4F24),
                    (int)v57,
                    (int)&v56);
                  *(_WORD *)(v2 + 0x2B) = v57[0];
                  v19 = (float *)v25;
                  v20 = 0;
                  *(_WORD *)(v2 + 0x2D) = v56;
                  do
                  {
                    v43 = &v34;
                    memset(&v26, 0, sizeof(v26));
                    v26.x = v33.x + *v19;
                    v26.y = v33.y + v19[1];
                    v21 = v33.z + v19[2];
                    v34 = v26;
                    v26.z = v21;
                    v32[0] = v26;
                    sub_533D4(
                      &v32[0].x,
                      *(float *)(eax0 + 0x4E6E),
                      *(__int16 *)(eax0 + 0x4F22),
                      *(__int16 *)(eax0 + 0x4F24),
                      (int)v57,
                      (int)&v56);
                    v24[v20] = v57[0];
                    v20 += 6;
                    v19 += 3;
                    v23[v20] = (__int16)v56;
                  }
                  while ( v20 != 0x18 );
                  v24[0x18] = v42;
                  sub_15D38(v52, v24);
                  if ( *(_BYTE *)v2 == 6 )
                  {
                    *(_WORD *)(eax0 + 0xBC) = *(_WORD *)(eax0 + 0x4E42) - 1;
                  }
                }
              }
              if ( a1.y - v39 > 0.0 )
              {
                v22 = v48;
                *(_DWORD *)(v2 + 0x1F) = 0;
              }
              else
              {
                v22 = v46;
                *(_DWORD *)(v2 + 0x1F) = 0xFFFFFFFF;
              }
              sub_15794(v22, v2);
            }
          }
        }
      }
      v2 += 0x35;
      result = v44 + 1;
      v11 = *(_DWORD *)(eax0 + 0x1D32);
      v44 = result;
    }
    while ( result < v11 );
  }
  return result;
}
// 10000: using guessed type void __noreturn sub_10000();
// 77394: using guessed type int __fastcall _wcpp_2_ctor_array_(_DWORD, _DWORD, _DWORD);
// 9049E: using guessed type float flt_9049E;
// 904A2: using guessed type float flt_904A2;
// 904A6: using guessed type float flt_904A6;
// 904AA: using guessed type float flt_904AA;
// 904AE: using guessed type float flt_904AE;
// 17430: using guessed type __int16 var_1C[14];

//----- (00017E50) --------------------------------------------------------
void __fastcall sub_17E50(int a1, int a2, int a3, int a4)
{
  int v4; // [esp+0h] [ebp-8h]

  *(float *)&v4 = (double)a2 * *(float *)V_Type3_stru_10AE70.j;
  sub_1BAF0((float *)(a1 + 0x4E46), a2, a3, a4, v4);
}

//----- (00017E88) --------------------------------------------------------
float *__fastcall sub_17E88(int a1, int a2)
{
  float *result; // eax
  int v4; // ecx
  double v5; // st7
  int v6; // ecx
  int v7; // ecx
  double v8; // st7
  int v9; // ecx

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x5BD);
  }
  result = (float *)(a1 + 0x1D1E);
  switch ( *(_BYTE *)a2 )
  {
    case 0:
      *result = 0.0;
      *(_DWORD *)(a1 + 0x1D22) = 0;
      *(_DWORD *)(a1 + 0x1D26) = 0;
      break;
    case 1:
      v6 = *(_DWORD *)(a2 + 1);
      *result = *(float *)v6;
      *(_DWORD *)(a1 + 0x1D22) = *(_DWORD *)(v6 + 4);
      *(_DWORD *)(a1 + 0x1D26) = *(_DWORD *)(v6 + 8);
      break;
    case 2:
      v4 = *(_DWORD *)(a2 + 1);
      v5 = *(float *)(v4 + 0x9E);
      v4 += 0x9E;
      *result = v5;
      *(_DWORD *)(a1 + 0x1D22) = *(_DWORD *)(v4 + 4);
      *(_DWORD *)(a1 + 0x1D26) = *(_DWORD *)(v4 + 8);
      break;
    case 3:
      v7 = *(_DWORD *)(a2 + 1);
      if ( V_Game.h1 == *(char **)v7 )
      {
        v8 = *(float *)(v7 + 8);
        v9 = v7 + 8;
      }
      else
      {
        v8 = *(float *)(v7 + 0x14);
        v9 = v7 + 0x14;
      }
      *result = v8;
      *(_DWORD *)(a1 + 0x1D22) = *(_DWORD *)(v9 + 4);
      *(_DWORD *)(a1 + 0x1D26) = *(_DWORD *)(v9 + 8);
      break;
    default:
      return result;
  }
  return result;
}

//----- (00017F54) --------------------------------------------------------
void __fastcall sub_17F54(int a1)
{
  *(_DWORD *)(a1 + 0x1D1E) = 0;
  *(_DWORD *)(a1 + 0x1D22) = 0;
  *(_DWORD *)(a1 + 0x1D26) = 0;
  *(float *)(a1 + 0x4F16) = *(float *)(a1 + 0x4F1A);
  *(_DWORD *)(a1 + 0x4E7A) = *(_DWORD *)(a1 + 0x4EDE);
  *(_DWORD *)(a1 + 0x4E7E) = *(_DWORD *)(a1 + 0x4EE2);
  *(_DWORD *)(a1 + 0x4E82) = *(_DWORD *)(a1 + 0x4EE6);
  *(float *)(a1 + 0x4E46) = *(float *)(a1 + 0x4EEA);
  *(float *)(a1 + 0x4E4A) = *(float *)(a1 + 0x4EEE);
  *(_DWORD *)(a1 + 0x4E4E) = *(_DWORD *)(a1 + 0x4EF2);
  *(_DWORD *)(a1 + 0x4E52) = *(_DWORD *)(a1 + 0x4EF6);
  *(_DWORD *)(a1 + 0x4E56) = *(_DWORD *)(a1 + 0x4EFA);
  *(_DWORD *)(a1 + 0x4E5A) = *(_DWORD *)(a1 + 0x4EFE);
  *(_DWORD *)(a1 + 0x4E5E) = *(_DWORD *)(a1 + 0x4F02);
  *(_DWORD *)(a1 + 0x4E62) = *(_DWORD *)(a1 + 0x4F06);
  *(_DWORD *)(a1 + 0x4E66) = *(_DWORD *)(a1 + 0x4F0A);
  sub_181F0(a1);
}

//----- (00017FF0) --------------------------------------------------------
void __fastcall sub_17FF0(int a1, int a2, int a3, int a4)
{
  double v5; // st6
  double x; // st6
  double v7; // st7
  int v8; // [esp+0h] [ebp-3Ch]
  int x_4; // [esp+Ch] [ebp-30h]
  float x_4a; // [esp+Ch] [ebp-30h]
  double v11; // [esp+10h] [ebp-2Ch]

  *(_DWORD *)(a1 + 0x1D1E) = 0;
  *(_DWORD *)(a1 + 0x4F26) = 0x23;
  v5 = (double)*(int *)(a1 + 0x4F26) * flt_959F4;
  *(_DWORD *)(a1 + 0x1D22) = 0;
  x = v5 * flt_904C1;
  *(_DWORD *)(a1 + 0x1D26) = 0;
  v11 = *(float *)(a1 + 0x4F1E);
  v7 = v11 / tan(x);
  x_4 = *(__int16 *)(a1 + 0x4F22);
  *(float *)(a1 + 0x4F16) = v7;
  *(float *)(a1 + 0x4F1A) = v7;
  *(float *)&v8 = (float)*(int *)(a1 + 0x4F26);
  sub_1B808((_DWORD *)(a1 + 0x4E46), a1, a1 + 0x4E46, a4, v8, 0x3F800000, 0x47C35000, x_4);
  *(_DWORD *)(a1 + 0x4EE6) = *(_DWORD *)(a1 + 0x4E6E);
  *(_BYTE *)(a1 + 0x4EE9) ^= 0x80u;
  *(float *)(a1 + 0x4EE2) = *(float *)(a1 + 0x4EE6) * flt_904C5;
  x_4a = *(float *)(a1 + 0x4F16);
  *(_DWORD *)(a1 + 0x4EDE) = 0;
  sub_53054((float *)(a1 + 0x4EDE), x_4a);
  *(_DWORD *)(a1 + 0x4E46) = 0x3F800000;
  *(_DWORD *)(a1 + 0x4E4A) = 0;
  *(_DWORD *)(a1 + 0x4E4E) = 0;
  *(_DWORD *)(a1 + 0x4E52) = 0;
  *(_DWORD *)(a1 + 0x4E56) = 0x3F800000;
  *(_DWORD *)(a1 + 0x4E5A) = 0;
  *(_DWORD *)(a1 + 0x4E5E) = 0;
  *(_DWORD *)(a1 + 0x4E62) = 0;
  *(_DWORD *)(a1 + 0x4E66) = 0x3F800000;
  *(float *)(a1 + 0x4EEA) = *(float *)(a1 + 0x4E46);
  *(float *)(a1 + 0x4EEE) = *(float *)(a1 + 0x4E4A);
  *(_DWORD *)(a1 + 0x4EF2) = *(_DWORD *)(a1 + 0x4E4E);
  *(_DWORD *)(a1 + 0x4EF6) = *(_DWORD *)(a1 + 0x4E52);
  *(_DWORD *)(a1 + 0x4EFA) = *(_DWORD *)(a1 + 0x4E56);
  *(_DWORD *)(a1 + 0x4EFE) = *(_DWORD *)(a1 + 0x4E5A);
  *(_DWORD *)(a1 + 0x4F02) = *(_DWORD *)(a1 + 0x4E5E);
  *(float *)(a1 + 0x4F06) = *(float *)(a1 + 0x4E62);
  *(float *)(a1 + 0x4F0A) = *(float *)(a1 + 0x4E66);
  *(float *)(a1 + 0x4F02) = -*(float *)(a1 + 0x4EDE);
  *(float *)(a1 + 0x4F06) = -*(float *)(a1 + 0x4EE2);
  *(float *)(a1 + 0x4F0A) = -*(float *)(a1 + 0x4EE6);
  sub_53864((float *)(a1 + 0x4EEA), a1, a1 + 0x4E46, a1 + 0x4EEA);
  *(_DWORD *)(a1 + 0x4E46) = *(_DWORD *)(a1 + 0x4EEA);
  *(_DWORD *)(a1 + 0x4E4A) = *(_DWORD *)(a1 + 0x4EEE);
  *(_DWORD *)(a1 + 0x4E4E) = *(_DWORD *)(a1 + 0x4EF2);
  *(_DWORD *)(a1 + 0x4E52) = *(_DWORD *)(a1 + 0x4EF6);
  *(_DWORD *)(a1 + 0x4E56) = *(_DWORD *)(a1 + 0x4EFA);
  *(_DWORD *)(a1 + 0x4E5A) = *(_DWORD *)(a1 + 0x4EFE);
  *(_DWORD *)(a1 + 0x4E5E) = *(_DWORD *)(a1 + 0x4F02);
  *(_DWORD *)(a1 + 0x4E62) = *(_DWORD *)(a1 + 0x4F06);
  *(_DWORD *)(a1 + 0x4E66) = *(_DWORD *)(a1 + 0x4F0A);
  *(_DWORD *)(a1 + 0x4E7A) = *(_DWORD *)(a1 + 0x4EDE);
  *(_DWORD *)(a1 + 0x4E7E) = *(_DWORD *)(a1 + 0x4EE2);
  *(_DWORD *)(a1 + 0x4E82) = *(_DWORD *)(a1 + 0x4EE6);
  sub_181F0(a1);
}
// 904C1: using guessed type float flt_904C1;
// 904C5: using guessed type float flt_904C5;
// 959F4: using guessed type float flt_959F4;

//----- (000181F0) --------------------------------------------------------
void __fastcall sub_181F0(int a1)
{
  *(float *)(a1 + 0x4F2A) = tan((double)*(int *)(a1 + 0x4F26) * flt_959F4 * flt_904C9);
  *(float *)(a1 + 0x4F2A) = *(float *)(a1 + 0x4F16) * *(float *)(a1 + 0x4F2A) * flt_904CD;
  *(float *)(a1 + 0x4F12) = *(float *)(a1 + 0x4F1A) * flt_904C9 + *(float *)(a1 + 0x4F16);
  *(float *)(a1 + 0x4F0E) = *(float *)(a1 + 0x4F16) - *(float *)(a1 + 0x4F2A) * flt_904C9;
}
// 904C9: using guessed type float flt_904C9;
// 904CD: using guessed type float flt_904CD;
// 959F4: using guessed type float flt_959F4;

//----- (0001826C) --------------------------------------------------------
void __fastcall sub_1826C(int a1, int a2, unsigned __int16 a3, unsigned __int16 a4)
{
  if ( a3 >= *(int *)(a1 + 0x1A8E) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x62B);
  }
  sub_156C0(a2, *(unsigned __int16 *)(a1 + 2 * a3 + 0x19C6), a4);
}

//----- (000182B8) --------------------------------------------------------
void __fastcall sub_182B8(int a1, int a2)
{
  double v3; // st7
  double v4; // st7
  int v5; // eax
  float v6; // [esp+4h] [ebp-8h]
  float v7; // [esp+4h] [ebp-8h]
  float v8; // [esp+4h] [ebp-8h]

  v3 = (double)a2;
  v6 = v3;
  if ( v3 <= flt_904E0 )
  {
    if ( v6 < (double)flt_904E4 )
    {
      v6 = -50.0;
    }
  }
  else
  {
    v6 = 50.0;
  }
  v7 = v6 * flt_904E8 * *(float *)V_Type3_stru_10AE70.j;
  v8 = v7 + 1.0;
  v4 = *(float *)(a1 + 0x4F16) * v8;
  *(float *)(a1 + 0x4F16) = v4;
  if ( v4 < *(float *)(a1 + 0x4E6E) )
  {
    v5 = *(_DWORD *)(a1 + 0x4E6E);
LABEL_9:
    *(_DWORD *)(a1 + 0x4F16) = v5;
    goto LABEL_10;
  }
  if ( *(float *)(a1 + 0x4F16) > (double)*(float *)(a1 + 0x4F1A) )
  {
    v5 = *(_DWORD *)(a1 + 0x4F1A);
    goto LABEL_9;
  }
LABEL_10:
  sub_53054((float *)(a1 + 0x4E7A), *(float *)(a1 + 0x4F16));
  sub_181F0(a1);
}
// 904E0: using guessed type float flt_904E0;
// 904E4: using guessed type float flt_904E4;
// 904E8: using guessed type float flt_904E8;

//----- (00018370) --------------------------------------------------------
unsigned int __fastcall sub_18370(int a1)
{
  __int16 v2; // ax
  __int16 v3; // cx
  __int16 v4; // bx
  __int16 v5; // ax
  void *v6; // eax
  void *v7; // eax
  char *v8; // ebp
  T_FileInfo v10; // [esp+0h] [ebp-15Ch] BYREF
  char s[20]; // [esp+118h] [ebp-44h] BYREF
  _WORD v12[10]; // [esp+12Ch] [ebp-30h] BYREF
  int i; // [esp+140h] [ebp-1Ch]

  v2 = *(_WORD *)(a1 + 0x10) - *(_WORD *)(a1 + 8);
  v3 = *(_WORD *)(a1 + 0xC);
  *(_WORD *)(a1 + 0x4F22) = v2;
  v4 = v2;
  v5 = *(_WORD *)(a1 + 0x14);
  *(_WORD *)(a1 + 0x4F22) = v4 >> 1;
  *(_WORD *)(a1 + 0x4F24) = (__int16)(v5 - v3) >> 1;
  *(_DWORD *)(a1 + 0x1D1E) = 0;
  *(_DWORD *)(a1 + 0x1D22) = 0;
  *(_DWORD *)(a1 + 0x1D26) = 0;
  if ( *(_DWORD *)(a1 + 0x1D2A) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x65E);
  }
  if ( *(_DWORD *)(a1 + 0x19BE) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x65F);
  }
  *(_DWORD *)(a1 + 0x1D2E) = 0x80;
  v6 = operator new[](0x35 * *(_DWORD *)(a1 + 0x1D2E));
  Q_RegisterData_sub_2625C(v6, 1, "BATDISPLAYITEMS");
  *(_DWORD *)(a1 + 0x1D2A) = v6;
  if ( !v6 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x669);
  }
  *(_DWORD *)(a1 + 0x19C2) = 0x27;
  v7 = operator new[](*(_DWORD *)(a1 + 0x19C2) << 8);
  Q_RegisterData_sub_2625C(v7, 1, "BATHAZE");
  *(_DWORD *)(a1 + 0x19BE) = v7;
  if ( !v7 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x66F);
  }
  v8 = *(char **)(a1 + 0x19BE);
  Q_InitFileInfo_sub_1BB78(&v10);
  for ( i = 0; i < 0x1F; ++i )
  {
    sprintf(s, "DATA\\BLACK%.2d.HAZ", i);
    if ( Q_OpenFile_sub_1BBFC(&v10, s, 0x200, 0) )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\batmode.cpp", 0x67B);
    }
    Q_CfileLoad_sub_1BF1C(&v10, v8);
    v8 += 0x100;
  }
  if ( Q_OpenFile_sub_1BBFC(&v10, "DATA\\SLANE03.HAZ", 0x200, 0) )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\batmode.cpp", 0x680);
  }
  Q_CfileLoad_sub_1BF1C(&v10, v8);
  i = 0x41;
  strcpy((char *)v12, "DATA\\RACEA03.HAZ");
  HIBYTE(v12[8]) = aDataRacea03Haz[0x11];
  v12[9] = *(_WORD *)&aDataRacea03Haz[0x12];
  do
  {
    HIBYTE(v12[4]) = i;
    v8 += 0x100;
    if ( Q_OpenFile_sub_1BBFC(&v10, (const char *)v12, 0x200, 0) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x68A);
    }
    Q_CfileLoad_sub_1BF1C(&v10, v8);
    ++i;
  }
  while ( i < 0x48 );
  Q_CloseFileAndDelete_sub_1BBC8(&v10);
  return 0xFFFFFFFF;
}

//----- (000185CC) --------------------------------------------------------
int __fastcall sub_185CC(int a1)
{
  int v2; // esi
  int v3; // edx
  int v4; // edi
  int v5; // eax
  _DWORD *v6; // ebx
  int v7; // edx
  int result; // eax

  v2 = *((__int16 *)V_Game.h1 + 2);
  if ( v2 >= 0x64 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x697);
  }
  v3 = a1 + 0xBE;
  v4 = 0xC * v2;
  *(_DWORD *)(v3 + v4) = *(_DWORD *)(a1 + 0x4E7A);
  *(_DWORD *)(v3 + v4 + 4) = *(_DWORD *)(a1 + 0x4E7E);
  *(_DWORD *)(v3 + v4 + 8) = *(_DWORD *)(a1 + 0x4E82);
  v5 = 0x24 * v2 + a1 + 0x56E;
  v6 = (_DWORD *)(v5 + 0xC);
  *(float *)v5 = *(float *)(a1 + 0x4E46);
  v5 += 0x18;
  *(float *)(v5 - 0x14) = *(float *)(a1 + 0x4E4A);
  *(_DWORD *)(v5 - 0x10) = *(_DWORD *)(a1 + 0x4E4E);
  *v6 = *(_DWORD *)(a1 + 0x4E52);
  v6[1] = *(_DWORD *)(a1 + 0x4E56);
  v6[2] = *(_DWORD *)(a1 + 0x4E5A);
  *(_DWORD *)v5 = *(_DWORD *)(a1 + 0x4E5E);
  *(_DWORD *)(v5 + 4) = *(_DWORD *)(a1 + 0x4E62);
  v7 = a1 + 0x150E;
  *(float *)(v5 + 8) = *(float *)(a1 + 0x4E66);
  result = a1 + 0x1D1E;
  *(_DWORD *)(v7 + v4) = *(_DWORD *)(a1 + 0x1D1E);
  *(_DWORD *)(v7 + v4 + 4) = *(_DWORD *)(a1 + 0x1D22);
  *(_DWORD *)(v7 + v4 + 8) = *(_DWORD *)(a1 + 0x1D26);
  *(_DWORD *)(a1 + 0x4F2F) = 0;
  *(_BYTE *)(a1 + 0xB7) = 0;
  *(_DWORD *)(a1 + 0xB3) = 0;
  return result;
}

//----- (000186B8) --------------------------------------------------------
void __fastcall sub_186B8(int a1, int a2, int a3)
{
  int v4; // esi
  int v5; // edx
  int v6; // ebx
  float *v7; // edi
  double v8; // st7

  sub_187EC(a1);
  v4 = *((__int16 *)V_Game.h1 + 2);
  if ( v4 >= 0x64 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x6AE);
  }
  v5 = a1 + 4 * v4;
  if ( *(_DWORD *)(v5 + 0x137E) )
  {
    *(_DWORD *)(a1 + 0x4E7A) = *(_DWORD *)(a1 + 0xBE + 0xC * v4);
    *(_DWORD *)(a1 + 0x4E7E) = *(_DWORD *)(a1 + 0xBE + 0xC * v4 + 4);
    v6 = 0x24 * v4 + a1 + 0x56E;
    *(float *)(a1 + 0x4E82) = *(float *)(a1 + 0xBE + 0xC * v4 + 8);
    v7 = (float *)(v6 + 0xC);
    *(float *)(a1 + 0x4E46) = *(float *)v6;
    v8 = *(float *)(v6 + 4);
    v6 += 0x18;
    *(float *)(a1 + 0x4E4A) = v8;
    *(float *)(a1 + 0x4E4E) = *(float *)(v6 - 0x10);
    *(float *)(a1 + 0x4E52) = *v7;
    *(float *)(a1 + 0x4E56) = v7[1];
    *(float *)(a1 + 0x4E5A) = v7[2];
    *(_DWORD *)(a1 + 0x4E5E) = *(_DWORD *)v6;
    *(_DWORD *)(a1 + 0x4E62) = *(_DWORD *)(v6 + 4);
    *(_DWORD *)(a1 + 0x4E66) = *(_DWORD *)(v6 + 8);
    *(_DWORD *)(a1 + 0x1D1E) = *(_DWORD *)(a1 + 0x150E + 0xC * v4);
    *(_DWORD *)(a1 + 0x1D22) = *(_DWORD *)(a1 + 0x150E + 0xC * v4 + 4);
    *(_DWORD *)(a1 + 0x1D26) = *(_DWORD *)(a1 + 0x150E + 0xC * v4 + 8);
    *(float *)(a1 + 0x4F16) = sqrt(
                                *(float *)(a1 + 0x4E7E) * *(float *)(a1 + 0x4E7E)
                              + *(float *)(a1 + 0x4E7A) * *(float *)(a1 + 0x4E7A)
                              + *(float *)(a1 + 0x4E82) * *(float *)(a1 + 0x4E82));
    sub_181F0(a1);
  }
  else
  {
    sub_17FF0(a1, v5, a3, a1);
    *(_DWORD *)(v5 + 0x137E) = 0xFFFFFFFF;
  }
  sub_18C2C(a1, 0);
}

//----- (000187EC) --------------------------------------------------------
int __fastcall sub_187EC(int a1)
{
  __int16 i; // si
  int v3; // eax
  int v4; // esi
  __int16 v5; // ax
  int v6; // esi
  unsigned __int16 *h1; // eax
  int v8; // ecx
  int v9; // ebx
  int v10; // eax
  signed __int16 v11; // cx
  float *v12; // eax
  float v13; // eax
  int v14; // ebp
  __int16 *v15; // eax
  int v16; // ebp
  unsigned __int16 v17; // ax
  __int16 v18; // cx
  int v19; // ebp
  int v20; // eax
  __int16 v21; // bx
  int result; // eax
  int v23; // ecx
  double x; // [esp+0h] [ebp-1ECh]
  int v25[107]; // [esp+8h] [ebp-1E4h] BYREF
  float v26; // [esp+1B4h] [ebp-38h]
  float v27; // [esp+1B8h] [ebp-34h]
  float v28; // [esp+1BCh] [ebp-30h]
  float v29; // [esp+1C0h] [ebp-2Ch]
  int v30; // [esp+1C4h] [ebp-28h]
  int v31; // [esp+1C8h] [ebp-24h]
  int v32; // [esp+1CCh] [ebp-20h]
  int v33; // [esp+1D0h] [ebp-1Ch]

  for ( i = 0; i < *(_DWORD *)(a1 + 0x1D2E); ++i )
  {
    v3 = 0x35 * i;
    *(_BYTE *)(*(_DWORD *)(a1 + 0x1D2A) + v3 + 0x33) = 0;
  }
  v4 = *(_DWORD *)(a1 + 0x1D2A);
  *(_DWORD *)(a1 + 0x1D32) = 0;
  *(_BYTE *)v4 = 6;
  *(_DWORD *)(a1 + 0x1D16) = v4;
  *(_WORD *)(v4 + 5) = 0xFFFF;
  v5 = 0;
  v6 = v4 + 0x35;
  ++*(_DWORD *)(a1 + 0x1D32);
  while ( v5 < 1 )
  {
    *(_BYTE *)v6 = 0xFF;
    ++v5;
    v6 += 0x35;
    ++*(_DWORD *)(a1 + 0x1D32);
  }
  *(_BYTE *)v6 = 0;
  h1 = (unsigned __int16 *)V_Game.h1;
  *(_DWORD *)(v6 + 1) = V_Game.h1;
  sub_1826C(a1, v6, 1u, *h1);
  v8 = *(_DWORD *)(a1 + 0x1D32) + 1;
  LOWORD(v32) = 0;
  *(_DWORD *)(a1 + 0x1D32) = v8;
  while ( (__int16)v32 < *((__int16 *)V_Game.h1 + 0x2D) )
  {
    if ( *(_DWORD *)(a1 + 0x1D32) >= *(_DWORD *)(a1 + 0x1D2E) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x6FC);
    }
    v6 += 0x35;
    v10 = *(_DWORD *)&V_Game.h1[4 * (__int16)v32 + 0x46];
    *(_BYTE *)v6 = 1;
    *(_DWORD *)(v6 + 1) = v10;
    v11 = *(_WORD *)(v10 + 0x14) + 5 * *(_WORD *)(v10 + 0x16);
    if ( v11 >= 0x37 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x706);
    }
    sub_1826C(a1, v6, 0, v11);
    v9 = *(_DWORD *)(a1 + 0x1D32) + 1;
    LOWORD(v32) = v32 + 1;
    *(_DWORD *)(a1 + 0x1D32) = v9;
  }
  v12 = *(float **)(v6 + 1);
  x = v12[1] * v12[1] + *v12 * *v12 + v12[2] * v12[2];
  LOWORD(v33) = 0;
  *(float *)(a1 + 0x4F1E) = sqrt(x);
  while ( 1 )
  {
    v15 = (__int16 *)V_Game.h1;
    if ( (__int16)v33 >= *((__int16 *)V_Game.h1 + 0x22) )
    {
      break;
    }
    if ( *(_DWORD *)(a1 + 0x1D32) >= *(_DWORD *)(a1 + 0x1D2E) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x716);
    }
    v6 += 0x35;
    v16 = *(_DWORD *)&V_Game.h1[4 * (__int16)v33 + 0x2C];
    *(_BYTE *)v6 = 3;
    *(_DWORD *)(v6 + 1) = v16;
    v17 = (*(_BYTE *)(v16 + 0x23) & 1) != 0;
    if ( (*(_BYTE *)(v16 + 0x23) & 2) != 0 )
    {
      v17 += 2;
    }
    sub_1826C(a1, v6, 2u, v17);
    v26 = 0.0;
    v27 = 0.0;
    v28 = 0.0;
    if ( V_Game.h1 == *(char **)v16 )
    {
      *(_BYTE *)(v6 + 0x33) |= 1u;
      v26 = *(float *)(v16 + 8);
      v27 = *(float *)(v16 + 0xC);
      v13 = *(float *)(v16 + 0x10);
    }
    else
    {
      *(_BYTE *)(v6 + 0x33) &= ~1u;
      v26 = *(float *)(v16 + 0x14);
      v27 = *(float *)(v16 + 0x18);
      v13 = *(float *)(v16 + 0x1C);
    }
    v28 = v13;
    v29 = sqrt(v27 * v27 + v26 * v26 + v13 * v13);
    if ( *(float *)(a1 + 0x4F1E) < (double)v29 )
    {
      *(float *)(a1 + 0x4F1E) = v29;
    }
    v14 = *(_DWORD *)(a1 + 0x1D32) + 1;
    LOWORD(v33) = v33 + 1;
    *(_DWORD *)(a1 + 0x1D32) = v14;
  }
  v18 = 0;
  *(float *)(a1 + 0x4F1E) = *(float *)(a1 + 0x4F1E) + flt_905FA;
  v30 = sub_1D794(v15, v25);
  while ( v18 < v30 )
  {
    v19 = v25[v18];
    if ( *(_BYTE *)(v19 + 0x58) == 4 )
    {
      if ( *(_DWORD *)(a1 + 0x1D32) >= *(_DWORD *)(a1 + 0x1D2E) )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x750);
      }
      v6 += 0x35;
      *(_DWORD *)(v6 + 1) = v19;
      *(_BYTE *)v6 = 2;
      sub_156C0(v6, (unsigned __int16)word_FFEBC[*(__int16 *)(v19 + 0x56)], *(char *)(v19 + 0xAA));
      ++*(_DWORD *)(a1 + 0x1D32);
    }
    ++v18;
  }
  LOWORD(v31) = 0;
  if ( V_Game.sectorsNum > 0 )
  {
    do
    {
      if ( *(_DWORD *)(a1 + 0x1D32) >= *(_DWORD *)(a1 + 0x1D2E) )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x761);
      }
      v20 = (__int16)v31;
      v6 += 0x35;
      *(_BYTE *)v6 = 4;
      *(_DWORD *)(v6 + 1) = &V_Game.sectors[v20];
      sub_1826C(a1, v6, 3u, V_Game.sectors[v20].n);
      v21 = v31;
      ++*(_DWORD *)(a1 + 0x1D32);
      LOWORD(v31) = v21 + 1;
    }
    while ( (__int16)(v21 + 1) < V_Game.sectorsNum );
  }
  for ( result = 0; (__int16)result < *(_DWORD *)(a1 + 0x1D32); ++result )
  {
    v23 = 0x35 * (__int16)result;
    *(_BYTE *)(v23 + *(_DWORD *)(a1 + 0x1D2A) + 0x33) &= ~4u;
  }
  return result;
}
// 905FA: using guessed type float flt_905FA;
// FFEBC: using guessed type __int16 word_FFEBC[7];
// 187EC: using guessed type int var_1E4[107];

//----- (00018C2C) --------------------------------------------------------
void __fastcall sub_18C2C(int a1, int a2)
{
  size_t *v4; // ecx
  int v5; // edx

  v4 = (size_t *)(a1 + 0x1D36);
  v5 = a1 + 0x253A;
  sub_15788(a1 + 0x1D36);
  sub_15788(a1 + 0x253A);
  sub_15788(a1 + 0x2D3E);
  sub_15D2C(a1 + 0x3542);
  sub_173F4(a1, v5, a1, (int)v4);
  sub_157EC(v4);
  sub_157EC((size_t *)(a1 + 0x253A));
  if ( !a2 )
  {
    (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
  }
}

//----- (00018CA8) --------------------------------------------------------
void __fastcall sub_18CA8(int a1, int a2)
{
  char v3; // ah
  int v4; // eax
  char *v5; // eax
  int v6; // ebx
  int v7; // edx
  int v8; // edx
  __int16 v9; // bx
  const char *v10; // esi
  char *v11; // edi
  int v12; // edx
  char v13; // al
  char v14; // al
  int v15; // edx
  char *v16; // ecx
  int v17; // ebx
  char *v18; // eax
  int v19; // eax
  char *v20; // eax
  char *v21; // esi
  int v22; // edx
  char *v23; // edi
  char v24; // al
  char v25; // al
  __int16 v26; // dx
  int v27; // ebx
  char *v28; // esi
  char *v29; // eax
  char *v30; // edi
  char v31; // al
  char v32; // al
  char *v33; // edi
  char *v34; // esi
  char v35; // al
  char v36; // al
  char *v37; // edi
  char *v38; // esi
  char v39; // al
  char v40; // al
  int v41; // eax
  int v42; // ebx
  char *v43; // esi
  char *v44; // edi
  char v45; // al
  char v46; // al
  char *v47; // esi
  char *v48; // edi
  char v49; // al
  char v50; // al
  char *v51; // edi
  char *sub_1CEA8; // esi
  char v53; // al
  char v54; // al
  int v55; // eax
  char v56; // dl
  const char *v57; // ecx
  __int16 v58; // [esp-Ch] [ebp-184h]
  int v59; // [esp-4h] [ebp-17Ch]
  char *v60; // [esp-4h] [ebp-17Ch]
  _DWORD v61[50]; // [esp+0h] [ebp-178h] BYREF
  char v62[60]; // [esp+C8h] [ebp-B0h] BYREF
  char v63[40]; // [esp+118h] [ebp-60h] BYREF
  char v64[12]; // [esp+154h] [ebp-24h] BYREF
  int v65; // [esp+174h] [ebp-4h]

  if ( !a2 )
  {
    stru_9A23C = *(PANE *)(a1 + 4);
  }
  VFX_pane_wipe((PANE *)(a1 + 4), *(unsigned __int8 *)(a1 + 0x4F2E));
  sub_15948(a1 + 0x2D3E, a1);
  sub_19AE8(a1);
  sub_15948(a1 + 0x253A, a1);
  if ( *(_DWORD *)(a1 + 0x5046) )
  {
    sub_15D74(a1 + 0x3542, a1);
  }
  if ( !*(_DWORD *)(a1 + 0xAF) )
  {
    v3 = *(_BYTE *)(a1 + 0xB7);
    if ( v3 == 2 || v3 == 3 )
    {
      sub_15DA4(a1 + 0x3542, a1, *(_WORD *)(a1 + 0xBC));
    }
  }
  if ( *(_DWORD *)(a1 + 0x503A) && (*(_BYTE *)(a1 + 0x4F2F) & 1) == 0 )
  {
    sub_1936C(a1);
  }
  if ( *(_DWORD *)(a1 + 0x5046) )
  {
    sub_15E1C((int *)(a1 + 0x3542), a1);
  }
  sub_15948(a1 + 0x1D36, a1);
  Q_WINMGR_CPP_sub_53E38((PANE *)(a1 + 4), 3, 3, byte_104BEA);
  if ( !V_Type3_stru_10AE70.wnds[dword_96BAC].a1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x7AC);
  }
  v4 = *(_DWORD *)(a1 + 0xAF);
  v65 = 0;
  if ( v4 )
  {
    v51 = v63;
    sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(2); // 2: "Unknown"
    do
    {
      v53 = *sub_1CEA8;
      *v51 = *sub_1CEA8;
      if ( !v53 )
      {
        break;
      }
      v54 = sub_1CEA8[1];
      sub_1CEA8 += 2;
      v51[1] = v54;
      v51 += 2;
    }
    while ( v54 );
    v55 = *(_DWORD *)(a1 + 0xAF);
    v26 = 0xF3;
    switch ( *(_BYTE *)v55 )
    {
      case 0:
        v59 = *(_DWORD *)(v55 + 1) + 0x1C;
        v5 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(3);    // 3: "Sun %s"
        sprintf(v63, v5, v59);
        break;
      case 1:
        v17 = *(_DWORD *)(v55 + 1);
        v18 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(4);   // 4: "Planet %s"
        sprintf(v63, v18, v17 + 0x24);
        v19 = *(unsigned __int8 *)(v17 + 0x57);
        if ( v19 != 0xFF )
        {
          v60 = V_SpecNames[V_Game.races[v19].Unknown_01];
          v20 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(5); // 5: "\nOwned by %s"
          v21 = v64;
          sprintf(v64, v20, v60);
          v22 = 0;
          v23 = &v63[strlen(v63)];
          do
          {
            v24 = *v21;
            *v23 = *v21;
            if ( !v24 )
            {
              break;
            }
            v25 = v21[1];
            v21 += 2;
            v23[1] = v25;
            v23 += 2;
          }
          while ( v25 );
          LOBYTE(v22) = *(_BYTE *)(v17 + 0x57);
          v26 = 4 * V_Game.races[v22].Unknown_02 + 0x13;
        }
        break;
      case 2:
        v65 = *(_DWORD *)(v55 + 1);
        v27 = v65;
        sprintf(
          v63,
          "%s %s",
          V_SpecNames[V_Game.races[*(__int16 *)(v65 + 0x56)].Unknown_01],
          (const char *)(v65 + 0x34));
        if ( *(_WORD *)(v27 + 0x56) == byte_104BEA && *(_BYTE *)(v27 + 0x5D) )
        {
          v28 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(6); // 6: "\nMoving to Star Lane"
          v29 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(7); // 7: "\nMoving to Planet"
          if ( *(_BYTE *)(v27 + 0x5D) != 1 )
          {
            v28 = v29;
          }
          v30 = &v63[strlen(v63)];
          do
          {
            v31 = *v28;
            *v30 = *v28;
            if ( !v31 )
            {
              break;
            }
            v32 = v28[1];
            v28 += 2;
            v30[1] = v32;
            v30 += 2;
          }
          while ( v32 );
        }
        v26 = 4 * V_Game.races[*(__int16 *)(v27 + 0x56)].Unknown_02 + 0x13;
        break;
      case 3:
        v33 = v63;
        v34 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(8);   // 8: "Star Lane"
        do
        {
          v35 = *v34;
          *v33 = *v34;
          if ( !v35 )
          {
            break;
          }
          v36 = v34[1];
          v34 += 2;
          v33[1] = v36;
          v33 += 2;
        }
        while ( v36 );
        if ( (*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(a1 + 0xAF) + 1) + 0x23) & 1) != 0 )
        {
          v37 = v63;
          v38 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(9); // 9: "Red Link"
          do
          {
            v39 = *v38;
            *v37 = *v38;
            if ( !v39 )
            {
              break;
            }
            v40 = v38[1];
            v38 += 2;
            v37[1] = v40;
            v37 += 2;
          }
          while ( v40 );
        }
        v41 = *(_DWORD *)(a1 + 0xAF);
        if ( (*(_BYTE *)(v41 + 0x33) & 1) != 0 )
        {
          v42 = *(_DWORD *)(*(_DWORD *)(v41 + 1) + 4);
        }
        else
        {
          v42 = **(_DWORD **)(v41 + 1);
        }
        if ( ((1 << byte_104BEA) & *(unsigned __int8 *)(v42 + 0x17)) != 0 )
        {
          v43 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xA);// 10: " to "
          v44 = &v63[strlen(v63)];
          do
          {
            v45 = *v43;
            *v44 = *v43;
            if ( !v45 )
            {
              break;
            }
            v46 = v43[1];
            v43 += 2;
            v44[1] = v46;
            v44 += 2;
          }
          while ( v46 );
          v47 = (char *)(v42 + 0x1C);
          v48 = &v63[strlen(v63)];
          do
          {
            v49 = *v47;
            *v48 = *v47;
            if ( !v49 )
            {
              break;
            }
            v50 = v47[1];
            v47 += 2;
            v48[1] = v50;
            v48 += 2;
          }
          while ( v50 );
        }
        break;
      default:
        break;
    }
    v58 = v26;
    v6 = *(_DWORD *)(a1 + 0x14) - 0x1E;
    v7 = *(_DWORD *)(a1 + 0x10) - 0xC8;
    *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = V_Type6_stru_D8654.pane;
    sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], v7, v6, v63, 0, v58, 0xFF, 0);
  }
  v8 = v65;
  sub_17260(a1);
  if ( v8 )
  {
    v9 = V_NougatLfExists_dword_A0CFC;
    if ( V_NougatLfExists_dword_A0CFC == 0xFFFFFFFF )
    {
      sprintf(v62, "%s %s", V_SpecNames[V_Game.races[*(__int16 *)(v8 + 0x56)].Unknown_01], (const char *)(v8 + 0x34));
      V_Type3_stru_10AE70.pane = V_Type6_stru_D8654.pane;
      sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0xFA, 0xA, v62, 0, v9, v9, 0);
      sprintf(
        v62,
        "POWER %d MOVES %d INTEGRITY %d",
        *(_DWORD *)(v65 + 0x88),
        *(_DWORD *)(v65 + 0x94),
        *(_DWORD *)(v65 + 0x8C));
      V_Type3_stru_10AE70.pane = V_Type6_stru_D8654.pane;
      sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0xFA, 0x14, v62, 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
      qmemcpy(v61, "SONothing", sizeof(v61));
      v10 = "INVALID ORDER";
      v11 = v62;
      v12 = v65;
      do
      {
        v13 = *v10;
        *v11 = *v10;
        if ( !v13 )
        {
          break;
        }
        v14 = v10[1];
        v10 += 2;
        v11[1] = v14;
        v11 += 2;
      }
      while ( v14 );
      v15 = *(char *)(v12 + 0x5D);
      if ( v15 >= 0 && *(char *)(v65 + 0x5D) <= 7 )
      {
        v16 = (char *)&v61[5 * v15];
      }
      else
      {
        v16 = v62;
      }
      V_Type3_stru_10AE70.pane = V_Type6_stru_D8654.pane;
      sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0xFA, 0x1E, v16, 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
      v56 = *(_BYTE *)(v65 + 0x5D);
      if ( v56 == 1 )
      {
        v57 = (const char *)(*(_DWORD *)(v65 + 0x5E) + 0x1C);
LABEL_68:
        V_Type3_stru_10AE70.pane = V_Type6_stru_D8654.pane;
        sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0x140, 0x1E, v57, 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
        goto LABEL_69;
      }
      if ( v56 == 2 )
      {
        v57 = (const char *)(*(_DWORD *)(v65 + 0x5E) + 0x24);
        goto LABEL_68;
      }
    }
  }
LABEL_69:
  sub_552CC(&V_Type3_stru_10AE70, &stru_9A23C);
}
// 96BAC: using guessed type int dword_96BAC;
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// 18CA8: using guessed type char var_60[40];

//----- (0001936C) --------------------------------------------------------
void __fastcall sub_1936C(int a1)
{
  double v2; // st7
  int v3; // edx
  double v4; // st7
  int v5; // ebp
  float *v6; // edi
  double v7; // st7
  double v8; // st7
  float *v9; // edx
  int v10; // ecx
  int v11; // ebx
  int v12; // ebp
  float *v13; // edi
  double v14; // st7
  double v15; // st7
  float *v16; // edx
  int v17; // ecx
  int v18; // ebx
  int v19[3]; // [esp+8h] [ebp-110h] BYREF
  float v20; // [esp+14h] [ebp-104h]
  float v21; // [esp+18h] [ebp-100h]
  float v22; // [esp+1Ch] [ebp-FCh]
  float v23; // [esp+20h] [ebp-F8h]
  float v24; // [esp+24h] [ebp-F4h]
  float v25; // [esp+28h] [ebp-F0h]
  float v26; // [esp+2Ch] [ebp-ECh]
  float v27; // [esp+30h] [ebp-E8h]
  float v28; // [esp+34h] [ebp-E4h]
  float v29[3]; // [esp+38h] [ebp-E0h] BYREF
  float v30; // [esp+44h] [ebp-D4h] BYREF
  float v31; // [esp+48h] [ebp-D0h]
  float v32; // [esp+4Ch] [ebp-CCh]
  float v33; // [esp+50h] [ebp-C8h] BYREF
  float v34; // [esp+54h] [ebp-C4h]
  float v35; // [esp+58h] [ebp-C0h]
  int v36[3]; // [esp+5Ch] [ebp-BCh] BYREF
  float v37; // [esp+68h] [ebp-B0h]
  float v38; // [esp+6Ch] [ebp-ACh]
  float v39; // [esp+70h] [ebp-A8h]
  int v40[3]; // [esp+74h] [ebp-A4h] BYREF
  int v41[3]; // [esp+80h] [ebp-98h] BYREF
  float v42; // [esp+8Ch] [ebp-8Ch]
  int *v43; // [esp+90h] [ebp-88h]
  int *v44; // [esp+94h] [ebp-84h]
  int v45; // [esp+98h] [ebp-80h]
  float v46; // [esp+9Ch] [ebp-7Ch]
  int *v47; // [esp+A0h] [ebp-78h]
  int *v48; // [esp+A4h] [ebp-74h]
  int v49; // [esp+A8h] [ebp-70h]
  PANE *v50; // [esp+ACh] [ebp-6Ch]
  PANE *pane; // [esp+B0h] [ebp-68h]
  int v52; // [esp+B4h] [ebp-64h]
  float *v53; // [esp+B8h] [ebp-60h]
  float *v54; // [esp+BCh] [ebp-5Ch]
  LONG parm; // [esp+C0h] [ebp-58h]
  int v56; // [esp+C4h] [ebp-54h]
  float v57; // [esp+C8h] [ebp-50h]
  int v58; // [esp+CCh] [ebp-4Ch]
  int v59; // [esp+D0h] [ebp-48h]
  int v60; // [esp+D4h] [ebp-44h]
  int v61; // [esp+D8h] [ebp-40h]
  float v62; // [esp+DCh] [ebp-3Ch]
  float v63; // [esp+E0h] [ebp-38h]
  float v64; // [esp+E4h] [ebp-34h]
  float v65; // [esp+E8h] [ebp-30h]
  float v66; // [esp+ECh] [ebp-2Ch]
  int v67; // [esp+F0h] [ebp-28h] BYREF
  int v68; // [esp+F4h] [ebp-24h] BYREF
  int v69; // [esp+F8h] [ebp-20h] BYREF
  __int16 v70[14]; // [esp+FCh] [ebp-1Ch] BYREF

  v30 = 0.0;
  v31 = 0.0;
  v32 = 0.0;
  v33 = 0.0;
  v34 = 0.0;
  v35 = 0.0;
  memset(v29, 0, sizeof(v29));
  v2 = *(float *)(a1 + 0x4F2A) * flt_90646;
  v57 = v2;
  v57 = v2 * v57;
  v45 = (int)(*(float *)(a1 + 0x4F2A) * flt_9064A);
  v58 = v45 + 2;
  v45 = (int)(*(float *)(a1 + 0x4F2A) * flt_9064E);
  v49 = 0x20 * (v58 / 2) + 0x10;
  v3 = (v45 + 2) / 2;
  v52 = 0x68;
  parm = 0x61;
  v59 = 0xA0 * v3 + 0x10;
  if ( v59 > v49 )
  {
    v59 = 0xA0 * v3 - 0x90;
  }
  v4 = *(float *)(a1 + 0x4F2A);
  v60 = 0xFFFFFFFF;
  v56 = 0;
  if ( v4 < flt_90652 )
  {
    v56 = 0xFFFFFFFF;
  }
  v5 = 0;
  v64 = *(float *)(a1 + 0x4F16) * flt_90656;
  v66 = (float)v49;
  if ( v58 > 0 )
  {
    v6 = (float *)(a1 + 0x1D1E);
    pane = (PANE *)(a1 + 4);
    v53 = (float *)(a1 + 0x4E86);
    do
    {
      if ( (double)v59 == v66 )
      {
        v60 = v5;
      }
      v62 = v57 - v66 * v66;
      if ( v62 > 0.0 )
      {
        v62 = sqrt(v62);
        v30 = v66;
        v31 = v64;
        v37 = 0.0;
        v32 = v62;
        v33 = v66;
        v42 = -v62;
        v34 = v64;
        v38 = 0.0;
        v35 = v42;
        v39 = 0.0;
        v44 = v36;
        v37 = v66 + *v6;
        v38 = v64 + *(float *)(a1 + 0x1D22);
        v7 = v62 + *(float *)(a1 + 0x1D26);
        *(float *)v36 = v37;
        v39 = v7;
        *(float *)&v36[1] = v38;
        *(float *)&v36[2] = v39;
        v30 = v37;
        v26 = 0.0;
        v31 = v38;
        v27 = 0.0;
        v32 = v39;
        v28 = 0.0;
        v43 = v40;
        v26 = v66 + *v6;
        v27 = v64 + *(float *)(a1 + 0x1D22);
        v8 = v42 + *(float *)(a1 + 0x1D26);
        *(float *)v40 = v26;
        v28 = v8;
        *(float *)&v40[1] = v27;
        *(float *)&v40[2] = v28;
        v33 = v26;
        v34 = v27;
        v35 = v28;
        sub_53384(&v30, v53, v29);
        v9 = v53;
        sub_533D4(
          v29,
          *(float *)(a1 + 0x4E6E),
          *(__int16 *)(a1 + 0x4F22),
          *(__int16 *)(a1 + 0x4F24),
          (int)&v68,
          (int)&v69);
        sub_53384(&v33, v9, v29);
        v10 = v60;
        v11 = 0xFFFFFFFF;
        sub_533D4(
          v29,
          *(float *)(a1 + 0x4E6E),
          *(__int16 *)(a1 + 0x4F22),
          *(__int16 *)(a1 + 0x4F24),
          (int)v70,
          (int)&v67);
        if ( v10 < 0 || (v5 - v10) % 5 )
        {
          if ( v56 )
          {
            v11 = v52;
          }
        }
        else
        {
          v11 = parm;
        }
        if ( v11 != 0xFFFFFFFF )
        {
          VFX_line_draw(pane, (__int16)v68, (__int16)v69, v70[0], (__int16)v67, 0, v11);
        }
      }
      ++v5;
      v66 = v66 + flt_9065A;
    }
    while ( v5 < v58 );
  }
  v65 = (float)v49;
  v12 = 0;
  v61 = 0xFFFFFFFF;
  if ( v58 > 0 )
  {
    v13 = (float *)(a1 + 0x1D1E);
    v50 = (PANE *)(a1 + 4);
    v54 = (float *)(a1 + 0x4E86);
    do
    {
      if ( (double)v59 == v65 )
      {
        v61 = v12;
      }
      v63 = v57 - v65 * v65;
      if ( v63 > 0.0 )
      {
        v63 = sqrt(v63);
        v30 = v63;
        v31 = v64;
        v46 = -v63;
        v32 = v65;
        v33 = v46;
        v34 = v64;
        v35 = v65;
        v47 = v41;
        v23 = 0.0;
        v24 = 0.0;
        v25 = 0.0;
        v23 = v63 + *v13;
        v24 = v64 + *(float *)(a1 + 0x1D22);
        v14 = v65 + *(float *)(a1 + 0x1D26);
        *(float *)v41 = v23;
        v25 = v14;
        *(float *)&v41[1] = v24;
        *(float *)&v41[2] = v25;
        v30 = v23;
        v20 = 0.0;
        v31 = v24;
        v21 = 0.0;
        v32 = v25;
        v22 = 0.0;
        v48 = v19;
        v20 = v46 + *v13;
        v21 = v64 + *(float *)(a1 + 0x1D22);
        v15 = v65 + *(float *)(a1 + 0x1D26);
        *(float *)v19 = v20;
        v22 = v15;
        *(float *)&v19[1] = v21;
        *(float *)&v19[2] = v22;
        v33 = v20;
        v34 = v21;
        v35 = v22;
        sub_53384(&v30, v54, v29);
        v16 = v54;
        sub_533D4(
          v29,
          *(float *)(a1 + 0x4E6E),
          *(__int16 *)(a1 + 0x4F22),
          *(__int16 *)(a1 + 0x4F24),
          (int)&v68,
          (int)&v69);
        sub_53384(&v33, v16, v29);
        v17 = v61;
        v18 = 0xFFFFFFFF;
        sub_533D4(
          v29,
          *(float *)(a1 + 0x4E6E),
          *(__int16 *)(a1 + 0x4F22),
          *(__int16 *)(a1 + 0x4F24),
          (int)v70,
          (int)&v67);
        if ( v17 < 0 || (v12 - v17) % 5 )
        {
          if ( v56 )
          {
            v18 = v52;
          }
        }
        else
        {
          v18 = parm;
        }
        if ( v18 != 0xFFFFFFFF )
        {
          VFX_line_draw(v50, (__int16)v68, (__int16)v69, v70[0], (__int16)v67, 0, v18);
        }
      }
      ++v12;
      v65 = v65 + flt_9065A;
    }
    while ( v12 < v58 );
  }
}
// 90646: using guessed type float flt_90646;
// 9064A: using guessed type float flt_9064A;
// 9064E: using guessed type float flt_9064E;
// 90652: using guessed type float flt_90652;
// 90656: using guessed type float flt_90656;
// 9065A: using guessed type float flt_9065A;
// 1936C: using guessed type __int16 var_1C[14];

//----- (00019AE8) --------------------------------------------------------
int __fastcall sub_19AE8(int eax0)
{
  int v1; // ebp
  int v2; // edi
  int *p_v; // esi
  __int16 v4; // ax
  int result; // eax
  double v6; // st7
  __int16 a; // bx
  int v8[100]; // [esp+8h] [ebp-384h]
  char v9[200]; // [esp+198h] [ebp-1F4h] BYREF
  char v10[200]; // [esp+260h] [ebp-12Ch] BYREF
  float v11; // [esp+328h] [ebp-64h]
  float v12; // [esp+32Ch] [ebp-60h]
  float v13; // [esp+330h] [ebp-5Ch]
  int v14[3]; // [esp+334h] [ebp-58h] BYREF
  float v15; // [esp+340h] [ebp-4Ch] BYREF
  float v16; // [esp+344h] [ebp-48h]
  float v17; // [esp+348h] [ebp-44h]
  int *v18; // [esp+34Ch] [ebp-40h]
  float *v19; // [esp+350h] [ebp-3Ch]
  PANE *pane; // [esp+354h] [ebp-38h]
  T_TypeA1 *a1; // [esp+358h] [ebp-34h]
  int v22; // [esp+35Ch] [ebp-30h]
  int v23; // [esp+360h] [ebp-2Ch]
  int v24; // [esp+364h] [ebp-28h]
  int v25; // [esp+368h] [ebp-24h]
  int v26; // [esp+36Ch] [ebp-20h]
  __int16 v27; // [esp+370h] [ebp-1Ch]

  v24 = eax0;
  v15 = 0.0;
  v16 = 0.0;
  v17 = 0.0;
  a1 = V_Type3_stru_10AE70.wnds[dword_96BAC].a1;
  if ( !a1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\batmode.cpp", 0x8E7);
  }
  pane = (PANE *)(v24 + 4);
  v1 = 0;
  v2 = 0;
  v19 = (float *)(v24 + 0x4E46);
  p_v = (int *)&V_Game.stars[0].v;
  v23 = (int)v10;
  v25 = 0;
  v22 = (int)v9;
  while ( 1 )
  {
    result = V_Game.starsNum;
    if ( v1 >= V_Game.starsNum )
    {
      break;
    }
    v15 = *(float *)p_v;
    v16 = *((float *)p_v + 1);
    v17 = *((float *)p_v + 2);
    v18 = v14;
    v11 = 0.0;
    v12 = 0.0;
    v13 = 0.0;
    v11 = v15 - *((float *)V_Game.h1 + 2);
    v12 = v16 - *((float *)V_Game.h1 + 3);
    v6 = v17 - *((float *)V_Game.h1 + 4);
    *(float *)v14 = v11;
    v13 = v6;
    *(float *)&v14[1] = v12;
    *(float *)&v14[2] = v13;
    v15 = v11;
    v16 = v12;
    v17 = v13;
    v8[v2] = 0;
    if ( !sub_53078(&v15) )
    {
      sub_53114(&v15, v19);
      *(float *)&v8[v2] = v17;
      if ( *(float *)&v8[v2] > 0.0 )
      {
        sub_533D4(&v15, *(float *)(v24 + 0x4E6E), *(__int16 *)(v24 + 0x4F22), *(__int16 *)(v24 + 0x4F24), v23, v22);
        a = V_Game.stars[v1].a;
        v26 = (int)(sqrt(v16 * v16 + v15 * v15 + v17 * v17) + flt_9066D);
        v27 = v26;
        v4 = 3;
        if ( (__int16)v26 <= 0xDC )
        {
          if ( v27 <= 0 )
          {
            if ( v27 > (int)0xFFFFFF24 )
            {
              v4 = 2;
            }
          }
          else
          {
            v4 = 1;
          }
        }
        else
        {
          v4 = 0;
        }
        VFX_shape_draw(pane, a1[1].pane.window, v4 + 4 * a, *(__int16 *)&v10[v25], *(__int16 *)&v9[v25]);
      }
    }
    ++v2;
    p_v += 0x18;
    ++v1;
    v23 += 2;
    v22 += 2;
    v25 += 2;
  }
  return result;
}
// 9066D: using guessed type float flt_9066D;
// 96BAC: using guessed type int dword_96BAC;

//----- (00019E2C) --------------------------------------------------------
__int64 __fastcall sub_19E2C(int a1, unsigned int a2, int a3)
{
  char *v4; // edi
  int v5; // eax
  int v6; // eax
  _DWORD *v7; // eax
  _DWORD *v8; // eax
  _DWORD *v9; // esi
  _DWORD *v10; // eax
  int *v11; // edx
  _DWORD *v12; // edx
  _DWORD *v13; // edx
  _DWORD *v14; // edx
  _DWORD *v15; // edx
  _DWORD *v16; // edx
  _DWORD *v17; // edx
  _DWORD *v18; // edx
  _DWORD *v19; // edx
  _DWORD *v20; // edx
  _DWORD *v21; // edx
  _DWORD *v22; // edx
  _DWORD *v23; // edx
  _DWORD *v24; // edx
  int v26; // eax
  int v27; // eax
  _DWORD *v28; // eax
  _DWORD *v29; // eax
  _DWORD *v30; // esi
  _DWORD *v31; // eax
  _BYTE v32[1200]; // [esp+0h] [ebp-3460h] BYREF
  char v33[3600]; // [esp+4B0h] [ebp-2FB0h] BYREF
  char v34[400]; // [esp+12C0h] [ebp-21A0h] BYREF
  char v35[1200]; // [esp+1450h] [ebp-2010h] BYREF
  int v36; // [esp+1900h] [ebp-1B60h]
  int v37; // [esp+1904h] [ebp-1B5Ch]
  int v38; // [esp+1908h] [ebp-1B58h]
  int v39[55]; // [esp+190Ch] [ebp-1B54h] BYREF
  __int16 v40; // [esp+19E8h] [ebp-1A78h]
  __int16 v41; // [esp+19EAh] [ebp-1A76h]
  int v42; // [esp+19ECh] [ebp-1A74h]
  int v43; // [esp+19F0h] [ebp-1A70h]
  int v44; // [esp+19F4h] [ebp-1A6Ch]
  int v45; // [esp+19F8h] [ebp-1A68h]
  int v46; // [esp+19FCh] [ebp-1A64h]
  int v47; // [esp+1A00h] [ebp-1A60h]
  int v48; // [esp+1A04h] [ebp-1A5Ch]
  char v49[1200]; // [esp+1A08h] [ebp-1A58h] BYREF
  char v50[3600]; // [esp+1EB8h] [ebp-15A8h] BYREF
  char v51[400]; // [esp+2CC8h] [ebp-798h] BYREF
  char v52[1200]; // [esp+2E58h] [ebp-608h] BYREF
  int v53; // [esp+3308h] [ebp-158h]
  int v54; // [esp+330Ch] [ebp-154h]
  int v55; // [esp+3310h] [ebp-150h]
  int v56[63]; // [esp+3314h] [ebp-14Ch] BYREF
  unsigned int count; // [esp+3410h] [ebp-50h]
  char *v58; // [esp+3414h] [ebp-4Ch]
  char *v59; // [esp+3418h] [ebp-48h]
  char *v60; // [esp+341Ch] [ebp-44h]
  _DWORD *v61; // [esp+3420h] [ebp-40h]
  _DWORD *v62; // [esp+3424h] [ebp-3Ch]
  _DWORD *v63; // [esp+3428h] [ebp-38h]
  _DWORD *v64; // [esp+342Ch] [ebp-34h]
  _DWORD *v65; // [esp+3430h] [ebp-30h]
  _DWORD *v66; // [esp+3434h] [ebp-2Ch]
  _DWORD *v67; // [esp+3438h] [ebp-28h]
  _DWORD *v68; // [esp+343Ch] [ebp-24h]
  _DWORD *v69; // [esp+3440h] [ebp-20h]
  _DWORD *v70; // [esp+3444h] [ebp-1Ch]
  int *v71; // [esp+3448h] [ebp-18h]
  _DWORD *v72; // [esp+344Ch] [ebp-14h]

  count = a2;
  v68 = (_DWORD *)(a1 + 0x4EEA);
  v69 = (_DWORD *)(a1 + 0x4EDE);
  v72 = (_DWORD *)(a1 + 0x4E46);
  v71 = (int *)(a1 + 0x1D1E);
  v60 = (char *)(a1 + 0x150E);
  v59 = (char *)(a1 + 0x137E);
  v4 = (char *)(a1 + 0xBE);
  v58 = (char *)(a1 + 0x56E);
  v64 = (_DWORD *)(a1 + 0x4F02);
  v63 = (_DWORD *)(a1 + 0x4EF6);
  v70 = (_DWORD *)(a1 + 0x4EBA);
  v65 = (_DWORD *)(a1 + 0x4E7A);
  v66 = (_DWORD *)(a1 + 0x4E5E);
  v67 = (_DWORD *)(a1 + 0x4E52);
  v62 = (_DWORD *)(a1 + 0x4ED2);
  v61 = (_DWORD *)(a1 + 0x4EC6);
  if ( a3 == 0xFFFFFFFF )
  {
    v5 = _wcpp_2_ctor_array_(v49, 0x64, &unk_959D8);
    v6 = _wcpp_2_ctor_array_(v5 + 0x4B0, 0x64, &unk_95A3C);
    v7 = (_DWORD *)(_wcpp_2_ctor_array_(v6 + 0xFA0, 0x64, &unk_959D8) + 0x4B0);
    *v7 = 0;
    v7 += 3;
    v7[0xFFFFFFFE] = 0;
    v7[0xFFFFFFFF] = 0;
    v8 = sub_1B4F0(v7) + 0x26;
    v8[1] = 0;
    v8[2] = 0;
    *v8 = 0;
    v8 += 3;
    v9 = v8 + 3;
    sub_1ACA0(v8);
    sub_1ACA0(v9);
    v10 = v9 + 3;
    v9 += 0xFFFFFFFD;
    sub_1ACA0(v10);
    sub_1AC70((float *)v9, 1, 0, 0);
    sub_1AC70((float *)v9 + 3, 0, 1, 0);
    sub_1AC70((float *)v9 + 6, 0, 0, 1);
    Q_ReadFile_sub_1BF94((P_FileInfo)count, v49, 0x1A08u);
    qmemcpy(v4, v49, 0x4B0u);
    qmemcpy(v58, v50, 0xE10u);
    qmemcpy(v59, v51, 0x190u);
    v11 = v71;
    qmemcpy(v60, v52, 0x4B0u);
    *v11 = v53;
    v11[1] = v54;
    v11[2] = v55;
    v12 = v72;
    *v72 = v56[0];
    v12[1] = v56[1];
    v12[2] = v56[2];
    v13 = v67;
    *v67 = v56[3];
    v13[1] = v56[4];
    v13[2] = v56[5];
    v14 = v66;
    *v66 = v56[6];
    v14[1] = v56[7];
    v14[2] = v56[8];
    v15 = v72;
    v72[9] = v56[9];
    v15[0xA] = v56[0xA];
    v15[0xB] = v56[0xB];
    v15[0xC] = v56[0xC];
    v16 = v65;
    *v65 = v56[0xD];
    v16[1] = v56[0xE];
    v16[2] = v56[0xF];
    v17 = v72;
    v72[0x10] = v56[0x10];
    v17[0x11] = v56[0x11];
    v17[0x12] = v56[0x12];
    v17[0x13] = v56[0x13];
    v17[0x14] = v56[0x14];
    v17[0x15] = v56[0x15];
    v17[0x16] = v56[0x16];
    v17[0x17] = v56[0x17];
    v17[0x18] = v56[0x18];
    v17[0x19] = v56[0x19];
    v17[0x1A] = v56[0x1A];
    v17[0x1B] = v56[0x1B];
    v17[0x1C] = v56[0x1C];
    v18 = v70;
    *v70 = v56[0x1D];
    v18[1] = v56[0x1E];
    v18[2] = v56[0x1F];
    v19 = v61;
    *v61 = v56[0x20];
    v19[1] = v56[0x21];
    v19[2] = v56[0x22];
    v20 = v62;
    *v62 = v56[0x23];
    v20[1] = v56[0x24];
    v20[2] = v56[0x25];
    v21 = v69;
    *v69 = v56[0x26];
    v21[1] = v56[0x27];
    v21[2] = v56[0x28];
    v22 = v68;
    *v68 = v56[0x29];
    v22[1] = v56[0x2A];
    v22[2] = v56[0x2B];
    v23 = v63;
    *v63 = v56[0x2C];
    v23[1] = v56[0x2D];
    v23[2] = v56[0x2E];
    v24 = v64;
    *v64 = v56[0x2F];
    v24[1] = v56[0x30];
    v24[2] = v56[0x31];
    *(_DWORD *)(a1 + 0x4F0E) = v56[0x32];
    *(_DWORD *)(a1 + 0x4F12) = v56[0x33];
    *(_DWORD *)(a1 + 0x4F16) = v56[0x34];
    *(_DWORD *)(a1 + 0x4F1A) = v56[0x35];
    *(_DWORD *)(a1 + 0x4F1E) = v56[0x36];
    *(_DWORD *)(a1 + 0x4F22) = v56[0x37];
    *(_DWORD *)(a1 + 0x4F26) = v56[0x38];
    *(_DWORD *)(a1 + 0x4F2A) = v56[0x39];
    *(_DWORD *)(a1 + 0x503A) = v56[0x3A];
    *(_DWORD *)(a1 + 0x503E) = v56[0x3B];
    *(_DWORD *)(a1 + 0x5042) = v56[0x3C];
    *(_DWORD *)(a1 + 0x5046) = v56[0x3D];
    *(_DWORD *)(a1 + 0x504A) = v56[0x3E];
    ((void (__fastcall *)(int *, _DWORD))locret_1B66C)(v56, 0);
    sub_1A9E0((int)v52);
    sub_1AA00((int)v50);
    return (unsigned int)sub_1A9E0((int)v49);
  }
  else
  {
    v26 = _wcpp_2_ctor_array_(v32, 0x64, &unk_959D8);
    v27 = _wcpp_2_ctor_array_(v26 + 0x4B0, 0x64, &unk_95A3C);
    v28 = (_DWORD *)(_wcpp_2_ctor_array_(v27 + 0xFA0, 0x64, &unk_959D8) + 0x4B0);
    *v28 = 0;
    v28 += 3;
    v28[0xFFFFFFFE] = 0;
    v28[0xFFFFFFFF] = 0;
    v29 = sub_1B4F0(v28) + 0x26;
    v29[1] = 0;
    v29[2] = 0;
    *v29 = 0;
    v29 += 3;
    v30 = v29 + 3;
    sub_1ACA0(v29);
    sub_1ACA0(v30);
    v31 = v30 + 3;
    v30 += 0xFFFFFFFD;
    sub_1ACA0(v31);
    sub_1AC70((float *)v30, 1, 0, 0);
    sub_1AC70((float *)v30 + 3, 0, 1, 0);
    sub_1AC70((float *)v30 + 6, 0, 0, 1);
    qmemcpy(v32, v4, sizeof(v32));
    qmemcpy(v33, v58, sizeof(v33));
    qmemcpy(v34, v59, sizeof(v34));
    qmemcpy(v35, v60, sizeof(v35));
    v36 = *v71;
    v37 = v71[1];
    v38 = v71[2];
    v39[0] = *v72;
    v39[1] = v72[1];
    v39[2] = v72[2];
    v39[3] = *v67;
    v39[4] = v67[1];
    v39[5] = v67[2];
    v39[6] = *v66;
    v39[7] = v66[1];
    v39[8] = v66[2];
    v39[9] = v72[9];
    v39[0xA] = v72[0xA];
    v39[0xB] = v72[0xB];
    v39[0xC] = v72[0xC];
    v39[0xD] = *v65;
    v39[0xE] = v65[1];
    v39[0xF] = v65[2];
    v39[0x10] = v72[0x10];
    v39[0x11] = v72[0x11];
    v39[0x12] = v72[0x12];
    v39[0x13] = v72[0x13];
    v39[0x14] = v72[0x14];
    v39[0x15] = v72[0x15];
    v39[0x16] = v72[0x16];
    v39[0x17] = v72[0x17];
    v39[0x18] = v72[0x18];
    v39[0x19] = v72[0x19];
    v39[0x1A] = v72[0x1A];
    v39[0x1B] = v72[0x1B];
    v39[0x1C] = v72[0x1C];
    v39[0x1D] = *v70;
    v39[0x1E] = v70[1];
    v39[0x1F] = v70[2];
    v39[0x20] = *v61;
    v39[0x21] = v61[1];
    v39[0x22] = v61[2];
    v39[0x23] = *v62;
    v39[0x24] = v62[1];
    v39[0x25] = v62[2];
    v39[0x26] = *v69;
    v39[0x27] = v69[1];
    v39[0x28] = v69[2];
    v39[0x29] = *v68;
    v39[0x2A] = v68[1];
    v39[0x2B] = v68[2];
    v39[0x2C] = *v63;
    v39[0x2D] = v63[1];
    v39[0x2E] = v63[2];
    v39[0x2F] = *v64;
    v39[0x30] = v64[1];
    v39[0x31] = v64[2];
    v39[0x32] = *(_DWORD *)(a1 + 0x4F0E);
    v39[0x33] = *(_DWORD *)(a1 + 0x4F12);
    v39[0x34] = *(_DWORD *)(a1 + 0x4F16);
    v39[0x35] = *(_DWORD *)(a1 + 0x4F1A);
    v39[0x36] = *(_DWORD *)(a1 + 0x4F1E);
    v40 = *(_WORD *)(a1 + 0x4F22);
    v41 = *(_WORD *)(a1 + 0x4F24);
    v42 = *(_DWORD *)(a1 + 0x4F26);
    v43 = *(_DWORD *)(a1 + 0x4F2A);
    v44 = *(_DWORD *)(a1 + 0x503A);
    v45 = *(_DWORD *)(a1 + 0x503E);
    v46 = *(_DWORD *)(a1 + 0x5042);
    v47 = *(_DWORD *)(a1 + 0x5046);
    v48 = *(_DWORD *)(a1 + 0x504A);
    Q_CFILE_CPP_dos_write_sub_1C098((int *)count, v32, 0x1A08u);
    ((void (__fastcall *)(int *, _DWORD))locret_1B66C)(v39, 0);
    sub_1A9E0((int)v35);
    sub_1AA00((int)v33);
    return (unsigned int)sub_1A9E0((int)v32);
  }
}
// 77394: using guessed type int __fastcall _wcpp_2_ctor_array_(_DWORD, _DWORD, _DWORD);

//----- (0001A9C0) --------------------------------------------------------
int __fastcall sub_1A9C0(int a1)
{
  return _wcpp_2_dtor_array_(a1, 0xF, &unk_959D8);
}
// 7760C: using guessed type int __fastcall _wcpp_2_dtor_array_(_DWORD, _DWORD, _DWORD);

//----- (0001A9E0) --------------------------------------------------------
int __fastcall sub_1A9E0(int a1)
{
  return _wcpp_2_dtor_array_(a1, 0x64, &unk_959D8);
}
// 7760C: using guessed type int __fastcall _wcpp_2_dtor_array_(_DWORD, _DWORD, _DWORD);

//----- (0001AA00) --------------------------------------------------------
int __fastcall sub_1AA00(int a1)
{
  return _wcpp_2_dtor_array_(a1, 0x64, &unk_95A3C);
}
// 7760C: using guessed type int __fastcall _wcpp_2_dtor_array_(_DWORD, _DWORD, _DWORD);

//----- (0001AA20) --------------------------------------------------------
int __fastcall Q_NC_sub_1AA20(int a1)
{
  return _wcpp_2_dtor_array_(a1, 4, &unk_959D8);
}
// 7760C: using guessed type int __fastcall _wcpp_2_dtor_array_(_DWORD, _DWORD, _DWORD);

//----- (0001AA40) --------------------------------------------------------
_DWORD *__fastcall sub_1AA40(float *a1, float *a2)
{
  float *v2; // ebx
  float *v3; // eax
  double v4; // st7
  float *v5; // edx
  _DWORD *result; // eax

  v2 = a2 + 3;
  *a1 = *a2;
  v3 = a1 + 3;
  v4 = a2[1];
  v5 = a2 + 6;
  v3[0xFFFFFFFE] = v4;
  v3 += 3;
  v3[0xFFFFFFFC] = v5[0xFFFFFFFC];
  result = v3 + 0xFFFFFFFA;
  result[3] = *(_DWORD *)v2;
  result[4] = *((_DWORD *)v2 + 1);
  result[5] = *((_DWORD *)v2 + 2);
  result[6] = *(_DWORD *)v5;
  result[7] = *((_DWORD *)v5 + 1);
  result[8] = *((_DWORD *)v5 + 2);
  return result;
}

//----- (0001AA90) --------------------------------------------------------
__int64 __fastcall sub_1AA90(int a1)
{
  int v1; // eax
  int v2; // eax
  int v3; // eax

  v1 = ((int (__fastcall *)(int, _DWORD))locret_1B66C)(a1 + 0x190C, 0);
  v2 = sub_1A9E0(v1 - 0x4BC);
  v3 = sub_1AA00(v2 - 0xFA0);
  return (unsigned int)sub_1A9E0(v3 - 0x4B0);
}

//----- (0001AAC0) --------------------------------------------------------
_DWORD *__fastcall sub_1AAC0(int a1)
{
  int v1; // eax
  int v2; // eax
  _DWORD *v3; // eax
  _DWORD *v4; // eax
  _DWORD *v5; // edx
  _DWORD *result; // eax

  v1 = _wcpp_2_ctor_array_(a1, 0x64, &unk_959D8);
  v2 = _wcpp_2_ctor_array_(v1 + 0x4B0, 0x64, &unk_95A3C);
  v3 = (_DWORD *)(_wcpp_2_ctor_array_(v2 + 0xFA0, 0x64, &unk_959D8) + 0x4B0);
  *v3 = 0;
  v3 += 3;
  v3[0xFFFFFFFE] = 0;
  v3[0xFFFFFFFF] = 0;
  v4 = sub_1B4F0(v3) + 0x26;
  *v4 = 0;
  v4 += 3;
  v4[0xFFFFFFFE] = 0;
  v4[0xFFFFFFFF] = 0;
  *v4 = 0;
  v4 += 3;
  v4[0xFFFFFFFE] = 0;
  v4[0xFFFFFFFF] = 0;
  *v4 = 0;
  v4 += 3;
  v4[0xFFFFFFFE] = 0;
  v4[0xFFFFFFFF] = 0;
  *v4 = 0;
  v4 += 0xFFFFFFFA;
  v4[7] = 0;
  v4[8] = 0;
  v4[1] = 0;
  v4[2] = 0;
  *v4 = 0x3F800000;
  v4[3] = 0;
  v4[4] = 0x3F800000;
  v4[5] = 0;
  v5 = v4 + 6;
  v4[6] = 0;
  v4[7] = 0;
  result = v4 + 0xFFFFF994;
  v5[2] = 0x3F800000;
  return result;
}
// 77394: using guessed type int __fastcall _wcpp_2_ctor_array_(_DWORD, _DWORD, _DWORD);

//----- (0001ABE0) --------------------------------------------------------
_DWORD *__fastcall sub_1ABE0(_DWORD *a1)
{
  _DWORD *v1; // eax
  _DWORD *result; // eax

  *a1 = 0;
  v1 = a1 + 3;
  v1[0xFFFFFFFE] = 0;
  v1[0xFFFFFFFF] = 0;
  *v1 = 0;
  v1 += 3;
  v1[0xFFFFFFFE] = 0;
  v1[0xFFFFFFFF] = 0;
  *v1 = 0;
  result = v1 + 0xFFFFFFFA;
  result[7] = 0;
  result[8] = 0;
  result[1] = 0;
  result[2] = 0;
  *result = 0x3F800000;
  result[3] = 0;
  result[4] = 0x3F800000;
  result[5] = 0;
  result[6] = 0;
  result[7] = 0;
  result[8] = 0x3F800000;
  return result;
}

//----- (0001AC70) --------------------------------------------------------
float *__fastcall sub_1AC70(float *result, int a2, int a3, int a4)
{
  *result = (float)a2;
  result[1] = (float)a3;
  result[2] = (float)a4;
  return result;
}

//----- (0001ACA0) --------------------------------------------------------
_DWORD *__fastcall sub_1ACA0(_DWORD *result)
{
  *result = 0;
  result[1] = 0;
  result[2] = 0;
  return result;
}

//----- (0001ACC0) --------------------------------------------------------
int __fastcall sub_1ACC0(int result, int a2, int a3)
{
  *(_DWORD *)(result + 0x2EE4) = 0;
  *(_DWORD *)(result + 0x2EE8) = 0;
  *(_WORD *)(result + 0x2EE0) = 0;
  *(_WORD *)(result + 0x2EE2) = 0;
  return sub_1ACE8(result);
}

//----- (0001ACE8) --------------------------------------------------------
int __fastcall sub_1ACE8(int result)
{
  *(_DWORD *)(result + 0x2EEC) = 0xFFFFFFFF;
  return result;
}

//----- (0001ACF4) --------------------------------------------------------
int __fastcall sub_1ACF4(int a1)
{
  int result; // eax

  sub_262CC(*(void **)(a1 + 0x2EE4));
  *(_DWORD *)(a1 + 0x2EE4) = 0;
  result = a1;
  *(_DWORD *)(a1 + 0x2EE8) = 0;
  return result;
}

//----- (0001AD1C) --------------------------------------------------------
void __fastcall Q_CACHE_CPP_ShapeCache_sub_1AD1C(P_Type13 a1, int a2)
{
  void *v3; // eax
  T_Type13 *__shifted(T_Name50,-0x7D0) v4; // edx
  int *v5; // eax
  int size; // [esp+0h] [ebp-4h]

  size = a2 + 3;
  LOBYTE(size) = (a2 + 3) & 0xFC;
  v3 = operator new[](size);
  Q_RegisterData_sub_2625C(v3, 5, "SHAPE CACHE");
  a1->pShapeCache = v3;
  if ( !v3 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0x41);
  }
  a1->a = 0;
  a1->b = 0;
  v4 = a1;
  a1->size = size;
  v5 = (int *)a1;
  do
  {
    *v5++ = 0;
    (*ADJ(v4))[0] = 0;
    v4 = (T_Type13 *__shifted(T_Name50,-0x7D0))((char *)v4 + 0x32);
    v5[199] = 0;
  }
  while ( v5 != a1->z2 );
}

//----- (0001ADAC) --------------------------------------------------------
int __fastcall sub_1ADAC(P_Type13 a1, const char *filename)
{
  const char *v3; // esi
  unsigned int v4; // kr04_4
  P_Type13 v5; // eax
  int v6; // edx
  char *v7; // edi
  char v8; // al
  char v9; // al

  v3 = filename;
  if ( !a1->pShapeCache )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cache.cpp", 0x53);
  }
  v4 = strlen(filename) + 1;
  if ( (int)(v4 - 1) <= 0 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0x59);
  }
  if ( (int)(v4 - 1) >= 0x32 )
  {
    sub_2620C("Cache filename too long: %s", (char)filename);
    sub_261B8(0, "..\\cache.cpp", 0x5B);
  }
  if ( a1->a >= 200 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0x5C);
  }
  v5 = a1;
  v6 = 0;
  while ( v5->z4[0][0] )
  {
    ++v6;
    v5 = (P_Type13)((char *)v5 + 0x32);
    if ( v6 >= 200 )
    {
      return 0xFFFF;
    }
  }
  v7 = a1->z4[v6];
  do
  {
    v8 = *v3;
    *v7 = *v3;
    if ( !v8 )
    {
      break;
    }
    v9 = v3[1];
    v3 += 2;
    v7[1] = v9;
    v7 += 2;
  }
  while ( v9 );
  ++a1->a;
  return v6;
}

//----- (0001AEB0) --------------------------------------------------------
int __fastcall sub_1AEB0(unsigned int a1, unsigned __int16 a2, const char *a3)
{
  const char *v4; // esi
  unsigned int v5; // kr04_4
  int v6; // eax
  int result; // eax
  char *v8; // edi
  char v9; // al
  char v10; // al

  v4 = a3;
  if ( !*(_DWORD *)(a1 + 0x2EE4) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cache.cpp", 0x70);
  }
  v5 = strlen(a3) + 1;
  if ( (int)(v5 - 1) <= 0 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0x74);
  }
  if ( (int)(v5 - 1) >= 0x32 )
  {
    sub_2620C("Cache filename too long: %s", (char)a3);
    sub_261B8(0, "..\\cache.cpp", 0x76);
  }
  if ( *(__int16 *)(a1 + 0x2EE0) >= 0xC8 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0x77);
  }
  if ( a2 >= 0xC8u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cache.cpp", 0x78);
  }
  v6 = 0x32 * a2;
  if ( *(_BYTE *)(v6 + a1 + 0x7D0) )
  {
    if ( !stricmp(a3, (const char *)(v6 + a1 + 0x7D0)) )
    {
      return 0xFFFFFFFF;
    }
    sub_1B000(a1, a2);
  }
  v8 = (char *)(0x32 * a2 + a1 + 0x7D0);
  do
  {
    v9 = *v4;
    *v8 = *v4;
    if ( !v9 )
    {
      break;
    }
    v10 = v4[1];
    v4 += 2;
    v8[1] = v10;
    v8 += 2;
  }
  while ( v10 );
  result = 0xFFFFFFFF;
  ++*(_WORD *)(a1 + 0x2EE0);
  return result;
}

//----- (0001B000) --------------------------------------------------------
int __fastcall sub_1B000(unsigned int a1, unsigned __int16 a2)
{
  int result; // eax

  if ( a2 >= 0xC8u )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0x95);
  }
  if ( !*(_BYTE *)(a1 + 0x32 * a2 + 0x7D0) )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0x96);
  }
  sub_1B354(a1, a2);
  result = 0x19 * a2;
  *(_BYTE *)(a1 + 0x32 * a2 + 0x7D0) = 0;
  --*(_WORD *)(a1 + 0x2EE0);
  return result;
}

//----- (0001B084) --------------------------------------------------------
void *__fastcall Q_CACHE_CPP_GetShapeTable_sub_1B084(unsigned int a1, int a2)
{
  unsigned __int16 v3; // di
  int FileLength_sub_1BE28; // eax
  int v5; // ecx
  void *v6; // edx
  unsigned int v8; // edx
  int i; // eax
  unsigned int j; // edx
  int v11; // ebx
  T_FileInfo v12; // [esp+0h] [ebp-12Ch] BYREF

  v3 = a2;
  if ( !*(_DWORD *)(a1 + 0x2EEC) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cache.cpp", 0xA2);
  }
  if ( (unsigned __int16)a2 >= 0xC8u )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0xA6);
  }
  if ( !*(_BYTE *)(a1 + 0x32 * (unsigned __int16)a2 + 0x7D0) )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cache.cpp", 0xA7);
  }
  HIWORD(a2) = 0;
  if ( *(_DWORD *)(a1 + 4 * (unsigned __int16)a2) )
  {
    v8 = a1;
    for ( i = 0; i < *(__int16 *)(a1 + 0x2EE2) && v3 != *(_WORD *)(v8 + 0x640); ++i )
    {
      v8 += 2;
    }
    for ( j = a1 + 2 * i; ; *(_WORD *)(j + 0x63E) = *(_WORD *)(j + 0x640) )
    {
      v11 = *(__int16 *)(a1 + 0x2EE2);
      if ( i >= v11 )
      {
        break;
      }
      j += 2;
      ++i;
    }
    *(_WORD *)(a1 + 2 * v11 + 0x63E) = v3;
    return *(void **)(a1 + 4 * v3);
  }
  else
  {
    Q_InitFileInfo_sub_1BB78(&v12);
    Q_OpenFile_sub_1BBFC(&v12, (const char *)(0x32 * a2 + a1 + 0x7D0), 0x200, 0);
    FileLength_sub_1BE28 = Q_GetFileLength_sub_1BE28(&v12);
    v5 = FileLength_sub_1BE28 + 3;
    LOBYTE(v5) = (FileLength_sub_1BE28 + 3) & 0xFC;
    if ( v5 >= *(_DWORD *)(a1 + 0x2EE8) )
    {
      sub_2620C("Single item too big for cache: %s, %d", 0x32 * a2 + a1 - 0x30);
      sub_261B8(0, "..\\cache.cpp", 0xB8);
    }
    *(_DWORD *)(a1 + 4 * v3) = sub_1B2DC(a1, v5);
    v6 = *(void **)(a1 + 4 * v3);
    *(_DWORD *)(a1 + 4 * v3 + 0x320) = v5;
    if ( !Q_CfileLoad_sub_1BF1C(&v12, v6) )
    {
      sub_2620C("Cache unable to load file: %s", 0x32 * v3 + a1 - 0x30);
      sub_261B8(0, "..\\cache.cpp", 0xC0);
    }
    *(_WORD *)(a1 + 2 * (__int16)(*(_WORD *)(a1 + 0x2EE2))++ + 0x640) = v3;
    Q_CloseFileAndDelete_sub_1BBC8(&v12);
    return *(void **)(a1 + 4 * v3);
  }
}

//----- (0001B270) --------------------------------------------------------
int __fastcall sub_1B270(T_Type13 *a1, const char *a2, int a3)
{
  T_Name50 *z4; // ebx
  int v6; // ecx
  int v8; // [esp+0h] [ebp-14h]

  z4 = a1->z4;
  v6 = 0;
  v8 = 0xFFFF;
  while ( v6 < a1->a )
  {
    if ( !stricmp(a2, (const char *)z4) )
    {
      v8 = v6;
      break;
    }
    ++z4;
    ++v6;
  }
  if ( a3 == 0xFFFFFFFF && (unsigned __int16)v8 == 0xFFFF )
  {
    return sub_1ADAC(a1, a2);
  }
  return v8;
}

//----- (0001B2DC) --------------------------------------------------------
int __fastcall sub_1B2DC(unsigned int a1, int a2)
{
  unsigned int v2; // ecx
  unsigned int v4; // edx
  int v5; // esi
  int v6; // ebx
  int v7; // edi
  int result; // eax
  int i; // esi
  unsigned __int16 v10; // dx

  v2 = a1;
  v4 = a1 + 0x320;
  v5 = 0;
  do
  {
    v6 = *(_DWORD *)(a1 + 0x320);
    a1 += 4;
    v5 += v6;
  }
  while ( a1 != v4 );
  v7 = 0;
  result = v5 + *(_DWORD *)(v2 + 0x2EE4);
  for ( i = *(_DWORD *)(v2 + 0x2EE8) - v5; i <= a2; result = sub_1B354(v2, v10) )
  {
    if ( v7 >= *(__int16 *)(v2 + 0x2EE0) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\cache.cpp", 0xFF);
    }
    v10 = *(_WORD *)(v2 + 0x640);
    i += *(_DWORD *)(v2 + 4 * v10 + 0x320);
    ++v7;
  }
  return result;
}

//----- (0001B354) --------------------------------------------------------
int __fastcall sub_1B354(unsigned int a1, unsigned __int16 a2)
{
  unsigned int v2; // ebp
  int v4; // edx
  int v5; // ecx
  void *v6; // edx
  int v7; // ebx
  unsigned int v8; // eax
  unsigned int v9; // ecx
  int v10; // eax
  unsigned int i; // edx
  unsigned int v12; // edx
  unsigned int v13; // [esp+0h] [ebp-20h]
  int v14; // [esp+4h] [ebp-1Ch]
  int v15; // [esp+4h] [ebp-1Ch]

  v2 = a1;
  if ( a2 >= 0xC8u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cache.cpp", 0x10D);
  }
  if ( !*(_DWORD *)(a1 + 4 * a2) )
  {
    return 0;
  }
  v4 = 0;
  do
  {
    v5 = *(_DWORD *)(a1 + 0x320);
    a1 += 4;
    v4 += v5;
  }
  while ( a1 != v2 + 0x320 );
  v14 = v4 + *(_DWORD *)(v2 + 0x2EE4);
  v13 = 4 * a2 + v2;
  v6 = *(void **)v13;
  v7 = *(_DWORD *)(v13 + 0x320);
  qmemcpy(*(void **)v13, (const void *)(*(_DWORD *)v13 + v7), v14 - (*(_DWORD *)v13 + v7));
  *(_DWORD *)v13 = 0;
  *(_DWORD *)(v13 + 0x320) = 0;
  v8 = v2;
  v9 = v2 + 0x320;
  do
  {
    if ( (unsigned int)v6 < *(_DWORD *)v8 )
    {
      *(_DWORD *)v8 -= v7;
    }
    v8 += 4;
  }
  while ( v8 != v9 );
  v10 = v9 ^ v8;
  v15 = v14 - v7;
  --*(_WORD *)(v2 + 0x2EE2);
  for ( i = v2; v10 < *(__int16 *)(v2 + 0x2EE2) && a2 != *(_WORD *)(i + 0x640); i += 2 )
  {
    ++v10;
  }
  v12 = v2 + 2 * v10;
  while ( v10 < *(__int16 *)(v2 + 0x2EE2) )
  {
    v12 += 2;
    ++v10;
    *(_WORD *)(v12 + 0x63E) = *(_WORD *)(v12 + 0x640);
  }
  return v15;
}

//----- (0001B498) --------------------------------------------------------
_DWORD *__fastcall sub_1B498(_DWORD *result)
{
  _DWORD *v1; // ecx
  int i; // edx

  v1 = result;
  for ( i = 0; i < *((__int16 *)v1 + 0x1770); ++i )
  {
    *result = 0;
    result[0xC8] = 0;
    ++result;
  }
  *((_WORD *)v1 + 0x1771) = 0;
  return result;
}

//----- (0001B4D0) --------------------------------------------------------
_DWORD *__fastcall sub_1B4D0(_DWORD *a1)
{
  _DWORD *result; // eax

  result = sub_1B498(a1);
  a1[0xBBB] = 0;
  return result;
}

//----- (0001B4F0) --------------------------------------------------------
_DWORD *__fastcall sub_1B4F0(_DWORD *a1)
{
  _DWORD *v1; // eax
  _DWORD *v2; // edx

  *a1 = 0;
  v1 = a1 + 3;
  v1[0xFFFFFFFE] = 0;
  v1[0xFFFFFFFF] = 0;
  *v1 = 0;
  v1 += 3;
  v1[0xFFFFFFFE] = 0;
  v1[0xFFFFFFFF] = 0;
  *v1 = 0;
  v1 += 0xFFFFFFFA;
  v1[7] = 0;
  v1[8] = 0;
  v1[1] = 0;
  v1[2] = 0;
  *v1 = 0x3F800000;
  v1[3] = 0;
  v1[4] = 0x3F800000;
  v1[5] = 0;
  v2 = v1 + 6;
  v1[6] = 0;
  v1[7] = 0;
  v1 += 0xD;
  v2[2] = 0x3F800000;
  *v1 = 0;
  v1 += 0x10;
  v1[0xFFFFFFF1] = 0;
  v1[0xFFFFFFF2] = 0;
  v1[0xFFFFFFFD] = 0x3F800000;
  v1[0xFFFFFFFE] = 0;
  v1[0xFFFFFFF8] = v1[0xFFFFFFFD];
  v1[0xFFFFFFF3] = v1[0xFFFFFFF8];
  v1[0xFFFFFFFC] = v1[0xFFFFFFFE];
  v1[0xFFFFFFFB] = v1[0xFFFFFFFC];
  v1[0xFFFFFFFA] = v1[0xFFFFFFFB];
  v1[0xFFFFFFF9] = v1[0xFFFFFFFA];
  v1[0xFFFFFFF7] = v1[0xFFFFFFF9];
  v1[0xFFFFFFF6] = v1[0xFFFFFFF7];
  v1[0xFFFFFFF5] = v1[0xFFFFFFF6];
  v1[0xFFFFFFF4] = v1[0xFFFFFFF5];
  *v1 = 0;
  v1 += 3;
  v1[0xFFFFFFFE] = 0;
  v1[0xFFFFFFFF] = 0;
  *v1 = 0;
  v1 += 3;
  v1[0xFFFFFFFE] = 0;
  v1[0xFFFFFFFF] = 0;
  v1[1] = 0;
  v1[2] = 0;
  *v1 = 0;
  v1 += 0xFFFFFFFA;
  *v1 = 0x3F800000;
  v1[1] = 0;
  v1[2] = 0;
  v1[3] = 0;
  v1[4] = 0x3F800000;
  v1[5] = 0;
  v1[6] = 0;
  v1[7] = 0;
  v1[8] = 0x3F800000;
  return v1 + 0xFFFFFFE3;
}

//----- (0001B670) --------------------------------------------------------
_DWORD *__fastcall Q_NC_sub_1B670(_DWORD *a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8)
{
  _DWORD *v8; // eax
  _DWORD *v9; // edx
  _DWORD *v10; // edx

  *a1 = 0;
  v8 = a1 + 3;
  v8[0xFFFFFFFE] = 0;
  v8[0xFFFFFFFF] = 0;
  *v8 = 0;
  v8 += 3;
  v8[0xFFFFFFFE] = 0;
  v8[0xFFFFFFFF] = 0;
  *v8 = 0;
  v8 += 0xFFFFFFFA;
  v8[7] = 0;
  v8[8] = 0;
  v8[1] = 0;
  v8[2] = 0;
  *v8 = 0x3F800000;
  v8[3] = 0;
  v8[4] = 0x3F800000;
  v8[5] = 0;
  v9 = v8 + 6;
  v8[6] = 0;
  v8[7] = 0;
  v8 += 0xD;
  v9[2] = 0x3F800000;
  *v8 = 0;
  v8 += 0x10;
  v8[0xFFFFFFF1] = 0;
  v8[0xFFFFFFF2] = 0;
  v8[0xFFFFFFFD] = 0x3F800000;
  v8[0xFFFFFFFE] = 0;
  v8[0xFFFFFFF8] = v8[0xFFFFFFFD];
  v8[0xFFFFFFF3] = v8[0xFFFFFFF8];
  v8[0xFFFFFFFC] = v8[0xFFFFFFFE];
  v8[0xFFFFFFFB] = v8[0xFFFFFFFC];
  v8[0xFFFFFFFA] = v8[0xFFFFFFFB];
  v8[0xFFFFFFF9] = v8[0xFFFFFFFA];
  v8[0xFFFFFFF7] = v8[0xFFFFFFF9];
  v8[0xFFFFFFF6] = v8[0xFFFFFFF7];
  v8[0xFFFFFFF5] = v8[0xFFFFFFF6];
  v8[0xFFFFFFF4] = v8[0xFFFFFFF5];
  *v8 = 0;
  v8 += 3;
  v8[0xFFFFFFFE] = 0;
  v8[0xFFFFFFFF] = 0;
  *v8 = 0;
  v8 += 3;
  v8[0xFFFFFFFE] = 0;
  v8[0xFFFFFFFF] = 0;
  v8[1] = 0;
  v8[2] = 0;
  *v8 = 0;
  v8 += 0xFFFFFFFA;
  *v8 = 0x3F800000;
  v8[1] = 0;
  v8[2] = 0;
  v8[3] = 0;
  v8[4] = 0x3F800000;
  v8[5] = 0;
  v8[6] = 0;
  v8[7] = 0;
  v8[8] = 0x3F800000;
  v10 = v8 + 0xFFFFFFE3;
  sub_1B808(v8 + 0xFFFFFFE3, (int)(v8 + 0xFFFFFFE3), a8, a4, a5, a6, a7, a8);
  return v10;
}

//----- (0001B808) --------------------------------------------------------
void __fastcall sub_1B808(_DWORD *a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8)
{
  a1[9] = a5;
  a1[0xB] = a6;
  a1[0xC] = a7;
  a1[0x1C] = 0x3F800000;
  sub_1B834((int)a1, a8);
}

//----- (0001B834) --------------------------------------------------------
void __fastcall sub_1B834(int a1, int a2)
{
  *(float *)(a1 + 0x28) = (double)a2 / tan(*(float *)(a1 + 0x24) * flt_95A68 * flt_907F4);
}
// 907F4: using guessed type float flt_907F4;
// 95A68: using guessed type float flt_95A68;

//----- (0001B864) --------------------------------------------------------
float *__fastcall sub_1B864(int a1, int a2, int a3, int a4)
{
  float *v5; // eax
  double v6; // st7
  int v8[9]; // [esp+0h] [ebp-70h] BYREF
  int v9[9]; // [esp+24h] [ebp-4Ch] BYREF
  float v10; // [esp+48h] [ebp-28h]
  float v11; // [esp+4Ch] [ebp-24h]
  float v12; // [esp+50h] [ebp-20h]
  int v13[7]; // [esp+54h] [ebp-1Ch] BYREF

  v13[3] = (int)v13;
  v5 = (float *)(a1 + 0x34);
  v10 = 0.0;
  v11 = 0.0;
  v12 = 0.0;
  v10 = -*v5;
  v11 = -v5[1];
  v6 = -v5[2];
  *(float *)v13 = v10;
  v12 = v6;
  *(float *)&v13[1] = v11;
  *(float *)&v13[2] = v12;
  v8[0] = *(_DWORD *)(a1 + 0x74);
  v8[1] = *(_DWORD *)(a1 + 0x78);
  v8[2] = *(_DWORD *)(a1 + 0x7C);
  v8[3] = *(_DWORD *)(a1 + 0x80);
  v8[4] = *(_DWORD *)(a1 + 0x84);
  v8[5] = *(_DWORD *)(a1 + 0x88);
  v8[6] = *(_DWORD *)(a1 + 0x8C);
  v8[7] = *(_DWORD *)(a1 + 0x90);
  v8[8] = *(_DWORD *)(a1 + 0x94);
  v9[0] = *(_DWORD *)a1;
  v9[1] = *(_DWORD *)(a1 + 4);
  v9[2] = *(_DWORD *)(a1 + 8);
  v9[3] = *(_DWORD *)(a1 + 0xC);
  v9[4] = *(_DWORD *)(a1 + 0x10);
  v9[5] = *(_DWORD *)(a1 + 0x14);
  v9[6] = *(_DWORD *)(a1 + 0x18);
  v9[7] = *(_DWORD *)(a1 + 0x1C);
  v9[8] = *(_DWORD *)(a1 + 0x20);
  return sub_53B08((float *)(a1 + 0x40), (float *)v9, (float *)v8, (float *)v13);
}

//----- (0001B958) --------------------------------------------------------
float *__fastcall sub_1B958(int a1, float *a2, int a3, int a4)
{
  int v5[9]; // [esp+0h] [ebp-88h] BYREF
  int v6[9]; // [esp+24h] [ebp-64h] BYREF
  int v7[3]; // [esp+48h] [ebp-40h] BYREF
  float v8; // [esp+54h] [ebp-34h]
  int v9; // [esp+58h] [ebp-30h]
  int v10; // [esp+5Ch] [ebp-2Ch]
  float v11; // [esp+60h] [ebp-28h]
  float v12; // [esp+64h] [ebp-24h]
  float v13; // [esp+68h] [ebp-20h]
  int v14[7]; // [esp+6Ch] [ebp-1Ch] BYREF

  v14[3] = (int)v7;
  v11 = 0.0;
  v12 = 0.0;
  v13 = 0.0;
  v11 = *a2 + *(float *)(a1 + 0x34);
  v12 = a2[1] + *(float *)(a1 + 0x38);
  v13 = a2[2] + *(float *)(a1 + 0x3C);
  *(float *)v7 = v11;
  v8 = -v11;
  *(float *)&v7[1] = v12;
  *(float *)&v9 = -v12;
  *(float *)&v7[2] = v13;
  v14[4] = (int)v14;
  *(float *)v14 = v8;
  *(float *)&v10 = -v13;
  v14[1] = v9;
  v14[2] = v10;
  v6[0] = *(_DWORD *)(a1 + 0x74);
  v6[1] = *(_DWORD *)(a1 + 0x78);
  v6[2] = *(_DWORD *)(a1 + 0x7C);
  v6[3] = *(_DWORD *)(a1 + 0x80);
  v6[4] = *(_DWORD *)(a1 + 0x84);
  v6[5] = *(_DWORD *)(a1 + 0x88);
  v6[6] = *(_DWORD *)(a1 + 0x8C);
  v6[7] = *(_DWORD *)(a1 + 0x90);
  v6[8] = *(_DWORD *)(a1 + 0x94);
  v5[0] = *(_DWORD *)a1;
  v5[1] = *(_DWORD *)(a1 + 4);
  v5[2] = *(_DWORD *)(a1 + 8);
  v5[3] = *(_DWORD *)(a1 + 0xC);
  v5[4] = *(_DWORD *)(a1 + 0x10);
  v5[5] = *(_DWORD *)(a1 + 0x14);
  v5[6] = *(_DWORD *)(a1 + 0x18);
  v5[7] = *(_DWORD *)(a1 + 0x1C);
  v5[8] = *(_DWORD *)(a1 + 0x20);
  return sub_53B08((float *)(a1 + 0x40), (float *)v5, (float *)v6, (float *)v14);
}

//----- (0001BA90) --------------------------------------------------------
void __fastcall Q_NC_sub_1BA90(float *a1, int a2, int a3, int a4, int a5)
{
  sub_5323C((int)(a1 + 0xD), *(float *)&a5);
  sub_5353C(a1, (int)a1, a3, a4, a5);
}

//----- (0001BAB0) --------------------------------------------------------
void __fastcall Q_NC_sub_1BAB0(int a1, int a2, int a3, int a4, float degrees)
{
  Q_RotateVectorY_sub_532AC((T_Vector3D *)(a1 + 0x34), degrees);
  sub_53564((float *)a1, a1, a3, a4, SLODWORD(degrees));
}

//----- (0001BAF0) --------------------------------------------------------
void __fastcall sub_1BAF0(float *a1, int edx0, int a3, int a4, int a2)
{
  Q_RotateVectorY_sub_532AC((T_Vector3D *)(a1 + 0xD), *(float *)&a2);
  sub_535E4(a1, (int)a1, a3, a4, a2);
}

//----- (0001BB10) --------------------------------------------------------
FILE *__fastcall Q_OpenFile_sub_1BB10(const char *aFName, fpos_t *endOffset)
{
  FILE *v2; // eax
  FILE *v3; // edi
  T_FileInfo v1; // [esp+0h] [ebp-128h] BYREF

  Q_InitFileInfo_sub_1BB78(&v1);
  Q_OpenFile_sub_1BBFC(&v1, aFName, O_TEXT, FALSE);
  v2 = fdopen(v1.fh, "r");
  v3 = v2;
  if ( endOffset )
  {
    fgetpos(v2, endOffset);
    *endOffset += Q_GetFileLength_sub_1BE28(&v1);
  }
  v1.fh = 0xFFFFFFFF;
  Q_CloseFileAndDelete_sub_1BBC8(&v1);
  return v3;
}
// 1BB10: using guessed type T_FileInfo v1;

//----- (0001BB78) --------------------------------------------------------
void __fastcall __spoils<> Q_InitFileInfo_sub_1BB78(P_FileInfo a1)
{
  if ( !V_CobFilesLoaded )
  {
    Q_CobFilesLoad_sub_1C3C4(&V_CobFiles);
    V_CobFilesLoaded = TRUE;
  }
  a1->fh = 0xFFFFFFFF;
  a1->fname[0] = 0;
  a1->d = 0;
  a1->e = 0;
  a1->index = 0xFFFFFFFF;
}
// 9A250: using guessed type int V_CobFilesLoaded;

//----- (0001BBC8) --------------------------------------------------------
void __fastcall Q_CloseFileAndDelete_sub_1BBC8(P_FileInfo a1)
{
  Q_CloseFile_sub_1BE00(a1);
  if ( a1->e == 0xFFFFFFFF && a1->d )
  {
    sub_2627C(a1->d);
  }
  operator delete[](a1->d);
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);

//----- (0001BBFC) --------------------------------------------------------
BOOL __fastcall Q_OpenFile_sub_1BBFC(P_FileInfo a1, const char *aFName, int aOFlags, int preload)
{
  BOOL result; // eax
  int len; // eax
  unsigned int v7; // ecx
  void *pData; // eax

  if ( a1->fh != 0xFFFFFFFF )
  {
    Q_CloseFile_sub_1BE00(a1);
  }
  a1->e = 0;
  strncpy(a1->fname, aFName, 0x100u);
  a1->fname[0xFF] = 0;
  result = Q_CFILE_CPP_OpenFile_sub_1BCBC(a1, aOFlags);
  if ( !result )
  {
    if ( preload == TRUE )
    {
      len = filelength(a1->fh);
      v7 = len;
      if ( len > 0 )
      {
        pData = operator new[](len);
        Q_RegisterData_sub_2625C(pData, 1, "CFILE PRELOAD");
        a1->d = pData;
        if ( pData )
        {
          if ( !Q_ReadFile_sub_1BF94(a1, pData, v7) )
          {
            a1->e = 0xFFFFFFFF;
            return 0;
          }
          sub_2627C(a1->d);
          operator delete[](a1->d);
          a1->d = 0;
        }
      }
    }
    return 0;
  }
  return result;
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);

//----- (0001BCA8) --------------------------------------------------------
BOOL __fastcall Q_OpenFile_sub_1BCA8(T_FileInfo *a1, const char *a2)
{
  return Q_OpenFile_sub_1BBFC(a1, a2, O_CREAT|O_WRONLY, 0);
}

//----- (0001BCBC) --------------------------------------------------------
BOOL __fastcall Q_CFILE_CPP_OpenFile_sub_1BCBC(T_FileInfo *a1, int aOFlags)
{
  int fh; // eax MAPDST
  int cindex_1; // edi
  int findex; // ecx
  T_Name50 *fname; // ebx
  int cindex; // esi
  MACRO_VFX_BOOL found; // [esp+0h] [ebp-20h]
  int oflag; // [esp+4h] [ebp-1Ch]

  oflag = aOFlags;
  if ( a1->fh != 0xFFFFFFFF )
  {
    Q_CloseFile_sub_1BE00(a1);
  }
  if ( (aOFlags & O_CREAT) != 0 )
  {
    LOWORD(oflag) = aOFlags | O_BINARY|O_TRUNC;
    fh = open(a1->fname, oflag, S_IREADWRITE);
LABEL_19:
    a1->fh = fh;
    goto LABEL_20;
  }
  found = FALSE;
  if ( (aOFlags & (O_RDWR|O_WRONLY)) == 0 )
  {
    cindex_1 = 0;
    findex = 0;
    if ( V_CobFiles.totalfiles > 0 )
    {
      fname = (T_Name50 *)&V_CobFiles;
      cindex = 0;
      while ( 1 )
      {
        if ( findex == V_CobFiles.nextcobstart[cindex] )
        {
          ++cindex;
          ++cindex_1;
        }
        if ( !stricmp(a1->fname, (const char *)fname) )
        {
          break;
        }
        ++findex;
        ++fname;
        if ( findex >= V_CobFiles.totalfiles )
        {
          goto LABEL_17;
        }
      }
      a1->index = findex;
      fh = open(V_CobFiles.cobnames[cindex_1], aOFlags);
      a1->fh = fh;
      if ( fh == 0xFFFFFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\cfile.cpp", 0xC4);
      }
      lseek(a1->fh, V_CobFiles.foffsets[findex], SEEK_SET);
      found = TRUE;
    }
  }
LABEL_17:
  if ( found == FALSE )
  {
    fh = open(a1->fname, aOFlags);
    goto LABEL_19;
  }
LABEL_20:
  a1->d4 = oflag;
  return a1->fh == 0xFFFFFFFF;
}

//----- (0001BE00) --------------------------------------------------------
int __fastcall Q_CloseFile_sub_1BE00(P_FileInfo a1)
{
  int v3; // ebx

  if ( a1->fh == 0xFFFFFFFF )
  {
    return 0;
  }
  v3 = close(a1->fh);
  if ( !v3 )
  {
    a1->fh = 0xFFFFFFFF;
  }
  return v3;
}

//----- (0001BE28) --------------------------------------------------------
int __fastcall Q_GetFileLength_sub_1BE28(P_FileInfo a1)
{
  int index; // ecx
  int offset; // esi
  int i; // eax

  if ( a1->fh == 0xFFFFFFFF )
  {
    return 0xFFFFFFFF;
  }
  index = a1->index;
  if ( index == 0xFFFFFFFF )
  {
    // A separate file
    return filelength(a1->fh);
  }
  offset = V_CobFiles.foffsets[index + 1];
  if ( V_CobFiles.totalcobs > 0 )
  {
    i = 0;
    do
    {
      if ( V_CobFiles.nextcobstart[i] - 1 == a1->index )
      {
        offset = V_CobFiles.coblengths[i];
      }
      ++i;
    }
    while ( i < V_CobFiles.totalcobs );
  }
  return offset - V_CobFiles.foffsets[index];
}

//----- (0001BEA0) --------------------------------------------------------
int __fastcall Q_GetFilePos_sub_1BEA0(P_FileInfo a1)
{
  int fpos; // eax
  int v3; // ebx
  int index; // ecx

  fpos = tell(a1->fh);
  v3 = fpos;
  if ( fpos != 0xFFFFFFFF )
  {
    index = a1->index;
    if ( index != 0xFFFFFFFF )
    {
      return fpos - V_CobFiles.foffsets[index];
    }
  }
  return v3;
}

//----- (0001BECC) --------------------------------------------------------
int __fastcall sub_1BECC(int *a1, int offset, int a3)
{
  int v3; // esi
  int v4; // ecx

  if ( a1[0x44] && a3 != 0xFFFFFFFF )
  {
    return offset + a1[0x43];
  }
  v3 = a1[0x42];
  v4 = offset;
  if ( v3 != 0xFFFFFFFF )
  {
    v4 = offset + V_CobFiles.foffsets[v3];
  }
  return lseek(*a1, v4, 0);
}

//----- (0001BF0C) --------------------------------------------------------
int __fastcall Q_SetFilePos_sub_1BF0C(P_FileInfo a1, int offset)
{
  return lseek(a1->fh, offset, SEEK_CUR);
}

//----- (0001BF1C) --------------------------------------------------------
void *__fastcall Q_CfileLoad_sub_1BF1C(T_FileInfo *a1, void *a2)
{
  void *v3; // ecx
  int FileLength_sub_1BE28; // eax
  unsigned int v5; // edi
  unsigned int v6; // ebp
  void *result; // eax

  v3 = a2;
  if ( a1->fh != 0xFFFFFFFF )
  {
    FileLength_sub_1BE28 = Q_GetFileLength_sub_1BE28(a1);
    v5 = FileLength_sub_1BE28;
    v6 = 0;
    if ( FileLength_sub_1BE28 > 0 )
    {
      if ( !a2 )
      {
        result = operator new[](FileLength_sub_1BE28);
        Q_RegisterData_sub_2625C(result, 5, "CFILE LOAD");
        v3 = result;
        if ( !result )
        {
          return result;
        }
        v6 = 0xFFFFFFFF;
      }
      if ( Q_ReadFile_sub_1BF94(a1, v3, v5) == v5 )
      {
        return v3;
      }
      if ( v6 == 0xFFFFFFFF )
      {
        sub_2627C(v3);
      }
      operator delete[](v3);
      _get_errno_ptr();
    }
  }
  return 0;
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);

//----- (0001BF94) --------------------------------------------------------
int __fastcall Q_ReadFile_sub_1BF94(P_FileInfo a1, void *aBuf, unsigned int aReadLen)
{
  int index; // esi
  int pos; // esi
  unsigned int filelength; // eax

  index = a1->index;
  if ( index != 0xFFFFFFFF )
  {
    pos = tell(a1->fh) - V_CobFiles.foffsets[index];
    filelength = Q_GetFileLength_sub_1BE28(a1);
    if ( pos + aReadLen > filelength )
    {
      aReadLen = filelength - pos;
    }
  }
  return read(a1->fh, aBuf, aReadLen);
}

//----- (0001BFD4) --------------------------------------------------------
unsigned int __fastcall sub_1BFD4(int *a1, void *buf, unsigned int a3, unsigned int a4, int a5)
{
  unsigned int v7; // ebp
  void *v8; // ebx
  unsigned int v9; // edx
  unsigned int result; // eax
  unsigned int i; // ecx
  unsigned int v12; // edx
  unsigned int v14; // [esp+4h] [ebp-1Ch]
  unsigned int len; // [esp+Ch] [ebp-14h]
  int v17; // [esp+10h] [ebp-10h]

  v7 = 0;
  len = a3 / a4;
  v17 = 0;
  v14 = a4 - 1;
  if ( a4 == 1 )
  {
LABEL_9:
    result = read(*a1, buf, a3 - v17);
    if ( result != 0xFFFFFFFF )
    {
      v17 += result;
      ((void (*)(void))a5)();
      return v17;
    }
  }
  else
  {
    while ( 1 )
    {
      result = read(*a1, buf, len);
      if ( result == 0xFFFFFFFF )
      {
        break;
      }
      v17 += result;
      if ( result < len )
      {
        for ( i = v7; i < a4; ((void (__fastcall *)(unsigned int, unsigned int, _DWORD, unsigned int))a5)(a4, v12, 0, i) )
        {
          v12 = i++;
        }
        return v17;
      }
      v8 = buf;
      v9 = v7++;
      buf = (char *)buf + result;
      ((void (__fastcall *)(unsigned int, unsigned int, void *, unsigned int))a5)(a4, v9, v8, v14);
      if ( v7 >= v14 )
      {
        goto LABEL_9;
      }
    }
  }
  return result;
}

//----- (0001C098) --------------------------------------------------------
unsigned int __fastcall Q_CFILE_CPP_dos_write_sub_1C098(int *phandle, void *buf, unsigned int size)
{
  unsigned int size_1; // edi
  unsigned int chunksize; // esi
  int handle; // eax
  unsigned int result; // eax
  unsigned int byteswritten; // [esp+0h] [ebp-20h] BYREF
  int *phandle_1; // [esp+4h] [ebp-1Ch]
  unsigned int v10; // [esp+8h] [ebp-18h]
  unsigned int v11; // [esp+Ch] [ebp-14h]

  phandle_1 = phandle;
  size_1 = size;
  if ( !size )
  {
    return v10;
  }
  while ( 1 )
  {
    chunksize = size_1 <= 0xFFF0 ? size_1 : 0xFFF0;
    handle = *phandle_1;
    v11 = chunksize;
    result = dos_write(handle, buf, chunksize, &byteswritten);
    v10 = result;
    if ( result )
    {
      break;
    }
    if ( chunksize != byteswritten )
    {
      _assert(0, "chunksize==byteswritten", "..\\cfile.cpp", 0x244);
    }
    buf = (char *)buf + v11;
    size_1 -= v11;
    if ( !size_1 )
    {
      return v10;
    }
  }
  return result;
}

//----- (0001C278) --------------------------------------------------------
void __fastcall Q_CFILE_CPP_IndexOneCob_sub_1C278(P_CobFiles a1, char *CobFileName)
{
  int totalcobs; // ebx
  int fh; // edi MAPDST
  int totalfiles; // edx
  int firstfileindex; // esi
  int filesInCob; // [esp+0h] [ebp-18h] BYREF

  if ( a1->totalcobs >= 5 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cfile.cpp", 0x28C);
  }
  totalcobs = a1->totalcobs;
  if ( totalcobs < 5 )
  {
    strncpy(a1->cobnames[totalcobs], CobFileName, 50u);
    fh = open(CobFileName, O_BINARY);
    if ( fh != 0xFFFFFFFF )
    {
      a1->coblengths[a1->totalcobs] = filelength(fh);
      read(fh, &filesInCob, 4u);
      if ( 500 - a1->totalfiles < filesInCob )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\cfile.cpp", 0x2A0);
      }
      totalfiles = a1->totalfiles;
      if ( 500 - totalfiles >= filesInCob )
      {
        read(fh, a1->fnames[totalfiles], 50 * filesInCob);
        read(fh, &a1->foffsets[a1->totalfiles], 4 * filesInCob);
        close(fh);
        firstfileindex = filesInCob + a1->totalfiles;
        a1->nextcobstart[a1->totalcobs] = firstfileindex;
        a1->totalfiles = firstfileindex;
        ++a1->totalcobs;
      }
    }
  }
}

//----- (0001C3C4) --------------------------------------------------------
void __fastcall Q_CobFilesLoad_sub_1C3C4(P_CobFiles a1)
{
  FILE *v2; // ecx
  char v3[100]; // [esp+0h] [ebp-64h] BYREF

  v2 = fopen("cob.cfg", "r");
  if ( v2 )
  {
    while ( fscanf(v2, "%s", v3) != 0xFFFFFFFF )
    {
      Q_CFILE_CPP_IndexOneCob_sub_1C278(a1, v3);
    }
    fclose(v2);
  }
}
// 1C3C4: using guessed type char anonymous_0[100];

//----- (0001C410) --------------------------------------------------------
void Q_AtExitFunc_sub_1C410(void)
{
  Q_StopSystems_sub_26160();
  UVB_sub_7501C();
}

//----- (0001C424) --------------------------------------------------------
int __fastcall main(int argc, char *argv[])
{
  clock_t v3; // edx
  char *v4; // edi
  char *sub_1CEA8; // esi
  char v6; // al
  char v7; // al
  char *v8; // eax
  int v9; // eax
  int v10; // edx
  char *v11; // eax
  char *v12; // eax
  BOOL v13; // edx
  char *v14; // edi
  char *v15; // esi
  char v16; // al
  char v17; // al
  int v18; // eax
  char *v19; // eax
  UBYTE *v20; // ebx
  int v21; // ebx
  FILE *fp; // eax MAPDST
  char *v23; // edx
  char *v25; // edi
  char *v26; // esi
  char v27; // al
  char v28; // al
  unsigned int v29; // eax
  FILE *v31; // edi
  int i; // esi
  int v33; // edx
  int result; // eax
  int v35; // [esp-4h] [ebp-574h]
  int v36; // [esp-4h] [ebp-574h]
  T_Palette black_palette; // [esp+0h] [ebp-570h] BYREF
  T_FileInfo v1Type1; // [esp+300h] [ebp-270h] BYREF
  T_FileInfo v1; // [esp+418h] [ebp-158h] BYREF
  char tmp; // [esp+530h] [ebp-40h] BYREF
  int stars; // [esp+544h] [ebp-2Ch] BYREF
  __int16 num; // [esp+548h] [ebp-28h] BYREF
  int races; // [esp+54Ch] [ebp-24h] BYREF
  unsigned int seed; // [esp+550h] [ebp-20h] BYREF
  MACRO_VFX_BOOL forceUNIVBE; // [esp+554h] [ebp-1Ch]
  char **__attribute__((__org_arrdim(0,0))) v48; // [esp+558h] [ebp-18h]

  v48 = argv;
  v3 = clock();
  printf("\nAscendancy\nCopyright (c) 1995 The Logic Factory, Inc.\nAll rights reserved\n");
  while ( clock() - v3 < 0xFA )
  {
    ;
  }
  v4 = "Thank you for playing Ascendancy.";
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xAB);// 171: "Thank you for playing Ascendancy."
  do
  {
    v6 = *sub_1CEA8;
    *v4 = *sub_1CEA8;
    if ( !v6 )
    {
      break;
    }
    v7 = sub_1CEA8[1];
    sub_1CEA8 += 2;
    v4[1] = v7;
    v4 += 2;
  }
  while ( v7 );
  atexit(Q_AtExitFunc_sub_1C410);
  if ( argc > 1 && *v48[1] == 'v' )
  {
    v35 = off_964E0;
    v8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xAC);     // 172: "\n\nAscendancy version %s\n\n"
    printf(v8, v35);
    getch();
  }
  forceUNIVBE = FALSE;
  if ( argc > 1 && *v48[1] == 'u' )
  {
    forceUNIVBE = TRUE;
  }
  v9 = Q_CheckFreeMemory_sub_53DEC();
  v10 = v9;
  if ( argc > 1 && *v48[1] == 'm' )
  {
    v36 = v9;
    v11 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xAD);    // 173: "\n\nFree memory: %ld\n\n"
    printf(v11, v36);
    getch();
  }
  if ( v10 < 0x300000 )
  {
    v12 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xAE);    // 174: "Your computer does not have enough free extended memory to run\n
                                                       // Ascendancy.  You will need an additional %ldK bytes of free extended memory."
    sprintf("Thank you for playing Ascendancy.", v12, (0x300000 - v10) / 0x400 + 1);
    exit(1);
  }
  Q_InitFileInfo_sub_1BB78(&v1Type1);
  v13 = Q_OpenFile_sub_1BBFC(&v1Type1, "data\\theme00.raw", O_BINARY, 0);
  Q_CloseFile_sub_1BE00(&v1Type1);
  if ( v13 )
  {
    v14 = "Thank you for playing Ascendancy.";
    v15 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xAF);    // 175: "Please place the Ascendancy CD in your CDROM drive."
    do
    {
      v16 = *v15;
      *v14 = *v15;
      if ( !v16 )
      {
        break;
      }
      v17 = v15[1];
      v15 += 2;
      v14[1] = v17;
      v14 += 2;
    }
    while ( v17 );
    exit(1);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v1Type1);
  v18 = sub_53D22(0x101);
  if ( (!v18 || forceUNIVBE == TRUE) && !UVB_sub_75098(v18, 0, 0, O_BINARY, ".\\", 1) )
  {
    v19 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xB0);    // 176: "\n\nAscendancy was unable to find VESA support for your\n
                                                       // video card.  To configure the VESA driver that comes with\n
                                                       // Ascendancy, run the UVCONFIG program in this directory, and\n
                                                       // then try running Ascendancy again.  If this solution does\n
                                                       // not work, you may have to install the VESA driver supplied\n
                                                       // with your video card.  Consult your video card documentation\n
                                                       // for further information."
    printf(v19);
    s[0] = 0;
    exit(1);
  }
  if ( !sub_2BD88(&V_Type6_stru_D8654, "DATA", "VESA480.DLL") )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\corn.cpp", 0x9B);
  }
  VFX_area_wipe(0, 0, 639, 479, 0);
  Q_LoadPal_sub_2C158(&V_Type6_stru_D8654, "data\\logo.pal", 0, 256u);
  memset(black_palette, 0, sizeof(black_palette));
  Q_PaletteSet_sub_2C224(&V_Type6_stru_D8654, 0, 256, black_palette);
  Q_InitFileInfo_sub_1BB78(&v1);
  Q_OpenFile_sub_1BBFC(&v1, "data\\logo.gif", O_BINARY, 0);
  v20 = &V_BigBuffer[Q_GetFileLength_sub_1BE28(&v1)];
  Q_CfileLoad_sub_1BF1C(&v1, V_BigBuffer);
  VFX_GIF_draw(&V_Type6_stru_D8654.pane, V_BigBuffer, v20);
  VFX_pane_refresh(&V_Type6_stru_D8654.pane, 0, 0, 0x27F, 0x1DF);
  VFX_window_fade(&V_Type6_stru_D8654.window, V_Type6_stru_D8654.palette2, 25);
  v21 = FALSE;
  if ( Q_StartSoundSystem_sub_4EFB0(&V_SoundSystem, TRUE, FALSE) )
  {
    if ( V_SoundSystem.DIG_installed == TRUE && !Q_LoadMusic_sub_4F65C(&V_SoundSystem, "music.txt") )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0xBB);
    }
  }
  else
  {
    Q_SetNoSound_sub_4FF08(&V_SoundSystem);
  }
  fp = fopen("nougat.lf", "r");
  if ( fp )
  {
    V_NougatLfExists_dword_A0CFC = TRUE;
    fclose(fp);
  }
  v23 = "r";
  fp = fopen("flash.pop", "r");
  if ( fp )
  {
    V_FlashPopExists_dword_A0D00 = TRUE;
    fclose(fp);
  }
  if ( heapchk() )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0xD8);
  }
  if ( Q_WINMGR_CPP_StartTimer_sub_545EC(&V_Type3_stru_10AE70) != 0xFFFFFFFF )
  {
    v21 = 0xE1;
    v23 = "..\\corn.cpp";
    Q_AssertLogBreakExit_sub_261A8(0, "..\\corn.cpp", 0xE1);
  }
  if ( heapchk() )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0xE3);
  }
  if ( !Q_StartMouse_sub_2633C() )
  {
    v25 = "Thank you for playing Ascendancy.";
    v26 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xB1);    // 177: "Ascendancy could not find a mouse driver.  Please make sure your\n
                                                       // mouse driver is loaded, and then run Ascendancy again."
    do
    {
      v27 = *v26;
      *v25 = *v26;
      if ( !v27 )
      {
        break;
      }
      v28 = v26[1];
      v26 += 2;
      v25[1] = v28;
      v25 += 2;
    }
    while ( v28 );
    exit(1);
  }
  Q_GSYSTEM_CPP_PreloadMouseShp_sub_2C744(&V_Type6_stru_D8654, v23, v21, 0);
  if ( heapchk() )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0xEE);
  }
  v29 = time(0);
  srand(v29);
  sub_1CF14(0);
  fp = fopen("cosmos.txt", "r");
  v31 = fp;
  if ( fp )
  {
    fscanf(fp, "%s %d %s %d %s %d", &tmp, &stars, &tmp, &races, &tmp, &seed);
    i = 0;
    if ( seed != -1u )
    {
      srand(seed);
    }
    sub_1E10C(&V_Game, stars, races, 0);
    sub_1F404(&V_Game);
    v33 = 0;
    while ( fscanf(v31, "%d", &num) != 0xFFFFFFFF && i < races )
    {
      v33 += 0x1EE;
      ++i;
      V_StaticStrings_dword_A0D04.buffer[v33 + 0x1D61] = num;
    }
    fclose(v31);
  }
  else
  {
    sub_1E10C(&V_Game, 50, 7, 0);
    sub_1F404(&V_Game);
  }
  sub_1EE08(&V_Game, 0);
  if ( access("resume.gam", 0) )
  {
    sub_1F038(&V_Game);
  }
  V_Type3_stru_10AE70.window = (WINDOW *)&V_Type6_stru_D8654;
  sub_575BC(&V_Type3_stru_10AE70);
  if ( heapchk() )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0x11F);
  }
  sub_1EEA4(&V_Game);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 0, Q_Proc_sub_1CC94);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 1, Q_Proc_sub_5A320);
  Q_SetProc2_sub_57510(&V_Type3_stru_10AE70, 1, Q_Proc_sub_22468);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 2, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 3, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 4, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 7, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 8, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 9, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 0xA, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 0xC, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 0xD, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 0xE, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 0xF, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 0x10, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 0x12, Q_Proc_sub_5A320);
  Q_SetProc1_sub_574F0(&V_Type3_stru_10AE70, 0x14, Q_Proc_sub_5A320);
  Q_LoadAscendCfg_sub_59828(&V_Type3_stru_10AE70);
  VFX_window_fade(&V_Type6_stru_D8654.window, black_palette, 0x32);
  dword_132B60 = 0xFFFFFFFF;
  VFX_area_wipe(0, 0, 0x27F, 0x1DF, 0);
  Q_LoadPal_sub_2C158(&V_Type6_stru_D8654, "DATA\\game.pal", 0, 0x100u);
  Q_PaletteSet_sub_2C224(&V_Type6_stru_D8654, 0, 0x100, black_palette);
  sub_56E9C(&V_Type3_stru_10AE70, 0, 0xFFFFFFFF);
  if ( heapchk() )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0x146);
  }
  if ( argc == 4 && sub_59988(&V_Type3_stru_10AE70, v48[3], 0) != 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\corn.cpp", 0x14C);
  }
  MOUSE_show();
  // Main game loop
  while ( Q_GameLoop_dword_96774 == TRUE )
  {
    if ( V_Type3_stru_10AE70.bbb == 0xFFFFFFFF )
    {
      sub_59B80(&V_Type3_stru_10AE70);
    }
    else
    {
      Q_ProcessInput_sub_2656C();
    }
    sub_5469C(&V_Type3_stru_10AE70);
    sub_5508C(&V_Type3_stru_10AE70);
    if ( V_Type3_stru_10AE70.bbb )
    {
      sub_59A54(&V_Type3_stru_10AE70);
    }
  }
  Q_SaveAscendCfg_sub_5989C(&V_Type3_stru_10AE70);
  Q_SaveGam_sub_54048("resume.gam");
  Q_CloseFileAndDelete_sub_1BBC8(&v1);
  return result;
}
// 96774: using guessed type int Q_GameLoop_dword_96774;
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// 132B60: using guessed type int dword_132B60;

//----- (0001CC94) --------------------------------------------------------
void Q_Proc_sub_1CC94()
{
  void *v0; // edi
  UBYTE *v1; // esi
  T_FileInfo v2; // [esp+0h] [ebp-128h] BYREF

  v0 = sub_262B0(0x502Eu, 1u, 1, "GIF SCRATCH");
  Q_InitFileInfo_sub_1BB78(&v2);
  Q_OpenFile_sub_1BBFC(&v2, "DATA\\0OPENING.GIF", O_BINARY, 0);
  v1 = (UBYTE *)Q_CfileLoad_sub_1BF1C(&v2, 0);
  if ( !v1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0x180);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v2);
  if ( v0 )
  {
    VFX_GIF_draw(&V_Type6_stru_D8654.pane, v1, v0);
    sub_552CC(&V_Type3_stru_10AE70, 0);
  }
  sub_2627C(v1);
  operator delete(v1);
  sub_262CC(v0);
}
// 1CCF9: conditional instruction was optimized away because esi.4!=0
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (0001CD3C) --------------------------------------------------------
int Q_CORN_CPP_StaticTxtLoad_sub_1CD3C()
{
  FILE *fp; // edi
  char *pText; // esi
  char *pLetter; // ecx
  unsigned int v3; // ebp
  char letter; // dl
  int count; // eax
  char v6; // bh
  char line[201]; // [esp+1h] [ebp-E5h] BYREF
  int endOfFile; // [esp+CAh] [ebp-1Ch]

  fp = Q_OpenFile_sub_1BB10("static.txt", 0);
  if ( !fp )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0x1A0);
  }
  pText = V_StaticStrings_dword_A0D04.buffer;
  V_StaticStrings_dword_A0D04.count = 0;
  endOfFile = 0;
  do
  {
    if ( V_StaticStrings_dword_A0D04.count >= 200 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0x1AE);
    }
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(fp, &line[1]);
    if ( !stricmp(&line[1], "end\n") )
    {
      endOfFile = 0xFFFFFFFF;
      continue;
    }
    if ( line[1] == '"' )
    {
      pLetter = &line[1];
      v3 = 0;
      V_StaticStrings_dword_A0D04.index[V_StaticStrings_dword_A0D04.count] = pText;
      do
      {
        ++pLetter;
        if ( pText - V_StaticStrings_dword_A0D04.buffer >= 8000 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0x1C6);
        }
        letter = *pLetter;
        if ( *pLetter == '"' )
        {
          v3 = 0xFFFFFFFF;
          count = V_StaticStrings_dword_A0D04.count;
          *pText++ = 0;
          V_StaticStrings_dword_A0D04.count = count + 1;
        }
        else if ( letter != '\n' )
        {
          if ( letter )
          {
            if ( letter != '\\' )
            {
              *pText++ = letter;
              continue;
            }
            v6 = *++pLetter;
            if ( v6 == 'n' )
            {
              *pText++ = '\n';
              continue;
            }
            if ( v6 )
            {
              *pText++ = v6;
              continue;
            }
          }
          pLetter = line;
          fgets(&line[1], 200, fp);
        }
      }
      while ( !v3 );
    }
  }
  while ( !endOfFile );
  V_StaticStrings_dword_A0D04.loaded = 0xFFFFFFFF;
  return fclose(fp);
}

//----- (0001CEA8) --------------------------------------------------------
char *__fastcall Q_CORN_CPP_StaticTxtRead_sub_1CEA8(int aTextIndex)
{
  if ( !V_StaticStrings_dword_A0D04.loaded )
  {
    Q_CORN_CPP_StaticTxtLoad_sub_1CD3C();
  }
  if ( aTextIndex < 0 || aTextIndex >= V_StaticStrings_dword_A0D04.count )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\corn.cpp", 0x1F3);
  }
  return V_StaticStrings_dword_A0D04.index[aTextIndex];
}

//----- (0001CEF0) --------------------------------------------------------
int sub_1CEF0()
{
  int result; // eax

  _wcpp_2_mod_register_(&unk_964E4);
  result = sub_1DE64((int)&V_Game);
  dword_964EC = 1;
  return result;
}
// 786DA: using guessed type int __fastcall _wcpp_2_mod_register_(_DWORD);
// 964EC: using guessed type int dword_964EC;

//----- (0001CF14) --------------------------------------------------------
void __fastcall sub_1CF14(unsigned __int8 a1)
{
  unsigned __int8 v1; // dh
  char v2; // dl

  if ( a1 == 0xFF )
  {
    v1 = 0;
    v2 = 0xFF;
  }
  else
  {
    v1 = a1;
    v2 = 1 << a1;
  }
  byte_104BEA = v1;
  byte_968DC = v2;
}
// 968DC: using guessed type char byte_968DC;

//----- (0001CF40) --------------------------------------------------------
void __fastcall sub_1CF40(P_Star pStar)
{
  pStar->v.x = 0.0;
  pStar->v.y = 0.0;
  pStar->v.z = 0.0;
}

//----- (0001CF68) --------------------------------------------------------
T_Type15 *__fastcall sub_1CF68(int a1, int a2)
{
  int v4; // eax
  int v5; // eax
  T_Type15 *v6; // ebx
  T_Type15 *v7; // eax
  float *p_Unknown_0; // edx
  double v9; // st7
  int v11[3]; // [esp+8h] [ebp-A4h] BYREF
  int v12[3]; // [esp+14h] [ebp-98h] BYREF
  float v13; // [esp+20h] [ebp-8Ch]
  float v14; // [esp+24h] [ebp-88h]
  float v15; // [esp+28h] [ebp-84h]
  float v16; // [esp+2Ch] [ebp-80h]
  int v17; // [esp+30h] [ebp-7Ch]
  int v18; // [esp+34h] [ebp-78h]
  float v19; // [esp+38h] [ebp-74h]
  float v20; // [esp+3Ch] [ebp-70h]
  float v21; // [esp+40h] [ebp-6Ch]
  float v22; // [esp+44h] [ebp-68h]
  float v23; // [esp+48h] [ebp-64h]
  float v24; // [esp+4Ch] [ebp-60h]
  float v25; // [esp+50h] [ebp-5Ch]
  float v26; // [esp+54h] [ebp-58h]
  float v27; // [esp+58h] [ebp-54h]
  float v28; // [esp+5Ch] [ebp-50h] BYREF
  float v29; // [esp+60h] [ebp-4Ch]
  float v30; // [esp+64h] [ebp-48h]
  int v31[3]; // [esp+68h] [ebp-44h] BYREF
  float v32; // [esp+74h] [ebp-38h]
  int v33; // [esp+78h] [ebp-34h]
  int v34; // [esp+7Ch] [ebp-30h]
  int *v35; // [esp+80h] [ebp-2Ch]
  int *v36; // [esp+88h] [ebp-24h]
  int *v37; // [esp+8Ch] [ebp-20h]
  float *v38; // [esp+90h] [ebp-1Ch]
  float v39; // [esp+98h] [ebp-14h]

  v4 = *(__int16 *)(a1 + 0x44);
  if ( v4 < 0 || v4 >= 6 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x7F);
  }
  v5 = *(__int16 *)(a2 + 0x44);
  if ( v5 < 0 || v5 >= 6 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x81);
  }
  v6 = 0;
  if ( *(_WORD *)(a1 + 0x44) != word_9652E[*(_DWORD *)a1] && *(_WORD *)(a2 + 0x44) != word_9652E[*(_DWORD *)a2] )
  {
    v7 = sub_205A0(&V_Game, a1, a2);
    p_Unknown_0 = (float *)&v7->Unknown_0;
    v6 = v7;
    if ( v7 )
    {
      *(_DWORD *)(a1 + 4 * (__int16)(*(_WORD *)(a1 + 0x44))++ + 0x2C) = v7;
      *(_DWORD *)(a2 + 4 * (__int16)(*(_WORD *)(a2 + 0x44))++ + 0x2C) = v7;
      v19 = 0.0;
      v20 = 0.0;
      v21 = 0.0;
      v22 = *(float *)(a2 + 8);
      v23 = *(float *)(a2 + 0xC);
      v24 = *(float *)(a2 + 0x10);
      v13 = 0.0;
      v14 = 0.0;
      v15 = 0.0;
      v35 = v11;
      v13 = v22 - *(float *)(a1 + 8);
      v14 = v23 - *(float *)(a1 + 0xC);
      v15 = v24 - *(float *)(a1 + 0x10);
      *(float *)v11 = v13;
      *(float *)&v11[1] = v14;
      *(float *)&v11[2] = v15;
      v22 = v13;
      v23 = v14;
      v24 = v15;
      v9 = sqrt(v14 * v14 + v13 * v13 + v15 * v15);
      v36 = v12;
      v32 = v22 * (1.0 / v9);
      *(float *)v12 = v32;
      *(float *)&v33 = v23 * (1.0 / v9);
      v12[1] = v33;
      *(float *)&v34 = 1.0 / v9 * v24;
      v12[2] = v34;
      v39 = v9 * flt_90A84;
      v22 = v32;
      v23 = *(float *)&v33;
      v39 = v39 * flt_90A88 + flt_90A8C;
      v24 = *(float *)&v34;
      v16 = v32 * v39;
      v37 = v31;
      *(float *)&v17 = *(float *)&v33 * v39;
      *(float *)v31 = v16;
      *(float *)&v18 = *(float *)&v34 * v39;
      v31[1] = v17;
      v31[2] = v18;
      v19 = v16;
      v20 = *(float *)&v17;
      v21 = *(float *)&v18;
      p_Unknown_0[2] = v16;
      p_Unknown_0[3] = v20;
      p_Unknown_0[4] = v21;
      v25 = -v19;
      v38 = &v28;
      v26 = -v20;
      v28 = v25;
      v27 = -v21;
      v29 = v26;
      v30 = v27;
      p_Unknown_0[5] = v25;
      p_Unknown_0[6] = v29;
      p_Unknown_0[7] = v30;
    }
  }
  return v6;
}
// 90A84: using guessed type float flt_90A84;
// 90A88: using guessed type float flt_90A88;
// 90A8C: using guessed type float flt_90A8C;

//----- (0001D234) --------------------------------------------------------
__int16 __fastcall sub_1D234(int a1, P_Planet a2, __int16 a3)
{
  int word52; // eax
  __int16 v6; // bx
  __int16 v7; // ax
  P_Star star; // ebx
  int Unknown_14; // edx
  UBYTE buildingPlanetItemIndex; // bh
  T_Ship *v11; // eax
  __int16 byte57; // [esp+2h] [ebp-4h]

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xB3);
  }
  if ( a3 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xB4);
  }
  if ( a2->byte57 == a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xB5);
  }
  if ( a2->byte57 == 0xFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xB7);
  }
  byte57 = a2->byte57;
  word52 = a2->byte57;
  if ( word52 != 0xFF )
  {
    if ( a3 == 0xFFFFFFFF )
    {
      a2->byte57 = 0xFF;
    }
    else
    {
      a2->byte57 = a3;
      *(_BYTE *)(a1 + 0x14) |= 1 << a3;
    }
    v6 = *(_WORD *)(a1 + 0x5A);
    v7 = 0;
    *(_BYTE *)(a1 + 0x14) &= ~(1 << byte57);
    if ( v6 > 0 )
    {
      while ( *(unsigned __int8 *)(*(_DWORD *)(a1 + 4 * v7 + 0x46) + 0x57) != byte57 )
      {
        if ( ++v7 >= *(__int16 *)(a1 + 0x5A) )
        {
          goto LABEL_18;
        }
      }
      *(_BYTE *)(a1 + 0x14) |= 1 << byte57;
    }
LABEL_18:
    LOWORD(word52) = byte57;
    star = V_Game.races[byte57].star;
    if ( (P_Star)a1 == star )
    {
      Unknown_14 = (unsigned __int8)star->Unknown_14;
      word52 = 1 << byte57;
      if ( ((1 << byte57) & Unknown_14) == 0 )
      {
        *(_BYTE *)(a1 + 0x14) = Unknown_14 & 0x7F;
      }
    }
  }
  buildingPlanetItemIndex = a2->buildingPlanetItemIndex;
  if ( buildingPlanetItemIndex != 0xFF )
  {
    if ( buildingPlanetItemIndex == 0x17 )
    {
      v11 = sub_35A70(a2, a2->word52);
      if ( byte57 != v11->raceIndex )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xE0);
      }
      sub_49940((int)v11);
    }
    word52 = a2->word52;
    if ( (unsigned __int16)word52 != 0xFFFF && a2->buildingPlanetItemIndex != 0x23 )
    {
      *((_BYTE *)a2->a + 4 * word52 + 1) = 0xFF;
      word52 = a2->word52;
      *((_WORD *)a2->a + 2 * word52 + 1) = 0;
    }
    a2->buildingPlanetItemIndex = 0xFF;
    a2->buildingProgress = 0;
    a2->word52 = 0xFFFF;
  }
  return word52;
}

//----- (0001D3E8) --------------------------------------------------------
unsigned int __fastcall sub_1D3E8(int a1, int a2, int a3)
{
  char v5; // ah
  float *v6; // eax
  int i; // edx
  int v8; // eax
  float v10; // [esp+0h] [ebp-1Ch] BYREF
  float v11; // [esp+4h] [ebp-18h]
  float v12; // [esp+8h] [ebp-14h]
  int v13; // [esp+Ch] [ebp-10h]

  if ( a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xFD);
  }
  v5 = *(_BYTE *)(a2 + 0x58);
  if ( v5 == 5 )
  {
    v6 = *(float **)(a2 + 0x59);
    v10 = 0.0;
    v11 = 0.0;
    v12 = 0.0;
    if ( a1 == *(_DWORD *)v6 )
    {
      v10 = v6[2];
      v11 = v6[3];
      v12 = v6[4];
    }
    else if ( a1 == *((_DWORD *)v6 + 1) )
    {
      v10 = v6[5];
      v11 = v6[6];
      v12 = v6[7];
    }
    else
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\cosmos.cpp", 0x10A);
    }
    v11 = v11 + flt_90AF2;
    v12 = (double)(rand() % 0xC8) + v12;
    v13 = rand() % 0xC8;
    v10 = (double)v13 + v10;
    sub_496BC(a2, &v10);
    *(_BYTE *)(a2 + 0x58) = 4;
  }
  else if ( v5 != 4 )
  {
    goto LABEL_12;
  }
  *(_DWORD *)(a2 + 0x59) = a1;
LABEL_12:
  *(_BYTE *)(a1 + 0x15) |= 1 << *(_BYTE *)(a2 + 0x56);
  *(_BYTE *)(a1 + 0x17) |= 1 << *(_BYTE *)(a2 + 0x56);
  for ( i = 0; (__int16)i < *(__int16 *)(a1 + 0x44); ++i )
  {
    v8 = *(_DWORD *)(a1 + 4 * (__int16)i + 0x2C);
    *(_BYTE *)(v8 + 0x20) |= 1 << *(_BYTE *)(a2 + 0x56);
    *(_BYTE *)(*(_DWORD *)v8 + 0x16) |= 1 << *(_BYTE *)(a2 + 0x56);
    *(_BYTE *)(*(_DWORD *)(v8 + 4) + 0x16) |= 1 << *(_BYTE *)(a2 + 0x56);
  }
  return 0xFFFFFFFF;
}
// 90AF2: using guessed type float flt_90AF2;

//----- (0001D538) --------------------------------------------------------
unsigned int __fastcall sub_1D538(int a1, int a2)
{
  char v4; // ah
  int v5; // edx
  int v6; // esi
  unsigned int v7; // ebp
  __int16 i; // dx
  int v9; // eax
  int v11[107]; // [esp+0h] [ebp-1C4h] BYREF
  int v12; // [esp+1ACh] [ebp-18h]

  LOWORD(v12) = *(_WORD *)(a2 + 0x56);
  if ( (v12 & 0x8000u) != 0 || (__int16)v12 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x139);
  }
  v4 = *(_BYTE *)(a2 + 0x58);
  if ( (v4 == 3 || v4 == 1 || v4 == 2) && !sub_35C38(*(T_Planet **)(a2 + 0x59), (T_Ship *)a2) )
  {
    v5 = *(__int16 *)(*(_DWORD *)(a2 + 0x59) + 0xC);
    *(_BYTE *)(a2 + 0x58) = 4;
    *(_DWORD *)(a2 + 0x59) = &V_Game.stars[v5];
  }
  if ( *(_BYTE *)(a2 + 0x58) != 4 || a1 != *(_DWORD *)(a2 + 0x59) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x149);
  }
  v6 = sub_1D794((__int16 *)a1, v11);
  if ( v6 <= 0 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cosmos.cpp", 0x14E);
  }
  v7 = 0xFFFFFFFF;
  for ( i = 0; i < v6; ++i )
  {
    v9 = v11[i];
    if ( *(_WORD *)(v9 + 0x56) == (_WORD)v12 && v9 != a2 && *(_BYTE *)(v9 + 0x58) != 1 )
    {
      v7 = 0;
      break;
    }
  }
  if ( v7 == 0xFFFFFFFF )
  {
    *(_BYTE *)(a1 + 0x15) &= ~(1 << v12);
  }
  return 0xFFFFFFFF;
}
// 1D538: using guessed type int var_1C4[107];

//----- (0001D654) --------------------------------------------------------
int __fastcall sub_1D654(__int16 *a1, int a2, int a3)
{
  int result; // eax
  __int16 v5; // si
  int v6; // ecx
  int v7[107]; // [esp+0h] [ebp-1C4h] BYREF
  int v8; // [esp+1ACh] [ebp-18h]
  int v9; // [esp+1B0h] [ebp-14h]

  v9 = a3;
  if ( !a2 || !a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x16C);
  }
  result = sub_1D794(a1, v7);
  v5 = 0;
  v8 = result;
  while ( v5 < v8 )
  {
    v6 = v7[v5];
    result = *(__int16 *)(v6 + 0x56);
    if ( result == byte_104BEA )
    {
      sub_1D538((int)a1, v6);
      *(_DWORD *)(v6 + 0x59) = v9;
      *(_BYTE *)(v6 + 0x58) = 5;
      result = sub_1D3E8(a2, v6, 0);
    }
    ++v5;
  }
  return result;
}
// 1D654: could not find valid save-restore pair for ebx
// 1D654: using guessed type int var_1C4[107];

//----- (0001D734) --------------------------------------------------------
void __fastcall sub_1D734(int a1, int a2)
{
  int v3; // ebx
  WORD v4; // ax
  int v5; // edx
  int v6; // ecx
  unsigned __int8 v7; // [esp+0h] [ebp-14h]

  v3 = 0;
  v7 = *(_BYTE *)(a1 + 0x14) | *(_BYTE *)(a1 + 0x15);
  v4 = 0;
  if ( V_Game.racesNum > 0 )
  {
    v5 = 0;
    do
    {
      if ( (v7 & (unsigned __int8)(1 << v4)) != 0 )
      {
        v6 = v5;
        ++v3;
        v5 += 2;
        *(_WORD *)(v6 + a2) = v4;
      }
      ++v4;
    }
    while ( v4 < V_Game.racesNum );
  }
  JUMPOUT(0x1D78B);
}
// 1D789: control flows out of bounds to 1D78B

//----- (0001D794) --------------------------------------------------------
int __fastcall sub_1D794(__int16 *a1, _DWORD *a2)
{
  T_Ship *ships; // eax
  _DWORD *v3; // ebx
  int v4; // edi
  int v5; // esi
  __int16 i; // dx
  __int8 Unknown_58; // cl

  ships = V_Game.ships;
  v3 = a2;
  v4 = 0;
  v5 = 0;
  for ( i = 0; i < 0x6B && v5 < V_Game.shipsNum; ++i )
  {
    if ( ships->raceIndex != 0xFFFFFFFF )
    {
      if ( ((Unknown_58 = ships->Unknown_58, ++v5, Unknown_58 == 3) || Unknown_58 == 1 || Unknown_58 == 2)
        && &V_Game.stars[*(__int16 *)(ships->Unknown_59 + 0xC)] == (T_Star *)a1
        || ships->Unknown_58 == 4 && a1 == (__int16 *)ships->Unknown_59 )
      {
        if ( a2 )
        {
          *v3 = ships;
        }
        ++v3;
        ++v4;
      }
    }
    ++ships;
  }
  return v4;
}

//----- (0001D834) --------------------------------------------------------
unsigned int __fastcall sub_1D834(int a1, __int16 a2)
{
  T_Ship *ships; // ecx
  __int16 v4; // di
  int raceIndex; // eax
  __int16 v6; // dx
  int v7; // eax
  WORD v10; // [esp+6h] [ebp-18h]

  ships = V_Game.ships;
  v4 = 0;
  v10 = 0;
  while ( 1 )
  {
    if ( v4 >= 0x6B || v10 >= V_Game.shipsNum )
    {
      return 0;
    }
    raceIndex = ships->raceIndex;
    if ( raceIndex != 0xFFFFFFFF )
    {
      ++v10;
      if ( ships->Unknown_58 == 5
        && (V_Game.races[a2].Unknown_1C0[raceIndex] == 2 || raceIndex == byte_104BEA || a2 == ships->raceIndex) )
      {
        v6 = 0;
        if ( *(__int16 *)(a1 + 0x44) > 0 )
        {
          break;
        }
      }
    }
LABEL_2:
    ++v4;
    ++ships;
  }
  while ( 1 )
  {
    v7 = a1 + 4 * v6;
    if ( ships->Unknown_59 == *(_DWORD *)(v7 + 0x2C)
      && (a1 == **(_DWORD **)(v7 + 0x2C) && (ships->Unknown_A2 & 0x7FFFFFFF) == 0
       || a1 == *(_DWORD *)(*(_DWORD *)(a1 + 4 * v6 + 0x2C) + 4) && ships->Unknown_A2 == 0x3F800000) )
    {
      return 0xFFFFFFFF;
    }
    if ( ++v6 >= *(__int16 *)(a1 + 0x44) )
    {
      goto LABEL_2;
    }
  }
}

//----- (0001D920) --------------------------------------------------------
void __fastcall Q_ReadWriteStar_sub_1D920(P_Star pStar, P_FileInfo pfi, int read)
{
  int z2; // eax
  T_Star vStar; // [esp+0h] [ebp-70h] BYREF

  if ( read == TRUE )
  {
    sub_1CF40(&vStar);
    Q_ReadFile_sub_1BF94(pfi, &vStar, sizeof(T_Star));
    pStar->a = vStar.a;
    pStar->index = vStar.index;
    pStar->Unknown_6 = vStar.Unknown_6;
    pStar->v = vStar.v;
    pStar->Unknown_14 = vStar.Unknown_14;
    pStar->Unknown_15 = vStar.Unknown_15;
    pStar->Unknown_16 = vStar.Unknown_16;
    pStar->Unknown_17 = vStar.Unknown_17;
    pStar->Unknown_18 = vStar.Unknown_18;
    *(_DWORD *)pStar->Name = *(_DWORD *)vStar.Name;
    *(_DWORD *)&pStar->Name[4] = *(_DWORD *)&vStar.Name[4];
    *(_DWORD *)&pStar->Name[8] = *(_DWORD *)&vStar.Name[8];
    *(_DWORD *)&pStar->Name[0xC] = *(_DWORD *)&vStar.Name[0xC];
    qmemcpy(pStar->Unknown_2C, vStar.Unknown_2C, sizeof(pStar->Unknown_2C));
    pStar->Unknown_44 = vStar.Unknown_44;
    pStar->Unknown_46[0] = vStar.Unknown_46[0];
    pStar->Unknown_46[1] = vStar.Unknown_46[1];
    pStar->Unknown_46[2] = vStar.Unknown_46[2];
    pStar->Unknown_46[3] = vStar.Unknown_46[3];
    pStar->Unknown_46[4] = vStar.Unknown_46[4];
    pStar->planetsNum = vStar.planetsNum;
    z2 = vStar.z2;
    pStar->Unknown_44 = 0;
    pStar->z2 = z2;
    pStar->planetsNum = 0;
  }
  else
  {
    Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, pStar, 0x60u);
  }
}

//----- (0001DA04) --------------------------------------------------------
int __fastcall sub_1DA04(int a1, int a2)
{
  int result; // eax

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x21A);
  }
  result = *(__int16 *)(a2 + 4);
  LOWORD(result) = (unsigned __int8)V_Game.z10000[0x64 * *(__int16 *)(a1 + 4) + result];
  return result;
}

//----- (0001DA4C) --------------------------------------------------------
int __fastcall sub_1DA4C(int a1, __int16 a2, int a3, int a4)
{
  int v5; // ebx
  T_Planet **v6; // ecx
  int i; // edi
  int v8; // eax
  int v9; // edx
  P_Star star; // ecx

  if ( a2 > V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x248);
  }
  if ( a4 >= 0x6B )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x249);
  }
  v5 = 0;
  if ( ((1 << a2) & *(unsigned __int8 *)(a1 + 0x16)) == 0 )
  {
    return 0x2BC;
  }
  v6 = (T_Planet **)(a1 + 0x46);
  for ( i = 0; i < *(__int16 *)(a1 + 0x5A); ++i )
  {
    if ( (*v6)->byte57 != a2 )
    {
      v5 += sub_364B4(*v6, a2);
    }
    ++v6;
  }
  v8 = 0;
  v9 = 0;
  while ( v8 < V_Game.racesNum )
  {
    if ( v8 != a2 )
    {
      star = V_Game.races[v9].star;
      if ( (P_Star)a1 == star && (star->Unknown_14 & 0x80) != 0 && V_Game.races[a2].Unknown_1C0[v8] == 2 )
      {
        v5 = 3 * v5 + 0xC8;
      }
    }
    ++v9;
    ++v8;
  }
  if ( !*(_BYTE *)(a1 + 0x14) )
  {
    v5 *= 2;
  }
  if ( v5 < 0 )
  {
    v5 = 0;
  }
  if ( ((1 << a2) & *(unsigned __int8 *)(a1 + 0x17)) == 0 )
  {
    return 4 * v5 + 0x12C;
  }
  return v5;
}

//----- (0001DB70) --------------------------------------------------------
int __fastcall sub_1DB70(T_Star *a1, __int16 a2, int *a3, int a4)
{
  char Unknown_15; // al
  int v7; // eax
  unsigned int v8; // ebp
  int v9; // ecx
  int v10; // ebp
  int v11; // ecx
  T_Planet **Unknown_46; // ecx
  int i; // ebp
  int v14; // edx
  int v15; // edx
  int v16; // ebx
  T_Planet *v17; // eax
  int v19[107]; // [esp+0h] [ebp-1D4h] BYREF
  int *v20; // [esp+1ACh] [ebp-28h]
  int v21; // [esp+1B0h] [ebp-24h]
  int v22; // [esp+1B4h] [ebp-20h]
  int v23; // [esp+1B8h] [ebp-1Ch]
  int v24; // [esp+1BCh] [ebp-18h]
  int *v25; // [esp+1C0h] [ebp-14h]
  float v26; // [esp+1C4h] [ebp-10h]

  v25 = a3;
  v24 = a4;
  if ( a2 > V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x2BD);
  }
  v21 = 0;
  if ( ((1 << a2) & (unsigned __int8)a1->Unknown_16) != 0 && ((1 << a2) & (unsigned __int8)a1->Unknown_14) != 0 )
  {
    Unknown_15 = a1->Unknown_15;
    v26 = 0.0;
    if ( Unknown_15 )
    {
      if ( v25 && v24 >= 0 )
      {
        v10 = 0;
        if ( v24 > 0 )
        {
          v20 = v25;
          do
          {
            v11 = *v20;
            if ( !*v20 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x2F1);
            }
            if ( (*(_BYTE *)(v11 + 0x58) == 4 && a1 == *(T_Star **)(v11 + 0x59)
               || *(_BYTE *)(v11 + 0x58) == 3 && a1->index == *(_WORD *)(*(_DWORD *)(v11 + 0x59) + 0xC))
              && a2 != *(_WORD *)(v11 + 0x56)
              && V_Game.races[a2].Unknown_1C0[*(__int16 *)(v11 + 0x56)] == 2 )
            {
              v22 = sub_4A988(*v20);
              v26 = (double)v22 + v26;
            }
            ++v10;
            ++v20;
          }
          while ( v10 < v24 );
        }
      }
      else
      {
        v7 = sub_1D794((__int16 *)a1, v19);
        if ( v7 > 0 )
        {
          v8 = 0;
          v23 = 4 * v7;
          do
          {
            v9 = v19[v8 / 4];
            if ( !v9 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x2D6);
            }
            if ( (*(_BYTE *)(v9 + 0x58) == 4 && a1 == *(T_Star **)(v9 + 0x59)
               || *(_BYTE *)(v9 + 0x58) == 3 && a1->index == *(_WORD *)(*(_DWORD *)(v9 + 0x59) + 0xC))
              && a2 != *(_WORD *)(v9 + 0x56)
              && V_Game.races[a2].Unknown_1C0[*(__int16 *)(v9 + 0x56)] == 2 )
            {
              v22 = sub_4A988(v19[v8 / 4]);
              v26 = (double)v22 + v26;
            }
            v8 += 4;
          }
          while ( (int)v8 < v23 );
        }
      }
      v26 = v26 * 4.0 * 0.0099999998;
    }
    if ( v26 > 0.0 )
    {
      Unknown_46 = (T_Planet **)a1->Unknown_46;
      for ( i = 0; i < a1->planetsNum; ++i )
      {
        if ( (*Unknown_46)->byte57 == a2 )
        {
          v14 = v21;
          v15 = sub_363B0(*Unknown_46) + v14;
          v16 = v15 - 0xA * sub_360D8(*Unknown_46);
          v17 = *Unknown_46;
          v21 = v15;
          v21 = v16 - 5 * sub_36158(v17);
        }
        ++Unknown_46;
      }
      if ( a1 == V_Game.races[a2].star )
      {
        v21 += 20000;
      }
      v21 = (int)((double)v21 * v26);
    }
    if ( v21 < 0 )
    {
      v21 = 0;
    }
  }
  return 5 * v21;
}

//----- (0001DE64) --------------------------------------------------------
int __fastcall sub_1DE64(int a1)
{
  int v1; // eax
  int v2; // eax
  int v3; // eax
  int v4; // eax
  int v5; // eax
  int v6; // eax
  int v7; // edx

  v1 = _wcpp_2_ctor_array_(a1 + 6, 7, &unk_95AF0);
  v2 = _wcpp_2_ctor_array_(v1 + 0xDAF, 0x64, &unk_95B04);
  v3 = _wcpp_2_ctor_array_(v2 + 0x2582, 0x94, &unk_95ADC);
  v4 = _wcpp_2_ctor_array_(v3 + 0x14F10, 0x1F4, &unk_95AC8);
  v5 = _wcpp_2_ctor_array_(v4 + 0xF03E, 0x6B, &unk_95AB4);
  v6 = _wcpp_2_ctor_array_(v5 + 0x93F8, 9, &unk_95AA0);
  v7 = _wcpp_2_ctor_array_(v6 + 0x84, 0x18, &unk_95A8C) - 0x30701;
  sub_1E094(v7);
  return v7;
}
// 77394: using guessed type int __fastcall _wcpp_2_ctor_array_(_DWORD, _DWORD, _DWORD);

//----- (0001E03C) --------------------------------------------------------
int __fastcall sub_1E03C(int a1)
{
  int v1; // eax
  int v2; // eax
  int v3; // eax
  int v4; // eax
  int v5; // eax
  int v6; // eax

  v1 = sub_222C0((int)&loc_30700 + a1 + 1);
  v2 = sub_222E0(v1 - 0x84);
  v3 = sub_222A0(v2 - 0x93F8);
  v4 = sub_22300(v3 - 0xF03E);
  v5 = sub_22320(v4 - 0x14F10);
  v6 = sub_22280(v5 - 0x2582);
  return sub_22260(v6 - 0xDAF) - 6;
}

//----- (0001E094) --------------------------------------------------------
char __fastcall sub_1E094(int a1)
{
  char *v2; // edx
  int v3; // ebx
  char *v4; // edi
  char *sub_1CEA8; // esi
  char result; // al

  v2 = byte_D84C4;
  v3 = 0xB2;
  do
  {
    v4 = v2;
    sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v3);
    do
    {
      result = *sub_1CEA8;
      *v4 = *sub_1CEA8;
      if ( !result )
      {
        break;
      }
      result = sub_1CEA8[1];
      sub_1CEA8 += 2;
      v4[1] = result;
      v4 += 2;
    }
    while ( result );
    v2 += 0x14;
    ++v3;
  }
  while ( v2 != &byte_D84C4[0x104] );
  *(_WORD *)(a1 + 0x3335) = 0;
  *(_WORD *)(a1 + 0x49C3) = 0;
  *(_WORD *)(a1 + 0xD88) = 0;
  *(_WORD *)((char *)&loc_3067B + a1) = 0;
  *(_BYTE *)(a1 + 0xDB4) = 1;
  return result;
}

//----- (0001E10C) --------------------------------------------------------
void __fastcall sub_1E10C(P_Game pGame, __int16 stars, __int16 races, unsigned __int8 a4)
{
  *(_WORD *)pGame->z1 = 0;
  dword_96B88 = 0x20;
  sub_1E2A0(pGame, stars);
  sub_1E150(pGame, 9);
  sub_1EFC0(pGame);
  sub_1E70C(pGame, races, a4);
}
// 96B88: using guessed type int dword_96B88;

//----- (0001E150) --------------------------------------------------------
int __fastcall sub_1E150(P_Game a1, __int16 sectors)
{
  int v3; // ebx
  int i; // ecx
  T_Vector3D *p_v; // ebx
  int angle0; // edi
  P_Game v7; // esi
  int result; // eax
  float degrees; // [esp+0h] [ebp-44h]
  T_Vector3D vector; // [esp+10h] [ebp-34h] BYREF
  int angle2; // [esp+1Ch] [ebp-28h]
  int angle1; // [esp+20h] [ebp-24h]
  int v13; // [esp+24h] [ebp-20h]
  int v14; // [esp+28h] [ebp-1Ch]
  __int16 sectors_1; // [esp+2Ch] [ebp-18h]

  sectors_1 = sectors;
  if ( sectors > 9 )
  {
    sectors_1 = 9;
  }
  v3 = sectors_1;
  a1->sectorsNum = 0;
  memset(&vector, 0, sizeof(vector));
  v13 = 360 / v3;
  angle1 = 3 * (360 / v3) / 4;
  i = 0;
  p_v = &a1->sectors[0].v;
  angle0 = 0;
  v7 = a1;
  angle2 = angle1 / 2;
  while ( 1 )
  {
    result = sectors_1;
    if ( i >= sectors_1 )
    {
      break;
    }
    v7->sectors[0].n = i;
    vector.x = 1000.0;
    vector.y = 300.0;
    vector.z = 0.0;
    v14 = angle0 + rand() % angle1 - angle2;
    degrees = (float)v14;
    Q_RotateVectorY_sub_532AC(&vector, degrees);
    v14 = rand() % 0x258 - 0x12C;
    vector.y = (double)v14 + vector.y;
    p_v->x = vector.x;
    p_v->y = vector.y;
    p_v = (T_Vector3D *)((char *)p_v + 0xD);
    v7 = (P_Game)((char *)v7 + 0xD);
    *(float *)((char *)&p_v[0xFFFFFFFF].y + 3) = vector.z;
    ++i;
    angle0 += v13;
    ++a1->sectorsNum;
  }
  return result;
}

//----- (0001E2A0) --------------------------------------------------------
int __fastcall sub_1E2A0(P_Game a1, __int16 stars)
{
  __int16 k; // bx
  FILE *v3; // ebp
  __int16 i; // ax
  int v5; // edx
  P_Game v6; // eax
  P_Game v7; // edx
  char *v8; // eax
  int v9; // ecx
  char *v10; // ebp
  __int16 v11; // ax
  char *v12; // edx
  char *v13; // edi
  char *v14; // esi
  int v15; // ebx
  char v16; // al
  char v17; // al
  int v18; // ebx
  char *v19; // edi
  char *v20; // esi
  char v21; // al
  char v22; // al
  double v23; // st7
  __int16 v24; // bx
  __int16 v25; // si
  __int16 j; // dx
  char *v27; // ebp
  __int16 v28; // cx
  P_Game v29; // edx
  __int16 starsNum; // si
  char *v32; // [esp-4h] [ebp-82Ch]
  T_Name20 names[100]; // [esp+0h] [ebp-828h] BYREF
  float z; // [esp+7D0h] [ebp-58h] BYREF
  T_Vector3D vector; // [esp+7D4h] [ebp-54h]
  fpos_t endOffset; // [esp+7E0h] [ebp-48h]
  float pos; // [esp+7E4h] [ebp-44h]
  T_Vector3D vec1; // [esp+7E8h] [ebp-40h] BYREF
  int end; // [esp+7F4h] [ebp-34h] BYREF
  int v1; // [esp+7F8h] [ebp-30h] BYREF
  char *v41; // [esp+7FCh] [ebp-2Ch]
  int v42; // [esp+800h] [ebp-28h]
  float *v43; // [esp+804h] [ebp-24h]
  FILE *fp; // [esp+808h] [ebp-20h]
  P_Game v45; // [esp+80Ch] [ebp-1Ch]
  int v46; // [esp+810h] [ebp-18h]
  int v47; // [esp+814h] [ebp-14h]
  char *v48; // [esp+818h] [ebp-10h]
  int v49; // [esp+81Ch] [ebp-Ch]
  float v50; // [esp+820h] [ebp-8h]
  __int16 v51; // [esp+824h] [ebp-4h]

  v45 = a1;
  memset(&vec1, 0, sizeof(vec1));
  v46 = 0;
  k = 0;
  fp = Q_OpenFile_sub_1BB10("names.txt", &end);
  v50 = 440.0;
  v3 = fp;
  while ( k < 100 )
  {
    fgetpos(fp, &v1);
    if ( end > v1 )
    {
      fscanf(v3, "%s", names[k]);
    }
    else
    {
      sprintf(names[k], "XM%02d", k);
    }
    ++k;
  }
  fclose(fp);
  v49 = 100;
  v45->starsNum = stars;
  v47 = stars / 2;
  for ( i = 0; i < 13; ++i )
  {
    v5 = word_96514[i];
    v46 += v5;
  }
  v6 = v45;
  v45->planetsNum = 0;
  v7 = v45;
  v6->Word_18245 = 0;
  v8 = (char *)v6->stars;
  v7->day = 0;
  v7->h1 = v8;
  v7->planet = v7->planets;
  v51 = 0;
  if ( v45->starsNum > 0 )
  {
    v41 = v8;
    v48 = names[v49];
    do
    {
      v9 = v51;
      v10 = &v41[0x60 * v51];
      v10[0x14] = 0;
      v10[0x15] = 0;
      v10[0x16] = 0;
      v10[0x17] = 0;
      *((_WORD *)v10 + 0x22) = 0;
      *((_WORD *)v10 + 3) = 0xFFFF;
      v11 = v51;
      *((_WORD *)v10 + 0x2D) = 0;
      *((_WORD *)v10 + 2) = v11;
      v12 = names[rand() % v49];
      v13 = v10 + 0x1C;
      v14 = v12;
      v15 = v49;
      v32 = v10 + 0x1C;
      do
      {
        v16 = *v14;
        *v13 = *v14;
        if ( !v16 )
        {
          break;
        }
        v17 = v14[1];
        v14 += 2;
        v13[1] = v17;
        v13 += 2;
      }
      while ( v17 );
      v18 = v15 - 1;
      v19 = v12;
      v20 = v48 + 0xFFFFFFEC;
      v48 += 0xFFFFFFEC;
      v32 = v12;
      do
      {
        v21 = *v20;
        *v19 = *v20;
        if ( !v21 )
        {
          break;
        }
        v22 = v20[1];
        v20 += 2;
        v19[1] = v22;
        v19 += 2;
      }
      while ( v22 );
      v49 = v18;
      if ( v9 > v47 )
      {
        v23 = v50 + -75.0;
        v50 = v23;
        if ( v23 < 50.0 )
        {
          v50 = 50.0;
        }
        v47 += (v45->starsNum - v51) / 2;
      }
      *(_DWORD *)v10 = 0xC;
      v24 = 0;
      v25 = rand() % v46 + 1;
      for ( j = 0; j < 0xD; ++j )
      {
        v24 += word_96514[j];
        if ( v25 <= v24 )
        {
          *(_DWORD *)v10 = j;
          break;
        }
      }
      v42 = rand() % 1000 - 500;
      vec1.x = (float)v42;
      v42 = rand() % 1000 - 500;
      vec1.y = (float)v42;
      v42 = rand() % 1000 - 500;
      vec1.z = (float)v42;
      Q_NormVector3D_sub_53000(&vec1);
      v43 = &z;
      vector.z = vec1.x * v50;
      z = vector.z;
      *(float *)&endOffset = vec1.y * v50;
      LODWORD(vector.x) = endOffset;
      pos = v50 * vec1.z;
      vector.y = pos;
      vec1.x = vector.z;
      LODWORD(vec1.y) = endOffset;
      vec1.z = pos;
      *((_DWORD *)v10 + 2) = LODWORD(vector.z);
      v27 = v10 + 8;
      *((_DWORD *)v27 + 1) = LODWORD(vec1.y);
      v28 = v51;
      v29 = v45;
      *((_DWORD *)v27 + 2) = LODWORD(vec1.z);
      starsNum = v29->starsNum;
      v51 = v28 + 1;
    }
    while ( (__int16)(v28 + 1) < starsNum );
  }
  return fclose(fp);
}

//----- (0001E70C) --------------------------------------------------------
void __fastcall sub_1E70C(P_Game pGame, __int16 races, unsigned __int8 a3)
{
  int v4; // eax
  int v5; // edi
  int v6; // eax
  int starsNum; // eax
  WORD k; // di
  int v9; // eax
  __int16 m; // ax
  int *v11; // edx
  int v12; // ecx
  P_Star star; // edx
  int v14; // ebx
  int v15; // edx
  char *v16; // eax
  T_Star *v17; // edx
  char v18; // bl
  __int16 v19; // dx
  int *v20; // eax
  int v21; // ecx
  P_Star v22; // eax
  int ii; // ecx
  unsigned __int8 v24; // bl
  char v25; // dl
  T_Race *v26; // eax
  unsigned int v27; // edi
  __int16 v28; // ax
  int mm; // edx
  int v30; // eax
  int v31; // ecx
  int v32; // edi
  int jj; // edx
  int v34; // eax
  int v35; // ecx
  int v36; // edi
  int kk; // edx
  int v38; // eax
  int v39; // ecx
  int v40; // edi
  char v41; // al
  int v42; // eax
  int v43; // eax
  P_Game v44; // edx
  P_Star v45; // ebx
  UBYTE Unknown_19D; // ch
  int v47; // eax
  P_Game v48; // edx
  char v49; // bl
  int v50; // ecx
  P_Game v51; // eax
  char *v52; // ebx
  int v53; // [esp+4h] [ebp-18h]
  int v54; // [esp+8h] [ebp-14h]
  WORD v56; // [esp+10h] [ebp-Ch]
  int v57; // [esp+14h] [ebp-8h]
  WORD i; // [esp+14h] [ebp-8h]
  WORD j; // [esp+14h] [ebp-8h]
  __int16 nn; // [esp+14h] [ebp-8h]
  WORD i1; // [esp+14h] [ebp-8h]
  WORD n; // [esp+18h] [ebp-4h]

  pGame->aa2 = 0xFFFFFFFF;
  *((_BYTE *)&loc_30700 + (_DWORD)pGame) = 0;
  pGame->racesNum = races;
  v54 = 0;
  for ( i = 0; i < pGame->starsNum; ++i )
  {
    v4 = i;
    pGame->stars[v4].Unknown_14 = 0;
    pGame->stars[v4].Unknown_15 = 0;
    pGame->stars[v4].Unknown_16 = 0;
    pGame->stars[v4].Unknown_17 = 0;
  }
  for ( j = 0; j < pGame->t15Num; ++j )
  {
    pGame->t15[j].Unknown_20[0] = 0;
  }
  v5 = 0;
  Q_RESEARCH_CPP_LoadResTreeTxt_sub_46480(&V_ResTree, 0);
  while ( 1 )
  {
    LOWORD(v57) = v5;
    v6 = (__int16)v5;
    if ( (__int16)v5 >= 7 )
    {
      break;
    }
    V_ResTree.a.w1[(__int16)v5] = 0xFFFF;
    v5 = v57 + 1;
    word_106FB4[v6] = 0;
  }
  v56 = 600;
  starsNum = pGame->starsNum;
  pGame->f = 0;
  if ( starsNum < 25 )
  {
    v56 = 450;
  }
  while ( v56 > pGame->f )
  {
    if ( v54 )
    {
      for ( k = 0; k < pGame->racesNum; ++k )
      {
        v9 = k;
        pGame->races[v9].star->Unknown_14 = 0;
        pGame->races[v9].star->Unknown_17 = 0;
        for ( m = 0; ; ++m )
        {
          star = pGame->races[k].star;
          if ( m >= star->Unknown_44 )
          {
            break;
          }
          v11 = *(int **)&star->Unknown_2C[4 * m];
          v12 = *v11;
          *((_BYTE *)v11 + 0x20) = 0;
          *(_BYTE *)(v12 + 0x16) = 0;
          *(_BYTE *)(v11[1] + 0x16) = 0;
        }
      }
    }
    for ( n = 0; n < pGame->racesNum; ++n )
    {
      v14 = *(int *)((char *)&pGame->stars[0x63].z2 + 2);
      v15 = rand() % (v14 >> 0x10);
      v16 = (char *)pGame + 0x1EE * n;
      v17 = &pGame->stars[v15];
      *(_DWORD *)(v16 + 0xD) = v17;
      if ( v17->Unknown_14 )
      {
        --n;
      }
      else
      {
        v17->Unknown_14 = 0x80;
        v18 = 1 << n;
        *(_BYTE *)(*(_DWORD *)(v16 + 0xD) + 0x14) |= 1 << n;
        v16[6] = n;
        v19 = 0;
        *(_BYTE *)(*(_DWORD *)(v16 + 0xD) + 0x17) |= 1 << n;
        while ( 1 )
        {
          v22 = pGame->races[n].star;
          if ( v19 >= v22->Unknown_44 )
          {
            break;
          }
          v20 = *(int **)&v22->Unknown_2C[4 * v19];
          v21 = *v20;
          *((_BYTE *)v20 + 0x20) |= v18;
          *(_BYTE *)(v21 + 0x16) |= v18;
          ++v19;
          *(_BYTE *)(v20[1] + 0x16) |= v18;
        }
      }
    }
    v5 = v54 + 1;
    sub_220CC(pGame);
    ++v54;
  }
  for ( ii = 0; (__int16)ii < pGame->racesNum; ++ii )
  {
    if ( (_WORD)ii )
    {
      do
      {
        v27 = 0;
        v24 = rand() % 0x15;
        v28 = 0;
        if ( (__int16)ii > 0 )
        {
          while ( v24 != pGame->races[v28].Unknown_01 )
          {
            if ( ++v28 >= (__int16)ii )
            {
              goto LABEL_37;
            }
          }
          v27 = 0xFFFFFFFF;
        }
LABEL_37:
        ;
      }
      while ( v27 );
    }
    else
    {
      v24 = a3;
    }
    v25 = ii;
    HIWORD(v5) = (unsigned int)pGame->races >> 0x10;
    v26 = &pGame->races[(__int16)ii];
    sub_3B1FC(v26, v25, v24);
  }
  sub_1EE08(pGame, pGame->races[0].Unknown_02);
  v41 = pGame->Unknown_D8A[0x2A];
  if ( v41 )
  {
    if ( (unsigned __int8)v41 <= 1u )
    {
      for ( jj = 0; (__int16)jj < pGame->racesNum; ++jj )
      {
        v34 = (__int16)jj;
        LOWORD(ii) = pGame->races[v34].Unknown_1C7[1];
        v35 = ii + 0x1E;
        LOWORD(v5) = pGame->races[v34].Unknown_1C7[2];
        pGame->races[v34].Unknown_1C7[1] = v35;
        v36 = v5 + 0x1E;
        LOWORD(v35) = pGame->races[v34].Unknown_1C7[3];
        pGame->races[v34].Unknown_1C7[2] = v36;
        v35 += 0x1E;
        LOWORD(v36) = pGame->races[v34].Unknown_1C7[4];
        pGame->races[v34].Unknown_1C7[3] = v35;
        v36 += 0x1E;
        LOWORD(v35) = pGame->races[v34].Unknown_1C7[5];
        pGame->races[v34].Unknown_1C7[4] = v36;
        v35 += 0x1E;
        LOWORD(v36) = pGame->races[v34].Unknown_1C7[6];
        pGame->races[v34].Unknown_1C7[5] = v35;
        v5 = v36 + 0x28;
        LOWORD(v35) = pGame->races[v34].Unknown_1D5;
        pGame->races[v34].Unknown_1C7[6] = v5;
        ii = v35 - 0x1E;
        pGame->races[v34].Unknown_1D5 = ii;
      }
    }
    else if ( v41 == 2 )
    {
      for ( kk = 0; (__int16)kk < pGame->racesNum; ++kk )
      {
        v38 = (__int16)kk;
        LOWORD(ii) = pGame->races[v38].Unknown_1C7[1];
        v39 = ii + 0x14;
        LOWORD(v5) = pGame->races[v38].Unknown_1C7[2];
        pGame->races[v38].Unknown_1C7[1] = v39;
        v40 = v5 + 0x14;
        LOWORD(v39) = pGame->races[v38].Unknown_1C7[3];
        pGame->races[v38].Unknown_1C7[2] = v40;
        v39 += 0x14;
        LOWORD(v40) = pGame->races[v38].Unknown_1C7[4];
        pGame->races[v38].Unknown_1C7[3] = v39;
        v40 += 0x14;
        LOWORD(v39) = pGame->races[v38].Unknown_1C7[5];
        pGame->races[v38].Unknown_1C7[4] = v40;
        v39 += 0x14;
        LOWORD(v40) = pGame->races[v38].Unknown_1C7[6];
        pGame->races[v38].Unknown_1C7[5] = v39;
        v5 = v40 + 0x1E;
        LOWORD(v39) = pGame->races[v38].Unknown_1D5;
        pGame->races[v38].Unknown_1C7[6] = v5;
        ii = v39 - 0x14;
        pGame->races[v38].Unknown_1D5 = ii;
      }
    }
  }
  else
  {
    for ( mm = 0; (__int16)mm < pGame->racesNum; ++mm )
    {
      v30 = (__int16)mm;
      LOWORD(ii) = pGame->races[v30].Unknown_1C7[1];
      v31 = ii + 0x14;
      LOWORD(v5) = pGame->races[v30].Unknown_1C7[2];
      pGame->races[v30].Unknown_1C7[1] = v31;
      v32 = v5 + 0x14;
      LOWORD(v31) = pGame->races[v30].Unknown_1C7[3];
      pGame->races[v30].Unknown_1C7[2] = v32;
      v31 += 0x14;
      LOWORD(v32) = pGame->races[v30].Unknown_1C7[4];
      pGame->races[v30].Unknown_1C7[3] = v31;
      v32 += 0x14;
      LOWORD(v31) = pGame->races[v30].Unknown_1C7[5];
      pGame->races[v30].Unknown_1C7[4] = v32;
      v31 += 0x14;
      LOWORD(v32) = pGame->races[v30].Unknown_1C7[6];
      pGame->races[v30].Unknown_1C7[5] = v31;
      v5 = v32 + 0x1E;
      LOWORD(v31) = pGame->races[v30].Unknown_1D5;
      pGame->races[v30].Unknown_1C7[6] = v5;
      ii = v31 - 0x14;
      pGame->races[v30].Unknown_1D5 = ii;
    }
  }
  *(int *)((char *)&pGame->day + (_DWORD)&loc_306F3 + 1) = (int)pGame->races[0].star;
  *(_WORD *)((char *)&loc_3067B + (_DWORD)pGame) = 0;
  for ( nn = 0; nn < 0x6B; ++nn )
  {
    v42 = 0x162 * nn;
    *(_WORD *)((char *)&pGame->day + v42 + (_DWORD)&loc_272D8 + 3) = 0xFFFF;
    *((_BYTE *)&pGame->day + v42 + (_DWORD)&loc_272D8 + 5) = 0;
    *(int *)((char *)&pGame->day + v42 + (_DWORD)&loc_272D8 + 6) = 0;
  }
  for ( i1 = 0; i1 < pGame->racesNum; ++i1 )
  {
    if ( pGame->races[i1].Unknown_19D == 3 && i1 == byte_104BEA )
    {
      v43 = byte_104BEA ^ i1;
      v44 = pGame;
      while ( v43 < pGame->racesNum )
      {
        v45 = v44->races[0].star;
        v44 = (P_Game)((char *)v44 + 0x1EE);
        ++v43;
        v45->Unknown_17 |= 1 << i1;
      }
    }
    else
    {
      Unknown_19D = pGame->races[i1].Unknown_19D;
      if ( Unknown_19D == 0xF )
      {
        v47 = 0;
        v48 = pGame;
        while ( v47 < pGame->t15Num )
        {
          v49 = v48->t15[0].Unknown_20[0];
          v48 = (P_Game)((char *)v48 + 0x27);
          ++v47;
          HIBYTE(v48->stars[0x63].planetsNum) = (1 << i1) | v49;
        }
      }
      else if ( Unknown_19D == 4 )
      {
        v50 = 0;
        v51 = pGame;
        v53 = 0;
        while ( v50 < pGame->racesNum )
        {
          if ( i1 != v50 )
          {
            v52 = (char *)pGame + 0x1EE * i1;
            *(_WORD *)&v52[v53 + 0x1B8] = *(_WORD *)(v52 + 0x1DB);
            v52[v50 + 0x1C6] = 1;
            v51->races[0].Unknown_1B2[i1] = v51->races[0].Unknown_1D5;
            v51->races[0].Unknown_1C0[i1] = 1;
          }
          v51 = (P_Game)((char *)v51 + 0x1EE);
          ++v50;
          v53 += 2;
        }
      }
    }
  }
}
// 1E7E7: variable 'v57' is possibly undefined
// 106FB4: using guessed type __int16 word_106FB4[7];

//----- (0001EE08) --------------------------------------------------------
char __fastcall sub_1EE08(P_Game pGame, char a2)
{
  P_Game v2; // esi
  __int16 v3; // cx
  unsigned int v4; // edi
  __int16 v5; // ax
  __int16 v7; // [esp+2h] [ebp-14h]

  v2 = pGame;
  pGame->races[0].Unknown_02 = a2;
  v3 = 1;
  v4 = 0xFFFFFFFF;
  if ( pGame->racesNum > 1 )
  {
    do
    {
LABEL_4:
      while ( v4 )
      {
        v4 = 0;
        v7 = rand() % 7;
        v5 = 0;
        if ( v3 > 0 )
        {
          while ( v2->races[v5].Unknown_02 != v7 )
          {
            if ( ++v5 >= v3 )
            {
              goto LABEL_4;
            }
          }
          v4 = 0xFFFFFFFF;
        }
      }
      LOBYTE(pGame) = v7;
      v2->races[v3++].Unknown_02 = v7;
      v4 = 0xFFFFFFFF;
    }
    while ( v3 < v2->racesNum );
  }
  return (char)pGame;
}
// 1EE39: variable 'v7' is possibly undefined

//----- (0001EEA4) --------------------------------------------------------
__int16 __fastcall sub_1EEA4(P_Game a1)
{
  P_Game v1; // ebp
  int v2; // ecx
  int v3; // edi
  int v4; // edx
  __int16 Unknown_01; // si
  int v6; // esi
  char s[24]; // [esp+0h] [ebp-38h] BYREF
  int v9; // [esp+18h] [ebp-20h]
  int v10; // [esp+1Ch] [ebp-1Ch]

  v1 = a1;
  v2 = 0;
  if ( a1->racesNum > 0 )
  {
    v3 = 0xE;
    v10 = 0x15;
    v9 = 7;
    do
    {
      v4 = (__int16)v2;
      Unknown_01 = v1->races[v4].Unknown_01;
      sprintf(s, "DATA\\SMRACE%02d.SHP", v1->races[v4].Unknown_01);
      sub_1AEB0((unsigned int)&V_Type3_stru_10AE70.t13, v2, s);
      sprintf(s, "DATA\\LGRACE%02d.SHP", Unknown_01);
      sub_1AEB0((unsigned int)&V_Type3_stru_10AE70.t13, v9, s);
      sprintf(s, "DATA\\SMSHIP%02d.SHP", Unknown_01);
      sub_1AEB0((unsigned int)&V_Type3_stru_10AE70.t13, v3, s);
      ++v2;
      ++v3;
      sprintf(s, "DATA\\DKSHIP%02d.SHP", Unknown_01);
      v6 = v9;
      sub_1AEB0((unsigned int)&V_Type3_stru_10AE70.t13, v10, s);
      LOWORD(a1) = v1->racesNum;
      v9 = v6 + 1;
      ++v10;
    }
    while ( (__int16)v2 < (__int16)a1 );
  }
  return (__int16)a1;
}

//----- (0001EFC0) --------------------------------------------------------
void __fastcall sub_1EFC0(P_Game a1)
{
  int i; // eax

  memset(a1->t15, 0, sizeof(a1->t15));
  a1->t15Num = 0;
  sub_1F91C();
  a1->t10.f = 2;
  while ( a1->t10.f > 1 )
  {
    for ( i = 0; (__int16)i < a1->starsNum; ++i )
    {
      a1->stars[(__int16)i].Unknown_6 = 0xFFFF;
    }
    sub_1FB34(a1);
    sub_201D8(a1);
  }
}

//----- (0001F038) --------------------------------------------------------
unsigned int __fastcall sub_1F038(P_Game a1)
{
  int v2; // edi
  UBYTE *v3; // edx
  int i; // ecx
  int j; // eax
  int v6; // ecx
  P_Game v7; // eax
  T_Type15 *t15; // edi
  int k; // ecx
  unsigned __int8 v10; // bl
  int v11; // edx
  unsigned __int8 v12; // bh
  unsigned __int8 v13; // bh
  unsigned __int8 v14; // bh
  unsigned __int8 v15; // al
  UBYTE *v16; // eax
  UBYTE *v17; // edx
  unsigned int result; // eax
  char *v19; // ebp
  int v20; // ebx
  int v21; // edx
  char v22; // cl
  char *v23; // eax
  int v24; // edx
  char v25[1100]; // [esp+0h] [ebp-48Ch]
  int v26; // [esp+44Ch] [ebp-40h]
  UBYTE *v27; // [esp+450h] [ebp-3Ch]
  int v28; // [esp+454h] [ebp-38h]
  int v29; // [esp+458h] [ebp-34h]
  int v30; // [esp+45Ch] [ebp-30h]
  unsigned int v31; // [esp+460h] [ebp-2Ch]
  int v32; // [esp+464h] [ebp-28h]
  unsigned __int8 v33; // [esp+468h] [ebp-24h]
  unsigned __int8 v34; // [esp+46Ch] [ebp-20h]
  unsigned __int8 v35; // [esp+470h] [ebp-1Ch]

  if ( *(_WORD *)((char *)&a1->day + (_DWORD)&loc_32DCD + 4) != 1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x5BA);
  }
  v2 = (a1->starsNum - 1) * a1->starsNum;
  v27 = V_BigBuffer;
  if ( !V_BigBuffer )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x5C2);
  }
  v3 = v27;
  for ( i = 0; i < a1->starsNum; ++i )
  {
    for ( j = i + 1; j < a1->starsNum; ++j )
    {
      v3 += 2;
      v3[0xFFFFFFFF] = j;
      v3[0xFFFFFFFE] = i;
    }
  }
  if ( v3 - v27 != v2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x5D1);
  }
  memset(a1->z10000, 0xFF, sizeof(a1->z10000));
  v6 = 0;
  v30 = v2 >> 1;
  v7 = a1;
  while ( v6 < a1->starsNum )
  {
    *((_BYTE *)&loc_32DDA + (_DWORD)v7 + ++v6) = 0;
    v7 = (P_Game)((char *)v7 + 0x64);
    v25[v6 + 0x3E7] = 0;
  }
  t15 = a1->t15;
  for ( k = 0; k < a1->t15Num; ++k )
  {
    v10 = *(_BYTE *)(t15->Unknown_0 + 4);
    v35 = *(_BYTE *)(t15->Unknown_4 + 4);
    v11 = v35;
    *((_BYTE *)&a1->day + 0x64 * v10 + v35 + (_DWORD)&loc_32DDA + 1) = 1;
    *((_BYTE *)&a1->day + 0x64 * v11 + v10 + (_DWORD)&loc_32DDA + 1) = 1;
    v12 = v25[v10 + 0x3E8];
    v28 = v12;
    v25[v10 + 0x3E8] = v12 + 1;
    v13 = v25[v11 + 0x3E8];
    v25[0xA * v10 + v28] = v11;
    v28 = v13;
    v14 = v13 + 1;
    v25[v11 + 0x3E8] = v14;
    v15 = v25[v10 + 0x3E8];
    v25[0xA * v11 + v28] = v10;
    if ( v15 >= 0xAu || v14 >= 0xAu )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x5F3);
    }
    ++t15;
  }
  v16 = v27;
  v17 = &v27[2 * v30 - 2];
  if ( v17 >= v27 )
  {
    do
    {
      if ( *((_BYTE *)&a1->day + 0x64 * *v16 + v16[1] + (_DWORD)&loc_32DDA + 1) == 1 )
      {
        *v16 = *v17;
        v16[1] = v17[1];
        v17 += 0xFFFFFFFE;
        --v30;
      }
      else
      {
        v16 += 2;
      }
    }
    while ( v16 <= v17 );
  }
  result = v30;
  v26 = 2;
  if ( v30 > 0 )
  {
    v29 = 1;
    do
    {
      if ( a1->starsNum <= v26 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x610);
      }
      v19 = (char *)v27;
      result = (unsigned int)&v27[2 * v30 - 2];
      v31 = result;
      if ( (unsigned int)v27 <= result )
      {
        v32 = v29;
        do
        {
          v34 = *v19;
          v33 = v19[1];
          for ( result = 0; (__int16)result < (int)(unsigned __int8)v25[v34 + 0x3E8]; ++result )
          {
            v20 = v34;
            v21 = v33;
            if ( *((unsigned __int8 *)&a1->day
                 + 0x64 * (unsigned __int8)v25[0xA * v34 + (__int16)result]
                 + v33
                 + (_DWORD)&loc_32DDA
                 + 1) == v32 )
            {
              v22 = v26;
              *((_BYTE *)&a1->day + 0x64 * v34 + v33 + (_DWORD)&loc_32DDA + 1) = v26;
              v23 = (char *)v31;
              *((_BYTE *)&a1->day + 0x64 * v21 + v20 + (_DWORD)&loc_32DDA + 1) = v22;
              *v19 = *v23;
              v19 += 0xFFFFFFFE;
              v24 = v30;
              v19[3] = *(_BYTE *)(v31 + 1);
              result = v31 - 2;
              v30 = v24 - 1;
              v31 -= 2;
              break;
            }
          }
          v19 += 2;
        }
        while ( (unsigned int)v19 <= v31 );
      }
      ++v29;
      ++v26;
    }
    while ( v30 > 0 );
  }
  return result;
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (0001F404) --------------------------------------------------------
int __fastcall sub_1F404(P_Game a1)
{
  T_Planet *planet; // ebp
  P_Game v2; // eax
  T_Star *v3; // edx
  double v4; // st7
  int v5; // ebx
  int v6; // edx
  int v7; // edx
  WORD v8; // ax
  P_Game v9; // ecx
  UWORD v10; // ax
  P_Game v11; // edx
  double v12; // st7
  P_Game v13; // edx
  int v1; // eax
  float angle; // [esp-4h] [ebp-11Ch]
  int v16[21]; // [esp+0h] [ebp-118h] BYREF
  int v17[21]; // [esp+54h] [ebp-C4h] BYREF
  T_Vector3D vector; // [esp+A8h] [ebp-70h]
  float v19[3]; // [esp+B4h] [ebp-64h] BYREF
  T_Vector3D vec1; // [esp+C0h] [ebp-58h] BYREF
  float v21; // [esp+CCh] [ebp-4Ch]
  float *v22; // [esp+D0h] [ebp-48h]
  P_Star v23; // [esp+D4h] [ebp-44h]
  int *Unknown_49C5; // [esp+D8h] [ebp-40h]
  const char *v25; // [esp+DCh] [ebp-3Ch]
  int v26; // [esp+E0h] [ebp-38h]
  int v27; // [esp+E4h] [ebp-34h]
  float v28; // [esp+E8h] [ebp-30h]
  int j; // [esp+ECh] [ebp-2Ch]
  T_Star *stars; // [esp+F0h] [ebp-28h]
  int numPlanets; // [esp+F4h] [ebp-24h]
  int v32; // [esp+F8h] [ebp-20h]
  T_Star *v33; // [esp+FCh] [ebp-1Ch]
  int v34; // [esp+100h] [ebp-18h]
  unsigned int v35; // [esp+104h] [ebp-14h]
  int v36; // [esp+108h] [ebp-10h]
  char *name; // [esp+10Ch] [ebp-Ch]
  P_Game v38; // [esp+110h] [ebp-8h]
  int i; // [esp+114h] [ebp-4h]

  v38 = a1;
  stars = a1->stars;
  Unknown_49C5 = a1->Unknown_49C5;
  planet = a1->planets;
  j = 0;
  v23 = (P_Star)a1->stars[0].Name;
  while ( 1 )
  {
    v1 = v38->starsNum;
    if ( v1 <= j )
    {
      return v1;
    }
    numPlanets = rand() % 5 + 1;
    if ( numPlanets > 5 )
    {
      numPlanets = 5;
    }
    v36 = 0xFFFFFFFF;
    i = 0;
    v2 = v38;
    while ( v38->racesNum > i )
    {
      if ( stars == v2->races[0].star )
      {
        v36 = i;
        break;
      }
      v2 = (P_Game)((char *)v2 + 0x1EE);
      ++i;
    }
    if ( v36 >= 0 && !numPlanets )
    {
      numPlanets = 1;
    }
    v32 = 0;
    if ( v36 >= 0 )
    {
      v32 = rand() % numPlanets;
    }
    v3 = stars;
    stars->planetsNum = numPlanets;
    memset(&vec1, 0, sizeof(vec1));
    v4 = (double)word_964FA[v3->a];
    v34 = 0;
    i = 0;
    v28 = v4;
    v26 = 360 / numPlanets;
    if ( numPlanets > 0 )
    {
      v25 = (const char *)v23;
      v35 = 0;
      v33 = stars;
      v27 = (int)v38 + 0x1EE * v36;
      name = planet->name;
      do
      {
        v33->Unknown_46[0] = (int)planet;
        LOWORD(v5) = rand() % 5;
        LOWORD(v6) = rand() % 0xB;
        if ( v36 >= 0 && v32 == i )
        {
          qmemcpy(v16, dword_96548, sizeof(v16));
          qmemcpy(v17, dword_9659C, sizeof(v17));
          v7 = *(unsigned __int8 *)(v27 + 7);
          v5 = v16[v7];
          v6 = v17[v7];
        }
        planet->word1A = 0;
        planet->a = 0;
        v8 = j;
        planet->z7 = 0;
        planet->starIndex = v8;
        v9 = v38;
        planet->Unknown_E = i;
        v10 = Q_PLANET_CPP_sub_33AF0(planet, v5, v6, (int)&Unknown_49C5[v9->Word_18245]);
        v11 = v38;
        v38->Word_18245 += v10;
        if ( v11->Word_18245 > 20000 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x67B);
        }
        sprintf(name, "%s ", v25);
        Q_AppendRomanNum_sub_31E60(name, i + 1);
        v12 = ((double)word_964F0[v35 / 2] + v28) * 2000.0 * 0.011111111;
        v22 = v19;
        v21 = v12;
        vector.x = v21;
        vector.y = 0.0 * v21;
        vector.z = vector.y;
        v19[0] = v21;
        v19[1] = vector.y;
        v19[2] = vector.y;
        vec1.x = v21;
        vec1.y = vector.y;
        vec1.z = vector.y;
        angle = (float)v34;
        Q_RotateVectorY_sub_532AC(&vec1, angle);
        sub_362C8(planet, &vec1);
        if ( v36 >= 0 && v32 == i )
        {
          planet->byte57 = v36;
          planet->word42 = 2;
          sub_34AE4(planet, 5u, 0xFFFFFFFF);
        }
        ++planet;
        v33 = (T_Star *)((char *)v33 + 4);
        v35 += 2;
        ++i;
        name += 0x7B;
        v34 += v26;
      }
      while ( i < numPlanets );
    }
    v13 = v38;
    v38->planetsNum += numPlanets;
    if ( v13->planetsNum >= 0x1F4 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x697);
    }
    ++j;
    ++v23;
    ++stars;
  }
}
// 96548: using guessed type int dword_96548[21];
// 9659C: using guessed type int dword_9659C[21];

//----- (0001F91C) --------------------------------------------------------
int sub_1F91C()
{
  int result; // eax
  WORD starsNum; // di
  int v2; // edx
  int v3; // eax
  int v4; // esi
  WORD v5; // ax
  WORD v6; // dx
  float *v7; // ebx
  WORD v8; // dx
  T_Star *v9; // eax
  double v10; // st7
  int v11[3]; // [esp+14h] [ebp-48h] BYREF
  float v12; // [esp+20h] [ebp-3Ch]
  float v13; // [esp+24h] [ebp-38h]
  float v14; // [esp+28h] [ebp-34h]
  int *v15; // [esp+2Ch] [ebp-30h]
  int v16; // [esp+30h] [ebp-2Ch]
  T_Star *stars; // [esp+34h] [ebp-28h]
  int v18; // [esp+38h] [ebp-24h]
  int v19; // [esp+3Ch] [ebp-20h]
  WORD v20; // [esp+40h] [ebp-1Ch]

  memset(V_Game.z10000, 0, sizeof(V_Game.z10000));
  for ( result = 0; (__int16)result < V_Game.starsNum; ++result )
  {
    *((_BYTE *)&V_Game.day + 0x64 * (__int16)result + (__int16)result + (_DWORD)&loc_32DDA + 1) = 1;
  }
  starsNum = V_Game.starsNum;
  LOWORD(v19) = 0;
  if ( starsNum > 0 )
  {
    stars = V_Game.stars;
    do
    {
      v2 = (int)&stars[(__int16)v19];
      v3 = *(_DWORD *)v2;
      v16 = v2;
      if ( *(_WORD *)(v2 + 0x44) != word_9652E[v3] )
      {
        v4 = 0x1388;
        v5 = V_Game.starsNum;
        v6 = 0;
        v20 = 0xFFFF;
        v7 = (float *)(v16 + 8);
        if ( v5 > 0 )
        {
          do
          {
            if ( !*((_BYTE *)&V_Game.day + 0x64 * (__int16)v19 + v6 + (_DWORD)&loc_32DDA + 1) )
            {
              v9 = &stars[v6];
              if ( v9->Unknown_44 != word_9652E[v9->a] )
              {
                v15 = v11;
                v12 = 0.0;
                v13 = 0.0;
                v14 = 0.0;
                v12 = *v7 - v9->v.x;
                v13 = v7[1] - v9->v.y;
                v14 = v7[2] - v9->v.z;
                *(float *)v11 = v12;
                *(float *)&v11[1] = v13;
                *(float *)&v11[2] = v14;
                v10 = sqrt(v13 * v13 + v12 * v12 + v14 * v14);
                v18 = (int)v10;
                if ( v4 > (int)v10 )
                {
                  v4 = (int)v10;
                  v20 = v6;
                }
              }
            }
            ++v6;
          }
          while ( v6 < V_Game.starsNum );
        }
        if ( v20 != 0xFFFFFFFF && !sub_1CF68(v16, (int)&stars[v20]) )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x6D0);
        }
      }
      result = v19 + 1;
      v8 = V_Game.starsNum;
      LOWORD(v19) = result;
    }
    while ( (__int16)result < v8 );
  }
  return result;
}

//----- (0001FB34) --------------------------------------------------------
int __fastcall sub_1FB34(P_Game a1)
{
  T_Type10 *p_t10; // eax
  WORD i; // bx
  int v4; // eax
  WORD f; // dx
  T_Type09 *v6; // ecx
  int l; // ebx
  float *j; // edx
  float *v9; // eax
  double v10; // st7
  double v11; // st7
  double v12; // st7
  __int16 v13; // bx
  WORD b; // ax
  WORD g; // dx
  WORD v16; // cx
  int result; // eax
  float v18; // [esp+0h] [ebp-58h] BYREF
  float v19; // [esp+4h] [ebp-54h]
  float v20; // [esp+8h] [ebp-50h]
  float v21; // [esp+Ch] [ebp-4Ch]
  float v22; // [esp+10h] [ebp-48h]
  float v23; // [esp+14h] [ebp-44h]
  float v24; // [esp+18h] [ebp-40h] BYREF
  float v25; // [esp+1Ch] [ebp-3Ch]
  float v26; // [esp+20h] [ebp-38h]
  float v27; // [esp+24h] [ebp-34h]
  float v28; // [esp+28h] [ebp-30h]
  float v29; // [esp+2Ch] [ebp-2Ch]
  float *v30; // [esp+30h] [ebp-28h]
  float *v31; // [esp+34h] [ebp-24h]
  int v32; // [esp+38h] [ebp-20h]
  __int16 k; // [esp+3Ch] [ebp-1Ch]

  p_t10 = &a1->t10;
  p_t10->f = 0;
  memset(p_t10, 0, 0x26D0u);
  for ( i = 0; i < a1->starsNum; ++i )
  {
    v4 = i;
    if ( a1->stars[v4].Unknown_6 == 0xFFFFFFFF )
    {
      sub_1FD18(a1, (int)&a1->stars[v4]);
      ++a1->t10.f;
    }
  }
  a1->g = 0;
  f = a1->t10.f;
  k = 0;
  if ( f > 0 )
  {
    do
    {
      v6 = &a1->t10.a.a[k];
      l = 0;
      for ( j = (float *)&v6->c.c; (__int16)l < v6->b; ++l )
      {
        v9 = (float *)v6->a[(__int16)l];
        v30 = &v18;
        v21 = 0.0;
        v22 = 0.0;
        v23 = 0.0;
        v21 = *j + v9[2];
        v22 = *(float *)&v6->c.e + v9[3];
        v10 = *(float *)&v6->c.f + v9[4];
        v18 = v21;
        v23 = v10;
        v19 = v22;
        v20 = v23;
        *j = v21;
        *(float *)&v6->c.e = v19;
        *(float *)&v6->c.f = v20;
      }
      v11 = 1.0 / (double)v6->b;
      v31 = &v24;
      v27 = 0.0;
      v28 = 0.0;
      v29 = 0.0;
      v27 = *j * v11;
      v28 = *(float *)&v6->c.e * v11;
      v12 = v11 * *(float *)&v6->c.f;
      v24 = v27;
      v29 = v12;
      v25 = v28;
      v26 = v29;
      *j = v27;
      *(float *)&v6->c.e = v25;
      v13 = k;
      *(float *)&v6->c.f = v26;
      ++v13;
      b = v6->b;
      g = a1->g;
      k = v13;
      v16 = a1->t10.f;
      a1->g = b + g;
    }
    while ( v13 < v16 );
  }
  v32 = (int)((double)a1->g / (double)a1->t10.f);
  result = v32;
  a1->g = v32;
  return result;
}

//----- (0001FD18) --------------------------------------------------------
void __fastcall sub_1FD18(P_Game a1, int a2)
{
  __int16 i; // bx
  int v5; // edx
  int v6; // edx

  *(_WORD *)(a2 + 6) = a1->t10.f;
  sub_2016C(a1, a2, a1->t10.f);
  for ( i = 0; i < *(__int16 *)(a2 + 0x44); ++i )
  {
    v5 = **(_DWORD **)(a2 + 4 * i + 0x2C);
    if ( *(__int16 *)(v5 + 6) == 0xFFFFFFFF )
    {
      sub_1FD18(a1, v5);
    }
    v6 = *(_DWORD *)(*(_DWORD *)(a2 + 4 * i + 0x2C) + 4);
    if ( *(__int16 *)(v6 + 6) == 0xFFFFFFFF )
    {
      sub_1FD18(a1, v6);
    }
  }
}

//----- (0001FD90) --------------------------------------------------------
int __fastcall sub_1FD90(int a1, int a2, int a3)
{
  int v6; // eax
  WORD starsNum; // bx
  int v8; // edx

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x71E);
  }
  v6 = 0;
  if ( V_Game.starsNum > 0 )
  {
    do
    {
      starsNum = V_Game.starsNum;
      v8 = (__int16)v6++;
      *(_BYTE *)(v8 + a2) = 0;
    }
    while ( (__int16)v6 < starsNum );
  }
  return sub_1FDF0(a1, *(_DWORD *)(a1 + 0x1EE * a3 + 0xD), a2, a3);
}

//----- (0001FDF0) --------------------------------------------------------
int __fastcall sub_1FDF0(int a1, int a2, int a3, int a4)
{
  int result; // eax
  int v5; // esi
  _BYTE *v6; // ebp
  WORD v7; // dx
  __int16 j; // bx
  int raceIndex; // eax
  int v11; // [esp+4h] [ebp-24h]
  WORD i; // [esp+14h] [ebp-14h]
  __int16 v15; // [esp+14h] [ebp-14h]
  char v16; // [esp+18h] [ebp-10h]

  v16 = 0;
  for ( i = 0; i < V_Game.racesNum; ++i )
  {
    if ( *(_BYTE *)(0x1EE * a4 + a1 + i + 0x1C6) == 3 )
    {
      v16 |= 1 << i;
    }
  }
  v15 = 0;
  result = a2;
  if ( *(__int16 *)(a2 + 0x44) > 0 )
  {
    v11 = 1 << a4;
    do
    {
      v5 = *(_DWORD *)(a2 + 4 * v15 + 0x2C);
      result = *(__int16 *)(v5 + 0x21);
      if ( result != a4 )
      {
        if ( *(_DWORD *)v5 == a2 )
        {
          v6 = *(_BYTE **)(v5 + 4);
        }
        else
        {
          v6 = *(_BYTE **)v5;
        }
        if ( ((unsigned __int8)v11 & v6[0x17]) != 0 )
        {
          if ( (~v11 & ((unsigned __int8)(v6[0x15] & ~v16) | (unsigned __int8)(~v16 & v6[0x14])) & 0x7F) != 0 )
          {
            result = a3 + *(__int16 *)(a2 + 4);
            ++*(_BYTE *)result;
          }
          else
          {
            v7 = 0;
            for ( j = 0; j < 0x6B; ++j )
            {
              if ( v7 >= V_Game.shipsNum )
              {
                break;
              }
              raceIndex = V_Game.ships[j].raceIndex;
              if ( raceIndex != 0xFFFFFFFF )
              {
                ++v7;
                if ( v5 == V_Game.ships[j].Unknown_59
                  && raceIndex != a4
                  && *(_BYTE *)(0x1EE * a4 + a1 + raceIndex + 0x1C6) != 3 )
                {
                  break;
                }
              }
            }
            if ( v7 < V_Game.shipsNum )
            {
              result = a3 + *(__int16 *)(a2 + 4);
              ++*(_BYTE *)result;
            }
            else
            {
              *(_WORD *)(v5 + 0x21) = a4;
              result = sub_1FDF0(a1, (int)v6, a3, a4);
            }
          }
        }
        else
        {
          result = a3 + *(__int16 *)(a2 + 4);
          ++*(_BYTE *)result;
        }
      }
      ++v15;
    }
    while ( v15 < *(__int16 *)(a2 + 0x44) );
  }
  return result;
}

//----- (0001FFE0) --------------------------------------------------------
int __fastcall sub_1FFE0(int a1, int a2)
{
  int result; // eax
  _BYTE *v4; // edi
  WORD v5; // dx
  __int16 k; // bx
  int v7; // esi
  WORD i; // [esp+4h] [ebp-1Ch]
  __int16 j; // [esp+4h] [ebp-1Ch]
  char v11; // [esp+8h] [ebp-18h]

  v11 = 0;
  for ( i = 0; i < V_Game.racesNum; ++i )
  {
    if ( V_Game.races[byte_104BEA].Unknown_1C0[i] == 3 )
    {
      v11 |= 1 << i;
    }
  }
  result = a2;
  for ( j = 0; j < *(__int16 *)(a2 + 0x44); ++j )
  {
    result = a2 + 4 * j;
    v7 = *(_DWORD *)(result + 0x2C);
    if ( !*(_WORD *)(v7 + 0x21) )
    {
      v4 = *(_DWORD *)v7 == a2 ? *(_BYTE **)(v7 + 4) : *(_BYTE **)v7;
      result = (unsigned __int8)v4[0x17];
      if ( ((1 << byte_104BEA) & result) != 0 )
      {
        result = ((unsigned __int8)(v4[0x15] & ~v11) | (unsigned __int8)(~v11 & v4[0x14])) & 0x7F;
        if ( (~(1 << byte_104BEA) & result) == 0 )
        {
          v5 = 0;
          for ( k = 0; ; ++k )
          {
            result = k;
            if ( k >= 0x6B )
            {
              break;
            }
            if ( v5 >= V_Game.shipsNum )
            {
              break;
            }
            result = V_Game.ships[k].raceIndex;
            if ( result != 0xFFFFFFFF )
            {
              ++v5;
              if ( v7 == V_Game.ships[k].Unknown_59
                && result != byte_104BEA
                && V_Game.races[byte_104BEA].Unknown_1C0[result] != 3 )
              {
                break;
              }
            }
          }
          if ( v5 >= V_Game.shipsNum )
          {
            *(_WORD *)(v7 + 0x21) = 1;
            ++*(_DWORD *)(a1 + 0x354EB);
            result = sub_1FFE0(a1, (int)v4);
          }
        }
      }
    }
  }
  return result;
}

//----- (0002016C) --------------------------------------------------------
void __fastcall sub_2016C(P_Game a1, int a2, __int16 a3)
{
  T_Type09 *v3; // ecx

  if ( a3 >= 24 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x7BB);
  }
  v3 = &a1->t10.a.a[a3];
  if ( v3->b >= 100 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x7BE);
  }
  v3->a[v3->b++] = a2;
}

//----- (000201D8) --------------------------------------------------------
void __fastcall sub_201D8(P_Game a1)
{
  __int16 *v1; // ecx
  __int16 f; // si
  __int16 *v3; // esi
  __int16 v4; // dx
  int v5; // eax
  int v6; // edi
  int v7; // eax
  int v8; // ebx
  __int16 i; // dx
  T_Type09 *v10; // ebx
  double v11; // st7
  __int16 j; // bx
  int v13; // edx
  double v14; // st7
  int v15; // eax
  T_Type15 *v16; // eax
  int v17; // eax
  float v18; // [esp+8h] [ebp-88h]
  int v19; // [esp+Ch] [ebp-84h]
  int v20; // [esp+10h] [ebp-80h]
  float v21; // [esp+14h] [ebp-7Ch]
  int v22; // [esp+18h] [ebp-78h]
  int v23; // [esp+1Ch] [ebp-74h]
  int v24[3]; // [esp+20h] [ebp-70h] BYREF
  int v25[3]; // [esp+2Ch] [ebp-64h] BYREF
  float v26; // [esp+38h] [ebp-58h]
  int v27; // [esp+3Ch] [ebp-54h]
  int v28; // [esp+40h] [ebp-50h]
  int v29; // [esp+44h] [ebp-4Ch]
  int *v30; // [esp+48h] [ebp-48h]
  int *v31; // [esp+4Ch] [ebp-44h]
  T_Type10 *p_t10; // [esp+50h] [ebp-40h]
  int assert; // [esp+54h] [ebp-3Ch]
  int v34; // [esp+58h] [ebp-38h]
  int v35; // [esp+5Ch] [ebp-34h]
  P_Game v36; // [esp+60h] [ebp-30h]
  int v37; // [esp+64h] [ebp-2Ch]
  int v38; // [esp+68h] [ebp-28h]
  int v39; // [esp+6Ch] [ebp-24h]
  __int16 v40; // [esp+70h] [ebp-20h]
  WORD k; // [esp+74h] [ebp-1Ch]

  v36 = a1;
  v1 = 0;
  v26 = 0.0;
  v27 = 0;
  v28 = 0;
  if ( !a1->t10.f )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x7DD);
  }
  if ( v36->t10.f != 1 )
  {
    f = v36->t10.f;
    k = 0;
    if ( f > 0 )
    {
      p_t10 = &v36->t10;
      do
      {
        v3 = (__int16 *)&p_t10->a.a[k];
        v4 = 0;
        v34 = 99999;
        v35 = 99999;
        assert = 0;
        v5 = (unsigned __int16)v3[0xC8];
        v40 = 0;
        v6 = 0;
        if ( (__int16)v5 > 0 )
        {
          do
          {
            v7 = *(_DWORD *)&v3[2 * v4];
            v8 = *(_DWORD *)v7;
            v29 = word_9652E[v8];
            v39 = *(__int16 *)(v7 + 0x44);
            v29 -= v39;
            v39 = v40;
            if ( v29 > v40 )
            {
              v6 = v7;
              v40 = word_9652E[v8] - *(_WORD *)(v7 + 0x44);
            }
            ++v4;
          }
          while ( v4 < v3[0xC8] );
        }
        if ( !v6 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x7FF);
        }
        for ( i = 0; i < *(__int16 *)((char *)&v36->day + (_DWORD)&loc_32DCD + 4); ++i )
        {
          if ( i != k )
          {
            v10 = &p_t10->a.a[i];
            v31 = v24;
            v18 = *(float *)(v6 + 8) - *(float *)&v10->c.c;
            *(float *)&v19 = *(float *)(v6 + 0xC) - *(float *)&v10->c.e;
            *(float *)&v20 = *(float *)(v6 + 0x10) - *(float *)&v10->c.f;
            *(float *)v24 = v18;
            v24[1] = v19;
            v24[2] = v20;
            v26 = v18;
            v27 = v19;
            v28 = v20;
            v11 = sqrt(*(float *)&v19 * *(float *)&v19 + v18 * v18 + *(float *)&v20 * *(float *)&v20);
            v38 = (int)v11;
            if ( (int)v11 < v34 )
            {
              v1 = (__int16 *)v10;
              v34 = (int)v11;
            }
          }
        }
        if ( !v1 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x813);
        }
        for ( j = 0; j < v1[0xC8]; ++j )
        {
          v13 = *(_DWORD *)&v1[2 * j];
          if ( !*((_BYTE *)&v36->day + 0x64 * *(__int16 *)(v6 + 4) + *(__int16 *)(v13 + 4) + (_DWORD)&loc_32DDA + 1) )
          {
            v30 = v25;
            v21 = *(float *)(v6 + 8) - *(float *)(v13 + 8);
            *(float *)&v22 = *(float *)(v6 + 0xC) - *(float *)(v13 + 0xC);
            *(float *)&v23 = *(float *)(v6 + 0x10) - *(float *)(v13 + 0x10);
            *(float *)v25 = v21;
            v25[1] = v22;
            v25[2] = v23;
            v26 = v21;
            v27 = v22;
            v28 = v23;
            v14 = sqrt(*(float *)&v22 * *(float *)&v22 + v21 * v21 + *(float *)&v23 * *(float *)&v23);
            v39 = word_9652E[*(_DWORD *)v13];
            v15 = *(__int16 *)(v13 + 0x44);
            v37 = (int)v14;
            if ( v39 != v15 && v37 < v35 )
            {
              assert = v13;
              v35 = v37;
            }
          }
        }
        if ( !assert )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x82C);
        }
        v16 = sub_1CF68(v6, assert);
        if ( !v16 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x832);
        }
        v16->Unknown_20[3] |= 1u;
        v17 = assert;
        *(_BYTE *)(v6 + 0x18) |= 1u;
        *(_BYTE *)(v17 + 0x18) |= 1u;
        ++k;
      }
      while ( k < v36->t10.f );
    }
  }
}

//----- (000205A0) --------------------------------------------------------
T_Type15 *__fastcall sub_205A0(P_Game a1, int a2, int a3)
{
  int t15Num; // ebx
  T_Type15 *v6; // edx

  if ( !a2 || !a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x83F);
  }
  t15Num = a1->t15Num;
  if ( t15Num == 0x94
    || *((_BYTE *)&a1->day + 0x64 * *(__int16 *)(a2 + 4) + *(__int16 *)(a3 + 4) + (_DWORD)&loc_32DDA + 1) )
  {
    return 0;
  }
  v6 = &a1->t15[t15Num];
  v6->Unknown_20[0] = 0;
  v6->Unknown_0 = a2;
  v6->Unknown_4 = a3;
  ++a1->t15Num;
  *((_BYTE *)&a1->day + 0x64 * *(__int16 *)(a2 + 4) + *(__int16 *)(a3 + 4) + (_DWORD)&loc_32DDA + 1) = 1;
  *((_BYTE *)&a1->day + 0x64 * *(__int16 *)(a3 + 4) + *(__int16 *)(a2 + 4) + (_DWORD)&loc_32DDA + 1) = 1;
  return v6;
}

//----- (00020684) --------------------------------------------------------
T_Ship *__fastcall sub_20684(int a1, __int16 a2)
{
  T_Ship *v4; // ebx
  __int16 i; // dx
  T_Ship *result; // eax

  if ( a2 < 0 || a2 >= *(__int16 *)(a1 + 0xD88) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x863);
  }
  if ( *(__int16 *)(a1 + 0x3067B) >= 0x6B )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x864);
  }
  v4 = (T_Ship *)((char *)&loc_27281 + a1 + 4);
  for ( i = 0; i < 0x6B; ++i )
  {
    if ( v4->raceIndex == 0xFFFFFFFF )
    {
      sub_48C5C(v4, 0);
      v4->raceIndex = a2;
      result = v4;
      ++*(_WORD *)((char *)&loc_3067B + a1);
      return result;
    }
    ++v4;
  }
  Q_AssertLogBreakExit_sub_261A8(0, "..\\cosmos.cpp", 0x873);
  return 0;
}

//----- (00020720) --------------------------------------------------------
__int16 __fastcall sub_20720(int a1, int a2)
{
  __int16 result; // ax

  if ( *(__int16 *)(a2 + 0x56) < 0 || (result = *(_WORD *)(a2 + 0x56), result >= *(__int16 *)(a1 + 0xD88)) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x87E);
  }
  if ( !*(_BYTE *)(a2 + 0x58) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x87F);
  }
  *(_WORD *)(a2 + 0x56) = 0xFFFF;
  *(_BYTE *)(a2 + 0x58) = 0;
  *(_BYTE *)(a2 + 0x34) = 0;
  --*(_WORD *)((char *)&loc_3067B + a1);
  if ( *(__int16 *)(a1 + 0x3067B) < 0 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x887);
  }
  return result;
}

//----- (000207A0) --------------------------------------------------------
char __fastcall sub_207A0(int a1)
{
  int i; // eax
  int v3; // ebp
  int v4; // edx
  int v5; // edx
  int v6; // ebx
  int v7; // edx
  int v8; // edx
  int v9; // eax
  int v10; // edx
  int v11; // ecx
  int j; // eax
  int v13; // edx
  int v14; // eax
  int v15; // ecx
  int v16; // edx
  int k; // eax
  char v18; // bl
  int v19; // edx
  int v20; // eax
  char v21; // ch
  double v22; // st6
  int v24; // [esp+8h] [ebp-24h]
  size_t v25; // [esp+8h] [ebp-24h]
  int v26; // [esp+8h] [ebp-24h]
  unsigned __int8 v27; // [esp+Ch] [ebp-20h]
  char v28; // [esp+10h] [ebp-1Ch]

  v28 = 0;
  i = 0x1EE * byte_104BEA;
  v3 = i + a1 + 6;
  if ( *(_DWORD *)(v3 + 3) == 0xFFFFFFFF )
  {
    v28 = 1;
  }
  if ( !v28 )
  {
    v4 = a1;
    i = 0;
    v28 = 2;
    while ( i < *(__int16 *)(a1 + 0xD88) )
    {
      if ( i != byte_104BEA && !*(_DWORD *)(v4 + 9) )
      {
        v28 = 0;
        break;
      }
      v4 += 0x1EE;
      ++i;
    }
  }
  if ( !v28 )
  {
    v5 = a1;
    i = 0;
    v28 = 3;
    while ( i < *(__int16 *)(a1 + 0xD88) )
    {
      if ( (*(_BYTE *)(*(_DWORD *)(v5 + 0xD) + 0x14) & 0x7F) != 1 << byte_104BEA )
      {
        LOBYTE(i) = 0;
        v28 = 0;
        break;
      }
      v5 += 0x1EE;
      ++i;
    }
  }
  if ( !v28 )
  {
    v27 = 0;
    v6 = v3;
    v28 = 4;
    i = 0;
    v7 = a1;
    while ( i < *(__int16 *)(a1 + 0xD88) )
    {
      if ( !*(_DWORD *)(v7 + 9) )
      {
        v27 |= 1 << i;
      }
      if ( i != byte_104BEA && !*(_DWORD *)(v7 + 9) && *(_BYTE *)(v6 + 0x1C0) != 3 )
      {
        v28 = 0;
        break;
      }
      v7 += 0x1EE;
      ++v6;
      ++i;
    }
    if ( v28 == 4 )
    {
      v8 = a1;
      for ( i = 0; i < *(__int16 *)(a1 + 0x3335); ++i )
      {
        if ( (v27 & *(_BYTE *)(v8 + 0xDCC)) == 0 )
        {
          v28 = 0;
          break;
        }
        v8 += 0x60;
      }
    }
  }
  if ( !v28 )
  {
    i = 2 * *(__int16 *)(a1 + 0x3335) / 3 + 1;
    if ( i <= *(_DWORD *)(a1 + 0x354EB) )
    {
      v28 = 5;
    }
  }
  if ( v28 )
  {
    v9 = 0;
    v10 = 0;
    v24 = 0;
    while ( v10 < (unsigned __int16)V_ResTree.num )
    {
      if ( ((1 << byte_104BEA) & (char)V_ResTree.items[v9].z2[0]) != 0 )
      {
        ++v24;
      }
      ++v9;
      ++v10;
    }
    v11 = a1;
    for ( j = 0; j < *(__int16 *)((char *)&loc_27281 + a1 + 2); ++j )
    {
      if ( byte_104BEA == *((_BYTE *)&loc_1829D + v11 + 1) )
      {
        v24 += 2;
      }
      v11 += 0x7B;
    }
    v13 = 0;
    v25 = sub_40224((unsigned __int8 *)v3, 0, 0) + v24;
    v14 = a1;
    while ( v13 < *(__int16 *)(a1 + 0x3335) )
    {
      if ( ((1 << byte_104BEA) & *(unsigned __int8 *)(v14 + 0xDCC)) != 0 )
      {
        ++v25;
      }
      v14 += 0x60;
      ++v13;
    }
    v15 = a1;
    v16 = v3;
    for ( k = 0; k < *(__int16 *)(a1 + 0xD88); ++k )
    {
      if ( k != byte_104BEA && *(_DWORD *)(v15 + 9) != 0xFFFFFFFF )
      {
        v18 = *(_BYTE *)(v16 + 0x1C0);
        if ( v18 == 3 )
        {
          v25 += 0xF;
        }
        else if ( v18 == 2 )
        {
          v25 -= 0xA;
        }
      }
      v15 += 0x1EE;
      ++v16;
    }
    if ( v28 == 4 )
    {
      v25 += 0x32;
    }
    v19 = 0x64 - 0x4B * *(_DWORD *)a1 / 0xFA0;
    v20 = v19;
    if ( v19 >= 0x19 )
    {
      if ( v19 > 0x64 )
      {
        v20 = 0x64;
      }
    }
    else
    {
      v20 = 0x19;
    }
    v21 = *(_BYTE *)(a1 + 0xDB4);
    v26 = (int)(v20 * v25) / 0x64;
    if ( v21 == 1 )
    {
      v22 = (double)v26 * dbl_90D76;
    }
    else
    {
      if ( v21 != 2 )
      {
LABEL_71:
        if ( v26 < 0 )
        {
          v26 = 0;
        }
        *((_BYTE *)&loc_30700 + a1) = v28;
        *(_DWORD *)(a1 + 0x306FC) = 0x64 * v26 / 0x258;
        *(_WORD *)&V_Type3_stru_10AE70.z2[0x24] = 0;
        LOBYTE(i) = sub_56B60(&V_Type3_stru_10AE70, 1, 9, 1);
        return i;
      }
      v22 = (double)v26 * dbl_90D6E;
    }
    v26 = (int)v22;
    goto LABEL_71;
  }
  return i;
}
// 90D6E: using guessed type double dbl_90D6E;
// 90D76: using guessed type double dbl_90D76;

//----- (00020B3C) --------------------------------------------------------
int __fastcall sub_20B3C(int a1)
{
  int v2; // esi
  int i; // eax
  __int16 j; // di
  int v5; // ecx
  __int16 k; // ax
  int v7; // edx
  int v9[107]; // [esp+0h] [ebp-1CCh] BYREF
  unsigned __int8 v10; // [esp+1ACh] [ebp-20h]
  unsigned __int8 v11; // [esp+1B0h] [ebp-1Ch]

  v11 = 1 << byte_104BEA;
  v2 = a1 + 0xDB5;
  v10 = sub_43374(&V_Game.races[byte_104BEA].Unknown_00, 0xFFFFFFFF);
  if ( !*(_WORD *)(a1 + 4) )
  {
    for ( i = 0; (__int16)i < *(__int16 *)(a1 + 0x3335); ++i )
    {
      byte_D8460[(__int16)i] &= ~1u;
    }
  }
  for ( j = 0; j < *(__int16 *)(a1 + 0x3335); v2 += 0x60 )
  {
    if ( (byte_D8460[j] & 1) == 0 )
    {
      byte_D8460[j] |= 1u;
      if ( (v11 & *(_BYTE *)(v2 + 0x15)) != 0 && (v10 & *(_BYTE *)(v2 + 0x15)) != 0 )
      {
        v5 = sub_1D794((__int16 *)v2, v9);
        for ( k = 0; k < v5; ++k )
        {
          v7 = *(__int16 *)(v9[k] + 0x56);
          if ( (v7 == byte_104BEA || V_Game.races[byte_104BEA].Unknown_1C0[v7] == 2) && *(int *)(v9[k] + 0x88) > 0 )
          {
            ++*(_WORD *)(a1 + 4);
            return v2;
          }
        }
      }
    }
    ++j;
  }
  return 0;
}
// 20B3C: using guessed type int var_1CC[107];

//----- (00020C94) --------------------------------------------------------
char __fastcall sub_20C94(int a1, int a2, int a3, T_TypeA1 *a4)
{
  unsigned __int8 v5; // cl
  int v6; // edx
  int v7; // eax
  int v8; // eax
  T_TypeA1 *v9; // eax
  int v10; // edx
  T_Planet *v11; // esi
  int v12; // edx
  int v13; // esi
  T_Star *stars; // esi
  int v15; // ebx
  WORD v16; // dx
  __int16 i; // cx
  __int16 v18; // dx
  int v19; // eax
  int v20; // edx
  int j; // eax
  int v22; // eax
  char v23; // ch
  int v25; // [esp-10h] [ebp-1E8h]
  int v26; // [esp-Ch] [ebp-1E4h]
  int Unknown_15; // [esp-8h] [ebp-1E0h]
  int v28; // [esp-4h] [ebp-1DCh]
  int v29[107]; // [esp+0h] [ebp-1D8h] BYREF
  FILE *fp; // [esp+1ACh] [ebp-2Ch]
  char *Name; // [esp+1B0h] [ebp-28h]
  char *v32; // [esp+1B4h] [ebp-24h]
  char *v33; // [esp+1B8h] [ebp-20h]
  int v34; // [esp+1BCh] [ebp-1Ch]

  if ( V_FlashPopExists_dword_A0D00 == 0xFFFFFFFF && *(int *)a1 >= 0x1388 )
  {
    v5 = rand() % 0x15;
    v6 = rand() % 5 + 3;
    v7 = rand();
    sub_1E10C((P_Game)a1, v7 % 0x4C + 0x19, v6, v5);
    sub_1F038((P_Game)a1);
    sub_1F404((P_Game)a1);
    sub_1EEA4((P_Game)a1);
    v8 = rand();
    sub_1EE08((P_Game)a1, v8 % 6);
    *(_DWORD *)a1 = 0;
    v9 = sub_56E18(&V_Type3_stru_10AE70, "RACECONTROLS", 1, 0);
    a4 = v9;
    if ( !v9 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0x9B7);
    }
    (*(void (__fastcall **)(T_TypeA1 *, _DWORD))(v9[1].magic12345678 + 0xC))(v9, 0);
  }
  *(_WORD *)(a1 + 4) = 0;
  memset(byte_D8460, 0, sizeof(byte_D8460));
  sub_21170(a1);
  sub_21314(a1);
  v10 = 0;
  sub_466FC((unsigned int)&V_ResTree);
  v11 = (T_Planet *)((char *)&loc_18247 + a1);
  while ( v10 < *(__int16 *)((char *)&loc_27281 + a1 + 2) )
  {
    sub_352E0(v11);
    ++v10;
    ++v11;
  }
  sub_2106C(a1);
  v12 = 0;
  v13 = a1 + 6;
  while ( v12 < *(__int16 *)(a1 + 0xD88) )
  {
    if ( v12 != byte_104BEA )
    {
      sub_3B220(v13, v12, 0x64, (int)a4);
    }
    v13 += 0x1EE;
    ++v12;
  }
  sub_3B220((int)&V_Game.races[byte_104BEA], byte_104BEA, 0x64, (int)a4);
  if ( V_NougatLfExists_dword_A0CFC == 0xFFFFFFFF )
  {
    stars = V_Game.stars;
    fp = fopen("numships.dbg", "at");
    v34 = 0;
    if ( V_Game.starsNum > 0 )
    {
      Name = V_Game.stars[0].Name;
      do
      {
        v15 = sub_1D794((__int16 *)stars, v29);
        v16 = 0;
        if ( V_Game.racesNum > 0 )
        {
          v33 = Name;
          do
          {
            if ( ((1 << v16) & (unsigned __int8)stars->Unknown_15) != 0 )
            {
              for ( i = 0; i < v15 && v16 != *(_WORD *)(v29[i] + 0x56); ++i )
              {
                ;
              }
              if ( i >= v15 )
              {
                Unknown_15 = (unsigned __int8)stars->Unknown_15;
                ++word_D845C;
                fprintf(
                  fp,
                  "T%04d: %s flags (%d) show R%d ship, but none found.\n",
                  *(_DWORD *)a1 + 1,
                  v33,
                  Unknown_15,
                  v16);
              }
            }
            ++v16;
          }
          while ( v16 < V_Game.racesNum );
        }
        v18 = 0;
        v32 = Name;
        while ( v18 < v15 )
        {
          v19 = v29[v18];
          if ( *(_BYTE *)(v19 + 0x58) != 1 && ((1 << *(_WORD *)(v19 + 0x56)) & (unsigned __int8)stars->Unknown_15) == 0 )
          {
            v28 = (unsigned __int8)stars->Unknown_15;
            v26 = *(__int16 *)(v19 + 0x56);
            v25 = *(_DWORD *)a1 + 1;
            ++word_D845C;
            fprintf(fp, "T%04d: R%d ship exists at %s, flags (%d) indicate otherwise.\n", v25, v26, v32, v28);
          }
          ++v18;
        }
        ++stars;
        Name += 0x60;
        ++v34;
      }
      while ( (__int16)v34 < V_Game.starsNum );
    }
    fclose(fp);
  }
  v20 = a1 + 0x3337;
  for ( j = 0; (__int16)j < V_Game.t15Num; v20 += 0x27 )
  {
    *(_WORD *)(v20 + 0x21) = 0;
    ++j;
  }
  v22 = 0x1EE * byte_104BEA;
  if ( ((1 << byte_104BEA) & *(unsigned __int8 *)(*(_DWORD *)&V_Game.races[0].z[v22 + 4] + 0x14)) != 0 )
  {
    *(_DWORD *)(a1 + 0x354EB) = 1;
    LOBYTE(v22) = sub_1FFE0(a1, *(_DWORD *)&V_Game.races[0].z[v22 + 4]);
  }
  else
  {
    *(_DWORD *)(a1 + 0x354EB) = 0;
  }
  v23 = *((_BYTE *)&loc_30700 + a1);
  ++*(_DWORD *)a1;
  if ( !v23 && !V_FlashPopExists_dword_A0D00 )
  {
    LOBYTE(v22) = sub_207A0(a1);
  }
  return v22;
}
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;
// D845C: using guessed type __int16 word_D845C;
// 20C94: using guessed type int var_1D8[107];

//----- (0002106C) --------------------------------------------------------
int __fastcall sub_2106C(int result)
{
  int v1; // edi
  WORD i; // si
  int v3; // edx
  WORD j; // si
  __int16 v5; // bx
  WORD k; // ax
  size_t v7; // [esp+0h] [ebp-20h] BYREF
  __int16 v8; // [esp+4h] [ebp-1Ch]

  v1 = result;
  for ( i = 0; i < V_Game.racesNum; ++i )
  {
    v3 = 6 * i;
    v7 = sub_40224(&V_Game.races[i].Unknown_00, 0, &v7);
    *(_WORD *)(v3 + v1 + 0xD8C) = v7;
    result = sub_402E0(&V_Game.races[i].Unknown_00);
    *(_WORD *)(v3 + v1 + 0xD8E) = result;
  }
  for ( j = 0; j < V_Game.racesNum; ++j )
  {
    v8 = *(_WORD *)(v1 + 6 * j + 0xD8E) + *(_WORD *)(v1 + 6 * j + 0xD8C);
    v5 = 0;
    for ( k = 0; k < V_Game.racesNum; ++k )
    {
      if ( j != k && *(__int16 *)(6 * k + v1 + 0xD8C) + *(__int16 *)(6 * k + v1 + 0xD8E) > v8 )
      {
        ++v5;
      }
    }
    result = 6 * j;
    *(_WORD *)(v1 + result + 0xD8A) = v5;
  }
  return result;
}

//----- (00021170) --------------------------------------------------------
void __fastcall sub_21170(int a1)
{
  int v2; // esi
  int i; // ecx
  unsigned __int8 v4; // al
  unsigned __int8 v5; // [esp+0h] [ebp-18h]

  v2 = a1 + 0xDB5;
  v5 = 1 << byte_104BEA;
  for ( i = 0; (__int16)i < *(__int16 *)(a1 + 0x3335); v2 += 0x60 )
  {
    v4 = *(_BYTE *)(v2 + 0x14) | *(_BYTE *)(v2 + 0x15);
    *(_DWORD *)(v2 + 0x5C) = 0;
    if ( (v4 & v5) == 0 )
    {
      if ( v4 )
      {
        sub_211EC(a1, v2, 0);
      }
      *(_DWORD *)(v2 + 0x5C) = 0xFFFFFFFF;
    }
    ++i;
  }
}

//----- (000211EC) --------------------------------------------------------
void __fastcall sub_211EC(int a1, int a2, int a3)
{
  __int16 v6; // cx
  __int16 v7; // ax
  int v8; // ebx
  int v9; // ebp
  int v10; // edi
  __int16 v11; // cx
  __int16 v12[8]; // [esp+2h] [ebp-2Ch]
  unsigned __int8 v13; // [esp+12h] [ebp-1Ch] BYREF
  T_Planet *v14; // [esp+13h] [ebp-1Bh]
  int v15; // [esp+1Ah] [ebp-14h]

  if ( V_FlashPopExists_dword_A0D00 == 0xFFFFFFFF )
  {
    a3 = V_FlashPopExists_dword_A0D00;
  }
  v6 = *(_WORD *)(a1 + 0xD88);
  v7 = 0;
  LOWORD(v15) = 0;
  if ( v6 > 0 )
  {
    do
    {
      if ( a3 || (a3 = 0, v7 != byte_104BEA) )
      {
        if ( ((unsigned __int8)(*(_BYTE *)(a2 + 0x15) | *(_BYTE *)(a2 + 0x14)) & (unsigned __int8)(1 << v7)) != 0 )
        {
          v8 = (__int16)v15;
          LOWORD(v15) = v15 + 1;
          v12[v8] = v7;
        }
      }
      ++v7;
    }
    while ( v7 < *(__int16 *)(a1 + 0xD88) );
  }
  if ( (_WORD)v15 )
  {
    v9 = a1 + 6;
    while ( 1 )
    {
      v10 = 0;
      v11 = 0;
      if ( (__int16)v15 > 0 )
      {
        break;
      }
LABEL_15:
      if ( !v10 )
      {
        return;
      }
    }
    while ( 1 )
    {
      v13 = 0;
      v10 |= sub_406C4((unsigned __int8 *)(v9 + 0x1EE * v12[v11]), (__int16 *)a2, (int)&v13);
      if ( !v13 )
      {
        goto LABEL_14;
      }
      if ( v13 < 2u )
      {
        break;
      }
      if ( v13 <= 2u )
      {
        sub_3676C(v14, 1);
      }
      else
      {
        if ( v13 != 3 )
        {
          break;
        }
        sub_49B3C((int)v14, 1);
      }
LABEL_14:
      if ( ++v11 >= (__int16)v15 )
      {
        goto LABEL_15;
      }
    }
    Q_AssertLogBreakExit_sub_261A8(0, "..\\cosmos.cpp", 0xAE2);
    goto LABEL_14;
  }
}
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;
// 211EC: using guessed type __int16 var_2C[8];

//----- (00021314) --------------------------------------------------------
void __fastcall sub_21314(int a1)
{
  int v2; // ecx
  int i; // edi

  v2 = a1 + 0xDB5;
  for ( i = 0; (__int16)i < *(__int16 *)(a1 + 0x3335); v2 += 0x60 )
  {
    if ( *(_DWORD *)(v2 + 0x5C) != 0xFFFFFFFF )
    {
      if ( *(unsigned __int8 *)(v2 + 0x14) | *(unsigned __int8 *)(v2 + 0x15) )
      {
        sub_211EC(a1, v2, 0xFFFFFFFF);
      }
      *(_DWORD *)(v2 + 0x5C) = 0xFFFFFFFF;
    }
    ++i;
  }
}

//----- (00021374) --------------------------------------------------------
void __fastcall Q_SaveGam_sub_21374(P_Game pGame, P_FileInfo pfi)
{
  WORD j; // cx
  T_Star *pStar; // esi
  WORD v4; // cx
  T_Planet *planets; // esi
  __int16 kk; // si
  __int16 k; // cx
  P_Ship vpShips; // edi
  char *v9; // eax
  WORD l; // cx
  T_Race *races; // esi
  WORD m; // cx
  T_Type15 *pt15; // esi
  __int16 v14; // si
  __int16 i; // ax
  __int16 v16; // di
  __int16 v17; // bx
  WORD v18; // cx
  T_Sector *sectors; // esi
  T_Type09 v20; // [esp+0h] [ebp-238h] BYREF
  T_Type15 v21; // [esp+1A0h] [ebp-98h] BYREF
  T_SavBlock1Sizes v22; // [esp+1C8h] [ebp-70h] BYREF
  P_Game vpGame; // [esp+1E8h] [ebp-50h]
  int day; // [esp+1ECh] [ebp-4Ch] BYREF
  int v25; // [esp+1F0h] [ebp-48h] BYREF
  int v26; // [esp+1F4h] [ebp-44h] BYREF
  int z7; // [esp+1F8h] [ebp-40h] BYREF
  int aa2; // [esp+1FCh] [ebp-3Ch] BYREF
  int v29; // [esp+200h] [ebp-38h] BYREF
  int v30; // [esp+204h] [ebp-34h] BYREF
  int v31; // [esp+208h] [ebp-30h] BYREF
  int starsNum; // [esp+20Ch] [ebp-2Ch] BYREF
  int Word_18245; // [esp+210h] [ebp-28h] BYREF
  int planetsNum; // [esp+214h] [ebp-24h] BYREF
  int shipsNum; // [esp+218h] [ebp-20h] BYREF
  int v36; // [esp+21Ch] [ebp-1Ch] BYREF
  int racesNum; // [esp+220h] [ebp-18h] BYREF
  int t15Num; // [esp+224h] [ebp-14h] BYREF
  int f; // [esp+228h] [ebp-10h] BYREF
  int sectorsNum; // [esp+22Ch] [ebp-Ch] BYREF
  T_Type10 *p_t10; // [esp+230h] [ebp-8h]
  __int16 v42; // [esp+234h] [ebp-4h]

  vpGame = pGame;
  // Block 1 - Sizes
  v22.sizeResTree = 0x1D72;
  v22.sizeStar = 0x60;
  v22.sizePlanet = 0x7B;
  v22.sizeRace = 0x1EE;
  v22.magic5 = 0x19E;
  v22._sizeSector = 0xD;
  v22.sizeGame = 0x354EF;
  v22.magic4 = 0x27;
  // Block 2
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v22, 0x20u);
  day = vpGame->day;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &day, 4u);
  v25 = *((__int16 *)vpGame->h1 + 2);
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v25, 4u);
  v26 = vpGame->planet - vpGame->planets;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v26, 4u);
  z7 = vpGame->z7;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &z7, 4u);
  aa2 = vpGame->aa2;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &aa2, 4u);
  v29 = V_Day1;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v29, 4u);
  v30 = V_Day2;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v30, 4u);
  v31 = V_Day3;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v31, 4u);
  // Block 3 - ResTree
  Q_ReadWriteResTree_sub_46BB0(&V_ResTree, pfi, FALSE);
  // Block 4 - Stars
  starsNum = vpGame->starsNum;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &starsNum, 4u);
  j = 0;
  if ( vpGame->starsNum > 0 )
  {
    pStar = vpGame->stars;
    do
    {
      Q_ReadWriteStar_sub_1D920(&pStar[j++], pfi, FALSE);
    }
    while ( j < vpGame->starsNum );
  }
  // Block 5
  Word_18245 = vpGame->Word_18245;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &Word_18245, 4u);
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, vpGame->Unknown_49C5, 4 * vpGame->Word_18245);
  // Block 6 - Planets
  planetsNum = vpGame->planetsNum;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &planetsNum, 4u);
  v4 = 0;
  if ( vpGame->planetsNum > 0 )
  {
    planets = vpGame->planets;
    do
    {
      Q_ReadWritePlanet_sub_370B8(&planets[v4++], pfi, FALSE);
    }
    while ( v4 < vpGame->planetsNum );
  }
  // Block 7 - Ships
  kk = 0;
  k = 0;
  shipsNum = vpGame->shipsNum;
  vpShips = vpGame->ships;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &shipsNum, 4u);
  while ( k < 0x6B )
  {
    v9 = (char *)vpGame + 0x162 * k;
    if ( *(__int16 *)(v9 + 0x272DB) != 0xFFFFFFFF )
    {
      if ( !v9[0x272DD] )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xB57);
      }
      v36 = k;
      Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v36, 4u);
      ++kk;
      Q_ReadWriteShip_sub_4AE8C(&vpShips[k], pfi, FALSE);
    }
    ++k;
  }
  if ( kk != vpGame->shipsNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xB65);
  }
  // Block 8 - Races
  racesNum = vpGame->racesNum;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &racesNum, 4u);
  l = 0;
  if ( vpGame->racesNum > 0 )
  {
    races = vpGame->races;
    do
    {
      Q_ReadWriteRace_sub_43BDC(&races[l++], pfi, FALSE);
    }
    while ( l < vpGame->racesNum );
  }
  // Block 9
  t15Num = vpGame->t15Num;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &t15Num, 4u);
  memset(&v21.Unknown_8, 0, 0x18);
  m = 0;
  if ( vpGame->t15Num > 0 )
  {
    pt15 = vpGame->t15;
    do
    {
      v21 = pt15[m];
      v21.Unknown_0 = *(__int16 *)(v21.Unknown_0 + 4);
      v21.Unknown_4 = *(__int16 *)(v21.Unknown_4 + 4);
      Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v21, 0x27u);
      ++m;
    }
    while ( m < vpGame->t15Num );
  }
  // Block 10
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, vpGame->z10000, 10000u);
  // Block 11
  f = vpGame->t10.f;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &f, 4u);
  memset(&v20.c, 0, sizeof(v20.c));
  v14 = vpGame->t10.f;
  v42 = 0;
  if ( v14 > 0 )
  {
    p_t10 = &vpGame->t10;
    do
    {
      qmemcpy(&v20, &p_t10->a.a[v42], sizeof(v20));
      *(_DWORD *)&i = 0;
      if ( v20.b > 0 )
      {
        do
        {
          v20.a[i] = *(__int16 *)(v20.a[i] + 4);
          ++*(_DWORD *)&i;
        }
        while ( i < v20.b );
      }
      v16 = v42;
      Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &v20, 0x19Eu);
      v17 = vpGame->t10.f;
      v42 = v16 + 1;
    }
    while ( (__int16)(v16 + 1) < v17 );
  }
  // Block 12 - Sectors
  sectorsNum = vpGame->sectorsNum;
  Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &sectorsNum, 4u);
  v18 = 0;
  if ( vpGame->sectorsNum > 0 )
  {
    sectors = vpGame->sectors;
    do
    {
      Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, &sectors[v18++], 0xDu);
    }
    while ( v18 < vpGame->sectorsNum );
  }
}
// 105248: using guessed type int V_Day1;
// 10524C: using guessed type int V_Day2;
// 105250: using guessed type int V_Day3;

//----- (00021AA0) --------------------------------------------------------
__int16 __fastcall Q_LoadGam_sub_21AA0(P_Game a1, T_FileInfo *a2)
{
  __int16 v4; // ax
  WORD v5; // cx
  T_Star *v6; // eax
  int *Unknown_49C5; // ebp
  __int16 v8; // ax
  __int16 v9; // cx
  int v10; // eax
  __int16 i; // ax
  int v12; // edx
  __int16 v13; // cx
  __int16 v14; // ax
  WORD v15; // cx
  T_Race *v16; // eax
  __int16 v17; // ax
  int v18; // ebp
  T_Type15 *v19; // ecx
  int v20; // ebx
  int Unknown_4; // eax
  T_Star *v22; // edx
  int v23; // eax
  int v24; // ebp
  WORD f; // cx
  int j; // eax
  WORD v27; // dx
  __int16 v28; // ax
  WORD v29; // cx
  T_Sector *v30; // edx
  _DWORD v32[95]; // [esp+0h] [ebp-1E0h] BYREF
  _WORD v33[5]; // [esp+190h] [ebp-50h]
  int v34; // [esp+19Ah] [ebp-46h]
  T_SavBlock1Sizes v35; // [esp+1A0h] [ebp-40h] BYREF
  int buf; // [esp+1C0h] [ebp-20h] BYREF
  int v37; // [esp+1C4h] [ebp-1Ch]
  T_Star *stars; // [esp+1C8h] [ebp-18h]
  int v39; // [esp+1CCh] [ebp-14h]
  T_Type15 *t15; // [esp+1D0h] [ebp-10h]
  __int16 v41; // [esp+1D4h] [ebp-Ch]
  int v42; // [esp+1D6h] [ebp-Ah]
  int v43; // [esp+1DCh] [ebp-4h]

  Q_ReadFile_sub_1BF94(a2, &v35, 0x20u);
  if ( v35.sizeResTree != 0x1D72 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBAA);
  }
  if ( v35.sizeStar != 0x60 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBAB);
  }
  if ( v35.sizePlanet != 0x7B )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBAC);
  }
  if ( v35.sizeRace != 0x1EE )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBAD);
  }
  if ( v35.magic4 != 0x27 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBAE);
  }
  if ( v35.magic5 != 0x19E )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBAF);
  }
  if ( v35._sizeSector != 0xD )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBB0);
  }
  if ( v35.sizeGame != 0x354EF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\cosmos.cpp", 0xBB1);
  }
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  a1->day = buf;
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  a1->h1 = (char *)&a1->stars[buf];
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  a1->planet = &a1->planets[buf];
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  a1->z7 = buf;
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  a1->aa2 = buf;
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  V_Day1 = buf;
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  V_Day2 = buf;
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  V_Day3 = buf;
  Q_ReadWriteResTree_sub_46BB0(&V_ResTree, a2, TRUE);
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  v4 = buf;
  v5 = 0;
  a1->starsNum = buf;
  if ( v4 > 0 )
  {
    do
    {
      v6 = &a1->stars[v5++];
      Q_ReadWriteStar_sub_1D920(v6, a2, 0xFFFFFFFF);
    }
    while ( v5 < a1->starsNum );
  }
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  *(_WORD *)((char *)&a1->day + (_DWORD)&loc_18241 + 4) = buf;
  Unknown_49C5 = a1->Unknown_49C5;
  Q_ReadFile_sub_1BF94(a2, a1->Unknown_49C5, 4 * *(__int16 *)((char *)&a1->day + (_DWORD)&loc_18241 + 4));
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  v8 = buf;
  v9 = 0;
  *(_WORD *)((char *)&a1->day + (_DWORD)&loc_27281 + 2) = buf;
  if ( v8 > 0 )
  {
    v39 = (int)&loc_18247 + (_DWORD)a1;
    do
    {
      v37 = 0x7B * v9;
      Q_ReadWritePlanet_sub_370B8((P_Planet)(v37 + v39), a2, 0xFFFFFFFF);
      v10 = v37;
      *(int *)((char *)&a1->day + v37 + (_DWORD)&loc_18253 + 4) = (int)Unknown_49C5;
      ++v9;
      Unknown_49C5 += *(unsigned __int16 *)((char *)&a1->day + v10 + (_DWORD)&loc_1825F + 2);
    }
    while ( v9 < *(__int16 *)((char *)&a1->day + (_DWORD)&loc_27281 + 2) );
  }
  for ( i = 0; i < 0x6B; ++i )
  {
    v12 = 0x162 * i;
    *(_WORD *)((char *)&a1->day + v12 + (_DWORD)&loc_272D8 + 3) = 0xFFFF;
    *((_BYTE *)&a1->day + v12 + (_DWORD)&loc_272D8 + 5) = 0;
  }
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  v13 = 0;
  *(_WORD *)((char *)loc_3067B + (_DWORD)a1) = buf;
  while ( v13 < 0x6B )
  {
    if ( v13 < *(__int16 *)((char *)loc_3067B + (_DWORD)a1) )
    {
      Q_ReadFile_sub_1BF94(a2, &buf, 4u);
      Q_ReadWriteShip_sub_4AE8C((P_Ship)((char *)a1 + 0x162 * buf + (_DWORD)&loc_27281 + 4), a2, 0xFFFFFFFF);
    }
    ++v13;
  }
  // Block 8 - Races
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  v14 = buf;
  v15 = 0;
  a1->racesNum = buf;
  if ( v14 > 0 )
  {
    do
    {
      v16 = &a1->races[v15++];
      Q_ReadWriteRace_sub_43BDC(v16, a2, 0xFFFFFFFF);
    }
    while ( v15 < a1->racesNum );
  }
  // Block 9
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  v17 = buf;
  HIWORD(v42) = 0;
  a1->t15Num = buf;
  if ( v17 > 0 )
  {
    t15 = a1->t15;
    stars = a1->stars;
    do
    {
      v18 = SHIWORD(v42);
      v19 = &t15[v18];
      Q_ReadFile_sub_1BF94(a2, &t15[v18], 0x27u);
      v20 = (int)&stars[a1->t15[v18].Unknown_0];
      Unknown_4 = a1->t15[v18].Unknown_4;
      v22 = stars;
      a1->t15[v18].Unknown_0 = v20;
      v23 = (int)&v22[Unknown_4];
      a1->t15[v18].Unknown_4 = v23;
      v41 = *(_WORD *)(v20 + 0x44);
      v24 = v41;
      *(_WORD *)(v20 + 0x44) = v41 + 1;
      *(_DWORD *)(v20 + 4 * v24 + 0x2C) = v19;
      LOWORD(v22) = *(_WORD *)(v23 + 0x44);
      *(_WORD *)(v23 + 0x44) = (_WORD)v22 + 1;
      *(_DWORD *)(4 * (__int16)v22 + v23 + 0x2C) = v19;
      LOWORD(v22) = a1->t15Num;
      ++HIWORD(v42);
    }
    while ( SHIWORD(v42) < (__int16)v22 );
  }
  // Block 10
  Q_ReadFile_sub_1BF94(a2, (char *)a1 + (_DWORD)&loc_32DDA + 1, 10000u);
  // Block 11
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  a1->t10.f = buf;
  *(_DWORD *)&v33[3] = 0;
  v34 = 0;
  *(_DWORD *)&v33[1] = 0;
  f = a1->t10.f;
  v43 = 0;
  if ( f > 0 )
  {
    do
    {
      Q_ReadFile_sub_1BF94(a2, v32, 0x19Eu);
      for ( j = 0; (__int16)j < v33[0]; ++j )
      {
        v32[(__int16)j] = &a1->stars[v32[(__int16)j]];
      }
      v27 = a1->t10.f;
      ++v43;
    }
    while ( (__int16)v43 < v27 );
  }
  // Block 12
  Q_ReadFile_sub_1BF94(a2, &buf, 4u);
  v28 = buf;
  v29 = 0;
  a1->sectorsNum = buf;
  if ( v28 > 0 )
  {
    do
    {
      v30 = &a1->sectors[v29++];
      Q_ReadFile_sub_1BF94(a2, v30, 0xDu);
    }
    while ( v29 < a1->sectorsNum );
  }
  return sub_1EEA4(a1);
}
// 105248: using guessed type int V_Day1;
// 10524C: using guessed type int V_Day2;
// 105250: using guessed type int V_Day3;

//----- (000220CC) --------------------------------------------------------
WORD __fastcall sub_220CC(P_Game a1)
{
  __int16 v2; // di
  WORD racesNum; // dx
  double v4; // st6
  WORD v5; // bx
  WORD i; // dx
  P_Star star; // ebx
  P_Star v8; // eax
  WORD result; // ax
  double v10[7]; // [esp+8h] [ebp-84h] BYREF
  float v11; // [esp+40h] [ebp-4Ch]
  float v12; // [esp+44h] [ebp-48h]
  float v13; // [esp+48h] [ebp-44h]
  float v14; // [esp+4Ch] [ebp-40h]
  float v15; // [esp+50h] [ebp-3Ch]
  float v16; // [esp+54h] [ebp-38h]
  int v17[6]; // [esp+58h] [ebp-34h] BYREF
  int v18; // [esp+70h] [ebp-1Ch]

  v2 = 0;
  v14 = 0.0;
  v15 = 0.0;
  v16 = 0.0;
  memset(v10, 0, sizeof(v10));
  racesNum = a1->racesNum;
  a1->f = 0;
  if ( racesNum > 0 )
  {
    do
    {
      for ( i = 0; i < a1->racesNum; ++i )
      {
        if ( v2 != i )
        {
          star = a1->races[i].star;
          v8 = a1->races[v2].star;
          v17[5] = (int)v17;
          v11 = 0.0;
          v12 = 0.0;
          v13 = 0.0;
          v11 = v8->v.x - star->v.x;
          v12 = v8->v.y - star->v.y;
          v13 = v8->v.z - star->v.z;
          *(float *)v17 = v11;
          *(float *)&v17[1] = v12;
          *(float *)&v17[2] = v13;
          v14 = v11;
          v15 = v12;
          v16 = v13;
          v10[v2] = sqrt(v12 * v12 + v11 * v11 + v13 * v13) + v10[v2];
        }
      }
      v18 = a1->racesNum - 1;
      v10[v2] = v10[v2] / (double)v18;
      v4 = (double)a1->f + v10[v2++];
      v18 = (int)v4;
      v5 = a1->racesNum;
      a1->f = (int)v4;
    }
    while ( v2 < v5 );
  }
  result = a1->f / a1->racesNum;
  a1->f = result;
  return result;
}
// 220CC: using guessed type double var_84[7];

//----- (00022260) --------------------------------------------------------
int __fastcall sub_22260(int a1)
{
  return _wcpp_2_dtor_array_(a1, 7, &unk_95AF0);
}
// 7760C: using guessed type int __fastcall _wcpp_2_dtor_array_(_DWORD, _DWORD, _DWORD);

//----- (00022280) --------------------------------------------------------
int __fastcall sub_22280(int a1)
{
  return _wcpp_2_dtor_array_(a1, 0x64, &unk_95B04);
}
// 7760C: using guessed type int __fastcall _wcpp_2_dtor_array_(_DWORD, _DWORD, _DWORD);

//----- (000222A0) --------------------------------------------------------
int __fastcall sub_222A0(int a1)
{
  return _wcpp_2_dtor_array_(a1, 0x6B, &unk_95AB4);
}
// 7760C: using guessed type int __fastcall _wcpp_2_dtor_array_(_DWORD, _DWORD, _DWORD);

//----- (000222C0) --------------------------------------------------------
int __fastcall sub_222C0(int a1)
{
  return _wcpp_2_dtor_array_(a1, 0x18, &unk_95A8C);
}
// 7760C: using guessed type int __fastcall _wcpp_2_dtor_array_(_DWORD, _DWORD, _DWORD);

//----- (000222E0) --------------------------------------------------------
int __fastcall sub_222E0(int a1)
{
  return _wcpp_2_dtor_array_(a1, 9, &unk_95AA0);
}
// 7760C: using guessed type int __fastcall _wcpp_2_dtor_array_(_DWORD, _DWORD, _DWORD);

//----- (00022300) --------------------------------------------------------
int __fastcall sub_22300(int a1)
{
  return _wcpp_2_dtor_array_(a1, 0x1F4, &unk_95AC8);
}
// 7760C: using guessed type int __fastcall _wcpp_2_dtor_array_(_DWORD, _DWORD, _DWORD);

//----- (00022320) --------------------------------------------------------
int __fastcall sub_22320(int a1)
{
  return _wcpp_2_dtor_array_(a1, 0x94, &unk_95ADC);
}
// 7760C: using guessed type int __fastcall _wcpp_2_dtor_array_(_DWORD, _DWORD, _DWORD);

//----- (00022360) --------------------------------------------------------
_DWORD *__fastcall sub_22360(int a1)
{
  _DWORD *v1; // eax

  v1 = (_DWORD *)(a1 + 8);
  *v1 = 0;
  v1 += 3;
  v1[0xFFFFFFFE] = 0;
  v1[0xFFFFFFFF] = 0;
  v1[1] = 0;
  v1[2] = 0;
  *v1 = 0;
  return v1 + 0xFFFFFFFB;
}

//----- (000223B0) --------------------------------------------------------
char *__fastcall sub_223B0(int a1)
{
  _DWORD *v1; // eax

  v1 = (_DWORD *)(a1 + 1);
  v1[1] = 0;
  v1[2] = 0;
  *v1 = 0;
  return (char *)v1 + 0xFFFFFFFF;
}

//----- (000223E0) --------------------------------------------------------
char *__fastcall sub_223E0(int a1)
{
  _DWORD *v1; // eax

  v1 = (_DWORD *)(a1 + 0x192);
  v1[1] = 0;
  v1[2] = 0;
  *v1 = 0;
  return (char *)v1 + 0xFFFFFE6E;
}

//----- (00022400) --------------------------------------------------------
int __fastcall sub_22400(int result)
{
  *(_DWORD *)result = 0;
  *(_DWORD *)(result + 4) = 0;
  *(_DWORD *)(result + 8) = 0;
  *(_WORD *)(result + 0x1A) = 0;
  *(_DWORD *)(result + 0x10) = 0;
  *(_DWORD *)(result + 0x5A) = 0;
  return result;
}

//----- (00022430) --------------------------------------------------------
int __fastcall sub_22430(const void *a1, const void *a2)
{
  int v2; // edx
  float v4; // [esp+0h] [ebp-8h]
  float v5; // [esp+4h] [ebp-4h]

  v5 = *(float *)(*(_DWORD *)a1 + 0xD);
  v4 = *(float *)(*(_DWORD *)a2 + 0xD);
  v2 = 0;
  if ( v5 > (double)v4 )
  {
    return 0xFFFFFFFF;
  }
  if ( v5 < (double)v4 )
  {
    return 1;
  }
  return v2;
}

//----- (00022468) --------------------------------------------------------
void __fastcall Q_Proc_sub_22468()
{
  T_TypeA1 *v0; // eax

  v0 = sub_56E18(&V_Type3_stru_10AE70, "NEXTTURNCONT", 1, 0);
  if ( !v0 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x69);
  }
  v0[1].pane.window = 0;
}

//----- (000224A4) --------------------------------------------------------
char *__fastcall sub_224A4(int a1)
{
  _DWORD *v1; // eax
  _DWORD *v2; // eax
  UBYTE v3; // cl
  char *result; // eax

  Q_A2_sub_2C830((P_TypeA2)a1);
  v1 = sub_1B4F0((_DWORD *)(a1 + 0xDA));
  v2 = (_DWORD *)sub_254A4((int)(v1 + 0x26));
  *(_DWORD *)((char *)v2 + 0xFFFFFF35) = off_95BB4;
  *(_DWORD *)((char *)v2 + 0xFFFFFF39) = 0;
  *(_DWORD *)((char *)v2 + 0xFFFFFF3D) = 0;
  *(_DWORD *)((char *)v2 + 0xFFFFFF41) = 0;
  *(_WORD *)((char *)v2 + 0xFFFFFF45) = 0;
  *(_DWORD *)((char *)v2 + 0xFFFFFF49) = 0;
  *(_DWORD *)((char *)v2 + 0xFFFFFF4E) = 0;
  *(_DWORD *)((char *)v2 + 0xFFFFFF52) = 0xFFFFFFFF;
  *(_DWORD *)((char *)v2 + 0xFFFFFF56) = 0xFFFFFFFF;
  *(_DWORD *)((char *)v2 + 0xFFFFFF5A) = 0xFFFFFFFF;
  *(_DWORD *)((char *)v2 + 0xFFFFFF5E) = 0xFFFFFFFF;
  *(_DWORD *)((char *)v2 + 0xFFFFFF62) = 0;
  v2[0x108] = 0;
  *((_BYTE *)v2 + 0xFFFFFF66) = 0xFF;
  v2[0x103] = 2;
  v2[0x107] = 0;
  v2[0x106] = 0;
  v3 = byte_104BEA;
  v2[0x104] = 0;
  result = (char *)v2 + 0xFFFFFE8E;
  result[0xD9] = 1 << v3;
  return result;
}
// 95BB4: using guessed type int (*off_95BB4[2])();

//----- (00022588) --------------------------------------------------------
char *__fastcall sub_22588(char *a1, char a2)
{
  char *v2; // ebx
  void *v4; // eax
  void *v5; // edx
  int v6; // eax
  int v7; // eax
  char *v8; // eax

  v2 = a1;
  if ( (a2 & 4) != 0 )
  {
    v4 = (void *)_wcpp_2_dtor_array_store_((int)a1, (int)&unk_95B70);
    operator delete[](v4);
  }
  else
  {
    v5 = *(void **)(a1 + 0xAB);
    *(_DWORD *)(a1 + 0xA7) = off_95BB4;
    if ( v5 )
    {
      sub_2627C(v5);
    }
    operator delete[](*(void **)(v2 + 0xAB));
    if ( *(_DWORD *)(v2 + 0xAF) )
    {
      sub_2627C(*(void **)(v2 + 0xAF));
    }
    operator delete[](*(void **)(v2 + 0xAF));
    if ( *(_DWORD *)(v2 + 0xB3) )
    {
      sub_2627C(*(void **)(v2 + 0xB3));
    }
    operator delete[](*(void **)(v2 + 0xB3));
    v6 = sub_254B0((int)(v2 + 0x172));
    v7 = ((int (__fastcall *)(int, _DWORD))locret_1B66C)(v6 - 0x98, 0);
    v8 = (char *)sub_2C848(v7 - 0xDA, 1);
    v2 = v8;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v8);
    }
  }
  return v2;
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95BB4: using guessed type int (*off_95BB4[2])();

//----- (00022644) --------------------------------------------------------
unsigned int __fastcall Q_COSWND_CPP_sub_22644(int a1, const char *a2, const char *a3)
{
  void *v4; // eax
  int v5; // ecx
  void *v6; // eax
  int v7; // ebx
  __int16 v8; // ax
  void *v9; // eax
  T_FileInfo v11; // [esp+0h] [ebp-128h] BYREF

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x9E);
  }
  if ( !a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x9F);
  }
  Q_InitFileInfo_sub_1BB78(&v11);
  if ( *(_DWORD *)(a1 + 0xAB) )
  {
    sub_2627C(*(void **)(a1 + 0xAB));
  }
  operator delete[](*(void **)(a1 + 0xAB));
  if ( Q_OpenFile_sub_1BBFC(&v11, a2, O_BINARY, 0) )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\coswnd.cpp", 0xAA);
  }
  v4 = Q_CfileLoad_sub_1BF1C(&v11, 0);
  *(_DWORD *)(a1 + 0xAB) = v4;
  if ( !v4 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0xAC);
  }
  if ( *(_DWORD *)(a1 + 0xAF) )
  {
    sub_2627C(*(void **)(a1 + 0xAF));
  }
  operator delete[](*(void **)(a1 + 0xAF));
  HIWORD(v5) = 0;
  if ( Q_OpenFile_sub_1BBFC(&v11, a3, O_BINARY, 0) )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\coswnd.cpp", 0xB5);
  }
  v6 = Q_CfileLoad_sub_1BF1C(&v11, 0);
  *(_DWORD *)(a1 + 0xAF) = v6;
  if ( !v6 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0xB7);
  }
  LOWORD(v6) = *(_WORD *)(a1 + 0x10) - *(_WORD *)(a1 + 8);
  LOWORD(v5) = *(_WORD *)(a1 + 0xC);
  *(_WORD *)(a1 + 0x576) = (_WORD)v6;
  v7 = (int)v6;
  v8 = *(_WORD *)(a1 + 0x14);
  LOWORD(v7) = (__int16)v7 >> 1;
  *(_WORD *)(a1 + 0x576) = v7;
  *(_WORD *)(a1 + 0x578) = (__int16)(v8 - v5) >> 1;
  sub_2280C(a1, 0, v7, v5);
  if ( *(_DWORD *)(a1 + 0xB3) )
  {
    sub_2627C(*(void **)(a1 + 0xB3));
  }
  operator delete[](*(void **)(a1 + 0xB3));
  v9 = operator new[](0x1D1Fu);
  Q_RegisterData_sub_2625C(v9, 1, "CW DISPLAYITEMS");
  *(_DWORD *)(a1 + 0xB3) = v9;
  if ( !v9 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0xCC);
  }
  *(_WORD *)(a1 + 0xB7) = 0;
  *(_WORD *)(a1 + 0xB9) = 0x163;
  Q_CloseFileAndDelete_sub_1BBC8(&v11);
  return 0xFFFFFFFF;
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);

//----- (0002280C) --------------------------------------------------------
_DWORD *__fastcall sub_2280C(int a1, int a2, int a3, int a4)
{
  _DWORD *v4; // edx
  char *v5; // eax
  _DWORD *result; // eax

  v4 = (_DWORD *)a1;
  *(_DWORD *)(a1 + 0x57A) = 0x420C0000;
  sub_1B808(
    (_DWORD *)(a1 + 0xDA),
    (int)v4,
    a3,
    a4,
    *(_DWORD *)((char *)v4 + 0x57A),
    0x3F800000,
    0x47C35000,
    *(__int16 *)(a1 + 0x576));
  v5 = (char *)v4 + 0x10E;
  *(_DWORD *)((char *)v4 + 0x10E) = 0;
  *(_DWORD *)((char *)v4 + 0x112) = 0;
  v4 = (_DWORD *)((char *)v4 + 0x14E);
  *((_DWORD *)v5 + 2) = 0xC4BB8000;
  *v4 = 0x3F800000;
  v4[1] = 0;
  result = v4 + 3;
  v4[2] = 0;
  v4[3] = 0;
  v4[4] = 0x3F800000;
  v4 += 6;
  result[2] = 0;
  *v4 = 0;
  v4[1] = 0;
  v4[2] = 0x3F800000;
  return result;
}

//----- (000228A4) --------------------------------------------------------
#error "228A4: function frame is wrong (funcsize=0)"

//----- (00023BF0) --------------------------------------------------------
void __fastcall sub_23BF0(int a1, int a2)
{
  T_TypeA1 *v3; // eax
  int v4; // eax
  char *v5; // edi
  char *v6; // esi
  char v7; // al
  char v8; // al
  __int16 i; // si
  char v10; // dl
  int v11; // ebx
  int v12; // edx
  int v13; // ebx
  int v14; // edx
  const char *v15; // ecx
  int *v16; // eax
  int v17; // ebx
  int v18; // edx
  WORD v19; // dx
  char *v20; // esi
  char *v21; // edi
  char v22; // al
  char v23; // al
  int v24; // ebx
  int v25; // edx
  char s[128]; // [esp+0h] [ebp-F8h] BYREF
  char v27[40]; // [esp+80h] [ebp-78h] BYREF
  _DWORD v28[9]; // [esp+A8h] [ebp-50h] BYREF
  char v29[20]; // [esp+CCh] [ebp-2Ch] BYREF
  int v30; // [esp+E0h] [ebp-18h]

  v30 = a2;
  sub_254F8((int *)(a1 + 0x172), a1);
  if ( *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] == 3 )
  {
    v3 = sub_56E18(&V_Type3_stru_10AE70, "NEWGAMEWND", 3, 0);
    if ( !v3 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x414);
    }
    (*(void (__fastcall **)(T_TypeA1 *, int))(v3[1].magic12345678 + 0xC))(v3, 1);
  }
  if ( *(_DWORD *)(a1 + 0xD4) == 0xFFFFFFFF )
  {
    sub_23FD4(a1);
  }
  if ( *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] != 3 )
  {
    Q_WINMGR_CPP_sub_53E38((PANE *)(a1 + 4), 3, 3, byte_104BEA);
  }
  if ( *(_DWORD *)(a1 + 0xBB) )
  {
    s[0] = 0;
    v16 = *(int **)(a1 + 0xBB);
    v10 = 1;
    if ( !*((_BYTE *)v16 + 4) )
    {
      v4 = *v16;
      if ( ((unsigned __int8)byte_968DC & *(_BYTE *)(v4 + 0x17)) != 0 )
      {
        v5 = s;
        v6 = (char *)(v4 + 0x1C);
        do
        {
          v7 = *v6;
          *v5 = *v6;
          if ( !v7 )
          {
            break;
          }
          v8 = v6[1];
          v6 += 2;
          v5[1] = v8;
          v5 += 2;
        }
        while ( v8 );
        for ( i = 0;
              i < 7
           && (*(_BYTE *)(**(_DWORD **)(a1 + 0xBB) + 0x14) & (unsigned __int8)(*(_BYTE *)(a1 + 0xD9) & v10)) == 0;
              ++i )
        {
          v10 *= 2;
        }
      }
      v11 = *(_DWORD *)(a1 + 0x14) - 0x1B;
      v12 = *(_DWORD *)(a1 + 0x10) - 0x82;
      *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = V_Type6_stru_D8654.pane;
      sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], v12, v11, s, 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
      v13 = *(_DWORD *)(a1 + 0x14) - 0xC;
      v14 = *(_DWORD *)(a1 + 0x10) - 0x82;
      v15 = &byte_D84C4[0x14 * ***(_DWORD ***)(a1 + 0xBB)];
      V_Type3_stru_10AE70.pane = V_Type6_stru_D8654.pane;
      sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, v14, v13, v15, 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
    }
  }
  if ( v30 != 0xA )
  {
    stru_D85E4 = *(PANE *)(a1 + 4);
  }
  sub_552CC(&V_Type3_stru_10AE70, &stru_D85E4);
  if ( V_NougatLfExists_dword_A0CFC == 0xFFFFFFFF && V_NougatLfExists_dword_A0CFC == *(_DWORD *)(a1 + 0x58E) )
  {
    sprintf(s, "STARS CONTROLLED %d", V_Game.z9);
    V_Type3_stru_10AE70.pane = V_Type6_stru_D8654.pane;
    sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0xA, 0x18C, s, 0, 0xFFFFFFFF, 0xFF, 0);
    sprintf(s, "PERCENT CONTROLLED %d", 0x64 * V_Game.z9 / V_Game.starsNum);
    qmemcpy(v28, "Peaceful", sizeof(v28));
    sprintf(s, "%d Biorythym (%s)\n", word_104BE8, &v28[3 * V_Game.Unknown_D8A[0x2A]]);
    v17 = *(_DWORD *)(a1 + 0xC) + 0x1E;
    v18 = *(_DWORD *)(a1 + 8) + 5;
    *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = V_Type6_stru_D8654.pane;
    sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], v18, v17, s, 0, 0xFFFFFFFF, 0xFF, 0);
    v19 = 0;
    s[0] = 0;
    qmemcpy(v27, "Unknown", sizeof(v27));
    if ( V_Game.racesNum > 0 )
    {
      do
      {
        sprintf(
          v29,
          "R%d %10s %d\n",
          v19,
          &v27[0xA * (char)V_Game.races[byte_104BEA].Unknown_1C0[v19]],
          V_Game.races[byte_104BEA].Unknown_1B2[v19]);
        v20 = v29;
        ++v19;
        v21 = &s[strlen(s)];
        do
        {
          v22 = *v20;
          *v21 = *v20;
          if ( !v22 )
          {
            break;
          }
          v23 = v20[1];
          v20 += 2;
          v21[1] = v23;
          v21 += 2;
        }
        while ( v23 );
      }
      while ( v19 < V_Game.racesNum );
    }
    v24 = *(_DWORD *)(a1 + 0xC) + 0x37;
    v25 = *(_DWORD *)(a1 + 8) + 5;
    *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = V_Type6_stru_D8654.pane;
    sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], v25, v24, s, 0, 0xFFFFFFFF, 0xFF, 0);
  }
}
// 968DC: using guessed type char byte_968DC;
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// 104BE8: using guessed type __int16 word_104BE8;
// 23BF0: using guessed type char s[128];
// 23BF0: using guessed type char var_78[40];

//----- (00023FD4) --------------------------------------------------------
int __fastcall sub_23FD4(int a1)
{
  T_Race *races; // ebp
  int v2; // esi
  unsigned int v3; // edi
  int result; // eax
  void *ShapeTable_sub_1B084; // eax
  void *v6; // eax
  LONG Unknown_02; // [esp-Ch] [ebp-44h]
  int v8; // [esp+0h] [ebp-38h]
  PANE *pane; // [esp+8h] [ebp-30h]
  LONG hotY; // [esp+Ch] [ebp-2Ch]
  LONG hotX; // [esp+10h] [ebp-28h]
  LONG flags; // [esp+14h] [ebp-24h]
  unsigned __int16 v14; // [esp+18h] [ebp-20h]
  char v15; // [esp+1Ch] [ebp-1Ch]

  races = V_Game.races;
  v2 = 0;
  v15 = 1;
  v3 = 0;
  v8 = 0;
  pane = (PANE *)(a1 + 4);
  while ( 1 )
  {
    result = V_Game.racesNum;
    if ( v2 >= V_Game.racesNum )
    {
      break;
    }
    hotX = SHIWORD(dword_D85C6[v3 / 2]);
    hotY = word_D85CA[v3];
    if ( (*(unsigned __int8 *)(a1 + 0xD8) & v15) != 0
      && (V_Game.races[byte_104BEA].Unknown_1C0[v2] || v2 == byte_104BEA) )
    {
      flags = 0;
      v14 = word_FFEA0[v8];
      if ( *(_DWORD *)races->z == 0xFFFFFFFF )
      {
        flags = 1;
        VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[0x16]);
      }
      ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, v14);
      VFX_shape_transform(pane, ShapeTable_sub_1B084, 0, hotX, hotY, V_BigBuffer, 0, 0x10000, 0x10000, flags);
    }
    if ( (*(unsigned __int8 *)(a1 + 0xD8) & v15) != 0 )
    {
      Unknown_02 = races->Unknown_02;
      v6 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEE2);
      VFX_shape_draw(pane, v6, Unknown_02, hotX, hotY);
    }
    v3 += 2;
    ++v2;
    ++races;
    v15 *= 2;
    ++v8;
  }
  return result;
}
// D85C6: using guessed type int dword_D85C6[];
// D85CA: using guessed type __int16 word_D85CA[];
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEA0: using guessed type __int16 word_FFEA0[7];

//----- (00024154) --------------------------------------------------------
void __fastcall sub_24154(int a1, int a2, int a3, int a4, float a5)
{
  float *v6; // eax
  int v7; // [esp+0h] [ebp-8h]

  sub_254B0(a1 + 0x172);
  v6 = (float *)(a1 + 0x14E);
  *(float *)&v7 = a5 * *(float *)V_Type3_stru_10AE70.j;
  if ( a2 == 0xFFFFFFFF )
  {
    sub_535E4(v6, 0xFFFFFFFF, a1, a4, v7);
  }
  else
  {
    sub_535B4(v6, a2, a1, a4, v7);
  }
}

//----- (00024198) --------------------------------------------------------
void __fastcall sub_24198(int a1, int a2, int a3, int a4)
{
  int v5; // [esp-4h] [ebp-10h]

  if ( (*(float *)(a1 + 0x57A) >= (double)flt_9103C || a2 >= 0)
    && (*(float *)(a1 + 0x57A) <= (double)flt_91040 || a2 <= 0) )
  {
    v5 = *(__int16 *)(a1 + 0x576);
    *(float *)(a1 + 0x57A) = (double)a2 * *(float *)V_Type3_stru_10AE70.j + *(float *)(a1 + 0x57A);
    sub_1B808((_DWORD *)(a1 + 0xDA), a2, a1, a4, *(_DWORD *)(a1 + 0x57A), 0x3F800000, 0x47C35000, v5);
    sub_254B0(a1 + 0x172);
  }
  else
  {
    *(_BYTE *)(a1 + 0xC0) &= ~0x10u;
  }
}
// 9103C: using guessed type float flt_9103C;
// 91040: using guessed type float flt_91040;

//----- (0002422C) --------------------------------------------------------
void __fastcall sub_2422C(int a1, int a2, int a3, int a4)
{
  size_t *v5; // edx
  int v6; // esi
  int v7; // eax
  size_t *v8; // eax
  int v9; // ebp
  double v10; // st7
  size_t *v11; // eax
  int v12; // edx
  int **v13; // ebx
  int *v14; // ebp
  int *v15; // ebx
  int *v16; // ebp
  double v17; // st7
  double v18; // st7
  float v19; // eax
  int v20; // ebp
  __int16 v21; // dx
  int v22; // ebp
  int v23; // ebx
  int i; // eax
  double v25; // st7
  unsigned __int8 v26; // al
  int v27[3]; // [esp+8h] [ebp-114h] BYREF
  int v28[3]; // [esp+14h] [ebp-108h] BYREF
  int v29[3]; // [esp+20h] [ebp-FCh] BYREF
  float v30; // [esp+2Ch] [ebp-F0h]
  int v31; // [esp+30h] [ebp-ECh]
  int v32; // [esp+34h] [ebp-E8h]
  int v33[2]; // [esp+38h] [ebp-E4h] BYREF
  float v34; // [esp+40h] [ebp-DCh]
  int v35[3]; // [esp+44h] [ebp-D8h] BYREF
  float v36; // [esp+50h] [ebp-CCh]
  float v37; // [esp+54h] [ebp-C8h]
  float v38; // [esp+58h] [ebp-C4h]
  float v39; // [esp+5Ch] [ebp-C0h]
  int v40; // [esp+60h] [ebp-BCh]
  int v41; // [esp+64h] [ebp-B8h]
  int v42[3]; // [esp+68h] [ebp-B4h] BYREF
  float v43; // [esp+74h] [ebp-A8h]
  int v44; // [esp+78h] [ebp-A4h]
  int v45; // [esp+7Ch] [ebp-A0h]
  float v46; // [esp+80h] [ebp-9Ch]
  int v47; // [esp+84h] [ebp-98h]
  int v48; // [esp+88h] [ebp-94h]
  float v49; // [esp+8Ch] [ebp-90h]
  float v50; // [esp+90h] [ebp-8Ch]
  float v51; // [esp+94h] [ebp-88h]
  float v52; // [esp+98h] [ebp-84h]
  int v53; // [esp+9Ch] [ebp-80h]
  int v54; // [esp+A0h] [ebp-7Ch]
  int v55[2]; // [esp+A4h] [ebp-78h] BYREF
  float v56; // [esp+ACh] [ebp-70h]
  int *v57; // [esp+B0h] [ebp-6Ch]
  int *v58; // [esp+B8h] [ebp-64h]
  int *v59; // [esp+BCh] [ebp-60h]
  float v60; // [esp+C0h] [ebp-5Ch]
  int *v61; // [esp+C4h] [ebp-58h]
  int *v62; // [esp+C8h] [ebp-54h]
  int v63; // [esp+D0h] [ebp-4Ch]
  size_t *v64; // [esp+D4h] [ebp-48h]
  char *v65; // [esp+D8h] [ebp-44h]
  size_t *v66; // [esp+DCh] [ebp-40h]
  int v67; // [esp+E0h] [ebp-3Ch]
  float *v68; // [esp+E4h] [ebp-38h]
  int v69; // [esp+E8h] [ebp-34h]
  int v70; // [esp+ECh] [ebp-30h]
  int v71; // [esp+F0h] [ebp-2Ch]
  int v72; // [esp+F4h] [ebp-28h] BYREF
  int v73; // [esp+F8h] [ebp-24h] BYREF
  int v74; // [esp+FCh] [ebp-20h] BYREF
  __int16 v75[14]; // [esp+100h] [ebp-1Ch] BYREF

  v55[0] = 0;
  v55[1] = 0;
  v56 = 0.0;
  v33[0] = 0;
  v33[1] = 0;
  v34 = 0.0;
  v5 = (size_t *)(a1 + 0x172);
  v6 = *(_DWORD *)(a1 + 0xB3);
  sub_254B0(a1 + 0x172);
  sub_1B864(a1 + 0xDA, (int)v5, 0, a4);
  v63 = 0;
  v64 = v5;
  v68 = (float *)(a1 + 0x11A);
  v7 = v6 - 0x15;
  v66 = v5;
  while ( 1 )
  {
    v70 = v7;
    if ( *(__int16 *)(a1 + 0xB7) <= v63 )
    {
      break;
    }
    v26 = *(_BYTE *)(v6 + 4);
    if ( v26 )
    {
      if ( v26 <= 1u )
      {
        v9 = *(_DWORD *)v6;
        sub_53384((float *)(**(_DWORD **)v6 + 8), v68, (float *)v55);
        sub_53384((float *)(*(_DWORD *)(v9 + 4) + 8), v68, (float *)v33);
        *(_DWORD *)(v6 + 0x11) = 0xFFFFFFFF;
        if ( v56 > (double)*(float *)(a1 + 0x106)
          && v56 < (double)*(float *)(a1 + 0x10A)
          && v34 > (double)*(float *)(a1 + 0x106)
          && v34 < (double)*(float *)(a1 + 0x10A) )
        {
          sub_533D4(
            (float *)v55,
            *(float *)(a1 + 0x102),
            *(__int16 *)(a1 + 0x576),
            *(__int16 *)(a1 + 0x578),
            (int)v75,
            (int)&v74);
          sub_533D4(
            (float *)v33,
            *(float *)(a1 + 0x102),
            *(__int16 *)(a1 + 0x576),
            *(__int16 *)(a1 + 0x578),
            (int)&v73,
            (int)&v72);
          *(_WORD *)(v6 + 5) = v75[0];
          *(_WORD *)(v6 + 7) = v74;
          *(_WORD *)(v6 + 9) = v73;
          *(_WORD *)(v6 + 0xB) = v72;
          v10 = (v56 + v34) * flt_91060;
          *(_DWORD *)(v6 + 0x11) = 0;
          v11 = v66;
          *(float *)(v6 + 0xD) = v10;
          sub_254BC((int)v11, v6);
        }
      }
      else if ( v26 == 2 )
      {
        v12 = *(_DWORD *)v6;
        if ( *(_BYTE *)(*(_DWORD *)v6 + 0x58) == 5 )
        {
          v13 = *(int ***)(v12 + 0x59);
          v49 = 0.0;
          v50 = 0.0;
          v51 = 0.0;
          v36 = 0.0;
          v37 = 0.0;
          v38 = 0.0;
          if ( (*(_DWORD *)(v12 + 0xA2) & 0x7FFFFFFF) != 0 )
          {
            v16 = *v13;
            v49 = *((float *)*v13 + 2);
            v50 = *((float *)v16 + 3);
            v51 = *((float *)v16 + 4);
            v15 = v13[1];
          }
          else
          {
            v14 = v13[1];
            v49 = *((float *)v14 + 2);
            v50 = *((float *)v14 + 3);
            v51 = *((float *)v14 + 4);
            v15 = *v13;
          }
          v36 = *((float *)v15 + 2);
          v37 = *((float *)v15 + 3);
          v38 = *((float *)v15 + 4);
          v52 = v36 - v49;
          v57 = v27;
          *(float *)&v53 = v37 - v50;
          *(float *)&v54 = v38 - v51;
          *(float *)v27 = v52;
          v27[1] = v53;
          v27[2] = v54;
          v17 = sqrt(*(float *)&v53 * *(float *)&v53 + v52 * v52 + *(float *)&v54 * *(float *)&v54);
          v58 = v35;
          v43 = v36 - v49;
          *(float *)v35 = v43;
          *(float *)&v44 = v37 - v50;
          v35[1] = v44;
          *(float *)&v45 = v38 - v51;
          v35[2] = v45;
          v59 = v42;
          v60 = *(float *)(v12 + 0x9E);
          v46 = v43 * v60;
          *(float *)&v47 = *(float *)&v44 * v60;
          *(float *)&v48 = *(float *)&v45 * v60;
          v18 = 1.0 / v17;
          *(float *)v42 = v46;
          v42[1] = v47;
          v42[2] = v48;
          v30 = v46 * v18;
          v61 = v29;
          *(float *)&v31 = *(float *)&v47 * v18;
          *(float *)v29 = v30;
          v29[1] = v31;
          *(float *)&v32 = v18 * *(float *)&v48;
          v29[2] = v32;
          v39 = v49 + v30;
          v62 = v28;
          *(float *)&v40 = v50 + *(float *)&v31;
          *(float *)v28 = v39;
          *(float *)&v41 = v51 + *(float *)&v32;
          v28[1] = v40;
          v28[2] = v41;
          sub_53384((float *)v28, v68, (float *)v55);
          *(_DWORD *)(v6 + 0x11) = 0xFFFFFFFF;
          if ( v56 > (double)*(float *)(a1 + 0x106) && v56 < (double)*(float *)(a1 + 0x10A) )
          {
            sub_533D4(
              (float *)v55,
              *(float *)(a1 + 0x102),
              *(__int16 *)(a1 + 0x576),
              *(__int16 *)(a1 + 0x578),
              (int)v75,
              (int)&v74);
            *(_WORD *)(v6 + 5) = v75[0] + 3;
            *(_WORD *)(v6 + 7) = v74;
            v19 = v56;
            *(_DWORD *)(v6 + 0x11) = 0;
            *(float *)(v6 + 0xD) = v19;
            sub_254BC((int)v64, v6);
            goto LABEL_29;
          }
        }
        else
        {
          v20 = *(_DWORD *)(v70 + 0x11);
          v69 = v70;
          if ( !v20 )
          {
            if ( *(_BYTE *)(v70 + 4) )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x56E);
            }
            v21 = 4;
            v22 = *(unsigned __int8 *)(v67 + 0x14);
            v23 = *(unsigned __int8 *)(a1 + 0xD8);
            v65 = *(char **)v69;
            v71 = v23;
            for ( i = 0; i < 7; ++i )
            {
              if ( (v71 & v22 & (1 << i)) != 0 )
              {
                v21 += 2;
              }
            }
            if ( v65 == V_Game.h1 )
            {
              v21 += 2;
            }
            *(_WORD *)(v6 + 5) = v21 + *(_WORD *)(v69 + 5);
            *(_WORD *)(v6 + 7) = *(_WORD *)(v69 + 7);
            v25 = *(float *)(v69 + 0xD) + 1.0;
            *(_DWORD *)(v6 + 0x11) = 0;
            *(float *)(v6 + 0xD) = v25;
          }
        }
        sub_254BC((int)v64, v6);
      }
      else
      {
        Q_AssertLogBreakExit_sub_261A8(0, "..\\coswnd.cpp", 0x588);
      }
    }
    else
    {
      v67 = *(_DWORD *)v6;
      sub_53384((float *)(v67 + 8), v68, (float *)v55);
      *(_DWORD *)(v6 + 0x11) = 0xFFFFFFFF;
      if ( v56 > (double)*(float *)(a1 + 0x106) && v56 < (double)*(float *)(a1 + 0x10A) )
      {
        sub_533D4(
          (float *)v55,
          *(float *)(a1 + 0x102),
          *(__int16 *)(a1 + 0x576),
          *(__int16 *)(a1 + 0x578),
          (int)v75,
          (int)&v74);
        *(_WORD *)(v6 + 5) = v75[0];
        *(_WORD *)(v6 + 7) = v74;
        *(float *)(v6 + 0xD) = v56;
        v8 = v66;
        *(_DWORD *)(v6 + 0x11) = 0;
        sub_254BC((int)v8, v6);
      }
    }
LABEL_29:
    v6 += 0x15;
    v7 = v70 + 0x15;
    ++v63;
  }
  sub_254DC(v66);
}
// 91060: using guessed type float flt_91060;
// 2422C: using guessed type _WORD var_1C[14];

//----- (00024948) --------------------------------------------------------
int __fastcall sub_24948(int result, int a2, int a3)
{
  int v3; // ebp
  int v4; // ebx
  int v5; // edi
  int v6; // edx
  int v7; // eax
  int v8; // edx
  int v9; // ebx
  __int16 v10; // si
  int i; // ebx
  int v12; // eax
  int v13; // edx
  int v14; // edi
  char v15; // dl
  int v16; // eax
  char *v17; // edi
  char *v18; // esi
  char v19; // al
  char v20; // al
  __int16 j; // si
  int v22; // ebx
  int v23; // edx
  int v24; // ebx
  int v25; // edx
  const char *v26; // ecx
  _DWORD v27[5]; // [esp+0h] [ebp-2Ch] BYREF
  int v28; // [esp+14h] [ebp-18h]
  int v29; // [esp+18h] [ebp-14h]

  v3 = result;
  v28 = a2;
  v29 = a3;
  if ( *(_DWORD *)(result + 0xD4) == 0xFFFFFFFF )
  {
    return result;
  }
  v4 = *(_DWORD *)(result + 0xBB);
  if ( v4 )
  {
    v5 = 0x28;
    v6 = *(__int16 *)(v4 + 5) - v28;
    v7 = *(__int16 *)(v4 + 7) - v29;
    if ( *(_BYTE *)(v4 + 4) == 2 )
    {
      v6 += byte_965F8[0];
      v5 = 0x14;
      v7 += SHIBYTE(dword_965FD);
    }
    result = v6 * v6 + v7 * v7;
    if ( result <= v5 )
    {
      return result;
    }
    v8 = *(_DWORD *)(v3 + 0x57E);
    *(_DWORD *)(v3 + 0xBB) = 0;
    sub_5A270(&V_Type3_stru_10AE70, v8, 0, 0);
    stru_D85E4.x0 = *(_DWORD *)(v3 + 0x10) - 0x82;
    v9 = *(_DWORD *)(v3 + 0xA7);
    stru_D85E4.y0 = *(_DWORD *)(v3 + 0x14) - 0x1B;
    (*(void (__fastcall **)(int, int))(v9 + 0xC))(v3, 0xA);
  }
  v10 = *(_WORD *)(v3 + 0xB7) - 1;
  for ( i = 0x15 * (*(__int16 *)(v3 + 0xB7) - 1) + *(_DWORD *)(v3 + 0xB3); ; i -= 0x15 )
  {
    result = v10;
    if ( v10 < 0 )
    {
      break;
    }
    if ( *(_BYTE *)(i + 4) != 1 )
    {
      v12 = *(__int16 *)(i + 5) - v28;
      v13 = *(__int16 *)(i + 7) - v29;
      v14 = 0x28;
      if ( *(_BYTE *)(i + 4) == 2 )
      {
        v12 += byte_965F8[0];
        v13 += SHIBYTE(dword_965FD);
        v14 = 0x14;
      }
      result = v13 * v13 + v12 * v12;
      if ( result < v14 )
      {
        *(_DWORD *)(v3 + 0xBB) = i;
        break;
      }
    }
    --v10;
  }
  if ( *(_DWORD *)(v3 + 0xBB) )
  {
    sub_5A270(&V_Type3_stru_10AE70, *(_DWORD *)(v3 + 0x57E) + 1, 0, 0);
    result = *(_DWORD *)(v3 + 0xBB);
    if ( !*(_BYTE *)(result + 4) )
    {
      v27[0] = dword_96654[0];
      v27[1] = dword_96654[1];
      v27[2] = dword_96654[2];
      v27[3] = dword_96654[3];
      v27[4] = dword_96654[4];
      v15 = 1;
      v16 = **(_DWORD **)(v3 + 0xBB);
      if ( ((unsigned __int8)byte_968DC & *(_BYTE *)(v16 + 0x17)) != 0 )
      {
        v17 = (char *)v27;
        v18 = (char *)(v16 + 0x1C);
        do
        {
          v19 = *v18;
          *v17 = *v18;
          if ( !v19 )
          {
            break;
          }
          v20 = v18[1];
          v18 += 2;
          v17[1] = v20;
          v17 += 2;
        }
        while ( v20 );
        for ( j = 0;
              j < 7
           && (*(_BYTE *)(**(_DWORD **)(v3 + 0xBB) + 0x14) & (unsigned __int8)(*(_BYTE *)(v3 + 0xD9) & v15)) == 0;
              ++j )
        {
          v15 *= 2;
        }
      }
      if ( LOBYTE(v27[0]) )
      {
        v22 = *(_DWORD *)(v3 + 0x14) - 0x1B;
        v23 = *(_DWORD *)(v3 + 0x10) - 0x82;
        *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = V_Type6_stru_D8654.pane;
        sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], v23, v22, (const char *)v27, 0, 0xFFFFFFFF, 0xFF, 0);
      }
      v24 = *(_DWORD *)(v3 + 0x14) - 0xC;
      v25 = *(_DWORD *)(v3 + 0x10) - 0x82;
      v26 = &byte_D84C4[0x14 * ***(_DWORD ***)(v3 + 0xBB)];
      V_Type3_stru_10AE70.pane = V_Type6_stru_D8654.pane;
      return sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, v25, v24, v26, 0, 0xFFFFFFFF, 0xFF, 0);
    }
  }
  return result;
}
// 965FD: using guessed type int dword_965FD;
// 96654: using guessed type _DWORD dword_96654[5];
// 968DC: using guessed type char byte_968DC;

//----- (00024BE0) --------------------------------------------------------
int __fastcall sub_24BE0(int a1)
{
  int result; // eax
  T_TypeA1 *v3; // eax
  int v4; // edx
  int i; // ecx
  _DWORD *v6; // ebx
  __int16 *v7; // ecx
  int v8; // edx

  result = *(_DWORD *)(a1 + 0xBB);
  if ( !*(_BYTE *)(result + 4) )
  {
    if ( *(_DWORD *)(a1 + 0x582) )
    {
      result = *(_DWORD *)result;
      if ( ((unsigned __int8)byte_968DC & *(_BYTE *)(result + 0x16)) != 0 )
      {
        v4 = result;
        for ( i = 0; i < *(__int16 *)(result + 0x44); ++i )
        {
          v6 = *(_DWORD **)(v4 + 0x2C);
          if ( result == *v6 && v6[1] == **(_DWORD **)(a1 + 0x586)
            || *v6 == **(_DWORD **)(a1 + 0x586) && result == v6[1] )
          {
            v7 = **(__int16 ***)(a1 + 0x586);
            v8 = result;
            sub_1D654(v7, result, (int)v6);
            *(_DWORD *)(a1 + 0x582) = 0;
            sub_24D30(a1, v8, (int)v6, (int)v7);
            sub_2422C(a1, v8, (int)v6, (int)v7);
            return (*(int (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
          }
          v4 += 4;
        }
      }
    }
    else if ( *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] == 1 )
    {
      result = *(_DWORD *)result;
      if ( ((unsigned __int8)byte_968DC & *(_BYTE *)(result + 0x17)) != 0 )
      {
        V_Game.h1 = (char *)result;
        *(_DWORD *)(a1 + 0xBB) = 0;
        return sub_56B60(&V_Type3_stru_10AE70, 1, 0x10, 1);
      }
    }
    else if ( *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] == 0xD )
    {
      V_Game.h1 = *(char **)result;
      v3 = sub_56E18(&V_Type3_stru_10AE70, "NEGSCREEN", 0xD, 0);
      if ( !v3 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x612);
      }
      sub_32A1C((int)v3);
      return (*(int (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    }
  }
  return result;
}
// 968DC: using guessed type char byte_968DC;

//----- (00024D30) --------------------------------------------------------
int __fastcall sub_24D30(int a1, int a2, int a3, int a4)
{
  WORD i; // di
  T_Star *v6; // esi
  __int16 v7; // bx
  int v8; // esi
  WORD j; // si
  T_Type15 *v10; // edi
  WORD v11; // di
  __int16 k; // si
  int result; // eax
  T_Ship *v14; // eax
  int v15[107]; // [esp+0h] [ebp-1D4h] BYREF
  char s[32]; // [esp+1ACh] [ebp-28h] BYREF

  *(_WORD *)(a1 + 0xB7) = 0;
  for ( i = 0; i < V_Game.starsNum; ++i )
  {
    if ( *(_WORD *)(a1 + 0xB7) >= *(_WORD *)(a1 + 0xB9) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x659);
    }
    v6 = &V_Game.stars[i];
    *(_DWORD *)(*(_DWORD *)(a1 + 0xB3) + 0x15 * (*(int *)(a1 + 0xB5) >> 0x10)) = v6;
    *(_BYTE *)(*(_DWORD *)(a1 + 0xB3) + 0x15 * *(__int16 *)(a1 + 0xB7) + 4) = 0;
    v7 = *(_WORD *)(a1 + 0xB7) + 1;
    *(_WORD *)(a1 + 0xB7) = v7;
    if ( v6->Unknown_15 )
    {
      if ( v7 >= *(__int16 *)(a1 + 0xB9) )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x66B);
      }
      v8 = sub_1D794((__int16 *)&V_Game.stars[i], v15);
      if ( !v8 && V_NougatLfExists_dword_A0CFC == 0xFFFFFFFF )
      {
        sprintf(s, "cos%05d.bug", V_Game.day);
        Q_SaveGam_sub_54048(s);
        Q_AssertLogBreakExit_sub_261A8(0, "..\\coswnd.cpp", 0x676);
      }
      if ( v8 > 0 )
      {
        *(_DWORD *)(0x15 * *(__int16 *)(a1 + 0xB7) + *(_DWORD *)(a1 + 0xB3)) = v15[0];
        *(_BYTE *)(*(_DWORD *)(a1 + 0xB3) + 0x15 * (__int16)(*(_WORD *)(a1 + 0xB7))++ + 4) = 2;
      }
    }
  }
  for ( j = 0; j < V_Game.t15Num; ++j )
  {
    v10 = &V_Game.t15[j];
    if ( ((unsigned __int8)byte_968DC & v10->Unknown_20[0]) != 0 )
    {
      if ( *(_WORD *)(a1 + 0xB7) >= *(_WORD *)(a1 + 0xB9) )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x68B);
      }
      *(_DWORD *)(*(_DWORD *)(a1 + 0xB3) + 0x15 * *(__int16 *)(a1 + 0xB7)) = v10;
      *(_BYTE *)(*(_DWORD *)(a1 + 0xB3) + 0x15 * (__int16)(*(_WORD *)(a1 + 0xB7))++ + 4) = 1;
    }
  }
  v11 = 0;
  for ( k = 0; ; ++k )
  {
    result = k;
    if ( k >= 0x6B || v11 >= V_Game.shipsNum )
    {
      break;
    }
    if ( *(_WORD *)(a1 + 0xB7) >= *(_WORD *)(a1 + 0xB9) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x698);
    }
    v14 = &V_Game.ships[k];
    if ( v14->raceIndex != 0xFFFFFFFF )
    {
      ++v11;
      if ( v14->Unknown_58 == 5 )
      {
        *(_DWORD *)(0x15 * *(__int16 *)(a1 + 0xB7) + *(_DWORD *)(a1 + 0xB3)) = v14;
        *(_BYTE *)(0x15 * (__int16)(*(_WORD *)(a1 + 0xB7))++ + *(_DWORD *)(a1 + 0xB3) + 4) = 2;
      }
    }
  }
  return result;
}
// 968DC: using guessed type char byte_968DC;
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// 24D30: using guessed type int var_1D4[107];

//----- (00024FCC) --------------------------------------------------------
__int64 __fastcall sub_24FCC(int a1, T_FileInfo *a2, int a3)
{
  _DWORD *v4; // ecx
  _DWORD *v5; // edi
  _DWORD *v6; // ebp
  _DWORD *v7; // edx
  _DWORD *v8; // edx
  _DWORD *v9; // edx
  _DWORD *v10; // edx
  int v12; // [esp+0h] [ebp-1A4h] BYREF
  int v13; // [esp+4h] [ebp-1A0h]
  int v14; // [esp+8h] [ebp-19Ch]
  int v15; // [esp+Ch] [ebp-198h]
  int v16; // [esp+10h] [ebp-194h]
  int v17; // [esp+14h] [ebp-190h]
  int v18; // [esp+18h] [ebp-18Ch]
  _BYTE v19[158]; // [esp+1Ch] [ebp-188h] BYREF
  int v20[7]; // [esp+C0h] [ebp-E4h] BYREF
  char v21; // [esp+DCh] [ebp-C8h]
  char v22; // [esp+DDh] [ebp-C7h]
  int v23[40]; // [esp+DEh] [ebp-C6h] BYREF
  T_FileInfo *v24; // [esp+180h] [ebp-24h]
  _DWORD *v25; // [esp+184h] [ebp-20h]
  _DWORD *v26; // [esp+188h] [ebp-1Ch]
  _DWORD *v27; // [esp+18Ch] [ebp-18h]
  _DWORD *v28; // [esp+190h] [ebp-14h]

  v24 = a2;
  v4 = (_DWORD *)(a1 + 0xDA);
  v25 = (_DWORD *)(a1 + 0x14E);
  v5 = (_DWORD *)(a1 + 0xF2);
  v28 = (_DWORD *)(a1 + 0x10E);
  v6 = (_DWORD *)(a1 + 0x166);
  v27 = (_DWORD *)(a1 + 0xE6);
  v26 = (_DWORD *)(a1 + 0x15A);
  if ( a3 == 0xFFFFFFFF )
  {
    sub_1B4F0(v23);
    Q_ReadFile_sub_1BF94(v24, v20, 0xBEu);
    *(_DWORD *)(a1 + 0xC0) = v20[0];
    *(_DWORD *)(a1 + 0xC4) = v20[1];
    *(_DWORD *)(a1 + 0x58A) = v20[2];
    *(_DWORD *)(a1 + 0xC8) = v20[3];
    *(_DWORD *)(a1 + 0xCC) = v20[4];
    *(_DWORD *)(a1 + 0xD0) = v20[5];
    *(_DWORD *)(a1 + 0xD4) = v20[6];
    *(_BYTE *)(a1 + 0xD8) = v21;
    *(_BYTE *)(a1 + 0xD9) = v22;
    *v4 = v23[0];
    v4[1] = v23[1];
    v4[2] = v23[2];
    v7 = v27;
    *v27 = v23[3];
    v7[1] = v23[4];
    v7[2] = v23[5];
    *v5 = v23[6];
    v5[1] = v23[7];
    v5[2] = v23[8];
    v4[9] = v23[9];
    v4[0xA] = v23[0xA];
    v4[0xB] = v23[0xB];
    v4[0xC] = v23[0xC];
    v8 = v28;
    *v28 = v23[0xD];
    v8[1] = v23[0xE];
    v8[2] = v23[0xF];
    v4[0x10] = v23[0x10];
    v4[0x11] = v23[0x11];
    v4[0x12] = v23[0x12];
    v4[0x13] = v23[0x13];
    v4[0x14] = v23[0x14];
    v4[0x15] = v23[0x15];
    v4[0x16] = v23[0x16];
    v4[0x17] = v23[0x17];
    v4[0x18] = v23[0x18];
    v4[0x19] = v23[0x19];
    v4[0x1A] = v23[0x1A];
    v4[0x1B] = v23[0x1B];
    v4[0x1C] = v23[0x1C];
    v9 = v25;
    *v25 = v23[0x1D];
    v9[1] = v23[0x1E];
    v9[2] = v23[0x1F];
    v10 = v26;
    *v26 = v23[0x20];
    v10[1] = v23[0x21];
    v10[2] = v23[0x22];
    *v6 = v23[0x23];
    v6[1] = v23[0x24];
    v6[2] = v23[0x25];
    *(float *)(a1 + 0x57A) = (float)v23[0x26];
    return (unsigned int)((int (*)(void))locret_1B66C)();
  }
  else
  {
    sub_1B4F0(&v19[2]);
    v12 = *(_DWORD *)(a1 + 0xC0);
    v13 = *(_DWORD *)(a1 + 0xC4);
    v14 = *(_DWORD *)(a1 + 0x58A);
    v15 = *(_DWORD *)(a1 + 0xC8);
    v16 = *(_DWORD *)(a1 + 0xCC);
    v17 = *(_DWORD *)(a1 + 0xD0);
    v18 = *(_DWORD *)(a1 + 0xD4);
    v19[0] = *(_BYTE *)(a1 + 0xD8);
    v19[1] = *(_BYTE *)(a1 + 0xD9);
    *(_DWORD *)&v19[2] = *v4;
    *(_DWORD *)&v19[6] = v4[1];
    *(_DWORD *)&v19[0xA] = v4[2];
    *(_DWORD *)&v19[0xE] = *v27;
    *(_DWORD *)&v19[0x12] = v27[1];
    *(_DWORD *)&v19[0x16] = v27[2];
    *(_DWORD *)&v19[0x1A] = *v5;
    *(_DWORD *)&v19[0x1E] = v5[1];
    *(_DWORD *)&v19[0x22] = v5[2];
    *(_DWORD *)&v19[0x26] = v4[9];
    *(_DWORD *)&v19[0x2A] = v4[0xA];
    *(_DWORD *)&v19[0x2E] = v4[0xB];
    *(_DWORD *)&v19[0x32] = v4[0xC];
    *(_DWORD *)&v19[0x36] = *v28;
    *(_DWORD *)&v19[0x3A] = v28[1];
    *(_DWORD *)&v19[0x3E] = v28[2];
    *(_DWORD *)&v19[0x42] = v4[0x10];
    *(_DWORD *)&v19[0x46] = v4[0x11];
    *(_DWORD *)&v19[0x4A] = v4[0x12];
    *(_DWORD *)&v19[0x4E] = v4[0x13];
    *(_DWORD *)&v19[0x52] = v4[0x14];
    *(_DWORD *)&v19[0x56] = v4[0x15];
    *(_DWORD *)&v19[0x5A] = v4[0x16];
    *(_DWORD *)&v19[0x5E] = v4[0x17];
    *(_DWORD *)&v19[0x62] = v4[0x18];
    *(_DWORD *)&v19[0x66] = v4[0x19];
    *(_DWORD *)&v19[0x6A] = v4[0x1A];
    *(_DWORD *)&v19[0x6E] = v4[0x1B];
    *(_DWORD *)&v19[0x72] = v4[0x1C];
    *(_DWORD *)&v19[0x76] = *v25;
    *(_DWORD *)&v19[0x7A] = v25[1];
    *(_DWORD *)&v19[0x7E] = v25[2];
    *(_DWORD *)&v19[0x82] = *v26;
    *(_DWORD *)&v19[0x86] = v26[1];
    *(_DWORD *)&v19[0x8A] = v26[2];
    *(_DWORD *)&v19[0x8E] = *v6;
    *(_DWORD *)&v19[0x92] = v6[1];
    *(_DWORD *)&v19[0x96] = v6[2];
    *(_DWORD *)&v19[0x9A] = (int)*(float *)(a1 + 0x57A);
    Q_CFILE_CPP_dos_write_sub_1C098(&v24->fh, &v12, 0xBEu);
    return (unsigned int)((int (__cdecl *)(int, int, int, int, int, int, int, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))locret_1B66C)(
                           v12,
                           v13,
                           v14,
                           v15,
                           v16,
                           v17,
                           v18,
                           *(_DWORD *)v19,
                           *(_DWORD *)&v19[4],
                           *(_DWORD *)&v19[8],
                           *(_DWORD *)&v19[0xC],
                           *(_DWORD *)&v19[0x10],
                           *(_DWORD *)&v19[0x14],
                           *(_DWORD *)&v19[0x18],
                           *(_DWORD *)&v19[0x1C],
                           *(_DWORD *)&v19[0x20],
                           *(_DWORD *)&v19[0x24],
                           *(_DWORD *)&v19[0x28],
                           *(_DWORD *)&v19[0x2C],
                           *(_DWORD *)&v19[0x30],
                           *(_DWORD *)&v19[0x34],
                           *(_DWORD *)&v19[0x38],
                           *(_DWORD *)&v19[0x3C],
                           *(_DWORD *)&v19[0x40],
                           *(_DWORD *)&v19[0x44],
                           *(_DWORD *)&v19[0x48],
                           *(_DWORD *)&v19[0x4C],
                           *(_DWORD *)&v19[0x50],
                           *(_DWORD *)&v19[0x54],
                           *(_DWORD *)&v19[0x58],
                           *(_DWORD *)&v19[0x5C],
                           *(_DWORD *)&v19[0x60],
                           *(_DWORD *)&v19[0x64],
                           *(_DWORD *)&v19[0x68],
                           *(_DWORD *)&v19[0x6C],
                           *(_DWORD *)&v19[0x70],
                           *(_DWORD *)&v19[0x74],
                           *(_DWORD *)&v19[0x78],
                           *(_DWORD *)&v19[0x7C],
                           *(_DWORD *)&v19[0x80],
                           *(_DWORD *)&v19[0x84],
                           *(_DWORD *)&v19[0x88],
                           *(_DWORD *)&v19[0x8C],
                           *(_DWORD *)&v19[0x90],
                           *(_DWORD *)&v19[0x94],
                           *(_DWORD *)&v19[0x98]);
  }
}

//----- (000254A4) --------------------------------------------------------
int __fastcall sub_254A4(int a1)
{
  sub_254B0(a1);
  return a1;
}

//----- (000254B0) --------------------------------------------------------
int __fastcall sub_254B0(int result)
{
  *(_DWORD *)(result + 0x400) = 0;
  return result;
}

//----- (000254BC) --------------------------------------------------------
int __fastcall sub_254BC(int result, int a2)
{
  int v2; // ebx

  v2 = *(_DWORD *)(result + 0x400);
  if ( v2 < 0x100 )
  {
    if ( a2 )
    {
      *(_DWORD *)(result + 4 * v2) = a2;
      ++*(_DWORD *)(result + 0x400);
    }
  }
  return result;
}

//----- (000254DC) --------------------------------------------------------
void __fastcall sub_254DC(size_t *a1)
{
  qsort(a1, a1[0x100], 4u, sub_22430);
}

//----- (000254F8) --------------------------------------------------------
void __fastcall sub_254F8(int *a1, int a2)
{
  int v2; // esi
  unsigned __int8 v3; // al
  LONG v4; // edi
  int v5; // ebp
  int v6; // ecx
  T_Star *v7; // ebx
  LONG v8; // eax
  LONG v9; // ebp
  T_Star *v10; // eax
  char v11; // dl
  int v12; // edi
  LONG v13; // ecx
  LONG v14; // [esp-Ch] [ebp-78h]
  LONG v15; // [esp-8h] [ebp-74h]
  LONG v16; // [esp-8h] [ebp-74h]
  PANE *v17; // [esp+0h] [ebp-6Ch]
  int *v19; // [esp+8h] [ebp-64h]
  int v20; // [esp+Ch] [ebp-60h]
  PANE *v21; // [esp+10h] [ebp-5Ch]
  T_Star *v22; // [esp+14h] [ebp-58h]
  PANE *v23; // [esp+18h] [ebp-54h]
  PANE *v24; // [esp+1Ch] [ebp-50h]
  PANE *v25; // [esp+20h] [ebp-4Ch]
  PANE *v26; // [esp+24h] [ebp-48h]
  int v27; // [esp+28h] [ebp-44h]
  PANE *v28; // [esp+2Ch] [ebp-40h]
  PANE *pane; // [esp+30h] [ebp-3Ch]
  T_Star *v30; // [esp+34h] [ebp-38h]
  int v31; // [esp+38h] [ebp-34h]
  int i; // [esp+40h] [ebp-2Ch]
  __int16 v34; // [esp+44h] [ebp-28h]
  __int16 j; // [esp+48h] [ebp-24h]
  unsigned __int8 v36; // [esp+4Ch] [ebp-20h]
  char v37; // [esp+50h] [ebp-1Ch]
  char v38; // [esp+54h] [ebp-18h]

  VFX_pane_wipe((PANE *)(a2 + 4), *(unsigned __int8 *)(a2 + 0xBF));
  v19 = a1;
  v36 = 4 * V_Game.races[byte_104BEA].Unknown_02 + 0x13;
  v27 = 0;
  if ( a1[0x100] > 0 )
  {
    v28 = (PANE *)(a2 + 4);
    v26 = (PANE *)(a2 + 4);
    v25 = (PANE *)(a2 + 4);
    v21 = (PANE *)(a2 + 4);
    pane = (PANE *)(a2 + 4);
    v17 = (PANE *)(a2 + 4);
    v23 = (PANE *)(a2 + 4);
    v24 = (PANE *)(a2 + 4);
    do
    {
      v2 = *v19;
      v3 = *(_BYTE *)(*v19 + 4);
      v20 = (int)(*(float *)(*v19 + 0xD) + flt_910EA);
      if ( v3 )
      {
        if ( v3 <= 1u )
        {
          if ( *(_DWORD *)(a2 + 0xC4) || *(_DWORD *)(a2 + 0x58A) )
          {
            v6 = 7;
            v7 = *(T_Star **)v2;
            if ( v20 <= 0xDC )
            {
              if ( v20 <= 0x93 )
              {
                if ( v20 <= 0x49 )
                {
                  if ( v20 <= 0 )
                  {
                    if ( v20 <= (int)0xFFFFFFB7 )
                    {
                      if ( v20 <= (int)0xFFFFFF6D )
                      {
                        if ( v20 > (int)0xFFFFFF24 )
                        {
                          v6 = 6;
                        }
                      }
                      else
                      {
                        v6 = 5;
                      }
                    }
                    else
                    {
                      v6 = 4;
                    }
                  }
                  else
                  {
                    v6 = 3;
                  }
                }
                else
                {
                  v6 = 2;
                }
              }
              else
              {
                v6 = 1;
              }
            }
            else
            {
              v6 = 0;
            }
            if ( *(_DWORD *)(a2 + 0x58A) == 0xFFFFFFFF )
            {
              if ( *(_WORD *)&v7->Name[5] )
              {
                v8 = 4 * V_Game.races[byte_104BEA].Unknown_02 + 0x10 + v6 / 2;
              }
              else
              {
                v8 = v6 + 0x30;
              }
            }
            else
            {
              v8 = v6 + 0x68;
            }
            if ( !*(_DWORD *)(a2 + 0x58A) && (v7->Name[7] & 1) != 0 )
            {
              v8 = v6 / 2 + 0x70;
            }
            VFX_line_draw(
              v23,
              *(__int16 *)(v2 + 5),
              *(__int16 *)(v2 + 7),
              *(__int16 *)(v2 + 9),
              *(__int16 *)(v2 + 0xB),
              0,
              v8);
          }
        }
        else if ( v3 == 2 && *(_DWORD *)(a2 + 0xC8) )
        {
          v9 = 3;
          v10 = *(T_Star **)v2;
          if ( v20 <= 0xDC )
          {
            if ( v20 <= 0 )
            {
              if ( v20 > (int)0xFFFFFF24 )
              {
                v9 = 2;
              }
            }
            else
            {
              v9 = 1;
            }
          }
          else
          {
            v9 = 0;
          }
          v11 = BYTE2(v10->Unknown_46[4]);
          if ( v11 == 5 )
          {
            if ( ((1 << byte_104BEA) & *(unsigned __int8 *)(*(int *)((char *)&v10->Unknown_46[4] + 3) + 0x20)) != 0
              && ((1 << LOWORD(v10->Unknown_46[4])) & *(unsigned __int8 *)(a2 + 0xD8)) != 0 )
            {
              sub_53EB8(v24, *(void **)(a2 + 0xAF), v9, *(__int16 *)(v2 + 5), *(__int16 *)(v2 + 7), v10->Unknown_46[4]);
            }
          }
          else
          {
            v37 = 1;
            if ( v11 == 4 )
            {
              v30 = *(T_Star **)((char *)&v10->Unknown_46[4] + 3);
            }
            else
            {
              v30 = &V_Game.stars[*(__int16 *)(*(int *)((char *)&v10->Unknown_46[4] + 3) + 0xC)];
            }
            if ( !v30 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x822);
            }
            if ( ((1 << byte_104BEA) & (unsigned __int8)v30->Unknown_17) != 0 )
            {
              v12 = 0;
              for ( i = 0; V_Game.racesNum > i; ++i )
              {
                if ( (*(_BYTE *)(a2 + 0xD8) & (unsigned __int8)(v37 & v30->Unknown_15)) != 0 )
                {
                  v16 = *(__int16 *)(v2 + 7) + *((char *)&dword_965FD + v12 + 3);
                  v13 = *(__int16 *)(v2 + 5) + byte_965F8[v12++];
                  sub_53EB8(v21, *(void **)(a2 + 0xAF), v9, v13, v16, i);
                }
                v37 *= 2;
              }
            }
          }
        }
      }
      else
      {
        v22 = *(T_Star **)v2;
        v31 = 3;
        if ( v20 <= 0xDC )
        {
          if ( v20 <= 0 )
          {
            if ( v20 > (int)0xFFFFFF24 )
            {
              v31 = 2;
            }
          }
          else
          {
            v31 = 1;
          }
        }
        else
        {
          v31 = 0;
        }
        VFX_shape_draw(v17, *(void **)(a2 + 0xAB), v31 + 4 * v22->a, *(__int16 *)(v2 + 5), *(__int16 *)(v2 + 7));
        v34 = *(_WORD *)&V_Type3_stru_10AE70.z1e[0x596];
        v4 = 4;
        if ( (((1 << byte_104BEA) & (unsigned __int8)v22->Unknown_17) != 0
           || *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] == 3)
          && *(_DWORD *)(a2 + 0xCC)
          && v22->Unknown_14 )
        {
          v5 = 0;
          v38 = 1;
          do
          {
            if ( (*(_BYTE *)(a2 + 0xD8) & (unsigned __int8)(v22->Unknown_14 & v38)) != 0 )
            {
              v15 = v4;
              v14 = v4;
              v4 += 2;
              VFX_ellipse_draw(
                pane,
                *(__int16 *)(v2 + 5),
                *(__int16 *)(v2 + 7),
                v14,
                v15,
                v31 + (unsigned __int8)(4 * V_Game.races[v5].Unknown_02 + 0x13) - 3);
            }
            ++v5;
            v38 *= 2;
          }
          while ( v5 != 7 );
        }
        if ( v22 == (T_Star *)V_Game.h1 && *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] != 3 )
        {
          VFX_ellipse_draw(v25, *(__int16 *)(v2 + 5), *(__int16 *)(v2 + 7), v4, v4, 0xF3);
        }
        if ( (((1 << byte_104BEA) & (unsigned __int8)v22->Unknown_17) != 0 || v34 == 3)
          && (v22->Unknown_14 & 0x80) != 0
          && *(_DWORD *)(a2 + 0xD0) == 0xFFFFFFFF )
        {
          for ( j = 0; j < V_Game.racesNum; ++j )
          {
            if ( v22 == V_Game.races[j].star )
            {
              break;
            }
          }
          if ( j >= V_Game.racesNum )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\coswnd.cpp", 0x786);
          }
          if ( (*(_BYTE *)(a2 + 0xD8) & (unsigned __int8)(1 << j)) != 0
            || *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] == 3 )
          {
            Q_WINMGR_CPP_sub_53E38(v26, *(__int16 *)(v2 + 5) - 7, *(__int16 *)(v2 + 7) + 3, j);
          }
        }
        if ( ((1 << byte_104BEA) & (unsigned __int8)v22->Unknown_17) != 0
          && *(_DWORD *)(a2 + 0xCC)
          && ((1 << byte_104BEA) & (unsigned __int8)v22->Unknown_14) == 0 )
        {
          VFX_pixel_write(v28, *(__int16 *)(v2 + 5) - 4, *(__int16 *)(v2 + 7), v36);
          VFX_pixel_write(v28, *(__int16 *)(v2 + 5), *(__int16 *)(v2 + 7) - 4, v36);
          VFX_pixel_write(v28, *(__int16 *)(v2 + 5) + 4, *(__int16 *)(v2 + 7), v36);
          VFX_pixel_write(v28, *(__int16 *)(v2 + 5), *(__int16 *)(v2 + 7) + 4, v36);
        }
      }
      ++v27;
      ++v19;
    }
    while ( v27 < a1[0x100] );
  }
}
// 910EA: using guessed type float flt_910EA;
// 965FD: using guessed type int dword_965FD;

//----- (00025BF8) --------------------------------------------------------
void __fastcall __spoils<> sub_25BF8(P_TypeA2 a1)
{
  Q_A2_sub_2C830(a1);
  a1->b = (int)off_95B9C;
}
// 95B9C: using guessed type int (*off_95B9C[5])();

//----- (00025C08) --------------------------------------------------------
int __fastcall sub_25C08(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95B48);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95B9C;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95B9C: using guessed type int (*off_95B9C[5])();

//----- (00025C4C) --------------------------------------------------------
void __fastcall sub_25C4C(unsigned int a1, int a2)
{
  int v3; // edi
  __int16 v4; // si
  PANE *v5; // ebp

  sub_2CD24(a1, a2);
  v3 = 0x2F;
  v4 = 0;
  if ( V_Game.racesNum > 0 )
  {
    v5 = (PANE *)(a1 + 4);
    do
    {
      if ( v4 == byte_104BEA || V_Game.races[byte_104BEA].Unknown_1C0[v4] )
      {
        Q_WINMGR_CPP_sub_53E38(v5, (__int16)v3, 3, v4);
        v3 += 0x10;
      }
      ++v4;
    }
    while ( v4 < V_Game.racesNum );
  }
}

//----- (00025CB8) --------------------------------------------------------
int __fastcall sub_25CB8(int result)
{
  Q_A2_sub_2C830((P_TypeA2)result);
  *(_DWORD *)(result + 0xA7) = off_95B84;
  *(_WORD *)(result + 0xAB) = 0;
  return result;
}
// 95B84: using guessed type int (*off_95B84[5])();

//----- (00025CD4) --------------------------------------------------------
int __fastcall sub_25CD4(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95B34);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95B84;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95B84: using guessed type int (*off_95B84[5])();

//----- (00025D18) --------------------------------------------------------
void __fastcall sub_25D18(int result, LONG a2)
{
  unsigned int v3; // esi
  int v4; // ecx
  UBYTE Unknown_01; // al
  __int16 v6; // cx
  WORD i; // ax
  char *sub_1CEA8; // eax
  char *v9; // eax
  __int16 v10; // eax^2
  _DWORD *v11; // esi
  const char *v12; // ecx
  int *v13; // esi
  int v14; // ecx
  LONG v15; // ebx
  void *ShapeTable_sub_1B084; // eax
  __int16 v17; // [esp-8h] [ebp-68h]
  int v18; // [esp-4h] [ebp-64h]
  char s[52]; // [esp+0h] [ebp-60h] BYREF
  int v20; // [esp+34h] [ebp-2Ch]
  int v21; // [esp+38h] [ebp-28h]
  char *v22; // [esp+3Ch] [ebp-24h]
  LONG color; // [esp+40h] [ebp-20h]
  int v24; // [esp+44h] [ebp-1Ch]
  UBYTE v25; // [esp+48h] [ebp-18h]

  if ( *(_DWORD *)(result + 0x39) )
  {
    v3 = 0xFFFFFFFF;
    v24 = 0;
    color = 0xF2;
    if ( a2 )
    {
      color = a2;
    }
    v4 = *(__int16 *)(result + 0xAB);
    v20 = *(_DWORD *)V_Game.races[v4].z;
    v25 = V_Game.races[byte_104BEA].Unknown_1C0[v4];
    if ( !v25 || v20 )
    {
      v24 = 0xFFFFFFFF;
    }
    else
    {
      Unknown_01 = V_Game.races[v4].Unknown_01;
      v21 = 4 * V_Game.races[v4].Unknown_02 + 0x13;
      v22 = V_SpecNames[Unknown_01];
    }
    if ( *(_WORD *)(result + 0xAB) == byte_104BEA )
    {
      v6 = 0;
      for ( i = 0; i < V_Game.racesNum; ++i )
      {
        if ( i != byte_104BEA && V_Game.races[byte_104BEA].Unknown_1C0[i] )
        {
          ++v6;
        }
      }
      v18 = V_Game.racesNum - 1;
      sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xB);// 11: "%d of %d Species Known"
      sprintf(s, sub_1CEA8, v6, v18);
      v22 = s;
      v24 = 0;
      v21 = 0xF3;
      color = 0xF2;
      v3 = 0;
    }
    if ( v20 == 0xFFFFFFFF )
    {
      v9 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xC);    // 12: "Extinct"
      sprintf(s, v9);
      v22 = s;
      v21 = 0xF3;
      v24 = 0;
    }
    if ( !v24 )
    {
      if ( v3 == 0xFFFFFFFF )
      {
        VFX_pane_wipe((PANE *)(result + 4), color);
        v17 = color;
        v10 = v21;
        v11 = (_DWORD *)(result + 4);
      }
      else
      {
        v10 = v21;
        v11 = (_DWORD *)(result + 4);
        v17 = 0xFF;
      }
      v12 = v22;
      *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = *v11;
      v13 = v11 + 1;
      V_Type3_stru_10AE70.rect.x1 = *v13++;
      V_Type3_stru_10AE70.rect.y1 = *v13++;
      V_Type3_stru_10AE70.rect.x2 = *v13;
      V_Type3_stru_10AE70.rect.y2 = v13[1];
      sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0, v12, 0x43, v10, v17, 0);
    }
    if ( v25 )
    {
      v14 = *(__int16 *)(result + 0xAB);
      if ( v14 != byte_104BEA && v24 != 0xFFFFFFFF )
      {
        Q_WINMGR_CPP_sub_53E38((PANE *)(result + 4), 0xE, 3, v14);
        v15 = 0xFFFFFFFF;
        if ( !v20 )
        {
          if ( v25 == 3 )
          {
            v15 = 9;
          }
          else if ( v25 == 2 )
          {
            v15 = 8;
          }
        }
        if ( v15 != 0xFFFFFFFF )
        {
          ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                                   (unsigned int)&V_Type3_stru_10AE70.t13,
                                   (unsigned __int16)word_FFEF2);
          VFX_shape_draw((PANE *)(result + 4), ShapeTable_sub_1B084, v15, 0xE, 3);
        }
      }
    }
    sub_552CC(&V_Type3_stru_10AE70, (PANE *)(result + 4));
  }
}

//----- (00025FB4) --------------------------------------------------------
int __fastcall sub_25FB4(int result)
{
  if ( *(_DWORD *)(result + 0x39) )
  {
    return (*(int (**)(void))(*(_DWORD *)(result + 0xA7) + 0xC))();
  }
  return result;
}

//----- (00026000) --------------------------------------------------------
unsigned int __fastcall sub_26000(int a1, __int16 a2, __int16 a3, int a4)
{
  WORD v5; // ax
  unsigned int result; // eax
  LONG v7; // ecx
  LONG v8; // edx
  LONG v9; // ebx
  int v10; // eax
  int v11; // [esp-4h] [ebp-14h]

  switch ( a2 )
  {
    case 1:
      v5 = *(char *)(a1 + 0x25) - 0x31;
      *(_WORD *)(a1 + 0xAB) = v5;
      if ( v5 < V_Game.racesNum )
      {
        goto LABEL_10;
      }
      result = 0;
      break;
    case 2:
      *(_DWORD *)(a1 + 0x39) = 0;
      v7 = *(_DWORD *)(a1 + 0x10);
      v8 = *(_DWORD *)(a1 + 8);
      v11 = *(_DWORD *)(a1 + 0x14);
      v9 = *(_DWORD *)(a1 + 0xC);
      *(_DWORD *)(a1 + 0x35) = 0;
      sub_55214(&V_Type3_stru_10AE70, v8, v9, v7, v11);
      result = 0;
      break;
    case 4:
    case 5:
      v10 = *(__int16 *)(a1 + 0xAB);
      if ( V_Game.races[byte_104BEA].Unknown_1C0[v10]
        && v10 != byte_104BEA
        && *(_DWORD *)V_Game.races[v10].z != 0xFFFFFFFF )
      {
        byte_968DD = *(_BYTE *)(a1 + 0xAB);
        goto LABEL_10;
      }
      result = 0;
      break;
    case 6:
      goto LABEL_13;
    case 7:
      (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0x10))();
      result = 0xFFFFFFFF;
      break;
    case 0xB:
      *(_WORD *)(a1 + 0xAB) = a3;
LABEL_13:
      (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
      result = 0xFFFFFFFF;
      break;
    case 0xD:
      (*(void (__fastcall **)(int, _DWORD, __int16, int))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0, a3, a4);
      result = sub_2F424(a1, a2, a3, a4);
      break;
    default:
LABEL_10:
      result = sub_2F424(a1, a2, a3, a4);
      break;
  }
  return result;
}
// 968DD: using guessed type char byte_968DD;

//----- (00026140) --------------------------------------------------------
int __fastcall sub_26140(int a1)
{
  return ((int (__fastcall *)(int, _DWORD))locret_1B66C)(a1 + 0x1E, 0) - 0x1E;
}

//----- (00026150) --------------------------------------------------------
char *__fastcall sub_26150(int a1)
{
  return (char *)sub_1B4F0((_DWORD *)(a1 + 0x1E)) + 0xFFFFFFE2;
}

//----- (00026160) --------------------------------------------------------
int Q_StopSystems_sub_26160()
{
  Q_StopMouse_sub_2632C();
  Q_StopVideoSystem_sub_2C6CC(&V_Type6_stru_D8654);
  Q_StopSoundSystem_sub_4FE8C(&V_SoundSystem);
  return printf("\n%s\n\n", "Thank you for playing Ascendancy.");
}

//----- (00026194) --------------------------------------------------------
void Q_debugbreak_sub_26194()
{
  __debugbreak();
}

//----- (00026198) --------------------------------------------------------
void __fastcall __noreturn Q_AssertLogBreakExit_sub_26198(int ignore, const char *sourcefile, int line)
{
  if ( !ignore )
  {
    sprintf("Thank you for playing Ascendancy.", "Assert Failed: <%s> Line %d\n\n", sourcefile, line);
    Q_debugbreak_exit_sub_2624C();
  }
  JUMPOUT(0x26195);
}
// 2619A: control flows out of bounds to 26195

//----- (000261A8) --------------------------------------------------------
void __fastcall Q_AssertLogBreakExit_sub_261A8(int ignore, const char *sourcefile, int line)
{
  if ( !ignore )
  {
    sprintf("Thank you for playing Ascendancy.", "Assert Failed: <%s> Line %d\n\n", sourcefile, line);
    Q_debugbreak_exit_sub_2624C();
  }
  JUMPOUT(0x26195);
}
// 261AA: control flows out of bounds to 26195

//----- (000261B8) --------------------------------------------------------
int __fastcall sub_261B8(int result, const char *a2, int a3)
{
  const char *v3; // esi
  char *v4; // edi
  char v5; // al
  char v6; // al
  char v7[264]; // [esp+0h] [ebp-108h] BYREF

  if ( !result )
  {
    v3 = "Thank you for playing Ascendancy.";
    v4 = v7;
    do
    {
      v5 = *v3;
      *v4 = *v3;
      if ( !v5 )
      {
        break;
      }
      v6 = v3[1];
      v3 += 2;
      v4[1] = v6;
      v4 += 2;
    }
    while ( v6 );
    sprintf("Thank you for playing Ascendancy.", "Assert Failed: <%s> Line %d\n\n%s\n", a2, a3, v7);
    Q_debugbreak_exit_sub_2624C();
  }
  return result;
}

//----- (0002620C) --------------------------------------------------------
__int64 __cdecl sub_2620C(char *format, char a2)
{
  char *v3; // [esp+0h] [ebp-Ch] BYREF

  v3 = &a2;
  return (unsigned int)vsprintf("Thank you for playing Ascendancy.", format, &v3);
}

//----- (0002624C) --------------------------------------------------------
void __noreturn Q_debugbreak_exit_sub_2624C()
{
  Q_debugbreak_sub_26194();
  exit(1);
}

//----- (0002625C) --------------------------------------------------------
void __fastcall __spoils<edx,ebx> Q_RegisterData_sub_2625C(void *aData, int a2, char *name)
{
  if ( aData )
  {
    Q_WINMGR_CPP_sub_5A094(&V_Type3_stru_10AE70, aData, a2, name);
  }
}

//----- (0002627C) --------------------------------------------------------
void __fastcall sub_2627C(void *a1)
{
  Q_WINMGR_CPP_sub_5A144(&V_Type3_stru_10AE70, a1);
}

//----- (0002628C) --------------------------------------------------------
void *__fastcall Q_Allocate_sub_2628C(size_t a1, int a2, char *a3)
{
  void *result; // eax
  void *v4; // esi

  result = malloc(a1);
  v4 = result;
  if ( result )
  {
    Q_WINMGR_CPP_sub_5A094(&V_Type3_stru_10AE70, result, a2, a3);
    return v4;
  }
  return result;
}

//----- (000262B0) --------------------------------------------------------
void *__fastcall sub_262B0(size_t num, size_t size, int a3, char *name)
{
  void *result; // eax
  void *v5; // esi

  result = calloc(num, size);
  v5 = result;
  if ( result )
  {
    Q_WINMGR_CPP_sub_5A094(&V_Type3_stru_10AE70, result, a3, name);
    return v5;
  }
  return result;
}

//----- (000262CC) --------------------------------------------------------
void __fastcall sub_262CC(void *ptr)
{
  Q_WINMGR_CPP_sub_5A144(&V_Type3_stru_10AE70, ptr);
  free(ptr);
}

//----- (000262F0) --------------------------------------------------------
void sub_262F0()
{
  _wcpp_2_mod_register_(&unk_96768);
  sub_26314();
  dword_96770 = 1;
}
// 786DA: using guessed type int __fastcall _wcpp_2_mod_register_(_DWORD);
// 96770: using guessed type int dword_96770;

//----- (00026314) --------------------------------------------------------
void sub_26314()
{
  ;
}

//----- (0002631C) --------------------------------------------------------
void sub_2631C()
{
  Q_StopMouse_sub_2632C();
}

//----- (0002632C) --------------------------------------------------------
void Q_StopMouse_sub_2632C()
{
  if ( V_Mouse.initialized )
  {
    MOUSE_shutdown();
  }
  else
  {
    Q_Null_sub_26328();
  }
}

//----- (0002633C) --------------------------------------------------------
int Q_StartMouse_sub_2633C()
{
  V_Mouse.initialized = MOUSE_init(640, 480);
  return (V_Mouse.initialized == 0) - 1;
}

//----- (00026360) --------------------------------------------------------
void __fastcall Q_ProcessKeyboard_sub_26360()
{
  WORD v0; // ax
  bool v1; // zf
  int v2; // eax

  HIBYTE(v0) = 2;
  __asm { int     16h; KEYBOARD - GET SHIFT STATUS }
  V_Keyboard.Flags = v0;
  if ( (v0 & 1) != 0 || (v0 & 2) != 0 )
  {
    V_Keyboard.Shift = 0xFFFFFFFF;
  }
  else
  {
    V_Keyboard.Shift = 0;
  }
  V_Keyboard.Ctrl = ((v0 & 4) == 0) - 1;
  V_Keyboard.Alt = ((v0 & 8) == 0) - 1;
  V_Keyboard.ScrollLock = ((v0 & 0x10) == 0) - 1;
  V_Keyboard.NumLock = ((v0 & 0x20) == 0) - 1;
  V_Keyboard.CapsLock = ((v0 & 0x40) == 0) - 1;
  v2 = ((v0 & 0x80) == 0) - 1;
  v1 = v2 == 0;
  V_Keyboard.Insert = v2;
  BYTE1(v2) = 1;
  __asm { int     16h; KEYBOARD - CHECK BUFFER, DO NOT CLEAR }
  if ( v1 )
  {
    LOWORD(v2) = 0;
  }
  if ( (_WORD)v2 )
  {
    __asm { int     16h; KEYBOARD - READ CHAR FROM BUFFER, WAIT IF EMPTY }
    V_Keyboard.ASCIIChar = (unsigned __int8)v2;
    V_Keyboard.Pressed = TRUE;
    V_Keyboard.ScanCode = 0;
  }
  else
  {
    V_Keyboard.Pressed = 0;
  }
}
// 2637B: variable 'v0' is possibly undefined

//----- (000264B4) --------------------------------------------------------
void __fastcall Q_ProcessMouse_sub_264B4()
{
  LONG mx; // [esp+0h] [ebp-2Ch] BYREF
  LONG my; // [esp+4h] [ebp-28h] BYREF
  LONG ml; // [esp+8h] [ebp-24h] BYREF
  LONG mr; // [esp+Ch] [ebp-20h] BYREF
  LONG mc; // [esp+10h] [ebp-1Ch] BYREF

  MOUSE_status(&mx, &my, &ml, &mr, &mc);
  if ( mx == V_Mouse.x && my == V_Mouse.y )
  {
    V_Mouse.moved = 0;
  }
  else
  {
    V_Mouse.x = mx;
    V_Mouse.moved = TRUE;
    V_Mouse.y = my;
  }
  if ( ml == V_Mouse.left )
  {
    V_Mouse.leftClicked = 0;
  }
  else
  {
    V_Mouse.left = ml;
    V_Mouse.leftClicked = TRUE;
  }
  if ( mr == V_Mouse.right )
  {
    V_Mouse.rightClicked = 0;
  }
  else
  {
    V_Mouse.right = mr;
    V_Mouse.rightClicked = TRUE;
  }
}

//----- (0002656C) --------------------------------------------------------
int __fastcall Q_ProcessInput_sub_2656C()
{
  V_Mouse.leftClicked = 0;
  V_Mouse.rightClicked = 0;
  V_Mouse.moved = 0;
  V_Keyboard.Pressed = 0;
  Q_ProcessKeyboard_sub_26360();
  if ( V_Mouse.initialized )
  {
    Q_ProcessMouse_sub_264B4();
  }
  return Q_GameLoop_dword_96774;
}
// 96774: using guessed type int Q_GameLoop_dword_96774;

//----- (000265A8) --------------------------------------------------------
void __fastcall sub_265A8(int a1)
{
  unsigned __int16 v1; // dx
  LONG v2; // edx
  LONG v3; // eax
  __int16 v4; // dx
  WORD v5; // dx

  V_Mouse.moved = 0;
  V_Mouse.leftClicked = 0;
  V_Mouse.rightClicked = 0;
  V_Keyboard.Pressed = 0;
  v1 = *(_WORD *)(a1 + 8);
  if ( v1 < 2u )
  {
    if ( v1 == 1 )
    {
      v2 = *(_DWORD *)(a1 + 0xC);
      v3 = *(_DWORD *)(a1 + 0x10);
      V_Mouse.x = v2;
      V_Mouse.y = v3;
      MOUSE_force_move(v2, v3);
      V_Mouse.moved = 0xFFFFFFFF;
    }
  }
  else if ( v1 <= 2u )
  {
    if ( *(_DWORD *)(a1 + 0xC) )
    {
      V_Mouse.right = *(_DWORD *)(a1 + 0x10);
      V_Mouse.rightClicked = 0xFFFFFFFF;
    }
    else
    {
      V_Mouse.left = *(_DWORD *)(a1 + 0x10);
      v4 = *(_WORD *)(a1 + 0xA);
      V_Mouse.leftClicked = 0xFFFFFFFF;
      if ( v4 && V_Mouse.left )
      {
        V_Keyboard.Shift = 0xFFFFFFFF;
      }
      else
      {
        V_Keyboard.Shift = 0;
      }
    }
  }
  else if ( v1 == 3 )
  {
    V_Keyboard.Flags = *(_WORD *)(a1 + 0xA);
    v5 = *(_WORD *)(a1 + 0xC);
    V_Keyboard.ASCIIChar = *(_WORD *)(a1 + 0x10);
    V_Keyboard.ScanCode = v5;
    V_Keyboard.Pressed = 0xFFFFFFFF;
    if ( (V_Keyboard.Flags & 1) != 0 || (V_Keyboard.Flags & 2) != 0 )
    {
      V_Keyboard.Shift = 0xFFFFFFFF;
    }
    else
    {
      V_Keyboard.Shift = 0;
    }
    V_Keyboard.Ctrl = ((V_Keyboard.Flags & 4) == 0) - 1;
    V_Keyboard.Alt = ((V_Keyboard.Flags & 8) == 0) - 1;
    V_Keyboard.ScrollLock = ((V_Keyboard.Flags & 0x10) == 0) - 1;
    V_Keyboard.NumLock = ((V_Keyboard.Flags & 0x20) == 0) - 1;
    V_Keyboard.CapsLock = ((V_Keyboard.Flags & 0x40) == 0) - 1;
    if ( (V_Keyboard.Flags & 0x80) != 0 )
    {
      V_Keyboard.Insert = 0xFFFFFFFF;
    }
    else
    {
      V_Keyboard.Insert = 0;
    }
  }
}

//----- (000267A0) --------------------------------------------------------
void __fastcall __spoils<> Q_A5_sub_267A0(P_TypeA5 a1)
{
  Q_A2_sub_2FC50(&a1->a2);
  a1->a2.b = (int)off_95C70;
  Q_A5_sub_26800(a1);
}
// 95C70: using guessed type int (*off_95C70[5])();

//----- (000267BC) --------------------------------------------------------
int __fastcall sub_267BC(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95C2C);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95C70;
    v5 = (void *)sub_2FC68(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95C70: using guessed type int (*off_95C70[5])();

//----- (00026800) --------------------------------------------------------
void __fastcall __spoils<> Q_A5_sub_26800(P_TypeA5 result)
{
  result->c = 0;
}

//----- (00026874) --------------------------------------------------------
char __fastcall sub_26874(int a1, __int16 *a2)
{
  char *v3; // edi
  char *v4; // esi
  char v5; // al
  char v6; // al
  __int16 *v7; // ebx
  int v8; // edx
  int v9; // esi
  __int16 v10; // kr00_2
  T_ResItem *v11; // eax
  unsigned __int8 v12; // bl
  int v13; // ebx
  _WORD *v14; // edx
  int v15; // ebx
  int v16; // esi
  int v17; // ebx
  int v18; // eax
  int v19; // esi
  int v20; // edx
  int v21; // eax
  int v22; // eax
  char *v23; // eax
  int v24; // edx
  int v25; // edi
  int v26; // esi
  int v27; // edi
  int v28; // esi
  _DWORD *v29; // edi
  int v30; // eax
  int v31; // edx
  __int16 v32; // bx
  int v33; // edx
  int v34; // eax
  int v35; // edx
  int v36; // eax
  int v37; // ebx
  __int16 v38; // ax
  int v39; // ecx
  __int16 v40; // ax
  int v41; // edx
  int v42; // edx
  int v43; // edx
  int v45; // [esp-8h] [ebp-298h]
  char *sub_1CEA8; // [esp-4h] [ebp-294h]
  char format[600]; // [esp+0h] [ebp-290h] BYREF
  char s[32]; // [esp+258h] [ebp-38h] BYREF
  int v49; // [esp+27Ch] [ebp-14h]
  int v50; // [esp+280h] [ebp-10h]
  int v51; // [esp+284h] [ebp-Ch]
  int v52; // [esp+288h] [ebp-8h]
  int v53; // [esp+28Ch] [ebp-4h]

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x48);
  }
  *(_DWORD *)(a1 + 0xDAF) = a2;
  sprintf(s, "event%02d", *a2);
  sub_2FCB0((_DWORD *)a1, "help.txt", s);
  v50 = a1 + 0xC95;
  v53 = a1 + 0xCB0;
  if ( *(_BYTE *)(a1 + 0xC95) != 1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x55);
  }
  if ( *(int *)(a1 + 0xDA3) > 1 && *(_BYTE *)v53 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x57);
  }
  v3 = format;
  v4 = *(char **)(v50 + 5);
  do
  {
    v5 = *v4;
    *v3 = *v4;
    if ( !v5 )
    {
      break;
    }
    v6 = v4[1];
    v4 += 2;
    v3[1] = v6;
    v3 += 2;
  }
  while ( v6 );
  v7 = *(__int16 **)(a1 + 0xDAF);
  v8 = *(_DWORD *)(v7 + 1);
  v9 = *(_DWORD *)(v7 + 3);
  v10 = *v7;
  v52 = v8 + 0x24;
  v51 = v9 + 0x24;
  v49 = 5 * v8;
  v11 = &V_ResTree.items[v8];
  switch ( v10 )
  {
    case 0:
      sprintf(*(char **)(v50 + 5), format, V_SpecNames[V_Game.races[byte_104BEA].Unknown_01], &V_ResTree.items[v8]);
      v11 = (T_ResItem *)v53;
      *(_WORD *)(v53 + 1) = 0x1F;
      *(_WORD *)&v11->name[3] = v8;
      break;
    case 1:
      v12 = *((_BYTE *)v7 + 6);
      sprintf(
        *(char **)(v50 + 5),
        format,
        V_PlanetItems.item[v12].name,
        v52,
        v52,
        *(unsigned __int16 *)(v8 + 0x42) - *(unsigned __int16 *)(v8 + 0x4C));
      *(_WORD *)(v53 + 1) = 0x1E;
      *(_WORD *)(v53 + 3) = v12;
      *(_WORD *)(a1 + 0xCCC) = 0x1D;
      LOWORD(v11) = *(_WORD *)(v8 + 0x14);
      *(_WORD *)(a1 + 0xCCE) = (_WORD)v11 + 5 * *(_WORD *)(v8 + 0x16);
      break;
    case 2:
      v32 = v7[1];
      sprintf(*(char **)(v50 + 5), format, V_SpecNames[V_Game.races[v32].Unknown_01]);
      v11 = (T_ResItem *)v53;
      *(_WORD *)(v53 + 3) = 0;
      *(_WORD *)&v11->name[1] = v32;
      break;
    case 3:
    case 4:
    case 5:
    case 6:
    case 7:
    case 0x14:
      v18 = *(_DWORD *)(a1 + 0xDAF);
      v19 = *(_DWORD *)(v18 + 2);
      if ( *(_BYTE *)(v19 + 0x58) != 4 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0xB3);
      }
      v20 = *(_DWORD *)(v19 + 0x59);
      if ( **(_WORD **)(a1 + 0xDAF) == 0x14 )
      {
        if ( *(_WORD *)(v20 + 0x44) == 1 )
        {
          v21 = 0xD;
        }
        else
        {
          v21 = 0xE;
        }
        sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v21);
        v45 = *(__int16 *)(v20 + 0x44);
        if ( *(_WORD *)(v20 + 0x5A) == 1 )
        {
          v22 = 0xD;
        }
        else
        {
          v22 = 0xE;
        }
        v23 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v22);
        sprintf(*(char **)(v50 + 5), format, v19 + 0x34, v20 + 0x1C, *(__int16 *)(v20 + 0x5A), v23, v45, sub_1CEA8);
      }
      else
      {
        sprintf(
          *(char **)(v50 + 5),
          format,
          v19 + 0x34,
          v20 + 0x1C,
          V_SpecNames[V_Game.races[*(_DWORD *)(v18 + 6)].Unknown_01]);
      }
      v24 = v53;
      *(_WORD *)(v53 + 1) = byte_104BEA + 0xE;
      LOWORD(v11) = *(char *)(v19 + 0xAA);
      *(_WORD *)(v24 + 3) = (_WORD)v11;
      break;
    case 8:
    case 9:
      v25 = *(_DWORD *)(a1 + 0xDAF);
      v26 = *(_DWORD *)(v25 + 2);
      v27 = *(_DWORD *)(v25 + 6);
      if ( *(_BYTE *)(v26 + 0x58) != 4 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0xCD);
      }
      if ( **(_WORD **)(a1 + 0xDAF) == 9 )
      {
        sprintf(*(char **)(v50 + 5), format, V_SpecNames[V_Game.races[v27].Unknown_01], *(_DWORD *)(v26 + 0x59) + 0x1C);
      }
      else
      {
        sprintf(*(char **)(v50 + 5), format, *(_DWORD *)(v26 + 0x59) + 0x1C);
      }
      *(_WORD *)(v53 + 1) = v27 + 0xE;
      LOWORD(v11) = *(char *)(v26 + 0xAA);
      *(_WORD *)(v53 + 3) = (_WORD)v11;
      break;
    case 0xA:
      sprintf(*(char **)(v50 + 5), format, V_SpecNames[V_Game.races[v8].Unknown_01]);
      v33 = v53;
      LOWORD(v11) = *(_WORD *)(*(_DWORD *)(a1 + 0xDAF) + 2);
      *(_WORD *)(v53 + 3) = 0;
      *(_WORD *)(v33 + 1) = (_WORD)v11;
      break;
    case 0xB:
    case 0xC:
      v34 = *(_DWORD *)(a1 + 0xDAF);
      v35 = *(_DWORD *)(v34 + 2);
      v36 = *(_DWORD *)(v34 + 6);
      if ( v36 )
      {
        sprintf(*(char **)(v50 + 5), format, v36 + 0x1C);
      }
      v37 = v53;
      v38 = byte_104BEA;
      *(_WORD *)(v53 + 3) = v35;
      LOWORD(v11) = v38 + 0xE;
      *(_WORD *)(v37 + 1) = (_WORD)v11;
      break;
    case 0xD:
      v39 = v8;
      if ( !v8 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x114);
      }
      sprintf(
        *(char **)(v50 + 5),
        format,
        v8 + 0x24,
        V_SpecNames[V_Game.races[*(unsigned __int8 *)(v8 + 0x57)].Unknown_01]);
      v40 = sub_1B270(&V_Type3_stru_10AE70.t13, "data\\planets.shp", 0);
      v41 = v53;
      *(_WORD *)(v53 + 1) = v40;
      if ( *(unsigned __int16 *)(v41 + 1) == 0xFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x118);
      }
      LOWORD(v11) = 5 * *(_WORD *)(v39 + 0x16) + *(_WORD *)(v39 + 0x14);
      *(_WORD *)(v53 + 3) = (_WORD)v11;
      break;
    case 0xF:
      sprintf(*(char **)(v50 + 5), format, v52);
      *(_WORD *)(v53 + 1) = 0x1D;
      LOWORD(v11) = 5 * *(_WORD *)(v8 + 0x16) + *(_WORD *)(v8 + 0x14);
      *(_WORD *)(v53 + 3) = (_WORD)v11;
      *(_WORD *)(a1 + 0xCCC) = 0x2C;
      *(_WORD *)(a1 + 0xCCE) = 2;
      break;
    case 0x10:
      sprintf(*(char **)(v50 + 5), format, v8 + 0x34, v51);
      v17 = v53;
      *(_WORD *)(v53 + 1) = byte_104BEA + 0xE;
      *(_WORD *)(v17 + 3) = *(char *)(v8 + 0xAA);
      *(_WORD *)(a1 + 0xCCC) = 0x1D;
      LOWORD(v11) = *(_WORD *)(v9 + 0x14);
      *(_WORD *)(a1 + 0xCCE) = (_WORD)v11 + 5 * *(_WORD *)(v9 + 0x16);
      break;
    case 0x11:
    case 0x12:
      v13 = *(_DWORD *)(a1 + 0xDAF);
      v14 = *(_WORD **)(v13 + 6);
      v15 = *(_DWORD *)(v13 + 2);
      sprintf(
        *(char **)(v50 + 5),
        format,
        v15 + 0x34,
        v14 + 0x12,
        v14 + 0x12,
        (unsigned __int16)v14[0x21] - (unsigned __int16)v14[0x26]);
      v16 = v53;
      *(_WORD *)(v53 + 1) = byte_104BEA + 0xE;
      *(_WORD *)(v16 + 3) = *(char *)(v15 + 0xAA);
      *(_WORD *)(a1 + 0xCCC) = 0x1D;
      LOWORD(v11) = v14[0xA];
      *(_WORD *)(a1 + 0xCCE) = (_WORD)v11 + 5 * v14[0xB];
      break;
    case 0x13:
      LOBYTE(v11) = sprintf(*(char **)(v50 + 5), format, v8 + 0x1C);
      break;
    case 0x15:
      v42 = v53;
      sprintf(*(char **)(v50 + 5), format, V_SpecNames[V_Game.races[byte_104BEA].Unknown_01]);
      *(_WORD *)(v42 + 3) = 0;
      LOBYTE(v11) = byte_104BEA;
      *(_WORD *)(v42 + 1) = byte_104BEA;
      break;
    case 0x16:
      sprintf(*(char **)(v50 + 5), format, V_SpecNames[V_Game.races[byte_104BEA].Unknown_01], v51, &V_ResTree.items[v8]);
      v11 = (T_ResItem *)v53;
      *(_WORD *)(v53 + 1) = 0x1F;
      *(_WORD *)&v11->name[3] = v8;
      *(_WORD *)(a1 + 0xCCC) = 0x1D;
      LOWORD(v11) = *(_WORD *)(v9 + 0x14);
      *(_WORD *)(a1 + 0xCCE) = (_WORD)v11 + 5 * *(_WORD *)(v9 + 0x16);
      break;
    case 0x17:
      v28 = v8;
      if ( *(_BYTE *)(v8 + 0x58) != 5 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0xE0);
      }
      v29 = *(_DWORD **)(v8 + 0x59);
      if ( !v29 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0xE3);
      }
      v30 = *v29;
      if ( ((1 << byte_104BEA) & *(unsigned __int8 *)(*v29 + 0x17)) == 0 )
      {
        v30 = v29[1];
      }
      sprintf(*(char **)(v50 + 5), format, v8 + 0x34, v30 + 0x1C);
      v31 = v53;
      *(_WORD *)(v53 + 1) = byte_104BEA + 0xE;
      LOWORD(v11) = *(char *)(v28 + 0xAA);
      *(_WORD *)(v31 + 3) = (_WORD)v11;
      break;
    case 0x19:
      sprintf(*(char **)(v50 + 5), format, V_SpecNames[V_Game.races[byte_104BEA].Unknown_01]);
      v43 = v53;
      LOBYTE(v11) = byte_104BEA;
      *(_WORD *)(v53 + 3) = 0;
      *(_WORD *)(v43 + 1) = (unsigned __int8)v11;
      break;
    default:
      return (char)v11;
  }
  return (char)v11;
}
// 26D02: conditional instruction was optimized away because bh.1!=4

//----- (000270F4) --------------------------------------------------------
unsigned int __fastcall sub_270F4(int a1, __int16 a2, int a3, int a4)
{
  int v5; // ebx

  if ( !a2 || (unsigned __int16)a2 > 1u )
  {
    return sub_2FD68(a1, a2, a3, a4);
  }
  *(_DWORD *)(a1 + 0x35) = 0xFFFFFFFF;
  v5 = *(_DWORD *)(a1 + 0xA7);
  *(_DWORD *)(a1 + 0x39) = 0xFFFFFFFF;
  (*(void (**)(void))(v5 + 0xC))();
  return 0;
}

//----- (0002712C) --------------------------------------------------------
void __fastcall __spoils<> Q_A2_sub_2712C(T_TypeA2 *a1)
{
  Q_A2_sub_2C830(a1);
  a1->b = (int)off_95C58;
}
// 95C58: using guessed type int (*off_95C58[5])();

//----- (0002713C) --------------------------------------------------------
int __fastcall sub_2713C(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95C18);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95C58;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95C58: using guessed type int (*off_95C58[5])();

//----- (00027184) --------------------------------------------------------
unsigned int __fastcall sub_27184(int a1, __int16 a2, int a3, int a4)
{
  if ( !a2 )
  {
    return sub_2F424(a1, a2, a3, a4);
  }
  if ( (unsigned __int16)a2 <= 1u )
  {
    sub_4F8CC(&V_SoundSystem, V_Game.races[byte_104BEA].Unknown_01 + 8, 0);
    return sub_2F424(a1, a2, a3, a4);
  }
  if ( a2 != 2 )
  {
    return sub_2F424(a1, a2, a3, a4);
  }
  sub_56B60(&V_Type3_stru_10AE70, 1, 1, 1);
  return 0xFFFFFFFF;
}

//----- (000271FC) --------------------------------------------------------
__int64 __fastcall sub_271FC(int a1)
{
  int Unknown_01; // ecx
  FILE *v2; // ebp
  char *v3; // esi
  char *v4; // edi
  char v5; // al
  char v6; // al
  char *v7; // esi
  char *v8; // edi
  char v9; // al
  char v10; // al
  char *v11; // esi
  char *v12; // edi
  char v13; // al
  char v14; // al
  char *v15; // esi
  char *v16; // edi
  char v17; // al
  char v18; // al
  char *v19; // esi
  char *v20; // edi
  char v21; // al
  char v22; // al
  char *v23; // esi
  char *v24; // edi
  char v25; // al
  char v26; // al
  char *v27; // ecx
  int v28; // esi
  char v29; // ah
  char v30; // bl
  char *v31; // ecx
  int v32; // esi
  char v33; // al
  char v34; // dh
  void *ShapeTable_sub_1B084; // eax
  UBYTE Unknown_02; // al
  const char *v37; // ecx
  int v38; // esi
  UBYTE v39; // al
  char v41[1004]; // [esp+0h] [ebp-624h] BYREF
  char s[204]; // [esp+3ECh] [ebp-238h] BYREF
  char v43[204]; // [esp+4B8h] [ebp-16Ch] BYREF
  char s1[60]; // [esp+584h] [ebp-A0h] BYREF
  PANE v45; // [esp+5C0h] [ebp-64h] BYREF
  int v46; // [esp+5D4h] [ebp-50h]
  char *v47; // [esp+5D8h] [ebp-4Ch]
  int v48; // [esp+5DCh] [ebp-48h]
  int v49; // [esp+5E0h] [ebp-44h] BYREF
  int v50; // [esp+5E4h] [ebp-40h]
  int v51; // [esp+5E8h] [ebp-3Ch]
  int v52; // [esp+5ECh] [ebp-38h]
  int v53; // [esp+5F0h] [ebp-34h]
  int v54; // [esp+5F4h] [ebp-30h]
  int v55; // [esp+5F8h] [ebp-2Ch]
  int v56; // [esp+5FCh] [ebp-28h]
  int v57; // [esp+600h] [ebp-24h]
  char *v58; // [esp+604h] [ebp-20h]
  int v59; // [esp+608h] [ebp-1Ch]
  int v60; // [esp+60Ch] [ebp-18h]

  v46 = a1;
  Unknown_01 = V_Game.races[byte_104BEA].Unknown_01;
  v58 = (char *)V_BigBuffer;
  V_BigBuffer[0] = 0;
  v41[0] = 0;
  v2 = Q_OpenFile_sub_1BB10("history.txt", 0);
  if ( !v2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x1C1);
  }
  v51 = 0;
  do
  {
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
    sscanf(s, "%s", s1);
    if ( !stricmp(s1, "SPECNUM") )
    {
      sscanf(s, "%s %d", s1, &v49);
      if ( Unknown_01 == v49 )
      {
        v51 = 1;
      }
    }
    else if ( !stricmp(s1, "END") )
    {
      sub_2620C("Species %d not found in history file.\n", Unknown_01);
      sub_261B8(0, "..\\eventwnd.cpp", 0x1E8);
    }
  }
  while ( !v51 );
  v48 = 0;
  if ( v51 != 2 )
  {
    v47 = V_SpecNames[Unknown_01];
    do
    {
      Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
      sscanf(s, "%s", s1);
      if ( !stricmp(s1, "SPECNUM") || !stricmp(s1, "END") )
      {
        v51 = 2;
      }
      else if ( !stricmp(s1, "POWER") )
      {
        v53 = 0;
        v56 = 0;
        sprintf(v43, "%s: ", v47);
        do
        {
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
          if ( !strnicmp(s, "ENDPOWER", 8u) )
          {
            v53 = 0xFFFFFFFF;
          }
          else
          {
            v56 += strlen(s);
            if ( v56 >= 0xC4 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x238);
            }
            v3 = s;
            v4 = &v43[strlen(v43)];
            do
            {
              v5 = *v3;
              *v4 = *v3;
              if ( !v5 )
              {
                break;
              }
              v6 = v3[1];
              v3 += 2;
              v4[1] = v6;
              v4 += 2;
            }
            while ( v6 );
          }
        }
        while ( !v53 );
      }
      else if ( !stricmp(s1, "INTRO") )
      {
        v59 = 0;
        v55 = 0;
        do
        {
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
          if ( !strnicmp(s, "ENDINTRO", 8u) )
          {
            v59 = 0xFFFFFFFF;
            v48 = 0xFFFFFFFF;
          }
          else
          {
            v55 += strlen(s);
            if ( v55 >= 0x3E4 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x24D);
            }
            v7 = s;
            v8 = &v41[strlen(v41)];
            do
            {
              v9 = *v7;
              *v8 = *v7;
              if ( !v9 )
              {
                break;
              }
              v10 = v7[1];
              v7 += 2;
              v8[1] = v10;
              v8 += 2;
            }
            while ( v10 );
          }
        }
        while ( !v59 );
      }
      else if ( !stricmp(s1, "PEACE") && v48 == 0xFFFFFFFF && !V_Game.Unknown_D8A[0x2A] )
      {
        v50 = 0;
        do
        {
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
          if ( !strnicmp(s, "ENDPEACE", 8u) )
          {
            v50 = 0xFFFFFFFF;
          }
          else
          {
            v55 += strlen(s);
            if ( v55 >= 0x3E4 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x25F);
            }
            v11 = s;
            v12 = &v41[strlen(v41)];
            do
            {
              v13 = *v11;
              *v12 = *v11;
              if ( !v13 )
              {
                break;
              }
              v14 = v11[1];
              v11 += 2;
              v12[1] = v14;
              v12 += 2;
            }
            while ( v14 );
          }
        }
        while ( !v50 );
      }
      else if ( !stricmp(s1, "NEUTRAL") && v48 == 0xFFFFFFFF && V_Game.Unknown_D8A[0x2A] == 1 )
      {
        v57 = 0;
        do
        {
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
          if ( !strnicmp(s, "ENDNEUTRAL", 0xAu) )
          {
            v57 = 0xFFFFFFFF;
          }
          else
          {
            v55 += strlen(s);
            if ( v55 >= 0x3E4 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x271);
            }
            v15 = s;
            v16 = &v41[strlen(v41)];
            do
            {
              v17 = *v15;
              *v16 = *v15;
              if ( !v17 )
              {
                break;
              }
              v18 = v15[1];
              v15 += 2;
              v16[1] = v18;
              v16 += 2;
            }
            while ( v18 );
          }
        }
        while ( !v57 );
      }
      else if ( !stricmp(s1, "HOSTILE") && v48 == 0xFFFFFFFF && V_Game.Unknown_D8A[0x2A] == 2 )
      {
        v52 = 0;
        do
        {
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
          if ( !strnicmp(s, "ENDHOSTILE", 0xAu) )
          {
            v52 = 0xFFFFFFFF;
          }
          else
          {
            v55 += strlen(s);
            if ( v55 >= 0x3E4 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x283);
            }
            v19 = s;
            v20 = &v41[strlen(v41)];
            do
            {
              v21 = *v19;
              *v20 = *v19;
              if ( !v21 )
              {
                break;
              }
              v22 = v19[1];
              v19 += 2;
              v20[1] = v22;
              v20 += 2;
            }
            while ( v22 );
          }
        }
        while ( !v52 );
      }
      else if ( !stricmp(s1, "TEXT") )
      {
        v60 = 0;
        v54 = 0;
        do
        {
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, s);
          if ( !strnicmp(s, "ENDTEXT", 7u) )
          {
            v60 = 0xFFFFFFFF;
          }
          else
          {
            v54 += strlen(s);
            if ( v54 >= 0xBB4 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x295);
            }
            v23 = s;
            v24 = &v58[strlen(v58)];
            do
            {
              v25 = *v23;
              *v24 = *v23;
              if ( !v25 )
              {
                break;
              }
              v26 = v23[1];
              v23 += 2;
              v24[1] = v26;
              v24 += 2;
            }
            while ( v26 );
          }
        }
        while ( !v60 );
      }
    }
    while ( v51 != 2 );
  }
  v27 = v41;
  fclose(v2);
  v28 = 0;
  if ( v41[0] )
  {
    while ( 1 )
    {
      if ( v28 >= 0x3E5 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x2AB);
      }
      v29 = *v27;
      if ( *v27 == 0xA )
      {
        break;
      }
      if ( v29 == 0x40 )
      {
        *v27 = 0xA;
      }
      else if ( v29 == 0x5F )
      {
        break;
      }
LABEL_95:
      v30 = *++v27;
      ++v28;
      if ( !v30 )
      {
        goto LABEL_96;
      }
    }
    *v27 = 0x20;
    goto LABEL_95;
  }
LABEL_96:
  if ( !v58 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x2B7);
  }
  v31 = v58;
  v32 = 0;
  if ( *v58 )
  {
    while ( 1 )
    {
      if ( v32 >= 0xBB5 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x2BD);
      }
      v33 = *v31;
      if ( *v31 == 0xA )
      {
        break;
      }
      if ( v33 == 0x40 )
      {
        *v31 = 0xA;
      }
      else if ( v33 == 0x5F )
      {
        break;
      }
LABEL_106:
      v34 = *++v31;
      ++v32;
      if ( !v34 )
      {
        goto LABEL_107;
      }
    }
    *v31 = 0x20;
    goto LABEL_106;
  }
LABEL_107:
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           (unsigned __int16)word_FFEAE[byte_104BEA]);
  VFX_shape_draw(&V_Type6_stru_D8654.pane, ShapeTable_sub_1B084, 0, 7, 0x2E);
  v45.window = *(WINDOW **)(v46 + 4);
  v45.x1 = 0x278;
  v45.x0 = 7;
  v45.y0 = 0x105;
  v45.y1 = 0x1D1;
  Unknown_02 = V_Game.races[byte_104BEA].Unknown_02;
  v37 = v58;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = v45.window;
  V_Type3_stru_10AE70.rect.x1 = 7;
  V_Type3_stru_10AE70.rect.y1 = v45.y0;
  V_Type3_stru_10AE70.rect.x2 = v45.x1;
  V_Type3_stru_10AE70.rect.y2 = v45.y1;
  v38 = v46;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0xA, 0xA, v37, 0, 4 * Unknown_02 + 0x13, 0xFF, 0x257);
  v45.window = *(WINDOW **)(v38 + 4);
  v45.x1 = 0x278;
  v45.y1 = 0xF5;
  v45.x0 = 0x138;
  v45.y0 = 0x2E;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = v45.window;
  V_Type3_stru_10AE70.rect.x1 = 0x138;
  V_Type3_stru_10AE70.rect.y1 = v45.y0;
  V_Type3_stru_10AE70.rect.x2 = v45.x1;
  V_Type3_stru_10AE70.rect.y2 = v45.y1;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0xA, 0xA, v41, 0, 0xF3, 0xFF, 0x126);
  v45.window = *(WINDOW **)(v46 + 4);
  v45.x0 = 7;
  v45.y0 = 7;
  v45.x1 = 0x278;
  v45.y1 = 0x25;
  Q_WINMGR_CPP_sub_53E38(&v45, 3, 3, byte_104BEA);
  v39 = V_Game.races[byte_104BEA].Unknown_02;
  *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = v45;
  return (unsigned int)sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0xA, v43, 2, 4 * v39 + 0x13, 0xFF, 0x25A);
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEAE: using guessed type __int16 word_FFEAE[7];
// 271FC: using guessed type char var_624[1004];
// 271FC: using guessed type char var_16C[204];

//----- (00027BF8) --------------------------------------------------------
void __fastcall __spoils<> Q_A2_sub_27BF8(P_TypeA2 a1)
{
  Q_A2_sub_2C830(a1);
  a1->b = (int)off_95C40;
}
// 95C40: using guessed type int (*off_95C40[5])();

//----- (00027C08) --------------------------------------------------------
int __fastcall sub_27C08(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95C04);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95C40;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95C40: using guessed type int (*off_95C40[5])();

//----- (00027C50) --------------------------------------------------------
unsigned int __fastcall sub_27C50(int a1, __int16 a2, int a3, int a4)
{
  __int16 v5; // ax
  char v7[2]; // [esp+0h] [ebp-10h] BYREF
  __int16 v8[7]; // [esp+2h] [ebp-Eh]

  v8[1] = a2;
  if ( a2 != 1 )
  {
    return sub_2F424(a1, v8[1], a3, a4);
  }
  LOBYTE(v8[0]) = 0;
  v7[1] = 0;
  v7[0] = 0;
  sub_2C2F8(&V_Type6_stru_D8654, v7);
  v5 = 5;
  dword_132B64 = 0;
  dword_132B60 = 0xFFFFFFFF;
  if ( V_Game.z7 == 1 )
  {
    v5 = V_Game.races[byte_104BEA].Unknown_01 + 8;
  }
  sub_4F8CC(&V_SoundSystem, v5, 0);
  return sub_2F424(a1, v8[1], a3, a4);
}
// 132B60: using guessed type int dword_132B60;
// 132B64: using guessed type int dword_132B64;

//----- (00027D18) --------------------------------------------------------
void __fastcall sub_27D18(int a1, int a2, int a3, int a4)
{
  LONG v4; // eax
  FILE *v5; // ebp
  char *v6; // esi
  char *v7; // edi
  char v8; // al
  char v9; // al
  char *v10; // esi
  char *v11; // edi
  char v12; // al
  char v13; // al
  LONG v14; // ebx
  LONG v15; // ecx
  char *v16; // esi
  char *v17; // edi
  char v18; // al
  char v19; // al
  char *v20; // ecx
  char v21; // bh
  char v22; // dl
  char *v23; // ecx
  char v24; // bl
  char v25; // ah
  char *v26; // ecx
  char v27; // dh
  char v28; // al
  void *ShapeTable_sub_1B084; // eax
  UBYTE Unknown_02; // al
  int v31; // ebp
  char *sub_1CEA8; // eax
  UBYTE v33; // al
  UBYTE v34; // al
  const char *v35; // ecx
  void *v36; // eax
  LONG v37; // edi
  LONG v38; // esi
  LONG v39; // ebx
  void *v40; // eax
  int racesNum; // eax
  void *v42; // eax
  __int16 v43; // bp
  void *v44; // eax
  UBYTE v45; // dl
  int v46; // esi
  signed int v47; // eax
  T_Ship *ships; // edi
  unsigned int v49; // ebp
  int shipsNum; // eax
  int raceIndex; // eax
  LONG v52; // ebx
  int v53; // ecx
  LONG v54; // ecx
  void *v55; // eax
  int v56; // esi
  int v57; // eax
  T_Planet *planets; // edi
  unsigned int v59; // ebp
  UBYTE byte57; // al
  LONG v61; // ebx
  int v62; // ecx
  int v63; // eax
  LONG y0; // edx
  int v65; // ecx
  void *v66; // eax
  LONG v67; // ebp
  int v68; // edi
  LONG v69; // esi
  void *v70; // eax
  LONG v71; // [esp-20h] [ebp-378h]
  LONG v72; // [esp-20h] [ebp-378h]
  LONG v73; // [esp-20h] [ebp-378h]
  LONG v74; // [esp-1Ch] [ebp-374h]
  LONG v75; // [esp-18h] [ebp-370h]
  LONG v76; // [esp-18h] [ebp-370h]
  LONG v77; // [esp-Ch] [ebp-364h]
  __int16 v78; // [esp-4h] [ebp-35Ch]
  char v79[204]; // [esp+0h] [ebp-358h] BYREF
  char v80[204]; // [esp+CCh] [ebp-28Ch] BYREF
  char v81[204]; // [esp+198h] [ebp-1C0h] BYREF
  char s1[60]; // [esp+264h] [ebp-F4h] BYREF
  PANE pane; // [esp+2A0h] [ebp-B8h] BYREF
  char s[16]; // [esp+2B4h] [ebp-A4h] BYREF
  T_Ship *v85; // [esp+2C4h] [ebp-94h]
  int v86; // [esp+2C8h] [ebp-90h]
  int aa2; // [esp+2CCh] [ebp-8Ch]
  LONG shape_number; // [esp+2D0h] [ebp-88h]
  int assert; // [esp+2D4h] [ebp-84h]
  int v90; // [esp+2D8h] [ebp-80h]
  int v91; // [esp+2DCh] [ebp-7Ch]
  LONG v92; // [esp+2E0h] [ebp-78h]
  int v93; // [esp+2E4h] [ebp-74h]
  int v94; // [esp+2E8h] [ebp-70h]
  int v95; // [esp+2ECh] [ebp-6Ch]
  int v96; // [esp+2F0h] [ebp-68h]
  int v97; // [esp+2F4h] [ebp-64h]
  int v98; // [esp+2F8h] [ebp-60h]
  int v99; // [esp+2FCh] [ebp-5Ch]
  int v100; // [esp+300h] [ebp-58h]
  int v101; // [esp+304h] [ebp-54h]
  int v102; // [esp+308h] [ebp-50h]
  int v103; // [esp+30Ch] [ebp-4Ch]
  int v104; // [esp+310h] [ebp-48h]
  T_Planet *v105; // [esp+314h] [ebp-44h]
  int v106; // [esp+318h] [ebp-40h]
  int v107; // [esp+31Ch] [ebp-3Ch]
  PANE *v108; // [esp+320h] [ebp-38h]
  unsigned int v109; // [esp+324h] [ebp-34h]
  int v110; // [esp+328h] [ebp-30h]
  LONG hotX; // [esp+32Ch] [ebp-2Ch]
  int v112; // [esp+330h] [ebp-28h]
  int v113; // [esp+334h] [ebp-24h]
  int v114; // [esp+338h] [ebp-20h]
  int v115; // [esp+33Ch] [ebp-1Ch]
  int v116; // [esp+340h] [ebp-18h]

  v86 = a1;
  aa2 = V_Game.aa2;
  v4 = V_Game.aa2 / 0xA - 1;
  shape_number = v4;
  if ( v4 >= 0 )
  {
    if ( v4 > 9 )
    {
      shape_number = 9;
    }
  }
  else
  {
    shape_number = 0;
  }
  V_BigBuffer[0] = 0;
  assert = (int)V_BigBuffer;
  switch ( V_Game.z7 )
  {
    case 1:
      sprintf(s, "end-xtnc.txt");
      break;
    case 2:
      sprintf(s, "end-dest.txt");
      break;
    case 3:
      sprintf(s, "end-capt.txt");
      break;
    case 4:
      sprintf(s, "end-unit.txt");
      break;
    case 5:
      sprintf(s, "end-ctrl.txt");
      break;
    default:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\eventwnd.cpp", 0x34E);
      break;
  }
  v5 = Q_OpenFile_sub_1BB10(s, 0);
  if ( !v5 )
  {
    sub_2620C("Couldn't open %s", (char)s);
    sub_261B8(0, "..\\eventwnd.cpp", 0x370);
  }
  v79[0] = 0;
  v91 = 0;
  do
  {
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v5, v81);
    sscanf(v81, "%s", s1);
    if ( !stricmp(s1, "END") )
    {
      v91 = 0xFFFFFFFF;
    }
    else if ( !stricmp(s1, "ENDDESC") )
    {
      v99 = 0;
      v100 = 0;
      do
      {
        Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v5, v81);
        if ( !strnicmp(v81, "ENDTEXT", 7u) )
        {
          v99 = 0xFFFFFFFF;
        }
        else
        {
          v100 += strlen(v81);
          if ( v100 >= 0xC4 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x3A1);
          }
          v6 = v81;
          v7 = &v79[strlen(v79)];
          do
          {
            v8 = *v6;
            *v7 = *v6;
            if ( !v8 )
            {
              break;
            }
            v9 = v6[1];
            v6 += 2;
            v7[1] = v9;
            v7 += 2;
          }
          while ( v9 );
        }
      }
      while ( !v99 );
    }
    else if ( !stricmp(s1, "CONGRAT") )
    {
      v101 = 0;
      v102 = 0;
      do
      {
        Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v5, v81);
        if ( !strnicmp(v81, "ENDTEXT", 7u) )
        {
          v101 = 0xFFFFFFFF;
        }
        else
        {
          v102 += strlen(v81);
          if ( v102 >= 0x3E4 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x3B3);
          }
          v10 = v81;
          v11 = (char *)(assert + strlen((const char *)assert));
          do
          {
            v12 = *v10;
            *v11 = *v10;
            if ( !v12 )
            {
              break;
            }
            v13 = v10[1];
            v10 += 2;
            v11[1] = v13;
            v11 += 2;
          }
          while ( v13 );
        }
      }
      while ( !v101 );
    }
    else if ( !stricmp(s1, "RANKS") )
    {
      v14 = 0;
      if ( shape_number > 0 )
      {
        v15 = shape_number;
        do
        {
          ++v14;
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v5, v81);
        }
        while ( v14 < v15 );
      }
      v16 = v81;
      Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v5, v81);
      v80[0] = 0;
      v17 = &v80[strlen(v80)];
      do
      {
        v18 = *v16;
        *v17 = *v16;
        if ( !v18 )
        {
          break;
        }
        v19 = v16[1];
        v16 += 2;
        v17[1] = v19;
        v17 += 2;
      }
      while ( v19 );
    }
  }
  while ( v91 != 0xFFFFFFFF );
  v20 = v79;
  fclose(v5);
  v92 = 0;
  if ( v79[0] )
  {
    while ( 1 )
    {
      if ( v92 >= 0xC5 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x3D7);
      }
      v21 = *v20;
      if ( *v20 == 0xA )
      {
        break;
      }
      if ( v21 == 0x40 )
      {
        *v20 = 0xA;
      }
      else if ( v21 == 0x5F )
      {
        break;
      }
LABEL_55:
      v22 = *++v20;
      ++v92;
      if ( !v22 )
      {
        goto LABEL_56;
      }
    }
    *v20 = 0x20;
    goto LABEL_55;
  }
LABEL_56:
  v92 = 0;
  v23 = v80;
  if ( v80[0] )
  {
    while ( 1 )
    {
      if ( v92 >= 0xC5 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x3E9);
      }
      v24 = *v23;
      if ( *v23 == 0xA )
      {
        break;
      }
      if ( v24 == 0x40 )
      {
        *v23 = 0xA;
      }
      else if ( v24 == 0x5F )
      {
        break;
      }
LABEL_64:
      v25 = *++v23;
      ++v92;
      if ( !v25 )
      {
        goto LABEL_65;
      }
    }
    *v23 = 0x20;
    goto LABEL_64;
  }
LABEL_65:
  if ( !assert )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x3F5);
  }
  v26 = (char *)assert;
  v92 = 0;
  if ( *(_BYTE *)assert )
  {
    while ( 1 )
    {
      if ( v92 >= 0x3E5 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\eventwnd.cpp", 0x3FB);
      }
      v27 = *v26;
      if ( *v26 == 0xA )
      {
        break;
      }
      if ( v27 == 0x40 )
      {
        *v26 = 0xA;
      }
      else if ( v27 == 0x5F )
      {
        break;
      }
LABEL_75:
      v28 = *++v26;
      ++v92;
      if ( !v28 )
      {
        goto LABEL_76;
      }
    }
    *v26 = 0x20;
    goto LABEL_75;
  }
LABEL_76:
  pane.window = *(WINDOW **)(v86 + 4);
  pane.x0 = 7;
  pane.y0 = 0xD7;
  pane.x1 = 0x12F;
  pane.y1 = 0x17D;
  if ( V_Game.z7 != 1 )
  {
    v77 = shape_number;
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                             (unsigned int)&V_Type3_stru_10AE70.t13,
                             (unsigned __int16)word_FFEF6);
    VFX_shape_draw(&pane, ShapeTable_sub_1B084, v77, 0x94, 0x53);
  }
  pane.x1 = 0x12F;
  pane.x0 = 7;
  pane.y0 = 0xD7;
  pane.y1 = 0x107;
  sprintf(v81, "%s", v79);
  Unknown_02 = V_Game.races[byte_104BEA].Unknown_02;
  v31 = aa2;
  *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = pane;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0xE, 0, v81, 1, 4 * Unknown_02 + 0x13, 0xFF, 0x118);
  pane.x1 = 0x12F;
  pane.y1 = 0x17D;
  pane.x0 = 7;
  pane.y0 = 0x14D;
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xF); // 15: "Your score is %d%%.\nThis gives you the title of %s"
  sprintf(v81, sub_1CEA8, v31, v80);
  v33 = V_Game.races[byte_104BEA].Unknown_02;
  *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = pane;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0, v81, 3, 4 * v33 + 0x13, 0xFF, 0x118);
  pane.x1 = 0x278;
  pane.x0 = 7;
  pane.y0 = 0x18D;
  pane.y1 = 0x1D1;
  v34 = V_Game.races[byte_104BEA].Unknown_02;
  v35 = (const char *)assert;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = pane.window;
  V_Type3_stru_10AE70.rect.x1 = 7;
  V_Type3_stru_10AE70.rect.y1 = pane.y0;
  V_Type3_stru_10AE70.rect.x2 = pane.x1;
  V_Type3_stru_10AE70.rect.y2 = pane.y1;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 7, 0, v35, 1, 4 * v34 + 0x13, 0xFF, 0x25A);
  v36 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
          (unsigned int)&V_Type3_stru_10AE70.t13,
          (unsigned __int16)word_FFEAE[byte_104BEA]);
  v37 = 0x2A;
  VFX_shape_draw(&V_Type6_stru_D8654.pane, v36, 0, 7, 7);
  v92 = 1;
  v109 = 2;
  v38 = 0x15B;
  Q_WINMGR_CPP_sub_53E38((PANE *)(v86 + 4), 0xA, 0xA, byte_104BEA);
  while ( 1 )
  {
    racesNum = V_Game.racesNum;
    if ( V_Game.racesNum <= v92 )
    {
      break;
    }
    if ( v92 == 4 )
    {
      v38 = 0x15B;
      v37 = 0x85;
    }
    v42 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
            (unsigned int)&V_Type3_stru_10AE70.t13,
            (unsigned __int16)word_FFEA0[v109 / 2]);
    VFX_shape_transform(&V_Type6_stru_D8654.pane, v42, 0, v38, v37, V_BigBuffer, 0, 0x8000, 0x8000, 0);
    v43 = v92;
    v78 = v92;
    v44 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEF2);
    sub_53EB8(&V_Type6_stru_D8654.pane, v44, 3, v38, v37, v78);
    Q_WINMGR_CPP_sub_53E38(&V_Type6_stru_D8654.pane, v38 - 7, v37 + 0x21, v43);
    v45 = V_Game.races[byte_104BEA].Unknown_1C0[v92];
    v39 = 0xFFFFFFFF;
    if ( v45 == 3 )
    {
      v39 = 9;
    }
    else if ( v45 == 2 )
    {
      v39 = 8;
    }
    if ( v39 != 0xFFFFFFFF )
    {
      v40 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEF2);
      VFX_shape_draw(&V_Type6_stru_D8654.pane, v40, v39, v38 - 7, v37 + 0x21);
    }
    v38 += 0x3E;
    v109 += 2;
    ++v92;
  }
  v93 = 0x278;
  LOWORD(racesNum) = word_FFEBC[byte_104BEA];
  pane.x0 = 0x138;
  v115 = racesNum;
  pane.y0 = 7;
  pane.x1 = 0x278;
  pane.y1 = 0x17D;
  v46 = 7;
  v47 = sub_40224(&V_Game.races[byte_104BEA].Unknown_00, 0, 0);
  v94 = v47;
  if ( v47 < 0x14 )
  {
    v46 = 7 - 7 * (0x14 - v47) / 0x11;
  }
  if ( v46 >= 0 )
  {
    if ( v46 > 6 )
    {
      v46 = 6;
    }
  }
  else
  {
    v46 = 0;
  }
  v95 = v94 / (v46 + 1);
  v96 = 0;
  v98 = 0x9F;
  v97 = v93 - 0x212;
  if ( v93 - 0x212 < 2 )
  {
    v97 = 2;
  }
  v92 = 0;
  v90 = 0x208;
  v103 = 0x11;
  ships = V_Game.ships;
  v49 = 0xFFFFFF00 * v46 + 0x700;
  while ( 1 )
  {
    shipsNum = V_Game.shipsNum;
    if ( V_Game.shipsNum <= v92 )
    {
      break;
    }
    raceIndex = ships->raceIndex;
    v85 = ships;
    if ( raceIndex == byte_104BEA )
    {
      v52 = 0;
      if ( v96 > v95 && v46 > 0 )
      {
        v49 += 0x100;
        --v46;
      }
      if ( v46 > 0 )
      {
        VFX_shape_lookaside(&(*V_Type6_stru_D8654.hazeTables)[0][v49]);
        v52 = 1;
      }
      v53 = v90 - pane.x0;
      v54 = rand() % v97 + v53;
      hotX = v103 - pane.y0;
      v75 = hotX + rand() % v98;
      v71 = v85->Unknown_AA[0];
      v55 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v115);
      VFX_shape_transform(&pane, v55, v71, v54, v75, V_BigBuffer, 0, 0x5555, 0x5555, v52);
    }
    ++ships;
    ++v92;
    ++v96;
  }
  LOWORD(shipsNum) = word_FFEDA;
  v116 = shipsNum;
  v112 = 0x1FF;
  v56 = 7;
  v57 = sub_402E0(&V_Game.races[byte_104BEA].Unknown_00);
  if ( v57 < 0x14 )
  {
    v56 = 7 - 7 * (0x14 - v57) / 0x11;
  }
  if ( v56 >= 0 )
  {
    if ( v56 > 6 )
    {
      v56 = 6;
    }
  }
  else
  {
    v56 = 0;
  }
  v113 = v94 / (v56 + 1);
  v110 = v112 - 0x14C;
  v114 = 0;
  v104 = 0x97;
  if ( v112 - 0x14C < 2 )
  {
    v110 = 2;
  }
  planets = V_Game.planets;
  v92 = 0;
  v106 = 0x142;
  v107 = 0xDC;
  v59 = 0xFFFFFF00 * v56 + 0x700;
  while ( V_Game.planetsNum > v92 )
  {
    byte57 = planets->byte57;
    v105 = planets;
    if ( byte57 == byte_104BEA )
    {
      v61 = 0;
      if ( v114 > v113 && v56 > 0 )
      {
        v59 += 0x100;
        --v56;
      }
      if ( v56 > 0 )
      {
        VFX_shape_lookaside(&(*V_Type6_stru_D8654.hazeTables)[0][v59]);
        v61 = 1;
      }
      v62 = v106 - pane.x0;
      v63 = rand();
      y0 = pane.y0;
      hotX = v63 % v110 + v62;
      v65 = v107;
      v76 = v65 - y0 + rand() % v104;
      v74 = hotX;
      v72 = 5 * v105->type + v105->size;
      v66 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v116);
      VFX_shape_transform(&pane, v66, v72, v74, v76, V_BigBuffer, 0, 0x5555, 0x5555, v61);
    }
    ++planets;
    ++v92;
    ++v114;
  }
  v67 = 0xCB;
  v68 = 0;
  v92 = 0;
  v69 = 0x213;
  v108 = (PANE *)(v86 + 4);
  while ( (unsigned __int16)V_ResTree.num > v92 )
  {
    if ( v92 && !(v92 % 6) )
    {
      v69 = 0x213;
      v67 += 0x11;
    }
    if ( ((1 << byte_104BEA) & (char)V_ResTree.items[v68].z2[0]) != 0 )
    {
      v73 = v92;
      v70 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEDE);
      VFX_shape_transform(v108, v70, v73, v69, v67, V_BigBuffer, 0, 0x5555, 0x5555, 0);
    }
    v69 += 0x11;
    ++v68;
    ++v92;
  }
  sub_552CC(&V_Type3_stru_10AE70, &V_Type6_stru_D8654.pane);
}
// 28784: conditional instruction was optimized away because %var_60.4==9F
// 289D7: conditional instruction was optimized away because %var_48.4==97
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEA0: using guessed type __int16 word_FFEA0[7];
// FFEAE: using guessed type __int16 word_FFEAE[7];
// FFEBC: using guessed type __int16 word_FFEBC[7];
// 27D18: using guessed type char var_358[204];
// 27D18: using guessed type char var_28C[204];

//----- (00028C40) --------------------------------------------------------
void __cdecl callback_fn()
{
  dword_D8650 = 0xFFFFFFFF;
}
// D8650: using guessed type int dword_D8650;

//----- (00028C4C) --------------------------------------------------------
int __fastcall sub_28C4C(__int16 *a1, __int16 *a2)
{
  return *a1 - *a2;
}

//----- (00028C58) --------------------------------------------------------
int __fastcall Q_NC_sub_28C58(int result, __int16 a2)
{
  __int16 v2; // cx

  v2 = *(_WORD *)(result + 6);
  *(_WORD *)(result + 2) += a2;
  *(_WORD *)(result + 6) = a2 + v2;
  return result;
}

//----- (00028C74) --------------------------------------------------------
void __fastcall __spoils<> sub_28C74(P_Type2 a1)
{
  int *__shifted(T_Type2,0x90A) v1; // eax
  P_Type2 v2; // ecx

  Q_InitFileInfo_sub_1BB78(&a1->a);
  v1 = (int *__shifted(T_Type2,0x90A))a1->gap90A;
  sub_2B2C0(v1);
  v2 = ADJ(v1);
  v2->dword198 = 0;
  v2->dword1A8 = 0;
  v2->dword1AC = 0;
  v2->dword1B0 = 0;
  v2->dword1B4 = 0;
  v2->dword19C = 0xFFFFFFFF;
  memset(ADJ(v1)->char118, 0, sizeof(ADJ(v1)->char118));
  v2->dword1E4 = 0;
  v2->dword1E8 = 0;
  v2->dword1EC = 0;
  v2->dword1F0 = 0;
  v2->dword946 = 0;
  memset(v2->char204, 0, sizeof(v2->char204));
  memset(v2->char808, 0, sizeof(v2->char808));
  v2->word804 = 0;
  v2->word806 = 0;
  v2->word908 = 0;
  v2->dword92E = 0;
  v2->word932 = 0;
  v2->word934 = 0;
  v2->dword936 = 0xFFFFFFFF;
  v2->dword1E0 = 0x12;
  v2->dword93A = 0;
  v2->dword93E = 0xFFFFFFFF;
  v2->dword942 = 0;
}

//----- (00028DA4) --------------------------------------------------------
void __fastcall sub_28DA4(int a1)
{
  int v2; // edx
  int i; // ebx
  int v4; // ebx
  int v5; // edx
  void **v6; // eax

  if ( *(_DWORD *)(a1 + 0x1B0) == 0xFFFFFFFF )
  {
    sub_2627C(*(void **)(a1 + 0x1AC));
  }
  operator delete(*(void **)(a1 + 0x1AC));
  if ( *(_DWORD *)(a1 + 0x1B4) == 0xFFFFFFFF )
  {
    sub_2627C(*(void **)(a1 + 0x198));
    operator delete(*(void **)(a1 + 0x198));
    sub_2627C(*(void **)(a1 + 0x1A8));
    operator delete(*(void **)(a1 + 0x1A8));
  }
  v2 = a1;
  for ( i = 0; i < *(__int16 *)(a1 + 0x908); ++i )
  {
    sub_2627C(*(void **)(v2 + 0x808));
    v2 += 8;
  }
  operator delete(*(void **)(v2 + 0x808));
  v4 = 0;
  v5 = a1;
  while ( v4 < *(__int16 *)(a1 + 0x806) )
  {
    if ( *(_WORD *)(v5 + 0x206) == 0xA )
    {
      sub_2627C(*(void **)(v5 + 0x20C));
      operator delete(*(void **)(v5 + 0x20C));
      *(_DWORD *)(v5 + 0x20C) = 0;
    }
    v5 += 0xC;
    ++v4;
  }
  if ( *(_DWORD *)(a1 + 0x92E) )
  {
    sub_2627C(*(void **)(a1 + 0x92E));
  }
  operator delete(*(void **)(a1 + 0x92E));
  sub_2AD08(a1);
  v6 = sub_2B2E0((void **)(a1 + 0x90A));
  Q_CloseFileAndDelete_sub_1BBC8((P_FileInfo)((char *)v6 + 0xFFFFF6F6));
}
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (00028EB4) --------------------------------------------------------
UBYTE *__fastcall sub_28EB4(int a1, const char *a2, int a3, int a4, int a5)
{
  UBYTE *result; // eax
  int v7; // eax
  int v8; // eax
  int v9; // eax

  if ( !a2 )
  {
    return 0;
  }
  sub_2A1DC(a1, "SUBTITLE.TXT");
  if ( Q_OpenFile_sub_1BBFC((P_FileInfo)a1, a2, 0x200, 0) )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0xE9);
    return 0;
  }
  if ( Q_ReadFile_sub_1BF94((P_FileInfo)a1, (void *)(a1 + 0x118), 0x80u) == 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0xE3);
    return 0;
  }
  if ( *(unsigned __int16 *)(a1 + 0x11C) != 0xAF12 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0xEF);
    return 0;
  }
  if ( a4 == 0xFFFFFFFF )
  {
    v7 = (0x280 - *(unsigned __int16 *)(a1 + 0x120)) / 2;
  }
  else
  {
    v7 = a4;
  }
  *(_DWORD *)(a1 + 0x1A0) = v7;
  if ( a5 == 0xFFFFFFFF )
  {
    v8 = (0x1E0 - *(unsigned __int16 *)(a1 + 0x122)) / 2;
  }
  else
  {
    v8 = a5;
  }
  *(_DWORD *)(a1 + 0x1BC) = 0x27F;
  *(_DWORD *)(a1 + 0x1C0) = 0x1DF;
  *(_DWORD *)(a1 + 0x1A4) = v8;
  *(_DWORD *)(a1 + 0x1CC) = a1 + 0x1B8;
  if ( a3 )
  {
    *(_DWORD *)(a1 + 0x1B0) = 0;
    *(_DWORD *)(a1 + 0x1AC) = a3;
  }
  else
  {
    result = V_Type6_stru_D8654.window.buffer;
    *(_DWORD *)(a1 + 0x1AC) = V_Type6_stru_D8654.window.buffer;
    if ( !result )
    {
      return result;
    }
    *(_DWORD *)(a1 + 0x1B0) = 0;
  }
  *(_DWORD *)(a1 + 0x1C4) = 0;
  v9 = *(_DWORD *)(a1 + 0x1AC);
  *(_DWORD *)(a1 + 0x1C8) = 0;
  *(_DWORD *)(a1 + 0x1B8) = v9;
  return (UBYTE *)0xFFFFFFFF;
}

//----- (00029038) --------------------------------------------------------
int __fastcall sub_29038(int a1, size_t a2, unsigned int a3, int a4, int a5, int a6)
{
  int v8; // edi
  int v9; // edx
  void *v10; // eax
  int v12; // eax
  size_t v13; // eax
  int v14; // edx
  int v15; // ebp
  int v16; // eax

  v8 = a3;
  *(_WORD *)(a1 + 0x804) = 0;
  *(_WORD *)(a1 + 0x92A) = 0;
  *(_DWORD *)(a1 + 0x942) = 0;
  *(_WORD *)(a1 + 0x92C) = 0;
  if ( a2 < a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x15E);
  }
  if ( a2 - a4 < a3 )
  {
    v8 = a2 - a4;
  }
  v9 = *(_DWORD *)(a1 + 0x1B4);
  *(_DWORD *)(a1 + 0x19C) = 0xFFFFFFFF;
  if ( v9 == 0xFFFFFFFF )
  {
    sub_2627C(*(void **)(a1 + 0x198));
    operator delete[](*(void **)(a1 + 0x198));
    sub_2627C(*(void **)(a1 + 0x1A8));
    operator delete[](*(void **)(a1 + 0x1A8));
    *(_DWORD *)(a1 + 0x198) = 0;
    *(_DWORD *)(a1 + 0x1A8) = 0;
    *(_DWORD *)(a1 + 0x1B4) = 0;
  }
  if ( a6 )
  {
    *(_DWORD *)(a1 + 0x1E8) = a6;
  }
  if ( *(_DWORD *)(a1 + 0x1E8)
    || (v10 = operator new[](a2), Q_RegisterData_sub_2625C(v10, 1, "FLIC BUFFER"), (*(_DWORD *)(a1 + 0x1E8) = v10) != 0) )
  {
    v12 = *(_DWORD *)(a1 + 0x1E8);
    *(_DWORD *)(a1 + 0x1F4) = a2;
    v13 = a2 + v12;
    v14 = *(_DWORD *)(a1 + 0x168);
    *(_DWORD *)(a1 + 0x1EC) = v13;
    *(_DWORD *)(a1 + 0x1F0) = v13 - a4;
    v15 = *(_DWORD *)(a1 + 0x1F0) - v8;
    *(_DWORD *)(a1 + 0x1FC) = a5;
    *(_DWORD *)(a1 + 0x1E4) = v15;
    sub_1BECC((int *)a1, v14, 0);
    *(_DWORD *)(a1 + 0x200) = ((int)sub_1BFD4((int *)a1, *(void **)(a1 + 0x1E4), v8, 0x40u, (int)sub_2BCF4) >= v8) - 1;
    VFX_area_wipe(0, 0, 639, 479, 0);
    v16 = *(_DWORD *)(a1 + 0x1E4);
    *(_DWORD *)(a1 + 0x198) = v16;
    *(_DWORD *)(a1 + 0x1A8) = v16 + 0x10;
    *(_DWORD *)(a1 + 0x1E4) = *(_DWORD *)(a1 + 0x1E8);
    *(_DWORD *)(a1 + 0x1F8) = *(_DWORD *)(a1 + 0x198) - *(_DWORD *)(a1 + 0x1E4);
    return 0xFFFFFFFF;
  }
  else
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0x183);
    return 0;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);

//----- (000291F8) --------------------------------------------------------
unsigned int __fastcall Q_NC_sub_291F8(int a1)
{
  int v2; // edx
  int v3; // edx
  int v5; // edi
  _DWORD *v6; // edi
  int i; // ebp
  _DWORD *v8; // edx
  unsigned __int16 v9; // ax
  unsigned __int16 *v10; // edx

  v2 = *(_DWORD *)(a1 + 0x19C) + 1;
  *(_DWORD *)(a1 + 0x19C) = v2;
  if ( v2 )
  {
    if ( *(unsigned __int16 *)(a1 + 0x11E) >= *(int *)(a1 + 0x19C) )
    {
      goto LABEL_6;
    }
    v3 = *(_DWORD *)(a1 + 0x16C);
    *(_DWORD *)(a1 + 0x19C) = 1;
  }
  else
  {
    v3 = *(_DWORD *)(a1 + 0x168);
  }
  sub_1BECC((int *)a1, v3, 0);
LABEL_6:
  if ( Q_ReadFile_sub_1BF94((P_FileInfo)a1, *(void **)(a1 + 0x198), 0x10u) == 0xFFFFFFFF )
  {
    return 0;
  }
  v5 = **(_DWORD **)(a1 + 0x198) - 0x10;
  if ( v5 < 0 || v5 > 0x4B000 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x1DD);
  }
  Q_ReadFile_sub_1BF94((P_FileInfo)a1, *(void **)(a1 + 0x1A8), **(_DWORD **)(a1 + 0x198) - 0x10);
  if ( *(unsigned __int16 *)(*(_DWORD *)(a1 + 0x198) + 4) != 0xF1FA )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x1E0);
  }
  v6 = *(_DWORD **)(a1 + 0x1A8);
  for ( i = 0; i < *(unsigned __int16 *)(*(_DWORD *)(a1 + 0x198) + 6); ++i )
  {
    v8 = v6;
    v6 = (_DWORD *)((char *)v6 + *v6);
    v9 = *((_WORD *)v8 + 2);
    v10 = (unsigned __int16 *)v8 + 3;
    if ( v9 < 0xFu )
    {
      if ( v9 < 4u )
      {
        goto LABEL_18;
      }
      if ( v9 <= 4u )
      {
        sub_29C6C(a1, v10);
      }
      else
      {
        if ( v9 != 7 )
        {
LABEL_18:
          Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x221);
        }
        sub_2AD40(v10, *(_DWORD *)(a1 + 0x1A0), *(_DWORD *)(a1 + 0x1A4));
      }
    }
    else if ( v9 <= 0xFu )
    {
      sub_29D54(a1, (unsigned __int8 *)v10);
    }
    else if ( v9 <= 0x10u )
    {
      sub_29F58(a1, v10);
    }
    else if ( v9 != 0x12 )
    {
      goto LABEL_18;
    }
  }
  return 0xFFFFFFFF;
}

//----- (0002936C) --------------------------------------------------------
unsigned int __fastcall Q_NC_sub_2936C(int a1)
{
  int v2; // ebx
  int v4; // esi
  int i; // edi
  unsigned __int16 *v6; // edx
  unsigned __int16 v7; // ax
  unsigned __int16 v8; // ax
  _DWORD *v9; // esi
  _DWORD *v10; // esi
  _BYTE *v11; // edi
  int v12; // edx
  void *v13; // edi
  const void *v14; // esi
  signed int v15; // ecx
  int v16; // ecx
  int v17; // edx
  int v18; // esi
  int v19; // edx
  unsigned int v20; // ebx
  unsigned int v21; // eax

  v2 = ++*(_DWORD *)(a1 + 0x19C);
  if ( *(unsigned __int16 *)(a1 + 0x11E) <= v2 )
  {
    return 0;
  }
  if ( !v2 )
  {
    VFX_area_wipe(0, 0, 0x27F, 0x1DF, *(_DWORD *)(a1 + 0x926));
  }
  if ( *(_DWORD *)(a1 + 0x946) == 0xFFFFFFFF )
  {
    sub_29B24((_DWORD *)a1);
  }
  if ( *(unsigned __int16 *)(*(_DWORD *)(a1 + 0x198) + 4) != 0xF1FA )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x246);
  }
  v4 = *(_DWORD *)(a1 + 0x1A8);
  for ( i = 0; i < *(unsigned __int16 *)(*(_DWORD *)(a1 + 0x198) + 6); ++i )
  {
    v6 = (unsigned __int16 *)(v4 + 6);
    v7 = *(_WORD *)(v4 + 4);
    v4 += *(_DWORD *)v4;
    if ( v7 < 0xFu )
    {
      if ( v7 < 4u )
      {
        goto LABEL_14;
      }
      if ( v7 <= 4u )
      {
        sub_29C6C(a1, v6);
      }
      else
      {
        if ( v7 != 7 )
        {
LABEL_14:
          Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x26C);
        }
        sub_2AD40(v6, *(_DWORD *)(a1 + 0x1A0), *(_DWORD *)(a1 + 0x1A4));
      }
    }
    else if ( v7 <= 0xFu )
    {
      sub_29D54(a1, (unsigned __int8 *)v6);
    }
    else if ( v7 <= 0x10u )
    {
      sub_29F58(a1, v6);
    }
    else if ( v7 != 0x12 )
    {
      goto LABEL_14;
    }
  }
  v8 = *(_WORD *)(a1 + 0x92A);
  if ( v8 )
  {
    if ( v8 <= 1u )
    {
      sub_2C4C0(&V_Type6_stru_D8654, *(__int16 *)(a1 + 0x932), *(__int16 *)(a1 + 0x934));
    }
    else if ( v8 == 2 )
    {
      sub_2C418(&V_Type6_stru_D8654, *(__int16 *)(a1 + 0x932), *(_WORD *)(a1 + 0x934));
    }
  }
  if ( *(__int16 *)(a1 + 0xC * *(__int16 *)(a1 + 0x804) + 0x204) == *(_DWORD *)(a1 + 0x19C) )
  {
    sub_2AA88(a1);
  }
  v9 = *(_DWORD **)(a1 + 0x198);
  *(_DWORD *)(a1 + 0x1F8) += *v9;
  v10 = (_DWORD *)((char *)v9 + *v9);
  v11 = *(_BYTE **)(a1 + 0x1F0);
  *(_DWORD *)(a1 + 0x198) = v10;
  if ( v10 < (_DWORD *)v11 )
  {
    v12 = (char *)(v10 + 4) - v11;
    if ( v12 <= 0 )
    {
      v15 = (char *)v10 + *v10 - v11;
      if ( v15 <= 0 )
      {
        goto LABEL_42;
      }
      if ( v15 >= *(_DWORD *)(a1 + 0x1EC) - (int)v11 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x2D2);
      }
      v14 = *(const void **)(a1 + 0x1E8);
      v13 = *(void **)(a1 + 0x1F0);
    }
    else
    {
      qmemcpy(v11, *(const void **)(a1 + 0x1E8), (char *)(v10 + 4) - v11);
      v13 = v10 + 4;
      v14 = (const void *)(v12 + *(_DWORD *)(a1 + 0x1E8));
      v15 = **(_DWORD **)(a1 + 0x198) - 0x10;
    }
    qmemcpy(v13, v14, v15);
    goto LABEL_42;
  }
  *(_DWORD *)(a1 + 0x198) = (char *)v10 + *(_DWORD *)(a1 + 0x1E8) - v11;
LABEL_42:
  v16 = *(_DWORD *)(a1 + 0x200);
  *(_DWORD *)(a1 + 0x1A8) = *(_DWORD *)(a1 + 0x198) + 0x10;
  if ( !v16 )
  {
    if ( *(_DWORD *)(a1 + 0x1F8) < *(_DWORD *)(a1 + 0x1FC) )
    {
      v17 = *(_DWORD *)(a1 + 0x1F8);
    }
    else
    {
      v17 = *(_DWORD *)(a1 + 0x1FC);
    }
    v18 = v17;
    if ( v17 + *(_DWORD *)(a1 + 0x1E4) - *(_DWORD *)(a1 + 0x1F0) > 0 )
    {
      v18 = *(_DWORD *)(a1 + 0x1F0) - *(_DWORD *)(a1 + 0x1E4);
    }
    if ( Q_ReadFile_sub_1BF94((P_FileInfo)a1, *(void **)(a1 + 0x1E4), v18) < v18 )
    {
      *(_DWORD *)(a1 + 0x200) = 0xFFFFFFFF;
    }
    v19 = *(_DWORD *)(a1 + 0x1F8);
    v20 = *(_DWORD *)(a1 + 0x1F0);
    *(_DWORD *)(a1 + 0x1E4) += v18;
    v21 = *(_DWORD *)(a1 + 0x1E4);
    *(_DWORD *)(a1 + 0x1F8) = v19 - v18;
    if ( v21 >= v20 )
    {
      *(_DWORD *)(a1 + 0x1E4) = *(_DWORD *)(a1 + 0x1E8);
    }
  }
  if ( (unsigned int)(*(_DWORD *)(a1 + 0x1EC)
                    + **(_DWORD **)(a1 + 0x198)
                    + *(_DWORD *)(a1 + 0x1F8)
                    - *(_DWORD *)(a1 + 0x1F0)) >= *(_DWORD *)(a1 + 0x1F4) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x305);
  }
  return 0xFFFFFFFF;
}

//----- (000296B4) --------------------------------------------------------
unsigned int __fastcall sub_296B4(int a1, int a2, int a3, int a4)
{
  int v5; // edx
  int v7; // eax
  _DWORD *v8; // esi
  int i; // edi
  _DWORD *v10; // edx
  unsigned __int16 v11; // ax
  unsigned __int16 *v12; // edx
  unsigned __int16 v13; // ax
  _DWORD *v14; // esi
  unsigned int v15; // edx
  int v16; // edx
  void *v17; // edi
  const void *v18; // esi
  signed int v19; // ecx
  char *v20; // ecx
  int v21; // esi
  int v22; // edx
  int v23; // esi
  int v24; // edi
  unsigned int v25; // edx
  unsigned int v26; // eax
  int v27; // esi
  int v28; // edx
  int v29; // ecx
  int v30; // ecx
  unsigned int v31; // esi
  unsigned int v32; // eax

  if ( dword_D8650 )
  {
    if ( *(_DWORD *)(a1 + 0x946) == 0xFFFFFFFF )
    {
      sub_29B24((_DWORD *)a1);
    }
    if ( dword_D8650 != 0xFFFFFFFF && *(_DWORD *)(a1 + 0x93A) != 0xFFFFFFFF )
    {
      goto LABEL_54;
    }
    if ( !*(_DWORD *)(a1 + 0x93A) )
    {
      _disable();
      dword_D8650 = 0;
      _enable();
    }
    v5 = *(_DWORD *)(a1 + 0x19C) + 1;
    *(_DWORD *)(a1 + 0x19C) = v5;
    if ( !v5 )
    {
      VFX_area_wipe(0, 0, 639, 479, *(_DWORD *)(a1 + 0x926));
    }
    if ( *(unsigned __int16 *)(a1 + 0x11E) <= *(int *)(a1 + 0x19C) )
    {
      return 0;
    }
    v7 = *(unsigned __int16 *)(*(_DWORD *)(a1 + 0x198) + 4);
    ++dword_A0CF8;
    if ( v7 != 0xF1FA )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x32E);
    }
    v8 = *(_DWORD **)(a1 + 0x1A8);
    for ( i = 0; i < *(unsigned __int16 *)(*(_DWORD *)(a1 + 0x198) + 6); ++i )
    {
      v10 = v8;
      v8 = (_DWORD *)((char *)v8 + *v8);
      v11 = *((_WORD *)v10 + 2);
      v12 = (unsigned __int16 *)v10 + 3;
      if ( v11 < 0xFu )
      {
        if ( v11 < 4u )
        {
          goto LABEL_19;
        }
        if ( v11 <= 4u )
        {
          *(_WORD *)(a1 + 0x92C) = 0;
          sub_29C6C(a1, v12);
        }
        else
        {
          if ( v11 != 7 )
          {
LABEL_19:
            Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x355);
          }
          sub_2AD40(v12, *(_DWORD *)(a1 + 0x1A0), *(_DWORD *)(a1 + 0x1A4));
        }
      }
      else if ( v11 <= 0xFu )
      {
        sub_29D54(a1, (unsigned __int8 *)v12);
      }
      else if ( v11 <= 0x10u )
      {
        sub_29F58(a1, v12);
      }
      else if ( v11 != 0x12 )
      {
        goto LABEL_19;
      }
    }
    v13 = *(_WORD *)(a1 + 0x92A);
    if ( v13 )
    {
      if ( v13 <= 1u )
      {
        sub_2C4C0(&V_Type6_stru_D8654, *(__int16 *)(a1 + 0x932), *(__int16 *)(a1 + 0x934));
      }
      else if ( v13 == 2 )
      {
        sub_2C418(&V_Type6_stru_D8654, *(__int16 *)(a1 + 0x932), *(_WORD *)(a1 + 0x934));
      }
    }
    if ( *(__int16 *)(a1 + 0xC * *(__int16 *)(a1 + 0x804) + 0x204) == *(_DWORD *)(a1 + 0x19C) )
    {
      sub_2AA88(a1);
    }
    if ( *(_WORD *)(a1 + 0x92C) )
    {
      Q_FadePalette_sub_2C5E4(&V_Type6_stru_D8654, *(_BYTE *)(a1 + 0x92C) - 1);
      if ( (__int16)++*(_WORD *)(a1 + 0x92C) > 0x40 )
      {
        *(_WORD *)(a1 + 0x92C) = 0;
      }
    }
    if ( *(_DWORD *)(a1 + 0x93A) == 0xFFFFFFFF && *(_DWORD *)(a1 + 0x93E) == *(_DWORD *)(a1 + 0x19C) )
    {
      getch();
      *(_DWORD *)(a1 + 0x93A) = 0;
      *(_DWORD *)(a1 + 0x93E) = 0xFFFFFFFF;
    }
    *(_DWORD *)(a1 + 0x1F8) += **(_DWORD **)(a1 + 0x198);
    v14 = (_DWORD *)(**(_DWORD **)(a1 + 0x198) + *(_DWORD *)(a1 + 0x198));
    v15 = *(_DWORD *)(a1 + 0x1F0);
    *(_DWORD *)(a1 + 0x198) = v14;
    if ( (unsigned int)v14 >= v15 )
    {
      *(_DWORD *)(a1 + 0x198) = (char *)v14 + *(_DWORD *)(a1 + 0x1E8) - v15;
LABEL_53:
      *(_DWORD *)(a1 + 0x1A8) = *(_DWORD *)(a1 + 0x198) + 0x10;
LABEL_54:
      if ( !*(_DWORD *)(a1 + 0x200) )
      {
        if ( *(_DWORD *)(a1 + 0x1F8) < *(_DWORD *)(a1 + 0x1FC) )
        {
          v22 = *(_DWORD *)(a1 + 0x1F8);
        }
        else
        {
          v22 = *(_DWORD *)(a1 + 0x1FC);
        }
        v23 = v22;
        if ( v22 + *(_DWORD *)(a1 + 0x1E4) - *(_DWORD *)(a1 + 0x1F0) > 0 )
        {
          v23 = *(_DWORD *)(a1 + 0x1F0) - *(_DWORD *)(a1 + 0x1E4);
        }
        if ( Q_ReadFile_sub_1BF94((P_FileInfo)a1, *(void **)(a1 + 0x1E4), v23) < v23 )
        {
          *(_DWORD *)(a1 + 0x200) = 0xFFFFFFFF;
        }
        v24 = *(_DWORD *)(a1 + 0x1F8);
        v25 = *(_DWORD *)(a1 + 0x1F0);
        *(_DWORD *)(a1 + 0x1E4) += v23;
        v26 = *(_DWORD *)(a1 + 0x1E4);
        *(_DWORD *)(a1 + 0x1F8) = v24 - v23;
        if ( v26 >= v25 )
        {
          *(_DWORD *)(a1 + 0x1E4) = *(_DWORD *)(a1 + 0x1E8);
        }
      }
      if ( (unsigned int)(*(_DWORD *)(a1 + 0x1EC)
                        + **(_DWORD **)(a1 + 0x198)
                        + *(_DWORD *)(a1 + 0x1F8)
                        - *(_DWORD *)(a1 + 0x1F0)) >= *(_DWORD *)(a1 + 0x1F4) )
      {
        v27 = *(_DWORD *)(a1 + 0x1F8);
        v28 = *(_DWORD *)(a1 + 0x1F0);
        if ( v27 + *(_DWORD *)(a1 + 0x1E4) - v28 > 0 )
        {
          v27 = v28 - *(_DWORD *)(a1 + 0x1E4);
        }
        if ( Q_ReadFile_sub_1BF94((P_FileInfo)a1, *(void **)(a1 + 0x1E4), v27) < v27 )
        {
          *(_DWORD *)(a1 + 0x200) = 0xFFFFFFFF;
        }
        v29 = *(_DWORD *)(a1 + 0x1F8);
        *(_DWORD *)(a1 + 0x1E4) += v27;
        v30 = v29 - v27;
        v31 = *(_DWORD *)(a1 + 0x1F0);
        v32 = *(_DWORD *)(a1 + 0x1E4);
        *(_DWORD *)(a1 + 0x1F8) = v30;
        if ( v32 >= v31 )
        {
          *(_DWORD *)(a1 + 0x1E4) = *(_DWORD *)(a1 + 0x1E8);
        }
      }
      return 0xFFFFFFFF;
    }
    v16 = (int)v14 - *(_DWORD *)(a1 + 0x1F0) + 0x10;
    if ( v16 <= 0 )
    {
      v20 = (char *)v14 + *v14;
      v21 = *(_DWORD *)(a1 + 0x1F0);
      v19 = (signed int)&v20[-v21];
      if ( v19 <= 0 )
      {
        goto LABEL_53;
      }
      if ( v19 >= *(_DWORD *)(a1 + 0x1EC) - v21 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x3D0);
      }
      v18 = *(const void **)(a1 + 0x1E8);
      v17 = *(void **)(a1 + 0x1F0);
    }
    else
    {
      qmemcpy(*(void **)(a1 + 0x1F0), *(const void **)(a1 + 0x1E8), (unsigned int)v14 - *(_DWORD *)(a1 + 0x1F0) + 0x10);
      v17 = v14 + 4;
      v18 = (const void *)(v16 + *(_DWORD *)(a1 + 0x1E8));
      v19 = **(_DWORD **)(a1 + 0x198) - 0x10;
    }
    qmemcpy(v17, v18, v19);
    goto LABEL_53;
  }
  return 0xFFFFFFFF;
}
// A0CF8: using guessed type int dword_A0CF8;
// D8650: using guessed type int dword_D8650;

//----- (00029B24) --------------------------------------------------------
void __fastcall sub_29B24(_DWORD *a1)
{
  int v1; // ecx
  signed int v2; // ebx
  int v3; // edi
  int v4; // eax
  LONG v5; // esi
  RGB v6[4]; // [esp+0h] [ebp-18h] BYREF

  v1 = a1[0x7A];
  v2 = a1[0x7D] / 0x27Fu;
  v3 = (a1[0x79] - v1) / v2;
  v4 = (a1[0x66] - v1) / v2;
  v6[0].g = 0;
  v6[0].b = 0;
  v5 = v4;
  v6[0].r = 0xFF;
  VFX_DAC_write(0xFE, v6);
  v6[0].r = 0;
  v6[0].g = 0xFF;
  VFX_DAC_write(0xFF, v6);
  if ( v5 < v3 )
  {
    VFX_area_wipe(0, 450, v5, 479, 254);
    VFX_area_wipe(v5, 450, v3, 479, 255);
    VFX_area_wipe(v3, 450, 639, 479, 254);
  }
  else
  {
    VFX_area_wipe(0, 450, v3, 479, 255);
    VFX_area_wipe(v3, 450, v5, 479, 254);
    VFX_area_wipe(v5, 450, 639, 479, 255);
  }
  VFX_area_wipe(v5, 450, v5, 479, 254);
}

//----- (00029C6C) --------------------------------------------------------
unsigned __int16 __fastcall sub_29C6C(int a1, _WORD *a2)
{
  RGB *v3; // esi
  unsigned __int16 result; // ax
  unsigned __int16 v5; // ax
  UBYTE *p_g; // esi
  unsigned __int8 v7; // dl
  unsigned __int16 j; // di
  int v9; // edx
  UBYTE r; // dh
  UBYTE b; // bh
  unsigned __int16 v12; // [esp+0h] [ebp-24h]
  unsigned __int16 v13; // [esp+4h] [ebp-20h]
  int v14; // [esp+8h] [ebp-1Ch]
  unsigned __int8 i; // [esp+Ch] [ebp-18h]

  v3 = (RGB *)(a2 + 1);
  result = *a2;
  v12 = *a2;
  v14 = 0;
  HIBYTE(result) = 0;
  for ( i = 0; (unsigned __int16)v14 < v12; ++v14 )
  {
    LOBYTE(v5) = v3->r;
    p_g = &v3->g;
    v7 = v5 + i;
    v5 = (unsigned __int8)v5;
    LOBYTE(v5) = *p_g;
    v3 = (RGB *)(p_g + 1);
    v13 = v5;
    result = v3[0xFFFFFFFF].b;
    i = v7;
    if ( !v3[0xFFFFFFFF].b )
    {
      result = 0;
      v13 = 0x100;
    }
    for ( j = 0; j < v13; ++j )
    {
      v9 = *(__int16 *)(a1 + 0x932);
      if ( j < v9 || j >= *(__int16 *)(a1 + 0x934) + v9 )
      {
        r = v3->r;
        v3->g >>= 2;
        b = v3->b;
        v3->r = r >> 2;
        v3->b = b >> 2;
        VFX_DAC_write(i++, v3++);
      }
      result = v13;
    }
  }
  return result;
}

//----- (00029D54) --------------------------------------------------------
int __fastcall sub_29D54(int a1, unsigned __int8 *a2)
{
  int v3; // edx
  unsigned __int16 v4; // ax
  unsigned __int8 *v5; // ebp
  int result; // eax
  int i; // [esp+0h] [ebp-2Ch]
  char *s; // [esp+8h] [ebp-24h]
  char v10[4]; // [esp+Ch] [ebp-20h] BYREF
  int v11; // [esp+10h] [ebp-1Ch]
  signed __int8 v12; // [esp+14h] [ebp-18h]

  s = *(char **)(a1 + 0x1AC);
  for ( i = 0; *(unsigned __int16 *)(a1 + 0x122) > i; ++i )
  {
    v11 = 0;
    ++a2;
    if ( *(_WORD *)(a1 + 0x120) )
    {
      do
      {
        v12 = *a2;
        v5 = a2 + 1;
        if ( v12 >= 0 )
        {
          v3 = *v5;
          a2 = v5 + 1;
          memset(s, v3, v12);
        }
        else
        {
          v12 = -v12;
          v3 = v12;
          qmemcpy(s, v5, v12);
          a2 = &v5[v12];
        }
        LOWORD(v3) = v12;
        s += v12;
        v4 = *(_WORD *)(a1 + 0x120);
        v11 += v3;
      }
      while ( (unsigned __int16)v11 < v4 );
    }
    s += 0x280 - *(unsigned __int16 *)(a1 + 0x120);
  }
  v10[0] = 0;
  v10[1] = 0;
  v10[2] = 0;
  Q_PaletteGet_sub_2C2B0(&V_Type6_stru_D8654, 0, 0x100, 0);
  sub_2C670((int)&V_Type6_stru_D8654, 0, 0x100, v10);
  *(_DWORD *)(a1 + 0x1D0) = 0;
  *(_DWORD *)(a1 + 0x1D4) = 0;
  *(_DWORD *)(a1 + 0x1D8) = *(unsigned __int16 *)(a1 + 0x120) - 1;
  *(_DWORD *)(a1 + 0x1DC) = *(unsigned __int16 *)(a1 + 0x122) - 1;
  VFX_pane_refresh(
    (PANE *)(a1 + 0x1CC),
    *(_DWORD *)(a1 + 0x1A0),
    *(_DWORD *)(a1 + 0x1A4),
    *(_DWORD *)(a1 + 0x1D8) + *(_DWORD *)(a1 + 0x1A0),
    *(_DWORD *)(a1 + 0x1DC) + *(_DWORD *)(a1 + 0x1A4));
  for ( *(_WORD *)(a1 + 0x92C) = 0; *(__int16 *)(a1 + 0x92C) < 0x20; ++*(_WORD *)(a1 + 0x92C) )
  {
    Q_FadePalette_sub_2C5E4(&V_Type6_stru_D8654, *(_BYTE *)(a1 + 0x92C));
  }
  ++*(_WORD *)(a1 + 0x92C);
  return result;
}

//----- (00029F58) --------------------------------------------------------
void __fastcall sub_29F58(int a1, const void *a2)
{
  LONG v3; // edi
  LONG v4; // [esp-Ch] [ebp-1Ch]
  LONG v5; // [esp-8h] [ebp-18h]
  LONG v6; // [esp-4h] [ebp-14h]

  qmemcpy(*(void **)(a1 + 0x1AC), a2, *(unsigned __int16 *)(a1 + 0x122) * *(unsigned __int16 *)(a1 + 0x120));
  *(_DWORD *)(a1 + 0x1D8) = *(unsigned __int16 *)(a1 + 0x120) - 1;
  *(_DWORD *)(a1 + 0x1DC) = *(unsigned __int16 *)(a1 + 0x122) - 1;
  v6 = *(_DWORD *)(a1 + 0x1DC) + *(_DWORD *)(a1 + 0x1A4);
  v5 = *(_DWORD *)(a1 + 0x1D8) + *(_DWORD *)(a1 + 0x1A0);
  v4 = *(_DWORD *)(a1 + 0x1A4);
  v3 = *(_DWORD *)(a1 + 0x1A0);
  *(_DWORD *)(a1 + 0x1D0) = 0;
  *(_DWORD *)(a1 + 0x1D4) = 0;
  VFX_pane_refresh((PANE *)(a1 + 0x1CC), v3, v4, v5, v6);
}

//----- (00029FF8) --------------------------------------------------------
void __fastcall Q_NC_sub_29FF8(int a1, _WORD *a2)
{
  int v3; // esi
  unsigned __int8 *v4; // edi
  int v6; // eax
  unsigned __int8 v7; // ah
  signed __int8 v8; // al
  int v9; // eax
  int v10; // edx
  char v11; // dl
  __int16 j; // bx
  int v13; // edx
  int v14; // eax
  int v15; // ebx
  PANE *target; // [esp+0h] [ebp-18h]
  __int16 i; // [esp+4h] [ebp-14h]
  __int16 v18; // [esp+4h] [ebp-14h]
  int v19; // [esp+8h] [ebp-10h]
  __int16 v20; // [esp+Ch] [ebp-Ch]
  __int16 v21; // [esp+10h] [ebp-8h]
  __int16 v22; // [esp+14h] [ebp-4h]

  v3 = *(_DWORD *)(a1 + 0x1AC);
  v4 = (unsigned __int8 *)(a2 + 1);
  v20 = *a2;
  v21 = 0;
  target = (PANE *)(a1 + 0x1CC);
  while ( v20-- )
  {
    while ( 1 )
    {
      v22 = *(_WORD *)v4;
      v4 += 2;
      if ( v22 > 0 )
      {
        break;
      }
      if ( (v22 & 0x4000) == 0 )
      {
        printf("Bombing on Frame #%d.\n", *(_DWORD *)(a1 + 0x19C));
        Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x569);
      }
      v21 -= v22;
      v3 = *(unsigned __int16 *)(a1 + 0x120) * v21 + *(_DWORD *)(a1 + 0x1AC);
    }
    for ( i = 0; ; i = v19 + v18 )
    {
      v6 = v22--;
      if ( v6 <= 0 )
      {
        break;
      }
      v7 = *v4;
      v8 = v4[1];
      LOWORD(v19) = 2 * v8;
      v3 += *v4;
      v4 += 2;
      v18 = v7 + i;
      if ( (__int16)v19 <= 0 )
      {
        v4 += 2;
        for ( j = *((_WORD *)v4 + 0xFFFFFFFF); ; *(_WORD *)(v3 - 2) = j )
        {
          v13 = v8++;
          if ( v13 >= 0 )
          {
            break;
          }
          v3 += 2;
        }
        LOWORD(v19) = -(__int16)v19;
      }
      else
      {
        v9 = v19;
        while ( 1 )
        {
          v10 = (__int16)v9--;
          if ( v10 <= 0 )
          {
            break;
          }
          ++v3;
          v11 = *v4++;
          *(_BYTE *)(v3 - 1) = v11;
        }
      }
      *(_DWORD *)(a1 + 0x1D0) = v18;
      *(_DWORD *)(a1 + 0x1DC) = v21;
      *(_DWORD *)(a1 + 0x1D4) = v21;
      v14 = *(_DWORD *)(a1 + 0x1A4);
      v15 = *(_DWORD *)(a1 + 0x1DC);
      *(_DWORD *)(a1 + 0x1D8) = (__int16)v19 + v18;
      VFX_pane_refresh(
        target,
        *(_DWORD *)(a1 + 0x1D0) + *(_DWORD *)(a1 + 0x1A0),
        *(_DWORD *)(a1 + 0x1D4) + *(_DWORD *)(a1 + 0x1A4),
        *(_DWORD *)(a1 + 0x1D8) + *(_DWORD *)(a1 + 0x1A0),
        v15 + v14);
    }
    v3 = ++v21 * *(unsigned __int16 *)(a1 + 0x120) + *(_DWORD *)(a1 + 0x1AC);
  }
}
// 2A0FB: variable 'v19' is possibly undefined

//----- (0002A1DC) --------------------------------------------------------
FILE *__fastcall sub_2A1DC(int a1, const char *a2)
{
  FILE *result; // eax
  FILE *v4; // ebx
  int v5; // esi
  unsigned int v6; // kr04_4
  char *v7; // eax
  int v9; // esi
  int v10; // ecx
  void *v11; // eax
  char *v12; // esi
  char *v13; // edi
  char v14; // al
  char v15; // al
  int v16; // eax
  __int16 v17; // dx
  FILE *v18; // ecx
  __int16 v19; // si
  FILE *v20; // esi
  __int16 v21; // bx
  FILE *v22; // esi
  __int16 v23; // cx
  void *v24; // eax
  FILE *v25; // edi
  int v26; // ebx
  FILE *v27; // [esp-10h] [ebp-304h]
  T_FileInfo v28; // [esp+0h] [ebp-2F4h] BYREF
  char v29[256]; // [esp+118h] [ebp-1DCh] BYREF
  char v30[128]; // [esp+218h] [ebp-DCh] BYREF
  char v31[52]; // [esp+298h] [ebp-5Ch] BYREF
  unsigned int v32; // [esp+2CCh] [ebp-28h] BYREF
  FILE *fp; // [esp+2D0h] [ebp-24h]
  int v34; // [esp+2D4h] [ebp-20h]
  int v35; // [esp+2D8h] [ebp-1Ch]
  __int16 v36; // [esp+2DCh] [ebp-18h]

  result = (FILE *)a2;
  if ( a2 )
  {
    v36 = 0;
    result = Q_OpenFile_sub_1BB10(a2, 0);
    fp = result;
    if ( result )
    {
      v34 = 0;
      v35 = a1 + 0x90A;
      while ( 1 )
      {
        v4 = fp;
        fscanf(fp, "%s %d", v31, &v32);
        if ( v32 == 0xFFFFFFFF )
        {
          break;
        }
        v5 = ++v34;
        if ( v32 < 2 )
        {
          if ( v32 )
          {
            fscanf(v4, "%s %s", v31, v30);
            if ( !sub_2B360((void **)v35, v30) )
            {
              Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0x5E3);
            }
            fscanf(fp, "%s %s", v31, v30);
            Q_InitFileInfo_sub_1BB78(&v28);
            if ( Q_OpenFile_sub_1BBFC(&v28, v30, 0x200, 0) )
            {
              Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0x5EB);
            }
            v24 = Q_CfileLoad_sub_1BF1C(&v28, 0);
            *(_DWORD *)(a1 + 0x92E) = v24;
            if ( !v24 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x5EE);
            }
            v25 = fp;
            fscanf(fp, "%s %d", v31, &v32);
            *(_WORD *)(a1 + 0x932) = v32;
            fscanf(v25, "%s %d", v31, &v32);
            *(_WORD *)(a1 + 0x934) = v32;
            fscanf(v25, "%s %d", v31, &v32);
            v26 = v34 + 6;
            *(_DWORD *)(a1 + 0x926) = v32;
            v34 = v26;
            Q_CloseFileAndDelete_sub_1BBC8(&v28);
          }
          else
          {
            fscanf(v4, "%s %d", v31, &v32);
            *(_DWORD *)(a1 + 0x916) = v32;
            fscanf(v4, "%s %d", v31, &v32);
            *(_DWORD *)(a1 + 0x91A) = v32;
            fscanf(v4, "%s %d", v31, &v32);
            *(_DWORD *)(a1 + 0x91E) = v32;
            fscanf(v4, "%s %d", v31, &v32);
            v34 = v5 + 5;
            *(_DWORD *)(a1 + 0x922) = v32;
          }
        }
        else if ( v32 <= 2 )
        {
          if ( *(__int16 *)(a1 + 0x806) >= 0x80 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x5FF);
          }
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x206) = 1;
          *(_DWORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x208) = v36;
          fscanf(fp, "%s %s", v31, v29);
          v6 = strlen(v29) + 1;
          v7 = v29;
          if ( v29[0] )
          {
            do
            {
              if ( *v7 == 0x5F )
              {
                *v7 = 0x20;
              }
            }
            while ( *++v7 );
          }
          v9 = sub_2B5BC((int *)v35, v29);
          if ( v9 == 0xFFFFFFFF )
          {
            Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0x613);
          }
          v10 = v36;
          *(_DWORD *)(a1 + 8 * v36 + 0x80C) = v9;
          v11 = operator new[]((__int16)(v6 - 1) + 1);
          Q_RegisterData_sub_2625C(v11, 1, "SUBTITLE");
          *(_DWORD *)(a1 + 8 * v10 + 0x808) = v11;
          if ( !v11 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x61B);
          }
          v12 = v29;
          v13 = *(char **)(a1 + 8 * v36 + 0x808);
          do
          {
            v14 = *v12;
            *v13 = *v12;
            if ( !v14 )
            {
              break;
            }
            v15 = v12[1];
            v12 += 2;
            v13[1] = v15;
            v13 += 2;
          }
          while ( v15 );
          fscanf(fp, "%s %d", v31, &v32);
          v32 -= 0x20;
          if ( (int)v32 <= 0 )
          {
            Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0x622);
          }
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x204) = v32;
          v27 = fp;
          ++*(_WORD *)(a1 + 0x806);
          fscanf(v27, "%s %d", v31, &v32);
          v16 = 0xC * *(__int16 *)(a1 + 0x806);
          ++v36;
          *(_WORD *)(v16 + a1 + 0x204) = v32;
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x206) = 2;
          v17 = *(_WORD *)(a1 + 0x806);
          v34 += 4;
          *(_WORD *)(a1 + 0x806) = v17 + 1;
        }
        else if ( v32 < 0xB )
        {
          if ( v32 != 3 )
          {
LABEL_10:
            sprintf(
              "Thank you for playing Ascendancy.",
              "\n  ** Bad Subtitle Data: %s, %d (line %d)\n\n",
              v31,
              v32,
              v34);
            Q_debugbreak_exit_sub_2624C();
          }
          if ( *(__int16 *)(a1 + 0x806) >= 0x80 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x635);
          }
          v18 = fp;
          fscanf(fp, "%s %d", v31, &v32);
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x204) = v32;
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x206) = 3;
          fscanf(v18, "%s %d", v31, &v32);
          *(_DWORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x208) = v32;
          v19 = *(_WORD *)(a1 + 0x806);
          v34 += 3;
          *(_WORD *)(a1 + 0x806) = v19 + 1;
        }
        else if ( v32 <= 0xB )
        {
          if ( *(__int16 *)(a1 + 0x806) >= 0x80 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x703);
          }
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x206) = 0xB;
          v22 = fp;
          fscanf(fp, "%s %d", v31, &v32);
          *(_DWORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x208) = v32;
          fscanf(v22, "%s %d", v31, &v32);
          *(_DWORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x20C) = v32;
          fscanf(v22, "%s %d", v31, &v32);
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x204) = v32;
          v23 = *(_WORD *)(a1 + 0x806);
          v34 += 4;
          *(_WORD *)(a1 + 0x806) = v23 + 1;
        }
        else
        {
          if ( v32 != 0x10 )
          {
            goto LABEL_10;
          }
          if ( *(__int16 *)(a1 + 0x806) >= 0x80 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\flic.cpp", 0x68A);
          }
          v20 = fp;
          fscanf(fp, "%s %d", v31, &v32);
          *(_DWORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x208) = v32;
          fscanf(v20, "%s %d", v31, &v32);
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x206) = (v32 != 1) + 0x1E;
          fscanf(v20, "%s %d", v31, &v32);
          *(_WORD *)(0xC * *(__int16 *)(a1 + 0x806) + a1 + 0x204) = v32;
          v21 = *(_WORD *)(a1 + 0x806) + 1;
          v34 += 4;
          *(_WORD *)(a1 + 0x806) = v21;
        }
      }
      fclose(v4);
      qsort(
        (void *)(a1 + 0x204),
        *(__int16 *)(a1 + 0x806),
        0xCu,
        (int (__fastcall *)(const void *, const void *))sub_28C4C);
      return (FILE *)0xFFFFFFFF;
    }
  }
  return result;
}
// 2A1DC: using guessed type char var_5C[52];

//----- (0002AA88) --------------------------------------------------------
void __fastcall sub_2AA88(int a1)
{
  int v2; // edx
  int v3; // ebx
  int v4; // ecx
  int v5; // edi
  ULONG v6; // edx
  HTIMER v7; // eax
  unsigned __int16 v8; // ax
  int v9; // [esp+0h] [ebp-8h]
  int v10; // [esp+4h] [ebp-4h]

  v9 = a1 + 0x808;
  v10 = a1 + 0x90A;
  while ( 1 )
  {
    v2 = a1 + 0xC * *(__int16 *)(a1 + 0x804);
    v3 = *(__int16 *)(v2 + 0x204);
    v4 = *(_DWORD *)(a1 + 0x19C);
    if ( v3 != v4 )
    {
      break;
    }
    v8 = *(_WORD *)(v2 + 0x206);
    if ( v8 < 3u )
    {
      if ( !v8 )
      {
        goto LABEL_23;
      }
      if ( v8 <= 1u )
      {
        if ( !*(_DWORD *)(a1 + 0x942) )
        {
          v5 = 8 * *(_DWORD *)(v2 + 0x208) + v9;
          sub_2C1E0((int)&V_Type6_stru_D8654, *(_WORD *)(a1 + 0x932), *(_WORD *)(a1 + 0x934), *(_DWORD *)(a1 + 0x92E));
          sub_2C670((int)&V_Type6_stru_D8654, *(__int16 *)(a1 + 0x932), *(__int16 *)(a1 + 0x934), 0);
          sub_2B8A8(
            v10,
            *(__int16 *)(v5 + 4),
            *(__int16 *)(v5 + 6),
            *(const char **)v5,
            0x80,
            0xFFFFFFFF,
            0xFFFFFFFF,
            0);
          *(_WORD *)(a1 + 0x92A) = 1;
        }
        goto LABEL_6;
      }
      if ( *(_DWORD *)(a1 + 0x942) )
      {
        goto LABEL_6;
      }
      *(_WORD *)(a1 + 0x92A) = 2;
      ++*(_WORD *)(a1 + 0x804);
    }
    else if ( v8 <= 3u )
    {
      v6 = *(_DWORD *)(v2 + 0x208);
      v7 = *(_DWORD *)(a1 + 0x936);
      *(_DWORD *)(a1 + 0x1E0) = v6;
      if ( v7 == 0xFFFFFFFF )
      {
        goto LABEL_6;
      }
      if ( v6 )
      {
        AIL_set_timer_frequency(v7, v6);
      }
      else
      {
        AIL_stop_timer(v7);
      }
      ++*(_WORD *)(a1 + 0x804);
    }
    else if ( v8 < 0x1Eu )
    {
      if ( v8 != 0xB )
      {
        goto LABEL_23;
      }
      if ( V_SoundSystem.DIG_installed == 0xFFFFFFFF )
      {
        Q_SetVolume_sub_4FF4C(&V_SoundSystem, *(_DWORD *)(v2 + 0x20C));
        ++*(_WORD *)(a1 + 0x804);
      }
      else
      {
LABEL_6:
        ++*(_WORD *)(a1 + 0x804);
      }
    }
    else if ( v8 <= 0x1Eu )
    {
      sub_4F8CC(&V_SoundSystem, *(_DWORD *)(v2 + 0x208), v4 ^ v3);
      ++*(_WORD *)(a1 + 0x804);
    }
    else if ( v8 == 0x1F )
    {
      Q_StopSample_sub_4FA1C(&V_SoundSystem);
      ++*(_WORD *)(a1 + 0x804);
    }
    else
    {
LABEL_23:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0x80F);
      ++*(_WORD *)(a1 + 0x804);
    }
  }
}

//----- (0002AC84) --------------------------------------------------------
int __fastcall Q_FLIC_CPP_StartTimer_sub_2AC84(int a1, ULONG hertz)
{
  HTIMER v4; // edx
  HTIMER v5; // eax

  *(_DWORD *)(a1 + 0x1E0) = hertz;
  v4 = *(_DWORD *)(a1 + 0x936);
  if ( v4 == 0xFFFFFFFF )
  {
    v5 = AIL_register_timer((AILTIMERCB)callback_fn);
    *(_DWORD *)(a1 + 0x936) = v5;
    if ( v5 == 0xFFFFFFFF )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\flic.cpp", 0x823);
    }
    AIL_set_timer_frequency(*(_DWORD *)(a1 + 0x936), hertz);
    AIL_start_timer(*(_DWORD *)(a1 + 0x936));
  }
  else
  {
    AIL_set_timer_frequency(v4, hertz);
  }
  return (*(_DWORD *)(a1 + 0x936) == 0xFFFFFFFF) - 1;
}

//----- (0002AD08) --------------------------------------------------------
void __fastcall sub_2AD08(int a1)
{
  if ( *(_DWORD *)(a1 + 0x936) != 0xFFFFFFFF )
  {
    AIL_stop_timer(*(_DWORD *)(a1 + 0x936));
    AIL_release_timer_handle(*(_DWORD *)(a1 + 0x936));
    *(_DWORD *)(a1 + 0x936) = 0xFFFFFFFF;
  }
}

//----- (0002AD40) --------------------------------------------------------
__int16 __cdecl sub_2AD40(unsigned __int16 *a1, int a2, LONG y)
{
  int v4; // ecx
  __int16 *v5; // esi
  __int16 result; // ax
  int v7; // edx
  int v8; // eax
  _BYTE *v9; // esi
  LONG v10; // edx
  char v11; // al
  __int16 *v12; // esi
  int v13; // ecx
  __int16 v14; // ax
  int v15; // edx
  unsigned int v16; // ecx
  __int16 v17; // ax
  UBYTE *v18; // edi
  LONG v19; // edx
  ULONG i; // ecx
  unsigned int j; // ecx
  int v22; // edx
  unsigned int v23; // ecx
  UBYTE *v24; // edi
  ULONG v25; // ecx
  LONG v26; // edx
  int v27; // [esp-2Eh] [ebp-42h]
  int v28; // [esp-2Eh] [ebp-42h]
  LONG v29; // [esp-2Ah] [ebp-3Eh]
  int v30; // [esp-26h] [ebp-3Ah]
  int v31; // [esp-26h] [ebp-3Ah]
  LONG v32; // [esp-22h] [ebp-36h]
  LONG v33; // [esp-22h] [ebp-36h]
  int v34; // [esp-1Eh] [ebp-32h]
  __int16 v35; // [esp-1Eh] [ebp-32h]
  __int16 v36; // [esp-1Ah] [ebp-2Eh]
  ULONG v37; // [esp-1Ah] [ebp-2Eh]
  int v38; // [esp-16h] [ebp-2Ah]
  unsigned int v39; // [esp-16h] [ebp-2Ah]
  __int16 v40; // [esp-12h] [ebp-26h]
  int v41; // [esp-10h] [ebp-24h]
  ULONG v42; // [esp+4h] [ebp-10h] BYREF
  UBYTE *v43; // [esp+8h] [ebp-Ch] BYREF
  ULONG nbytes; // [esp+Ch] [ebp-8h] BYREF
  UBYTE *addr; // [esp+10h] [ebp-4h] BYREF

  v4 = *a1;
  v5 = (__int16 *)(a1 + 1);
  do
  {
    while ( 1 )
    {
      result = *v5++;
      if ( result > 0 )
      {
        break;
      }
      if ( (result & 0x4000) != 0 )
      {
        LOWORD(y) = y - result;
      }
    }
    v7 = a2;
    v41 = v4;
    do
    {
      v40 = result;
      v8 = *(unsigned __int8 *)v5;
      v9 = (char *)v5 + 1;
      v10 = v8 + v7;
      v11 = *v9;
      v12 = (__int16 *)(v9 + 1);
      if ( (v11 & 0x80) != 0 )
      {
        v13 = -v11;
        v14 = *v12;
        v5 = v12 + 1;
        v36 = v14;
        v34 = 2 * v13;
        VFX_line_address(v10, y, &addr, &nbytes);
        v15 = v27;
        v16 = v34;
        v17 = v36;
        v18 = addr;
        if ( v34 > (int)nbytes )
        {
          v37 = v34 - nbytes;
          v19 = nbytes + v27;
          for ( i = nbytes >> 1; i; --i )
          {
            *(_WORD *)v18 = v17;
            v18 += 2;
          }
          v35 = v17;
          VFX_line_address(v19, v29, &addr, &nbytes);
          v15 = v28;
          v17 = v35;
          v16 = v37;
          v18 = addr;
        }
        v7 = v16 + v15;
        for ( j = v16 >> 1; j; --j )
        {
          *(_WORD *)v18 = v17;
          v18 += 2;
        }
      }
      else
      {
        v38 = 2 * v11;
        VFX_line_address(v10, y, &v43, &v42);
        v22 = v30;
        y = v32;
        v23 = v38;
        v24 = v43;
        if ( v38 > (int)v42 )
        {
          v39 = v38 - v42;
          v25 = v42;
          v26 = v42 + v30;
          qmemcpy(v43, v12, v42);
          v12 = (__int16 *)((char *)v12 + v25);
          VFX_line_address(v26, v32, &v43, &v42);
          v22 = v31;
          y = v33;
          v23 = v39;
          v24 = v43;
        }
        v7 = v23 + v22;
        qmemcpy(v24, v12, v23);
        v5 = (__int16 *)((char *)v12 + v23);
      }
      result = v40 - 1;
    }
    while ( v40 != 1 );
    LOWORD(y) = y + 1;
    v4 = v41 - 1;
  }
  while ( v41 != 1 );
  return result;
}
// 2ADAB: variable 'v27' is possibly undefined
// 2ADD3: variable 'v29' is possibly undefined
// 2ADD9: variable 'v28' is possibly undefined
// 2AE00: variable 'v30' is possibly undefined
// 2AE01: variable 'v32' is possibly undefined
// 2AE29: variable 'v31' is possibly undefined
// 2AE2A: variable 'v33' is possibly undefined

//----- (0002AE48) --------------------------------------------------------
int __cdecl Q_NC_sub_2AE48(unsigned __int16 a1)
{
  while ( MEMORY[0x46C] <= a1 )
  {
    ;
  }
  return MEMORY[0x46C];
}
// 2AE48: could not find valid save-restore pair for edi

//----- (0002AE69) --------------------------------------------------------
__int16 Q_NC_sub_2AE69()
{
  __int16 result; // ax

  result = 0x1510;
  __asm { int     23h; DOS - CONTROL "C" EXIT ADDRESS }
  return result;
}

//----- (0002AE80) --------------------------------------------------------
void __fastcall __spoils<> sub_2AE80(P_TypeA9 a1)
{
  T_Type2 *__shifted(T_TypeA9,0xAB) v1; // eax

  Q_A2_sub_2C830(&a1->a);
  v1 = &a1->b;
  sub_28C74(v1);
  ADJ(v1)->a.b = (int)off_95CB4;
  ADJ(v1)->c = 1;
  ADJ(v1)->d = 0;
}
// 95CB4: using guessed type int (*off_95CB4[3])();

//----- (0002AEB0) --------------------------------------------------------
int __fastcall sub_2AEB0(int a1, char a2)
{
  void *v3; // eax
  int v5; // eax
  int v6; // eax
  void *v7; // eax
  void *v8; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95CA0);
    operator delete[](v3);
    return a1;
  }
  else
  {
    v5 = a1 + 0xAB;
    *(_DWORD *)(v5 - 4) = off_95CB4;
    sub_28DA4(v5);
    v7 = (void *)sub_2C848(v6 - 0xAB, 1);
    v8 = v7;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v7);
    }
    return (int)v8;
  }
}
// 2AEE7: variable 'v6' is possibly undefined
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95CB4: using guessed type int (*off_95CB4[3])();

//----- (0002AF04) --------------------------------------------------------
UBYTE *__fastcall sub_2AF04(int a1, const char *a2)
{
  UBYTE *v2; // ecx

  v2 = sub_28EB4(a1 + 0xAB, a2, (int)V_Type3_stru_10AE70.window->buffer, 0xFFFFFFFF, 0xFFFFFFFF);
  if ( !v2 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\flicwin.cpp", 0x4E);
  }
  return v2;
}

//----- (0002AF3C) --------------------------------------------------------
int __fastcall sub_2AF3C(int a1)
{
  signed int size; // esi
  int v4; // ebx
  unsigned int v5; // ebx

  size = *(__int16 *)(a1 + 0xA01) << 0x14;
  if ( size <= V_Type3_stru_10AE70.t13.size )
  {
    v4 = *(__int16 *)(a1 + 0xA03);
    if ( v4 == 0xFFFFFFFF )
    {
      size = V_Type3_stru_10AE70.t13.size;
      v5 = V_Type3_stru_10AE70.t13.size;
    }
    else
    {
      v5 = v4 << 0x14;
    }
    sub_1B4D0(V_Type3_stru_10AE70.t13.z1);
    return sub_29038(
             a1 + 0xAB,
             size,
             v5,
             *(__int16 *)(a1 + 0xA05) << 0xA,
             *(__int16 *)(a1 + 0xA07) << 0xA,
             (int)V_Type3_stru_10AE70.t13.pShapeCache);
  }
  else
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\flicwin.cpp", 0x67);
    return 0;
  }
}

//----- (0002AFF0) --------------------------------------------------------
unsigned int __fastcall sub_2AFF0(int a1, __int16 a2, int a3, int a4)
{
  __int16 v6; // cx
  __int16 v7; // dx
  __int16 v8; // bx
  unsigned int result; // eax
  T_Palette blackpal; // [esp+0h] [ebp-31Ch] BYREF
  int v11; // [esp+300h] [ebp-1Ch]
  int v12; // [esp+304h] [ebp-18h]
  int v13; // [esp+308h] [ebp-14h]
  char v14; // [esp+30Ch] [ebp-10h]

  LOWORD(v13) = a2;
  v12 = 0;
  v11 = a1 + 0xAB;
  switch ( a2 )
  {
    case 1:
      *(_DWORD *)(a1 + 0x247) = 0xFFFFFFFF;
      *(_WORD *)(a1 + 0x9F7) = 0;
      *(_DWORD *)(a1 + 0x9F9) = 0;
      *(_DWORD *)(a1 + 0x9FD) = 0;
      MOUSE_hide();
      dword_132B60 = 0;
      if ( sub_2AF3C(a1) )
      {
        Q_StopSample_sub_4FA1C(&V_SoundSystem);
        sub_2F424(a1, v13, a3, a4);
        sub_56400(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0xA, 0, 0, 0);
        Q_FLIC_CPP_StartTimer_sub_2AC84(v11, 0x12u);
      }
      else
      {
        sub_1ACE8((int)V_Type3_stru_10AE70.t13.z1);
        MOUSE_show();
        sub_56B60(&V_Type3_stru_10AE70, *(_WORD *)(a1 + 0x45), *(_DWORD *)(a1 + 0x47), *(_DWORD *)(a1 + 0x4B));
      }
      result = v12;
      break;
    case 2:
      v6 = 0;
      sub_2AD08(a1 + 0xAB);
      v14 = 129;
      while ( v6 < 0x40 )
      {
        sub_2BD04(&V_Type6_stru_D8654, v6, 0);
        Q_SetVolume_sub_4FF4C(&V_SoundSystem, v14);
        ++v6;
        v14 -= 2;
      }
      Q_StopSample_sub_4FA1C(&V_SoundSystem);
      sub_1ACE8((int)V_Type3_stru_10AE70.t13.z1);
      memset(blackpal, 0, sizeof(blackpal));
      Q_PaletteSet_sub_2C224(&V_Type6_stru_D8654, 0, 0x100, blackpal);
      VFX_area_wipe(0, 0, 639, 479, 0);
      Q_LoadPal_sub_2C158(&V_Type6_stru_D8654, "DATA\\game.pal", 0, 0x100u);
      Q_PaletteSet_sub_2C224(&V_Type6_stru_D8654, 0, 0x100, blackpal);
      dword_132B60 = 0xFFFFFFFF;
      dword_132B64 = 0;
      MOUSE_show();
      sub_2F424(a1, v13, a3, a4);
      result = v12;
      break;
    case 3:
    case 4:
    case 5:
      goto LABEL_14;
    case 0xA:
      if ( !sub_296B4(a1 + 0xAB, a1 + 0xAB, a3, a4) )
      {
        v7 = *(_WORD *)(a1 + 0x9F7) + 1;
        v8 = *(_WORD *)(a1 + 0x9F5);
        *(_WORD *)(a1 + 0x9F7) = v7;
        if ( v7 < v8 )
        {
          sub_2AF3C(a1);
        }
      }
      if ( *(_WORD *)(a1 + 0x9F7) >= *(_WORD *)(a1 + 0x9F5) )
      {
LABEL_14:
        sub_564C0(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0xA);
        sub_56B60(&V_Type3_stru_10AE70, *(_WORD *)(a1 + 0x45), *(_DWORD *)(a1 + 0x47), *(_DWORD *)(a1 + 0x4B));
      }
      v12 = 0xFFFFFFFF;
      result = 0xFFFFFFFF;
      break;
    default:
      result = sub_2F424(a1, v13, a3, a4);
      break;
  }
  return result;
}
// 132B60: using guessed type int dword_132B60;
// 132B64: using guessed type int dword_132B64;

//----- (0002B2C0) --------------------------------------------------------
void __fastcall __spoils<> sub_2B2C0(_DWORD *a1)
{
  *a1 = 0;
  a1[2] = 0;
  sub_2B2FC((int)a1, 0);
}

//----- (0002B2E0) --------------------------------------------------------
void **__fastcall sub_2B2E0(void **a1)
{
  if ( *a1 )
  {
    sub_2627C(*a1);
  }
  operator delete(*a1);
  return a1;
}
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (0002B2FC) --------------------------------------------------------
unsigned int __fastcall sub_2B2FC(int a1, const char *aFName)
{
  void *v4; // eax
  int i; // eax

  *(_DWORD *)(a1 + 8) = &V_Type6_stru_D8654;
  if ( aFName )
  {
    return sub_2B360((void **)a1, aFName);
  }
  v4 = operator new[](0x100u);
  Q_RegisterData_sub_2625C(v4, 1, "FONT TRANSLATE");
  *(_DWORD *)(a1 + 4) = v4;
  if ( !v4 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\font.cpp", 0x5D);
  }
  for ( i = 0; i < 0x100; ++i )
  {
    *(_BYTE *)(*(_DWORD *)(a1 + 4) + i) = i;
  }
  return 0xFFFFFFFF;
}

//----- (0002B360) --------------------------------------------------------
unsigned int __fastcall sub_2B360(void **a1, const char *aFName)
{
  void *v4; // eax
  T_FileInfo v6; // [esp+0h] [ebp-124h] BYREF

  if ( !aFName )
  {
    return 0xFFFFFFFF;
  }
  Q_InitFileInfo_sub_1BB78(&v6);
  if ( !Q_OpenFile_sub_1BBFC(&v6, aFName, O_BINARY, 0) )
  {
    if ( *a1 )
    {
      sub_2627C(*a1);
    }
    operator delete(*a1);
    v4 = Q_CfileLoad_sub_1BF1C(&v6, 0);
    *a1 = v4;
    if ( v4 )
    {
      Q_CloseFileAndDelete_sub_1BBC8(&v6);
      return 0xFFFFFFFF;
    }
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v6);
  return 0;
}
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (0002B3E0) --------------------------------------------------------
_DWORD *__fastcall sub_2B3E0(_DWORD *result, int a2, int a3, int a4, int a5)
{
  result[3] = a2;
  result[4] = a3;
  result[5] = a4;
  result[6] = a5;
  return result;
}

//----- (0002B3F4) --------------------------------------------------------
int __fastcall sub_2B3F4(int a1, char *s2, char *s1, int a4)
{
  char *v6; // esi
  char v7; // al
  int v8; // ecx
  const char *v9; // ebp
  _BYTE *v10; // esi
  char v11; // al
  char v13; // bl
  char *v14; // esi
  char v15; // al
  char v16; // al
  char v17[4]; // [esp+0h] [ebp-14h] BYREF
  int v18; // [esp+4h] [ebp-10h]

  v18 = a1;
  v6 = s2;
  while ( *v6 != 0x7C )
  {
    if ( *v6 )
    {
      v7 = *++v6;
      if ( *v6 == 0x7C )
      {
        break;
      }
      ++v6;
      if ( v7 )
      {
        continue;
      }
    }
    v6 = 0;
    break;
  }
  v8 = 0;
  if ( v6 )
  {
    if ( v6 != s2 )
    {
      strncpy(s1, s2, v6 - s2);
      s1[v6 - s2] = 0;
      return v6 - s2;
    }
    v9 = v6 + 1;
    v10 = v6 + 1;
    *s1 = 0;
    while ( *v10 != 0x7C )
    {
      if ( *v10 )
      {
        v11 = *++v10;
        if ( *v10 == 0x7C )
        {
          break;
        }
        ++v10;
        if ( v11 )
        {
          continue;
        }
      }
      v10 = 0;
      break;
    }
    if ( v10 )
    {
      v8 = v10 - v9 + 2;
      if ( v10 == v9 )
      {
        s1[1] = 0;
        *s1 = 0x7C;
        return v10 - v9 + 2;
      }
      if ( a4 == 0xFFFFFFFF )
      {
        strncpy(v17, v9, 3u);
        v17[3] = 0;
        v13 = atoi(v17);
        *(_BYTE *)(*(_DWORD *)(v18 + 4) + 0xF3) = v13;
        return v10 - v9 + 2;
      }
    }
    else
    {
      return 1;
    }
  }
  else
  {
    v14 = s2;
    do
    {
      v15 = *v14;
      *s1 = *v14;
      if ( !v15 )
      {
        break;
      }
      v16 = v14[1];
      v14 += 2;
      s1[1] = v16;
      s1 += 2;
    }
    while ( v16 );
  }
  return v8;
}

//----- (0002B4F4) --------------------------------------------------------
int __fastcall sub_2B4F4(_DWORD *a1, char *string)
{
  int v3; // edi
  char *v4; // esi
  LONG v6; // [esp-4h] [ebp-24h]
  int i; // [esp+0h] [ebp-20h]
  char *ptr; // [esp+4h] [ebp-1Ch]
  char *s2; // [esp+8h] [ebp-18h]

  if ( !string )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\font.cpp", 0xD7);
  }
  if ( !*a1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\font.cpp", 0xD8);
  }
  s2 = string;
  v3 = 0;
  ptr = strdup(string);
  do
  {
    v4 = ptr;
    for ( i = sub_2B3F4((int)a1, s2, ptr, 0); *v4; v3 += VFX_character_width((void *)*a1, v6) )
    {
      v6 = (unsigned __int8)*v4++;
    }
    s2 += i;
  }
  while ( i > 0 );
  free(ptr);
  return v3;
}

//----- (0002B594) --------------------------------------------------------
LONG __fastcall sub_2B594(int *a1)
{
  if ( !*a1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\font.cpp", 0x104);
  }
  return VFX_font_height((void *)*a1);
}

//----- (0002B5BC) --------------------------------------------------------
int __fastcall sub_2B5BC(int *a1, char *a2)
{
  LONG v3; // esi
  int v4; // edx
  int v5; // ecx
  int v6; // ebx

  v3 = sub_2B594(a1);
  v4 = sub_2B4F4(a1, a2);
  v5 = a1[6] - a1[4] - v3;
  v6 = a1[5] - a1[3] - v4;
  if ( v5 >= 0 && v6 >= 0 )
  {
    return (v6 >> 1) + (v5 >> 1 << 0x10);
  }
  else
  {
    return 0xFFFFFFFF;
  }
}

//----- (0002B610) --------------------------------------------------------
void __fastcall Q_FONT_CPP_sub_2B610(_DWORD *a1, LONG a2, LONG a3, char *a4, int a5, int a6, __int16 a7)
{
  __int16 v8; // cx
  LONG v9; // ebx
  LONG v10; // edx
  LONG v11; // edi
  LONG v12; // eax
  LONG v13; // edx
  char *text; // esi
  char *v15; // edi
  int v16; // eax
  PANE v17; // [esp+0h] [ebp-38h] BYREF
  int v18; // [esp+14h] [ebp-24h]
  LONG v19; // [esp+18h] [ebp-20h]
  char *string; // [esp+1Ch] [ebp-1Ch]
  PANE *pane; // [esp+20h] [ebp-18h]
  LONG y; // [esp+24h] [ebp-14h]
  LONG x; // [esp+28h] [ebp-10h]

  v19 = a2;
  y = a3;
  string = a4;
  v8 = a6;
  if ( !string )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\font.cpp", 0x13B);
  }
  if ( !*a1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\font.cpp", 0x13C);
  }
  if ( a7 == 0xFFFFFFFF )
  {
    a7 = *((_WORD *)a1 + 0xE);
  }
  if ( (__int16)a6 == 0xFFFFFFFF )
  {
    v8 = 0xF3;
  }
  if ( v8 != 0xFFFFFFFE )
  {
    *(_BYTE *)(a1[1] + 0xF3) = v8;
  }
  v9 = sub_2B594(a1);
  v17.window = (WINDOW *)a1[2];
  v17.x0 = a1[3];
  v17.y0 = a1[4];
  v17.x0 += v19;
  v17.y0 += y;
  v10 = sub_2B4F4(a1, string) + v17.x0;
  v17.x1 = v10;
  v17.y1 = v9 + v17.y0;
  v11 = a1[5];
  if ( v17.x0 <= v11 )
  {
    v12 = v10;
    v13 = a1[3];
    if ( v12 >= v13 && v17.y0 <= a1[6] && v17.y1 >= a1[4] )
    {
      if ( v13 <= v17.x0 )
      {
        if ( v11 < v17.x1 )
        {
          v17.x1 = a1[5];
        }
      }
      else
      {
        v17.x0 = a1[3];
      }
      if ( v17.y0 >= a1[4] )
      {
        if ( v17.y1 > a1[6] )
        {
          v17.y1 = a1[6];
        }
      }
      else
      {
        v17.y0 = a1[4];
      }
      if ( a7 != 0xFF )
      {
        VFX_pane_wipe(&v17, a7);
      }
      text = strdup(string);
      x = v19;
      v15 = string;
      pane = (PANE *)&CONTAINING_RECORD(a1, PANE, window)->y0;
      do
      {
        v18 = sub_2B3F4((int)a1, v15, text, 0xFFFFFFFF);
        if ( *text )
        {
          VFX_string_draw(pane, x, y, (void *)*a1, text, (UBYTE *)a1[1]);
        }
        v16 = sub_2B4F4(a1, text);
        v15 += v18;
        x += v16;
      }
      while ( v18 > 0 );
      free(text);
      if ( (a5 & 0xC0) == 0 )
      {
        sub_552CC(&V_Type3_stru_10AE70, &v17);
      }
    }
  }
}

//----- (0002B804) --------------------------------------------------------
void __fastcall Q_NC_sub_2B804(LONG *a1, int a2)
{
  LONG v3; // ecx

  sub_55214(&V_Type3_stru_10AE70, a1[3], a1[4], a1[5], a1[6]);
  v3 = a1[6] - a2;
  a1[4] -= a2;
  a1[6] = v3;
}

//----- (0002B838) --------------------------------------------------------
LONG __fastcall Q_NC_sub_2B838(int a1, __int16 a2, __int16 a3)
{
  LONG v4; // edi
  PANE *v5; // ebp
  LONG result; // eax

  v4 = a2;
  v5 = (PANE *)(a1 + 8);
  while ( 1 )
  {
    result = a3 + a2;
    if ( v4 >= result )
    {
      break;
    }
    VFX_character_draw(v5, 1, 1, *(void **)a1, v4, 0);
    VFX_pane_refresh(v5, *(_DWORD *)(a1 + 0xC), *(_DWORD *)(a1 + 0x10), *(_DWORD *)(a1 + 0x14), *(_DWORD *)(a1 + 0x18));
    ++v4;
    getch();
  }
  return result;
}

//----- (0002B8A8) --------------------------------------------------------
int __fastcall sub_2B8A8(int a1, int a2, int a3, const char *text, __int16 a5, __int16 a6, __int16 a7, int a8)
{
  __int16 v9; // ax
  char *v10; // ebp
  char *v11; // ebx
  char *v12; // ecx
  unsigned int v13; // edi
  int v14; // eax
  int v15; // eax
  int v16; // edx
  char *v17; // ebp
  int v18; // edx
  int v19; // edx
  int v21; // [esp+0h] [ebp-40h]
  int v22; // [esp+4h] [ebp-3Ch]
  char *ptr; // [esp+Ch] [ebp-34h]
  int i; // [esp+14h] [ebp-2Ch]
  int v26; // [esp+18h] [ebp-28h]
  int v28; // [esp+20h] [ebp-20h]
  char v29; // [esp+30h] [ebp-10h]

  if ( (a5 & 0x80) != 0 && a7 != 0xFF )
  {
    v9 = a7;
    if ( a7 == 0xFFFFFFFF )
    {
      v9 = *(_WORD *)(a1 + 0x1C);
    }
    VFX_pane_wipe((PANE *)(a1 + 8), v9);
  }
  if ( a6 == 0xFFFFFFFF )
  {
    LOBYTE(a6) = 0xF3;
  }
  *(_BYTE *)(*(_DWORD *)(a1 + 4) + 0xF3) = a6;
  if ( a8 < 1 )
  {
    a8 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
  }
  ptr = strdup(text);
  v10 = ptr;
  v11 = ptr;
  v12 = ptr;
  v28 = 1;
  v13 = 0;
  do
  {
    if ( !*v11 )
    {
      v13 = 0xFFFFFFFF;
    }
    v29 = *v11;
    *v11 = 0;
    v14 = sub_2B4F4((_DWORD *)a1, v10);
    *v11 = v29;
    if ( v29 == 0xA )
    {
      *v11++ = 0;
      v10 = v11;
      ++v28;
    }
    else if ( v14 <= a8 || v12 <= v10 )
    {
      if ( *v11 == 0x20 )
      {
        v12 = v11;
      }
      ++v11;
    }
    else
    {
      v10 = v12 + 1;
      *v12 = 0;
      v11 = v12 + 1;
      ++v28;
    }
  }
  while ( !v13 );
  v26 = sub_2B594((int *)a1) + 2;
  v21 = v28 * v26;
  if ( (a5 & 0x10) != 0 )
  {
    v15 = a3 - v21;
  }
  else
  {
    v16 = v21 + 1;
    if ( (a5 & 1) != 0 )
    {
      v15 = (*(_DWORD *)(a1 + 0x18) - *(_DWORD *)(a1 + 0x10) - v16) / 2;
    }
    else
    {
      if ( (a5 & 4) != 0 )
      {
        v22 = a3 - v16 / 2;
        goto LABEL_30;
      }
      v15 = a3;
    }
  }
  v22 = v15;
LABEL_30:
  v17 = ptr;
  for ( i = 0; i < v28; ++i )
  {
    v18 = sub_2B4F4((_DWORD *)a1, v17);
    if ( (a5 & 0x20) != 0 )
    {
      v19 = a2 - v18;
    }
    else if ( (a5 & 2) != 0 )
    {
      v19 = (*(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC) - v18) / 2;
    }
    else if ( (a5 & 8) != 0 )
    {
      v19 = a2 - v18 / 2;
    }
    else
    {
      v19 = a2;
    }
    Q_FONT_CPP_sub_2B610((_DWORD *)a1, v19, v22, v17, a5, 0xFFFFFFFE, a7);
    v17 += strlen(v17) + 1;
    v22 += v26;
  }
  if ( (a5 & 0x80) != 0 )
  {
    sub_552CC(&V_Type3_stru_10AE70, (PANE *)(a1 + 8));
  }
  free(ptr);
  return v28 * v26;
}
// 2B8A8: could not find valid save-restore pair for ebx

//----- (0002BB50) --------------------------------------------------------
void sub_2BB50()
{
  _wcpp_2_mod_register_(&unk_96780);
  sub_2BD4C(&V_Type6_stru_D8654);
  dword_96788 = 1;
}
// 786DA: using guessed type int __fastcall _wcpp_2_mod_register_(_DWORD);
// 96788: using guessed type int dword_96788;

//----- (0002BB74) --------------------------------------------------------
void __fastcall sub_2BB74(PANE *pane, LONG a2, LONG y1, LONG x1, LONG y0, unsigned __int8 a6, int a7)
{
  PANE source; // [esp+0h] [ebp-20h] BYREF
  LONG v9; // [esp+14h] [ebp-Ch]
  LONG v10; // [esp+18h] [ebp-8h]
  LONG v11; // [esp+1Ch] [ebp-4h]

  v11 = a2;
  v10 = y1;
  v9 = x1;
  if ( a7 == 0xFFFFFFFF )
  {
    source.window = pane->window;
    source.x0 = v11;
    source.y1 = y0;
    source.x1 = x1;
    source.y0 = y1;
    VFX_pane_copy(&source, 0, 0, pane, v11, y1, a6);
  }
  else
  {
    VFX_line_draw(pane, v11, y1, x1, y1, 0, a6);
    VFX_line_draw(pane, v11, y0, v9, y0, 0, a6);
    VFX_line_draw(pane, v11, v10, v11, y0, 0, a6);
    VFX_line_draw(pane, v9, v10, v9, y0, 0, a6);
  }
}
// 2BB74: could not find valid save-restore pair for ebx

//----- (0002BC40) --------------------------------------------------------
void __fastcall Q_GSYSTEM_CPP_sub_2BC40(PANE *pane, void *shape_table, LONG shape_number, int *hotX, int *hotY)
{
  int v6; // ebx
  int v7; // eax
  int v8; // eax
  RECT r; // [esp+0h] [ebp-18h] BYREF
  LONG v10; // [esp+10h] [ebp-8h]
  void *v11; // [esp+14h] [ebp-4h]

  v11 = shape_table;
  v10 = shape_number;
  if ( !pane )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x40);
  }
  if ( !v11 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x41);
  }
  VFX_shape_visible_rectangle(v11, v10, 0, 0, 0, &r);
  v6 = r.y1 - r.y0;
  v7 = pane->x1 - pane->x0 - (r.x1 - r.x0);
  *hotX = v7;
  if ( v7 )
  {
    *hotX = v7 / 2;
  }
  v8 = pane->y1 - pane->y0 - v6;
  *hotY = v8;
  if ( v8 )
  {
    *hotY = v8 / 2;
  }
  *hotX -= r.x0;
  *hotY -= r.y0;
}

//----- (0002BCF4) --------------------------------------------------------
void __fastcall sub_2BCF4(int a1, unsigned __int8 a2)
{
  sub_2BD04(&V_Type6_stru_D8654, a2, 0);
}

//----- (0002BD04) --------------------------------------------------------
void __fastcall sub_2BD04(P_Type6 a1, char a2, char *a3)
{
  char v4; // dh
  P_Type6 v5; // eax
  char v6; // dl
  char v7; // dl
  char v8; // dl
  char v9; // [esp+0h] [ebp-14h]
  char v10; // [esp+1h] [ebp-13h]
  char v11; // [esp+2h] [ebp-12h]

  if ( !a2 )
  {
    Q_PaletteGet_sub_2C2B0(a1, 0, 0x100, a1->palette1);
  }
  if ( a3 )
  {
    v9 = *a3;
    v10 = a3[1];
    v11 = a3[2];
  }
  else
  {
    v9 = 0;
    v10 = 0;
    v11 = 0;
  }
  v4 = 0x40 - a2;
  if ( (char)(0x40 - a2) < 0 )
  {
    v4 = 0;
  }
  v5 = a1;
  do
  {
    v8 = v5->palette1[0].r - v9;
    if ( v8 >= 0 )
    {
      if ( (char)(v8 - v4) > 0 )
      {
        --v5->palette1[0].r;
      }
    }
    else if ( (char)(v4 + v8) < 0 )
    {
      ++v5->palette1[0].r;
    }
    v6 = v5->palette1[0].g - v10;
    if ( v6 >= 0 )
    {
      if ( (char)(v6 - v4) > 0 )
      {
        --v5->palette1[0].g;
      }
    }
    else if ( (char)(v4 + v6) < 0 )
    {
      ++v5->palette1[0].g;
    }
    v7 = v5->palette1[0].b - v11;
    if ( v7 >= 0 )
    {
      if ( (char)(v7 - v4) > 0 )
      {
        --v5->palette1[0].b;
      }
    }
    else if ( (char)(v4 + v7) < 0 )
    {
      ++v5->palette1[0].b;
    }
    v5 = (P_Type6)((char *)v5 + 3);
  }
  while ( v5 != (P_Type6)&a1->palette1[0x99].b );
  Q_PaletteSet_sub_2C224(a1, 0, 0x100, a1->palette1);
}

//----- (0002BD4C) --------------------------------------------------------
void __fastcall sub_2BD4C(P_Type6 a1)
{
  a1->window.buffer = 0;
  a1->pane.window = 0;
  *(_DWORD *)&a1->fname[0xFF] = 0;
  a1->fname[0] = 0;
  a1->hazeTables = 0;
  a1->numTables = 0;
}

//----- (0002BD7C) --------------------------------------------------------
T_Type6 *__fastcall sub_2BD7C(T_Type6 *a1)
{
  Q_StopVideoSystem_sub_2C6CC(a1);
  return a1;
}

//----- (0002BD88) --------------------------------------------------------
unsigned int __fastcall sub_2BD88(P_Type6 a1, const char *a2, const char *a3)
{
  void *fname; // edx
  const char *v5; // esi
  char *v6; // edi
  char v7; // al
  char v8; // al
  const char *v9; // esi
  char *v10; // edi
  char v11; // al
  char v12; // al
  char *v13; // edi
  const char *v14; // esi
  char *v15; // edi
  char v16; // al
  char v17; // al
  const char *v18; // esi
  char *v19; // edi
  char v20; // al
  char v21; // al
  void *v22; // esi
  unsigned int result; // eax
  char *v24; // edi
  BYTE *v25; // esi
  int v26; // ecx
  bool v27; // zf
  BYTE *v28; // edi
  BYTE v29; // al
  BYTE v30; // al
  const char *v31; // esi
  char *v32; // edi
  char v33; // al
  char v34; // al
  UBYTE *buffer; // ecx
  UBYTE *v36; // eax
  int a; // eax
  int b; // eax
  int v39; // eax
  int v40; // eax
  UBYTE *v41; // edi
  char *v42; // [esp-4h] [ebp-234h]
  T_FileInfo v43; // [esp+0h] [ebp-230h] BYREF
  char v44[256]; // [esp+118h] [ebp-118h] BYREF
  const char *v45; // [esp+218h] [ebp-18h]
  void *drvr; // [esp+21Ch] [ebp-14h]

  v45 = a2;
  fname = a1->fname;
  v5 = v45;
  v6 = a1->fname;
  v42 = a1->fname;
  do
  {
    v7 = *v5;
    *v6 = *v5;
    if ( !v7 )
    {
      break;
    }
    v8 = v5[1];
    v5 += 2;
    v6[1] = v8;
    v6 += 2;
  }
  while ( v8 );
  v9 = "\\";
  v10 = &v42[strlen(v42)];
  do
  {
    v11 = *v9;
    *v10 = *v9;
    if ( !v11 )
    {
      break;
    }
    v12 = v9[1];
    v9 += 2;
    v10[1] = v12;
    v10 += 2;
  }
  while ( v12 );
  v13 = v42;
  if ( a3 )
  {
    v31 = a3;
    v26 = 0xFFFFFFFF;
    do
    {
      if ( !v26 )
      {
        break;
      }
      v27 = *v13++ == 0;
      --v26;
    }
    while ( !v27 );
    v32 = v13 + 0xFFFFFFFF;
    do
    {
      v33 = *v31;
      *v32 = *v31;
      if ( !v33 )
      {
        break;
      }
      v34 = v31[1];
      v31 += 2;
      v32[1] = v34;
      v32 += 2;
    }
    while ( v34 );
  }
  else
  {
    v14 = v45;
    v15 = v44;
    do
    {
      v16 = *v14;
      *v15 = *v14;
      if ( !v16 )
      {
        break;
      }
      v17 = v14[1];
      v14 += 2;
      v15[1] = v17;
      v15 += 2;
    }
    while ( v17 );
    v18 = "\\VFXSCAN.DLL";
    a3 = (const char *)0x200;
    v19 = &v44[strlen(v44)];
    do
    {
      v20 = *v18;
      *v19 = *v18;
      if ( !v20 )
      {
        break;
      }
      v21 = v18[1];
      v18 += 2;
      v19[1] = v21;
      v19 += 2;
    }
    while ( v21 );
    Q_InitFileInfo_sub_1BB78(&v43);
    Q_OpenFile_sub_1BBFC(&v43, v44, 0x200, 0);
    v22 = Q_CfileLoad_sub_1BF1C(&v43, 0);
    if ( !v22 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x9F);
    }
    Q_CloseFileAndDelete_sub_1BBC8(&v43);
    drvr = DLL_load(v22, 5u, 0);
    sub_2627C(v22);
    fname = drvr;
    operator delete(v22);
    if ( !fname )
    {
      return 0;
    }
    v24 = a1->fname;
    v25 = VFX_driver_name(fname);
    v26 = 0xFFFFFFFF;
    do
    {
      if ( !v26 )
      {
        break;
      }
      v27 = *v24++ == 0;
      --v26;
    }
    while ( !v27 );
    v28 = v24 + 0xFFFFFFFF;
    do
    {
      v29 = *v25;
      *v28 = *v25;
      if ( !v29 )
      {
        break;
      }
      v30 = v25[1];
      v25 += 2;
      v28[1] = v30;
      v28 += 2;
    }
    while ( v30 );
    free(drvr);
  }
  result = Q_GSYSTEM_CPP_sub_2BFDC(a1, (int)fname, (int)a3, v26);
  if ( result )
  {
    VFX_init_driver();
    buffer = a1->window.buffer;
    *(_DWORD *)&a1->fname[0xFF] = 0xFFFFFFFF;
    if ( buffer )
    {
      sub_262CC(buffer);
    }
    v36 = (UBYTE *)sub_262B0(a1->b * a1->a, 1u, 1, "OFFSCREEN BUFFER");
    a1->window.stencil = 0;
    a1->window.buffer = v36;
    a = a1->a;
    a1->window.shadow = 0;
    a1->window.x_max = a - 1;
    b = a1->b;
    a1->pane.x0 = 0;
    a1->window.y_max = b - 1;
    v39 = a1->a;
    a1->pane.y0 = 0;
    a1->pane.x1 = v39 - 1;
    v40 = a1->b;
    a1->pane.window = &a1->window;
    v41 = a1->window.buffer;
    a1->pane.y1 = v40 - 1;
    if ( !v41 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0xD9);
    }
    return 0xFFFFFFFF;
  }
  return result;
}
// 2BE8B: conditional instruction was optimized away because esi.4!=0
// 76D64: using guessed type void __fastcall operator delete(void *);
// 2BD88: using guessed type char var_118[256];

//----- (0002BFDC) --------------------------------------------------------
unsigned int __fastcall Q_GSYSTEM_CPP_sub_2BFDC(P_Type6 a1, int a2, int a3, int a4)
{
  void *v5; // esi
  void *v6; // edx
  VFX_DESC *VFX; // eax
  T_FileInfo v9; // [esp-128h] [ebp-12Ch] BYREF

  Q_InitFileInfo_sub_1BB78(&v9);
  Q_OpenFile_sub_1BBFC(&v9, a1->fname, O_BINARY, 0);
  v5 = Q_CfileLoad_sub_1BF1C(&v9, 0);
  if ( !v5 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0xEB);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v9);
  v6 = DLL_load(v5, DLLMEM_ALLOC|DLLSRC_MEM, 0);
  sub_2627C(v5);
  operator delete(v5);
  if ( !v6 )
  {
    return 0;
  }
  VFX_register_driver(v6);
  VFX = VFX_describe_driver();
  a1->a = VFX->scrn_width;
  a1->b = VFX->scrn_height;
  return 0xFFFFFFFF;
}
// 2C02A: conditional instruction was optimized away because esi.4!=0
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (0002C08C) --------------------------------------------------------
void __fastcall Q_AllocateHazeTables_sub_2C08C(P_Type6 a1, unsigned __int16 numTables)
{
  void *v4; // eax

  v4 = operator new[](numTables << 8);
  Q_RegisterData_sub_2625C(v4, 1, "GSYSTEM HAZE TABLES");
  a1->hazeTables = (T_HazeTables *)v4;
  a1->numTables = numTables;
}

//----- (0002C0C0) --------------------------------------------------------
int __fastcall Q_LoadHazeTables_sub_2C0C0(P_Type6 a1, const char *a2, unsigned __int16 num)
{
  void *v4; // edi
  T_FileInfo v6; // [esp+0h] [ebp-118h] BYREF

  if ( num >= a1->numTables )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x11F);
  }
  Q_InitFileInfo_sub_1BB78(&v6);
  Q_OpenFile_sub_1BBFC(&v6, a2, 0x200, 0);
  v4 = Q_CfileLoad_sub_1BF1C(&v6, (*a1->hazeTables)[num]);
  if ( !v4 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\gsystem.cpp", 0x127);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v6);
  return (v4 == 0) - 1;
}

//----- (0002C158) --------------------------------------------------------
unsigned int __fastcall Q_LoadPal_sub_2C158(P_Type6 a1, const char *aFName, int a3, unsigned __int16 a4)
{
  T_FileInfo v8; // [esp+0h] [ebp-124h] BYREF
  unsigned __int16 from[2]; // [esp+118h] [ebp-Ch]

  *(_DWORD *)from = a3;
  Q_InitFileInfo_sub_1BB78(&v8);
  Q_OpenFile_sub_1BBFC(&v8, aFName, O_BINARY, 0);
  if ( !Q_CfileLoad_sub_1BF1C(&v8, a1->palette2) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x13C);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v8);
  Q_PaletteSet_sub_2C224(a1, from[0], a4, a1->palette2);
  return 0xFFFFFFFF;
}
// 2C1AD: conditional instruction was optimized away because ecx.4!=0

//----- (0002C1E0) --------------------------------------------------------
int __fastcall sub_2C1E0(int a1, unsigned __int16 a2, unsigned __int16 a3, unsigned int a4)
{
  __int64 v5; // rax
  int v6; // ebx
  int v7; // esi

  v5 = a4;
  while ( SHIDWORD(v5) < a3 )
  {
    v6 = 3 * (HIDWORD(v5) + a2);
    v7 = v5;
    LODWORD(v5) = v5 + 3;
    ++HIDWORD(v5);
    *(_WORD *)(v6 + a1 + 0x433) = *(_WORD *)v7;
    *(_BYTE *)(v6 + a1 + 0x435) = *(_BYTE *)(v7 + 2);
  }
  return v5;
}

//----- (0002C224) --------------------------------------------------------
void __fastcall Q_PaletteSet_sub_2C224(P_Type6 a1, unsigned __int16 from, __int16 count, RGB *palette)
{
  LONG i; // esi
  RGB *triplet; // [esp-2h] [ebp-8h]

  VFX_wait_vblank_leading();
  for ( i = from; i < (__int16)(from + count); ++i )
  {
    triplet = palette++;
    VFX_DAC_write(i, triplet);
  }
}

//----- (0002C264) --------------------------------------------------------
void __fastcall Q_NC_sub_2C264(T_Type6 *a1)
{
  Q_PaletteSet_sub_2C224(a1, 0, 256, a1->palette2);
}

//----- (0002C280) --------------------------------------------------------
void __fastcall Q_NC_sub_2C280(P_Type6 a1, signed __int16 a2, __int16 a3)
{
  Q_PaletteSet_sub_2C224(a1, a2, a3, &a1->palette2[a2]);
}

//----- (0002C2B0) --------------------------------------------------------
void __fastcall Q_PaletteGet_sub_2C2B0(P_Type6 a1, unsigned __int16 from, __int16 count, RGB *palette)
{
  RGB *nextrgb; // edi
  LONG i; // esi
  RGB *triplet; // [esp-2h] [ebp-8h]

  nextrgb = palette;
  if ( !palette )
  {
    nextrgb = a1->palette2;
  }
  VFX_wait_vblank_leading();
  for ( i = from; i < (__int16)(from + count); ++i )
  {
    triplet = nextrgb++;
    VFX_DAC_read(i, triplet);
  }
}

//----- (0002C2F8) --------------------------------------------------------
void __fastcall sub_2C2F8(T_Type6 *a1, char *a2)
{
  int i; // ecx
  unsigned int v4; // eax

  for ( i = 0; i < 0x40; ++i )
  {
    sub_2BD04(a1, i, a2);
    v4 = i;
    delay(v4);
  }
}

//----- (0002C418) --------------------------------------------------------
void __fastcall sub_2C418(P_Type6 a1, int a2, __int16 a3)
{
  __int16 v3; // si
  LONG v4; // [esp-8h] [ebp-10h]
  RGB v5; // [esp+0h] [ebp-8h] BYREF
  int v6; // [esp+4h] [ebp-4h]

  v6 = a2;
  v3 = a2;
  VFX_wait_vblank_leading();
  if ( (__int16)(a3 + a2) > (__int16)a2 )
  {
    do
    {
      VFX_DAC_read(v3, &v5);
      if ( v5.r )
      {
        --v5.r;
      }
      if ( v5.r )
      {
        --v5.r;
      }
      if ( v5.g )
      {
        --v5.g;
      }
      if ( v5.g )
      {
        --v5.g;
      }
      if ( v5.b )
      {
        --v5.b;
      }
      if ( v5.b )
      {
        --v5.b;
      }
      v4 = v3++;
      VFX_DAC_write(v4, &v5);
    }
    while ( v3 < (__int16)(a3 + a2) );
  }
}
// 2C418: using guessed type RGB anonymous_0;

//----- (0002C4C0) --------------------------------------------------------
void __fastcall sub_2C4C0(P_Type6 a1, int a2, int a3)
{
  __int16 i; // si
  RGB v5; // [esp+0h] [ebp-1Ch] BYREF
  int v6; // [esp+4h] [ebp-18h]
  int v7; // [esp+8h] [ebp-14h]

  v6 = a2;
  VFX_wait_vblank_leading();
  v7 = a3 + a2;
  for ( i = a2; i < (__int16)v7; ++i )
  {
    VFX_DAC_read(i, &v5);
    if ( v5.r < a1->palette2[i].r )
    {
      ++v5.r;
    }
    if ( v5.r < a1->palette2[i].r )
    {
      ++v5.r;
    }
    if ( v5.g < a1->palette2[i].g )
    {
      ++v5.g;
    }
    if ( v5.g < a1->palette2[i].g )
    {
      ++v5.g;
    }
    if ( v5.b < a1->palette2[i].b )
    {
      ++v5.b;
    }
    if ( v5.b < a1->palette2[i].b )
    {
      ++v5.b;
    }
    VFX_DAC_write(i, &v5);
  }
}

//----- (0002C5C0) --------------------------------------------------------
void __fastcall Q_NC_sub_2C5C0(T_Type6 *a1)
{
  int i; // ebx
  unsigned int v3; // eax

  for ( i = 0; i < 64; ++i )
  {
    Q_FadePalette_sub_2C5E4(a1, i);
    v3 = i;
    delay(v3);
  }
}

//----- (0002C5E4) --------------------------------------------------------
void __fastcall Q_FadePalette_sub_2C5E4(P_Type6 a1, char a2)
{
  UBYTE *color2; // ebx
  char v4; // dh
  UBYTE *color1; // eax
  char v6; // dl

  if ( !a2 )
  {
    Q_PaletteGet_sub_2C2B0(a1, 0, 256, a1->palette1);
  }
  color2 = &a1->palette2[0].r;
  v4 = 64 - a2;
  color1 = &a1->palette1[0].r;
  do
  {
    v6 = *color1 - *color2;
    if ( v6 >= 0 )
    {
      if ( (char)(v6 - v4) > 0 )
      {
        --*color1;
      }
    }
    else if ( (char)(v4 + v6) < 0 )
    {
      ++*color1;
    }
    ++color1;
    ++color2;
  }
  while ( color1 != (UBYTE *)a1->palette2 );
  Q_PaletteSet_sub_2C224(a1, 0, 256, a1->palette1);
}

//----- (0002C670) --------------------------------------------------------
void __fastcall sub_2C670(int a1, int a2, int a3, char *a4)
{
  RGB *v4; // edi
  __int16 v5; // si
  char v6[4]; // [esp+0h] [ebp-14h] BYREF
  int v7; // [esp+4h] [ebp-10h]
  int v8; // [esp+8h] [ebp-Ch]

  v8 = a2;
  v4 = (RGB *)a4;
  if ( !a4 )
  {
    v4 = (RGB *)v6;
    v6[1] = 0;
    v6[2] = 0;
    v6[0] = 0;
  }
  v5 = v8;
  v7 = a3 + v8;
  VFX_wait_vblank_leading();
  for ( ; v5 < (__int16)v7; ++v5 )
  {
    VFX_DAC_write(v5, v4);
  }
}

//----- (0002C6CC) --------------------------------------------------------
void __fastcall Q_StopVideoSystem_sub_2C6CC(P_Type6 a1)
{
  UBYTE *buffer; // ebx

  if ( *(_DWORD *)&a1->fname[0xFF] == 0xFFFFFFFF )
  {
    VFX_shutdown_driver();
  }
  buffer = a1->window.buffer;
  *(_DWORD *)&a1->fname[0xFF] = 0;
  if ( buffer )
  {
    sub_262CC(buffer);
    a1->window.buffer = 0;
  }
  if ( a1->window.shadow )
  {
    sub_262CC(a1->window.shadow);
    a1->window.shadow = 0;
  }
  sub_2627C(a1->hazeTables);
  operator delete[](a1->hazeTables);
  a1->hazeTables = 0;
  a1->numTables = 0;
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);

//----- (0002C744) --------------------------------------------------------
void __fastcall Q_GSYSTEM_CPP_PreloadMouseShp_sub_2C744(P_Type6 a1, char *a2, int a3, int a4)
{
  void *v5; // eax
  T_FileInfo v6; // [esp-124h] [ebp-128h] BYREF

  if ( V_Mouse.initialized )
  {
    if ( !a1->c )
    {
      Q_InitFileInfo_sub_1BB78(&v6);
      Q_OpenFile_sub_1BBFC(&v6, "DATA\\MOUSE.SHP", O_BINARY, 0);
      v5 = Q_CfileLoad_sub_1BF1C(&v6, 0);
      a1->c = (int)v5;
      if ( !v5 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x2B3);
      }
      a1->d = 0;
      Q_CloseFileAndDelete_sub_1BBC8(&v6);
    }
    MOUSE_set_pointer((void *)a1->c, a1->d);
  }
}

//----- (0002C7D0) --------------------------------------------------------
void __fastcall Q_GSYSTEM_CPP_sub_2C7D0(T_Type6 *a1, int a2, int a3)
{
  void *c; // ecx

  c = (void *)a3;
  if ( !a3 )
  {
    c = (void *)a1->c;
  }
  if ( !c )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x2C7);
  }
  if ( a2 < 0 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gsystem.cpp", 0x2C8);
  }
  MOUSE_set_pointer(c, a2);
}
// 2C80C: conditional instruction was optimized away because ecx.4!=0

//----- (0002C830) --------------------------------------------------------
void __fastcall __spoils<> Q_A2_sub_2C830(P_TypeA2 a1)
{
  a1->b = (int)off_95E20;
  Q_A1_sub_2C8E4(&a1->a1);
}
// 95E20: using guessed type int (*off_95E20[5])();

//----- (0002C848) --------------------------------------------------------
int __fastcall sub_2C848(int a1, char a2)
{
  void *v3; // eax
  int v4; // edx
  __int16 i; // ax
  int v6; // edx
  _DWORD *v7; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95D7C);
    operator delete[](v3);
  }
  else
  {
    v4 = *(_DWORD *)(a1 + 0x67);
    *(_DWORD *)(a1 + 0xA7) = off_95E20;
    if ( v4 )
    {
      for ( i = 0; i < 0x14; ++i )
      {
        v6 = *(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * i);
        if ( v6 )
        {
          *(_DWORD *)(v6 + 0x63) = 0;
        }
      }
      sub_262CC(*(void **)(a1 + 0x67));
    }
    v7 = *(_DWORD **)(a1 + 0x63);
    if ( v7 )
    {
      sub_2CA0C((int)V_Type3_stru_10AE70.wnds[(_DWORD)v7].a1, a1, v7);
    }
    if ( (a2 & 2) != 0 )
    {
      operator delete((void *)a1);
    }
  }
  return a1;
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95E20: using guessed type int (*off_95E20[5])();

//----- (0002C8E4) --------------------------------------------------------
void __fastcall __spoils<> Q_A1_sub_2C8E4(P_TypeA1 result)
{
  result->index = 0;
  result->pane.window = 0;
  result->d = 0xFFFF;
  result->e = 0;
  result->shapeFrame = 0xFFFF;
  result->name[0] = 0;
  result->i = 0;
  result->j = 0;
  result->k = 0;
  result->r = 0xFFFF;
  result->s = 0xFFFF;
  result->t = 0xFFFF;
  result->u = 0;
  result->sendMessage = 0;
  result->sendParam1 = 0;
  result->sendParam2 = 0;
  result->helpIndex[0] = 0;
  result->parentIndex = 0;
  result->children = 0;
  result->childrenCnt = 0;
  result->z = 0;
  result->zz = 0xFFFFFFFF;
}

//----- (0002C978) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_2C978(P_TypeA1 a1)
{
  a1->index = Q_WINMGR_CPP_RegisterWindow_sub_571B8(&V_Type3_stru_10AE70, a1);
}

//----- (0002C990) --------------------------------------------------------
unsigned int __fastcall Q_GWINDOW_CPP_LinkChild_sub_2C990(P_TypeA1 a1, P_TypeA1 a2)
{
  T_ChildWindows *children; // eax
  __int16 childrenCnt; // ax

  if ( !a1->childrenCnt )
  {
    if ( a1->children )
    {
      sub_262CC(a1->children);
    }
    children = (T_ChildWindows *)Q_Allocate_sub_2628C(0x50u, 1, "CHILD WINDOWS");
    a1->children = children;
    memset(children, 0, sizeof(T_ChildWindows));
  }
  if ( (__int16)a1->childrenCnt >= 20 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x94);
  }
  childrenCnt = a1->childrenCnt;
  a1->childrenCnt = childrenCnt + 1;
  (*a1->children)[childrenCnt] = a2;
  return 0xFFFFFFFF;
}

//----- (0002CA0C) --------------------------------------------------------
unsigned int __fastcall sub_2CA0C(int a1, int a2, _DWORD *a3)
{
  unsigned int v3; // esi
  __int16 i; // kr00_2

  v3 = 0;
  if ( *(_DWORD *)(a1 + 0x67) )
  {
    for ( i = 0; i < 0x14; ++i )
    {
      if ( a2 == *a3 )
      {
        *a3 = 0;
        v3 = 0xFFFFFFFF;
        --*(_WORD *)(a1 + 0x6B);
      }
    }
  }
  return v3;
}

//----- (0002CA58) --------------------------------------------------------
int __fastcall Q_NC_sub_2CA58(int a1)
{
  return (*(int (**)(void))(*(_DWORD *)(a1 + 0xA7) + 4))();
}

//----- (0002CA78) --------------------------------------------------------
_DWORD *__fastcall sub_2CA78(_DWORD *result, __int16 a2, __int16 a3)
{
  int v3; // edi
  int v4; // ebp
  int v5; // esi

  v3 = result[3];
  v4 = result[5];
  v5 = a2 + result[4];
  result[2] += a2;
  result[4] = v5;
  result[3] = a3 + v3;
  result[5] = a3 + v4;
  return result;
}

//----- (0002CD24) --------------------------------------------------------
void __fastcall sub_2CD24(unsigned int a1, int a2)
{
  void *ShapeTable_sub_1B084; // eax
  __int16 v3; // ax
  LONG v4; // [esp-18h] [ebp-1Ch]
  LONG v5; // [esp-14h] [ebp-18h]
  LONG v6; // [esp-Ch] [ebp-10h]

  if ( *(_DWORD *)(a1 + 0x39) )
  {
    if ( (*(_DWORD *)V_Type3_stru_10AE70.z1aa == *(_DWORD *)(a1 + 0x41) || a2 == 3) && *(_DWORD *)(a1 + 0x3D) && a2 != 2 )
    {
      (*(void (__fastcall **)(unsigned int, int))(*(_DWORD *)(a1 + 0xA7) + 0x10))(a1, a2);
    }
    else
    {
      if ( *(__int16 *)(a1 + 0x1E) == 0xFFFFFFFF )
      {
        if ( *(_WORD *)(a1 + 0xA1) )
        {
          sub_2D0F4(a1, 0);
        }
        else
        {
          VFX_pane_wipe((PANE *)(a1 + 4), 0xF2);
          *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = *(_DWORD *)(a1 + 4);
          V_Type3_stru_10AE70.rect.x1 = *(_DWORD *)(a1 + 8);
          V_Type3_stru_10AE70.rect.y1 = *(_DWORD *)(a1 + 0xC);
          V_Type3_stru_10AE70.rect.x2 = *(_DWORD *)(a1 + 0x10);
          V_Type3_stru_10AE70.rect.y2 = *(_DWORD *)(a1 + 0x14);
          v3 = 0;
          if ( *(__int16 *)(a1 + 0x5B) == 0xFFFFFFFF )
          {
            v3 = 2;
          }
          if ( *(__int16 *)(a1 + 0x5D) == 0xFFFFFFFF )
          {
            LOBYTE(v3) = v3 | 1;
          }
          sub_2B8A8(
            (int)&V_Type3_stru_10AE70.z1cc[4],
            *(__int16 *)(a1 + 0x5B),
            *(__int16 *)(a1 + 0x5D),
            (const char *)(a1 + 0x20),
            v3,
            0xFFFFFFFF,
            0xFF,
            0);
          if ( *(_DWORD *)(a1 + 0x5F) == 0xFFFFFFFF )
          {
            VFX_line_draw((PANE *)(a1 + 4), 0, 0, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), 0, 0, 0xF3);
            VFX_line_draw((PANE *)(a1 + 4), 0, 0, 0, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), 0, 0xF3);
            v5 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
            VFX_line_draw((PANE *)(a1 + 4), *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), v5, 0, v5, 0, 0xF3);
            v4 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8);
            VFX_line_draw((PANE *)(a1 + 4), v4, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), v4, 0, 0, 0xF3);
          }
        }
      }
      else
      {
        v6 = *(__int16 *)(a1 + 0x1E);
        ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                                 (unsigned int)&V_Type3_stru_10AE70.t13,
                                 *(unsigned __int16 *)(a1 + 0x18));
        VFX_shape_draw((PANE *)(a1 + 4), ShapeTable_sub_1B084, v6, 0, 0);
      }
      sub_55274(
        &V_Type3_stru_10AE70,
        *(_DWORD *)(a1 + 8),
        *(_DWORD *)(a1 + 0xC),
        *(_DWORD *)(a1 + 0x10),
        *(_DWORD *)(a1 + 0x14));
    }
    if ( *(_WORD *)(a1 + 0x6B) )
    {
      sub_2D218((_DWORD *)a1);
    }
  }
}

//----- (0002CF28) --------------------------------------------------------
void __fastcall sub_2CF28(unsigned int a1)
{
  PANE *v1; // esi
  void *ShapeTable_sub_1B084; // eax
  __int16 v3; // ax
  LONG v4; // [esp-18h] [ebp-1Ch]
  LONG v5; // [esp-14h] [ebp-18h]
  LONG v6; // [esp-Ch] [ebp-10h]

  v1 = (PANE *)(a1 + 4);
  if ( *(__int16 *)(a1 + 0x1E) == 0xFFFFFFFF )
  {
    if ( *(_WORD *)(a1 + 0xA1) )
    {
      sub_2D0F4(a1, 1);
    }
    else
    {
      VFX_pane_wipe((PANE *)(a1 + 4), 0x96);
      *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = *(_DWORD *)(a1 + 4);
      V_Type3_stru_10AE70.rect.x1 = *(_DWORD *)(a1 + 8);
      V_Type3_stru_10AE70.rect.y1 = *(_DWORD *)(a1 + 0xC);
      V_Type3_stru_10AE70.rect.x2 = *(_DWORD *)(a1 + 0x10);
      V_Type3_stru_10AE70.rect.y2 = *(_DWORD *)(a1 + 0x14);
      v3 = 0;
      if ( *(__int16 *)(a1 + 0x5B) == 0xFFFFFFFF )
      {
        v3 = 2;
      }
      if ( *(__int16 *)(a1 + 0x5D) == 0xFFFFFFFF )
      {
        LOBYTE(v3) = v3 | 1;
      }
      sub_2B8A8(
        (int)&V_Type3_stru_10AE70.z1cc[4],
        *(__int16 *)(a1 + 0x5B),
        *(__int16 *)(a1 + 0x5D),
        (const char *)(a1 + 0x20),
        v3,
        0xFFFFFFFF,
        0xFF,
        0);
      if ( *(_DWORD *)(a1 + 0x5F) == 0xFFFFFFFF )
      {
        VFX_line_draw((PANE *)(a1 + 4), 0, 0, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), 0, 0, 0xF3);
        VFX_line_draw((PANE *)(a1 + 4), 0, 0, 0, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), 0, 0xF3);
        v5 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
        VFX_line_draw((PANE *)(a1 + 4), *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), v5, 0, v5, 0, 0xF3);
        v4 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8);
        VFX_line_draw((PANE *)(a1 + 4), v4, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), v4, 0, 0, 0xF3);
      }
    }
  }
  else
  {
    VFX_shape_lookaside((UBYTE *)V_Type3_stru_10AE70.hazeTableMapFocus);
    v6 = *(__int16 *)(a1 + 0x1E);
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                             (unsigned int)&V_Type3_stru_10AE70.t13,
                             *(unsigned __int16 *)(a1 + 0x18));
    VFX_shape_translate_draw(v1, ShapeTable_sub_1B084, v6, 0, 0);
  }
  sub_55274(
    &V_Type3_stru_10AE70,
    *(_DWORD *)(a1 + 8),
    *(_DWORD *)(a1 + 0xC),
    *(_DWORD *)(a1 + 0x10),
    *(_DWORD *)(a1 + 0x14));
}

//----- (0002D0F4) --------------------------------------------------------
unsigned int __fastcall sub_2D0F4(unsigned int a1, int a2)
{
  LONG v2; // eax
  PANE *v3; // esi
  unsigned int result; // eax
  unsigned int i; // ebp
  char *v6; // eax
  int v7; // ebx
  int v8; // edx
  void *ShapeTable_sub_1B084; // eax
  __int16 v10; // [esp-10h] [ebp-30h]
  LONG v11; // [esp-Ch] [ebp-2Ch]
  LONG v12; // [esp-8h] [ebp-28h]
  LONG v13; // [esp-4h] [ebp-24h]
  int v15; // [esp+8h] [ebp-18h]

  v2 = 0xF2;
  if ( a2 )
  {
    v2 = 0x96;
  }
  v3 = (PANE *)(a1 + 4);
  VFX_pane_wipe((PANE *)(a1 + 4), v2);
  result = a1;
  v15 = 0;
  for ( i = a1 + 0x6D; (__int16)v15 < *(__int16 *)(a1 + 0xA1); ++v15 )
  {
    if ( !i )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x1CE);
    }
    if ( *(_BYTE *)i )
    {
      if ( *(_BYTE *)i == 1 )
      {
        v13 = *(__int16 *)(i + 0xB);
        v12 = *(__int16 *)(i + 9);
        v11 = *(_DWORD *)(i + 5);
        ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                                 (unsigned int)&V_Type3_stru_10AE70.t13,
                                 *(unsigned __int16 *)(i + 1));
        VFX_shape_draw(v3, ShapeTable_sub_1B084, v11, v12, v13);
      }
      else
      {
        Q_AssertLogBreakExit_sub_261A8(0, "..\\gwindow.cpp", 0x1DF);
      }
    }
    else
    {
      v6 = sub_2D3D0(*(_DWORD *)(i + 1));
      v7 = *(__int16 *)(i + 0xB);
      v8 = *(__int16 *)(i + 9);
      v10 = *(_WORD *)(i + 5);
      *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = v3->window;
      V_Type3_stru_10AE70.rect.x1 = *(_DWORD *)(a1 + 8);
      V_Type3_stru_10AE70.rect.y1 = *(_DWORD *)(a1 + 0xC);
      V_Type3_stru_10AE70.rect.x2 = *(_DWORD *)(a1 + 0x10);
      V_Type3_stru_10AE70.rect.y2 = *(_DWORD *)(a1 + 0x14);
      result = sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], v8, v7, v6, v10, 0xF3, 0xFF, 0);
    }
    i += 0xD;
  }
  return result;
}

//----- (0002D218) --------------------------------------------------------
void __fastcall sub_2D218(_DWORD *a1)
{
  __int16 i; // kr00_2
  int v2; // ecx

  if ( *(_DWORD *)((char *)a1 + 0x67) )
  {
    for ( i = 0; i < 0x14; ++i )
    {
      v2 = *a1;
      if ( *a1 )
      {
        a1 = (_DWORD *)*a1;
        if ( *(_DWORD *)(v2 + 0x39) == 0xFFFFFFFF )
        {
          (*(void (__fastcall **)(_DWORD *, _DWORD))(*(_DWORD *)(v2 + 0xA7) + 0xC))(a1, 0);
        }
      }
    }
  }
}

//----- (0002D258) --------------------------------------------------------
int __fastcall sub_2D258(int result, __int16 a2)
{
  int v2; // edi
  __int16 i; // si
  int v4; // ebx

  v2 = result;
  if ( *(_DWORD *)(result + 0x67) )
  {
    for ( i = 0; ; ++i )
    {
      result = i;
      if ( i >= 0x14 )
      {
        break;
      }
      v4 = *(_DWORD *)(4 * i + *(_DWORD *)(v2 + 0x67));
      if ( v4 && (*(_DWORD *)(v4 + 0x35) || a2 == 1) )
      {
        (*(void (**)(void))(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)(v2 + 0x67) + 4 * i) + 0xA7) + 8))();
      }
    }
  }
  return result;
}

//----- (0002D2CC) --------------------------------------------------------
int Q_GWINDOW_CPP_LoadGwshareTxt_sub_2D2CC()
{
  FILE *v0; // ecx
  int i; // ebx
  char filename[52]; // [esp+0h] [ebp-34h] BYREF

  v0 = Q_OpenFile_sub_1BB10("gwshare.txt", 0);
  if ( !v0 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x214);
  }
  for ( i = 0; i != 0x2D; word_FFE9E[i] = sub_1ADAC(&V_Type3_stru_10AE70.t13, filename) )
  {
    fscanf(v0, "%s", filename);
    ++i;
  }
  return fclose(v0);
}
// FFE9E: using guessed type __int16 word_FFE9E[];
// 2D2CC: using guessed type char filename[52];

//----- (0002D334) --------------------------------------------------------
int __fastcall sub_2D334(const char *a1)
{
  const char *v1; // esi
  unsigned int v2; // kr04_4
  char *v3; // edi
  char v4; // al
  char v5; // al
  int result; // eax

  v1 = a1;
  if ( !a1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x226);
  }
  v2 = strlen(a1) + 1;
  if ( (int)(v2 - 1 + SHIWORD(dword_100302)) >= 0x400 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x229);
  }
  v3 = (char *)&unk_FFF04 + SHIWORD(dword_100302);
  do
  {
    v4 = *v1;
    *v3 = *v1;
    if ( !v4 )
    {
      break;
    }
    v5 = v1[1];
    v1 += 2;
    v3[1] = v5;
    v3 += 2;
  }
  while ( v5 );
  result = SHIWORD(dword_100302);
  HIWORD(dword_100302) += v2;
  return result;
}
// 2D334: could not find valid save-restore pair for edi
// 100302: using guessed type int dword_100302;

//----- (0002D3D0) --------------------------------------------------------
char *__fastcall sub_2D3D0(int a1)
{
  if ( a1 >= SHIWORD(dword_100302) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x237);
  }
  return (char *)&unk_FFF04 + a1;
}
// 100302: using guessed type int dword_100302;

//----- (0002D400) --------------------------------------------------------
unsigned int __fastcall sub_2D400(int a1, int a2)
{
  unsigned int result; // eax
  __int16 v4; // cx

  if ( *(__int16 *)(a1 + 0xA1) < 4 )
  {
    v4 = *(_WORD *)(a1 + 0xA1);
    *(_WORD *)(a1 + 0xA1) = v4 + 1;
    result = 0xFFFFFFFF;
    *(_DWORD *)(a1 + 0xD * v4 + 0x6D) = *(_DWORD *)a2;
    *(_DWORD *)(a1 + 0xD * v4 + 0x71) = *(_DWORD *)(a2 + 4);
    *(_DWORD *)(a1 + 0xD * v4 + 0x75) = *(_DWORD *)(a2 + 8);
    *(_BYTE *)(a1 + 0xD * v4 + 0x79) = *(_BYTE *)(a2 + 0xC);
  }
  else
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\gwindow.cpp", 0x241);
    return 0;
  }
  return result;
}

//----- (0002D464) --------------------------------------------------------
void __fastcall __spoils<> Q_A4_sub_2D464(P_TypeA4 a1)
{
  Q_A2_sub_2C830(&a1->a);
  a1->a.b = (int)off_95E08;
  Q_A4_sub_2D4C4(a1);
}
// 95E08: using guessed type int (*off_95E08[5])();

//----- (0002D480) --------------------------------------------------------
int __fastcall sub_2D480(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95D68);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95E08;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95E08: using guessed type int (*off_95E08[5])();

//----- (0002D4C4) --------------------------------------------------------
void __fastcall __spoils<> Q_A4_sub_2D4C4(P_TypeA4 result)
{
  result->b = 0;
}

//----- (0002D4D0) --------------------------------------------------------
unsigned int __fastcall sub_2D4D0(_DWORD *a1, __int16 a2, int a3, int a4)
{
  if ( (unsigned __int16)a2 < 4u || (unsigned __int16)a2 > 5u || a3 < a1[2] || a3 > a1[4] || a4 < a1[3] || a4 > a1[5] )
  {
    return sub_2F424((int)a1, a2, a3, a4);
  }
  *(_DWORD *)((char *)a1 + 0xAB) = ~*(_DWORD *)((char *)a1 + 0xAB);
  (*(void (__fastcall **)(_DWORD *, _DWORD))(*(_DWORD *)((char *)a1 + 0xA7) + 0x10))(a1, 0);
  return sub_2F424((int)a1, a2, a3, a4);
}

//----- (0002D528) --------------------------------------------------------
void __fastcall sub_2D528(int a1, int a2)
{
  PANE *v2; // esi
  void *ShapeTable_sub_1B084; // eax
  void *v4; // eax
  LONG v5; // eax
  LONG v6; // [esp-18h] [ebp-1Ch]
  LONG v7; // [esp-14h] [ebp-18h]
  LONG v8; // [esp-Ch] [ebp-10h]
  LONG v9; // [esp-Ch] [ebp-10h]
  T_HazeTable *hazeTableMapFocus; // [esp-4h] [ebp-8h]

  if ( *(_DWORD *)(a1 + 0x39) )
  {
    if ( (*(_DWORD *)V_Type3_stru_10AE70.z1aa == *(_DWORD *)(a1 + 0x41) || a2 == 3) && *(_DWORD *)(a1 + 0x3D) && a2 != 2 )
    {
      (*(void (__fastcall **)(int, int))(*(_DWORD *)(a1 + 0xA7) + 0x10))(a1, a2);
    }
    else
    {
      if ( *(__int16 *)(a1 + 0x1E) == 0xFFFFFFFF )
      {
        v5 = 0xF2;
        if ( *(_DWORD *)(a1 + 0xAB) == 0xFFFFFFFF )
        {
          v5 = 0x50;
        }
        VFX_pane_wipe((PANE *)(a1 + 4), v5);
        *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = *(_DWORD *)(a1 + 4);
        V_Type3_stru_10AE70.rect.x1 = *(_DWORD *)(a1 + 8);
        V_Type3_stru_10AE70.rect.y1 = *(_DWORD *)(a1 + 0xC);
        V_Type3_stru_10AE70.rect.x2 = *(_DWORD *)(a1 + 0x10);
        V_Type3_stru_10AE70.rect.y2 = *(_DWORD *)(a1 + 0x14);
        if ( *(__int16 *)(a1 + 0x5B) == 0xFFFFFFFF && *(__int16 *)(a1 + 0x5D) == 0xFFFFFFFF )
        {
          sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0, (const char *)(a1 + 0x20), 3, 0xFFFFFFFF, 0xFF, 0);
        }
        else
        {
          sub_2B8A8(
            (int)&V_Type3_stru_10AE70.z1cc[4],
            *(__int16 *)(a1 + 0x5B),
            *(__int16 *)(a1 + 0x5D),
            (const char *)(a1 + 0x20),
            0,
            0xFFFFFFFF,
            0xFF,
            0);
        }
        if ( *(_DWORD *)(a1 + 0x5F) == 0xFFFFFFFF )
        {
          VFX_line_draw((PANE *)(a1 + 4), 0, 0, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), 0, 0, 0xF3);
          VFX_line_draw((PANE *)(a1 + 4), 0, 0, 0, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), 0, 0xF3);
          v7 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
          VFX_line_draw((PANE *)(a1 + 4), *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), v7, 0, v7, 0, 0xF3);
          v6 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8);
          VFX_line_draw((PANE *)(a1 + 4), v6, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), v6, 0, 0, 0xF3);
        }
      }
      else
      {
        v2 = (PANE *)(a1 + 4);
        if ( *(_DWORD *)(a1 + 0xAB) == 0xFFFFFFFF )
        {
          hazeTableMapFocus = V_Type3_stru_10AE70.hazeTableMapFocus;
          (*V_Type3_stru_10AE70.hazeTableMapFocus)[0xF2] = 0x50;
          VFX_shape_lookaside((UBYTE *)hazeTableMapFocus);
          v8 = *(__int16 *)(a1 + 0x1E);
          ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                                   (unsigned int)&V_Type3_stru_10AE70.t13,
                                   *(unsigned __int16 *)(a1 + 0x18));
          VFX_shape_translate_draw(v2, ShapeTable_sub_1B084, v8, 0, 0);
          (*V_Type3_stru_10AE70.hazeTableMapFocus)[0xF2] = 0x96;
        }
        else
        {
          v9 = *(__int16 *)(a1 + 0x1E);
          v4 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                 (unsigned int)&V_Type3_stru_10AE70.t13,
                 *(unsigned __int16 *)(a1 + 0x18));
          VFX_shape_draw(v2, v4, v9, 0, 0);
        }
      }
      sub_55274(
        &V_Type3_stru_10AE70,
        *(_DWORD *)(a1 + 8),
        *(_DWORD *)(a1 + 0xC),
        *(_DWORD *)(a1 + 0x10),
        *(_DWORD *)(a1 + 0x14));
    }
    if ( *(_WORD *)(a1 + 0x6B) )
    {
      sub_2D218((_DWORD *)a1);
    }
  }
}

//----- (0002D79C) --------------------------------------------------------
void __fastcall sub_2D79C(int a1)
{
  PANE *v1; // esi
  void *ShapeTable_sub_1B084; // eax
  void *v3; // eax
  LONG v4; // eax
  LONG v5; // [esp-18h] [ebp-20h]
  LONG v6; // [esp-14h] [ebp-1Ch]
  LONG v7; // [esp-Ch] [ebp-14h]
  LONG v8; // [esp-Ch] [ebp-14h]
  T_HazeTable *hazeTableMapFocus; // [esp-4h] [ebp-Ch]
  PANE *pane; // [esp+0h] [ebp-8h]

  if ( *(__int16 *)(a1 + 0x1E) == 0xFFFFFFFF )
  {
    v4 = 0x96;
    if ( *(_DWORD *)(a1 + 0xAB) == 0xFFFFFFFF )
    {
      v4 = 0xCA;
    }
    pane = (PANE *)(a1 + 4);
    VFX_pane_wipe((PANE *)(a1 + 4), v4);
    *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = *(_DWORD *)(a1 + 4);
    V_Type3_stru_10AE70.rect.x1 = *(_DWORD *)(a1 + 8);
    V_Type3_stru_10AE70.rect.y1 = *(_DWORD *)(a1 + 0xC);
    V_Type3_stru_10AE70.rect.x2 = *(_DWORD *)(a1 + 0x10);
    V_Type3_stru_10AE70.rect.y2 = *(_DWORD *)(a1 + 0x14);
    sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0, (const char *)(a1 + 0x20), 3, 0xFFFFFFFF, 0xFF, 0);
    if ( *(_DWORD *)(a1 + 0x5F) == 0xFFFFFFFF )
    {
      VFX_line_draw(pane, 0, 0, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), 0, 0, 0xF3);
      VFX_line_draw(pane, 0, 0, 0, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), 0, 0xF3);
      v6 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
      VFX_line_draw(pane, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), v6, 0, v6, 0, 0xF3);
      v5 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8);
      VFX_line_draw(pane, v5, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), v5, 0, 0, 0xF3);
    }
  }
  else
  {
    v1 = (PANE *)(a1 + 4);
    if ( *(_DWORD *)(a1 + 0xAB) == 0xFFFFFFFF )
    {
      hazeTableMapFocus = V_Type3_stru_10AE70.hazeTableMapFocus;
      (*V_Type3_stru_10AE70.hazeTableMapFocus)[0xF2] = 0xCA;
      VFX_shape_lookaside((UBYTE *)hazeTableMapFocus);
      v7 = *(__int16 *)(a1 + 0x1E);
      ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                               (unsigned int)&V_Type3_stru_10AE70.t13,
                               *(unsigned __int16 *)(a1 + 0x18));
      VFX_shape_translate_draw(v1, ShapeTable_sub_1B084, v7, 0, 0);
      (*V_Type3_stru_10AE70.hazeTableMapFocus)[0xF2] = 0x96;
    }
    else
    {
      VFX_shape_lookaside((UBYTE *)V_Type3_stru_10AE70.hazeTableMapFocus);
      v8 = *(__int16 *)(a1 + 0x1E);
      v3 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, *(unsigned __int16 *)(a1 + 0x18));
      VFX_shape_translate_draw(v1, v3, v8, 0, 0);
    }
  }
  sub_55274(
    &V_Type3_stru_10AE70,
    *(_DWORD *)(a1 + 8),
    *(_DWORD *)(a1 + 0xC),
    *(_DWORD *)(a1 + 0x10),
    *(_DWORD *)(a1 + 0x14));
}

//----- (0002D99C) --------------------------------------------------------
int __fastcall sub_2D99C(int a1, unsigned int count, int a3)
{
  void *v5; // edx

  v5 = (void *)(a1 + 0xAB);
  if ( a3 == 0xFFFFFFFF )
  {
    return Q_ReadFile_sub_1BF94((P_FileInfo)count, v5, 4u);
  }
  else
  {
    return Q_CFILE_CPP_dos_write_sub_1C098((int *)count, v5, 4u);
  }
}

//----- (0002D9C4) --------------------------------------------------------
void __fastcall __spoils<> Q_A3_sub_2D9C4(P_TypeA3 a1)
{
  Q_A2_sub_2C830(&a1->a2);
  a1->a2.b = (int)off_95DF0;
  a1->controls = 0;
  a1->numControls = 0;
  a1->e = 0xFFFF;
  Q_A1_sub_2DA60(&a1->a2.a1);
}
// 95DF0: using guessed type int (*off_95DF0[5])();

//----- (0002D9FC) --------------------------------------------------------
int __fastcall sub_2D9FC(int a1, char a2)
{
  void *v4; // eax
  void *v6; // edx
  void *v7; // eax
  void *v8; // ebx

  if ( (a2 & 4) != 0 )
  {
    v4 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95D54);
    operator delete[](v4);
    return a1;
  }
  else
  {
    v6 = *(void **)(a1 + 0xAB);
    *(_DWORD *)(a1 + 0xA7) = off_95DF0;
    if ( v6 )
    {
      sub_262CC(v6);
      *(_DWORD *)(a1 + 0xAB) = 0;
    }
    v7 = (void *)sub_2C848(a1, 1);
    v8 = v7;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v7);
    }
    return (int)v8;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95DF0: using guessed type int (*off_95DF0[5])();

//----- (0002DA60) --------------------------------------------------------
void __fastcall __spoils<> Q_A1_sub_2DA60(P_TypeA1 result)
{
  result->r = 7;
}

//----- (0002DA68) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_2DA68(P_TypeA1 a1)
{
  a1->index = Q_WINMGR_CPP_RegisterWindow_sub_571B8(&V_Type3_stru_10AE70, a1);
}

//----- (0002DA80) --------------------------------------------------------
MACRO_VFX_BOOL __fastcall sub_2DA80(P_TypeA3 a1, __int16 numControls)
{
  MACRO_VFX_BOOL result; // eax

  if ( numControls <= 0 )
  {
    return 0;
  }
  result = (MACRO_VFX_BOOL)sub_262B0(numControls, 0xEu, 1, "CONTROLS");
  a1->controls = (void *)result;
  if ( result )
  {
    result = TRUE;
    a1->numControls = numControls;
  }
  return result;
}

//----- (0002DAC8) --------------------------------------------------------
unsigned int __fastcall sub_2DAC8(P_TypeA3 a1, __int16 a2, __int16 a3, int a4)
{
  int v6; // eax
  int i; // edx
  int v8; // eax
  char *v9; // edi

  v6 = 0;
  for ( i = 0; v6 < a1->numControls && a2 != *(_WORD *)((char *)a1->controls + i); i += 0xE )
  {
    ++v6;
  }
  if ( v6 >= a1->numControls )
  {
    return 0;
  }
  v8 = 0xE * v6;
  if ( a4 )
  {
    v9 = (char *)a1->controls + v8;
    qmemcpy(v9, (const void *)a4, 0xCu);
    qmemcpy(v9 + 0xC, (const void *)(a4 + 0xC), 2u);
  }
  else
  {
    *(_WORD *)((char *)a1->controls + v8 + 0xA) = a3;
  }
  return 0xFFFFFFFF;
}

//----- (0002DB54) --------------------------------------------------------
int __fastcall sub_2DB54(int result, __int16 a2, __int16 a3)
{
  int v4; // edi
  int v5; // ebp
  int v6; // ecx
  int v7; // ebx
  __int16 v8; // dx
  int v9; // edx

  v4 = *(_DWORD *)(result + 0xC);
  v5 = *(_DWORD *)(result + 0x14);
  v6 = a2 + *(_DWORD *)(result + 0x10);
  *(_DWORD *)(result + 8) += a2;
  *(_DWORD *)(result + 0x10) = v6;
  v7 = 0;
  *(_DWORD *)(result + 0xC) = a3 + v4;
  v8 = *(_WORD *)(result + 0xAF);
  *(_DWORD *)(result + 0x14) = a3 + v5;
  if ( v8 > 0 )
  {
    do
    {
      v9 = 0xE * (__int16)v7;
      *(_WORD *)(*(_DWORD *)(result + 0xAB) + v9 + 2) += a2;
      *(_WORD *)(*(_DWORD *)(result + 0xAB) + v9 + 4) += a2;
      *(_WORD *)(*(_DWORD *)(result + 0xAB) + v9 + 6) += a3;
      *(_WORD *)(*(_DWORD *)(result + 0xAB) + v9 + 8) += a3;
      ++v7;
    }
    while ( (__int16)v7 < *(__int16 *)(result + 0xAF) );
  }
  return result;
}

//----- (0002DBE4) --------------------------------------------------------
int __fastcall sub_2DBE4(int a1, int a2, int a3)
{
  int v4; // ecx
  int v5; // eax
  __int16 *v6; // eax
  int v7; // edx
  __int16 *v8; // eax

  v4 = a2;
  v5 = *(__int16 *)(a1 + 0xB1);
  if ( v5 != 0xFFFFFFFF )
  {
    v6 = (__int16 *)(0xE * v5 + *(_DWORD *)(a1 + 0xAB));
    if ( a2 <= v6[2] && a2 >= v6[1] && a3 <= v6[4] && a3 >= v6[3] )
    {
      LOWORD(a2) = *(_WORD *)(a1 + 0xB1);
      return a2;
    }
  }
  v7 = 0;
  if ( *(__int16 *)(a1 + 0xAF) <= 0 )
  {
    return 0xFFFFFFFF;
  }
  while ( 1 )
  {
    v8 = (__int16 *)(*(_DWORD *)(a1 + 0xAB) + 0xE * (__int16)v7);
    if ( v4 <= v8[2] && v4 >= v8[1] && a3 <= v8[4] && a3 >= v8[3] )
    {
      break;
    }
    if ( (__int16)++v7 >= *(__int16 *)(a1 + 0xAF) )
    {
      return 0xFFFFFFFF;
    }
  }
  return v7;
}

//----- (0002DCA0) --------------------------------------------------------
int __fastcall sub_2DCA0(int result, __int16 a2)
{
  int v2; // ecx
  int v4; // edx

  v2 = result;
  if ( a2 != *(_WORD *)(result + 0xB1) )
  {
    if ( a2 >= *(__int16 *)(result + 0xAF) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x396);
    }
    v4 = *(__int16 *)(result + 0xB1);
    if ( v4 != 0xFFFFFFFF )
    {
      result = 7 * v4;
      *(_BYTE *)(*(_DWORD *)(v2 + 0xAB) + 0xE * v4 + 0xA) &= ~2u;
    }
    if ( a2 != 0xFFFFFFFF )
    {
      result = *(_DWORD *)(v2 + 0xAB) + 0xE * a2;
      if ( (*(_WORD *)(result + 0xA) & 1) != 0 )
      {
        *(_BYTE *)(result + 0xA) |= 2u;
      }
    }
    *(_WORD *)(v2 + 0xB1) = a2;
  }
  return result;
}

//----- (0002DD2C) --------------------------------------------------------
int __fastcall Q_NC_sub_2DD2C(int a1, __int16 a2, __int16 a3)
{
  int v4; // esi
  int v5; // edx
  int result; // eax
  __int16 v7; // di

  v4 = *(_DWORD *)(a1 + 0xAB);
  v5 = v4 + 0xE * a2;
  result = 7 * a3;
  v7 = *(_WORD *)(v5 + 0xC);
  *(_WORD *)(v5 + 0xC) = *(_WORD *)(v4 + 0xE * a3 + 0xC);
  *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0xE * a3 + 0xC) = v7;
  return result;
}

//----- (0002DD70) --------------------------------------------------------
int __fastcall sub_2DD70(int a1)
{
  int result; // eax

  for ( result = 0; (__int16)result < V_Game.racesNum; ++result )
  {
    *(_WORD *)(0xE * (__int16)result + *(_DWORD *)(a1 + 0xAB) + 0xC) = 5 * V_Game.races[(__int16)result].Unknown_02
                                                                     + 0x14;
  }
  return result;
}

//----- (0002DDB8) --------------------------------------------------------
unsigned int __fastcall sub_2DDB8(int a1, __int16 a2)
{
  int v2; // eax

  if ( a2 >= *(__int16 *)(a1 + 0xAF) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x3CD);
  }
  if ( a2 == 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x3CE);
  }
  v2 = 0xE * a2 + *(_DWORD *)(a1 + 0xAB);
  if ( (*(_WORD *)(v2 + 0xA) & 1) == 0 )
  {
    return 0;
  }
  if ( (*(_WORD *)(v2 + 0xA) & 4) != 0 )
  {
    *(_BYTE *)(v2 + 0xA) &= ~4u;
  }
  else
  {
    *(_BYTE *)(v2 + 0xA) |= 4u;
  }
  return 0xFFFFFFFF;
}

//----- (0002DE68) --------------------------------------------------------
unsigned int __fastcall sub_2DE68(T_TypeA3 *a1, __int16 a2, LONG a3, LONG a4)
{
  unsigned int result; // eax
  __int16 v6; // ax
  __int16 v7; // bx
  int r; // edx
  int v9; // edi
  unsigned int v10; // ebx
  __int16 i; // [esp+6h] [ebp-Ch]

  switch ( a2 )
  {
    case 1:
      sub_2DD70((int)a1);
      sub_2F424((int)a1, a2, a3, a4);
      goto LABEL_3;
    case 4:
    case 5:
      if ( a3 < a1->a2.a1.pane.x0 || a3 > a1->a2.a1.pane.x1 || a4 < a1->a2.a1.pane.y0 || a4 > a1->a2.a1.pane.y1 )
      {
LABEL_3:
        result = 0;
      }
      else
      {
        v7 = sub_2DBE4((int)a1, a3, a4);
        if ( v7 != 0xFFFFFFFF )
        {
          r = (__int16)a1->a2.a1.r;
          if ( r != 0xFFFFFFFF )
          {
            Q_StartSample_sub_4FB90(&V_SoundSystem, r);
          }
          v9 = v7;
          sub_2DCA0((int)a1, v7);
          v10 = sub_2DDB8((int)a1, v7);
          (*(void (__fastcall **)(T_TypeA3 *, _DWORD, unsigned int))(a1->a2.b + 0xC))(a1, 0, v10);
          if ( v10 == 0xFFFFFFFF )
          {
            if ( a1->a2.a1.parentIndex )
            {
              sub_56D30(
                &V_Type3_stru_10AE70,
                a1->a2.a1.parentIndex,
                a1->a2.a1.sendMessage,
                *((__int16 *)a1->controls + 7 * v9),
                0);
            }
          }
        }
        result = 0xFFFFFFFF;
      }
      break;
    case 6:
      sub_567BC(&V_Type3_stru_10AE70, a1->a2.a1.index, 0xFFFFFFFF);
      result = 0xFFFFFFFF;
      break;
    case 7:
      sub_56728((int)&V_Type3_stru_10AE70, a1->a2.a1.index, 4, 8, 0, 0);
      result = 0xFFFFFFFF;
      break;
    case 8:
      v6 = sub_2DBE4((int)a1, a3, a4);
      if ( v6 != a1->e )
      {
        sub_2DCA0((int)a1, v6);
        (*(void (**)(void))(a1->a2.b + 0xC))();
      }
      result = 0xFFFFFFFF;
      break;
    case 9:
      if ( a3 == 0xFFFFFFFF )
      {
        for ( i = 0; i < a1->numControls; ++i )
        {
          sub_2DAC8(a1, 1 << i, a4, 0);
        }
      }
      else
      {
        sub_2DAC8(a1, a3, a4, 0);
      }
      result = 0xFFFFFFFF;
      break;
    default:
      result = sub_2F424((int)a1, a2, a3, a4);
      break;
  }
  return result;
}

//----- (0002E084) --------------------------------------------------------
void __usercall sub_2E084(int a1@<eax>, __int16 a2@<si>)
{
  void *ShapeTable_sub_1B084; // eax
  __int16 *v4; // ecx
  void *v5; // eax
  LONG v6; // [esp-Ch] [ebp-18h]
  LONG v7; // [esp-Ch] [ebp-18h]
  LONG v8; // [esp-8h] [ebp-14h]
  LONG v9; // [esp-4h] [ebp-10h]
  __int16 i; // [esp+8h] [ebp-4h]
  __int16 savedregs_4; // [esp+10h] [ebp+4h]

  v6 = *(__int16 *)(a1 + 0x1E);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           *(unsigned __int16 *)(a1 + 0x18));
  VFX_shape_draw((PANE *)(a1 + 4), ShapeTable_sub_1B084, v6, 0, 0);
  for ( i = 0; i < *(__int16 *)(a1 + 0xAF); ++i )
  {
    v4 = (__int16 *)(0xE * savedregs_4 + *(_DWORD *)(a1 + 0xAB));
    switch ( v4[5] )
    {
      case 0:
        a2 = 4;
        break;
      case 1:
        a2 = 0;
        break;
      case 3:
        a2 = 1;
        break;
      case 5:
        a2 = 2;
        break;
      case 7:
        a2 = 3;
        break;
      default:
        Q_AssertLogBreakExit_sub_261A8(0, "..\\gwindow.cpp", 0x48A);
        break;
    }
    v9 = v4[3] - *(_DWORD *)(a1 + 0xC);
    v8 = v4[1] - *(_DWORD *)(a1 + 8);
    v7 = v4[6] + a2;
    v5 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, *(unsigned __int16 *)(a1 + 0x18));
    VFX_shape_draw((PANE *)(a1 + 4), v5, v7, v8, v9);
  }
  sub_55274(
    &V_Type3_stru_10AE70,
    *(_DWORD *)(a1 + 8),
    *(_DWORD *)(a1 + 0xC),
    *(_DWORD *)(a1 + 0x10),
    *(_DWORD *)(a1 + 0x14));
}
// 2E0DC: variable 'savedregs_4' is possibly undefined

//----- (0002E1B4) --------------------------------------------------------
int __fastcall sub_2E1B4(int a1, unsigned int count, int a3)
{
  if ( a3 == 0xFFFFFFFF )
  {
    return Q_ReadFile_sub_1BF94((P_FileInfo)count, *(void **)(a1 + 0xAB), 0xE * *(__int16 *)(a1 + 0xAF));
  }
  else
  {
    return Q_CFILE_CPP_dos_write_sub_1C098((int *)count, *(void **)(a1 + 0xAB), 0xE * *(__int16 *)(a1 + 0xAF));
  }
}

//----- (0002E208) --------------------------------------------------------
int __fastcall sub_2E208(_DWORD *a1, const char *a2, int a3, int a4)
{
  __int16 v4; // bx

  v4 = 0xF2;
  if ( a4 == 0xFFFFFFFF )
  {
    v4 = 0x96;
  }
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = *a1;
  V_Type3_stru_10AE70.rect.x1 = a1[1];
  V_Type3_stru_10AE70.rect.y1 = a1[2];
  V_Type3_stru_10AE70.rect.x2 = a1[3];
  V_Type3_stru_10AE70.rect.y2 = a1[4];
  return sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 1, 1, a2, 0, 0xFFFFFFFF, v4, 0);
}

//----- (0002E248) --------------------------------------------------------
T_TypeA2 *__fastcall sub_2E248(T_TypeA2 *a1)
{
  Q_A2_sub_2C830(a1);
  a1->b = (int)off_95DD8;
  sub_2E2B8((int)a1);
  return a1;
}
// 95DD8: using guessed type int (*off_95DD8[5])();

//----- (0002E264) --------------------------------------------------------
int __fastcall sub_2E264(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95D40);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95DD8;
    sub_2ED4C(a1);
    sub_2F2B4(a1);
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95DD8: using guessed type int (*off_95DD8[5])();

//----- (0002E2B8) --------------------------------------------------------
int __fastcall sub_2E2B8(int a1)
{
  __int16 v2; // ax

  Q_A1_sub_2C8E4((P_TypeA1)a1);
  *(_DWORD *)(a1 + 0xAB) = 0;
  *(_DWORD *)(a1 + 0xAF) = 0;
  *(_DWORD *)(a1 + 0xB3) = 0;
  *(_DWORD *)(a1 + 0xB7) = 0;
  *(_DWORD *)(a1 + 0xBB) = 0;
  *(_BYTE *)(a1 + 0xC4) = 0x31;
  *(_BYTE *)(a1 + 0xC5) = 0xF2;
  *(_BYTE *)(a1 + 0xC6) = 0;
  memset((void *)(a1 + 0xC7), 0, 0x800u);
  *(_WORD *)(a1 + 0x8C7) = 0;
  v2 = sub_2B594((int *)&V_Type3_stru_10AE70.z1cc[4]);
  *(_WORD *)(a1 + 0x8CB) = 0;
  *(_WORD *)(a1 + 0x8CD) = 0;
  *(_WORD *)(a1 + 0x8CF) = 0xFFFF;
  *(_BYTE *)(a1 + 0x8E5) = 0;
  *(_DWORD *)(a1 + 0x8E6) = 0;
  *(_DWORD *)(a1 + 0x8EA) = 0;
  *(_DWORD *)(a1 + 0x8EE) = 0;
  *(_DWORD *)(a1 + 0x8F2) = 0;
  *(_WORD *)(a1 + 0x8C9) = v2 + 3;
  *(_DWORD *)(a1 + 0x8F6) = 0;
  sub_2F1C8(a1, (int)sub_2E208);
  *(_WORD *)(a1 + 0x18) = word_FFEE8;
  return sub_2E9CC(a1, 1);
}
// FFEE8: using guessed type __int16 word_FFEE8;

//----- (0002E3BC) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_2E3BC(P_TypeA1 a1)
{
  a1->index = Q_WINMGR_CPP_RegisterWindow_sub_571B8(&V_Type3_stru_10AE70, a1);
}

//----- (0002E3D4) --------------------------------------------------------
unsigned int __fastcall sub_2E3D4(int a1, __int16 a2, signed int a3, signed int a4)
{
  int v7; // ebx
  int v8; // eax
  int v9; // edx
  __int16 v10; // ax
  int v11; // eax
  int v12; // edx
  unsigned __int16 v13; // dx
  int v14; // ebx

  if ( (unsigned __int16)a2 < 8u )
  {
    if ( (unsigned __int16)a2 < 4u )
    {
      if ( a2 == 1 )
      {
        sub_2E9CC(a1, *(_BYTE *)(a1 + 0xC3));
        return sub_2F424(a1, 1, a3, a4);
      }
      return sub_2F424(a1, a2, a3, a4);
    }
    if ( (unsigned __int16)a2 > 5u )
    {
      if ( (unsigned __int16)a2 <= 6u )
      {
        sub_567BC(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0xFFFFFFFF);
        sub_564C0(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0xFFFFFFFF);
        *(_WORD *)(a1 + 0x8CF) = 0xFFFF;
        v7 = *(_DWORD *)(a1 + 0xA7);
        *(_BYTE *)(a1 + 0x8E5) = 0;
        (*(void (__fastcall **)(int, _DWORD))(v7 + 0xC))(a1, 0);
      }
      else
      {
        sub_56728((int)&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 4, 8, 0, 0);
        sub_2EDC8(a1, V_Mouse.x, V_Mouse.y);
      }
      return 0xFFFFFFFF;
    }
LABEL_11:
    if ( a3 < *(_DWORD *)(a1 + 8)
      || a3 > *(_DWORD *)(a1 + 0x10)
      || a4 < *(_DWORD *)(a1 + 0xC)
      || a4 > *(_DWORD *)(a1 + 0x14) )
    {
      return 0;
    }
    if ( a2 == 0xC && *(_BYTE *)(a1 + 0x4F) != 0x30 )
    {
      return sub_2F424(a1, 0xC, a3, a4);
    }
    sub_2F090(a1, a3, a4, a2);
    return 0xFFFFFFFF;
  }
  if ( (unsigned __int16)a2 <= 8u )
  {
    sub_2EDC8(a1, a3, a4);
    return 0xFFFFFFFF;
  }
  if ( (unsigned __int16)a2 < 0x191u )
  {
    if ( a2 != 0xC )
    {
      return sub_2F424(a1, a2, a3, a4);
    }
    goto LABEL_11;
  }
  if ( (unsigned __int16)a2 <= 0x191u )
  {
    v8 = sub_56528((int)&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), a2);
    if ( v8 != 0xFFFF )
    {
      v9 = 2 * v8 / 3 - 1;
      if ( v9 < 0 )
      {
        v9 = 0;
      }
      sub_56564((int)&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), a2, v9);
    }
    v10 = *(_WORD *)(a1 + 0x8CD);
    if ( v10 )
    {
      *(_WORD *)(a1 + 0x8CD) = v10 - 1;
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    }
    return 0xFFFFFFFF;
  }
  else
  {
    if ( (unsigned __int16)a2 > 0x192u )
    {
      if ( a2 == 0x193 )
      {
        sub_567BC(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0x193);
        sub_564C0(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0xFFFFFFFF);
        return 0xFFFFFFFF;
      }
      return sub_2F424(a1, a2, a3, a4);
    }
    v11 = sub_56528((int)&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), a2);
    if ( v11 != 0xFFFF )
    {
      v12 = 2 * v11 / 3 - 1;
      if ( v12 < 0 )
      {
        v12 = 0;
      }
      sub_56564((int)&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), a2, v12);
    }
    v13 = *(_WORD *)(a1 + 0x8CD);
    if ( v13 < *(unsigned __int16 *)(a1 + 0x8C7)
             - (*(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC)) / *(unsigned __int16 *)(a1 + 0x8C9) )
    {
      v14 = *(_DWORD *)(a1 + 0xA7);
      *(_WORD *)(a1 + 0x8CD) = v13 + 1;
      (*(void (__fastcall **)(int, _DWORD))(v14 + 0xC))(a1, 0);
    }
    return 0xFFFFFFFF;
  }
}

//----- (0002E6C0) --------------------------------------------------------
void __fastcall sub_2E6C0(int a1)
{
  LONG v2; // edi
  __int16 v3; // di
  unsigned int v4; // ebp
  unsigned __int16 v5; // ax
  int v6; // ecx
  _DWORD *v7; // ebx
  int v8[2]; // [esp+0h] [ebp-30h] BYREF
  int v9; // [esp+8h] [ebp-28h]
  int v10; // [esp+Ch] [ebp-24h]
  int v11; // [esp+10h] [ebp-20h]
  LONG x1; // [esp+14h] [ebp-1Ch]
  int v13; // [esp+18h] [ebp-18h]

  VFX_pane_wipe((PANE *)(a1 + 4), *(unsigned __int8 *)(a1 + 0xC5));
  x1 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8);
  v2 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
  VFX_line_draw((PANE *)(a1 + 4), 0, 0, x1, 0, 0, *(unsigned __int8 *)(a1 + 0xC4));
  VFX_line_draw((PANE *)(a1 + 4), 0, 0, 0, v2, 0, *(unsigned __int8 *)(a1 + 0xC4));
  VFX_line_draw((PANE *)(a1 + 4), x1, v2, x1, 0, 0, *(unsigned __int8 *)(a1 + 0xC4));
  VFX_line_draw((PANE *)(a1 + 4), x1, v2, 0, v2, 0, *(unsigned __int8 *)(a1 + 0xC4));
  if ( *(_DWORD *)(a1 + 0xB3) == 0xFFFFFFFF )
  {
    sub_2E868(a1, 0);
  }
  v8[1] = *(_DWORD *)(a1 + 8) + 1;
  v9 = *(_DWORD *)(a1 + 0xC) + 1;
  v8[0] = *(_DWORD *)(a1 + 4);
  v10 = *(_DWORD *)(a1 + 0x10) - 1;
  if ( *(_DWORD *)(a1 + 0xB3) == 0xFFFFFFFF )
  {
    v10 -= *(_DWORD *)(a1 + 0xBF);
  }
  v3 = *(_WORD *)(a1 + 0x8CD);
  v4 = 0;
  v13 = a1 + 0xC7;
  while ( v3 < (int)*(unsigned __int16 *)(a1 + 0x8C7) && !v4 )
  {
    v7 = (_DWORD *)(8 * v3 + v13);
    if ( *(_DWORD *)(a1 + 0x8F6) )
    {
      v5 = (*(int (__fastcall **)(_DWORD, _DWORD))(a1 + 0x8F6))(*v7, v7[1]);
    }
    else
    {
      v5 = *(_WORD *)(a1 + 0x8C9);
    }
    v11 = v9 + v5 - 1;
    v6 = *(_DWORD *)(a1 + 0x14);
    if ( v11 >= v6 )
    {
      v4 = 0xFFFFFFFF;
      v11 = v6 - 1;
    }
    (*(void (__fastcall **)(int *, _DWORD, _DWORD, int))(a1 + 0x8FA))(
      v8,
      *v7,
      v7[1],
      (v3++ != *(_WORD *)(a1 + 0x8CF)) - 1);
    v9 = v11 + 1;
  }
  sub_552CC(&V_Type3_stru_10AE70, (PANE *)(a1 + 4));
}

//----- (0002E868) --------------------------------------------------------
void __fastcall sub_2E868(int a1, int a2)
{
  int v3; // edi
  int v4; // edx
  int v5; // ebx
  LONG v6; // edi
  int v7; // edx
  void *ShapeTable_sub_1B084; // eax
  void *v9; // eax
  LONG v10; // [esp-Ch] [ebp-34h]
  LONG v11; // [esp-Ch] [ebp-34h]
  LONG v12; // [esp-8h] [ebp-30h]
  LONG v13; // [esp-4h] [ebp-2Ch]
  LONG v14; // [esp-4h] [ebp-2Ch]
  PANE v15; // [esp+0h] [ebp-28h] BYREF
  LONG hotX; // [esp+14h] [ebp-14h]
  PANE *pane; // [esp+18h] [ebp-10h]
  int v18; // [esp+1Ch] [ebp-Ch]
  LONG v19; // [esp+20h] [ebp-8h]
  LONG y1; // [esp+24h] [ebp-4h]

  v18 = a2;
  v3 = *(_DWORD *)(a1 + 0x10);
  v4 = *(_DWORD *)(a1 + 8);
  v5 = *(_DWORD *)(a1 + 0xBF);
  y1 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
  v6 = v3 - v4 - v5;
  VFX_line_draw((PANE *)(a1 + 4), v6, 0, v6, y1, 0, *(unsigned __int8 *)(a1 + 0xC4));
  v7 = *(_DWORD *)(a1 + 0xC) + (*(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC)) / 2;
  v15.window = *(WINDOW **)(a1 + 4);
  v15.x0 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 0xBF) + 1;
  v15.x1 = *(_DWORD *)(a1 + 0x10) - 1;
  v15.y0 = *(_DWORD *)(a1 + 0xC) + 1;
  v15.y1 = *(_DWORD *)(a1 + 0x14) - 1;
  v13 = *(unsigned __int8 *)(a1 + 0xC6);
  v19 = v7;
  VFX_pane_wipe(&v15, v13);
  if ( *(unsigned __int8 *)(a1 + 0x8E5) > 1u )
  {
    if ( *(_BYTE *)(a1 + 0x8E5) == 2 )
    {
      v15.y1 = v19;
    }
    else
    {
      v15.y0 = v19;
    }
    VFX_pane_wipe(&v15, 0x96);
  }
  hotX = v6 + 2;
  v10 = *(__int16 *)(a1 + 0x1E);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           *(unsigned __int16 *)(a1 + 0x18));
  pane = (PANE *)(a1 + 4);
  VFX_shape_draw((PANE *)(a1 + 4), ShapeTable_sub_1B084, v10, v6 + 2, 2);
  v14 = y1 - *(_DWORD *)(a1 + 0xBF) + 2;
  v12 = hotX;
  v11 = *(__int16 *)(a1 + 0x1E) + 1;
  v9 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, *(unsigned __int16 *)(a1 + 0x18));
  VFX_shape_draw(pane, v9, v11, v12, v14);
  if ( v18 == 0xFFFFFFFF )
  {
    sub_55274(
      &V_Type3_stru_10AE70,
      v6 + *(_DWORD *)(a1 + 8),
      *(_DWORD *)(a1 + 0xC),
      *(_DWORD *)(a1 + 0x10),
      *(_DWORD *)(a1 + 0x14));
  }
}

//----- (0002E9CC) --------------------------------------------------------
int __fastcall sub_2E9CC(int a1, char a2)
{
  LONG v3; // eax
  void *ShapeTable_sub_1B084; // eax
  unsigned int v5; // eax
  unsigned int v6; // edx
  int v7; // eax
  int v8; // eax
  int result; // eax
  int v10; // ecx
  LONG v11; // [esp-4h] [ebp-10h]

  if ( a2 == 1 )
  {
    *(_WORD *)(a1 + 0x1E) = 0;
  }
  else
  {
    *(_WORD *)(a1 + 0x1E) = 2;
  }
  v3 = *(__int16 *)(a1 + 0x1E);
  *(_BYTE *)(a1 + 0xC3) = a2;
  v11 = v3;
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           *(unsigned __int16 *)(a1 + 0x18));
  v5 = VFX_shape_resolution(ShapeTable_sub_1B084, v11);
  *(_DWORD *)(a1 + 0xBF) = v5;
  *(_DWORD *)(a1 + 0x8D1) = *(_DWORD *)(a1 + 4);
  v6 = HIWORD(v5);
  v7 = *(_DWORD *)(a1 + 8);
  *(_DWORD *)(a1 + 0xBF) = v6;
  *(_DWORD *)(a1 + 0x8D5) = v7 + 1;
  v8 = *(_DWORD *)(a1 + 0x10);
  *(_DWORD *)(a1 + 0xBF) = v6 + 3;
  result = v8 - 1;
  v10 = *(_DWORD *)(a1 + 0xB3);
  *(_DWORD *)(a1 + 0x8DD) = result;
  if ( v10 == 0xFFFFFFFF )
  {
    result = *(_DWORD *)(a1 + 0xBF);
    *(_DWORD *)(a1 + 0x8DD) -= result;
  }
  return result;
}

//----- (0002EA8C) --------------------------------------------------------
int __fastcall sub_2EA8C(int a1, const char *a2, __int16 a3, int a4)
{
  __int16 v6; // di
  int v7; // edx
  int v8; // eax
  int v9; // edi
  size_t v10; // kr04_4
  void *v11; // eax
  int v12; // ecx
  char *v14; // edi
  char v15; // al
  char v16; // al
  int v17; // eax
  const char *v19; // [esp+4h] [ebp-10h]

  v6 = a3;
  if ( *(unsigned __int16 *)(a1 + 0x8C7) >= 0x100u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x62A);
  }
  if ( a3 == 0xFFFFFFFF )
  {
    v6 = *(_WORD *)(a1 + 0x8C9);
  }
  *(_WORD *)(a1 + 0x8CB) += v6;
  v7 = *(unsigned __int16 *)(a1 + 0x8CB);
  if ( (unsigned __int16)v7 > *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC) - 1 )
  {
    if ( *(_DWORD *)(a1 + 0xB7) == 0xFFFFFFFF )
    {
      *(_DWORD *)(a1 + 0x14) = *(_DWORD *)(a1 + 0xC) + v7 + 2;
    }
    else if ( !*(_DWORD *)(a1 + 0xB3) )
    {
      v8 = *(_DWORD *)(a1 + 0xBF);
      v9 = *(_DWORD *)(a1 + 0x8DD);
      *(_DWORD *)(a1 + 0xB3) = 0xFFFFFFFF;
      *(_DWORD *)(a1 + 0x8DD) = v9 - v8;
    }
  }
  if ( *(_DWORD *)(a1 + 0xAB) == 0xFFFFFFFF )
  {
    v10 = strlen(a2) + 1;
    if ( *(_DWORD *)(a1 + 0x8E6) )
    {
      v12 = *(_DWORD *)(a1 + 0x8EE);
      if ( *(_DWORD *)(a1 + 0x8F2) - v12 < v10 )
      {
        Q_AssertLogBreakExit_sub_261A8(0, "..\\gwindow.cpp", 0x653);
        return 0xFFFFFFFF;
      }
      v19 = (const char *)(*(_DWORD *)(a1 + 0x8EA) + v12);
      *(_DWORD *)(a1 + 0x8EE) += v10;
    }
    else
    {
      v11 = operator new[](v10);
      Q_RegisterData_sub_2625C(v11, 1, "LISTBOX STRING");
      v19 = (const char *)v11;
      if ( !v11 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x648);
      }
    }
    v14 = (char *)v19;
    do
    {
      v15 = *a2;
      *v14 = *a2;
      if ( !v15 )
      {
        break;
      }
      v16 = a2[1];
      a2 += 2;
      v14[1] = v16;
      v14 += 2;
    }
    while ( v16 );
    a2 = v19;
  }
  *(_DWORD *)(a1 + 8 * *(unsigned __int16 *)(a1 + 0x8C7) + 0xC7) = a2;
  *(_DWORD *)(a1 + 8 * *(unsigned __int16 *)(a1 + 0x8C7) + 0xCB) = 0;
  HIWORD(v17) = HIWORD(a4);
  ++*(_WORD *)(a1 + 0x8C7);
  if ( a4 == 0xFFFFFFFF )
  {
    v17 = (*(int (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
  }
  LOWORD(v17) = *(_WORD *)(a1 + 0x8C7);
  return v17 - 1;
}

//----- (0002EC50) --------------------------------------------------------
unsigned int __fastcall sub_2EC50(int a1, unsigned __int16 a2, int a3)
{
  int v3; // esi
  unsigned int result; // eax

  if ( a2 >= 0x100u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x66B);
  }
  v3 = 8 * a2 + a1;
  if ( !*(_DWORD *)(v3 + 0xC7) )
  {
    return 0;
  }
  result = 0xFFFFFFFF;
  *(_DWORD *)(v3 + 0xCB) = a3;
  return result;
}

//----- (0002ECA4) --------------------------------------------------------
int __fastcall sub_2ECA4(int a1, unsigned __int16 a2)
{
  if ( a2 >= 0x100u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x679);
  }
  return *(_DWORD *)(a1 + 8 * a2 + 0xCB);
}

//----- (0002ECDC) --------------------------------------------------------
int __fastcall sub_2ECDC(int result, unsigned __int16 a2)
{
  if ( *(unsigned __int16 *)(result + 0x8CB) > *(_DWORD *)(result + 0x14) - *(_DWORD *)(result + 0xC) - 1
    && a2 < *(_WORD *)(result + 0x8C7) )
  {
    *(_WORD *)(result + 0x8CF) = 0xFFFF;
    *(_WORD *)(result + 0x8CD) = a2;
  }
  return result;
}

//----- (0002ED14) --------------------------------------------------------
int __fastcall sub_2ED14(int a1, unsigned __int16 a2)
{
  if ( a2 >= 0x100u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x68D);
  }
  return *(_DWORD *)(a1 + 8 * a2 + 0xC7);
}

//----- (0002ED4C) --------------------------------------------------------
int __fastcall sub_2ED4C(int a1)
{
  int v1; // ecx
  int i; // edx
  int v3; // eax
  int result; // eax
  int v5; // edx

  v1 = a1;
  *(_DWORD *)(a1 + 0x8EE) = 0;
  for ( i = 0; i < *(unsigned __int16 *)(v1 + 0x8C7); ++i )
  {
    if ( *(_DWORD *)(a1 + 0xC7) )
    {
      *(_DWORD *)(a1 + 0xC7) = 0;
    }
    a1 += 8;
  }
  *(_WORD *)(v1 + 0x8C7) = 0;
  *(_WORD *)(v1 + 0x8CB) = 0;
  *(_WORD *)(v1 + 0x8CF) = 0xFFFF;
  v3 = *(_DWORD *)(v1 + 0x10);
  *(_WORD *)(v1 + 0x8CD) = 0;
  result = v3 - 1;
  v5 = *(_DWORD *)(v1 + 0xAF);
  *(_DWORD *)(v1 + 0x8DD) = result;
  if ( !v5 )
  {
    *(_DWORD *)(v1 + 0xB3) = 0;
  }
  return result;
}

//----- (0002EDC8) --------------------------------------------------------
void __fastcall sub_2EDC8(int a1, unsigned int a2, unsigned int a3)
{
  unsigned int v5; // eax
  unsigned __int16 v6; // di
  unsigned __int16 v7; // dx
  unsigned int v8; // ebx
  unsigned __int16 v9; // cx
  int v10; // eax
  int v11; // edx
  unsigned int v12; // edx
  unsigned int v13; // eax
  char v14; // al
  int v15; // edx
  int v16; // eax
  LONG v17; // [esp-4h] [ebp-18h]

  if ( *(__int16 *)(a1 + 0x8CF) != 0xFFFFFFFF )
  {
    if ( a3 >= *(_DWORD *)(a1 + 0x8D9) && a3 <= *(_DWORD *)(a1 + 0x8E1) && a2 <= *(_DWORD *)(a1 + 0x8DD) )
    {
      if ( *(_DWORD *)(a1 + 0xBB) == 0xFFFFFFFF )
      {
        VFX_pane_wipe((PANE *)(a1 + 0x8D1), *(unsigned __int8 *)(a1 + 0xC5));
        (*(void (__fastcall **)(int, _DWORD, _DWORD, unsigned int))(a1 + 0x8FA))(
          a1 + 0x8D1,
          *(_DWORD *)(a1 + 8 * *(__int16 *)(a1 + 0x8CF) + 0xC7),
          *(_DWORD *)(a1 + 8 * *(__int16 *)(a1 + 0x8CF) + 0xCB),
          0xFFFFFFFF);
        sub_552CC(&V_Type3_stru_10AE70, (PANE *)(a1 + 0x8D1));
      }
      return;
    }
    VFX_pane_wipe((PANE *)(a1 + 0x8D1), *(unsigned __int8 *)(a1 + 0xC5));
    (*(void (__fastcall **)(int, _DWORD, _DWORD, _DWORD))(a1 + 0x8FA))(
      a1 + 0x8D1,
      *(_DWORD *)(a1 + 8 * *(__int16 *)(a1 + 0x8CF) + 0xC7),
      *(_DWORD *)(a1 + 8 * *(__int16 *)(a1 + 0x8CF) + 0xCB),
      0);
    sub_552CC(&V_Type3_stru_10AE70, (PANE *)(a1 + 0x8D1));
    *(_WORD *)(a1 + 0x8CF) = 0xFFFF;
  }
  v5 = *(_DWORD *)(a1 + 0x10);
  if ( *(_DWORD *)(a1 + 0xB3) == 0xFFFFFFFF )
  {
    v5 -= *(_DWORD *)(a1 + 0xBF);
  }
  if ( v5 <= a2 )
  {
    if ( *(_DWORD *)(a1 + 0xB3) != 0xFFFFFFFF )
    {
      return;
    }
    v12 = *(_DWORD *)(a1 + 0xC) + (*(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC)) / 2;
    v13 = *(unsigned __int8 *)(a1 + 0x8E5);
    if ( v13 > 1 )
    {
      if ( a3 <= v12 )
      {
        if ( v13 == 2 )
        {
          return;
        }
        v15 = *(_DWORD *)(a1 + 0xB3);
        v16 = a1;
        *(_BYTE *)(a1 + 0x8E5) = 2;
      }
      else
      {
        if ( v13 == 3 )
        {
          return;
        }
        v15 = *(_DWORD *)(a1 + 0xB3);
        v16 = a1;
        *(_BYTE *)(a1 + 0x8E5) = 3;
      }
    }
    else
    {
      v14 = (a3 > v12) + 2;
      v15 = *(_DWORD *)(a1 + 0xB3);
      *(_BYTE *)(a1 + 0x8E5) = v14;
      v16 = a1;
    }
    sub_2E868(v16, v15);
  }
  else
  {
    if ( *(unsigned __int8 *)(a1 + 0x8E5) > 1u )
    {
      *(_BYTE *)(a1 + 0x8E5) = 1;
      sub_2E868(a1, 0xFFFFFFFF);
      sub_567BC(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0x193);
      sub_564C0(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0xFFFFFFFF);
    }
    v6 = *(_WORD *)(a1 + 0x8CD);
    v7 = *(_WORD *)(a1 + 0x8C7);
    v8 = 0;
    *(_DWORD *)(a1 + 0x8D9) = *(_DWORD *)(a1 + 0xC) + 1;
    if ( v6 < v7 )
    {
      while ( !v8 )
      {
        v8 = 0;
        v10 = *(_DWORD *)(a1 + 0x8F6);
        if ( v10 )
        {
          v10 = (*(unsigned __int16 (__fastcall **)(_DWORD, _DWORD, _DWORD))(a1 + 0x8F6))(
                  *(_DWORD *)(a1 + 8 * v6 + 0xC7),
                  *(_DWORD *)(a1 + 8 * v6 + 0xCB),
                  0);
        }
        else
        {
          LOWORD(v10) = *(_WORD *)(a1 + 0x8C9);
        }
        *(_DWORD *)(a1 + 0x8E1) = *(_DWORD *)(a1 + 0x8D9) + v10 - 1;
        v11 = *(_DWORD *)(a1 + 0x14);
        if ( *(_DWORD *)(a1 + 0x8E1) >= v11 )
        {
          v8 = 0xFFFFFFFF;
          *(_DWORD *)(a1 + 0x8E1) = v11 - 1;
        }
        if ( a3 >= *(_DWORD *)(a1 + 0x8D9) && a3 <= *(_DWORD *)(a1 + 0x8E1) )
        {
          v17 = *(unsigned __int8 *)(a1 + 0xC5);
          *(_WORD *)(a1 + 0x8CF) = v6;
          VFX_pane_wipe((PANE *)(a1 + 0x8D1), v17);
          (*(void (__fastcall **)(int, _DWORD, _DWORD, unsigned int))(a1 + 0x8FA))(
            a1 + 0x8D1,
            *(_DWORD *)(a1 + 8 * v6 + 0xC7),
            *(_DWORD *)(a1 + 8 * v6 + 0xCB),
            0xFFFFFFFF);
          sub_552CC(&V_Type3_stru_10AE70, (PANE *)(a1 + 0x8D1));
          return;
        }
        ++v6;
        v9 = *(_WORD *)(a1 + 0x8C7);
        *(_DWORD *)(a1 + 0x8D9) = *(_DWORD *)(a1 + 0x8E1) + 1;
        if ( v6 >= v9 )
        {
          return;
        }
      }
    }
  }
}

//----- (0002F090) --------------------------------------------------------
void __fastcall sub_2F090(int a1, unsigned int a2, unsigned int a3, __int16 a4)
{
  int v6; // ecx
  int v7; // edx
  int v8; // ebx

  if ( *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 0xBF) <= a2 )
  {
    if ( *(_DWORD *)(a1 + 0xB3) == 0xFFFFFFFF )
    {
      if ( *(_DWORD *)(a1 + 0xC) + (*(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC)) / 2 <= a3 )
      {
        (*(void (__fastcall **)(int, int, _DWORD, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 8))(a1, 0x192, 0, 0);
        sub_56400(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0x192, 0, 0, 0x1E);
      }
      else
      {
        (*(void (__fastcall **)(int, int, _DWORD, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 8))(a1, 0x191, 0, 0);
        sub_56400(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0x191, 0, 0, 0x1E);
      }
      v8 = 1;
      if ( a4 == 5 )
      {
        v8 = 2;
      }
      sub_56728((int)&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), v8, 0x193, 0, 0);
    }
  }
  else
  {
    v6 = *(__int16 *)(a1 + 0x8CF);
    if ( v6 != 0xFFFFFFFF )
    {
      if ( V_Type3_stru_10AE70.h )
      {
        sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x63), 0x1C02, v6, a4);
      }
      else
      {
        v7 = *(__int16 *)(a1 + 0x59);
        if ( v7 != 0xFFFFFFFF )
        {
          Q_StartSample_sub_4FB90(&V_SoundSystem, v7);
        }
        sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x63), 0x1C01, *(__int16 *)(a1 + 0x8CF), a4);
      }
      sub_2EDC8(a1, a2, a3);
    }
  }
}

//----- (0002F1C8) --------------------------------------------------------
int __fastcall sub_2F1C8(int result, int a2)
{
  *(_DWORD *)(result + 0x8FA) = a2;
  return result;
}

//----- (0002F1D8) --------------------------------------------------------
int __fastcall sub_2F1D8(int result, int a2)
{
  *(_DWORD *)(result + 0x8FE) = a2;
  return result;
}

//----- (0002F1E0) --------------------------------------------------------
void __fastcall sub_2F1E0(int a1)
{
  if ( !*(_DWORD *)(a1 + 0x8FE) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x7AB);
  }
  qsort(
    (void *)(a1 + 0xC7),
    *(unsigned __int16 *)(a1 + 0x8C7),
    8u,
    *(int (__fastcall **)(const void *, const void *))(a1 + 0x8FE));
}

//----- (0002F228) --------------------------------------------------------
int __fastcall sub_2F228(int a1, size_t a2, int a3)
{
  int result; // eax

  sub_2ED4C(a1);
  if ( *(_DWORD *)(a1 + 0x8EA) )
  {
    sub_262CC(*(void **)(a1 + 0x8EA));
    *(_DWORD *)(a1 + 0x8EA) = 0;
  }
  if ( a3 )
  {
    *(_DWORD *)(a1 + 0x8EA) = a3;
  }
  else
  {
    *(_DWORD *)(a1 + 0x8EA) = Q_Allocate_sub_2628C(a2, 1, "LISTBOX MEMPOOL");
  }
  if ( *(_DWORD *)(a1 + 0x8EA) )
  {
    *(_DWORD *)(a1 + 0x8E6) = 0xFFFFFFFF;
    *(_DWORD *)(a1 + 0x8EE) = 0;
    result = 0xFFFFFFFF;
    *(_DWORD *)(a1 + 0x8F2) = a2;
  }
  else
  {
    *(_DWORD *)(a1 + 0x8E6) = 0;
    *(_DWORD *)(a1 + 0x8F2) = 0;
    result = 0;
    *(_DWORD *)(a1 + 0x8EE) = 0;
  }
  return result;
}

//----- (0002F2B4) --------------------------------------------------------
void __fastcall sub_2F2B4(int a1)
{
  if ( *(_DWORD *)(a1 + 0x8EA) )
  {
    sub_262CC(*(void **)(a1 + 0x8EA));
    *(_DWORD *)(a1 + 0x8EA) = 0;
  }
  *(_DWORD *)(a1 + 0x8F2) = 0;
  *(_DWORD *)(a1 + 0x8EE) = 0;
  *(_DWORD *)(a1 + 0x8E6) = 0;
}

//----- (0002F2F4) --------------------------------------------------------
T_TypeA2 *__fastcall sub_2F2F4(T_TypeA2 *result)
{
  Q_A2_sub_2C830(result);
  result->b = (int)off_95DC0;
  return result;
}
// 95DC0: using guessed type int (*off_95DC0[5])();

//----- (0002F30C) --------------------------------------------------------
int __fastcall sub_2F30C(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95D2C);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95DC0;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95DC0: using guessed type int (*off_95DC0[5])();

//----- (0002F354) --------------------------------------------------------
void __fastcall sub_2F354(int a1)
{
  void *ShapeTable_sub_1B084; // eax
  __int16 v3; // si
  LONG v4; // ecx
  LONG v5; // ebx
  void *v6; // eax
  LONG v7; // [esp-Ch] [ebp-20h]
  __int16 v8; // [esp-4h] [ebp-18h]
  char s[12]; // [esp+0h] [ebp-14h] BYREF
  int v10; // [esp+Ch] [ebp-8h]
  int a2; // [esp+10h] [ebp-4h]
  void *retaddr; // [esp+28h] [ebp+14h]

  v7 = *(_DWORD *)(a1 + 0xAB) + 0xC;
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           *(unsigned __int16 *)(a1 + 0x18));
  v10 = a1 + 4;
  VFX_shape_draw((PANE *)(a1 + 4), ShapeTable_sub_1B084, v7, 0, 0);
  v3 = 0;
  sprintf(s, "%05d", V_Game.day);
  a2 = v10;
  while ( v3 < 5 )
  {
    v4 = 0x1F * v3 + 2;
    v8 = byte_104BEA;
    v5 = *(_DWORD *)(a1 + 0xAB) + *((char *)&retaddr + v3) - 0x30;
    v6 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, *(unsigned __int16 *)(a1 + 0x18));
    ++v3;
    sub_53EB8((PANE *)a2, v6, v5, v4, 0, v8);
  }
  sub_552CC(&V_Type3_stru_10AE70, (PANE *)a2);
}
// 2F354: using guessed type char s[12];

//----- (0002F414) --------------------------------------------------------
int __fastcall sub_2F414(int a1)
{
  return (*(int (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
}

//----- (0002F420) --------------------------------------------------------
unsigned int __fastcall sub_2F420(int a1, __int16 a2, int a3, int a4)
{
  return sub_2F424(a1, a2, a3, a4);
}

//----- (0002F424) --------------------------------------------------------
unsigned int __fastcall sub_2F424(int a1, __int16 a2, int a3, int a4)
{
  int v4; // ebp
  __int16 v5; // cx
  int v6; // ebx
  int v7; // edx
  int v10; // [esp+2h] [ebp-10h]

  if ( (unsigned __int16)a2 < 7u )
  {
    if ( (unsigned __int16)a2 < 2u )
    {
      if ( a2 == 1 )
      {
        *(_DWORD *)(a1 + 0x39) = 0xFFFFFFFF;
        v4 = *(_DWORD *)(a1 + 0xA7);
        *(_DWORD *)(a1 + 0x35) = 0xFFFFFFFF;
        (*(void (**)(void))(v4 + 0xC))();
        sub_2D258(a1, 1);
        return 0;
      }
      return 0;
    }
    if ( (unsigned __int16)a2 <= 2u )
    {
      sub_2D258(a1, a2);
      *(_DWORD *)(a1 + 0x39) = 0;
      *(_DWORD *)(a1 + 0x35) = 0;
      if ( *(_DWORD *)(a1 + 0x41) == *(_DWORD *)V_Type3_stru_10AE70.z1aa )
      {
        *(_DWORD *)V_Type3_stru_10AE70.z1aa = 0xFFFFFFFF;
      }
      sub_567BC(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0xFFFFFFFF);
      sub_564C0(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0xFFFFFFFF);
      return 0;
    }
    else
    {
      if ( (unsigned __int16)a2 < 4u )
      {
        return 0;
      }
      if ( (unsigned __int16)a2 <= 5u )
      {
        if ( a3 < *(_DWORD *)(a1 + 8)
          || a3 > *(_DWORD *)(a1 + 0x10)
          || a4 < *(_DWORD *)(a1 + 0xC)
          || a4 > *(_DWORD *)(a1 + 0x14) )
        {
          return 0;
        }
        v5 = *(_WORD *)(a1 + 0x45);
        v10 = *(_DWORD *)(a1 + 0x47);
        v6 = *(_DWORD *)(a1 + 0x4B);
        if ( v5 == 0x3E7 )
        {
          v5 = a2;
        }
        if ( v10 == 0x3E7 )
        {
          v10 = a2;
        }
        if ( v6 == 0x3E7 )
        {
          v6 = a2;
        }
        v7 = *(__int16 *)(a1 + 0x59);
        if ( v7 != 0xFFFFFFFF )
        {
          Q_StartSample_sub_4FB90(&V_SoundSystem, v7);
        }
        if ( *(_DWORD *)(a1 + 0x63) )
        {
          if ( v5 == 0x3E6 )
          {
            sub_56B60(&V_Type3_stru_10AE70, v10, v6, 0);
            return 0xFFFFFFFF;
          }
          sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x63), v5, v10, v6);
        }
        else
        {
          sub_56B60(&V_Type3_stru_10AE70, v5, v10, v6);
        }
        return 0xFFFFFFFF;
      }
      else
      {
        if ( *(_DWORD *)(a1 + 0x39) && *(_DWORD *)(a1 + 0x35) && *(_DWORD *)(a1 + 0x3D) )
        {
          (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
        }
        return 0xFFFFFFFF;
      }
    }
  }
  else if ( (unsigned __int16)a2 <= 7u )
  {
    if ( *(_DWORD *)(a1 + 0x39) && *(_DWORD *)(a1 + 0x35) && *(_DWORD *)(a1 + 0x3D) )
    {
      (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
    }
    return 0xFFFFFFFF;
  }
  else
  {
    if ( (unsigned __int16)a2 >= 0xEu )
    {
      if ( (unsigned __int16)a2 <= 0xEu )
      {
        *(_DWORD *)(a1 + 0x35) = 0xFFFFFFFF;
        *(_DWORD *)(a1 + 0x39) = 0xFFFFFFFF;
        return 0;
      }
      if ( (unsigned __int16)a2 <= 0xFu )
      {
        *(_DWORD *)(a1 + 0x35) = 0;
        return 0;
      }
      if ( (unsigned __int16)a2 >= 0xC9u )
      {
        if ( (unsigned __int16)a2 > 0xCAu )
        {
          return 0;
        }
        sub_56B60(&V_Type3_stru_10AE70, 6, a2, 0);
        return 0xFFFFFFFF;
      }
      return 0;
    }
    if ( a2 != 0xC )
    {
      return 0;
    }
    if ( a3 < *(_DWORD *)(a1 + 8)
      || a3 > *(_DWORD *)(a1 + 0x10)
      || a4 < *(_DWORD *)(a1 + 0xC)
      || a4 > *(_DWORD *)(a1 + 0x14) )
    {
      return 0;
    }
    if ( *(_BYTE *)(a1 + 0x4F) != 0x30 )
    {
      sub_56B60(&V_Type3_stru_10AE70, 5, a1 + 0x4F, 0);
    }
    return 0xFFFFFFFF;
  }
}

//----- (0002F478) --------------------------------------------------------
unsigned int __fastcall sub_2F478(int a1, __int16 a2, int a3, int a4)
{
  if ( a2 != 0xD )
  {
    return sub_2F420(a1, a2, a3, a4);
  }
  (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
  return 0;
}

//----- (0002F48C) --------------------------------------------------------
T_TypeA2 *__fastcall sub_2F48C(T_TypeA2 *a1)
{
  Q_A2_sub_2C830(a1);
  a1->b = (int)off_95DA8;
  sub_2F4EC((int)a1);
  return a1;
}
// 95DA8: using guessed type int (*off_95DA8[4])();

//----- (0002F4A8) --------------------------------------------------------
int __fastcall sub_2F4A8(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95D18);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95DA8;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95DA8: using guessed type int (*off_95DA8[4])();

//----- (0002F4EC) --------------------------------------------------------
int __fastcall sub_2F4EC(int result)
{
  *(_DWORD *)(result + 0xAB) = 0;
  *(_WORD *)(result + 0xB1) = 0;
  *(_WORD *)(result + 0xAF) = 0;
  *(_WORD *)(result + 0xB3) = 0;
  *(_WORD *)(result + 0xB7) = 0xF2;
  *(_DWORD *)(result + 0xB9) = &V_Type3_stru_10AE70.z1cc[4];
  *(_DWORD *)(result + 0xBD) = 0xFFFFFFFF;
  *(_WORD *)(result + 0xB5) = (unsigned __int8)byte_96778;
  return result;
}
// 96778: using guessed type char byte_96778;

//----- (0002F540) --------------------------------------------------------
void __fastcall sub_2F540(int a1)
{
  _DWORD *v2; // eax
  const char *v3; // ecx
  int v4; // edx
  int v5; // eax
  int v6; // eax
  LONG v7; // [esp-18h] [ebp-30h]
  LONG v8; // [esp-14h] [ebp-2Ch]
  __int16 v9; // [esp-Ch] [ebp-24h]
  PANE *a2; // [esp+0h] [ebp-18h]

  a2 = (PANE *)(a1 + 4);
  VFX_pane_wipe((PANE *)(a1 + 4), *(__int16 *)(a1 + 0xB7));
  VFX_line_draw(a2, 0, 0, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), 0, 0, 0xF3);
  VFX_line_draw(a2, 0, 0, 0, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), 0, 0xF3);
  v8 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
  VFX_line_draw(a2, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), v8, 0, v8, 0, 0xF3);
  v7 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8);
  VFX_line_draw(a2, v7, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), v7, 0, 0, 0xF3);
  v2 = *(_DWORD **)(a1 + 0xB9);
  v9 = *(_WORD *)(a1 + 0xB5);
  v3 = *(const char **)(a1 + 0xAB);
  v2[2] = a2->window;
  v2[3] = a2->x0;
  v2[4] = a2->y0;
  v2[5] = a2->x1;
  v2[6] = a2->y1;
  sub_2B8A8((int)v2, 2, 4, v3, 0, v9, 0xFF, 0);
  v4 = *(__int16 *)(a1 + 0xB3);
  v5 = *(_DWORD *)(a1 + 0xAB);
  LOBYTE(v3) = *(_BYTE *)(v4 + v5);
  *(_BYTE *)(v4 + v5) = 0;
  v6 = sub_2B4F4(*(_DWORD **)(a1 + 0xB9), *(char **)(a1 + 0xAB));
  *(_BYTE *)(*(__int16 *)(a1 + 0xB3) + *(_DWORD *)(a1 + 0xAB)) = (_BYTE)v3;
  VFX_line_draw(a2, v6 + 2, 3, v6 + 2, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC) - 3, 0, 0x98);
  sub_552CC(&V_Type3_stru_10AE70, a2);
}

//----- (0002F6B0) --------------------------------------------------------
unsigned int __fastcall sub_2F6B0(int a1, __int16 a2, char a3, unsigned int a4)
{
  int v6; // ecx
  int v8; // ebx
  __int16 v9; // ax
  int v10; // ebx

  if ( a2 != 3 )
  {
    return sub_2F424(a1, a2, a3, a4);
  }
  v6 = *(_DWORD *)(a1 + 0xBD);
  *(_DWORD *)(a1 + 0xBD) = 0;
  if ( a3 >= 0x30 && a3 <= 0x39 || a3 >= 0x41 && a3 <= 0x5A || a3 >= 0x61 && a3 <= 0x7A || a3 == 0x20 || a3 == 0x2D )
  {
    if ( v6 )
    {
      *(_WORD *)(a1 + 0xB3) = 0;
      *(_WORD *)(a1 + 0xB1) = *(_WORD *)(a1 + 0xB3);
      **(_BYTE **)(a1 + 0xAB) = 0;
    }
    if ( *(_WORD *)(a1 + 0xB1) < *(_WORD *)(a1 + 0xAF)
      && sub_2B4F4(&V_Type3_stru_10AE70.z1cc[4], *(char **)(a1 + 0xAB)) < 0x5F )
    {
      sub_2F8F8(a1, *(_WORD *)(a1 + 0xB3), a3, a2);
      ++*(_WORD *)(a1 + 0xB3);
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    }
    return 0xFFFFFFFF;
  }
  if ( a4 < 0x4B )
  {
    if ( a4 >= 0xE )
    {
      if ( a4 > 0xE )
      {
        if ( a4 == 0x1C )
        {
          sub_56B60(&V_Type3_stru_10AE70, 6, 3, 0);
          return 0xFFFFFFFF;
        }
        return sub_2F424(a1, a2, a3, a4);
      }
      if ( *(__int16 *)(a1 + 0xB3) > 0 )
      {
        sub_2F8A4(a1, (__int16)--*(_WORD *)(a1 + 0xB3));
        (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
      }
      return 0xFFFFFFFF;
    }
    return sub_2F424(a1, a2, a3, a4);
  }
  if ( a4 <= 0x4B )
  {
    if ( *(__int16 *)(a1 + 0xB3) > 0 )
    {
      v8 = *(_DWORD *)(a1 + 0xA7);
      --*(_WORD *)(a1 + 0xB3);
      (*(void (__fastcall **)(int, _DWORD))(v8 + 0xC))(a1, 0);
    }
    return 0xFFFFFFFF;
  }
  if ( a4 < 0x4D )
  {
    return sub_2F424(a1, a2, a3, a4);
  }
  if ( a4 <= 0x4D )
  {
    v9 = *(_WORD *)(a1 + 0xB3);
    if ( v9 < *(__int16 *)(a1 + 0xB1) )
    {
      v10 = *(_DWORD *)(a1 + 0xA7);
      *(_WORD *)(a1 + 0xB3) = v9 + 1;
      (*(void (__fastcall **)(int, _DWORD))(v10 + 0xC))(a1, 0);
    }
    return 0xFFFFFFFF;
  }
  else
  {
    if ( a4 != 0x53 )
    {
      return sub_2F424(a1, a2, a3, a4);
    }
    if ( *(_WORD *)(a1 + 0xB3) < *(_WORD *)(a1 + 0xB1) )
    {
      sub_2F8A4(a1, *(__int16 *)(a1 + 0xB3));
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    }
    return 0xFFFFFFFF;
  }
}

//----- (0002F8A4) --------------------------------------------------------
int __fastcall sub_2F8A4(int a1, int a2)
{
  __int16 v3; // bx
  int result; // eax

  if ( (__int16)a2 >= *(__int16 *)(a1 + 0xAF) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x8F2);
  }
  v3 = *(_WORD *)(a1 + 0xB1);
  result = a2;
  if ( (__int16)a2 < v3 )
  {
    do
    {
      *(_BYTE *)(*(_DWORD *)(a1 + 0xAB) + (__int16)result) = *(_BYTE *)(*(_DWORD *)(a1 + 0xAB) + (__int16)result + 1);
      ++result;
    }
    while ( (__int16)result < *(__int16 *)(a1 + 0xB1) );
  }
  --*(_WORD *)(a1 + 0xB1);
  return result;
}

//----- (0002F8F8) --------------------------------------------------------
char __usercall sub_2F8F8@<al>(int a1@<eax>, __int16 a2@<dx>, char a3@<bl>, int a4@<edi>)
{
  int i; // eax
  _BYTE *v7; // edx
  char result; // al

  if ( a2 > *(__int16 *)(a1 + 0xB1) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x903);
  }
  if ( *(_WORD *)(a1 + 0xB1) >= *(_WORD *)(a1 + 0xAF) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x904);
  }
  LOWORD(a4) = *(_WORD *)(a1 + 0xB1);
  if ( a2 == (_WORD)a4 )
  {
    *(_BYTE *)((__int16)a4 + *(_DWORD *)(a1 + 0xAB)) = a3;
    *(_BYTE *)((__int16)a4 + *(_DWORD *)(a1 + 0xAB) + 1) = 0;
  }
  else
  {
    for ( i = a4; (__int16)i >= a2; v7[1] = *v7 )
    {
      v7 = (_BYTE *)((__int16)i-- + *(_DWORD *)(a1 + 0xAB));
    }
  }
  result = a3;
  *(_BYTE *)(*(_DWORD *)(a1 + 0xAB) + a2) = a3;
  ++*(_WORD *)(a1 + 0xB1);
  return result;
}

//----- (0002F9A4) --------------------------------------------------------
int __fastcall sub_2F9A4(int a1, const char *a2, __int16 a3)
{
  int result; // eax
  unsigned int v5; // kr04_4

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x91B);
  }
  *(_DWORD *)(a1 + 0xAB) = a2;
  *(_WORD *)(a1 + 0xAF) = a3;
  result = 0;
  v5 = strlen(a2) + 1;
  *(_WORD *)(a1 + 0xB1) = v5 - 1;
  if ( (__int16)(v5 - 1) > a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x921);
  }
  *(_WORD *)(a1 + 0xB3) = *(_WORD *)(a1 + 0xB1);
  return result;
}

//----- (0002FA18) --------------------------------------------------------
void __fastcall __spoils<> Q_A3_sub_2FA18(P_TypeA3 a1)
{
  Q_A2_sub_2C830(&a1->a2);
  a1->a2.b = (int)off_95D90;
  Q_A3_sub_2FA78(a1);
}
// 95D90: using guessed type int (*off_95D90[5])();

//----- (0002FA34) --------------------------------------------------------
int __fastcall sub_2FA34(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95D04);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95D90;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95D90: using guessed type int (*off_95D90[5])();

//----- (0002FA78) --------------------------------------------------------
void __fastcall __spoils<> Q_A3_sub_2FA78(P_TypeA3 result)
{
  result->controls = 0;
  result->numControls = 3;
  result->e = 0xF3;
}

//----- (0002FA98) --------------------------------------------------------
void __fastcall sub_2FA98(int a1)
{
  PANE *v2; // esi
  const char *v3; // ecx
  LONG v4; // [esp-18h] [ebp-2Ch]
  LONG v5; // [esp-14h] [ebp-28h]
  __int16 v6; // [esp-10h] [ebp-24h]
  __int16 v7; // [esp-Ch] [ebp-20h]
  int v8; // [esp-4h] [ebp-18h]

  v2 = (PANE *)(a1 + 4);
  VFX_pane_wipe((PANE *)(a1 + 4), 0xF2);
  if ( *(_DWORD *)(a1 + 0x5F) == 0xFFFFFFFF )
  {
    VFX_line_draw(v2, 0, 0, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), 0, 0, 0xF3);
    VFX_line_draw(v2, 0, 0, 0, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), 0, 0xF3);
    v5 = *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC);
    VFX_line_draw(v2, *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8), v5, 0, v5, 0, 0xF3);
    v4 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8);
    VFX_line_draw(v2, v4, *(_DWORD *)(a1 + 0x14) - *(_DWORD *)(a1 + 0xC), v4, 0, 0, 0xF3);
  }
  if ( *(_DWORD *)(a1 + 0xAB) )
  {
    v3 = *(const char **)(a1 + 0xAB);
    v8 = *(_DWORD *)(a1 + 0x10) - *(_DWORD *)(a1 + 8) - 5;
    v7 = *(_WORD *)(a1 + 0xB1);
    v6 = *(_WORD *)(a1 + 0xAF);
    *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = *(_DWORD *)(a1 + 4);
    V_Type3_stru_10AE70.rect.x1 = *(_DWORD *)(a1 + 8);
    V_Type3_stru_10AE70.rect.y1 = *(_DWORD *)(a1 + 0xC);
    V_Type3_stru_10AE70.rect.x2 = *(_DWORD *)(a1 + 0x10);
    V_Type3_stru_10AE70.rect.y2 = *(_DWORD *)(a1 + 0x14);
    sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0, v3, v6, v7, 0xFF, v8);
  }
  sub_552CC(&V_Type3_stru_10AE70, (PANE *)(a1 + 4));
}

//----- (0002FBA4) --------------------------------------------------------
void __fastcall sub_2FBA4(int a1, int a2)
{
  int v3; // ecx
  LONG v4; // eax
  LONG v5; // ebx
  void *ShapeTable_sub_1B084; // eax
  __int16 v7; // [esp-4h] [ebp-14h]

  v3 = *(_DWORD *)(a1 + 0x41);
  v4 = 0xF2;
  if ( *(_DWORD *)V_Type3_stru_10AE70.z1aa == v3 && a2 != 2 || a2 == 3 )
  {
    v4 = 0x96;
  }
  VFX_pane_wipe((PANE *)(a1 + 4), v4);
  if ( *(__int16 *)(a1 + 0x1E) == 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\gwindow.cpp", 0x9A0);
  }
  v5 = *(__int16 *)(a1 + 0x1E);
  if ( v5 != 0xFFFFFFFF )
  {
    v7 = byte_104BEA;
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                             (unsigned int)&V_Type3_stru_10AE70.t13,
                             *(unsigned __int16 *)(a1 + 0x18));
    sub_53EB8((PANE *)(a1 + 4), ShapeTable_sub_1B084, v5, 0, 0, v7);
  }
  sub_552CC(&V_Type3_stru_10AE70, (PANE *)(a1 + 4));
}

//----- (0002FC3C) --------------------------------------------------------
int __fastcall sub_2FC3C(int a1)
{
  return (*(int (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
}

//----- (0002FC50) --------------------------------------------------------
void __fastcall __spoils<> Q_A2_sub_2FC50(P_TypeA2 a1)
{
  Q_A2_sub_2C830(a1);
  a1->b = (int)off_95E54;
}
// 95E54: using guessed type int (*off_95E54[5])();

//----- (0002FC68) --------------------------------------------------------
int __fastcall sub_2FC68(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95E40);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95E54;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95E54: using guessed type int (*off_95E54[5])();

//----- (0002FCB0) --------------------------------------------------------
int __fastcall sub_2FCB0(_DWORD *a1, char *a2, char *a3)
{
  char *v4; // edi
  char v6; // al
  char v7; // al
  char *v8; // edi
  char v10; // al
  char v11; // al
  int result; // eax
  int v13; // ebx

  *(_DWORD *)((char *)a1 + 0xDAB) = 0;
  v4 = (char *)a1 + 0xAB;
  *(_DWORD *)((char *)a1 + 0xDA7) = *(_DWORD *)((char *)a1 + 0xDAB);
  do
  {
    v6 = *a2;
    *v4 = *a2;
    if ( !v6 )
    {
      break;
    }
    v7 = a2[1];
    a2 += 2;
    v4[1] = v7;
    v4 += 2;
  }
  while ( v7 );
  v8 = (char *)a1 + 0xC9;
  do
  {
    v10 = *a3;
    *v8 = *a3;
    if ( !v10 )
    {
      break;
    }
    v11 = a3[1];
    a3 += 2;
    v8[1] = v11;
    v8 += 2;
  }
  while ( v11 );
  sub_2FEB8((int)a1);
  result = *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596];
  v13 = 0x98;
  if ( !*(_WORD *)&V_Type3_stru_10AE70.z1e[0x596]
    || *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] == 1
    || *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] == 7
    || *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] == 8
    || *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] == 0x10
    || *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] == 0x14 )
  {
    v13 = 0x50;
  }
  a1[2] = v13;
  a1[3] = 0x78;
  a1[4] = v13 + 0x14F;
  a1[5] = 0x177;
  return result;
}

//----- (0002FD68) --------------------------------------------------------
unsigned int __fastcall sub_2FD68(int a1, __int16 a2, int a3, int a4)
{
  int v4; // ebx
  int v6; // edx
  int v7; // ebx

  if ( (unsigned __int16)a2 < 6u )
  {
    if ( (unsigned __int16)a2 < 2u )
    {
      if ( a2 == 1 )
      {
        *(_DWORD *)(a1 + 0x35) = 0xFFFFFFFF;
        v4 = *(_DWORD *)(a1 + 0xA7);
        *(_DWORD *)(a1 + 0x39) = 0xFFFFFFFF;
        (*(void (**)(void))(v4 + 0xC))();
        return 0;
      }
      return sub_2F424(a1, a2, a3, a4);
    }
    if ( (unsigned __int16)a2 > 2u && a2 == 5 )
    {
      goto LABEL_9;
    }
    return sub_2F424(a1, a2, a3, a4);
  }
  if ( (unsigned __int16)a2 <= 7u )
  {
    return sub_2F424(a1, a2, a3, a4);
  }
  if ( (unsigned __int16)a2 < 0xDu )
  {
    if ( a2 != 0xC )
    {
      return sub_2F424(a1, a2, a3, a4);
    }
LABEL_9:
    sub_56B60(&V_Type3_stru_10AE70, 6, 0xCA, 0);
    return 0xFFFFFFFF;
  }
  if ( (unsigned __int16)a2 <= 0xDu || (unsigned __int16)a2 < 0x32u || (unsigned __int16)a2 > 0x32u )
  {
    return sub_2F424(a1, a2, a3, a4);
  }
  v6 = *(_DWORD *)(a1 + 0xDA7);
  if ( v6 >= *(_DWORD *)(a1 + 0xDAB) )
  {
    sub_56B60(&V_Type3_stru_10AE70, 6, a3, a4);
  }
  else
  {
    v7 = *(_DWORD *)(a1 + 0xA7);
    *(_DWORD *)(a1 + 0xDA7) = v6 + 1;
    (*(void (**)(void))(v7 + 0xC))();
  }
  return 0;
}

//----- (0002FE58) --------------------------------------------------------
void __fastcall Q_HELPWIN_CPP_FgetsLine_sub_2FE58(FILE *fp, char *line)
{
  unsigned int found; // edi
  char first; // ah

  found = 0;
  do
  {
    if ( !fgets(line, 200, fp) )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\helpwin.cpp", 0x9E);
    }
    first = *line;
    if ( *line != ' ' && first != '\t' && first != '\n' && first != '\r' && first != '/' && first != '#' )
    {
      found = 0xFFFFFFFF;
    }
  }
  while ( !found );
}

//----- (0002FEB8) --------------------------------------------------------
int __fastcall sub_2FEB8(int a1)
{
  int v1; // eax
  int v2; // edx
  void *v3; // eax
  int v4; // edx
  int v5; // ecx
  const char *v6; // ecx
  __int64 v7; // rax
  int v8; // edx
  int v9; // edx
  int v10; // eax
  int v11; // edx
  _DWORD *v12; // edx
  _DWORD *v13; // ebx
  int v14; // edi
  int v15; // eax
  int v16; // eax
  _BYTE *v17; // edx
  int v18; // eax
  int v19; // edx
  char *v20; // esi
  char *v21; // edi
  char v22; // al
  char v23; // al
  _BYTE *v24; // ecx
  int v25; // esi
  char v26; // bl
  int v27; // ecx
  int v28; // esi
  char *v29; // ebx
  char s[204]; // [esp+0h] [ebp-13Ah] BYREF
  char s2[60]; // [esp+CCh] [ebp-6Eh] BYREF
  char s1[60]; // [esp+108h] [ebp-32h] BYREF
  char v34[52]; // [esp+144h] [ebp+Ah] BYREF
  FILE *fp; // [esp+178h] [ebp+3Eh]
  int v36; // [esp+17Ch] [ebp+42h]
  int v37; // [esp+180h] [ebp+46h] BYREF
  int v38; // [esp+184h] [ebp+4Ah] BYREF
  int v39; // [esp+188h] [ebp+4Eh] BYREF
  int v40; // [esp+18Ch] [ebp+52h] BYREF
  int v41; // [esp+190h] [ebp+56h]
  int v42; // [esp+194h] [ebp+5Ah]
  int v43; // [esp+198h] [ebp+5Eh]
  int v44; // [esp+19Ch] [ebp+62h]
  int v45; // [esp+1A0h] [ebp+66h]
  int v46; // [esp+1A4h] [ebp+6Ah]
  int v47; // [esp+1A8h] [ebp+6Eh]
  int v48; // [esp+1ACh] [ebp+72h]
  int v49; // [esp+1B0h] [ebp+76h]
  int v50; // [esp+1B4h] [ebp+7Ah]
  int v51; // [esp+1B8h] [ebp+7Eh]

  v49 = a1;
  sub_2D258(a1, 2);
  v1 = v49;
  v2 = v49 + 0x10E;
  do
  {
    v1 += 0x1B;
    *(_DWORD *)(v1 + 0xC91) = 0;
  }
  while ( v1 != v2 );
  v3 = (void *)(v49 + 0xDD);
  *(_DWORD *)(v49 + 0xDA3) = 0;
  memset(v3, 0, 0xBB8u);
  v47 = 0;
  v45 = 0;
  v44 = 0;
  v4 = v49;
  v5 = v49;
  *(_WORD *)(v49 + 0x18) = word_FFEEA;
  *(_WORD *)(v4 + 0x1E) = 0;
  v6 = (const char *)(v5 + 0xC9);
  fp = Q_OpenFile_sub_1BB10((const char *)(v4 + 0xAB), 0);
  do
  {
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(fp, s);
    sscanf(s, "%s", s1);
    if ( !stricmp(s1, "HELP") )
    {
      sscanf(s, "%s %s", s1, s2);
      if ( !stricmp(v6, s2) )
      {
        v47 = 1;
      }
      else if ( !stricmp("END", s2) )
      {
        v7 = sub_2620C("Topic '%s' not found in help file.\n", (char)v6);
        sub_261B8(0, (const char *)HIDWORD(v7), 0xE8);
      }
    }
  }
  while ( !v47 );
  v46 = 0xFFFFFFFF;
  v42 = 0xFFFFFFFF;
  v36 = v49 + 0xC95;
  if ( v47 != 2 )
  {
    v41 = v49 + 0xDD;
    v48 = 4 * v45;
    v43 = 0x258 * v44;
    do
    {
      Q_HELPWIN_CPP_FgetsLine_sub_2FE58(fp, s);
      sscanf(s, "%s", s1);
      if ( !stricmp(s1, "HELP") )
      {
        v47 = 2;
      }
      else if ( !stricmp(s1, "POS") )
      {
        v8 = v36;
        sscanf(s, "%s %d %d", s1, &v37, &v38);
        *(_WORD *)(v8 + 0x13) = v37;
        *(_WORD *)(v8 + 0x15) = v38;
      }
      else if ( !stricmp(s1, "SHAPE") )
      {
        v9 = *(_DWORD *)(v49 + 0xDA3) + 1;
        *(_DWORD *)(v49 + 0xDA3) = v9;
        if ( v9 >= 0xA )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\helpwin.cpp", 0x124);
        }
        if ( v46 == 0xFFFFFFFF )
        {
          v46 = 0;
        }
        else
        {
          v36 += 0x1B;
        }
        v10 = v36;
        *(_BYTE *)v36 = 0;
        *(_WORD *)(v10 + 1) = 0;
        *(_WORD *)(v10 + 3) = 0;
        *(_WORD *)(v10 + 0x13) = 0;
        *(_WORD *)(v10 + 0x15) = 0;
        if ( sscanf(s, "%s %d %d %d %d", s1, &v37, &v38, &v39, &v40) == 5 )
        {
          v11 = v36;
          *(_WORD *)(v36 + 1) = v37;
          *(_WORD *)(v11 + 3) = v38;
          *(_WORD *)(v11 + 0x13) = v39;
          *(_WORD *)(v11 + 0x15) = v40;
        }
      }
      else if ( !stricmp(s1, "BUTTON") )
      {
        if ( v42 == 0xFFFFFFFF )
        {
          v42 = 0;
        }
        else
        {
          v48 += 4;
          ++v45;
        }
        if ( *(__int16 *)(v49 + 0x6B) <= v45 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\helpwin.cpp", 0x145);
        }
        sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(*(_DWORD *)(v48 + *(_DWORD *)(v49 + 0x67)) + 0x41), 0xE, 0, 0);
      }
      else if ( !stricmp(s1, "TITLE") )
      {
        sscanf(s, "%s %s", s1, *(_DWORD *)(v48 + *(_DWORD *)(v49 + 0x67)) + 0x20);
      }
      else if ( !stricmp(s1, "MSG") )
      {
        sscanf(s, "%s %d", s1, &v37);
        *(_DWORD *)(*(_DWORD *)(v48 + *(_DWORD *)(v49 + 0x67)) + 0x47) = v37;
      }
      else if ( !stricmp(s1, "PANE") )
      {
        sscanf(s, "%s %d %d %d %d", s1, &v37, &v38, &v39, &v40);
        v12 = *(_DWORD **)(v48 + *(_DWORD *)(v49 + 0x67));
        v12[2] = v37;
        v12[3] = v38;
        v12[4] = v39;
        v12[5] = v40;
      }
      else if ( !stricmp(s1, "BPOS") )
      {
        sscanf(s, "%s %s", s1, v34);
        v13 = (_DWORD *)(*(_DWORD *)(v48 + *(_DWORD *)(v49 + 0x67)) + 4);
        if ( !stricmp(v34, "BL") )
        {
          v13[1] = *(_DWORD *)(v49 + 8) + 0xF;
          v13[2] = *(_DWORD *)(v49 + 0x14) - 0x32;
          v13[3] = *(_DWORD *)(v49 + 8) + 0x5A;
          v13[4] = *(_DWORD *)(v49 + 0x14) - 0xF;
        }
        else if ( !stricmp(v34, "BR") )
        {
          v13[1] = *(_DWORD *)(v49 + 0x10) - 0x5A;
          v13[2] = *(_DWORD *)(v49 + 0x14) - 0x32;
          v13[3] = *(_DWORD *)(v49 + 0x10) - 0xF;
          v13[4] = *(_DWORD *)(v49 + 0x14) - 0xF;
        }
      }
      else if ( !stricmp(s1, "TEXT") )
      {
        v14 = *(_DWORD *)(v49 + 0xDA3) + 1;
        *(_DWORD *)(v49 + 0xDA3) = v14;
        if ( v14 >= 0xA )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\helpwin.cpp", 0x177);
        }
        if ( v44 >= 5 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\helpwin.cpp", 0x178);
        }
        if ( v46 == 0xFFFFFFFF )
        {
          v46 = 0;
        }
        else
        {
          v36 += 0x1B;
        }
        v15 = v36;
        *(_BYTE *)v36 = 1;
        *(_DWORD *)(v15 + 0xF) = 0;
        v16 = v43;
        v43 += 0x258;
        v17 = (_BYTE *)(v16 + v41);
        v18 = v36;
        *(_DWORD *)(v36 + 5) = v17;
        *v17 = 0;
        *(_DWORD *)(v18 + 0xB) = &V_Type3_stru_10AE70.z1cc[4];
        *(_WORD *)(v18 + 0x13) = 0;
        *(_WORD *)(v18 + 0x15) = 0;
        *(_WORD *)(v18 + 9) = 0xFFFF;
        ++v44;
        if ( sscanf(s, "%s %d %d %d", s1, &v37, &v38, &v39) == 4 )
        {
          v19 = v36;
          *(_WORD *)(v36 + 0x13) = v37;
          *(_WORD *)(v19 + 0x15) = v38;
          *(_WORD *)(v19 + 9) = v39;
        }
        v50 = 0;
        v51 = 0;
        do
        {
          Q_HELPWIN_CPP_FgetsLine_sub_2FE58(fp, s);
          if ( !strnicmp(s, "ENDTEXT", 7u) )
          {
            v50 = 0xFFFFFFFF;
          }
          else
          {
            v51 += strlen(s);
            if ( v51 >= 0x254 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\helpwin.cpp", 0x19E);
            }
            v20 = s;
            v21 = (char *)(*(_DWORD *)(v36 + 5) + strlen(*(const char **)(v36 + 5)));
            do
            {
              v22 = *v20;
              *v21 = *v20;
              if ( !v22 )
              {
                break;
              }
              v23 = v20[1];
              v20 += 2;
              v21[1] = v23;
              v21 += 2;
            }
            while ( v23 );
          }
        }
        while ( !v50 );
        if ( !*(_DWORD *)(v36 + 5) )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\helpwin.cpp", 0x1A6);
        }
        v24 = *(_BYTE **)(v36 + 5);
        v25 = 0;
        if ( *v24 )
        {
          do
          {
            if ( v25 >= 0x255 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\helpwin.cpp", 0x1AC);
            }
            if ( *v24 == 0xA )
            {
              *v24 = 0x20;
            }
            else if ( *v24 == 0x40 )
            {
              *v24 = 0xA;
            }
            v26 = *++v24;
            ++v25;
          }
          while ( v26 );
        }
      }
      else if ( !stricmp(s1, "CENTERPOS") )
      {
        *(_WORD *)(v36 + 0x13) = (*(_DWORD *)(v49 + 0x10) - *(_DWORD *)(v49 + 8)) / 2;
        *(_WORD *)(v36 + 0x15) = (*(_DWORD *)(v49 + 0x14) - 0x32 - *(_DWORD *)(v49 + 0xC)) / 2;
      }
      else if ( !stricmp(s1, "FONT") )
      {
        sscanf(s, "%s %s", s1, v34);
        if ( !stricmp(v34, "LARGE") )
        {
          *(_DWORD *)(v36 + 0xB) = &V_Type3_stru_10AE70.z1cc[4];
        }
        else if ( !stricmp(v34, "SMALL") )
        {
          *(_DWORD *)(v36 + 0xB) = V_Type3_stru_10AE70.z1ccc;
        }
      }
      else if ( !stricmp(s1, "FLAGS") )
      {
        v27 = 0;
        v28 = sscanf(s, "%s %s %s %s %s %s", s1, v34, &v34[0xA], &v34[0x14], &v34[0x1E], &v34[0x28]) - 1;
        v29 = v34;
        while ( v27 < v28 )
        {
          if ( !stricmp(v29, "TJ_HC") )
          {
            *(_BYTE *)(v36 + 0xF) |= 2u;
          }
          else if ( !stricmp(v29, "TJ_VC") )
          {
            *(_BYTE *)(v36 + 0xF) |= 1u;
          }
          else if ( !stricmp(v29, "TJ_R") )
          {
            *(_BYTE *)(v36 + 0xF) |= 0x20u;
          }
          else if ( !stricmp(v29, "TJ_B") )
          {
            *(_BYTE *)(v36 + 0xF) |= 0x10u;
          }
          ++v27;
          v29 += 0xA;
        }
      }
      else if ( !stricmp(s1, "NEWPAGE") )
      {
        *(_DWORD *)(v36 + 0x17) = 0xFFFFFFFF;
        ++*(_DWORD *)(v49 + 0xDAB);
      }
    }
    while ( v47 != 2 );
  }
  return fclose(fp);
}

//----- (00030774) --------------------------------------------------------
void __fastcall sub_30774(int a1)
{
  PANE *v1; // esi
  int v2; // eax
  void *ShapeTable_sub_1B084; // eax
  int v4; // edi
  int v5; // esi
  int v6; // eax
  int v7; // edx
  int v8; // esi
  int v9; // ebx
  int v10; // ecx
  int v11; // ebp
  _DWORD *v12; // edi
  _DWORD *v13; // eax
  int v14; // esi
  _DWORD *v15; // edi
  _DWORD *v16; // eax
  int v17; // edx
  int v18; // ebx
  int v19; // esi
  char *v20; // ebp
  char v21; // ah
  void *v22; // eax
  int v23; // edx
  int v24; // ebx
  int v25; // eax
  const char *v26; // ecx
  int v27; // eax
  int v28; // edx
  int v29; // edi
  __int16 v30; // [esp-Ch] [ebp-A4h]
  LONG v31; // [esp-8h] [ebp-A0h]
  LONG v32; // [esp-8h] [ebp-A0h]
  __int16 v33; // [esp-8h] [ebp-A0h]
  LONG v34; // [esp-4h] [ebp-9Ch]
  int v35[21]; // [esp+0h] [ebp-98h]
  PANE pane; // [esp+54h] [ebp-44h] BYREF
  int v37; // [esp+68h] [ebp-30h]
  int v38; // [esp+6Ch] [ebp-2Ch]
  int v39; // [esp+70h] [ebp-28h]
  int v40; // [esp+74h] [ebp-24h]
  _DWORD *v41; // [esp+78h] [ebp-20h]
  __int16 v42; // [esp+7Ch] [ebp-1Ch]
  __int16 v43; // [esp+80h] [ebp-18h]

  v41 = (_DWORD *)a1;
  v1 = (PANE *)(a1 + 4);
  VFX_pane_wipe((PANE *)(a1 + 4), 0xF2);
  v2 = *((unsigned __int16 *)v41 + 0xC);
  if ( (unsigned __int16)v2 != 0xFFFF )
  {
    v35[0] = 0;
    v31 = *((__int16 *)v41 + 0xF);
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                             (unsigned int)&V_Type3_stru_10AE70.t13,
                             (unsigned __int16)word_FFEA0[v2]);
    VFX_shape_draw(v1, ShapeTable_sub_1B084, v31, 0, 0);
  }
  v4 = 0;
  v5 = 0;
  sub_552CC(&V_Type3_stru_10AE70, (PANE *)(v41 + 1));
  v6 = 0;
  v7 = 0;
  while ( v6 < *(__int16 *)((char *)v41 + 0x6B) )
  {
    if ( *(_DWORD *)(*(_DWORD *)(v7 + *(_DWORD *)((char *)v41 + 0x67)) + 0x35) == 0xFFFFFFFF )
    {
      ++v5;
      ++v4;
      v35[v5] = v6;
    }
    v7 += 4;
    ++v6;
  }
  v8 = v41[2] + 8;
  v9 = v41[2] + 0x147;
  if ( v4 > 0 )
  {
    v10 = v4;
    v11 = 0;
    v38 = 4 * v4;
    do
    {
      v12 = *(_DWORD **)(*(_DWORD *)((char *)v41 + 0x67) + 4 * v35[v11 / 4u + 1]);
      v13 = v41;
      v12[2] = v8;
      v12[3] = v13[3] + 0xD9;
      v12[5] = v41[3] + 0xF7;
      v14 = (v9 - v8) / v10 + v8;
      v15 = v12 + 1;
      if ( v14 > v9 )
      {
        v14 = v9;
      }
      --v10;
      v11 += 4;
      v15[3] = v14;
      v8 = v14 + 1;
    }
    while ( v11 < v38 );
  }
  pane = *(PANE *)(v41 + 1);
  pane.x0 = v41[2] + 0xA;
  pane.y0 = v41[3] + 0xA;
  pane.x1 = v41[2] + 0x145;
  pane.y1 = v41[3] + 0xCF;
  v16 = v41;
  v17 = 0;
  v18 = *(_DWORD *)((char *)v41 + 0xDA7);
  v40 = 0;
  if ( v18 > 0 )
  {
    do
    {
      if ( v40 >= *(_DWORD *)((char *)v41 + 0xDA3) )
      {
        break;
      }
      if ( v16[0x32B] == 0xFFFFFFFF )
      {
        ++v17;
      }
      v16 = (_DWORD *)((char *)v16 + 0x1B);
      v19 = *(_DWORD *)((char *)v41 + 0xDA7);
      ++v40;
    }
    while ( v17 < v19 );
  }
  v39 = 0;
  v20 = (char *)v41 + 0x1B * v40 + 0xC95;
  if ( v40 < *(_DWORD *)((char *)v41 + 0xDA3) )
  {
    do
    {
      if ( v39 == 0xFFFFFFFF )
      {
        break;
      }
      v39 = *(_DWORD *)(v20 + 0x17);
      v21 = *v20;
      if ( *v20 )
      {
        if ( v21 == 1 )
        {
          v23 = 0;
          if ( (v20[0xF] & 2) == 0 )
          {
            v23 = pane.x1 - pane.x0 - *(__int16 *)(v20 + 0x13);
          }
          v35[0] = v23;
          v24 = *(__int16 *)(v20 + 0x15);
          v25 = *(__int16 *)(v20 + 0x13);
          v26 = *(const char **)(v20 + 5);
          v42 = *(_WORD *)(v20 + 0xF);
          v43 = *(_WORD *)(v20 + 9);
          v37 = v25;
          v27 = *(_DWORD *)(v20 + 0xB);
          v33 = v43;
          v30 = v42;
          v28 = v37;
          *(PANE *)(v27 + 8) = pane;
          sub_2B8A8(v27, v28, v24, v26, v30, v33, 0xFF, v35[0]);
        }
        else if ( v21 != 2 )
        {
          Q_AssertLogBreakExit_sub_261A8(0, "..\\helpwin.cpp", 0x245);
        }
      }
      else
      {
        v35[0] = *(__int16 *)(v20 + 0x15);
        v34 = *(__int16 *)(v20 + 0x13);
        v32 = *(unsigned __int16 *)(v20 + 3);
        v22 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                (unsigned int)&V_Type3_stru_10AE70.t13,
                (unsigned __int16)word_FFEA0[*(unsigned __int16 *)(v20 + 1)]);
        VFX_shape_draw(&pane, v22, v32, v34, v35[0]);
      }
      v20 += 0x1B;
      v29 = *(_DWORD *)((char *)v41 + 0xDA3);
      ++v40;
    }
    while ( v40 < v29 );
  }
  sub_2D218(v41);
}
// FFEA0: using guessed type __int16 word_FFEA0[7];

//----- (00030A90) --------------------------------------------------------
int __fastcall sub_30A90(T_Type5 *a1, int edx0, int a3, int a4)
{
  int v5; // edx
  int v6; // eax
  char *sub_1CEA8; // eax
  int result; // eax
  int *v9; // eax
  LONG v10; // edx
  void *ShapeTable_sub_1B084; // eax
  LONG v12; // edx
  char *v13; // eax
  int v14; // edx
  int v15; // ebx
  int v16; // ecx
  int v17; // esi
  char *v18; // eax
  void *v19; // eax
  void *v20; // eax
  int v21; // eax
  char *v22; // eax
  __int16 v23; // di
  LONG v24; // ecx
  void *v25; // eax
  __int16 v26; // edx^2
  char *v27; // eax
  __int16 v28; // di
  LONG v29; // ecx
  void *v30; // eax
  __int16 v31; // edx^2
  int v32; // eax
  char *v33; // eax
  __int16 v34; // di
  LONG v35; // ecx
  void *v36; // eax
  LONG v37; // esi
  LONG v38; // ebx
  void *v39; // eax
  int *v40; // edi
  LONG v41; // ebx
  void *v42; // eax
  int v43; // ecx
  LONG v44; // [esp-20h] [ebp-B0h]
  __int16 v45; // [esp-Ch] [ebp-9Ch]
  __int16 v46; // [esp-Ch] [ebp-9Ch]
  __int16 v47; // [esp-Ch] [ebp-9Ch]
  __int16 v48; // [esp-Ch] [ebp-9Ch]
  int v49; // [esp-8h] [ebp-98h]
  int v50; // [esp-8h] [ebp-98h]
  int v51; // [esp-8h] [ebp-98h]
  int v52; // [esp-8h] [ebp-98h]
  char v53; // [esp-4h] [ebp-94h]
  int v54; // [esp-4h] [ebp-94h]
  char v55; // [esp-4h] [ebp-94h]
  char v56; // [esp-4h] [ebp-94h]
  char v57; // [esp-4h] [ebp-94h]
  char v58; // [esp-4h] [ebp-94h]
  __int16 v59; // [esp-4h] [ebp-94h]
  char s[52]; // [esp+0h] [ebp-90h] BYREF
  int v61; // [esp+34h] [ebp-5Ch]
  int v62; // [esp+38h] [ebp-58h]
  LONG shape_number; // [esp+3Ch] [ebp-54h]
  char *v64; // [esp+40h] [ebp-50h]
  int a2; // [esp+44h] [ebp-4Ch]
  int v66; // [esp+48h] [ebp-48h]
  LONG v67; // [esp+4Ch] [ebp-44h]
  int v68; // [esp+50h] [ebp-40h]
  int v69; // [esp+54h] [ebp-3Ch]
  int v70; // [esp+58h] [ebp-38h]
  int v71; // [esp+5Ch] [ebp-34h]
  int v72; // [esp+60h] [ebp-30h]
  LONG v73; // [esp+64h] [ebp-2Ch]
  LONG v74; // [esp+68h] [ebp-28h]
  LONG hotY; // [esp+6Ch] [ebp-24h]
  int *v76; // [esp+70h] [ebp-20h]
  int v77; // [esp+74h] [ebp-1Ch]
  int v78; // [esp+78h] [ebp-18h]
  __int16 i; // [esp+7Ch] [ebp-14h]
  int v80; // [esp+80h] [ebp-10h]

  v76 = (int *)edx0;
  v66 = 9;
  if ( a4 && (a3 == 1 || *(_DWORD *)(edx0 + 8) != 0xFFFFFFFF) )
  {
    v66 = 0xF3;
  }
  else
  {
    v5 = v76[2];
    if ( v5 != 0xFFFFFFFF )
    {
      v66 = 4 * v76[v5 + 0xA] + 0x13;
    }
  }
  sprintf(s, "%d.", v76[0x1B]);
  v45 = v66;
  a2 = (__int16)v66;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = a1->a;
  V_Type3_stru_10AE70.rect.x1 = a1->rect.x1;
  V_Type3_stru_10AE70.rect.y1 = a1->rect.y1;
  V_Type3_stru_10AE70.rect.x2 = a1->rect.x2;
  V_Type3_stru_10AE70.rect.y2 = a1->rect.y2;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 5, 5, s, 0, v45, 0xFF, 0);
  HIWORD(v6) = HIWORD(v76);
  if ( v76[2] == 0xFFFFFFFF )
  {
    sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x10);// 16: "<EMPTY>"
    v46 = a2;
    *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = a1->a;
    V_Type3_stru_10AE70.rect.x1 = a1->rect.x1;
    V_Type3_stru_10AE70.rect.y1 = a1->rect.y1;
    V_Type3_stru_10AE70.rect.x2 = a1->rect.x2;
    V_Type3_stru_10AE70.rect.y2 = a1->rect.y2;
    return sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0x1E, 5, sub_1CEA8, 0, v46, 0xFF, 0);
  }
  LOWORD(v6) = word_FFEE0;
  v80 = v6;
  v9 = &v76[v76[2]];
  v10 = v9[3];
  v77 = v9[0xA];
  shape_number = v10;
  v53 = v77;
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           (unsigned __int16)v80);
  sub_53F40(a1, ShapeTable_sub_1B084, v10, 0x19, 5, v53);
  v12 = shape_number;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = a1->a;
  V_Type3_stru_10AE70.rect.x1 = a1->rect.x1;
  V_Type3_stru_10AE70.rect.y1 = a1->rect.y1;
  V_Type3_stru_10AE70.rect.x2 = a1->rect.x2;
  V_Type3_stru_10AE70.rect.y2 = a1->rect.y2;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0x2D, 5, V_SpecNames[v12], 0, a2, 0xFF, 0);
  v54 = *v76;
  v13 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x11);      // 17: "Day %d"
  sprintf(s, v13, v54);
  v47 = a2;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = a1->a;
  V_Type3_stru_10AE70.rect.x1 = a1->rect.x1;
  V_Type3_stru_10AE70.rect.y1 = a1->rect.y1;
  V_Type3_stru_10AE70.rect.x2 = a1->rect.x2;
  V_Type3_stru_10AE70.rect.y2 = a1->rect.y2;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0x2D, 0x14, s, 0, v47, 0xFF, 0);
  v14 = ((v76[0x1C] & 0xFE00) >> 9) + 0x50;
  v15 = v76[0x1C] & 0x1F;
  v16 = (v76[0x1C] & 0x1E0) >> 5;
  v68 = (*((_WORD *)v76 + 0x39) & 0xF800) >> 0xB;
  v17 = v68;
  v64 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x12);      // 18: "am"
  if ( v17 )
  {
    if ( v17 == 0xC )
    {
      v18 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x13);  // 19: "pm"
    }
    else
    {
      if ( v17 <= 0xC )
      {
        goto LABEL_16;
      }
      v18 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x13);  // 19: "pm"
      v68 = v17 - 0xC;
    }
    v64 = v18;
    goto LABEL_16;
  }
  v68 = 0xC;
LABEL_16:
  v61 = (*((_WORD *)v76 + 0x39) & 0x7E0) >> 5;
  sprintf(s, "%d/%d/%d", v16, v15, v14);
  v48 = v66;
  v62 = (__int16)v66;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = a1->a;
  V_Type3_stru_10AE70.rect.x1 = a1->rect.x1;
  V_Type3_stru_10AE70.rect.y1 = a1->rect.y1;
  V_Type3_stru_10AE70.rect.x2 = a1->rect.x2;
  V_Type3_stru_10AE70.rect.y2 = a1->rect.y2;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0x2D, 0x32, s, 0, v48, 0xFF, 0);
  sprintf(s, "%d : %.2d %s", v68, v61, v64);
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = a1->a;
  V_Type3_stru_10AE70.rect.x1 = a1->rect.x1;
  V_Type3_stru_10AE70.rect.y1 = a1->rect.y1;
  V_Type3_stru_10AE70.rect.x2 = a1->rect.x2;
  V_Type3_stru_10AE70.rect.y2 = a1->rect.y2;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0x2D, 0x41, s, 0, v62, 0xFF, 0);
  v44 = shape_number;
  v19 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEF4);
  VFX_shape_transform((PANE *)a1, v19, v44, 0x96, 0x1E, V_BigBuffer, 0, 0x8000, 0x8000, 0);
  v55 = v77;
  v20 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEF2);
  sub_53F40(a1, v20, 3, 0x96, 0x1E, v55);
  LOWORD(v21) = word_FFEF2;
  v78 = v21;
  v67 = 0xC8;
  v22 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x14);      // 20: "Fleet"
  v72 = 0x14;
  V_Type3_stru_10AE70.pane = (PANE)*a1;
  v23 = 0;
  sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0xC8, 5, v22, 0, v62, 0xFF, 0);
  while ( v23 < v76[0x18] )
  {
    v24 = v67;
    v56 = v77;
    v49 = v72;
    v25 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v78);
    sub_53F40(a1, v25, 5, v24, v49, v56);
    v67 += 8;
    if ( v23 % 9 == 8 )
    {
      v67 = 0xC8;
      v72 += 8;
    }
    ++v23;
  }
  v26 = v66;
  v27 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x15);      // 21: "Colonies"
  v73 = 0x118;
  v71 = 0x14;
  V_Type3_stru_10AE70.pane = (PANE)*a1;
  v28 = 0;
  sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0x118, 5, v27, 0, v26, 0xFF, 0);
  while ( v28 < v76[0x19] )
  {
    v29 = v73;
    v57 = v77;
    v50 = v71;
    v30 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v78);
    sub_53F40(a1, v30, 6, v29, v50, v57);
    v73 += 8;
    if ( v28 % 9 == 8 )
    {
      v73 = 0x118;
      v71 += 8;
    }
    ++v28;
  }
  v31 = v66;
  v32 = v76[0x1A] >> 2;
  v74 = 0x168;
  v69 = v32;
  v70 = 0x14;
  v33 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x16);      // 22: "Discoveries"
  V_Type3_stru_10AE70.pane = (PANE)*a1;
  v34 = 0;
  sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0x168, 5, v33, 0, v31, 0xFF, 0);
  while ( v34 < v69 )
  {
    v58 = v77;
    v51 = v70;
    v35 = v74;
    v36 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v78);
    sub_53F40(a1, v36, 7, v35, v51, v58);
    v74 += 8;
    if ( v34 % 9 == 8 )
    {
      v74 = 0x168;
      v70 += 8;
    }
    ++v34;
  }
  hotY = 5;
  v37 = 0x1CC;
  for ( i = 0; ; ++i )
  {
    result = i;
    if ( i >= v76[1] )
    {
      break;
    }
    if ( i != v76[2] )
    {
      v40 = &v76[i];
      if ( v40[0x11] )
      {
        v59 = *((_WORD *)v40 + 0x14);
        v52 = hotY;
        v41 = v40[3];
        v42 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v80);
        sub_53F40(a1, v42, v41, v37, v52, v59);
        v43 = v40[0x11];
        v38 = 0xFFFFFFFF;
        if ( v43 == 3 )
        {
          v38 = 9;
        }
        else if ( v43 == 2 )
        {
          v38 = 8;
        }
        if ( v38 != 0xFFFFFFFF )
        {
          v39 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                  (unsigned int)&V_Type3_stru_10AE70.t13,
                  (unsigned __int16)word_FFEF2);
          VFX_shape_draw((PANE *)a1, v39, v38, v37, hotY);
        }
        v37 += 0x39;
        if ( v37 > 0x258 )
        {
          v37 = 0x1CC;
          hotY += 0x1B;
        }
      }
    }
  }
  return result;
}
// 30E3F: variable 'v21' is possibly undefined
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (00031158) --------------------------------------------------------
int __fastcall sub_31158(_DWORD *a1, int a2, int a3, int a4)
{
  __int16 v5; // dx
  char s[12]; // [esp+0h] [ebp-20h] BYREF
  int v8; // [esp+Ch] [ebp-14h]
  int v9; // [esp+10h] [ebp-10h]

  v9 = a2;
  v5 = 9;
  if ( a4 )
  {
    v5 = 0xF3;
  }
  sprintf(s, "%d.", *(_DWORD *)(v9 + 0xDC));
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = *a1;
  V_Type3_stru_10AE70.rect.x1 = a1[1];
  V_Type3_stru_10AE70.rect.y1 = a1[2];
  V_Type3_stru_10AE70.rect.x2 = a1[3];
  V_Type3_stru_10AE70.rect.y2 = a1[4];
  v8 = v5;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 5, 5, s, 0, v5, 0xFF, 0);
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = *a1;
  V_Type3_stru_10AE70.rect.x1 = a1[1];
  V_Type3_stru_10AE70.rect.y1 = a1[2];
  V_Type3_stru_10AE70.rect.x2 = a1[3];
  V_Type3_stru_10AE70.rect.y2 = a1[4];
  return sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0x1E, 5, (const char *)(v9 + 0x14), 0, v8, 0xFF, 0x226);
}

//----- (00031200) --------------------------------------------------------
T_TypeA2 *__fastcall sub_31200(T_TypeA2 *result)
{
  Q_A2_sub_2C830(result);
  result->b = (int)off_95E88;
  Q_A1_sub_2C8E4(&result->a1);
  return result;
}
// 95E88: using guessed type int (*off_95E88[5])();

//----- (0003121C) --------------------------------------------------------
int __fastcall sub_3121C(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95E74);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95E88;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95E88: using guessed type int (*off_95E88[5])();

//----- (00031268) --------------------------------------------------------
unsigned int __fastcall sub_31268(int a1, unsigned __int16 a2, int a3, int a4)
{
  const char *v6; // ecx
  T_TypeA1 *Wnd_sub_56DA8; // eax
  char v8; // bl
  int v9; // edx
  char *v10; // edi
  const char *v11; // esi
  int v12; // ebx
  char v13; // al
  char v14; // al
  const char *v15; // esi
  int v16; // edx
  char *v17; // edi
  int v18; // ecx
  char v19; // al
  char v20; // al
  int v21; // eax
  int v22; // ebx
  int v23; // esi
  char v24; // ah
  int v25; // ebp
  char *v26; // edi
  char *v27; // esi
  char v28; // al
  char v29; // al
  const char *v30; // esi
  char *v31; // edi
  char v32; // al
  char v33; // al
  char *v34; // edi
  char *v35; // esi
  char v36; // al
  char v37; // al
  const char *v38; // esi
  char *v39; // edi
  char v40; // al
  char v41; // al
  T_FileInfo v42; // [esp+0h] [ebp-144h] BYREF
  char fname[20]; // [esp+118h] [ebp-2Ch] BYREF
  int v44; // [esp+138h] [ebp-Ch]
  int v45[2]; // [esp+13Ch] [ebp-8h]

  LOWORD(v45[1]) = a2;
  v45[0] = a3;
  v44 = a4;
  if ( a2 < 3u )
  {
    if ( a2 != 1 )
    {
      return sub_2F424(a1, v45[1], v45[0], v44);
    }
    v6 = "savescr";
    if ( *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] == 2 )
    {
      *(_BYTE *)(a1 + 0xAF) = 1;
    }
    else if ( *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] == 4 )
    {
      v6 = "loadscr";
      *(_BYTE *)(a1 + 0xAF) = 0;
    }
    else
    {
      v6 = "tutscr";
      *(_BYTE *)(a1 + 0xAF) = 2;
    }
    Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "LOADLIST", 0);
    v8 = *(_BYTE *)(a1 + 0xAF);
    *(_DWORD *)(a1 + 0xAB) = Wnd_sub_56DA8;
    if ( v8 == 2 )
    {
      *(_WORD *)((char *)&Wnd_sub_56DA8[0xD].sendParam2 + 3) = 0x3C;
      sub_2F1C8(*(_DWORD *)(a1 + 0xAB), (int)sub_31158);
      sub_317D0(a1);
    }
    else
    {
      *(_WORD *)((char *)&Wnd_sub_56DA8[0xD].sendParam2 + 3) = 0x55;
      sub_2F1C8(*(_DWORD *)(a1 + 0xAB), (int)sub_30A90);
      sub_316A8(a1, (int)sub_30A90);
    }
    v9 = *(int *)((char *)v45 + 2);
    v10 = (char *)(a1 + 0x4F);
    v11 = v6;
    v12 = v45[0];
    do
    {
      v13 = *v11;
      *v10 = *v11;
      if ( !v13 )
      {
        break;
      }
      v14 = v11[1];
      v11 += 2;
      v10[1] = v14;
      v10 += 2;
    }
    while ( v14 );
    v15 = v6;
    v16 = v9 >> 0x10;
    v17 = (char *)(*(_DWORD *)(a1 + 0xAB) + 0x4F);
    v18 = v44;
    do
    {
      v19 = *v15;
      *v17 = *v15;
      if ( !v19 )
      {
        break;
      }
      v20 = v15[1];
      v15 += 2;
      v17[1] = v20;
      v17 += 2;
    }
    while ( v20 );
    sub_2F424(a1, v16, v12, v18);
    return 0;
  }
  if ( a2 <= 3u )
  {
    if ( a3 >= 0x31 && a3 <= 0x39 )
    {
      v21 = 9;
      v22 = a3 - 0x30;
      if ( *(_BYTE *)(a1 + 0xAF) == 1 )
      {
        v21 = 0xA;
      }
      if ( v22 < v21 )
      {
        (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 8))();
        return 0xFFFFFFFF;
      }
    }
    return 0;
  }
  if ( a2 != 0x1C01 )
  {
    return sub_2F424(a1, v45[1], v45[0], v44);
  }
  v23 = sub_2ED14(*(_DWORD *)(a1 + 0xAB), v45[0]);
  sprintf(fname, "%02d.sav", *(_DWORD *)(v23 + 0x6C));
  Q_InitFileInfo_sub_1BB78(&v42);
  v24 = *(_BYTE *)(a1 + 0xAF);
  if ( v24 == 1 )
  {
    Q_SaveGam_sub_54048(fname);
    sub_56B60(&V_Type3_stru_10AE70, 3, 0, 0);
  }
  else if ( v24 )
  {
    v25 = 0xE0 * a3 + a1 + 0x9C0;
    v26 = fname;
    v27 = (char *)v25;
    do
    {
      v28 = *v27;
      *v26 = *v27;
      if ( !v28 )
      {
        break;
      }
      v29 = v27[1];
      v27 += 2;
      v26[1] = v29;
      v26 += 2;
    }
    while ( v29 );
    v30 = ".tsv";
    v31 = &fname[strlen(fname)];
    do
    {
      v32 = *v30;
      *v31 = *v30;
      if ( !v32 )
      {
        break;
      }
      v33 = v30[1];
      v30 += 2;
      v31[1] = v33;
      v31 += 2;
    }
    while ( v33 );
    v34 = fname;
    Q_LoadGam_sub_53FB0(fname);
    v35 = (char *)v25;
    sub_56B60(&V_Type3_stru_10AE70, 3, 0, 0);
    srand(0);
    dword_96BBC = *(_DWORD *)V_Type3_stru_10AE70.j;
    *(_DWORD *)V_Type3_stru_10AE70.j = 0x3F800000;
    do
    {
      v36 = *v35;
      *v34 = *v35;
      if ( !v36 )
      {
        break;
      }
      v37 = v35[1];
      v35 += 2;
      v34[1] = v37;
      v34 += 2;
    }
    while ( v37 );
    v38 = ".bin";
    v39 = &fname[strlen(fname)];
    do
    {
      v40 = *v38;
      *v39 = *v38;
      if ( !v40 )
      {
        break;
      }
      v41 = v38[1];
      v38 += 2;
      v39[1] = v41;
      v39 += 2;
    }
    while ( v41 );
    sub_59988(&V_Type3_stru_10AE70, fname, 0);
  }
  else if ( *(_DWORD *)(v23 + 8) != 0xFFFFFFFF )
  {
    Q_LoadGam_sub_53FB0(fname);
    *(_WORD *)&V_Type3_stru_10AE70.z2[0x22] = 1;
    *(_WORD *)V_Type3_stru_10AE70.z2 = 0;
    *(_WORD *)&V_Type3_stru_10AE70.z2[0x20] = 1;
    sub_56B60(&V_Type3_stru_10AE70, 1, 1, 0);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v42);
  return 0xFFFFFFFF;
}
// 96BBC: using guessed type int dword_96BBC;
// 31268: using guessed type char fname[20];

//----- (0003160C) --------------------------------------------------------
void __fastcall sub_3160C(int a1)
{
  char v2; // ah
  LONG v3; // edx
  char *v4; // eax
  char *sub_1CEA8; // [esp+0h] [ebp-18h]

  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x17);
  v2 = *(_BYTE *)(a1 + 0xAF);
  v3 = 0x10;
  if ( v2 == 1 )
  {
    v3 = 0x73;
    v4 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x18);
  }
  else
  {
    if ( v2 != 2 )
    {
      goto LABEL_6;
    }
    v4 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x19);
    v3 = 0;
  }
  sub_1CEA8 = v4;
LABEL_6:
  if ( v3 )
  {
    VFX_pane_wipe((PANE *)(a1 + 4), v3);
  }
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = *(_DWORD *)(a1 + 4);
  V_Type3_stru_10AE70.rect.x1 = *(_DWORD *)(a1 + 8);
  V_Type3_stru_10AE70.rect.y1 = *(_DWORD *)(a1 + 0xC);
  V_Type3_stru_10AE70.rect.x2 = *(_DWORD *)(a1 + 0x10);
  V_Type3_stru_10AE70.rect.y2 = *(_DWORD *)(a1 + 0x14);
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 4, sub_1CEA8, 3, 0xFFFFFFFF, 0xFF, 0);
  sub_2D218((_DWORD *)a1);
}

//----- (000316A8) --------------------------------------------------------
void __fastcall sub_316A8(int a1, int a2)
{
  int v3; // edi
  int v4; // esi
  unsigned __int16 v5; // dx
  T_FileInfo handle; // [esp+0h] [ebp-158h] BYREF
  char s[32]; // [esp+118h] [ebp-40h] BYREF
  int v8; // [esp+138h] [ebp-20h]
  int v9; // [esp+13Ch] [ebp-1Ch]

  v9 = a1;
  sub_2ED4C(*(_DWORD *)(a1 + 0xAB));
  v3 = 0;
  Q_InitFileInfo_sub_1BB78(&handle);
  v4 = a1 + 0xB0;
  do
  {
    v8 = v3 + 1;
    sprintf(s, "%02d.sav", v3 + 1);
    if ( access(s, 0) )
    {
      *(_DWORD *)(v4 + 8) = 0xFFFFFFFF;
    }
    else
    {
      Q_OpenFile_sub_1BBFC(&handle, s, 0x200, 0);
      Q_ReadFile_sub_1BF94(&handle, (void *)v4, 0x74u);
      dos_getftime(handle.fh, (unsigned __int16 *)(v4 + 0x70), (unsigned __int16 *)(v4 + 0x72));
    }
    *(_DWORD *)(v4 + 0x6C) = v8;
    sub_2EA8C(*(_DWORD *)(v9 + 0xAB), (const char *)v4, 0xFFFFFFFF, 0);
    v4 += 0x74;
    v5 = v3++;
    sub_2EC50(*(_DWORD *)(v9 + 0xAB), v5, *(_BYTE *)(v9 + 0xAF) == 1);
  }
  while ( v3 < 0x14 );
  Q_CloseFileAndDelete_sub_1BBC8(&handle);
}
// 316A8: using guessed type T_FileInfo handle;

//----- (000317D0) --------------------------------------------------------
int __fastcall sub_317D0(int a1)
{
  FILE *v1; // ebp
  int v2; // esi
  char *v3; // edi
  int v4; // eax
  int v6; // [esp+0h] [ebp-24h] BYREF
  int v7; // [esp+4h] [ebp-20h]
  int v8; // [esp+8h] [ebp-1Ch]

  v7 = a1;
  sub_2ED4C(*(_DWORD *)(a1 + 0xAB));
  v1 = Q_OpenFile_sub_1BB10("tutindex.txt", 0);
  fscanf(v1, "%d", &v6);
  if ( v6 > 7 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\loadwin.cpp", 0x1EA);
  }
  v2 = v7 + 0x9C0;
  v8 = 0;
  if ( v6 > 0 )
  {
    v3 = (char *)(v7 + 0x9D4);
    do
    {
      fscanf(v1, "%s", v2);
      Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v1, v3);
      sub_2EA8C(*(_DWORD *)(v7 + 0xAB), (const char *)v2, 0xFFFFFFFF, 0);
      v4 = v8 + 1;
      v3 += 0xE0;
      *(_DWORD *)(v2 + 0xDC) = v8 + 1;
      v2 += 0xE0;
      v8 = v4;
    }
    while ( v4 < v6 );
  }
  return fclose(v1);
}

//----- (000318A0) --------------------------------------------------------
int __fastcall sub_318A0(unsigned __int16 a1, unsigned __int8 a2)
{
  int v3; // esi
  unsigned int v4; // edx
  int v5; // edi
  _DWORD *v7; // eax
  int v8; // ebx

  v3 = *((unsigned __int16 *)dword_10032C + a1);
  if ( (unsigned __int16)v3 == 0xFFFF )
  {
    return 0;
  }
  v4 = dword_100328 + 4 * (unsigned __int16)word_100330;
  v5 = a2;
  v7 = (_DWORD *)(dword_100328 + 4 * v3);
  v8 = (v5 << 0x10) + a1;
  if ( (unsigned int)v7 >= v4 )
  {
    return 0;
  }
  while ( v8 != *v7 )
  {
    if ( (unsigned int)++v7 >= v4 )
    {
      return 0;
    }
  }
  return (unsigned __int16)(((int)v7 - dword_100328) / 4) + 0x102;
}
// 100328: using guessed type int dword_100328;
// 100330: using guessed type __int16 word_100330;

//----- (00031934) --------------------------------------------------------
unsigned __int8 __fastcall sub_31934(int a1)
{
  char v1; // ch
  unsigned __int16 v2; // si
  char v3; // dh
  char v4; // al
  int v5; // edx
  unsigned __int8 result; // al
  char v7; // ch
  int v8; // ebx

  v1 = byte_100335;
  v2 = a1;
  v3 = (a1 << byte_100335) | *(_BYTE *)dword_100324++;
  *(_BYTE *)(dword_100324 - 1) = v3;
  v4 = byte_100334;
  if ( (unsigned __int16)(dword_100324 - dword_100338) == 0x100 )
  {
    *(_BYTE *)dword_100338 = 0xFF;
    dword_100338 = dword_100324++;
  }
  v5 = (int)v2 >> (8 - v1);
  result = v4 - (8 - v1);
  v7 = 0;
  v8 = dword_100324;
  *(_BYTE *)dword_100324 = v5;
  if ( result >= 8u )
  {
    dword_100324 = v8 + 1;
    if ( (unsigned __int16)(v8 + 1 - dword_100338) == 0x100 )
    {
      *(_BYTE *)dword_100338 = 0xFF;
      dword_100338 = dword_100324++;
    }
    if ( result > 8u )
    {
      v7 = result - 8;
      *(_BYTE *)dword_100324 = BYTE1(v5);
    }
  }
  else
  {
    v7 = result;
  }
  byte_100335 = v7;
  return result;
}
// 100324: using guessed type int dword_100324;
// 100334: using guessed type char byte_100334;
// 100335: using guessed type char byte_100335;
// 100338: using guessed type int dword_100338;

//----- (00031A34) --------------------------------------------------------
int __fastcall sub_31A34(unsigned __int16 a1, char a2)
{
  int v2; // ecx
  unsigned __int16 v3; // bx
  _WORD *v4; // edx
  int result; // eax

  v2 = dword_100328;
  v3 = word_100330;
  *(_BYTE *)(dword_100328 + 4 * (unsigned __int16)word_100330 + 2) = a2;
  *(_WORD *)(v2 + 4 * v3) = a1;
  v4 = (char *)dword_10032C + 2 * a1;
  if ( (unsigned __int16)*v4 == 0xFFFF )
  {
    *v4 = word_100330;
  }
  sub_31934(a1);
  result = (unsigned __int16)++word_100330 + 0x102;
  if ( result > (unsigned __int16)word_100332 )
  {
    if ( result <= 0x1000 )
    {
      BYTE1(result) = byte_100334 + 1;
      word_100332 *= 2;
      ++byte_100334;
    }
    else
    {
      sub_31934(0x100);
      byte_100334 = 9;
      word_100332 = 0x200;
      word_100330 = 0;
      return (int)memset(dword_10032C, 0xFF, 0x2008u);
    }
  }
  return result;
}
// 100328: using guessed type int dword_100328;
// 100330: using guessed type __int16 word_100330;
// 100332: using guessed type __int16 word_100332;
// 100334: using guessed type char byte_100334;

//----- (00031B08) --------------------------------------------------------
int sub_31B08()
{
  int v0; // ebx
  int v1; // esi
  unsigned __int16 v2; // ax
  UBYTE v3; // cl
  int v4; // ebx
  int v5; // eax
  char v6; // dh
  int result; // eax
  _BYTE *v8; // ebx
  int v9; // ebx
  char v10; // bl

  v0 = dword_100324;
  byte_100334 = 9;
  word_100332 = 0x200;
  *(_BYTE *)dword_100324 = 8;
  byte_100335 = 0;
  dword_100338 = v0 + 1;
  dword_100324 = v0 + 2;
  sub_31934(0x100);
  v1 = 1;
  v2 = *V_Window1.buffer;
  do
  {
    v3 = V_Window1.buffer[v1];
    v4 = v2;
    v2 = sub_318A0(v2, v3);
    if ( !v2 )
    {
      sub_31A34(v4, v3);
      v2 = v3;
    }
    ++v1;
  }
  while ( v1 < 0x4B000 );
  sub_31934(v2);
  sub_31934(0x101);
  LOWORD(v5) = dword_100324;
  LOWORD(v4) = dword_100338;
  v6 = byte_100335;
  result = v5 - v4;
  if ( byte_100335 )
  {
    *(_BYTE *)dword_100338 = result;
    v8 = (_BYTE *)(dword_100324 + 1);
    dword_100324 = (int)v8;
    *v8 = 0;
    v9 = (int)(v8 + 1);
  }
  else
  {
    v10 = result;
    if ( (unsigned __int16)result == 1 )
    {
      result = dword_100338;
      *(_BYTE *)dword_100338 = byte_100335;
      return result;
    }
    result = dword_100338;
    *(_BYTE *)dword_100338 = v10 - 1;
    v9 = dword_100324 + 1;
    *(_BYTE *)dword_100324 = v6;
  }
  dword_100324 = v9;
  return result;
}
// 31BC0: variable 'v5' is possibly undefined
// 100324: using guessed type int dword_100324;
// 100332: using guessed type __int16 word_100332;
// 100334: using guessed type char byte_100334;
// 100335: using guessed type char byte_100335;
// 100338: using guessed type int dword_100338;

//----- (00031C18) --------------------------------------------------------
int __fastcall sub_31C18(int result, int a2)
{
  RGB *v2; // edi
  LONG v3; // esi
  int v4; // edi
  _BYTE *v5; // ebp
  int v6; // esi
  _BYTE *v7; // ebp
  int v8; // ebx
  _WORD *v9; // ebp
  int v10; // ebp
  void *v11; // ecx
  int v12; // esi
  RGB *v13; // [esp-4h] [ebp-30h]
  int v14; // [esp-4h] [ebp-30h]
  char s[20]; // [esp+0h] [ebp-2Ch] BYREF
  RGB *triplet; // [esp+14h] [ebp-18h]

  if ( a2 >= (int)&V_CobFiles.fnames[0x17][0x16] )
  {
    V_Window1.buffer = (UBYTE *)result;
    V_Window1.x_max = 0x27F;
    V_Window1.y_max = 0x1DF;
    V_Window1.shadow = 0;
    V_Window1.stencil = 0;
    triplet = (RGB *)(result + 0x4B000);
    VFX_window_read(&V_Window1, 0, 0, 0x27F, 0x1DF);
    dword_100308 = (int)triplet;
    v2 = triplet;
    v3 = 0;
    triplet += 0x100;
    do
    {
      v13 = v2++;
      VFX_DAC_read(v3++, v13);
    }
    while ( v3 < 0x100 );
    buf = triplet;
    memset(triplet, 0, (size_t)&loc_493DC + 4);
    dword_100328 = (int)triplet + (_DWORD)&loc_493DC + 4;
    word_100330 = 0;
    triplet = (RGB *)((char *)triplet + (_DWORD)&loc_493DC + 4 + 0x4000);
    dword_10032C = triplet;
    dword_100324 = (int)buf;
    memset(triplet, 0xFF, 0x2008u);
    v4 = dword_100324;
    qmemcpy((void *)dword_100324, "GIF87a", 4u);
    qmemcpy((void *)(v4 + 4), "7a", 2u);
    v5 = (_BYTE *)(dword_100324 + 6);
    *(_WORD *)(dword_100324 + 6) = 0x280;
    v5 += 2;
    *(_WORD *)v5 = 0x1E0;
    v5 += 2;
    *v5++ = 0x87;
    *v5++ = 0xFF;
    v6 = 0;
    *v5 = 0;
    v7 = v5 + 1;
    do
    {
      ++v7;
      v8 = 0xFF * *(unsigned __int8 *)(v6 + dword_100308) / 0x3F;
      ++v6;
      v7[0xFFFFFFFF] = v8;
    }
    while ( v6 < 0x300 );
    *v7 = 0x2C;
    v9 = v7 + 1;
    *v9++ = 0;
    *v9++ = 0;
    *v9++ = 0x280;
    *v9++ = 0x1E0;
    *(_BYTE *)v9 = 7;
    dword_100324 = (int)v9 + 1;
    sub_31B08();
    v14 = dword_10033C;
    v10 = dword_100324;
    *(_BYTE *)dword_100324 = 0x3B;
    ++v10;
    v11 = buf;
    dword_100324 = v10;
    sprintf(s, "scr%03d.gif", v14);
    v12 = open(s, 0x262, 0x1C0);
    write(v12, buf, v10 - (_DWORD)v11);
    result = close(v12);
    dword_100324 = 0;
    dword_10032C = 0;
    dword_100328 = 0;
    buf = 0;
    V_Window1.buffer = 0;
    dword_100308 = 0;
    ++dword_10033C;
  }
  return result;
}
// 100308: using guessed type int dword_100308;
// 100324: using guessed type int dword_100324;
// 100328: using guessed type int dword_100328;
// 100330: using guessed type __int16 word_100330;
// 10033C: using guessed type int dword_10033C;

//----- (00031E60) --------------------------------------------------------
void __fastcall Q_AppendRomanNum_sub_31E60(char *a1, int number)
{
  int v3; // edx
  const char *v4; // esi
  char *v5; // edi
  char v6; // al
  char v7; // al
  char *v8; // edi
  char *v9; // esi
  char *v10; // edi
  char v11; // al
  char v12; // al
  char *v13; // esi
  char *v14; // edi
  char v15; // al
  char v16; // al
  char *v17; // esi
  char *v18; // edi
  char v19; // al
  char v20; // al
  char *v21; // [esp-4h] [ebp-8h]

  if ( number < 0 || !a1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\name.cpp", 0x29);
  }
  v3 = 1000;
  if ( number > 1000 )
  {
    v8 = a1;
    do
    {
      if ( v3 >= 4000 )
      {
        break;
      }
      v4 = "M";
      v21 = v8;
      v5 = &v8[strlen(v8)];
      do
      {
        v6 = *v4;
        *v5 = *v4;
        if ( !v6 )
        {
          break;
        }
        v7 = v4[1];
        v4 += 2;
        v5[1] = v7;
        v5 += 2;
      }
      while ( v7 );
      v8 = v21;
      v3 += 1000;
    }
    while ( v3 < number );
  }
  v9 = V_Romans100[number / 100 % 10];
  v10 = &a1[strlen(a1)];
  do
  {
    v11 = *v9;
    *v10 = *v9;
    if ( !v11 )
    {
      break;
    }
    v12 = v9[1];
    v9 += 2;
    v10[1] = v12;
    v10 += 2;
  }
  while ( v12 );
  v13 = V_Romans10[number / 10 % 10];
  v14 = &a1[strlen(a1)];
  do
  {
    v15 = *v13;
    *v14 = *v13;
    if ( !v15 )
    {
      break;
    }
    v16 = v13[1];
    v13 += 2;
    v14[1] = v16;
    v14 += 2;
  }
  while ( v16 );
  v17 = V_Romans1[number % 10];
  v18 = &a1[strlen(a1)];
  do
  {
    v19 = *v17;
    *v18 = *v17;
    if ( !v19 )
    {
      break;
    }
    v20 = v17[1];
    v17 += 2;
    v18[1] = v20;
    v18 += 2;
  }
  while ( v20 );
}

//----- (00031FB0) --------------------------------------------------------
int __fastcall sub_31FB0(_DWORD *a1, const char *a2, int a3, int a4)
{
  unsigned __int8 v5; // dl
  int v7; // [esp-4h] [ebp-10h]

  v5 = 4 * V_Game.races[byte_104BEA].Unknown_02 + 0x13;
  if ( a4 == 0xFFFFFFFF )
  {
    v5 = 0xF3;
  }
  v7 = a1[3] - a1[1] - 0x10;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = *a1;
  V_Type3_stru_10AE70.rect.x1 = a1[1];
  V_Type3_stru_10AE70.rect.y1 = a1[2];
  V_Type3_stru_10AE70.rect.x2 = a1[3];
  V_Type3_stru_10AE70.rect.y2 = a1[4];
  return sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 8, 3, a2, 0, v5, 0xFF, v7);
}

//----- (0003201C) --------------------------------------------------------
void __fastcall __spoils<> Q_A7_sub_3201C(P_TypeA7 a1)
{
  Q_A2_sub_2C830(&a1->a2);
  a1->a2.b = (int)off_95F1C;
  Q_A7_sub_3207C(a1);
}
// 95F1C: using guessed type int (*off_95F1C[5])();

//----- (00032038) --------------------------------------------------------
int __fastcall sub_32038(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95ED8);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95F1C;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95F1C: using guessed type int (*off_95F1C[5])();

//----- (0003207C) --------------------------------------------------------
void __fastcall __spoils<> Q_A7_sub_3207C(P_TypeA7 result)
{
  result->b = 0;
  result->c = 0;
  result->d = 0;
  result->f = 0xFFFF;
  result->g = 0xFFFF;
  result->h = 0xFFFF;
}

//----- (000320B8) --------------------------------------------------------
unsigned int __fastcall sub_320B8(int a1, __int16 a2, int a3, int a4)
{
  int v5; // edi
  T_TypeA1 *v6; // eax
  T_TypeA1 *v7; // eax
  T_TypeA1 *v8; // eax
  char Unknown_1E9; // bl
  int v10; // eax
  T_Race *v11; // eax
  __int16 v12; // ax
  __int16 v13; // ax
  int v15; // edx
  char v16[32]; // [esp+0h] [ebp-44h] BYREF
  char v17[16]; // [esp+20h] [ebp-24h] BYREF
  int v18; // [esp+30h] [ebp-14h]
  int v19; // [esp+34h] [ebp-10h]
  int v20; // [esp+38h] [ebp-Ch]
  int v21; // [esp+3Ch] [ebp-8h]
  __int16 v22; // [esp+40h] [ebp-4h]
  _BYTE savedregs[12]; // [esp+44h] [ebp+0h]
  void *retaddr; // [esp+50h] [ebp+Ch]

  v22 = a2;
  v5 = a3;
  v21 = a4;
  v18 = byte_104BEA;
  v20 = (unsigned __int8)byte_968DD;
  if ( (unsigned __int16)a2 < 4u )
  {
    if ( !a2 )
    {
      return sub_2F424(a1, *(__int16 *)&savedregs[4], v5, v21);
    }
    if ( (unsigned __int16)a2 <= 1u )
    {
      if ( !*(_DWORD *)(a1 + 0xAB) )
      {
        a3 = 0xD;
        a4 = 0;
        v6 = sub_56E18(&V_Type3_stru_10AE70, "PLAYERDIP", 0xD, 0);
        *(_DWORD *)(a1 + 0xAB) = v6;
        if ( !v6 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x7B);
        }
      }
      *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0xAB) = 0;
      *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8C9) = 0x1D;
      sub_2F1C8(*(_DWORD *)(a1 + 0xAB), (int)sub_31FB0);
      sub_2E9CC(*(_DWORD *)(a1 + 0xAB), 0);
      *(_BYTE *)(*(_DWORD *)(a1 + 0xAB) + 0xC6) = 0xF2;
      if ( !*(_DWORD *)(a1 + 0xAF) )
      {
        a3 = 0xD;
        a4 = 0;
        v7 = sub_56E18(&V_Type3_stru_10AE70, "ALIENDIP", 0xD, 0);
        *(_DWORD *)(a1 + 0xAF) = v7;
        if ( !v7 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x88);
        }
      }
      if ( !*(_DWORD *)(a1 + 0xB3) )
      {
        a3 = 0xD;
        a4 = 0;
        v8 = sub_56E18(&V_Type3_stru_10AE70, "COSMOSWnd", 0xD, 0);
        *(_DWORD *)(a1 + 0xB3) = v8;
        if ( !v8 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x8F);
        }
      }
      sub_32658(a1);
      sub_32E84(a1, 0, a3, a4);
      *(_WORD *)(*(_DWORD *)(a1 + 0xAF) + 0xB1) = 4 * V_Game.races[(unsigned __int8)byte_968DD].Unknown_02 + 0x13;
      memset(byte_101DC4, 0, 0xFu);
      Unknown_1E9 = V_Game.races[v20].Unknown_1E9;
      v10 = v18;
      *(_DWORD *)(a1 + 0xB7) = 0;
      v11 = &V_Game.races[v10];
      if ( Unknown_1E9 == 0xE )
      {
        v13 = sub_44238(
                (int)v11,
                (unsigned __int8)byte_968DD,
                v17,
                *((_WORD *)&dword_96840 + *(__int16 *)(a1 + 0xBF) + 1));
        sub_32A48(a1, (int)v17, v13, 0xFFFFFFFF, 0xFFFFFFFF);
        sub_32C14(a1, 0x1D);
      }
      else
      {
        v19 = Unknown_1E9;
        *(_DWORD *)(a1 + 0xB7) = 0xFFFFFFFF;
        v12 = sub_44A2C(v11, (__int16)retaddr, Unknown_1E9, v16);
        sub_32B44(a1, (int)v16, v12);
        sub_32BDC(a1, v19);
      }
      return sub_2F424(a1, *(__int16 *)&savedregs[4], v5, v21);
    }
    if ( a2 != 2 )
    {
      return sub_2F424(a1, *(__int16 *)&savedregs[4], v5, v21);
    }
    sub_2D258(a1, *(__int16 *)&savedregs[4]);
    return 0;
  }
  if ( (unsigned __int16)a2 <= 5u )
  {
    if ( a3 >= 0xAE && a3 <= 0x147 && a4 >= 0x145 && a4 <= 0x1D8 )
    {
      Q_StartSample_sub_4FB90(&V_SoundSystem, 0);
      sub_32714(a1, a3, a4);
      return 0xFFFFFFFF;
    }
    return 0;
  }
  if ( (unsigned __int16)a2 < 0xCu )
  {
    return sub_2F424(a1, *(__int16 *)&savedregs[4], v5, v21);
  }
  if ( (unsigned __int16)a2 <= 0xCu )
  {
    if ( a3 < 0xAE || a3 > 0x147 || a4 < 0x145 || a4 > 0x1D8 )
    {
      return sub_2F424(a1, *(__int16 *)&savedregs[4], v5, v21);
    }
    sub_56B60(&V_Type3_stru_10AE70, 5, (int)"tinyrace", 0);
    return 0xFFFFFFFF;
  }
  else
  {
    if ( a2 != 0x1C01 )
    {
      return sub_2F424(a1, *(__int16 *)&savedregs[4], v5, v21);
    }
    v15 = sub_2ECA4(*(_DWORD *)(a1 + 0xAB), a3);
    sub_32800(a1, v15);
    if ( *(_DWORD *)(a1 + 0xB7) == 0xFFFFFFFF )
    {
      *(_DWORD *)(a1 + 0xB7) = 0;
    }
    return 0xFFFFFFFF;
  }
}
// 96840: using guessed type int dword_96840;
// 968DD: using guessed type char byte_968DD;

//----- (00032414) --------------------------------------------------------
void __fastcall sub_32414(int a1)
{
  T_TypeA1 *Wnd_sub_56DA8; // eax
  __int16 i; // di
  void *v3; // eax
  __int16 v4; // bx
  __int16 v5; // ax
  __int16 v6; // dx
  LONG v7; // esi
  void *ShapeTable_sub_1B084; // eax
  void *v9; // eax
  char *sub_1CEA8; // eax
  LONG v11; // [esp-1Ch] [ebp-50h]
  LONG v12; // [esp-8h] [ebp-3Ch]
  PANE pane; // [esp+0h] [ebp-34h] BYREF
  _DWORD *v14; // [esp+14h] [ebp-20h]
  LONG v15; // [esp+18h] [ebp-1Ch]
  int v16; // [esp+1Ch] [ebp-18h]

  v14 = (_DWORD *)a1;
  pane = V_Type6_stru_D8654.pane;
  if ( *(_WORD *)(a1 + 0xC1) )
  {
    pane.x0 = 0xAE;
    pane.y0 = 0x145;
    pane.x1 = 0x147;
    pane.y1 = 0x1D8;
    VFX_pane_wipe(&pane, 0xF2);
    sub_552CC(&V_Type3_stru_10AE70, &pane);
    Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "INTELSCREEN", 0);
    LOWORD(Wnd_sub_56DA8) = word_FFEF2;
    v16 = (int)Wnd_sub_56DA8;
    for ( i = 0; i < *(__int16 *)((char *)v14 + 0xC1); ++i )
    {
      v4 = *((_WORD *)&dword_96840 + i + 1);
      v5 = word_9682E[i];
      v6 = word_96838[i];
      v7 = v5;
      v11 = v5;
      v15 = v6;
      ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                               (unsigned int)&V_Type3_stru_10AE70.t13,
                               (unsigned __int16)word_FFEA0[v4]);
      VFX_shape_transform(&V_Type6_stru_D8654.pane, ShapeTable_sub_1B084, 0, v11, v6, V_BigBuffer, 0, 0x8000, 0x8000, 0);
      v12 = v15;
      if ( i == *(_WORD *)((char *)v14 + 0xBF) )
      {
        v9 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v16);
        sub_53EB8(&V_Type6_stru_D8654.pane, v9, 4, v7, v12, v4);
      }
      else
      {
        v3 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v16);
        sub_53EB8(&V_Type6_stru_D8654.pane, v3, 3, v7, v12, v4);
      }
    }
  }
  pane.x0 = 7;
  pane.y0 = 0x145;
  pane.x1 = 0xA5;
  pane.y1 = 0x163;
  VFX_pane_wipe(&pane, 0xF2);
  sub_552CC(&V_Type3_stru_10AE70, &pane);
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1A);// 26: "Selected System"
  V_Type3_stru_10AE70.pane = pane;
  sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 2, 2, sub_1CEA8, 0, 0xFFFFFFFF, 0xFF, 0);
  *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = pane;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0xA, 0xD, (const char *)V_Game.h1 + 0x1C, 0, 0xFFFFFFFF, 0xFF, 0);
  if ( *(_WORD *)((char *)v14 + 0x6B) )
  {
    sub_2D218(v14);
  }
}
// 9682E: using guessed type __int16 word_9682E[5];
// 96838: using guessed type __int16 word_96838[4];
// 96840: using guessed type int dword_96840;
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEA0: using guessed type __int16 word_FFEA0[7];

//----- (00032658) --------------------------------------------------------
void *__fastcall sub_32658(int a1)
{
  void *result; // eax
  WORD i; // dx
  int v4; // ebx

  *(_WORD *)(a1 + 0xC1) = 0;
  *(_WORD *)(a1 + 0xBF) = 0;
  result = memset((char *)&dword_96840 + 2, 0xFFFFFFFF, 0xAu);
  for ( i = 0; i < V_Game.racesNum; ++i )
  {
    result = (void *)i;
    if ( i != byte_104BEA
      && i != (unsigned __int8)byte_968DD
      && *(_DWORD *)V_Game.races[i].z != 0xFFFFFFFF
      && V_Game.races[byte_104BEA].Unknown_1C0[i] )
    {
      if ( V_Game.races[(unsigned __int8)byte_968DD].Unknown_1C0[i] )
      {
        LOWORD(result) = *(_WORD *)(a1 + 0xC1);
        v4 = (__int16)result;
        result = (char *)result + 1;
        *(_WORD *)(a1 + 0xC1) = (_WORD)result;
        *((_WORD *)&dword_96840 + v4 + 1) = i;
      }
    }
  }
  return result;
}
// 96840: using guessed type int dword_96840;
// 968DD: using guessed type char byte_968DD;

//----- (00032714) --------------------------------------------------------
int __fastcall sub_32714(int a1, int a2, __int16 a3)
{
  __int16 v5; // dx
  int result; // eax
  __int16 v7; // cx
  __int16 v8; // bx
  int v9; // edx
  __int16 v10; // ax
  char v11[16]; // [esp+0h] [ebp-20h] BYREF
  int v12; // [esp+10h] [ebp-10h]

  v12 = a2;
  v5 = *(_WORD *)(a1 + 0xC1);
  result = 0;
  if ( v5 > 0 )
  {
    do
    {
      v7 = v12 - word_9682E[(__int16)result];
      v8 = a3 - word_96838[(__int16)result];
      if ( v7 < 0x16 && v7 > (int)0xFFFFFFEA && v8 < 0x16 && v8 > (int)0xFFFFFFEA )
      {
        break;
      }
      ++result;
    }
    while ( (__int16)result < *(__int16 *)(a1 + 0xC1) );
  }
  if ( (__int16)result < *(__int16 *)(a1 + 0xC1) && (_WORD)result != *(_WORD *)(a1 + 0xBF) )
  {
    v9 = *(_DWORD *)(a1 + 0xB7);
    *(_WORD *)(a1 + 0xBF) = result;
    if ( !v9 )
    {
      v10 = sub_44238(
              (int)&V_Game.races[byte_104BEA],
              (unsigned __int8)byte_968DD,
              v11,
              *((_WORD *)&dword_96840 + *(__int16 *)(a1 + 0xBF) + 1));
      sub_32A48(a1, (int)v11, v10, 0, 0xFFFFFFFF);
    }
    return (*(int (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
  }
  return result;
}
// 9682E: using guessed type __int16 word_9682E[5];
// 96838: using guessed type __int16 word_96838[4];
// 96840: using guessed type int dword_96840;
// 968DD: using guessed type char byte_968DD;

//----- (00032800) --------------------------------------------------------
int __fastcall sub_32800(int a1, int a2)
{
  int v3; // ebx
  T_Race *v4; // edi
  __int16 v6; // ax
  char v7; // bl
  char v8; // cl
  __int16 v9; // ax
  char v10[16]; // [esp+0h] [ebp-30h] BYREF
  char v11[16]; // [esp+10h] [ebp-20h] BYREF
  int h1; // [esp+20h] [ebp-10h]
  int v13; // [esp+24h] [ebp-Ch]
  int v14; // [esp+28h] [ebp-8h]
  T_Race *v15; // [esp+2Ch] [ebp-4h]

  v14 = byte_104BEA;
  v3 = (unsigned __int8)byte_968DD;
  v15 = &V_Game.races[byte_104BEA];
  v4 = &V_Game.races[v3];
  if ( *(_DWORD *)(a1 + 0xB7) != 0xFFFFFFFF )
  {
    v7 = a2;
    h1 = 0;
    if ( (_BYTE)a2 == 0xE )
    {
      return sub_56B60(&V_Type3_stru_10AE70, 3, 0, 0);
    }
    byte_101DC4[a2] = 1;
    if ( (unsigned __int8)a2 < 9u )
    {
      if ( (_BYTE)a2 != 7 )
      {
        goto LABEL_14;
      }
    }
    else if ( (unsigned __int8)a2 > 0xBu )
    {
      if ( (_BYTE)a2 == 0xC )
      {
        h1 = (int)V_Game.h1;
      }
      goto LABEL_14;
    }
    h1 = *((__int16 *)&dword_96840 + *(__int16 *)(a1 + 0xBF) + 1);
LABEL_14:
    v13 = (char)a2;
    v8 = sub_44BCC((int)v4, (__int16 *)byte_104BEA, a2, h1, 0);
    sub_32C14(a1, v8);
    sub_450B0(&v15->Unknown_00, (unsigned __int8)byte_968DD, v7, v8, h1, 0);
    sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(*(_DWORD *)(a1 + 0xB3) + 0x41), 0xD, 0, 0);
    v9 = sub_44238((int)v15, (unsigned __int8)byte_968DD, v11, *((_WORD *)&dword_96840 + *(__int16 *)(a1 + 0xBF) + 1));
    return sub_32A48(a1, (int)v11, v9, 0xFFFFFFFF, 0xFFFFFFFF);
  }
  if ( (_BYTE)a2 == 1 )
  {
    V_Game.h1 = (char *)V_Game.races[(unsigned __int8)byte_968DD].Unknown_1EA;
    return sub_56B60(&V_Type3_stru_10AE70, 1, 0x10, 0);
  }
  else
  {
    sub_450B0(&V_Game.races[v3].Unknown_00, v14, v4->Unknown_1E9, a2, v4->Unknown_1EA, 0);
    sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(*(_DWORD *)(a1 + 0xB3) + 0x41), 0xD, 0, 0);
    v4->Unknown_1E9 = 0xE;
    v6 = sub_44238((int)v15, (unsigned __int8)byte_968DD, v10, *((_WORD *)&dword_96840 + *(__int16 *)(a1 + 0xBF) + 1));
    sub_32A48(a1, (int)v10, v6, 0xFFFFFFFF, 0xFFFFFFFF);
    return sub_32BDC(a1, 0xE);
  }
}
// 96840: using guessed type int dword_96840;
// 968DD: using guessed type char byte_968DD;

//----- (00032A1C) --------------------------------------------------------
__int64 __fastcall sub_32A1C(int a1)
{
  if ( !*(_DWORD *)(a1 + 0xB7) )
  {
    sub_32A48(a1, 0, 0, 0, 0);
  }
  return (unsigned int)(*(int (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
}

//----- (00032A48) --------------------------------------------------------
__int64 __fastcall sub_32A48(int a1, int a2, __int16 a3, int a4, int a5)
{
  int v6; // eax
  __int16 v7; // si
  unsigned __int16 v8; // dx
  int v9; // edx
  char *v10; // eax
  unsigned __int16 v11; // ax
  int v13; // [esp+0h] [ebp-18h]
  unsigned __int16 v14; // [esp+8h] [ebp-10h]

  word_103F94 = 0;
  if ( a5 )
  {
    qmemcpy(byte_100340, (const void *)a2, 0xCu);
    qmemcpy(&byte_100340[0xC], (const void *)(a2 + 0xC), 3u);
    word_100350 = a3;
  }
  v6 = *(_DWORD *)(a1 + 0xAB);
  v7 = 0;
  v8 = *(_WORD *)(v6 + 0x8CD);
  sub_2ED4C(v6);
  v14 = v8;
  if ( word_100350 > 0 )
  {
    do
    {
      v9 = byte_100340[v7];
      if ( !byte_101DC4[v9] )
      {
        v10 = sub_32C48(a1, v9, 0xFFFFFFFF, 0xFFFFFFFF);
        v13 = *(_DWORD *)(a1 + 0xAB);
        v11 = sub_2EA8C(v13, v10, 0xFFFFFFFF, 0);
        sub_2EC50(*(_DWORD *)(a1 + 0xAB), v11, byte_100340[v7]);
      }
      ++v7;
    }
    while ( v7 < word_100350 );
  }
  if ( !a4 )
  {
    sub_2ECDC(*(_DWORD *)(a1 + 0xAB), v14);
  }
  return (unsigned int)(*(int (__cdecl **)(int))(*(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0xA7) + 0xC))(v13);
}
// 32B38: variable 'v13' is possibly undefined
// 100350: using guessed type __int16 word_100350;
// 103F94: using guessed type __int16 word_103F94;

//----- (00032B44) --------------------------------------------------------
__int64 __fastcall sub_32B44(int a1, int a2, __int16 a3)
{
  int v4; // eax
  int v5; // edi
  char *v6; // eax
  unsigned __int16 v7; // ax
  char *v9; // [esp+0h] [ebp-1Ch]

  v4 = *(_DWORD *)(a1 + 0xAB);
  v5 = 0;
  word_103F94 = 0;
  sub_2ED4C(v4);
  if ( a3 > 0 )
  {
    do
    {
      v9 = (char *)((__int16)v5 + a2);
      v6 = sub_32C48(a1, *v9, 0xFFFFFFFF, 0);
      v7 = sub_2EA8C(*(_DWORD *)(a1 + 0xAB), v6, 0xFFFFFFFF, 0);
      ++v5;
      sub_2EC50(*(_DWORD *)(a1 + 0xAB), v7, *v9);
    }
    while ( (__int16)v5 < a3 );
  }
  return (unsigned int)(*(int (**)(void))(*(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0xA7) + 0xC))();
}
// 103F94: using guessed type __int16 word_103F94;

//----- (00032BDC) --------------------------------------------------------
__int64 __fastcall sub_32BDC(int a1, char a2)
{
  *(_DWORD *)(*(_DWORD *)(a1 + 0xAF) + 0xAB) = sub_32C48(a1, a2, 0, 0xFFFFFFFF);
  return (unsigned int)(*(int (**)(void))(*(_DWORD *)(*(_DWORD *)(a1 + 0xAF) + 0xA7) + 0xC))();
}

//----- (00032C14) --------------------------------------------------------
__int64 __fastcall sub_32C14(int a1, char a2)
{
  *(_DWORD *)(*(_DWORD *)(a1 + 0xAF) + 0xAB) = sub_32C48(a1, a2, 0, 0);
  return (unsigned int)(*(int (**)(void))(*(_DWORD *)(*(_DWORD *)(a1 + 0xAF) + 0xA7) + 0xC))();
}

//----- (00032C48) --------------------------------------------------------
char *__fastcall sub_32C48(int a1, char a2, int a3, int a4)
{
  char *v5; // ebx
  char *v6; // ebx
  char *v7; // edx
  char *v8; // esi
  char v9; // al
  char *v10; // edi
  char v11; // al
  char v12; // al
  char *v15; // [esp+4h] [ebp-18h]

  if ( word_103F94 >= 0xF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x27B);
  }
  if ( a3 )
  {
    v15 = (char *)&unk_103454 + 0xB4 * word_103F94 + 0xB4;
  }
  else
  {
    v15 = (char *)&unk_103454;
  }
  if ( a4 )
  {
    if ( a3 )
    {
      v5 = (char *)&unk_100744 + 0x80 * a2;
    }
    else
    {
      v5 = (char *)&unk_101DD4 + 0x80 * a2;
    }
  }
  else
  {
    if ( a3 )
    {
      v6 = (char *)&unk_100EC4;
    }
    else
    {
      v6 = (char *)&unk_102554;
    }
    v5 = &v6[0x80 * a2];
  }
  v7 = v15;
  while ( *v5 )
  {
    v8 = 0;
    if ( *v5 == 0x25 )
    {
      v9 = v5[1];
      if ( (unsigned __int8)v9 < 0x73u )
      {
        if ( v9 == 0x6D )
        {
          if ( a3 )
          {
            goto LABEL_16;
          }
LABEL_18:
          v8 = V_SpecNames[V_Game.races[(unsigned __int8)byte_968DD].Unknown_01];
        }
      }
      else if ( (unsigned __int8)v9 <= 0x73u )
      {
        if ( a3 )
        {
          v8 = V_Game.h1 + 0x1C;
        }
        else
        {
          v8 = (char *)(V_Game.races[(unsigned __int8)byte_968DD].Unknown_1EA + 0x1C);
        }
      }
      else
      {
        if ( (unsigned __int8)v9 <= 0x74u )
        {
          if ( a3 == 0xFFFFFFFF && a4 == 0xFFFFFFFF )
          {
            v8 = V_SpecNames[V_Game.races[*((__int16 *)&dword_96840 + *(__int16 *)(a1 + 0xBF) + 1)].Unknown_01];
          }
          else
          {
            v8 = V_SpecNames[V_Game.races[V_Game.races[(unsigned __int8)byte_968DD].Unknown_1EA].Unknown_01];
          }
          goto LABEL_32;
        }
        if ( v9 == 0x79 )
        {
          if ( !a3 )
          {
LABEL_16:
            v8 = V_SpecNames[V_Game.races[byte_104BEA].Unknown_01];
            goto LABEL_32;
          }
          goto LABEL_18;
        }
      }
    }
LABEL_32:
    if ( v8 )
    {
      v10 = v7;
      do
      {
        v11 = *v8;
        *v10 = *v8;
        if ( !v11 )
        {
          break;
        }
        v12 = v8[1];
        v8 += 2;
        v10[1] = v12;
        v10 += 2;
      }
      while ( v12 );
      ++v5;
      v7 += strlen(v7);
    }
    else
    {
      *v7++ = *v5;
    }
    ++v5;
  }
  *v7 = 0;
  if ( a3 )
  {
    ++word_103F94;
  }
  return v15;
}
// 96840: using guessed type int dword_96840;
// 968DD: using guessed type char byte_968DD;
// 103F94: using guessed type __int16 word_103F94;

//----- (00032E84) --------------------------------------------------------
int __fastcall sub_32E84(int a1, int a2, int a3, int a4)
{
  const char *v5; // esi
  char *v6; // edi
  char v7; // al
  char v8; // al
  FILE *v9; // eax
  FILE *v10; // esi
  int result; // eax
  FILE *v12; // eax
  FILE *v13; // esi
  char s[16]; // [esp+0h] [ebp-34h] BYREF
  char v15[36]; // [esp+10h] [ebp-24h] BYREF

  if ( (unsigned __int8)byte_968DD >= 0x15u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x2D6);
  }
  if ( byte_104BEA >= 0x15u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x2D7);
  }
  sprintf(s, "RACE%02d.DIP", V_Game.races[(unsigned __int8)byte_968DD].Unknown_01);
  v5 = "PLAYER.DIP";
  v6 = v15;
  do
  {
    v7 = *v5;
    *v6 = *v5;
    if ( !v7 )
    {
      break;
    }
    v8 = v5[1];
    v5 += 2;
    v6[1] = v8;
    v6 += 2;
  }
  while ( v8 );
  if ( *(_WORD *)(a1 + 0xBB) != (unsigned __int8)byte_968DD )
  {
    v9 = Q_OpenFile_sub_1BB10(s, 0);
    v10 = v9;
    if ( !v9 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x2E4);
    }
    sub_32FD8(a1, v9, 0);
    fclose(v10);
    *(_WORD *)(a1 + 0xBB) = (unsigned __int8)byte_968DD;
  }
  result = *(__int16 *)(a1 + 0xBD);
  if ( result != byte_104BEA )
  {
    v12 = Q_OpenFile_sub_1BB10(v15, 0);
    v13 = v12;
    if ( !v12 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\negwnd.cpp", 0x2EF);
    }
    sub_32FD8(a1, v12, 0xFFFFFFFF);
    fclose(v13);
    result = byte_104BEA;
    *(_WORD *)(a1 + 0xBD) = byte_104BEA;
  }
  return result;
}
// 32E84: could not find valid save-restore pair for edi
// 968DD: using guessed type char byte_968DD;
// 32E84: using guessed type char var_24[36];

//----- (00032FD8) --------------------------------------------------------
int __fastcall sub_32FD8(int a1, FILE *a2, int a3)
{
  __int16 v3; // si
  char *v4; // eax
  __int16 i; // si
  int result; // eax
  char *v7; // eax
  char v8[220]; // [esp+0h] [ebp-DCh] BYREF

  while ( strncmp(v8, "ACTIONS", 7u) )
  {
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(a2, v8);
  }
  Q_HELPWIN_CPP_FgetsLine_sub_2FE58(a2, v8);
  v3 = 0;
  while ( strncmp(v8, "RESPONSES", 9u) )
  {
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(a2, v8);
    if ( a3 )
    {
      v4 = (char *)&unk_100744 + 0x80 * v3;
    }
    else
    {
      v4 = (char *)&unk_101DD4 + 0x80 * v3;
    }
    ++v3;
    strncpy(v4, v8, 0x7Fu);
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(a2, v8);
  }
  Q_HELPWIN_CPP_FgetsLine_sub_2FE58(a2, v8);
  for ( i = 0; ; ++i )
  {
    result = strncmp(v8, "END DIPLO", 9u);
    if ( !result )
    {
      break;
    }
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(a2, v8);
    if ( a3 )
    {
      v7 = (char *)&unk_100EC4 + 0x80 * i;
    }
    else
    {
      v7 = (char *)&unk_102554 + 0x80 * i;
    }
    strncpy(v7, v8, 0x7Fu);
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(a2, v8);
  }
  return result;
}

//----- (000330DC) --------------------------------------------------------
void __fastcall sub_330DC(T_Type5 *a1, unsigned __int8 *a2)
{
  T_TypeA1 *Wnd_sub_56DA8; // eax
  int v4; // esi
  const char *v5; // ecx
  void *ShapeTable_sub_1B084; // eax
  void *v7; // eax
  char *sub_1CEA8; // eax
  __int16 v9; // di
  LONG v10; // ecx
  void *v11; // eax
  __int16 v12; // edx^2
  char *v13; // eax
  __int16 v14; // di
  void *v15; // eax
  int v16; // eax
  char *v17; // eax
  __int16 v18; // di
  LONG v19; // ecx
  void *v20; // eax
  LONG v21; // esi
  __int16 v22; // di
  LONG v23; // ebx
  void *v24; // eax
  unsigned __int8 v25; // cl
  LONG v26; // [esp-8h] [ebp-60h]
  LONG v27; // [esp-8h] [ebp-60h]
  LONG v28; // [esp-8h] [ebp-60h]
  __int16 v29; // [esp-4h] [ebp-5Ch]
  __int16 v30; // [esp-4h] [ebp-5Ch]
  __int16 v31; // [esp-4h] [ebp-5Ch]
  int v32[2]; // [esp+0h] [ebp-58h] BYREF
  int v33; // [esp+8h] [ebp-50h]
  int v34; // [esp+Ch] [ebp-4Ch]
  int v35; // [esp+10h] [ebp-48h]
  unsigned __int8 *v36; // [esp+14h] [ebp-44h]
  int v37; // [esp+18h] [ebp-40h]
  T_Race *v38; // [esp+1Ch] [ebp-3Ch]
  int v39; // [esp+20h] [ebp-38h]
  unsigned __int8 *v40; // [esp+24h] [ebp-34h]
  LONG v41; // [esp+28h] [ebp-30h]
  int v42; // [esp+2Ch] [ebp-2Ch]
  LONG v43; // [esp+30h] [ebp-28h]
  LONG v44; // [esp+34h] [ebp-24h]
  LONG v45; // [esp+38h] [ebp-20h]
  LONG hotY; // [esp+3Ch] [ebp-1Ch]
  LONG v47; // [esp+40h] [ebp-18h]
  LONG v48; // [esp+44h] [ebp-14h]
  int v49; // [esp+48h] [ebp-10h]

  v36 = a2;
  Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "INTELSCREEN", 0);
  LOWORD(Wnd_sub_56DA8) = word_FFEF2;
  v49 = (int)Wnd_sub_56DA8;
  v40 = a2;
  v4 = *a2;
  v42 = *a2;
  v35 = 4 * V_Game.races[v4].Unknown_02 + 0x13;
  v32[1] = (__int16)v42;
  Q_WINMGR_CPP_sub_53E38((PANE *)a1, 3, 3, v42);
  v5 = V_SpecNames[V_Game.races[v4].Unknown_01];
  v34 = (__int16)v35;
  *(T_Type5 *)&V_Type3_stru_10AE70.z1cc[0xC] = *a1;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0x14, 5, v5, 0, v35, 0xFF, 0);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           (unsigned __int16)word_FFEA0[v42]);
  VFX_shape_transform((PANE *)a1, ShapeTable_sub_1B084, 0, 0x96, 0x1E, V_BigBuffer, 0, 0x8000, 0x8000, 0);
  v7 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v49);
  v45 = 0xC8;
  sub_53EB8((PANE *)a1, v7, 3, 0x96, 0x1E, v42);
  v32[0] = 0;
  sub_40224(a2, 0, v32);
  v43 = 0x14;
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x14);// 20: "Fleet"
  V_Type3_stru_10AE70.pane = (PANE)*a1;
  v9 = 0;
  sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0xC8, 5, sub_1CEA8, 0, v34, 0xFF, 0);
  while ( v9 < v32[0] )
  {
    v10 = v45;
    v29 = v42;
    v26 = v43;
    v11 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEF2);
    sub_53EB8((PANE *)a1, v11, 5, v10, v26, v29);
    v45 += 8;
    if ( v9 % 9 == 8 )
    {
      v45 = 0xC8;
      v43 += 8;
    }
    ++v9;
  }
  v12 = v35;
  v37 = sub_402E0(v40);
  v48 = 0x118;
  v41 = 0x14;
  v13 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x15);      // 21: "Colonies"
  V_Type3_stru_10AE70.pane = (PANE)*a1;
  v14 = 0;
  sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0x118, 5, v13, 0, v12, 0xFF, 0);
  while ( v14 < v37 )
  {
    v30 = v42;
    v27 = v41;
    v15 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEF2);
    sub_53EB8((PANE *)a1, v15, 6, v48, v27, v30);
    v48 += 8;
    if ( v14 % 9 == 8 )
    {
      v48 = 0x118;
      v41 += 8;
    }
    ++v14;
  }
  v16 = sub_40664(v40);
  v47 = 0x168;
  v39 = v16 >> 2;
  v44 = 0x14;
  v17 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x16);      // 22: "Discoveries"
  V_Type3_stru_10AE70.pane = (PANE)*a1;
  v18 = 0;
  sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0x168, 5, v17, 0, v35, 0xFF, 0);
  while ( v18 < v39 )
  {
    v19 = v47;
    v31 = v42;
    v28 = v44;
    v20 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEF2);
    sub_53EB8((PANE *)a1, v20, 7, v19, v28, v31);
    v47 += 8;
    if ( v18 % 9 == 8 )
    {
      v47 = 0x168;
      v44 += 8;
    }
    ++v18;
  }
  v21 = 0x1CC;
  v22 = 0;
  v38 = &V_Game.races[byte_104BEA];
  for ( hotY = 5; v22 < V_Game.racesNum; ++v22 )
  {
    if ( v22 != v42
      && v40[v22 + 0x1C0]
      && !*(_DWORD *)V_Game.races[v22].z
      && (v38->Unknown_1C0[v22] || v22 == byte_104BEA) )
    {
      v33 = v22;
      Q_WINMGR_CPP_sub_53E38((PANE *)a1, v21, hotY, v22);
      v25 = v40[v33 + 0x1C0];
      v23 = 0xFFFFFFFF;
      if ( v25 == 3 )
      {
        v23 = 9;
      }
      else if ( v25 == 2 )
      {
        v23 = 8;
      }
      if ( v23 != 0xFFFFFFFF )
      {
        v24 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEF2);
        VFX_shape_draw((PANE *)a1, v24, v23, v21, hotY);
      }
      v21 += 0x39;
      if ( v21 > 0x258 )
      {
        v21 = 0x1CC;
        hotY += 0x1B;
      }
    }
  }
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEA0: using guessed type __int16 word_FFEA0[7];

//----- (00033598) --------------------------------------------------------
void __fastcall __spoils<> sub_33598(P_TypeA4 a1)
{
  Q_A2_sub_2C830(&a1->a);
  a1->a.b = (int)off_95F04;
  sub_335F8(a1);
}
// 95F04: using guessed type int (*off_95F04[5])();

//----- (000335B4) --------------------------------------------------------
int __fastcall sub_335B4(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95EC4);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95F04;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95F04: using guessed type int (*off_95F04[5])();

//----- (000335F8) --------------------------------------------------------
void __fastcall __spoils<> sub_335F8(P_TypeA4 result)
{
  result->b = 0;
}

//----- (00033604) --------------------------------------------------------
unsigned int __fastcall sub_33604(int a1, __int16 a2, int a3, int a4)
{
  T_TypeA1 *Wnd_sub_56DA8; // eax

  if ( a2 != 1 )
  {
    return sub_2F424(a1, a2, a3, a4);
  }
  if ( !*(_DWORD *)(a1 + 0xAB) )
  {
    Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "INTELLIST", 0);
    *(_DWORD *)(a1 + 0xAB) = Wnd_sub_56DA8;
    *(_WORD *)((char *)&Wnd_sub_56DA8[0xD].sendParam2 + 3) = 0x3C;
    sub_2F1C8(*(_DWORD *)(a1 + 0xAB), (int)sub_330DC);
  }
  return sub_2F424(a1, 1, a3, a4);
}

//----- (00033674) --------------------------------------------------------
void __fastcall sub_33674(int a1)
{
  PANE *v1; // esi
  char *sub_1CEA8; // eax
  T_Race *races; // ebp
  T_Race *v4; // edi
  int v5; // esi
  unsigned __int16 v6; // ax
  __int16 v7; // [esp-Ch] [ebp-60h]
  char *v8; // [esp-4h] [ebp-58h]
  char s[52]; // [esp+0h] [ebp-54h] BYREF
  _DWORD *v10; // [esp+34h] [ebp-20h]
  int v11; // [esp+38h] [ebp-1Ch] BYREF
  int v12; // [esp+3Ch] [ebp-18h]

  v10 = (_DWORD *)a1;
  v1 = (PANE *)(a1 + 4);
  sub_552CC(&V_Type3_stru_10AE70, (PANE *)(a1 + 4));
  Q_WINMGR_CPP_sub_53E38(v1, 3, 3, byte_104BEA);
  v8 = V_SpecNames[V_Game.races[byte_104BEA].Unknown_01];
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1B);// 27: "%s Intelligence"
  sprintf(s, sub_1CEA8, v8);
  races = V_Game.races;
  v7 = 4 * V_Game.races[byte_104BEA].Unknown_02 + 0x13;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = v1->window;
  v1 = (PANE *)((char *)v1 + 4);
  V_Type3_stru_10AE70.rect.x1 = (int)v1->window;
  v1 = (PANE *)((char *)v1 + 4);
  V_Type3_stru_10AE70.rect.y1 = (int)v1->window;
  v1 = (PANE *)((char *)v1 + 4);
  V_Type3_stru_10AE70.rect.x2 = (int)v1->window;
  V_Type3_stru_10AE70.rect.y2 = v1->x0;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 9, s, 2, v7, 0xFF, 0);
  v4 = V_Game.races;
  v5 = 0;
  sub_2ED4C(*(_DWORD *)((char *)v10 + 0xAB));
  while ( v5 < V_Game.racesNum )
  {
    if ( v5 == byte_104BEA || V_Game.races[byte_104BEA].Unknown_1C0[v5] && !*(_DWORD *)V_Game.races[v5].z )
    {
      v11 = 0;
      sub_40224(&v4->Unknown_00, 0, &v11);
      v12 = sub_402E0(v4);
      v6 = sub_2EA8C(*(_DWORD *)((char *)v10 + 0xAB), (const char *)races, 0xFFFFFFFF, 0);
      sub_2EC50(*(_DWORD *)((char *)v10 + 0xAB), v6, -(v12 + v11));
    }
    ++v4;
    ++v5;
    ++races;
  }
  sub_2F1D8(*(_DWORD *)((char *)v10 + 0xAB), (int)sub_10A14);
  sub_2F1E0(*(_DWORD *)((char *)v10 + 0xAB));
  sub_2D218(v10);
}

//----- (00033830) --------------------------------------------------------
void __fastcall __spoils<> Q_A6_sub_33830(P_TypeA6 a1)
{
  Q_A2_sub_2FC50(&a1->a2);
  a1->a2.b = (int)off_95EEC;
}
// 95EEC: using guessed type int (*off_95EEC[5])();

//----- (00033840) --------------------------------------------------------
int __fastcall sub_33840(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95EB0);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95EEC;
    v5 = (void *)sub_2FC68(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95EEC: using guessed type int (*off_95EEC[5])();

//----- (00033884) --------------------------------------------------------
int __fastcall sub_33884(_DWORD *a1, int a2, int a3, int a4)
{
  char s[24]; // [esp+0h] [ebp-20h] BYREF

  sprintf(s, "abil%02d", (char)V_Game.races[byte_104BEA].Unknown_19D);
  return sub_2FCB0(a1, "help.txt", s);
}

//----- (000338DC) --------------------------------------------------------
unsigned int __fastcall sub_338DC(int a1, __int16 a2, int a3, int a4)
{
  int v5; // eax
  T_Race *v6; // esi
  int v7; // edx
  int v8; // eax
  char *sub_1CEA8; // eax
  char *v10; // esi
  char *v11; // edi
  char v12; // al
  char v13; // al
  char *v14; // esi
  char *v15; // edi
  char v16; // al
  char v17; // al
  int v18; // ebx
  char s[100]; // [esp+0h] [ebp-84h] BYREF
  char v21[32]; // [esp+64h] [ebp-20h] BYREF

  v5 = byte_104BEA;
  v6 = &V_Game.races[v5];
  if ( !a2 )
  {
    return sub_2FD68(a1, a2, a3, a4);
  }
  if ( (unsigned __int16)a2 <= 1u )
  {
    if ( sub_434E4((char *)&V_Game.races[v5], 0) == 0xFFFFFFFF )
    {
      *(_BYTE *)(a1 + 0xCCB) = 2;
    }
    else
    {
      sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(**(_DWORD **)(a1 + 0x67) + 0x41), 2, 0, 0);
      v7 = (unsigned __int16)word_968E8[(char)v6->Unknown_19D] - *(_DWORD *)v6->z2;
      if ( v7 == 1 )
      {
        v8 = 0x1C;
      }
      else
      {
        v8 = 0x1D;
      }
      sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v8);
      sprintf(s, *(const char **)(a1 + 0xCD0), v7, sub_1CEA8);
      v10 = s;
      v11 = *(char **)(a1 + 0xCD0);
      do
      {
        v12 = *v10;
        *v11 = *v10;
        if ( !v12 )
        {
          break;
        }
        v13 = v10[1];
        v10 += 2;
        v11[1] = v13;
        v11 += 2;
      }
      while ( v13 );
      v14 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1E);
      v15 = (char *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4) + 0x20);
      do
      {
        v16 = *v14;
        *v15 = *v14;
        if ( !v16 )
        {
          break;
        }
        v17 = v14[1];
        v14 += 2;
        v15[1] = v17;
        v15 += 2;
      }
      while ( v17 );
    }
    *(_DWORD *)(a1 + 0x35) = 0xFFFFFFFF;
    v18 = *(_DWORD *)(a1 + 0xA7);
    *(_DWORD *)(a1 + 0x39) = 0xFFFFFFFF;
    (*(void (__fastcall **)(int, _DWORD))(v18 + 0xC))(a1, 0);
    return 0;
  }
  else
  {
    if ( a2 != 0x32 || a3 != 1 )
    {
      return sub_2FD68(a1, a2, a3, a4);
    }
    sub_434E4((char *)&V_Game.races[v5], 1);
    sprintf(v21, "abres%02d", (char)v6->Unknown_19D);
    sub_2FCB0((_DWORD *)a1, "help.txt", v21);
    (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    return 0;
  }
}
// 968E8: using guessed type __int16 word_968E8[21];

//----- (00033A68) --------------------------------------------------------
void __fastcall sub_33A68(int a1)
{
  void *ShapeTable_sub_1B084; // eax
  void *v3; // eax
  LONG Unknown_02; // [esp-Ch] [ebp-18h]

  sub_30774(a1);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, byte_104BEA);
  VFX_shape_draw((PANE *)(a1 + 4), ShapeTable_sub_1B084, 0, 0xFA, 0x41);
  Unknown_02 = V_Game.races[byte_104BEA].Unknown_02;
  v3 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, 0x21);
  VFX_shape_draw((PANE *)(a1 + 4), v3, Unknown_02, 0xFA, 0x41);
}

//----- (00033AF0) --------------------------------------------------------
UWORD __fastcall Q_PLANET_CPP_sub_33AF0(P_Planet a1, unsigned __int16 size, unsigned __int16 type, int a4)
{
  int txtLoaded; // ebx
  int i; // eax
  UWORD v7; // bx
  T_PlanetSurface *surface; // ebx
  signed int v9; // ebp
  unsigned int v10; // eax
  int j; // ebx
  int v12; // ecx
  int v13; // edx
  char v14; // al
  int v15; // eax
  unsigned __int8 Unknown_66; // al
  UWORD word18; // bx
  int v18; // eax
  UWORD v19; // ax
  int v21; // [esp+0h] [ebp-10h]
  int v22; // [esp+4h] [ebp-Ch]
  int v23; // [esp+8h] [ebp-8h]

  if ( a1->a && size != a1->size )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x41);
  }
  txtLoaded = V_PlanetCfg.txtLoaded;
  a1->a = (void *)a4;
  if ( !txtLoaded )
  {
    Q_PLANET_CPP_LoadPlanItemTxt_sub_33D30();
  }
  if ( size >= 5u )
  {
    a1->size = 4;
  }
  else
  {
    a1->size = size;
  }
  a1->word18 = 0;
  for ( i = 0; i < 15; ++i )
  {
    v7 = *(&V_PlanetCfg.room2[a1->size].a0 + i) + a1->word18;
    a1->word18 = v7;
  }
  if ( v7 > 100u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x52);
  }
  a1->word1A = a1->word18 + 10;
  if ( type >= 11u )
  {
    a1->type = 2;
  }
  else
  {
    a1->type = type;
  }
  surface = &V_PlanetCfg.surfaces[a1->type];
  v9 = 0x7FFF * (unsigned int)surface->black / 100;
  v23 = 0x7FFF * (unsigned int)surface->red / 100 + v9;
  v21 = 0x7FFF * (unsigned int)surface->green / 100 + v23;
  v10 = 0x7FFF * (unsigned int)surface->blue / 100;
  j = 0;
  v12 = 0;
  v22 = v10 + v21;
  v13 = 0;
  while ( j < a1->word1A )
  {
    *((_BYTE *)a1->a + v13 + 1) = 0xFF;
    *(_WORD *)((char *)a1->a + v13 + 2) = 0;
    v14 = 1;
    if ( j < a1->word18 )
    {
      v15 = rand();
      if ( v15 >= v9 )
      {
        ++v12;
        if ( v15 >= v23 )
        {
          if ( v15 >= v21 )
          {
            if ( v15 >= v22 )
            {
              v14 = 1;
            }
            else
            {
              v14 = 4;
            }
          }
          else
          {
            v14 = 3;
          }
        }
        else
        {
          v14 = 2;
        }
      }
      else
      {
        v14 = 0;
      }
    }
    v13 += 4;
    ++j;
    *((_BYTE *)a1->a + v13 - 4) = v14;
  }
  a1->Unknown_66 = 0;
  Unknown_66 = a1->Unknown_66;
  a1->buildingProgress = Unknown_66;
  a1->z6 = Unknown_66;
  a1->word4C = Unknown_66;
  a1->word48 = Unknown_66;
  a1->word46 = Unknown_66;
  a1->production = Unknown_66;
  a1->word42 = Unknown_66;
  if ( !(rand() % 7) )
  {
    word18 = a1->word18;
    v18 = rand();
    *((_BYTE *)a1->a + 4 * (v18 % word18)) |= 8u;
    a1->Unknown_66 |= 2u;
  }
  a1->word52 = 0xFFFF;
  a1->buildingPlanetItemIndex = 0xFF;
  v19 = v12 / 3 + 5;
  a1->word55 = v19;
  a1->word4A = v19;
  a1->byte57 = 0xFF;
  sub_34E70(a1);
  a1->Unknown_5E = 0;
  return a1->word1A;
}

//----- (00033D30) --------------------------------------------------------
void __fastcall Q_PLANET_CPP_LoadPlanItemTxt_sub_33D30()
{
  FILE *fp; // esi
  MACRO_VFX_BOOL found; // edi
  int k; // ebp
  int planetType; // edi
  int color; // edx
  int v5; // ebp
  int i; // edi
  int v7; // edx
  int v8; // ebp
  int j; // edi
  int v10; // edx
  int m; // ebp
  int l; // edx
  int v13; // eax
  int v14; // ecx
  int n; // edx
  const char *v16; // ebx
  int len; // kr04_4
  char buf[196]; // [esp+0h] [ebp-ECh] BYREF
  int val1; // [esp+C8h] [ebp-24h] BYREF
  unsigned __int16 val2; // [esp+CCh] [ebp-20h] BYREF
  UWORD val3; // [esp+D0h] [ebp-1Ch] BYREF
  UBYTE val4; // [esp+D4h] [ebp-18h] BYREF
  UBYTE val5; // [esp+D8h] [ebp-14h] BYREF
  UWORD val6; // [esp+DCh] [ebp-10h] BYREF
  UBYTE val7; // [esp+E0h] [ebp-Ch] BYREF
  char *name; // [esp+E8h] [ebp-4h]

  fp = Q_OpenFile_sub_1BB10("planitem.txt", 0);
  if ( fp )
  {
    found = FALSE;
    do
    {
      fgets(buf, 195, fp);
      if ( buf[0] == '#' )
      {
        found = TRUE;
      }
    }
    while ( found == FALSE );
    k = 4;
    fscanf(fp, "%d", &val1);
    planetType = 0;
    V_PlanItem50 = val1;
    do
    {
      color = 4 * planetType;
      do
      {
        fscanf(fp, "%d", &val1);
        ++color;
        *(&V_PlanetCfg.room2[5].a0 + color) = val1;
      }
      while ( color != k );
      ++planetType;
      k += 4;
    }
    while ( planetType < 11 );
    v5 = 0xF;
    for ( i = 0; i < 5; ++i )
    {
      v7 = 0xF * i;
      do
      {
        fscanf(fp, "%d", &val1);
        *((_BYTE *)&V_PlanetCfg.txtLoaded + ++v7 + 3) = val1;
      }
      while ( v7 != v5 );
      v5 += 0xF;
    }
    v8 = 0xF;
    for ( j = 0; j < 5; ++j )
    {
      v10 = 0xF * j;
      do
      {
        fscanf(fp, "%d", &val1);
        ++v10;
        *(&V_PlanetCfg.room1[5].a0 + v10) = val1;
      }
      while ( v10 != v8 );
      v8 += 0xF;
    }
    fscanf(fp, "%d %d %d", &val1, &val2, &val3);
    if ( val1 != 39 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0xE1);
    }
    V_PlanetItems.num1 = val2;
    V_PlanetItems.num2 = val3;
    if ( val2 + val3 > 39 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0xE6);
    }
    m = 0;
    name = V_PlanetItems.item[0].name;
    do
    {
      v16 = name;
      fscanf(fp, "%s %d %d %d %d %d %d %d", name, &val1, &val2, &val3, &val4, &val5, &val6, &val7);
      l = 0;
      len = strlen(v16) + 1;
      v14 = len - 1;
      v13 = m * 0x28;
      if ( len - 1 > 0 )
      {
        do
        {
          if ( V_PlanetItems.item[0].name[v13] == '^' )
          {
            V_PlanetItems.item[0].name[v13] = ' ';
          }
          ++l;
          ++v13;
        }
        while ( l < len - 1 );
      }
      V_PlanetItems.item[m].ind = val1;
      V_PlanetItems.item[m].flags = 0;
      V_PlanetItems.item[m].res = val2;
      V_PlanetItems.item[m].pros = val3;
      V_PlanetItems.item[m].mpop = val4;
      V_PlanetItems.item[m].upop = val5;
      V_PlanetItems.item[m].cost = val6;
      n = 0;
      V_PlanetItems.item[m].resReq = val7;
      do
      {
        fscanf(fp, "%d", &val1);
        if ( val1 == 0xFF )
        {
          break;
        }
        LOWORD(v14) = V_PlanetItems.item[m].flags;
        v14 |= 1 << val1;
        ++n;
        V_PlanetItems.item[m].flags = v14;
      }
      while ( n < 8 );
      ++m;
      name += 0x28;
    }
    while ( m != 39 );
    fclose(fp);
  }
  V_PlanetCfg.txtLoaded = TRUE;
}
// 9684C: using guessed type int V_PlanItem50;

//----- (0003407C) --------------------------------------------------------
int __fastcall sub_3407C(P_Planet a1)
{
  int v2; // ebp
  _BYTE *v3; // eax
  unsigned int v4; // kr00_4
  unsigned __int16 v5; // bx
  int v7; // [esp+0h] [ebp-14h]
  int v8; // [esp+4h] [ebp-10h]
  unsigned __int16 v9; // [esp+8h] [ebp-Ch]
  unsigned __int16 v10; // [esp+Ch] [ebp-8h]
  unsigned __int16 v11; // [esp+10h] [ebp-4h]

  v2 = 0;
  v8 = 0;
  v7 = 0;
  while ( a1->word1A > v8 && v2 < 100 )
  {
    v3 = (char *)a1->a + v7;
    if ( (*v3 & 8) == 0 && (*v3 || V_Game.races[a1->byte57].Unknown_19D == 2) && *((_BYTE *)a1->a + v7 + 1) == 0xFF )
    {
      v4 = sub_35A00(a1, v8);
      v11 = sub_35968(a1, HIWORD(v4) - 1, (unsigned __int16)v4);
      v9 = sub_35968(a1, HIWORD(v4) + 1, (unsigned __int16)v4);
      v10 = sub_35968(a1, HIWORD(v4), (unsigned __int16)v4 - 1);
      v5 = sub_35968(a1, HIWORD(v4), (unsigned __int16)v4 + 1);
      ++v2;
      if ( (v11 == 0xFFFF || (*((_WORD *)a1->a + 2 * v11 + 1) & 1) == 0)
        && (v9 == 0xFFFF || (*((_WORD *)a1->a + 2 * v9 + 1) & 1) == 0)
        && (v10 == 0xFFFF || (*((_WORD *)a1->a + 2 * v10 + 1) & 1) == 0)
        && (v5 == 0xFFFF || (*((_WORD *)a1->a + 2 * v5 + 1) & 1) == 0) )
      {
        --v2;
      }
    }
    v7 += 4;
    ++v8;
  }
  return v2;
}

//----- (0003420C) --------------------------------------------------------
int __fastcall sub_3420C(T_Planet *a1)
{
  int v2; // ebp
  int result; // eax
  char *v4; // esi
  int v5; // eax
  unsigned int v6; // kr00_4
  unsigned __int16 v7; // bx
  int v8; // [esp+0h] [ebp-14h]
  int i; // [esp+4h] [ebp-10h]
  unsigned __int16 v10; // [esp+8h] [ebp-Ch]
  unsigned __int16 v11; // [esp+Ch] [ebp-8h]
  unsigned __int16 v12; // [esp+10h] [ebp-4h]

  v2 = 0;
  v8 = 0;
  for ( i = 0; ; i += 4 )
  {
    result = a1->word1A;
    if ( (unsigned __int16)result <= v8 || v2 >= 0x64 )
    {
      break;
    }
    v4 = (char *)a1->a + i;
    v5 = *v4 & 8;
    if ( (*v4 & 8) == 0 )
    {
      LOBYTE(v5) = *v4;
      if ( !v5 && v4[1] == (char)0xFF )
      {
        v6 = sub_35A00(a1, v8);
        v11 = sub_35968(a1, HIWORD(v6) - 1, (unsigned __int16)v6);
        v12 = sub_35968(a1, HIWORD(v6) + 1, (unsigned __int16)v6);
        v10 = sub_35968(a1, HIWORD(v6), (unsigned __int16)v6 - 1);
        v7 = sub_35968(a1, HIWORD(v6), (unsigned __int16)v6 + 1);
        ++v2;
        if ( (v11 == 0xFFFF || (*((_WORD *)a1->a + 2 * v11 + 1) & 1) == 0)
          && (v12 == 0xFFFF || (*((_WORD *)a1->a + 2 * v12 + 1) & 1) == 0)
          && (v10 == 0xFFFF || (*((_WORD *)a1->a + 2 * v10 + 1) & 1) == 0)
          && (v7 == 0xFFFF || (*((_WORD *)a1->a + 2 * v7 + 1) & 1) == 0) )
        {
          --v2;
        }
      }
    }
    ++v8;
  }
  return result;
}

//----- (00034368) --------------------------------------------------------
unsigned int __fastcall sub_34368(P_Planet a1, unsigned __int8 a2, unsigned __int16 a3)
{
  unsigned int v4; // ebp
  unsigned int v5; // edi
  int resReq; // eax
  int v7; // eax
  char *v8; // eax
  char *v9; // eax
  unsigned int v10; // eax
  unsigned __int16 v11; // cx
  unsigned __int16 v12; // bx
  int v14; // [esp+0h] [ebp-20h]
  int v15; // [esp+8h] [ebp-18h]
  unsigned __int16 v16; // [esp+Ch] [ebp-14h]
  unsigned __int16 v17; // [esp+14h] [ebp-Ch]
  unsigned __int16 v18; // [esp+18h] [ebp-8h]
  unsigned __int16 v19; // [esp+1Ch] [ebp-4h]

  v4 = 0xFFFFFFFF;
  v5 = 0xFFFFFFFF;
  if ( a1->byte57 == 0xFF && a2 != 5 )
  {
    return 0;
  }
  if ( a2 < 0x27u )
  {
    v4 = 0;
    resReq = V_PlanetItems.item[a2].resReq;
    if ( resReq == 0xFF
      || (unsigned __int16)V_ResTree.num > resReq && ((1 << a1->byte57) & (char)V_ResTree.items[resReq].z2[0]) != 0 )
    {
      v19 = a1->word42 - a1->word4C;
      if ( a1->buildingPlanetItemIndex != 0xFF )
      {
        v19 += (char)V_PlanetItems.item[a1->buildingPlanetItemIndex].upop;
      }
      if ( v19 >= (char)V_PlanetItems.item[a2].upop )
      {
        v4 = 0xFFFFFFFF;
      }
      if ( v4 == 0xFFFFFFFF && a2 == 0x17 )
      {
        v4 = sub_362E0(a1);
      }
    }
    if ( a2 == 5 )
    {
      v4 = 0xFFFFFFFF;
    }
  }
  if ( a3 < a1->word1A )
  {
    v5 = 0;
    if ( a2 < 0x27u && ((V_PlanetItems.item[a2].flags & 1) != 0 || V_Game.races[a1->byte57].Unknown_19D == 2) )
    {
      v5 = 0xFFFFFFFF;
    }
    v14 = 4 * a3;
    v7 = *((unsigned __int8 *)a1->a + v14);
    if ( *((_BYTE *)a1->a + v14) || a2 == 0xFF || (LOBYTE(v7) = a2, (V_PlanetItems.item[v7].flags & 2) != 0) )
    {
      v5 = 0xFFFFFFFF;
    }
    if ( a2 != 0xFF && a2 <= 0x1Eu && a3 < a1->word18 != a2 < (int)V_PlanetItems.num1 )
    {
      v5 = 0;
    }
    if ( a2 != 0xFF && ((*((_BYTE *)a1->a + 4 * a3) & 8) != 0) != (a2 == 0x26) )
    {
      v5 = 0;
    }
    if ( a2 == 0x24 )
    {
      v8 = (char *)a1->a + 4 * a3;
      if ( *v8 || v8[1] != (char)0xFF )
      {
        v5 = 0;
      }
    }
    if ( a2 == 0x23 )
    {
      v9 = (char *)a1->a + 4 * a3;
      if ( (*((_WORD *)v9 + 1) & 1) == 0 || v9[1] == 0x17 || (*((_WORD *)v9 + 1) & 2) != 0 )
      {
        v5 = 0;
      }
    }
    if ( a3 < a1->word18 && (*((_WORD *)a1->a + 2 * a3 + 1) & 1) == 0 && a2 != 5 && a2 != 0x23 )
    {
      v10 = sub_35A00(a1, a3);
      v11 = v10;
      v15 = HIWORD(v10);
      v16 = sub_35968(a1, HIWORD(v10) - 1, (unsigned __int16)v10);
      v18 = sub_35968(a1, v15 + 1, v11);
      v17 = sub_35968(a1, v15, v11 - 1);
      v12 = sub_35968(a1, v15, v11 + 1);
      if ( (v16 == 0xFFFF || (*((_WORD *)a1->a + 2 * v16 + 1) & 1) == 0)
        && (v18 == 0xFFFF || (*((_WORD *)a1->a + 2 * v18 + 1) & 1) == 0)
        && (v17 == 0xFFFF || (*((_WORD *)a1->a + 2 * v17 + 1) & 1) == 0)
        && (v12 == 0xFFFF || (*((_WORD *)a1->a + 2 * v12 + 1) & 1) == 0) )
      {
        v5 = 0;
      }
    }
  }
  if ( v4 && v5 )
  {
    return 0xFFFFFFFF;
  }
  else
  {
    return 0;
  }
}

//----- (00034774) --------------------------------------------------------
void __fastcall sub_34774(P_Planet a1, unsigned __int8 a2, int a3, int a4)
{
  unsigned __int8 v5; // cl
  int v6; // edx
  unsigned __int8 v7; // bl
  unsigned __int16 v8; // si

  if ( a3 != 0xFFFF && *((_BYTE *)a1->a + 4 * a3 + 1) == 0xFF )
  {
    if ( a4 == 0xFFFFFFFF )
    {
      v5 = 0;
      v6 = (unsigned __int16)a3;
      v7 = a2;
    }
    else
    {
      v5 = 2;
      v8 = a3;
      v7 = a2;
      v6 = v8;
    }
    sub_34B0C(a1, v6, v7, v5);
  }
}

//----- (000347CC) --------------------------------------------------------
int __fastcall sub_347CC(P_Planet a1, unsigned __int8 a2)
{
  UBYTE byte57; // cl
  int v4; // ebp
  int v5; // edx
  int v6; // ecx
  int v7; // edi
  signed int v8; // edi
  int v9; // ecx
  int v10; // esi
  int v11; // eax
  signed __int8 ind; // bl
  signed __int8 pros; // bl
  signed __int8 res; // bl
  _BYTE v16[180]; // [esp+0h] [ebp-E0h] BYREF
  _BYTE *a; // [esp+C8h] [ebp-18h]
  int v18; // [esp+CCh] [ebp-14h]
  int v19; // [esp+D0h] [ebp-10h]
  int v20; // [esp+D4h] [ebp-Ch]
  int v21; // [esp+D8h] [ebp-8h]
  unsigned __int8 v22; // [esp+DCh] [ebp-4h]

  v22 = a2;
  v19 = 0xFFFF;
  byte57 = a1->byte57;
  v4 = 0;
  v5 = (char)V_ResTree.items[(unsigned __int16)V_ResTree.num - 1].z2[0];
  v18 = 0;
  if ( ((1 << byte57) & v5) != 0 && sub_40664(&V_Game.races[byte57].Unknown_00) == (unsigned __int16)V_ResTree.num )
  {
    v18 = 0xFFFFFFFF;
  }
  v6 = 0;
  v7 = 0;
  v21 = 0;
  while ( v6 < a1->word1A && v7 < 0xC8 )
  {
    if ( *((_BYTE *)a1->a + v21 + 1) == 0xFF )
    {
      if ( sub_34368(a1, v22, v6) )
      {
        v7 += 2;
        ++v4;
        *(_WORD *)&v16[0xFFFFFFFE + v7] = v6;
      }
    }
    ++v6;
    v21 += 4;
  }
  if ( v4 )
  {
    v8 = 0xFFFFFFFF;
    v9 = 0;
    v20 = 0xFFFFFFFF;
    if ( v4 > 0 )
    {
      a = a1->a;
      v10 = 0;
      do
      {
        switch ( a[4 * *(unsigned __int16 *)&v16[v10]] )
        {
          case 2:
            v11 = 0;
            if ( (char)V_PlanetItems.item[v22].ind > 0 )
            {
              ind = V_PlanetItems.item[v22].ind;
              v11 = 3;
              if ( ind < (char)V_PlanetItems.item[v22].res || ind < (char)V_PlanetItems.item[v22].pros )
              {
                v11 = 2;
              }
            }
            break;
          case 3:
            v11 = 0;
            if ( (char)V_PlanetItems.item[v22].pros > 0 )
            {
              pros = V_PlanetItems.item[v22].pros;
              v11 = 3;
              if ( pros < (char)V_PlanetItems.item[v22].ind || pros < (char)V_PlanetItems.item[v22].res )
              {
                v11 = 2;
              }
            }
            break;
          case 4:
            if ( v18 )
            {
              goto LABEL_24;
            }
            v11 = 0;
            if ( (char)V_PlanetItems.item[v22].res > 0 )
            {
              res = V_PlanetItems.item[v22].res;
              v11 = 3;
              if ( res < (char)V_PlanetItems.item[v22].ind || res < (char)V_PlanetItems.item[v22].pros )
              {
                v11 = 2;
              }
            }
            break;
          default:
LABEL_24:
            v11 = 1;
            break;
        }
        if ( v11 > v8 )
        {
          v20 = v9;
          v8 = v11;
        }
        ++v9;
        v10 += 2;
      }
      while ( v9 < v4 );
    }
    if ( v20 >= 0 )
    {
      return *(unsigned __int16 *)&v16[2 * v20];
    }
  }
  return v19;
}

//----- (00034A44) --------------------------------------------------------
UWORD __fastcall sub_34A44(T_Planet *a1, _DWORD *a2, _DWORD *a3, _DWORD *a4)
{
  UWORD result; // ax
  int v6; // [esp+0h] [ebp-14h]
  int v7; // [esp+4h] [ebp-10h]

  *a2 = 0;
  *a3 = 0;
  v6 = 0;
  v7 = 0;
  *a4 = 0;
  while ( 1 )
  {
    result = a1->word1A;
    if ( result <= v6 )
    {
      return result;
    }
    if ( *((_BYTE *)a1->a + v7 + 1) == 0xFF && sub_34368(a1, 0, v6) )
    {
      switch ( *((_BYTE *)a1->a + v7) )
      {
        case 2:
          ++*a3;
          break;
        case 3:
          goto LABEL_3;
        case 4:
          ++*a2;
          break;
        default:
          ++*a2;
          ++*a3;
LABEL_3:
          ++*a4;
          break;
      }
    }
    v7 += 4;
    ++v6;
  }
}

//----- (00034AE4) --------------------------------------------------------
int __fastcall sub_34AE4(P_Planet a1, unsigned __int8 a2, int a3)
{
  int v5; // ebx

  v5 = sub_347CC(a1, a2);
  sub_34774(a1, a2, v5, a3);
  return v5;
}

//----- (00034B0C) --------------------------------------------------------
unsigned int __fastcall sub_34B0C(P_Planet a1, int edx0, UBYTE bl0, unsigned __int8 cl0)
{
  unsigned int v5; // ebp
  _BYTE *a; // edi
  unsigned __int8 v8; // dl
  unsigned __int8 v9; // al
  int word52; // edx
  T_Ship *v11; // eax
  char *v12; // eax
  UBYTE v13; // dl
  int v14; // eax
  int v15; // edx
  int a3; // [esp+0h] [ebp-24h] BYREF
  int a4; // [esp+4h] [ebp-20h] BYREF
  int a5; // [esp+8h] [ebp-1Ch] BYREF
  int v19; // [esp+Ch] [ebp-18h] BYREF
  int v20; // [esp+10h] [ebp-14h] BYREF
  int a2; // [esp+14h] [ebp-10h] BYREF
  int v22; // [esp+18h] [ebp-Ch]
  int v23; // [esp+1Ch] [ebp-8h]
  UBYTE v24; // [esp+20h] [ebp-4h]

  v23 = edx0;
  v24 = bl0;
  v5 = 0;
  if ( (unsigned __int16)edx0 == 0xFFFF && ((V_PlanetItems.item[bl0].flags & 2) == 0 || cl0 != 2) )
  {
    goto LABEL_42;
  }
  v22 = ((unsigned __int16)v23 < a1->word18) - 1;
  a = a1->a;
  if ( (unsigned __int16)v23 != 0xFFFF )
  {
    a += 4 * (unsigned __int16)v23;
  }
  if ( !cl0 )
  {
    if ( a[1] == 0xFF && v24 < 0x27u )
    {
      v8 = v24;
      if ( a1->word42 - (unsigned __int16)a1->word4C >= (char)V_PlanetItems.item[v24].upop
        && v24 >= (int)V_PlanetItems.num1 == v22 )
      {
        a[1] = v24;
        *((_WORD *)a + 1) = 1;
        v5 = 0xFFFFFFFF;
        if ( (V_PlanetItems.item[v8].flags & 4) != 0 )
        {
          sub_366C8(a1, v8, &a3, &a4, &a5);
          if ( a5 )
          {
            a[3] = 0;
            *((_WORD *)a + 1) |= (_WORD)a5 << 8;
            sub_34E70(a1);
            return 0xFFFFFFFF;
          }
        }
      }
    }
    goto LABEL_42;
  }
  if ( cl0 > 1u )
  {
    if ( cl0 > 3u )
    {
      sub_34E70(a1);
      return 0;
    }
    if ( cl0 == 3
      || (V_PlanetItems.item[v24].flags & 2) != 0
      || sub_34368(a1, v24, v23) && ((*((_WORD *)a + 1) & 1) == 0 || v24 == 0x23 && (*((_WORD *)a + 1) & 2) == 0) )
    {
      word52 = a1->word52;
      if ( (unsigned __int16)word52 != 0xFFFF )
      {
        if ( *((_BYTE *)a1->a + 4 * word52 + 1) == 0x17 )
        {
          v11 = sub_35A70(a1, word52);
          sub_49940((int)v11);
        }
        v12 = (char *)a1->a + 4 * a1->word52;
        if ( (*((_WORD *)v12 + 1) & 1) == 0 )
        {
          v12[1] = 0xFF;
        }
      }
      v13 = v24;
      v14 = v24;
      a1->word52 = 0xFFFF;
      if ( (V_PlanetItems.item[v14].flags & 2) == 0 )
      {
        a1->word52 = v23;
        if ( v13 != 0x23 )
        {
          a[1] = v13;
        }
      }
      v15 = v24;
      a1->buildingPlanetItemIndex = v24;
      if ( (V_PlanetItems.item[v15].flags & 4) != 0 )
      {
        sub_366C8(a1, v15, &v19, &v20, &a2);
        if ( a2 )
        {
          a[3] = 0;
          *((_WORD *)a + 1) |= (_WORD)a2 << 8;
        }
      }
      sub_34E70(a1);
      return 0xFFFFFFFF;
    }
LABEL_42:
    sub_34E70(a1);
    return v5;
  }
  v9 = a[1];
  if ( v9 == 0xFF || (char)V_PlanetItems.item[v9].mpop > a1->word4A - a1->word42 && (*((_WORD *)a + 1) & 1) != 0 )
  {
    goto LABEL_42;
  }
  a[1] = 0xFF;
  *((_WORD *)a + 1) = 0;
  if ( (_WORD)v23 == a1->word52 )
  {
    a1->word52 = 0xFFFF;
    a1->buildingPlanetItemIndex = 0xFF;
  }
  sub_34E70(a1);
  return 0xFFFFFFFF;
}

//----- (00034E70) --------------------------------------------------------
UWORD __fastcall sub_34E70(P_Planet a1)
{
  int v2; // ecx
  int v3; // ebp
  char *v4; // esi
  unsigned __int8 v5; // dl
  T_PlanetItem *v6; // eax
  signed __int8 pros; // dh
  int v8; // edi
  signed __int8 res; // dh
  int v10; // edi
  int v11; // eax
  int v12; // eax
  int v13; // eax
  UBYTE buildingPlanetItemIndex; // dl
  int v15; // eax
  UWORD word4A; // dx
  UWORD result; // ax
  UWORD word42; // cx
  BYTE v19; // [esp+0h] [ebp-30h]
  WORD v20; // [esp+4h] [ebp-2Ch]
  BYTE v21; // [esp+8h] [ebp-28h]
  WORD v22; // [esp+Ch] [ebp-24h]
  WORD v23; // [esp+10h] [ebp-20h]
  WORD v24; // [esp+14h] [ebp-1Ch]
  int v25; // [esp+18h] [ebp-18h]
  int v26; // [esp+1Ch] [ebp-14h]
  int v27; // [esp+20h] [ebp-10h]
  int v28; // [esp+20h] [ebp-10h]
  UWORD word55; // [esp+24h] [ebp-Ch]

  v2 = 0;
  v3 = 0;
  v26 = 0;
  v25 = 0;
  v27 = 0;
  v20 = 0;
  v24 = 0;
  v22 = 0;
  v23 = 0;
  v19 = 0;
  v21 = 0;
  word55 = a1->word55;
  while ( v3 < a1->word1A )
  {
    v4 = (char *)a1->a + v2;
    v5 = v4[1];
    v6 = &V_PlanetItems.item[v5];
    if ( v5 == 0xFF )
    {
      if ( v3 < a1->word18 )
      {
        if ( (*v4 & 8) == 0 )
        {
          ++v24;
          if ( !*v4 )
          {
            ++v22;
          }
        }
      }
      else
      {
        ++v23;
      }
    }
    else
    {
      if ( (*((_WORD *)v4 + 1) & 1) != 0 )
      {
        if ( v6->ind )
        {
          v26 += (char)v6->ind;
          if ( *v4 == 2 )
          {
            ++v26;
          }
        }
        pros = v6->pros;
        if ( pros )
        {
          v8 = pros + v27;
          v27 = v8;
          if ( *((_BYTE *)a1->a + v2) == 3 )
          {
            v27 = v8 + 1;
          }
        }
        res = v6->res;
        if ( res )
        {
          v10 = res + v25;
          v25 = v10;
          if ( *((_BYTE *)a1->a + v2) == 4 )
          {
            v25 = v10 + 1;
          }
        }
        if ( (v6->flags & ATTACK) == 0 || v5 == 17 )
        {
          if ( (v6->flags & DEFENSE) != 0 || v5 == 17 )
          {
            ++v21;
          }
        }
        else
        {
          ++v19;
        }
        word55 += (char)v6->mpop;
      }
      if ( v5 != 0x17 && (*(_WORD *)((_BYTE *)a1->a + v2 + 2) & 2) == 0 && (V_PlanetItems.item[v5].flags & MASK6) == 0 )
      {
        v20 += (char)v6->upop;
      }
    }
    v2 += 4;
    ++v3;
  }
  v11 = sub_35930(a1, 0xC);
  if ( v11 != 0xFFFF && (*((_WORD *)a1->a + 2 * v11 + 1) & 1) != 0 )
  {
    v26 += v26 >> 1;
  }
  v12 = sub_35930(a1, 0xD);
  if ( v12 != 0xFFFF && (*((_WORD *)a1->a + 2 * v12 + 1) & 1) != 0 )
  {
    v27 += v27 >> 1;
  }
  v13 = sub_35930(a1, 0xE);
  if ( v13 != 0xFFFF && (*((_WORD *)a1->a + 2 * v13 + 1) & 1) != 0 )
  {
    v25 += v25 >> 1;
  }
  if ( a1->buildingPlanetItemIndex != 0xFF )
  {
    buildingPlanetItemIndex = a1->buildingPlanetItemIndex;
    v15 = v26 >> 2;
    switch ( buildingPlanetItemIndex )
    {
      case 0x21u:
        v27 += v15;
        break;
      case 0x22u:
        LOWORD(v25) = v15 + v25;
        break;
      case 0x23u:
        v20 += (char)V_PlanetItems.item[0x23].upop;
        break;
    }
  }
  if ( v26 )
  {
    v26 = (int)pow((double)(v26 + 1), 0.85);
  }
  if ( v27 )
  {
    v27 = (int)pow((double)(v27 + 1), 0.85);
  }
  v28 = v27 - a1->word42 / 4;
  if ( v28 < 0 )
  {
    LOWORD(v28) = 0;
  }
  a1->word1C = v24;
  a1->word20 = v22;
  a1->word1E = v23;
  a1->production = v26;
  a1->word46 = v25;
  if ( byte_104BEA != a1->byte57 && !V_FlashPopExists_dword_A0D00 && V_Game.Unknown_D8A[0x2A] )
  {
    if ( V_Game.Unknown_D8A[0x2A] <= 1u )
    {
      a1->production = (int)((double)a1->production * 1.3);
    }
    else if ( V_Game.Unknown_D8A[0x2A] == 2 )
    {
      a1->production = (int)((double)a1->production * 1.3);
      a1->word46 = (int)(1.3 * (double)a1->word46);
    }
  }
  a1->word48 = v28;
  a1->word4A = word55;
  a1->word4C = v20;
  a1->byte58 = v19;
  a1->byte59 = v21;
  if ( a1->word4A > 0x64u )
  {
    a1->word4A = 0x64;
  }
  word4A = a1->word4A;
  if ( a1->word42 > word4A )
  {
    a1->word42 = word4A;
  }
  result = a1->word4C;
  word42 = a1->word42;
  if ( result > word42 )
  {
    a1->word4C = word42;
  }
  return result;
}
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;

//----- (000352E0) --------------------------------------------------------
int __fastcall sub_352E0(P_Planet pPlanet)
{
  unsigned __int8 *a; // edi
  int v3; // edx
  UBYTE buildingPlanetItemIndex; // ah
  unsigned int v5; // ebp
  int v6; // eax
  unsigned __int16 word52; // dx
  UBYTE byte57; // al
  char *v9; // eax
  T_Ship *v10; // eax
  __int16 v11; // ax
  int v12; // edi
  int v13; // ecx
  int v14; // edx
  int i; // eax
  WORD v16; // bx
  UBYTE v17; // bl
  __int16 v18; // di
  UBYTE v19; // al
  int v20; // eax
  UWORD word4A; // di
  int z_low; // eax
  float x_4; // [esp+4h] [ebp-58h]
  T_Vector3D result; // [esp+8h] [ebp-54h] BYREF
  float v25; // [esp+14h] [ebp-48h]
  float v26; // [esp+18h] [ebp-44h]
  float v27; // [esp+1Ch] [ebp-40h]
  int a3; // [esp+2Ch] [ebp-30h] BYREF
  int a4; // [esp+30h] [ebp-2Ch] BYREF
  int v30; // [esp+38h] [ebp-24h] BYREF
  float v31; // [esp+3Ch] [ebp-20h]
  int v32; // [esp+40h] [ebp-1Ch]

  pPlanet->Unknown_62 = 0;
  if ( pPlanet->byte57 != 0xFF )
  {
    a = (unsigned __int8 *)pPlanet->a;
    LOWORD(v32) = 0;
    while ( (__int16)v32 < (int)pPlanet->word1A )
    {
      if ( a[1] != 0xFF )
      {
        v3 = a[1];
        if ( (V_PlanetItems.item[v3].flags & 4) != 0 )
        {
          sub_366C8(pPlanet, v3, &a3, &a4, &v30);
          if ( v30 )
          {
            a[3] = 0;
            *((_WORD *)a + 1) |= (_WORD)v30 << 8;
          }
        }
      }
      a += 4;
      LOWORD(v32) = v32 + 1;
    }
    buildingPlanetItemIndex = pPlanet->buildingPlanetItemIndex;
    v5 = 0;
    if ( buildingPlanetItemIndex != 0xFF )
    {
      v6 = buildingPlanetItemIndex;
      if ( (V_PlanetItems.item[v6].flags & 0x20) == 0 )
      {
        if ( pPlanet->word52 == 0xFFFF && (V_PlanetItems.item[v6].flags & 2) == 0 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x3E9);
        }
        word52 = pPlanet->word52;
        pPlanet->buildingProgress += pPlanet->production;
        if ( (unsigned __int16)Q_GetPlanetItemCost_sub_3583C(pPlanet, word52, pPlanet->buildingPlanetItemIndex) > pPlanet->buildingProgress )
        {
          if ( pPlanet->buildingPlanetItemIndex == 0x1F && !(V_Game.day % 0xA) )
          {
            v12 = byte_104BEA;
            v13 = pPlanet->production / 0xA + 1;
            v14 = 0;
            for ( i = 0; i < V_Game.racesNum; ++i )
            {
              v16 = V_Game.races[0].Unknown_1B2[v12 + v14];
              v14 += 0xF7;
              *(_WORD *)&V_StaticStrings_dword_A0D04.buffer[2 * v12 + 0x1F12 + v14 * 2] = v13 + v16;
            }
          }
        }
        else
        {
          byte57 = pPlanet->byte57;
          if ( byte57 == byte_104BEA
            && pPlanet->buildingPlanetItemIndex == 2
            && (unsigned __int16)V_ResTree.a.w1[byte57] == 0xFFFF
            && !sub_469F0((int)&V_ResTree, byte57) )
          {
            sub_55AEC(&V_Type3_stru_10AE70, 0x19, 0, 0);
          }
          if ( byte_104BEA == pPlanet->byte57
            && *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] != 0x11
            && pPlanet->buildingPlanetItemIndex != 0x17
            && !pPlanet->z7 )
          {
            v5 = 0xFFFFFFFF;
            sub_55AEC(&V_Type3_stru_10AE70, 1, (int)pPlanet, pPlanet->buildingPlanetItemIndex);
          }
          v9 = (char *)pPlanet->a + 4 * pPlanet->word52;
          if ( (*v9 & 8) != 0 )
          {
            *v9 &= ~8u;
            *((_BYTE *)pPlanet->a + 4 * pPlanet->word52 + 1) = 0xFF;
            sub_46A94((unsigned __int16 *)&V_ResTree, pPlanet->byte57, (int)pPlanet);
          }
          else
          {
            v9[2] |= 1u;
          }
          if ( pPlanet->buildingPlanetItemIndex == 0x17 )
          {
            v10 = sub_35A70(pPlanet, pPlanet->word52);
            if ( !v10 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x415);
            }
            if ( v10->Unknown_58 == 1 )
            {
              pPlanet->word42 -= (char)V_PlanetItems.item[0x17].upop;
            }
            sub_49828(v10);
          }
          if ( pPlanet->buildingPlanetItemIndex == 0x24 )
          {
            *((_WORD *)pPlanet->a + 2 * pPlanet->word52 + 1) = 0;
            *((_BYTE *)pPlanet->a + 4 * pPlanet->word52 + 1) = 0xFF;
            *((_BYTE *)pPlanet->a + 4 * pPlanet->word52) = 1;
          }
          if ( pPlanet->buildingPlanetItemIndex == 0x23 )
          {
            *((_BYTE *)pPlanet->a + 4 * pPlanet->word52 + 2) |= 2u;
          }
          if ( pPlanet->buildingPlanetItemIndex == 0x25 && (pPlanet->Unknown_66 & 1) == 0 )
          {
            pPlanet->word55 += 0xA;
            pPlanet->Unknown_66 |= 1u;
          }
          if ( (V_PlanetItems.item[pPlanet->buildingPlanetItemIndex].flags & 8) != 0
            && pPlanet->word52 >= pPlanet->word18 )
          {
            v11 = 0xF;
            if ( pPlanet->buildingPlanetItemIndex == 0x1B )
            {
              v11 = 0x23;
            }
            *((_BYTE *)pPlanet->a + 4 * pPlanet->word52 + 3) = 0;
            *((_WORD *)pPlanet->a + 2 * pPlanet->word52 + 1) |= v11 << 8;
          }
          pPlanet->word52 = 0xFFFF;
          pPlanet->buildingPlanetItemIndex = 0xFF;
          pPlanet->buildingProgress = 0;
        }
      }
    }
    if ( pPlanet->word42 < pPlanet->word4A )
    {
      v17 = byte_104BEA;
      v18 = pPlanet->word48 + pPlanet->z6;
      v19 = pPlanet->byte57;
      pPlanet->z6 = v18;
      if ( v19 != v17 && (unsigned __int16)pPlanet->word48 < 4u )
      {
        pPlanet->z6 = v18 + 1;
      }
      if ( (unsigned __int16)pPlanet->z6 < V_PlanItem50 )
      {
        goto LABEL_71;
      }
      if ( byte_104BEA == pPlanet->byte57
        && *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] != 0x11
        && pPlanet->word42 == pPlanet->word4C
        && !v5
        && !pPlanet->z7
        && (pPlanet->buildingPlanetItemIndex == 0xFF
         || (V_PlanetItems.item[pPlanet->buildingPlanetItemIndex].flags & 0x20) != 0) )
      {
        sub_55AEC(&V_Type3_stru_10AE70, 0xF, (int)pPlanet, 0);
      }
      ++pPlanet->word42;
      v20 = sub_35930(pPlanet, 0xF);
      if ( v20 != 0xFFFF && (*((_WORD *)pPlanet->a + 2 * v20 + 1) & 1) != 0 )
      {
        ++pPlanet->word42;
      }
      word4A = pPlanet->word4A;
      if ( pPlanet->word42 > word4A )
      {
        pPlanet->word42 = word4A;
      }
    }
    pPlanet->z6 = 0;
LABEL_71:
    sub_34E70(pPlanet);
  }
  result = pPlanet->v;
  v31 = sqrt(result.y * result.y + result.x * result.x + result.z * result.z);
  Q_NormVector3D_sub_53000(&result);
  x_4 = dbl_91DD9 / (v31 * v31);
  Q_RotateVectorY_sub_532AC(&result, x_4);
  v25 = result.x * v31;
  v26 = result.y * v31;
  v27 = result.z * v31;
  result.y = v26;
  result.z = v27;
  pPlanet->v.x = v25;
  pPlanet->v.y = result.y;
  z_low = LODWORD(result.z);
  pPlanet->v.z = result.z;
  return z_low;
}
// 91DD9: using guessed type double dbl_91DD9;
// 9684C: using guessed type int V_PlanItem50;

//----- (0003583C) --------------------------------------------------------
__int16 __fastcall Q_GetPlanetItemCost_sub_3583C(
        P_Planet pPlanet,
        unsigned __int16 a2,
        unsigned __int8 planetItemIndex)
{
  __int16 result; // ax
  T_Ship *v5; // eax

  result = 0xFFFF;
  if ( a2 != 0xFFFF )
  {
    planetItemIndex = *((_BYTE *)pPlanet->a + 4 * a2 + 1);
  }
  if ( planetItemIndex != 0xFF )
  {
    if ( planetItemIndex == 0x17 )                     // Ship
    {
      if ( sub_35A70(pPlanet, a2)->Unknown_58 == 2 )
      {
        result = pPlanet->Unknown_77;
      }
      else
      {
        v5 = sub_35A70(pPlanet, a2);
        result = sub_4A18C((int)v5);
      }
    }
    else
    {
      result = V_PlanetItems.item[planetItemIndex].cost;
    }
    if ( planetItemIndex == 0x23 && a2 == pPlanet->word52 )// Automation
    {
      result *= 3;
    }
  }
  return result;
}
// 35893: conditional instruction was optimized away because bl.1 is in (<17u|18..FE)

//----- (000358BC) --------------------------------------------------------
int __fastcall Q_GetDaysToCompletePlanetItem_sub_358BC(P_Planet pPlanet)
{
  UWORD production; // si
  UWORD buildingProgress; // cx
  unsigned __int16 cost; // ax

  production = pPlanet->production;
  buildingProgress = pPlanet->buildingProgress;
  cost = Q_GetPlanetItemCost_sub_3583C(pPlanet, pPlanet->word52, pPlanet->buildingPlanetItemIndex);
  return Q_GetTurnsToComplete_sub_46C20(cost, buildingProgress, production);
}

//----- (000358F0) --------------------------------------------------------
int __fastcall sub_358F0(P_Planet a1)
{
  UWORD word18; // dx
  int v3; // ebx
  UWORD v4; // ax
  char v5; // cl

  word18 = a1->word18;
  v3 = 0;
  v4 = 0;
  if ( word18 )
  {
    do
    {
      v5 = *((_BYTE *)a1->a + 4 * v4 + 1);
      if ( v5 != (char)0xFF && v5 != 5 )
      {
        ++v3;
      }
      ++v4;
    }
    while ( v4 < a1->word18 );
  }
  return v3;
}

//----- (00035930) --------------------------------------------------------
UWORD __fastcall sub_35930(P_Planet a1, char a2)
{
  UWORD word1A; // dx
  UWORD i; // ax

  word1A = a1->word1A;
  i = 0;
  if ( !word1A )
  {
    return 0xFFFF;
  }
  while ( a2 != *((_BYTE *)a1->a + 4 * i + 1) )
  {
    if ( ++i >= a1->word1A )
    {
      return 0xFFFF;
    }
  }
  return i;
}

//----- (00035968) --------------------------------------------------------
int __fastcall sub_35968(P_Planet a1, int a2, int a3)
{
  int v6; // ebx
  int v7; // edx
  int size; // ecx
  int v9; // eax
  int v10; // esi
  int v11; // eax
  int v12; // eax
  int v14; // [esp+4h] [ebp-4h]

  v6 = 0;
  v14 = 0xFFFF;
  if ( a2 >= 0 && a2 < 0xF && a3 >= 0 )
  {
    v7 = 0;
    if ( a2 > 0 )
    {
      size = a1->size;
      v9 = 0xF * size;
      do
      {
        ++v9;
        LOWORD(size) = *(&V_PlanetCfg.room1[5].a0 + v9);
        ++v7;
        v6 += size;
      }
      while ( v7 < a2 );
    }
    v10 = 0xF * a1->size + a2;
    v11 = *(&V_PlanetCfg.room1[0].a0 + v10);
    if ( a3 >= v11 )
    {
      v12 = *(&V_PlanetCfg.room2[0].a0 + v10) + v11;
      if ( a3 < v12 )
      {
        LOWORD(v12) = *(&V_PlanetCfg.room1[0].a0 + v10);
        return a3 + v6 - v12;
      }
    }
  }
  return v14;
}

//----- (00035A00) --------------------------------------------------------
unsigned int __fastcall sub_35A00(P_Planet a1, unsigned __int16 a2)
{
  unsigned int v4; // edi
  int v5; // edi
  int v6; // ecx
  UWORD word18; // si
  unsigned __int16 v8; // ax
  int v9; // edx

  v4 = 0xFFFFFFFF;
  if ( a2 < a1->word18 )
  {
    v5 = 0;
    v6 = 0;
    word18 = a1->word18;
    v8 = 0;
    if ( word18 )
    {
      v9 = 0xF * a1->size;
      do
      {
        v5 = *(&V_PlanetCfg.room1[0].a0 + v9) + a2 - v8;
        v8 += *(&V_PlanetCfg.room2[0].a0 + v9);
        if ( v8 > a2 )
        {
          break;
        }
        ++v9;
        ++v6;
      }
      while ( v8 < a1->word18 );
    }
    return (v6 << 0x10) + v5;
  }
  return v4;
}

//----- (00035A70) --------------------------------------------------------
T_Ship *__fastcall sub_35A70(P_Planet pPlanet, unsigned __int16 a2)
{
  unsigned int v2; // ecx

  if ( a2 >= pPlanet->word1A )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x50B);
  }
  v2 = ((int)*((unsigned __int16 *)pPlanet->a + 2 * a2 + 1) >> 8) & 0x7F;
  if ( v2 >= 0x6B )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x50F);
  }
  if ( V_Game.ships[(unsigned __int16)v2].raceIndex == 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x510);
  }
  return &V_Game.ships[(unsigned __int16)v2];
}

//----- (00035B04) --------------------------------------------------------
unsigned __int16 __fastcall sub_35B04(int a1, unsigned __int16 a2, int a3)
{
  int v4; // edi
  unsigned __int16 result; // ax

  if ( a2 >= *(_WORD *)(a1 + 0x1A) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x519);
  }
  if ( a2 < *(_WORD *)(a1 + 0x18) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x51A);
  }
  v4 = (a3 - (int)V_Game.ships) / 0x162;
  if ( (unsigned __int16)v4 >= 0x6Bu )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x51E);
  }
  if ( V_Game.ships[(unsigned __int16)v4].raceIndex == 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x51F);
  }
  result = a2;
  *(_WORD *)(*(_DWORD *)(a1 + 0x10) + 4 * a2 + 2) = ((_WORD)v4 << 8) | (unsigned __int8)*(_WORD *)(*(_DWORD *)(a1 + 0x10)
                                                                                                 + 4 * a2
                                                                                                 + 2);
  return result;
}

//----- (00035BB4) --------------------------------------------------------
unsigned int __fastcall sub_35BB4(T_Planet *a1, int a2)
{
  int word18; // edx
  int v5; // eax

  if ( a1->byte57 == *(__int16 *)(a2 + 0x56) || !sub_361B8(a1) )
  {
    word18 = a1->word18;
    v5 = 4 * (unsigned __int16)word18;
    while ( word18 < a1->word1A )
    {
      if ( *((_BYTE *)a1->a + v5 + 1) == 0xFF )
      {
        *(_BYTE *)(a2 + 0x58) = 3;
        *(_DWORD *)(a2 + 0x59) = a1;
        *((_BYTE *)a1->a + v5 + 1) = 0x17;
        *(_WORD *)((char *)a1->a + v5 + 2) = 1;
        sub_35B04((int)a1, word18, a2);
        return 0xFFFFFFFF;
      }
      v5 += 4;
      ++word18;
    }
  }
  return 0;
}

//----- (00035C38) --------------------------------------------------------
unsigned int __fastcall sub_35C38(T_Planet *a1, T_Ship *a2)
{
  int word18; // ecx
  int v4; // esi
  char *v5; // eax
  double z; // st7
  float v8; // [esp+0h] [ebp-40h] BYREF
  float v9; // [esp+4h] [ebp-3Ch]
  float v10; // [esp+8h] [ebp-38h]
  int v11[3]; // [esp+Ch] [ebp-34h] BYREF
  float v12; // [esp+18h] [ebp-28h]
  float v13; // [esp+1Ch] [ebp-24h]
  float v14; // [esp+20h] [ebp-20h]
  int v15; // [esp+24h] [ebp-1Ch]
  int *v16; // [esp+28h] [ebp-18h]

  word18 = a1->word18;
  v4 = 4 * word18;
  while ( word18 < a1->word1A )
  {
    v5 = (char *)a1->a + v4;
    if ( *((_WORD *)v5 + 1) && v5[1] == 0x17 && sub_35A70(a1, word18) == a2 )
    {
      *((_BYTE *)a1->a + v4 + 1) = 0xFF;
      *(_WORD *)((char *)a1->a + v4 + 2) = 0;
      a2->Unknown_58 = 4;
      a2->Unknown_59 = (int)&V_Game.stars[a1->starIndex];
      v8 = (float)(rand() % 0x3E8 - 0x1F4);
      v9 = (float)(rand() % 0x3E8 - 0x1F4);
      v15 = rand() % 0x3E8 - 0x1F4;
      v10 = (float)v15;
      sub_53054(&v8, 250.0);
      v12 = 0.0;
      v13 = 0.0;
      v14 = 0.0;
      v16 = v11;
      v12 = a1->v.x + v8;
      v13 = a1->v.y + v9;
      z = a1->v.z;
      *(float *)v11 = v12;
      v14 = z + v10;
      *(float *)&v11[1] = v13;
      *(float *)&v11[2] = v14;
      sub_496BC((int)a2, v11);
      return 0xFFFFFFFF;
    }
    v4 += 4;
    ++word18;
  }
  return 0;
}

//----- (00035DA4) --------------------------------------------------------
char __fastcall sub_35DA4(P_Planet a1)
{
  char v1; // bl
  int v2; // ecx

  v1 = 0xFF;
  if ( V_PlanetItems.item[0x1B].resReq == 0xFF )
  {
    return 0x1B;
  }
  v2 = 1 << a1->byte57;
  if ( (v2 & (char)V_ResTree.items[V_PlanetItems.item[0x1B].resReq].z2[0]) != 0 )
  {
    return 0x1B;
  }
  if ( V_PlanetItems.item[0x1A].resReq == 0xFF
    || (v2 & (char)V_ResTree.items[V_PlanetItems.item[0x1A].resReq].z2[0]) != 0 )
  {
    return 0x1A;
  }
  return v1;
}

//----- (00035E24) --------------------------------------------------------
char __fastcall sub_35E24(P_Planet a1)
{
  char v1; // dl
  int v2; // ecx

  v1 = 0xFF;
  if ( V_PlanetItems.item[0x1E].resReq == 0xFF )
  {
    return 0x1E;
  }
  v2 = 1 << a1->byte57;
  if ( (v2 & (char)V_ResTree.items[V_PlanetItems.item[0x1E].resReq].z2[0]) != 0 )
  {
    return 0x1E;
  }
  if ( V_PlanetItems.item[0x1D].resReq == 0xFF
    || (v2 & (char)V_ResTree.items[V_PlanetItems.item[0x1D].resReq].z2[0]) != 0 )
  {
    return 0x1D;
  }
  if ( V_PlanetItems.item[0x1C].resReq == 0xFF
    || (v2 & (char)V_ResTree.items[V_PlanetItems.item[0x1C].resReq].z2[0]) != 0 )
  {
    return 0x1C;
  }
  return v1;
}

//----- (00035ED8) --------------------------------------------------------
int __fastcall sub_35ED8(T_Planet *a1)
{
  int word18; // ebp
  int v3; // edi
  char v4; // al
  char *v5; // eax
  char v6; // dl
  _DWORD *a4; // [esp+Ch] [ebp-34h] BYREF
  int a3; // [esp+10h] [ebp-30h] BYREF
  int result; // [esp+14h] [ebp-2Ch] BYREF
  float result_4; // [esp+18h] [ebp-28h]
  int v12; // [esp+1Ch] [ebp-24h]
  int v13; // [esp+20h] [ebp-20h]
  float v14; // [esp+24h] [ebp-1Ch]

  word18 = a1->word18;
  v14 = -1.0;
  v3 = 4 * word18;
  while ( word18 < a1->word1A )
  {
    v5 = (char *)a1->a + v3;
    v6 = v5[1];
    result_4 = -1.0;
    if ( v6 != (char)0xFF && (*((_WORD *)v5 + 1) & 1) != 0 )
    {
      v4 = v5[1];
      if ( (unsigned __int8)v4 >= 0x1Cu && (unsigned __int8)v4 <= 0x1Eu )
      {
        a4 = 0;
        a3 = 0;
        result = 1;
        sub_366C8(a1, *((_BYTE *)a1->a + v3 + 1), &a4, &a3, &result);
        if ( result )
        {
          v13 = (int)*(unsigned __int16 *)((char *)a1->a + v3 + 2) >> 8;
        }
        if ( v13 > 0 )
        {
          v12 = 0x20 * (_DWORD)a4;
          result_4 = (double)(0x20 * (int)a4) * dbl_91E43;
        }
      }
    }
    if ( result_4 > (double)v14 )
    {
      v14 = result_4;
    }
    v3 += 4;
    ++word18;
  }
  return (int)v14;
}
// 91E43: using guessed type double dbl_91E43;

//----- (00035FE0) --------------------------------------------------------
int __fastcall sub_35FE0(P_Planet a1)
{
  int word18; // ebx
  int result; // eax
  int v4; // esi
  char v5; // dl
  char *v6; // edx

  word18 = a1->word18;
  result = 0;
  v4 = 4 * (unsigned __int16)word18;
  while ( word18 < a1->word1A )
  {
    v6 = (char *)a1->a + v4;
    if ( v6[1] != (char)0xFF && (*((_WORD *)v6 + 1) & 1) != 0 )
    {
      v5 = v6[1];
      if ( (unsigned __int8)v5 >= 0x1Au )
      {
        if ( (unsigned __int8)v5 <= 0x1Au )
        {
          result += 3;
        }
        else if ( v5 == 0x1B )
        {
          result += 6;
        }
      }
    }
    v4 += 4;
    ++word18;
  }
  return result;
}

//----- (00036050) --------------------------------------------------------
int __fastcall sub_36050(P_Planet a1)
{
  int word18; // ebx
  int result; // eax
  int v4; // esi
  char v5; // dl
  char *v6; // edx

  word18 = a1->word18;
  result = 0;
  v4 = 4 * (unsigned __int16)word18;
  while ( word18 < a1->word1A )
  {
    v6 = (char *)a1->a + v4;
    if ( v6[1] != (char)0xFF && (*((_WORD *)v6 + 1) & 1) != 0 )
    {
      v5 = v6[1];
      if ( (unsigned __int8)v5 < 29u )
      {
        if ( v5 == 0x1C )
        {
          result += 2;
        }
      }
      else if ( (unsigned __int8)v5 <= 29u )
      {
        result += 4;
      }
      else if ( v5 == 30 )
      {
        result += 6;
      }
    }
    v4 += 4;
    ++word18;
  }
  return result;
}

//----- (000360D8) --------------------------------------------------------
int __fastcall sub_360D8(P_Planet a1)
{
  int word18; // ebx
  int result; // eax
  int v4; // esi
  char *v5; // edx

  word18 = a1->word18;
  result = 0;
  v4 = 4 * (unsigned __int16)word18;
  while ( word18 < a1->word1A )
  {
    v5 = (char *)a1->a + v4;
    if ( v5[1] != (char)0xFF && (*((_WORD *)v5 + 1) & 1) != 0 )
    {
      switch ( v5[1] )
      {
        case 0x1A:
          ++result;
          break;
        case 0x1B:
        case 0x1C:
          result += 2;
          break;
        case 0x1D:
          result += 4;
          break;
        case 0x1E:
          result += 6;
          break;
        default:
          break;
      }
    }
    v4 += 4;
    ++word18;
  }
  return result;
}

//----- (00036158) --------------------------------------------------------
int __fastcall sub_36158(P_Planet a1)
{
  int result; // eax
  int v3; // ebx
  int v4; // esi
  char v5; // dl
  char *v6; // edx

  result = 0;
  v3 = 0;
  v4 = 0;
  while ( v3 < a1->word18 )
  {
    v6 = (char *)a1->a + v4;
    if ( v6[1] != (char)0xFF && (*((_WORD *)v6 + 1) & 1) != 0 )
    {
      v5 = v6[1];
      if ( (unsigned __int8)v5 >= 18u )
      {
        if ( (unsigned __int8)v5 <= 18u )
        {
          result += 2;
        }
        else if ( v5 == 19 )
        {
          result += 4;
        }
      }
    }
    v4 += 4;
    ++v3;
  }
  return result;
}

//----- (000361B8) --------------------------------------------------------
int __fastcall sub_361B8(T_Planet *a1)
{
  int word18; // ecx
  int v3; // edi
  int v4; // esi
  char *v5; // eax
  char v6; // dl

  word18 = a1->word18;
  v3 = 0;
  v4 = 4 * (unsigned __int16)word18;
  while ( word18 < a1->word1A )
  {
    v5 = (char *)a1->a + v4;
    if ( v5[1] != (char)0xFF && (*((_WORD *)v5 + 1) & 1) != 0 )
    {
      if ( v5[1] == 0x17 && sub_35A70(a1, word18)->raceIndex == a1->byte57 )
      {
        return 0xFFFFFFFF;
      }
      v6 = *((_BYTE *)a1->a + v4 + 1);
      if ( v6 == 0x1A || v6 == 0x1B )
      {
        return 0xFFFFFFFF;
      }
    }
    v4 += 4;
    ++word18;
  }
  return v3;
}

//----- (0003623C) --------------------------------------------------------
unsigned int __fastcall sub_3623C(T_Planet *a1)
{
  unsigned int v2; // ebp
  int v3; // edi
  char *v4; // eax
  char v5; // dh
  int a2; // [esp+0h] [ebp-1Ch]

  v2 = 0;
  v3 = 0;
  for ( a2 = 0; a1->word18 > a2; ++a2 )
  {
    v4 = (char *)a1->a + v3;
    if ( v4[1] != (char)0xFF && (*((_WORD *)v4 + 1) & 1) != 0 )
    {
      v5 = v4[1];
      if ( v5 == 2 || v5 == 8 )
      {
        if ( sub_34B0C(a1, (unsigned __int16)a2, *((_BYTE *)a1->a + v3 + 1), 1u) )
        {
          v2 = 0xFFFFFFFF;
        }
      }
    }
    v3 += 4;
  }
  return v2;
}

//----- (000362C8) --------------------------------------------------------
void __fastcall sub_362C8(P_Planet a1, T_Vector3D *a2)
{
  a1->v = *a2;
  sub_53440(&a1->v);
}

//----- (000362E0) --------------------------------------------------------
unsigned int __fastcall sub_362E0(P_Planet a1)
{
  int v2; // ebx
  int v3; // eax

  if ( a1->byte57 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x688);
  }
  v2 = 0;
  v3 = sub_35930(a1, 0x16);
  if ( v3 != 0xFFFF && (*((_WORD *)a1->a + 2 * v3 + 1) & 1) != 0 && (int)sub_3EFE0((int)&V_Game.races[a1->byte57]) > 0 )
  {
    return 0xFFFFFFFF;
  }
  return v2;
}

//----- (0003636C) --------------------------------------------------------
void __fastcall sub_3636C(int a1, int a2)
{
  _BYTE *v4; // edx
  __int16 v5; // bx
  int v6; // eax

  v4 = *(_BYTE **)(a1 + 0x10);
  v5 = 0;
  v6 = 0;
  while ( v5 < (int)*(unsigned __int16 *)(a1 + 0x18) )
  {
    if ( (unsigned __int8)*v4 < 2u )
    {
      if ( *v4 )
      {
        ++v6;
      }
      else if ( a2 )
      {
        ++v6;
      }
    }
    else
    {
      v6 += 2;
    }
    ++v5;
    v4 += 4;
  }
}

//----- (000363B0) --------------------------------------------------------
int __fastcall sub_363B0(T_Planet *a1)
{
  unsigned __int16 v2; // ax
  int v3; // edi
  unsigned __int8 *a; // edx
  int v5; // ebx
  int i; // eax
  int cost; // ecx
  int v8; // edi

  if ( a1->byte57 > V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x6CD);
  }
  sub_3636C((int)a1, (V_Game.races[a1->byte57].Unknown_19D != 2) - 1);
  v3 = (a1->word4A - a1->word42) / 2 + a1->word42 + a1->word46 + (unsigned __int16)a1->word48 + a1->production + v2;
  if ( (a1->Unknown_66 & 2) != 0 )
  {
    v3 += 0x64;
  }
  a = (unsigned __int8 *)a1->a;
  v5 = 0;
  for ( i = 0; i < a1->word1A; ++i )
  {
    cost = V_PlanetItems.item[a[1]].cost;
    a += 4;
    v5 += cost;
  }
  v8 = v5 + v3;
  if ( sub_35930(a1, 0x16) )
  {
    v8 += 0x32;
  }
  if ( sub_35930(a1, 0x18) )
  {
    v8 += 0x32;
  }
  if ( v8 < 0 )
  {
    return 0;
  }
  return v8;
}
// 36405: variable 'v2' is possibly undefined

//----- (000364B4) --------------------------------------------------------
int __fastcall sub_364B4(T_Planet *a1, __int16 a2)
{
  T_Race *v3; // ebx
  int byte57; // eax
  unsigned __int16 v5; // ax
  unsigned int v6; // esi
  int v7; // edi
  unsigned __int8 *a; // ebx
  int v9; // eax
  int i; // edx
  int cost; // esi
  unsigned __int8 *v12; // ebx
  int j; // edx
  int v14; // esi
  int v15; // edi
  int v16; // eax
  int v18; // [esp+0h] [ebp-1Ch]
  unsigned int v19; // [esp+4h] [ebp-18h]

  if ( a2 > V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x71A);
  }
  v3 = &V_Game.races[a2];
  byte57 = a1->byte57;
  v18 = 0;
  if ( byte57 == 0xFF || a2 != byte57 && v3->Unknown_1C0[byte57] == 2 )
  {
    sub_3636C((int)a1, (V_Game.races[a2].Unknown_19D != 2) - 1);
    v18 = v5;
    if ( (a1->Unknown_66 & 2) != 0 )
    {
      v18 = v5 + 0x28;
    }
    if ( v18 > 0x46 || v3->Unknown_1C0[a1->byte57] == 2 )
    {
      if ( v3->Unknown_1C0[a1->byte57] != 2 )
      {
        goto LABEL_30;
      }
      v6 = 0;
      v7 = (a1->word4A - a1->word42) / 2 + a1->word42 + a1->word46 + (unsigned __int16)a1->word48 + a1->production;
      v19 = 0;
      if ( sub_35930(a1, 0xB) != 0xFFFF )
      {
        v6 = 0xFFFFFFFF;
      }
      if ( sub_35930(a1, 0x19) != 0xFFFF )
      {
        v19 = 0xFFFFFFFF;
      }
      a = (unsigned __int8 *)a1->a;
      v9 = 0;
      if ( !v6 )
      {
        for ( i = 0; i < a1->word18; ++i )
        {
          cost = V_PlanetItems.item[a[1]].cost;
          a += 4;
          v9 += cost;
        }
      }
      if ( !v19 )
      {
        v12 = (unsigned __int8 *)a1->a;
        for ( j = a1->word18; j < a1->word1A; ++j )
        {
          v14 = V_PlanetItems.item[v12[1]].cost;
          v12 += 4;
          v9 += v14;
        }
      }
      v15 = v9 + v7;
      if ( sub_35930(a1, 0x16) )
      {
        v15 += 0x32;
      }
      if ( sub_35930(a1, 0x18) )
      {
        v15 += 0x32;
      }
      v16 = 2 * (v15 / 0xA + v18);
    }
    else
    {
      v16 = 0;
    }
    v18 = v16;
  }
LABEL_30:
  if ( v18 < 0 )
  {
    return 0;
  }
  return v18;
}
// 3654C: variable 'v5' is possibly undefined

//----- (000366C8) --------------------------------------------------------
void __fastcall sub_366C8(P_Planet a1, char a2, _DWORD *a3, _DWORD *a4, _DWORD *a5)
{
  if ( !a3 || !a4 || !a5 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x785);
  }
  switch ( a2 )
  {
    case 0x1C:
      *a3 = 0x2D;
      *a4 = 7;
      *a5 = 1;
      break;
    case 0x1D:
      *a3 = 0x2D;
      *a4 = 7;
      *a5 = 3;
      break;
    case 0x1E:
      *a3 = 0x5A;
      *a4 = 8;
      *a5 = 3;
      break;
    case 0x11:
      *a3 = 0xC8;
      *a4 = 0;
      *a5 = 2;
      break;
  }
}

//----- (0003676C) --------------------------------------------------------
int __fastcall sub_3676C(T_Planet *a1, int a2)
{
  int Unknown_6B; // eax
  int Unknown_6F; // edi
  double v5; // st7
  BOOL v6; // eax
  int v7; // eax
  double v8; // st7
  double z; // st7
  int v10; // eax
  int v11; // eax
  float v12; // [esp+Ch] [ebp-8Ch]
  float v13; // [esp+10h] [ebp-88h]
  float v14; // [esp+14h] [ebp-84h]
  float v15; // [esp+18h] [ebp-80h] BYREF
  float v16; // [esp+1Ch] [ebp-7Ch]
  float v17; // [esp+20h] [ebp-78h]
  float v18; // [esp+24h] [ebp-74h] BYREF
  float v19; // [esp+28h] [ebp-70h]
  float v20; // [esp+2Ch] [ebp-6Ch]
  int v21[3]; // [esp+30h] [ebp-68h] BYREF
  float v22; // [esp+3Ch] [ebp-5Ch]
  float v23; // [esp+40h] [ebp-58h]
  float v24; // [esp+44h] [ebp-54h]
  float v25; // [esp+48h] [ebp-50h]
  float v26; // [esp+4Ch] [ebp-4Ch]
  float v27; // [esp+50h] [ebp-48h]
  int *v28; // [esp+54h] [ebp-44h]
  int v29; // [esp+58h] [ebp-40h]
  __int64 result; // [esp+5Ch] [ebp-3Ch] BYREF
  float *v31; // [esp+64h] [ebp-34h]
  int a3; // [esp+68h] [ebp-30h] BYREF
  _DWORD a4[2]; // [esp+6Ch] [ebp-2Ch] BYREF
  int v34; // [esp+74h] [ebp-24h]
  float v35; // [esp+78h] [ebp-20h]
  int v36; // [esp+7Ch] [ebp-1Ch]
  int v37; // [esp+80h] [ebp-18h]

  Unknown_6B = a1->Unknown_6B;
  v37 = 0;
  LOBYTE(Unknown_6B) = *(_BYTE *)(Unknown_6B + 1);
  v34 = 0xFFFFFFFF;
  if ( (_BYTE)Unknown_6B == 0xFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x7AB);
  }
  Unknown_6F = a1->Unknown_6F;
  a3 = 0;
  a4[0] = 0;
  LODWORD(result) = 1;
  sub_366C8(a1, *(_BYTE *)(a1->Unknown_6B + 1), &a3, a4, &result);
  if ( Unknown_6F )
  {
    if ( *(_BYTE *)(Unknown_6F + 0x58) != 4 || &V_Game.stars[a1->starIndex] != (T_Star *)*(T_Game **)(Unknown_6F + 0x59) )
    {
      v34 = 0;
    }
    if ( a3 > 0 )
    {
      v28 = v21;
      v25 = 0.0;
      v26 = 0.0;
      v27 = 0.0;
      v25 = *(float *)(Unknown_6F + 0x9E) - a1->v.x;
      v26 = *(float *)(Unknown_6F + 0xA2) - a1->v.y;
      v27 = *(float *)(Unknown_6F + 0xA6) - a1->v.z;
      *(float *)v21 = v25;
      *(float *)&v21[1] = v26;
      *(float *)&v21[2] = v27;
      v5 = sqrt(v26 * v26 + v25 * v25 + v27 * v27);
      v29 = 0x20 * a3;
      if ( (double)(0x20 * a3) < v5 )
      {
        v34 = 0;
      }
    }
  }
  v36 = 1;
  if ( (_DWORD)result )
  {
    v36 = (int)*(unsigned __int16 *)(a1->Unknown_6B + 2) >> 8;
  }
  v6 = v34 && v36;
  v37 |= v6;
  if ( (v37 & 1) != 0 )
  {
    if ( a4[0] )
    {
      v7 = sub_4B7A0(Unknown_6F, a2, a4[0], a1->byte57);
      v37 |= v7;
    }
    if ( a2 == 1 )
    {
      if ( *(_BYTE *)(a1->Unknown_6B + 1) == 0x11 )
      {
        v31 = &v18;
        v12 = *(float *)(Unknown_6F + 0x9E) - a1->v.x;
        v13 = *(float *)(Unknown_6F + 0xA2) - a1->v.y;
        v14 = *(float *)(Unknown_6F + 0xA6) - a1->v.z;
        v18 = v12;
        v19 = v13;
        v20 = v14;
        v8 = sqrt(v13 * v13 + v12 * v12 + v14 * v14) + flt_91E91;
        v35 = v8;
        if ( v8 < flt_91E95 )
        {
          v35 = 1280.0;
        }
        sub_53054(&v18, v35);
        v22 = 0.0;
        v23 = 0.0;
        v24 = 0.0;
        a4[1] = &v15;
        v22 = a1->v.x + v18;
        v23 = a1->v.y + v19;
        z = a1->v.z;
        v15 = v22;
        v24 = z + v20;
        v16 = v23;
        v17 = v24;
        *(float *)(Unknown_6F + 0x9E) = v22;
        *(float *)(Unknown_6F + 0xA2) = v16;
        *(float *)(Unknown_6F + 0xA6) = v17;
      }
      if ( (_DWORD)result && v36 > 0 )
      {
        v10 = a1->Unknown_6B;
        --v36;
        *(_BYTE *)(v10 + 3) = 0;
        *(_WORD *)(a1->Unknown_6B + 2) |= (_WORD)v36 << 8;
      }
    }
  }
  v11 = v37;
  a1->Unknown_73 = v37;
  return v11;
}
// 91E91: using guessed type float flt_91E91;
// 91E95: using guessed type float flt_91E95;

//----- (00036A5C) --------------------------------------------------------
__int16 __fastcall sub_36A5C(T_Planet *a1, int a2, __int16 a3)
{
  T_Planet *v3; // esi
  int byte57; // edx
  int v5; // eax
  unsigned __int16 word1A; // cx
  int v7; // edi
  int v8; // ebx
  int v9; // ecx
  unsigned __int16 v10; // di
  int v11; // ebp
  char *v12; // edx
  int v13; // eax
  __int16 v14; // ecx^2
  int v15; // ebx
  T_Ship *v16; // eax
  __int16 v18[10]; // [esp+0h] [ebp-30h]
  int v19; // [esp+14h] [ebp-1Ch]
  int v20; // [esp+18h] [ebp-18h]
  int v21; // [esp+1Ch] [ebp-14h]

  v3 = a1;
  v19 = a2;
  LOWORD(v21) = a3;
  if ( a1->Unknown_62 != 0xFFFFFFFF )
  {
    if ( a1->byte57 >= V_Game.racesNum && a1->byte57 != 0xFF )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x7FE);
    }
    if ( (v21 & 0x8000u) != 0 || (LOWORD(a1) = v21, (__int16)v21 >= V_Game.racesNum) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x7FF);
    }
    byte57 = v3->byte57;
    if ( byte57 != 0xFF )
    {
      v5 = byte57;
      byte57 = (__int16)v21;
      LOWORD(a1) = sub_433E0((int)&V_Game.races[v5], v21, (int)&V_Game.stars[v3->starIndex]);
    }
    LOWORD(byte57) = v3->word18;
    word1A = v3->word1A;
    v7 = 0;
    v20 = 0xFFFF;
    if ( (unsigned __int16)byte57 < word1A )
    {
      a1 = 0;
      do
      {
        v8 = 4 * (unsigned __int16)byte57;
        if ( *((_BYTE *)v3->a + v8 + 1) != 0xFF )
        {
          *(__int16 *)((char *)v18 + (_DWORD)a1) = byte57;
          if ( (V_PlanetItems.item[*((unsigned __int8 *)v3->a + v8 + 1)].flags & 8) != 0 && (_WORD)byte57 != v3->word52 )
          {
            v20 = byte57;
          }
          a1 = (T_Planet *)((char *)a1 + 2);
          ++v7;
        }
        ++byte57;
      }
      while ( (unsigned __int16)byte57 < v3->word1A );
    }
    if ( v7 )
    {
      v9 = 0xFFFFFFFF;
      if ( (unsigned __int16)v20 == 0xFFFF )
      {
        v10 = v18[rand() % v7];
      }
      else
      {
        v10 = v20;
        v11 = 4 * (unsigned __int16)v20;
        v12 = (char *)v3->a + v11;
        v13 = ((int)*((unsigned __int16 *)v12 + 1) >> 8) - v19;
        if ( v13 > 0 && (_WORD)v20 != v3->word52 )
        {
          v12[3] = 0;
          *(_WORD *)((char *)v3->a + v11 + 2) |= (_WORD)v13 << 8;
          v9 = 0;
        }
      }
      if ( *((_BYTE *)v3->a + 4 * v10 + 1) == 0x17 )
      {
        v14 = v21;
        v15 = v19;
        v16 = sub_35A70(v3, v10);
        v9 = ((sub_4B7A0((int)v16, 1, 2 * v15, v14) & 4) == 0) - 1;
      }
      if ( v3->word4A < v3->word42 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x837);
      }
      if ( V_PlanetItems.item[*((unsigned __int8 *)v3->a + 4 * v10 + 1)].mpop )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x838);
      }
      if ( v9 == 0xFFFFFFFF )
      {
        sub_34B0C(v3, v10, 0xFFu, 1u);
        if ( *((_BYTE *)v3->a + 4 * v10 + 1) != 0xFF )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x83D);
        }
        if ( v10 == v3->word52 )
        {
          v3->word52 = 0xFFFF;
          v3->buildingPlanetItemIndex = 0xFF;
          v3->buildingProgress = 0;
        }
      }
      LOWORD(a1) = sub_34E70(v3);
    }
  }
  return (__int16)a1;
}
// 36A5C: using guessed type __int16 var_30[10];

//----- (00036CD4) --------------------------------------------------------
unsigned int __fastcall sub_36CD4(T_Planet *a1, unsigned __int16 dx0, int *a3)
{
  T_Ship *v5; // eax
  int byte57; // edx
  T_Ship *v7; // ebp
  int v8; // eax
  int v9; // edx
  WORD v10; // di
  __int16 i; // ax
  __int16 j; // ax
  int v13; // edx
  int v14; // edx
  int v15; // edi
  __int16 v16; // bx
  int v17; // edi
  int v18; // eax
  int v19; // eax
  unsigned int v21; // [esp+0h] [ebp-30h]
  int v22; // [esp+4h] [ebp-2Ch]
  int v23; // [esp+8h] [ebp-28h]
  unsigned int v24; // [esp+Ch] [ebp-24h]
  int v25; // [esp+10h] [ebp-20h]
  int v26; // [esp+14h] [ebp-1Ch]
  unsigned __int16 k; // [esp+18h] [ebp-18h]
  unsigned __int16 a2; // [esp+1Ch] [ebp-14h]

  v24 = 0;
  if ( dx0 >= a1->word1A )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x851);
  }
  if ( *((_BYTE *)a1->a + 4 * dx0 + 1) != 0x17 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x852);
  }
  v5 = sub_35A70(a1, dx0);
  byte57 = a1->byte57;
  v7 = v5;
  if ( byte57 == 0xFF || byte57 == v5->raceIndex )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x856);
  }
  v21 = 0;
  if ( !V_Game.races[v5->raceIndex].Unknown_19D )
  {
    v21 = 0xFFFFFFFF;
  }
  if ( sub_433E0((int)&V_Game.races[a1->byte57], v5->raceIndex, (int)&V_Game.stars[a1->starIndex]) == 0xFFFFFFFF )
  {
    v8 = a1->byte57;
    v9 = v8 * 0x1EE + 2 * v7->raceIndex;
    v10 = V_Game.races[v8].Unknown_1C7[1];
    if ( v10 < *(__int16 *)((char *)V_Game.races[0].Unknown_1B2 + v9) )
    {
      *(WORD *)((char *)V_Game.races[0].Unknown_1B2 + v9) = v10 - 0xA;
    }
  }
  v25 = 0;
  v22 = 0;
  for ( i = 0; i < v7->Unknown_15A; ++i )
  {
    if ( v7->Unknown_AA[7 * i + 1] == 0x49 )
    {
      ++v25;
    }
  }
  for ( j = 0; j < (int)a1->word18; ++j )
  {
    v14 = (int)a1->a + 4 * j;
    if ( *(_BYTE *)(v14 + 1) == 0x12 && (*(_WORD *)(v14 + 2) & 1) != 0 )
    {
      ++v22;
    }
    else
    {
      v13 = (int)a1->a + 4 * j;
      if ( *(_BYTE *)(v13 + 1) == 0x13 && (*(_WORD *)(v13 + 2) & 1) != 0 )
      {
        v22 += 2;
      }
    }
  }
  v26 = v25;
  if ( v25 > v22 )
  {
    v26 = v22 + 1;
  }
  v23 = v26;
  if ( v21 == 0xFFFFFFFF )
  {
    v23 = 1;
  }
  v15 = 0;
  v16 = 0;
  *a3 = v23;
  while ( v16 < v7->Unknown_15A && v15 < v23 )
  {
    if ( v7->Unknown_AA[7 * v16 + 1] == 0x49 )
    {
      ++v15;
      sub_492F8(v7, v16);
    }
    ++v16;
  }
  sub_496E0(v7);
  v17 = 0;
  for ( a2 = 0; (__int16)a2 < (int)a1->word18 && v17 < v26; ++a2 )
  {
    v18 = (int)a1->a + 4 * (__int16)a2;
    if ( *(_BYTE *)(v18 + 1) == 0x12 && (*(_WORD *)(v18 + 2) & 1) != 0 )
    {
      ++v17;
      sub_34B0C(a1, a2, 0xFFu, 1u);
    }
  }
  for ( k = 0; (__int16)k < (int)a1->word18 && v17 < v26; ++k )
  {
    v19 = (int)a1->a + 4 * (__int16)k;
    if ( *(_BYTE *)(v19 + 1) == 0x13 && (*(_WORD *)(v19 + 2) & 1) != 0 )
    {
      v17 += 2;
      if ( v17 <= v26 )
      {
        sub_34B0C(a1, k, 0xFFu, 1u);
      }
    }
  }
  if ( v25 > v22 || v21 == 0xFFFFFFFF )
  {
    if ( a1->byte57 == byte_104BEA && *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] != 0x10 )
    {
      sub_55AEC(&V_Type3_stru_10AE70, 0xD, (int)a1, 0);
    }
    sub_1D234((int)&V_Game.stars[a1->starIndex], a1, v7->raceIndex);
    v24 = 0xFFFFFFFF;
    a1->Unknown_67 = V_Game.day;
  }
  sub_34E70(a1);
  return v24;
}

//----- (00037040) --------------------------------------------------------
UWORD __fastcall sub_37040(P_Planet a1)
{
  int v2; // edx
  int v3; // eax
  char *v4; // esi

  sub_1D234((int)&V_Game.stars[a1->starIndex], a1, 0xFFFFFFFF);
  v2 = 0;
  v3 = 0;
  while ( v2 < a1->word1A )
  {
    v4 = (char *)a1->a + v3;
    if ( v4[1] != 0x17 )
    {
      v4[1] = 0xFF;
      *(_WORD *)((char *)a1->a + v3 + 2) = 0;
    }
    v3 += 4;
    ++v2;
  }
  a1->word4C = 0;
  a1->word42 = a1->word4C;
  a1->byte57 = 0xFF;
  return sub_34E70(a1);
}

//----- (000370B8) --------------------------------------------------------
void __fastcall Q_ReadWritePlanet_sub_370B8(P_Planet pPlanet, P_FileInfo pfi, int read)
{
  T_Planet vPlanet; // [esp+0h] [ebp-8Ch] BYREF

  if ( read == TRUE )
  {
    memset(&vPlanet, 0, 0xC);
    vPlanet.a = 0;
    vPlanet.z7 = 0;
    vPlanet.word1A = 0;
    Q_ReadFile_sub_1BF94(pfi, &vPlanet, 0x7Bu);
    pPlanet->v.x = vPlanet.v.x;
    pPlanet->v.y = vPlanet.v.y;
    pPlanet->v.z = vPlanet.v.z;
    pPlanet->starIndex = vPlanet.starIndex;
    pPlanet->Unknown_E = vPlanet.Unknown_E;
    pPlanet->a = vPlanet.a;
    pPlanet->size = vPlanet.size;
    pPlanet->type = vPlanet.type;
    pPlanet->word18 = vPlanet.word18;
    pPlanet->word1A = vPlanet.word1A;
    pPlanet->word1C = vPlanet.word1C;
    pPlanet->word1E = vPlanet.word1E;
    pPlanet->word20 = vPlanet.word20;
    pPlanet->z5 = vPlanet.z5;
    qmemcpy(pPlanet->name, vPlanet.name, 0x1Cu);
    *(_WORD *)&pPlanet->name[0x1C] = *(_WORD *)&vPlanet.name[0x1C];
    pPlanet->word42 = vPlanet.word42;
    pPlanet->production = vPlanet.production;
    pPlanet->word46 = vPlanet.word46;
    pPlanet->word48 = vPlanet.word48;
    pPlanet->word4A = vPlanet.word4A;
    pPlanet->word4C = vPlanet.word4C;
    pPlanet->z6 = vPlanet.z6;
    pPlanet->buildingProgress = vPlanet.buildingProgress;
    pPlanet->word52 = vPlanet.word52;
    pPlanet->buildingPlanetItemIndex = vPlanet.buildingPlanetItemIndex;
    pPlanet->word55 = vPlanet.word55;
    pPlanet->byte57 = vPlanet.byte57;
    pPlanet->byte58 = vPlanet.byte58;
    pPlanet->byte59 = vPlanet.byte59;
    pPlanet->z7 = vPlanet.z7;
    pPlanet->Unknown_5E = vPlanet.Unknown_5E;
    pPlanet->Unknown_62 = vPlanet.Unknown_62;
    pPlanet->Unknown_66 = vPlanet.Unknown_66;
    pPlanet->Unknown_67 = vPlanet.Unknown_67;
    pPlanet->Unknown_6B = vPlanet.Unknown_6B;
    pPlanet->Unknown_6F = vPlanet.Unknown_6F;
    pPlanet->Unknown_73 = vPlanet.Unknown_73;
    pPlanet->Unknown_77 = vPlanet.Unknown_77;
    if ( V_Game.starsNum <= pPlanet->starIndex )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x8E4);
    }
    if ( pPlanet->Unknown_E >= 5 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\planet.cpp", 0x8E5);
    }
    V_Game.stars[pPlanet->starIndex].Unknown_46[pPlanet->Unknown_E] = (int)pPlanet;
    ++V_Game.stars[pPlanet->starIndex].planetsNum;
  }
  else
  {
    Q_CFILE_CPP_dos_write_sub_1C098(&pfi->fh, pPlanet, 0x7Bu);
  }
}

//----- (000372B0) --------------------------------------------------------
T_TypeA2 *__fastcall sub_372B0(T_TypeA2 *a1, int a2, int a3, int a4)
{
  Q_A2_sub_2C830(a1);
  a1->b = (int)off_95F84;
  sub_37310((int)a1, (int)a1, a3, a4);
  return a1;
}
// 95F84: using guessed type int (*off_95F84[5])();

//----- (000372CC) --------------------------------------------------------
int __fastcall sub_372CC(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95F58);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95F84;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95F84: using guessed type int (*off_95F84[5])();

//----- (00037310) --------------------------------------------------------
int __fastcall sub_37310(int a1, int a2, int a3, int a4)
{
  int v4; // ecx
  __int16 v5; // ax
  int v6; // ebx
  int result; // eax
  char s[56]; // [esp+0h] [ebp-40h] BYREF

  v4 = a1;
  *(_BYTE *)(a1 + 0xAB) = 0xFF;
  *(_WORD *)(a1 + 0xAE) = 0xFFFF;
  v5 = *(_WORD *)(a1 + 0xAE);
  *(_BYTE *)(v4 + 0x18B) = 5;
  *(_WORD *)(v4 + 0xB0) = v5;
  v6 = 0;
  *(_WORD *)(v4 + 0xAC) = v5;
  do
  {
    v4 += 2;
    sprintf(s, "data\\planal%02d.shp", v6++);
    result = sub_1ADAC(&V_Type3_stru_10AE70.t13, s);
    *(_WORD *)(v4 + 0x173) = result;
  }
  while ( v6 < 0xB );
  return result;
}

//----- (00037380) --------------------------------------------------------
int __fastcall sub_37380(int a1, int a2)
{
  return (__int16)((0x11 * a1 + 0x22 * a2 - 0x29D6) / 0x484) | (((0x11 * a1 - 0x22 * a2 - 0xC9E) / (int)0xFFFFFB7C) << 0x10);
}

//----- (000373E0) --------------------------------------------------------
int __fastcall sub_373E0(int a1, int a2)
{
  int v3; // eax

  if ( a1 > 0xD && a1 < 0x99 && a2 > 0x77 && a2 < 0x1D5 )
  {
    return (a2 - 0x77) / 0x46 + V_Game.planet->word18 + 5 * ((a1 - 0xD) / 0x46);
  }
  v3 = sub_37380(a1, a2);
  return (unsigned __int16)sub_35968(V_Game.planet, v3 >> 0x10, (__int16)v3);
}

//----- (0003745C) --------------------------------------------------------
int __fastcall sub_3745C(T_Type5 *a1, unsigned __int8 *a2, int a3, int a4)
{
  LONG v5; // eax
  T_TypeA1 *Wnd_sub_56DA8; // eax
  LONG v7; // ebp
  unsigned __int16 v8; // bx
  void *ShapeTable_sub_1B084; // eax
  void *v10; // eax
  char *name; // ecx
  T_Rect *p_rect; // esi
  LONG v14; // [esp-20h] [ebp-40h]
  LONG v15; // [esp-18h] [ebp-38h]
  int v16; // [esp+0h] [ebp-20h] BYREF
  LONG hotY; // [esp+4h] [ebp-1Ch] BYREF
  LONG shape_number; // [esp+8h] [ebp-18h] BYREF
  int v19; // [esp+Ch] [ebp-14h] BYREF
  unsigned __int8 v20; // [esp+10h] [ebp-10h]

  v5 = 0xF2;
  if ( a4 )
  {
    v5 = 0x96;
  }
  VFX_pane_wipe((PANE *)a1, v5);
  v20 = *a2;
  if ( v20 != 0xFF )
  {
    Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "PLANETALLOC", 0);
    sub_39390((int)Wnd_sub_56DA8, v20, (__int16 *)&v19, &shape_number);
    v7 = (LONG)sub_10000;
    if ( v20 == 0x17 )
    {
      v7 = 0x8000;
    }
    v8 = shape_number;
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                             (unsigned int)&V_Type3_stru_10AE70.t13,
                             (unsigned __int16)v19);
    Q_GSYSTEM_CPP_sub_2BC40((PANE *)a1, ShapeTable_sub_1B084, v8, &v16, &hotY);
    v15 = hotY;
    v14 = (unsigned __int16)shape_number;
    v10 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v19);
    VFX_shape_transform((PANE *)a1, v10, v14, 0x28, v15, V_BigBuffer, 0, v7, v7, 0);
  }
  name = V_PlanetItems.item[*a2].name;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = a1->a;
  p_rect = &a1->rect;
  V_Type3_stru_10AE70.rect.x1 = p_rect->x1;
  p_rect = (T_Rect *)((char *)p_rect + 4);
  V_Type3_stru_10AE70.rect.y1 = p_rect->x1;
  p_rect = (T_Rect *)((char *)p_rect + 4);
  V_Type3_stru_10AE70.rect.x2 = p_rect->x1;
  V_Type3_stru_10AE70.rect.y2 = p_rect->y1;
  return sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0x50, 0, name, 1, 0xFFFFFFFF, 0xFF, 0);
}
// 10000: using guessed type void __noreturn sub_10000();
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (00037568) --------------------------------------------------------
int __fastcall sub_37568(int a1, unsigned __int16 a2, int a3, unsigned int a4)
{
  T_TypeA1 *Wnd_sub_56DA8; // ecx
  T_TypeA1 *v5; // eax
  T_TypeA1 *v6; // edi
  int v7; // ebx
  int v9; // eax
  int v10; // ebx
  int i; // esi
  char *v12; // edx
  int v13; // eax
  int v14; // edx
  int v15; // edx
  int v16; // edx
  int v17; // edx
  T_Planet *v18; // eax
  T_Planet *v19; // eax
  T_Planet *planet; // eax
  int v21; // edx
  unsigned __int8 v22; // ch
  UBYTE v23; // dh
  T_Ship *v24; // esi
  int v25; // eax
  T_Star *v26; // edi
  T_Planet *v27; // ebx
  char *sub_1CEA8; // eax
  T_Planet *v29; // edx
  UBYTE raceIndex; // cl
  int v31; // edi
  int v32; // ecx
  WORD j; // dx
  int v34; // esi
  int v35; // eax
  char *v36; // ebx
  int v37; // eax
  char *v38; // eax
  T_TypeA1 *v39; // edi
  char *v40; // esi
  char *v41; // edi
  char v42; // al
  char v43; // al
  char *v44; // esi
  T_TypeA1 *v45; // edi
  char *v46; // edi
  char v47; // al
  char v48; // al
  unsigned int v49; // eax
  UBYTE v50; // al
  unsigned __int16 v51; // bx
  int v52; // eax
  int v53; // eax
  int v54; // ebx
  int v55; // esi
  int v56; // eax
  int v57; // edi
  int v58; // esi
  const char *v59; // edi
  int v60; // eax
  int v61; // esi
  T_Ship *v62; // ecx
  T_TypeA1 *v63; // edi
  T_Ship *v64; // eax
  char *v65; // [esp-8h] [ebp-120h]
  int v66; // [esp-4h] [ebp-11Ch]
  char v67[8]; // [esp+0h] [ebp-118h] BYREF
  int s[7]; // [esp+C8h] [ebp-50h] BYREF
  _DWORD v69[5]; // [esp+E4h] [ebp-34h]
  int v70; // [esp+F8h] [ebp-20h]
  T_TypeA1 *v71; // [esp+FCh] [ebp-1Ch]
  unsigned int v72; // [esp+100h] [ebp-18h]
  T_TypeA1 *v73; // [esp+104h] [ebp-14h]
  int v74; // [esp+108h] [ebp-10h]
  int v75; // [esp+10Ch] [ebp-Ch]
  int v76; // [esp+110h] [ebp-8h]
  int v77; // [esp+114h] [ebp-4h]
  _BYTE savedregs[12]; // [esp+118h] [ebp+0h]

  v76 = a1;
  LOWORD(v77) = a2;
  v74 = a3;
  v72 = a4;
  Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "PLANLIST", 0);
  v73 = Wnd_sub_56DA8;
  v5 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "PLSQUARE", 0);
  v6 = v5;
  if ( a2 >= 7u )
  {
    if ( (unsigned __int16)v77 <= 7u )
    {
      sub_56728((int)&V_Type3_stru_10AE70, *(_DWORD *)(v76 + 0x41), 4, 8, 0, 0);
      if ( (*(_DWORD *)(v76 + 0x3D) & *(_DWORD *)(v76 + 0x35) & *(_DWORD *)(v76 + 0x39)) == 0xFFFFFFFF )
      {
        (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(v76 + 0xA7) + 0x10))(v76, 0);
      }
      return 0xFFFFFFFF;
    }
    if ( (unsigned __int16)v77 >= 0x33u )
    {
      if ( a2 > 0x33u )
      {
        if ( (unsigned __int16)v77 < 0x1C01u )
        {
          if ( (_WORD)v77 != 0x34 )
          {
            return sub_2F424(v76, *(__int16 *)&savedregs[4], v74, v72);
          }
          v61 = 0xFFFFFFFF;
          if ( v72 )
          {
            *(_WORD *)(v76 + 0xB0) = v5[1].pane.window;
          }
          else
          {
            v62 = sub_40144(&V_Game.races[V_Game.planet->byte57].Unknown_00, (int)V_Game.planet);
            if ( !v62 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\planwin.cpp", 0x2AD);
            }
            v61 = 0;
            sub_35B04((int)V_Game.planet, v74, (int)v62);
          }
          v63 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "SHIPDESSCREEN", 0);
          v64 = sub_35A70(V_Game.planet, v74);
          sub_4DA7C((int)v63, (int)v64, v61, 0);
          sub_56B60(&V_Type3_stru_10AE70, 1, 8, 1);
          return 0;
        }
        else
        {
          v7 = 5 * v74 + v76;
          if ( (unsigned __int16)v77 <= 0x1C01u )
          {
            v50 = *(_BYTE *)(v7 + 0xB2);
            v51 = *(_WORD *)(v76 + 0xAE);
            *(_BYTE *)(v76 + 0xAB) = v50;
            if ( v51 == 0xFFFF )
            {
              if ( v50 != 0xFF && (V_PlanetItems.item[v50].flags & 2) != 0 )
              {
                sub_34B0C(V_Game.planet, 0xFFFF, v50, 2u);
                *(_BYTE *)(v76 + 0xAB) = 0xFF;
              }
            }
            else if ( v50 != 0xFF )
            {
              if ( sub_34368(V_Game.planet, *(_BYTE *)(v76 + 0xAB), v51) == 0xFFFFFFFF )
              {
                if ( *(_BYTE *)(v76 + 0xAB) == 0x17 )
                {
                  *(_WORD *)(v76 + 0xB0) = *(_WORD *)(v76 + 0xAE);
                }
                sub_34B0C(V_Game.planet, *(unsigned __int16 *)(v76 + 0xAE), *(_BYTE *)(v76 + 0xAB), 2u);
              }
              v52 = v76;
              *(_BYTE *)(v76 + 0xAB) = 0xFF;
              *(_WORD *)(v52 + 0xAC) = 0xFFFF;
              *(_WORD *)(v76 + 0xAE) = *(_WORD *)(v52 + 0xAC);
            }
            sub_56D30(&V_Type3_stru_10AE70, v73->index, 2, 0, 0);
            v53 = *(unsigned __int16 *)(v76 + 0xB0);
            if ( (unsigned __int16)v53 == 0xFFFF )
            {
              (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(v76 + 0xA7) + 0xC))(v76, 0);
            }
            else
            {
              (*(void (__fastcall **)(int, int, int, _DWORD))(*(_DWORD *)(v76 + 0xA7) + 8))(v76, 0x34, v53, 0);
            }
            return 0;
          }
          else
          {
            if ( (_WORD)v77 != 0x1C02 )
            {
              return sub_2F424(v76, *(__int16 *)&savedregs[4], v74, v72);
            }
            v54 = *(unsigned __int8 *)(v7 + 0xB2);
            if ( v54 != 0xFF )
            {
              sub_56B60(&V_Type3_stru_10AE70, 5, v54, 5);
            }
            return 0xFFFFFFFF;
          }
        }
      }
      if ( byte_104BEA == V_Game.planet->byte57 )
      {
        if ( v74 == 1 )
        {
          *(_WORD *)(v76 + 0xAE) = 0xFFFF;
        }
        v56 = (int)v73;
        v57 = v76;
        v73[1].pane.window = 0;
        v58 = v76;
        *(_WORD *)(v56 + 0x8C9) = 0x4B;
        *(_BYTE *)(v56 + 0xC6) = 0xF2;
        sub_2F1C8(v56, (int)sub_3745C);
        v70 = 0;
        v75 = 0;
        v59 = (const char *)(v57 + 0xB2);
        sub_2ED4C((int)v73);
        do
        {
          if ( (_BYTE)v75 != 5 && sub_34368(V_Game.planet, v75, *(_WORD *)(v76 + 0xAE)) )
          {
            v60 = (int)v73;
            *(_BYTE *)(v58 + 0xB2) = v75;
            *(_DWORD *)(v58 + 0xB3) = 0;
            sub_2EA8C(v60, v59, 0xFFFFFFFF, 0);
            v58 += 5;
            v59 += 5;
            ++v70;
          }
          ++v75;
        }
        while ( v75 < 0x27 );
        if ( v70 )
        {
          sub_2D258(v76, 6);
          sub_56D30(&V_Type3_stru_10AE70, v73->index, 1, 0, 0);
        }
      }
LABEL_153:
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(v76 + 0xA7) + 0xC))(v76, 0);
      return 0;
    }
    if ( (unsigned __int16)v77 <= 8u )
    {
      if ( !Wnd_sub_56DA8->i && !v5->i )
      {
        v16 = v76;
        *(_WORD *)(v76 + 0xAC) = sub_373E0(v74, v72);
        if ( V_Game.planet->byte57 != byte_104BEA
          && *(_BYTE *)(v16 + 0xAB) != 5
          && *(unsigned __int16 *)(v76 + 0xAC) != 0xFFFF
          && (*((_BYTE *)V_Game.planet->a + 4 * *(unsigned __int16 *)(v76 + 0xAC) + 1) != 0x17
           || sub_35A70(V_Game.planet, *(_WORD *)(v76 + 0xAC))->raceIndex != byte_104BEA) )
        {
          *(_WORD *)(v76 + 0xAC) = 0xFFFF;
        }
        v17 = *(unsigned __int16 *)(v76 + 0xAC);
        if ( (unsigned __int16)v17 != 0xFFFF
          && *((_BYTE *)V_Game.planet->a + 4 * v17 + 1) == 0x17
          && sub_35A70(V_Game.planet, v17)->raceIndex != byte_104BEA )
        {
          *(_WORD *)(v76 + 0xAC) = 0xFFFF;
        }
        goto LABEL_153;
      }
    }
    else
    {
      if ( (_WORD)v77 != 0x32 )
      {
        return sub_2F424(v76, *(__int16 *)&savedregs[4], v74, v72);
      }
      *(_WORD *)(v76 + 0xAC) = 0xFFFF;
      if ( v74 == 0xA || v74 == 0xB )
      {
        sub_56D30(&V_Type3_stru_10AE70, v5->index, 2, 0, 0);
        (*(void (**)(void))(*(_DWORD *)(v76 + 0xA7) + 8))();
        return 0;
      }
      if ( v74 == 0xC )
      {
        sub_56D30(&V_Type3_stru_10AE70, v5->index, 2, 0, 0);
        v55 = *(_DWORD *)(v76 + 0xA7);
        *(_BYTE *)(v76 + 0xAB) = 5;
        (*(void (**)(void))(v55 + 8))();
        return 0;
      }
      if ( v74 == 4
        || byte_104BEA == V_Game.planet->byte57
        || *(unsigned __int16 *)(v76 + 0xAE) != 0xFFFF
        && *((_BYTE *)V_Game.planet->a + 4 * *(unsigned __int16 *)(v76 + 0xAE) + 1) == 0x17
        && sub_35A70(V_Game.planet, *(_WORD *)(v76 + 0xAE))->raceIndex == byte_104BEA )
      {
        sub_56D30(&V_Type3_stru_10AE70, v6->index, 0x32, v74, *(unsigned __int16 *)(v76 + 0xAE));
        sub_2D258(v76, 6);
        sub_56D30(&V_Type3_stru_10AE70, v6->index, 1, 0, 0);
        (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(v76 + 0xA7) + 0xC))(v76, 0);
        return 0;
      }
    }
    return 0;
  }
  if ( (unsigned __int16)v77 < 4u )
  {
    if ( !(_WORD)v77 )
    {
      return sub_2F424(v76, *(__int16 *)&savedregs[4], v74, v72);
    }
    if ( a2 > 1u )
    {
      if ( (_WORD)v77 != 3 )
      {
        return sub_2F424(v76, *(__int16 *)&savedregs[4], v74, v72);
      }
      if ( v72 < 0x17 )
      {
        if ( v72 < 0x13 )
        {
          if ( v72 == 1 )
          {
            if ( Wnd_sub_56DA8->i )
            {
              sub_56D30(&V_Type3_stru_10AE70, Wnd_sub_56DA8->index, 2, 0, 0);
            }
            else if ( v5->i )
            {
              sub_56D30(&V_Type3_stru_10AE70, v5->index, 2, 0, Wnd_sub_56DA8->i);
            }
            else
            {
              sub_56B60(&V_Type3_stru_10AE70, 3, 0, 0);
            }
          }
        }
        else if ( v72 <= 0x13 )
        {
          if ( V_NougatLfExists_dword_A0CFC )
          {
            if ( V_Game.planet->byte57 == 0xFF )
            {
              V_Game.planet->byte57 = byte_104BEA;
            }
            else
            {
              sub_1D234((int)&V_Game.stars[V_Game.planet->starIndex], V_Game.planet, byte_104BEA);
            }
          }
        }
        else if ( v72 == 0x14 && V_NougatLfExists_dword_A0CFC )
        {
          planet = V_Game.planet;
          V_Game.planet->word42 += 2;
          sub_34AE4(planet, 5u, 0xFFFFFFFF);
        }
      }
      else if ( v72 <= 0x17 )
      {
        if ( V_NougatLfExists_dword_A0CFC )
        {
          v18 = V_Game.planet;
          V_Game.planet->buildingProgress += 0xC8;
          sub_352E0(v18);
        }
      }
      else if ( v72 < 0x1F )
      {
        if ( v72 == 0x18 && V_NougatLfExists_dword_A0CFC )
        {
          V_Game.planet->word42 = V_Game.planet->word4A;
        }
      }
      else if ( v72 <= 0x1F )
      {
        *(_BYTE *)(v76 + 0x18B) ^= 1u;
      }
      else if ( v72 >= 0x31 )
      {
        if ( v72 <= 0x31 )
        {
          if ( V_NougatLfExists_dword_A0CFC )
          {
            sub_352E0(V_Game.planet);
          }
        }
        else if ( v72 == 0x32 )
        {
          if ( V_Keyboard.Shift )
          {
            if ( V_NougatLfExists_dword_A0CFC )
            {
              v19 = V_Game.planet;
              ++V_Game.planet->word55;
              sub_34E70(v19);
            }
          }
          else
          {
            V_Game.planet->z7 = ~V_Game.planet->z7;
          }
        }
      }
      goto LABEL_153;
    }
    v69[0] = off_96850[0];
    v69[1] = off_96850[1];
    v69[2] = off_96850[2];
    v69[3] = off_96850[3];
    v69[4] = off_96850[4];
    for ( i = 0; i != 5; ++i )
    {
      v12 = (char *)v69[i];
      sub_56D70(&V_Type3_stru_10AE70, v12, *(__int16 *)&savedregs[4], v74, v72);
    }
    v13 = v76;
    *(_DWORD *)(v76 + 0x35) = 0xFFFFFFFF;
    *(_DWORD *)(v13 + 0x39) = 0xFFFFFFFF;
    *(_BYTE *)(v13 + 0xAB) = 0xFF;
    *(_WORD *)(v13 + 0xAC) = 0xFFFF;
    v14 = v76;
    *(_WORD *)(v76 + 0xAE) = *(_WORD *)(v13 + 0xAC);
    if ( *(unsigned __int16 *)(v14 + 0xB0) != 0xFFFF )
    {
      sub_394BC(v14);
    }
    (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(v76 + 0xA7) + 0xC))(v76, 0);
    if ( dword_10467C )
    {
      sub_557D4(&V_Type3_stru_10AE70, dword_104680, (const char *)dword_10467C, 0x14);
      dword_10467C = 0;
    }
    return 0;
  }
  if ( a2 > 4u )
  {
    if ( (unsigned __int16)v77 <= 5u )
    {
      v9 = v76;
      *(_BYTE *)(v76 + 0xAB) = 0xFF;
      v10 = *(_DWORD *)(v9 + 0xA7);
      *(_WORD *)(v9 + 0xAE) = 0xFFFF;
      (*(void (**)(void))(v10 + 0xC))();
      return 0xFFFFFFFF;
    }
    else
    {
      sub_567BC(&V_Type3_stru_10AE70, *(_DWORD *)(v76 + 0x41), 8);
      if ( (*(_DWORD *)(v76 + 0x3D) & *(_DWORD *)(v76 + 0x35) & *(_DWORD *)(v76 + 0x39)) == 0xFFFFFFFF )
      {
        (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(v76 + 0xA7) + 0xC))(v76, 0);
      }
      return 0xFFFFFFFF;
    }
  }
  v15 = *(_DWORD *)(v76 + 0x35);
  if ( !v15 )
  {
    return v15;
  }
  if ( Wnd_sub_56DA8->i )
  {
    sub_56D30(&V_Type3_stru_10AE70, Wnd_sub_56DA8->index, 2, 0, 0);
  }
  else if ( v5->i )
  {
    sub_56D30(&V_Type3_stru_10AE70, v5->index, 2, 0, Wnd_sub_56DA8->i);
  }
  else
  {
    v21 = v76;
    *(_WORD *)(v76 + 0xAE) = *(_WORD *)(v76 + 0xAC);
    if ( *(unsigned __int16 *)(v21 + 0xAE) == 0xFFFF )
    {
      if ( *(_BYTE *)(v21 + 0xAB) != 0xFF )
      {
        *(_BYTE *)(v21 + 0xAB) = 0xFF;
      }
    }
    else
    {
      if ( *(__int16 *)(v21 + 0x59) != 0xFFFFFFFF )
      {
        Q_StartSample_sub_4FB90(&V_SoundSystem, *(_WORD *)(v21 + 0x59));
      }
      v22 = *(_BYTE *)(v76 + 0xAB);
      if ( v22 == 0xFF )
      {
        (*(void (**)(void))(*(_DWORD *)(v76 + 0xA7) + 8))();
        return 0;
      }
      if ( sub_34368(V_Game.planet, v22, *(_WORD *)(v76 + 0xAE)) )
      {
        v23 = *(_BYTE *)(v76 + 0xAB);
        if ( v23 == 5 )
        {
          v24 = sub_35A70(V_Game.planet, (unsigned __int16)v6[1].pane.window);
          v25 = sub_4937C((int)v24, 0x47);
          sub_492F8(v24, v25);
          v26 = &V_Game.stars[V_Game.planet->starIndex];
          if ( V_Game.planet->byte57 != 0xFF )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\planwin.cpp", 0x1C6);
          }
          v27 = V_Game.planet;
          sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1F);// 31: "Name Your Colony"
          sub_557D4(&V_Type3_stru_10AE70, sub_1CEA8, v27->name, 0x14);
          v29 = V_Game.planet;
          raceIndex = v24->raceIndex;
          V_Game.planet->byte57 = raceIndex;
          v26->Unknown_14 |= 1 << raceIndex;
          v29->word42 = 2;
          v29->Unknown_67 = V_Game.day;
          v31 = 0;
          sub_34B0C(V_Game.planet, *(unsigned __int16 *)(v76 + 0xAE), *(_BYTE *)(v76 + 0xAB), 0);
          v32 = 0xFFFFFFFF;
          memset(s, 0, sizeof(s));
          for ( j = 0; j < V_Game.racesNum; ++j )
          {
            v34 = j;
            if ( !*(_DWORD *)V_Game.races[v34].z )
            {
              v35 = sub_402E0(&V_Game.races[v34].Unknown_00);
              s[j] = v35;
              if ( v31 < v35 && (j == byte_104BEA || V_Game.races[byte_104BEA].Unknown_1C0[j]) )
              {
                v32 = j;
                v31 = s[j];
              }
            }
          }
          if ( v32 < 0 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\planwin.cpp", 0x1E9);
          }
          v71 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "HELPWINDOW", 0);
          v36 = "colonize";
          if ( v32 == byte_104BEA )
          {
            v36 = "maxcolonize";
          }
          sub_2FCB0(v71, "help.txt", v36);
          v66 = s[v32];
          v65 = V_SpecNames[V_Game.races[v32].Unknown_01];
          if ( s[byte_104BEA] == 1 )
          {
            v37 = 0x20;                                // 32: "y"
          }
          else
          {
            v37 = 0x21;                                // 33: "ies"
          }
          v38 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v37);
          v39 = v71;
          sprintf(
            v67,
            (const char *)v71[0x13].i,
            V_SpecNames[V_Game.races[byte_104BEA].Unknown_01],
            s[byte_104BEA],
            v38,
            v65,
            v66);
          v40 = v67;
          v41 = (char *)v39[0x13].i;
          do
          {
            v42 = *v40;
            *v41 = *v40;
            if ( !v42 )
            {
              break;
            }
            v43 = v40[1];
            v40 += 2;
            v41[1] = v43;
            v41 += 2;
          }
          while ( v43 );
          *(_WORD *)((char *)&v71[0x13].sendParam2 + 1) = 0x1D;
          *(_WORD *)((char *)&v71[0x13].sendParam2 + 3) = V_Game.planet->size + 5 * V_Game.planet->type;
          v44 = v67;
          v45 = v71;
          sprintf(v67, *(const char **)&v71[0x13].childrenCnt, V_Game.planet->name);
          v46 = *(char **)&v45[0x13].childrenCnt;
          do
          {
            v47 = *v44;
            *v46 = *v44;
            if ( !v47 )
            {
              break;
            }
            v48 = v44[1];
            v44 += 2;
            v46[1] = v48;
            v46 += 2;
          }
          while ( v48 );
          sub_56B60(&V_Type3_stru_10AE70, 5, 0, 0);
          *(_BYTE *)(v76 + 0xAB) = 0xFF;
        }
        else
        {
          v49 = sub_34B0C(V_Game.planet, *(unsigned __int16 *)(v76 + 0xAE), v23, 2u);
          if ( *(_BYTE *)(v76 + 0xAB) == 0x17 && v49 == 0xFFFFFFFF )
          {
            *(_WORD *)(v76 + 0xB0) = *(_WORD *)(v76 + 0xAE);
          }
          *(_BYTE *)(v76 + 0xAB) = 0xFF;
        }
      }
    }
  }
  (*(void (**)(void))(*(_DWORD *)(v76 + 0xA7) + 8))();
  return 0;
}
// 37B38: conditional instruction was optimized away because ch.1!=FF
// 96850: using guessed type char *off_96850[5];
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// 10467C: using guessed type int dword_10467C;
// 37568: using guessed type int s[7];

//----- (000384B0) --------------------------------------------------------
void __fastcall sub_384B0(int a1)
{
  int v2; // eax
  void *ShapeTable_sub_1B084; // eax
  void *v4; // eax
  void *v5; // eax
  char v6; // ah
  int v7; // ebx
  unsigned int v8; // eax
  unsigned __int8 *a; // edx
  unsigned __int16 v10; // di
  int v11; // esi
  int v12; // eax
  LONG v13; // ebx
  LONG v14; // ecx
  int v15; // eax
  T_HazeTables *hazeTables; // edx
  T_HazeTables *v17; // eax
  int v18; // esi
  int v19; // eax
  LONG v20; // edx
  LONG v21; // ebx
  int v22; // eax
  int i; // esi
  int v24; // eax
  LONG v25; // edi
  LONG v26; // edx
  int v27; // eax
  unsigned __int16 v28; // di
  void *v29; // esi
  int v30; // esi
  unsigned __int8 v31; // al
  void *v32; // eax
  int v33; // eax
  unsigned int v34; // eax
  UBYTE byte57; // dl
  LONG v36; // esi
  int v37; // edx
  char *v38; // edx
  unsigned __int16 v39; // si
  int v40; // eax
  LONG v41; // esi
  int v42; // ecx
  int v43; // edi
  unsigned __int8 v44; // al
  void *v45; // eax
  BOOL v46; // edi
  void *v47; // eax
  void *v48; // [esp-24h] [ebp-3B8h]
  void *v49; // [esp-24h] [ebp-3B8h]
  LONG v50; // [esp-20h] [ebp-3B4h]
  LONG v51; // [esp-20h] [ebp-3B4h]
  LONG v52; // [esp-20h] [ebp-3B4h]
  LONG v53; // [esp-1Ch] [ebp-3B0h]
  LONG v54; // [esp-1Ch] [ebp-3B0h]
  LONG v55; // [esp-1Ch] [ebp-3B0h]
  LONG v56; // [esp-18h] [ebp-3ACh]
  LONG v57; // [esp-18h] [ebp-3ACh]
  LONG v58; // [esp-18h] [ebp-3ACh]
  LONG v59; // [esp-Ch] [ebp-3A0h]
  LONG v60; // [esp-Ch] [ebp-3A0h]
  LONG v61; // [esp-8h] [ebp-39Ch]
  LONG v62; // [esp-4h] [ebp-398h]
  UBYTE v63[256]; // [esp+0h] [ebp-394h] BYREF
  UBYTE s[256]; // [esp+100h] [ebp-294h] BYREF
  LONG x0; // [esp+200h] [ebp-194h] BYREF
  LONG y0[5]; // [esp+204h] [ebp-190h]
  int v67; // [esp+218h] [ebp-17Ch]
  int v68; // [esp+21Ch] [ebp-178h]
  LONG v69; // [esp+230h] [ebp-164h]
  int v70; // [esp+234h] [ebp-160h]
  int v71; // [esp+248h] [ebp-14Ch]
  int v72; // [esp+24Ch] [ebp-148h]
  LONG x1; // [esp+260h] [ebp-134h] BYREF
  LONG y1[5]; // [esp+264h] [ebp-130h]
  int v75; // [esp+278h] [ebp-11Ch]
  int v76; // [esp+27Ch] [ebp-118h]
  int v77; // [esp+280h] [ebp-114h]
  LONG v78; // [esp+290h] [ebp-104h]
  int v79; // [esp+294h] [ebp-100h]
  int v80; // [esp+298h] [ebp-FCh]
  int v81; // [esp+2A8h] [ebp-ECh]
  int v82; // [esp+2ACh] [ebp-E8h]
  int v83; // [esp+2B0h] [ebp-E4h]
  PANE v84; // [esp+2C0h] [ebp-D4h] BYREF
  PANE pane; // [esp+2D4h] [ebp-C0h] BYREF
  PANE v86; // [esp+2E8h] [ebp-ACh] BYREF
  PANE v87; // [esp+2FCh] [ebp-98h] BYREF
  int v88; // [esp+310h] [ebp-84h]
  int v89; // [esp+314h] [ebp-80h]
  int v90; // [esp+318h] [ebp-7Ch]
  int v91; // [esp+31Ch] [ebp-78h]
  int v92; // [esp+320h] [ebp-74h]
  LONG v93; // [esp+324h] [ebp-70h]
  int v94; // [esp+328h] [ebp-6Ch]
  void *shape_table; // [esp+32Ch] [ebp-68h]
  int word18; // [esp+330h] [ebp-64h]
  int v97; // [esp+334h] [ebp-60h]
  int v98; // [esp+338h] [ebp-5Ch]
  int v99; // [esp+33Ch] [ebp-58h]
  LONG shape_number; // [esp+340h] [ebp-54h]
  int v101; // [esp+344h] [ebp-50h]
  LONG v102; // [esp+348h] [ebp-4Ch]
  unsigned __int8 *v103; // [esp+34Ch] [ebp-48h]
  int v104; // [esp+350h] [ebp-44h]
  int v105; // [esp+354h] [ebp-40h]
  int v106; // [esp+358h] [ebp-3Ch]
  LONG hotX; // [esp+35Ch] [ebp-38h]
  int v108; // [esp+360h] [ebp-34h]
  int v109; // [esp+364h] [ebp-30h]
  int v110; // [esp+368h] [ebp-2Ch] BYREF
  unsigned int v111; // [esp+36Ch] [ebp-28h]
  int v112; // [esp+370h] [ebp-24h]
  int v113; // [esp+374h] [ebp-20h]
  LONG v114; // [esp+378h] [ebp-1Ch] BYREF
  unsigned __int8 v115; // [esp+37Ch] [ebp-18h]

  shape_number = V_Game.planet->size;
  LOWORD(v2) = V_Game.planet->type;
  v112 = (unsigned __int16)word_FFEF8;
  v2 = (unsigned __int16)v2;
  LOWORD(v2) = *(_WORD *)(a1 + 2 * (unsigned __int16)v2 + 0x175);
  v110 = v2;
  if ( *(__int16 *)(a1 + 0x1E) != 0xFFFFFFFF )
  {
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                             (unsigned int)&V_Type3_stru_10AE70.t13,
                             (unsigned __int16)v112);
    VFX_shape_draw((PANE *)(a1 + 4), ShapeTable_sub_1B084, 4, 7, 0x73);
    if ( (*(_BYTE *)(a1 + 0x18B) & 4) != 0 )
    {
      v4 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v110);
      VFX_shape_draw((PANE *)(a1 + 4), v4, shape_number, 0x198, 0x128);
    }
    v59 = *(__int16 *)(a1 + 0x1E);
    v5 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v112);
    VFX_shape_draw((PANE *)(a1 + 4), v5, v59, 0, 0);
    sub_552CC(&V_Type3_stru_10AE70, (PANE *)(a1 + 4));
  }
  v87 = *(PANE *)(a1 + 4);
  v6 = *(_BYTE *)(a1 + 0xAB);
  v111 = 0xFFFF;
  if ( v6 != (char)0xFF )
  {
    v111 = 0xFFFE;
    v7 = *(unsigned __int16 *)(a1 + 0xAC);
    if ( (unsigned __int16)v7 != 0xFFFF && *((_BYTE *)V_Game.planet->a + 4 * v7 + 1) == 0xFF )
    {
      v8 = sub_34368(V_Game.planet, *(_BYTE *)(a1 + 0xAB), v7);
      if ( v8 )
      {
        LOWORD(v8) = *(_WORD *)(a1 + 0xAC);
        v111 = v8;
      }
    }
  }
  a = (unsigned __int8 *)V_Game.planet->a;
  v114 = 0xFFFF;
  v103 = a;
  LOBYTE(a) = V_Game.planet->byte57;
  word18 = 0;
  if ( (_BYTE)a == byte_104BEA || sub_35930(V_Game.planet, 0xB) == 0xFFFF )
  {
    v105 = 0x6E;
    v92 = 0x19A;
    v106 = 0xF * shape_number;
    do
    {
      v90 = *(&V_PlanetCfg.room1[0].a0 + v106);
      v99 = v92;
      v94 = v106;
      v104 = v105;
      while ( *(&V_PlanetCfg.room1[0].a0 + v94) + *(&V_PlanetCfg.room2[0].a0 + v94) > v90 )
      {
        x1 = 0x22 * v90 + v99;
        v75 = x1 + 0x22;
        v78 = x1;
        v81 = x1 - 0x22;
        y1[0] = 0x11 * v90 + v104;
        v76 = y1[0] + 0x11;
        v79 = y1[0] + 0x22;
        v82 = y1[0] + 0x11;
        v83 = 0x960000;
        v80 = 0x960000;
        v77 = 0x960000;
        y1[1] = 0x960000;
        HIWORD(v33) = HIWORD(v103);
        v115 = v103[1];
        LOWORD(v33) = *v103;
        v113 = v33;
        v88 = dword_96864[0];
        v89 = dword_96864[1];
        v34 = sub_34368(V_Game.planet, 0xFFu, word18);
        if ( *(unsigned __int16 *)(a1 + 0xAC) == word18
          && *(_BYTE *)(a1 + 0xAB) == 0xFF
          && v115 == 0xFF
          && v34 == 0xFFFFFFFF )
        {
          sub_61800(&V_Type6_stru_D8654.pane.window, 4, (int)&x1);
          goto LABEL_34;
        }
        if ( (*(_BYTE *)(a1 + 0x18B) & 1) != 0 )
        {
          v10 = 0xC;
          v109 = 0xD;
          if ( !(_WORD)v113 )
          {
            v109 = 7;
            v10 = 0;
          }
          switch ( (unsigned __int16)v113 )
          {
            case 2u:
              v10 = 0x75;
              v109 = 8;
              break;
            case 3u:
              v10 = 0x92;
              v109 = 9;
              break;
            case 4u:
              v10 = 0xFF;
              v109 = 0xA;
              break;
          }
          if ( v34 == 0xFFFFFFFF )
          {
            x0 = x1;
            y0[0] = y1[0] + 1;
            v67 = v75 - 2;
            v68 = v76;
            v69 = v78;
            v70 = v79 - 1;
            v71 = v81 + 2;
            v11 = 0;
            v72 = v82;
            do
            {
              v12 = 6 * *((char *)&v89 + v11);
              v13 = y0[v12];
              v14 = y0[v12 - 1];
              v15 = 6 * *((char *)&v88 + v11++);
              VFX_line_draw(&V_Type6_stru_D8654.pane, y0[v15 - 1], y0[v15], v14, v13, 0, v10);
            }
            while ( v11 < 4 );
            if ( (_WORD)v109 )
            {
              hazeTables = V_Type6_stru_D8654.hazeTables;
              v17 = (T_HazeTables *)((unsigned __int16)v109 << 8);
LABEL_33:
              sub_62DA5((WINDOW *)&V_Type6_stru_D8654.pane, 4, (int)&x0, (int)v17 + (_DWORD)hazeTables);
            }
          }
          else
          {
            x0 = x1;
            y0[0] = y1[0] + 0xE;
            v67 = v75 - 0x1C;
            v68 = v76;
            v69 = v78;
            v70 = v79 - 0xE;
            v71 = v81 + 0x1C;
            v18 = 0;
            v72 = v82;
            do
            {
              v19 = 6 * *((char *)&v89 + v18);
              v20 = y0[v19];
              v21 = y0[v19 - 1];
              v22 = 6 * *((char *)&v88 + v18++);
              VFX_line_draw(&V_Type6_stru_D8654.pane, y0[v22 - 1], y0[v22], v21, v20, 0, v10);
            }
            while ( v18 < 4 );
            if ( (_WORD)v109 )
            {
              v17 = V_Type6_stru_D8654.hazeTables;
              hazeTables = (T_HazeTables *)((unsigned __int16)v109 << 8);
              goto LABEL_33;
            }
          }
        }
LABEL_34:
        if ( *(unsigned __int16 *)(a1 + 0xAC) == word18 && *(_BYTE *)(a1 + 0xAB) == 0xFF && v115 == 0xFF )
        {
          for ( i = 0; i < 4; ++i )
          {
            v24 = 6 * *((char *)&v89 + i);
            v25 = y1[v24];
            v26 = y1[v24 - 1];
            v27 = 6 * *((char *)&v88 + i);
            VFX_line_draw(&V_Type6_stru_D8654.pane, y1[v27 - 1], y1[v27], v26, v25, 0, 0x96);
          }
        }
        if ( v115 == 0xFF && (v113 & 8) == 0 )
        {
          if ( (unsigned __int16)v111 == word18 )
          {
            sub_39390(a1, *(_BYTE *)(a1 + 0xAB), (__int16 *)&v110, &v114);
            v62 = y1[0];
            v61 = x1;
            v60 = (unsigned __int16)v114;
            v32 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v110);
            VFX_shape_draw(&V_Type6_stru_D8654.pane, v32, v60, v61, v62);
          }
        }
        else
        {
          v28 = word18;
          sub_393F4(a1, word18, &v110, &v114);
          v29 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v110);
          shape_table = v29;
          if ( V_Game.planet->word52 == word18 )
          {
            sub_61800(&V_Type6_stru_D8654.pane.window, 4, (int)&x1);
            v30 = 0x22 * V_Game.planet->buildingProgress;
            v108 = v30 / (unsigned __int16)Q_GetPlanetItemCost_sub_3583C(V_Game.planet, v28, 0xFFu);
            v31 = 0xF2;
            if ( *(unsigned __int16 *)(a1 + 0xAC) == word18 )
            {
              v31 = 0x96;
            }
            memset(s, v31, sizeof(s));
            VFX_shape_lookaside(s);
            VFX_shape_translate_draw(&V_Type6_stru_D8654.pane, shape_table, (unsigned __int16)v114, x1, y1[0]);
            pane = V_Type6_stru_D8654.pane;
            pane.y0 = y1[0] + 0x22 - v108;
            if ( *(unsigned __int16 *)(a1 + 0xAC) == word18 )
            {
              VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[0x15]);
              VFX_shape_translate_draw(&pane, shape_table, (unsigned __int16)v114, x1, y1[0] - pane.y0);
            }
            else
            {
              VFX_shape_draw(&pane, shape_table, (unsigned __int16)v114, x1, y1[0] - pane.y0);
            }
          }
          else if ( *(unsigned __int16 *)(a1 + 0xAC) == word18 )
          {
            VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[0x15]);
            VFX_shape_translate_draw(&V_Type6_stru_D8654.pane, v29, (unsigned __int16)v114, x1, y1[0]);
          }
          else
          {
            VFX_shape_draw(&V_Type6_stru_D8654.pane, v29, (unsigned __int16)v114, x1, y1[0]);
          }
        }
        ++v90;
        ++word18;
        v103 += 4;
      }
      v105 += 0x11;
      v92 -= 0x22;
      ++v106;
    }
    while ( v105 != 0x16D );
  }
  v93 = 0xD;
  byte57 = V_Game.planet->byte57;
  v102 = 0x77;
  v97 = 0;
  if ( byte57 != byte_104BEA && sub_35930(V_Game.planet, 0x19) != 0xFFFF )
  {
    v97 = 0xFFFFFFFF;
  }
  word18 = V_Game.planet->word18;
  v91 = 4 * word18;
  hotX = v93 + 0x23;
  while ( V_Game.planet->word1A > word18 )
  {
    v38 = (char *)V_Game.planet->a + v91;
    v98 = 0;
    v39 = (unsigned __int8)v38[1];
    if ( v38[1] == 0x17 && sub_35A70(V_Game.planet, word18)->raceIndex == byte_104BEA )
    {
      v98 = 0xFFFFFFFF;
    }
    if ( *(unsigned __int16 *)(a1 + 0xAC) == word18 )
    {
      HIWORD(v40) = HIWORD(word18);
      LOWORD(v40) = v39;
      if ( v40 == 0xFF && !v97 && *(_BYTE *)(a1 + 0xAB) == 0xFF )
      {
        v87.x0 = v93;
        v87.y0 = v102;
        v87.x1 = v93 + 0x46;
        v87.y1 = v102 + 0x46;
        sub_2BB74(&v87, 1, 1, 0x45, 0x45, 0x96u, 0);
      }
    }
    v101 = v39;
    if ( v39 == 0xFF )
    {
      if ( (unsigned __int16)v111 == word18 )
      {
        v36 = (LONG)sub_10000;
        if ( *(_BYTE *)(a1 + 0xAB) == 0x17 )
        {
          v36 = 0x8000;
        }
        sub_39390(a1, *(_BYTE *)(a1 + 0xAB), (__int16 *)&v110, &v114);
        v56 = v102 + 0x23;
        v53 = hotX;
        v50 = (unsigned __int16)v114;
        v48 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v110);
        VFX_shape_transform(&V_Type6_stru_D8654.pane, v48, v50, v53, v56, V_BigBuffer, 0, v36, v36, 0);
      }
    }
    else
    {
      sub_393F4(a1, word18, &v110, &v114);
      v84 = *(PANE *)(a1 + 4);
      v41 = (LONG)sub_10000;
      if ( v101 == 0x17 )
      {
        v41 = 0x8000;
      }
      if ( V_Game.planet->word52 == word18 )
      {
        v42 = 0x46 * V_Game.planet->buildingProgress;
        v43 = v42 / (unsigned __int16)Q_GetPlanetItemCost_sub_3583C(V_Game.planet, word18, 0xFFu);
        v44 = 0xF2;
        if ( *(unsigned __int16 *)(a1 + 0xAC) == word18 )
        {
          v44 = 0x96;
        }
        memset(v63, v44, sizeof(v63));
        if ( !v97 || v98 == 0xFFFFFFFF )
        {
          VFX_shape_lookaside(v63);
          v57 = v102 + 0x23;
          v54 = hotX;
          v51 = (unsigned __int16)v114;
          v45 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v110);
          VFX_shape_transform(&V_Type6_stru_D8654.pane, v45, v51, v54, v57, V_BigBuffer, 0, v41, v41, 1);
        }
        v84.y0 = v102 + 0x46 - v43;
      }
      if ( !v97 || v98 == 0xFFFFFFFF )
      {
        v46 = *(unsigned __int16 *)(a1 + 0xAC) == word18;
        VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[0x15]);
        v58 = v102 + 0x23 - v84.y0;
        v55 = hotX;
        v52 = (unsigned __int16)v114;
        v49 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v110);
        VFX_shape_transform(&v84, v49, v52, v55, v58, V_BigBuffer, 0, v41, v41, v46);
      }
    }
    v37 = (word18 - V_Game.planet->word18) % 5;
    v102 += 0x46;
    if ( v37 == 4 )
    {
      v102 = 0x77;
      hotX += 0x46;
      v93 += 0x46;
    }
    v91 += 4;
    ++word18;
  }
  if ( Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "PLANLIST", 0)->i == 0xFFFFFFFF )
  {
    v86.window = (WINDOW *)&V_Type6_stru_D8654;
    v86.x0 = 0x70;
    v86.y0 = 0x70;
    v86.y1 = 0x1AC;
    v86.x1 = 0x210;
    v47 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v112);
    VFX_shape_draw(&v86, v47, 5, 0, 0);
  }
  sub_2D218((_DWORD *)a1);
}
// 10000: using guessed type void __noreturn sub_10000();
// 96864: using guessed type _DWORD dword_96864[2];
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// 384B0: using guessed type _DWORD var_D4[2];

//----- (00039390) --------------------------------------------------------
char __fastcall sub_39390(int a1, unsigned __int8 a2, __int16 *a3, _WORD *a4)
{
  __int16 v4; // ax

  if ( a2 >= 0x27u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planwin.cpp", 0x461);
  }
  *a3 = word_FFEDC;
  *a4 = 0;
  LOBYTE(v4) = a2;
  *a4 = a2;
  if ( a2 == 0x17 )
  {
    v4 = word_FFEBC[V_Game.planet->byte57];
    *a3 = v4;
    *a4 = 0;
  }
  return v4;
}
// 393C3: conditional instruction was optimized away because dl.1<27u
// FFEBC: using guessed type __int16 word_FFEBC[7];

//----- (000393F4) --------------------------------------------------------
__int16 __fastcall sub_393F4(int a1, unsigned __int16 a2, _WORD *a3, _WORD *a4)
{
  T_Planet *planet; // eax
  _BYTE *v6; // eax
  __int16 v7; // dx
  __int16 result; // ax
  T_Ship *v9; // esi

  if ( a2 >= V_Game.planet->word1A )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\planwin.cpp", 0x476);
  }
  *a3 = word_FFEDC;
  planet = V_Game.planet;
  *a4 = 0;
  v6 = (char *)planet->a + 4 * a2;
  v7 = (unsigned __int8)v6[1];
  if ( (unsigned __int8)v7 == 0xFF )
  {
    if ( (*v6 & 8) != 0 )
    {
      *a4 = 0x27;
    }
  }
  else
  {
    *a4 = v7;
  }
  result = v7;
  if ( v7 == 0x17 )
  {
    v9 = sub_35A70(V_Game.planet, a2);
    *a3 = word_FFEBC[v9->raceIndex];
    if ( v9->Unknown_AA[0] < 0 || v9->Unknown_AA[0] >= 4 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\planwin.cpp", 0x48A);
    }
    result = v9->Unknown_AA[0];
    *a4 = result;
  }
  return result;
}
// FFEBC: using guessed type __int16 word_FFEBC[7];

//----- (000394BC) --------------------------------------------------------
char *__fastcall sub_394BC(int a1)
{
  T_TypeA1 *Wnd_sub_56DA8; // esi
  char *result; // eax
  WINDOW *window; // edx
  int v5; // ebp
  T_Ship *v6; // eax
  T_Planet *planet; // eax
  int v8; // edx

  Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "SHIPDESSCREEN", 0);
  dword_10467C = (int)&Wnd_sub_56DA8[1].pane.window[2].stencil;
  result = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x22);
  window = Wnd_sub_56DA8[1].pane.window;
  dword_104680 = result;
  if ( window )
  {
    if ( *(_DWORD *)&Wnd_sub_56DA8[1].name[2] == 0xFFFFFFFF )
    {
      dword_104680 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x23);
      planet = V_Game.planet;
      *((_BYTE *)V_Game.planet->a + 4 * *(unsigned __int16 *)(a1 + 0xB0) + 2) &= ~1u;
      sub_34B0C(planet, *(unsigned __int16 *)(a1 + 0xB0), 0x17u, 3u);
      v8 = sub_4EE00((int)Wnd_sub_56DA8);
      result = (char *)V_Game.planet;
      V_Game.planet->Unknown_77 = v8;
      LOBYTE(Wnd_sub_56DA8[1].pane.window[4].y_max) = 2;
      *(LONG *)((char *)&Wnd_sub_56DA8[1].pane.window[4].y_max + 1) = (LONG)result;
    }
  }
  else
  {
    v5 = *(_DWORD *)&Wnd_sub_56DA8[1].name[2];
    dword_10467C = 0;
    if ( !v5 )
    {
      v6 = sub_35A70(V_Game.planet, *(_WORD *)(a1 + 0xB0));
      sub_49940((int)v6);
      result = (char *)sub_34B0C(V_Game.planet, *(unsigned __int16 *)(a1 + 0xB0), 0xFFu, 1u);
    }
  }
  *(_WORD *)(a1 + 0xB0) = 0xFFFF;
  return result;
}
// 10467C: using guessed type int dword_10467C;

//----- (000395C4) --------------------------------------------------------
int __fastcall sub_395C4(int a1, unsigned int count, int a3)
{
  void *v5; // edx

  v5 = (void *)(a1 + 0x18B);
  if ( a3 == 0xFFFFFFFF )
  {
    return Q_ReadFile_sub_1BF94((P_FileInfo)count, v5, 1u);
  }
  else
  {
    return Q_CFILE_CPP_dos_write_sub_1C098((int *)count, v5, 1u);
  }
}

//----- (000395EC) --------------------------------------------------------
void __fastcall __spoils<> Q_A2_sub_395EC(P_TypeA2 result)
{
  Q_A2_sub_2C830(result);
  result->b = (int)off_95F6C;
}
// 95F6C: using guessed type int (*off_95F6C[5])();

//----- (000395FC) --------------------------------------------------------
int __fastcall sub_395FC(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95F44);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95F6C;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95F6C: using guessed type int (*off_95F6C[5])();

//----- (00039644) --------------------------------------------------------
unsigned int __fastcall sub_39644(int a1, __int16 a2, int a3, int a4)
{
  T_TypeA1 *v5; // eax
  T_TypeA1 *Wnd_sub_56DA8; // [esp+0h] [ebp-10h]

  Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "PLANLIST", 0);
  v5 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "PLSQUARE", 0);
  if ( (Wnd_sub_56DA8->i || v5->i) && a2 != 0xF && a2 != 0xE )
  {
    return 0;
  }
  if ( (unsigned __int16)a2 < 6u )
  {
    return sub_2F424(a1, a2, a3, a4);
  }
  if ( (unsigned __int16)a2 <= 6u )
  {
    (*(void (__fastcall **)(int, int))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 2);
  }
  else
  {
    if ( a2 != 7 )
    {
      return sub_2F424(a1, a2, a3, a4);
    }
    (*(void (__fastcall **)(int, int))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 1);
  }
  return 0;
}

//----- (000396F0) --------------------------------------------------------
void __fastcall sub_396F0(int a1, int a2)
{
  T_TypeA1 *Wnd_sub_56DA8; // esi
  T_TypeA1 *v3; // eax
  T_TypeA1 *v4; // ebp
  int v5; // eax
  LONG v6; // eax
  void *ShapeTable_sub_1B084; // eax
  LONG v8; // eax
  LONG v9; // ebp
  LONG v10; // edi
  int i; // esi
  void *v12; // eax
  LONG v13; // eax
  char *sub_1CEA8; // eax
  unsigned __int16 word52; // bx
  unsigned __int8 window; // cl
  char *v17; // edi
  char *v18; // esi
  char v19; // al
  char v20; // al
  UBYTE buildingPlanetItemIndex; // ch
  int DaysToCompletePlanetItem_sub_358BC; // esi
  UWORD flags; // ax
  int v24; // eax
  char *v25; // eax
  char *v26; // edi
  char *v27; // esi
  char v28; // al
  char v29; // al
  LONG v30; // edi
  unsigned __int16 v31; // bx
  PANE *v32; // esi
  void *v33; // eax
  void *v34; // eax
  char *v35; // ecx
  int v36; // ebx
  int *p_x0; // esi
  const char *v38; // ecx
  int *v39; // esi
  int v40; // edi
  int v41; // ecx
  int v42; // ebp
  int v43; // esi
  LONG v44; // edi
  LONG v45; // ebp
  int j; // esi
  LONG v47; // ecx
  LONG v48; // ebx
  LONG v49; // edx
  LONG v50; // [esp-10h] [ebp-A0h]
  LONG v51; // [esp-Ch] [ebp-9Ch]
  LONG v52; // [esp-8h] [ebp-98h]
  char *v53; // [esp+Ch] [ebp-84h]
  char s[60]; // [esp+10h] [ebp-80h] BYREF
  LONG hotX; // [esp+4Ch] [ebp-44h] BYREF
  LONG hotY; // [esp+50h] [ebp-40h] BYREF
  char *name; // [esp+54h] [ebp-3Ch]
  int v58; // [esp+58h] [ebp-38h]
  int v59; // [esp+5Ch] [ebp-34h]
  int v60; // [esp+60h] [ebp-30h]
  PANE *pane; // [esp+64h] [ebp-2Ch]
  PANE *v62; // [esp+68h] [ebp-28h]
  LONG v63; // [esp+6Ch] [ebp-24h]
  int v64; // [esp+70h] [ebp-20h] BYREF
  LONG shape_number; // [esp+74h] [ebp-1Ch] BYREF
  unsigned __int8 v66; // [esp+78h] [ebp-18h]

  v60 = a1;
  v58 = 0;
  if ( a2 != 2 && (*(_DWORD *)V_Type3_stru_10AE70.z1aa == *(_DWORD *)(a1 + 0x41) || a2 == 1) )
  {
    v58 = 0xFFFFFFFF;
  }
  Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "PLANLIST", 0);
  v3 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "PLSQUARE", 0);
  if ( Wnd_sub_56DA8->i || v3->i )
  {
    v58 = 0;
  }
  v59 = *(_DWORD *)(v60 + 0x47);
  if ( v59 == 4 )
  {
    v59 = 3;
  }
  if ( *(_WORD *)(v60 + 0x45) == 0x33 )
  {
    v59 = 4;
  }
  v4 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "PLANETALLOC", 0);
  v64 = 0xFFFF;
  shape_number = 0xFFFF;
  VFX_shape_lookaside((*V_Type6_stru_D8654.hazeTables)[0x15]);
  if ( v59 <= 2 )
  {
    VFX_pane_wipe((PANE *)(v60 + 4), 0);
  }
  HIWORD(v5) = HIWORD(v59);
  switch ( v59 )
  {
    case 0:
      LOWORD(v5) = word_FFEEC;
      v64 = v5;
      v63 = (int)pow((double)V_Game.planet->word46, 0.75);
      shape_number = v63;
      if ( (unsigned __int16)v63 > 0x14u )
      {
        shape_number = 0x14;
      }
      goto LABEL_23;
    case 1:
      LOWORD(v5) = word_FFEEE;
      v64 = v5;
      v63 = (int)pow((double)V_Game.planet->production, 0.75);
      shape_number = v63;
      if ( (unsigned __int16)v63 > 0x14u )
      {
        shape_number = 0x14;
      }
      goto LABEL_23;
    case 2:
      LOWORD(v5) = word_FFEF0;
      v64 = v5;
      HIWORD(v6) = HIWORD(V_Game.planet);
      LOWORD(v6) = V_Game.planet->word48;
      shape_number = v6;
      if ( (unsigned __int16)v6 > 0x14u )
      {
        shape_number = 0x14;
      }
LABEL_23:
      ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                               (unsigned int)&V_Type3_stru_10AE70.t13,
                               (unsigned __int16)v64);
      VFX_shape_draw((PANE *)(v60 + 4), ShapeTable_sub_1B084, (unsigned __int16)shape_number, 0, 0);
      goto LABEL_66;
    case 3:
      v8 = 0xF2;
      if ( v58 )
      {
        v8 = 0x96;
      }
      v9 = 0;
      v63 = v60 + 4;
      VFX_pane_wipe((PANE *)(v60 + 4), v8);
      v10 = 0;
      shape_number = 1;
      pane = (PANE *)(v60 + 4);
      for ( i = 0; i < V_Game.planet->word4A; ++i )
      {
        if ( i == (unsigned __int16)V_Game.planet->word4C )
        {
          ++shape_number;
        }
        if ( i == V_Game.planet->word42 )
        {
          ++shape_number;
        }
        v12 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEF8);
        VFX_shape_draw(pane, v12, (unsigned __int16)shape_number, v10, v9);
        v10 += 0xA;
        if ( i % 0xA == 9 )
        {
          v10 = 0;
          v9 += 0xA;
        }
      }
      goto LABEL_66;
    case 4:
      v13 = 0xF2;
      if ( v58 && V_Game.planet->byte57 == byte_104BEA )
      {
        v13 = 0x96;
      }
      VFX_pane_wipe((PANE *)(v60 + 4), v13);
      v66 = 0xFF;
      qmemcpy(s, &unk_9686C, sizeof(s));
      sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x24);// 36: "No Project"
      word52 = 0xFFFF;
      window = (unsigned __int8)v4[1].pane.window;
      name = sub_1CEA8;
      if ( window == 0xFF )
      {
        buildingPlanetItemIndex = V_Game.planet->buildingPlanetItemIndex;
        if ( buildingPlanetItemIndex != 0xFF )
        {
          DaysToCompletePlanetItem_sub_358BC = (unsigned __int16)Q_GetDaysToCompletePlanetItem_sub_358BC(V_Game.planet);
          flags = V_PlanetItems.item[buildingPlanetItemIndex].flags;
          v66 = buildingPlanetItemIndex;
          if ( (flags & 0x20) == 0 )
          {
            if ( DaysToCompletePlanetItem_sub_358BC == 0xFFFF )
            {
              v26 = s;
              v27 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x27);// 39: "No Progress"
              do
              {
                v28 = *v27;
                *v26 = *v27;
                if ( !v28 )
                {
                  break;
                }
                v29 = v27[1];
                v27 += 2;
                v26[1] = v29;
                v26 += 2;
              }
              while ( v29 );
            }
            else
            {
              if ( DaysToCompletePlanetItem_sub_358BC == 1 )
              {
                v24 = 0x1C;                            // 28: ""
              }
              else
              {
                v24 = 0x1D;                            // 29: "s"
              }
              v53 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v24);
              v25 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x26);// 38: "%d day%s until completion"
              sprintf(s, v25, DaysToCompletePlanetItem_sub_358BC, v53);
            }
          }
          if ( V_Game.planet->buildingPlanetItemIndex != 0x23 )
          {
            word52 = V_Game.planet->word52;
          }
        }
      }
      else
      {
        v17 = s;
        v18 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x25);// 37: "Pick a Location"
        v66 = window;
        do
        {
          v19 = *v18;
          *v17 = *v18;
          if ( !v19 )
          {
            break;
          }
          v20 = v18[1];
          v18 += 2;
          v17[1] = v20;
          v17 += 2;
        }
        while ( v20 );
      }
      if ( v66 == 0xFF )
      {
        if ( V_Game.planet->word42 != V_Game.planet->word4C )
        {
          goto LABEL_65;
        }
        v36 = 0x19;
        v32 = (PANE *)(v60 + 4);
        v35 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x28);// 40: "(No Free Population)"
      }
      else
      {
        if ( word52 == 0xFFFF )
        {
          sub_39390((int)v4, v66, (__int16 *)&v64, &shape_number);
        }
        else
        {
          sub_393F4((int)v4, word52, &v64, &shape_number);
        }
        v30 = (LONG)sub_10000;
        if ( v66 == 0x17 )
        {
          v30 = 0x8000;
        }
        v31 = shape_number;
        name = V_PlanetItems.item[v66].name;
        v32 = (PANE *)(v60 + 4);
        v33 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v64);
        Q_GSYSTEM_CPP_sub_2BC40(v32, v33, v31, &hotX, &hotY);
        v52 = hotY;
        v51 = hotX;
        v50 = (unsigned __int16)shape_number;
        v34 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v64);
        VFX_shape_transform(v32, v34, v50, v51, v52, V_BigBuffer, 0, v30, v30, 0);
        v35 = s;
        v36 = 0x50;
      }
      *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = v32->window;
      p_x0 = &v32->x0;
      V_Type3_stru_10AE70.rect.x1 = *p_x0++;
      V_Type3_stru_10AE70.rect.y1 = *p_x0++;
      V_Type3_stru_10AE70.rect.x2 = *p_x0;
      V_Type3_stru_10AE70.rect.y2 = p_x0[1];
      sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, v36, v35, 2, 0xFFFFFFFF, 0xFF, 0);
LABEL_65:
      v38 = name;
      *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = *(_DWORD *)(v60 + 4);
      v39 = (int *)(v60 + 8);
      V_Type3_stru_10AE70.rect.x1 = *(_DWORD *)(v60 + 8);
      V_Type3_stru_10AE70.rect.y1 = *++v39;
      V_Type3_stru_10AE70.rect.x2 = *++v39;
      V_Type3_stru_10AE70.rect.y2 = v39[1];
      sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0xA, v38, 2, 0xFFFFFFFF, 0xFF, 0);
LABEL_66:
      if ( v59 <= 2 && v58 && byte_104BEA == V_Game.planet->byte57 )
      {
        v40 = *(_DWORD *)(v60 + 0x10);
        v41 = *(_DWORD *)(v60 + 8);
        v42 = *(_DWORD *)(v60 + 0x14);
        v43 = *(_DWORD *)(v60 + 0xC);
        v62 = (PANE *)(v60 + 4);
        v44 = v40 - v41;
        v45 = v42 - v43;
        for ( j = 0; j < 3; ++j )
        {
          v47 = v44;
          v48 = j;
          v49 = j;
          --v44;
          sub_2BB74(v62, v49, v48, v47, v45--, 0x96u, 0);
        }
      }
      sub_552CC(&V_Type3_stru_10AE70, (PANE *)(v60 + 4));
      return;
    default:
      goto LABEL_66;
  }
}
// 10000: using guessed type void __noreturn sub_10000();
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEEC: using guessed type __int16 word_FFEEC;
// FFEEE: using guessed type __int16 word_FFEEE;
// FFEF0: using guessed type __int16 word_FFEF0;

//----- (00039D80) --------------------------------------------------------
T_TypeA2 *__fastcall sub_39D80(T_TypeA2 *a1)
{
  Q_A2_sub_2C830(a1);
  a1->b = (int)off_95FB8;
  sub_39DE0();
  return a1;
}
// 95FB8: using guessed type int (*off_95FB8[5])();

//----- (00039D9C) --------------------------------------------------------
int __fastcall sub_39D9C(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_95FA4);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_95FB8;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 95FB8: using guessed type int (*off_95FB8[5])();

//----- (00039DE0) --------------------------------------------------------
char *sub_39DE0()
{
  int v0; // ebx
  int i; // edx
  char *sub_1CEA8; // eax
  int v3; // edx
  int j; // ebx
  char *v5; // eax
  int v6; // ebx
  int k; // edx
  char *result; // eax

  v0 = 0x29;
  for ( i = 0; i != 5; dword_104684[i] = (int)sub_1CEA8 )
  {
    ++i;
    sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v0++);
  }
  v3 = 0x2E;
  for ( j = 0; j != 0xB; dword_104698[j] = (int)v5 )
  {
    ++j;
    v5 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v3++);
  }
  v6 = 0x39;
  for ( k = 0; k != 8; dword_1046C4[k] = (int)result )
  {
    ++k;
    result = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v6++);
  }
  return result;
}
// 104684: using guessed type int dword_104684[];
// 104698: using guessed type int dword_104698[];
// 1046C4: using guessed type int dword_1046C4[];

//----- (00039E3C) --------------------------------------------------------
unsigned int __fastcall sub_39E3C(int a1, __int16 dx0, int a3, int a4)
{
  int v4; // eax
  char v5; // cl
  int v7; // eax
  int v8; // esi
  int v9; // eax
  T_Ship *v10; // eax
  int v11; // esi
  int v12; // ebx
  int byte57; // edx
  int v14; // edi
  int v15; // ebx
  int v16; // edx
  int v17; // edi
  int v18; // ebx
  int v19; // esi
  int v20; // ecx
  int v21; // eax
  int v22; // ecx
  int v23; // edx
  int v24; // ecx
  char *v25; // esi
  char *v26; // edi
  char v27; // al
  char v28; // al
  int v29; // edi
  int v30; // ebx
  int v31; // edx
  int v32; // eax
  int v33; // ebx
  int v34; // edx
  int v35; // edi
  char *sub_1CEA8; // esi
  char *v37; // edi
  char v38; // al
  char v39; // al
  int v40; // edx
  int v41; // ecx
  int v42; // ebx
  char *v43; // edi
  char *v44; // esi
  int v45; // ebx
  char v46; // al
  char v47; // al
  int v48; // edi
  int v49; // eax
  T_Ship *v50; // eax
  T_Ship *v51; // eax
  unsigned int v52; // esi
  char *v53; // ebx
  T_TypeA1 *Wnd_sub_56DA8; // ecx
  int v55; // edi
  int v56; // eax
  int v57; // eax
  char *v58; // eax
  __int64 *v59; // esi
  _BYTE *i; // edi
  char v61; // al
  char v62; // al
  int v63; // [esp-4h] [ebp-144h]
  char *v64; // [esp-4h] [ebp-144h]
  __int64 s[35]; // [esp+0h] [ebp-140h] BYREF
  int v66; // [esp+118h] [ebp-28h]
  int a2; // [esp+11Ch] [ebp-24h] BYREF
  int v68; // [esp+120h] [ebp-20h]
  int v69; // [esp+124h] [ebp-1Ch]
  int v70; // [esp+128h] [ebp-18h]
  int v71; // [esp+12Ch] [ebp-14h]
  int v72; // [esp+130h] [ebp-10h]
  int v73; // [esp+134h] [ebp-Ch]
  _BYTE v74[6]; // [esp+138h] [ebp-8h]
  _BYTE savedregs[12]; // [esp+140h] [ebp+0h]

  v72 = a1;
  *(_WORD *)&v74[4] = dx0;
  v66 = a3;
  v69 = a4;
  v4 = *(unsigned __int16 *)(a1 + 0xAB);
  v5 = 0xFF;
  if ( (unsigned __int16)v4 != 0xFFFF )
  {
    v5 = *((_BYTE *)V_Game.planet->a + 4 * v4 + 1);
  }
  if ( *(_WORD *)&v74[4] < 0x33u )
  {
    if ( *(_WORD *)&v74[4] >= 4u )
    {
      if ( *(_WORD *)&v74[4] > 5u )
      {
        if ( *(_WORD *)&v74[4] >= 7u )
        {
          if ( *(_WORD *)&v74[4] <= 7u )
          {
            if ( *(_DWORD *)(v72 + 0x39) && *(_DWORD *)(v72 + 0x35) && *(_DWORD *)(v72 + 0x3D) )
            {
              (*(void (**)(void))(*(_DWORD *)(v72 + 0xA7) + 0x10))();
            }
            return 0xFFFFFFFF;
          }
          else
          {
            if ( *(_WORD *)&v74[4] != 0x32 )
            {
              return sub_2F424(v72, *(__int16 *)&savedregs[4], v66, v69);
            }
            dword_104684[0] = v66;
            *(_WORD *)(v72 + 0xAB) = v69;
            return 0;
          }
        }
        if ( *(_DWORD *)(v72 + 0x39) && *(_DWORD *)(v72 + 0x35) && *(_DWORD *)(v72 + 0x3D) )
        {
          (*(void (**)(void))(*(_DWORD *)(v72 + 0xA7) + 0xC))();
        }
      }
      return 0xFFFFFFFF;
    }
    if ( !*(_WORD *)&v74[4] )
    {
      return sub_2F424(v72, *(__int16 *)&savedregs[4], v66, v69);
    }
    if ( *(_WORD *)&v74[4] <= 1u )
    {
      v7 = v72;
      *(_DWORD *)(v72 + 0x39) = 0xFFFFFFFF;
      v8 = dword_104684[0];
      *(_DWORD *)(v7 + 0x35) = 0xFFFFFFFF;
      if ( v8 == 3 )
      {
        HIWORD(v9) = 0;
        v70 = 0;
        if ( v5 == (char)0xFF )
        {
          v20 = 0;
          while ( (_BYTE)v20 == 5 || !sub_34368(V_Game.planet, v20, *(_WORD *)(v72 + 0xAB)) )
          {
            if ( ++v20 >= 0x27 )
            {
              goto LABEL_37;
            }
          }
          v21 = v70 + 1;
          *((_DWORD *)&s[0x18] + v21 + 1) = 0x36;
          v70 = v21;
        }
        else
        {
          if ( v5 == 0x17 )
          {
            LOWORD(v9) = *(_WORD *)(v72 + 0xAB);
            if ( (*((_WORD *)V_Game.planet->a + 2 * v9 + 1) & 1) != 0 )
            {
              v10 = sub_35A70(V_Game.planet, *(_WORD *)(v72 + 0xAB));
              v11 = (int)v10;
              if ( !v10 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\psqwin.cpp", 0x79);
              }
              if ( sub_4937C((int)v10, 0x47) != 0xFFFFFFFF && V_Game.planet->byte57 == 0xFF )
              {
                v12 = v70 + 1;
                *((_DWORD *)&s[0x19] + v70) = 0x34;
                v70 = v12;
              }
              if ( sub_4937C(v11, 0x49) != 0xFFFFFFFF )
              {
                byte57 = V_Game.planet->byte57;
                if ( byte57 != 0xFF && (_BYTE)byte57 != byte_104BEA )
                {
                  v14 = v70 + 1;
                  *((_DWORD *)&s[0x19] + v70) = 0x39;
                  v70 = v14;
                }
              }
              *((_DWORD *)&s[0x19] + v70) = 0x37;
              v15 = v70;
              v16 = sub_35930(V_Game.planet, 0x18);
              v70 = v15 + 1;
              if ( (unsigned __int16)v16 != 0xFFFF
                && (*((_WORD *)V_Game.planet->a + 2 * v16 + 1) & 1) != 0
                && byte_104BEA == V_Game.planet->byte57 )
              {
                v17 = v70 + 1;
                *((_DWORD *)&s[0x19] + v70) = 0x38;
                v70 = v17;
              }
            }
          }
          if ( v5 != 5 )
          {
            v18 = v70 + 1;
            *((_DWORD *)&s[0x19] + v70) = 0x35;
            v70 = v18;
          }
          if ( sub_34368(V_Game.planet, 0x23u, *(_WORD *)(v72 + 0xAB)) )
          {
            v19 = v70 + 1;
            *((_DWORD *)&s[0x19] + v70) = 0x3A;
            v70 = v19;
          }
        }
LABEL_37:
        *(_DWORD *)v74 = 0xA0;
        v22 = v70 + 1;
        *((_DWORD *)&s[0x19] + v70) = 0x33;
        v70 = v22;
        if ( v22 > 0 )
        {
          v71 = v22;
          v73 = 0;
          v68 = 4 * v22;
          do
          {
            v23 = v73;
            v24 = *(_DWORD *)(v73 + *(_DWORD *)(v72 + 0x67));
            v25 = (char *)*((_DWORD *)&V_PlanetCfg.room1[4].a8 + *(_DWORD *)((char *)&s[0x19] + v73));
            v26 = (char *)(v24 + 0x20);
            do
            {
              v27 = *v25;
              *v26 = *v25;
              if ( !v27 )
              {
                break;
              }
              v28 = v25[1];
              v25 += 2;
              v26[1] = v28;
              v26 += 2;
            }
            while ( v28 );
            v29 = v71;
            *(_WORD *)(v24 + 0x45) = *(_WORD *)((char *)&s[0x19] + v23);
            v30 = *(_DWORD *)v74;
            v31 = 0x1DF - *(_DWORD *)v74;
            *(_DWORD *)(v24 + 8) = *(_DWORD *)v74;
            *(_DWORD *)(v24 + 0xC) = 0x151;
            *(_DWORD *)(v24 + 0x14) = 0x16F;
            *(_DWORD *)v74 = v31 / v29 + v30;
            if ( *(int *)v74 > 0x1DF )
            {
              *(_DWORD *)v74 = 0x1DF;
            }
            v32 = *(_DWORD *)v74;
            v33 = *(__int16 *)&savedregs[4];
            v63 = v69;
            *(_DWORD *)(v24 + 0x10) = *(_DWORD *)v74;
            v34 = *(_DWORD *)(v24 + 0x41);
            *(_DWORD *)v74 = v32 + 1;
            sub_56D30(&V_Type3_stru_10AE70, v34, v33, v66, v63);
            --v71;
            v73 += 4;
          }
          while ( v73 < v68 );
        }
        if ( v70 == 1 )
        {
          v35 = v72;
          sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1E);// 30: "OK"
          v37 = (char *)(**(_DWORD **)(v35 + 0x67) + 0x20);
          do
          {
            v38 = *sub_1CEA8;
            *v37 = *sub_1CEA8;
            if ( !v38 )
            {
              break;
            }
            v39 = sub_1CEA8[1];
            sub_1CEA8 += 2;
            v37[1] = v39;
            v37 += 2;
          }
          while ( v39 );
        }
      }
      else
      {
        v40 = **(_DWORD **)(v7 + 0x67);
        *(_DWORD *)(v40 + 8) = 0xA0;
        *(_DWORD *)(v40 + 0xC) = 0x151;
        v41 = v66;
        *(_DWORD *)(v40 + 0x10) = 0x1DF;
        v42 = *(_DWORD *)&v74[2];
        *(_DWORD *)(v40 + 0x14) = 0x16F;
        v43 = (char *)(v40 + 0x20);
        v44 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1E);// 30: "OK"
        v45 = v42 >> 0x10;
        do
        {
          v46 = *v44;
          *v43 = *v44;
          if ( !v46 )
          {
            break;
          }
          v47 = v44[1];
          v44 += 2;
          v43[1] = v47;
          v43 += 2;
        }
        while ( v47 );
        v48 = v69;
        *(_WORD *)(v40 + 0x45) = 0x33;
        sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v40 + 0x41), v45, v41, v48);
      }
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(v72 + 0xA7) + 0xC))(v72, 0);
      return 0;
    }
    else
    {
      if ( *(_WORD *)&v74[4] != 2 )
      {
        return sub_2F424(v72, *(__int16 *)&savedregs[4], v66, v69);
      }
      sub_2D258(v72, *(__int16 *)&savedregs[4]);
      v49 = v72;
      *(_DWORD *)(v72 + 0x39) = 0;
      *(_DWORD *)(v49 + 0x35) = 0;
      if ( *(_DWORD *)V_Type3_stru_10AE70.z1aa == *(_DWORD *)(v72 + 0x41) )
      {
        *(_DWORD *)V_Type3_stru_10AE70.z1aa = 0xFFFFFFFF;
      }
      sub_567BC(&V_Type3_stru_10AE70, *(_DWORD *)(v72 + 0x41), 0xFFFFFFFF);
      sub_564C0(&V_Type3_stru_10AE70, *(_DWORD *)(v72 + 0x41), 0xFFFFFFFF);
      return 0;
    }
  }
  else
  {
    if ( *(_WORD *)&v74[4] <= 0x33u )
    {
LABEL_88:
      sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v72 + 0x63), 0x32, 0xA, 0);
      return 0;
    }
    if ( *(_WORD *)&v74[4] < 0x37u )
    {
      if ( *(_WORD *)&v74[4] < 0x35u )
      {
        sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v72 + 0x63), 0x32, 0xC, 0);
        return 0;
      }
      else if ( *(_WORD *)&v74[4] <= 0x35u )
      {
        if ( v5 == 0x17 )
        {
          v50 = sub_35A70(V_Game.planet, *(_WORD *)(v72 + 0xAB));
          sub_49940((int)v50);
        }
        sub_34B0C(V_Game.planet, *(unsigned __int16 *)(v72 + 0xAB), 0xFFu, 1u);
        sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v72 + 0x63), 0x32, 0xA, 0);
        return 0;
      }
      else
      {
        sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v72 + 0x63), 0x32, 0xB, 0);
        return 0;
      }
    }
    else
    {
      if ( *(_WORD *)&v74[4] <= 0x37u )
      {
        v51 = sub_35A70(V_Game.planet, *(_WORD *)(v72 + 0xAB));
        sub_35C38(V_Game.planet, v51);
        sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v72 + 0x63), 0x32, 0xA, 0);
        return 0;
      }
      if ( *(_WORD *)&v74[4] < 0x39u )
      {
        sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v72 + 0x63), 0x32, 0xA, 0);
        sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v72 + 0x63), 0x34, *(unsigned __int16 *)(v72 + 0xAB), 1);
        return 0;
      }
      if ( *(_WORD *)&v74[4] > 0x39u )
      {
        if ( *(_WORD *)&v74[4] != 0x3A )
        {
          return sub_2F424(v72, *(__int16 *)&savedregs[4], v66, v69);
        }
        sub_34B0C(V_Game.planet, *(unsigned __int16 *)(v72 + 0xAB), 0x23u, 2u);
        goto LABEL_88;
      }
      v52 = sub_36CD4(V_Game.planet, *(_WORD *)(v72 + 0xAB), &a2);
      v53 = "invadefailure";
      Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "HELPWINDOW", 0);
      if ( v52 == 0xFFFFFFFF )
      {
        v53 = "invadesuccess";
      }
      v55 = sub_402E0(&V_Game.races[byte_104BEA].Unknown_00);
      sub_2FCB0(Wnd_sub_56DA8, "help.txt", v53);
      if ( v55 == 1 )
      {
        v56 = 0x20;                                    // 32: "y"
      }
      else
      {
        v56 = 0x21;                                    // 33: "ies"
      }
      v64 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v56);
      if ( a2 == 1 )
      {
        v57 = 0x1C;                                    // 28: ""
      }
      else
      {
        v57 = 0x1D;                                    // 29: "s"
      }
      v58 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v57);
      sprintf((char *)s, (const char *)Wnd_sub_56DA8[0x13].i, V_Game.planet->name, a2, v58, v55, v64);
      v59 = s;
      i = (_BYTE *)Wnd_sub_56DA8[0x13].i;
      do
      {
        v61 = *(_BYTE *)v59;
        *i = *(_BYTE *)v59;
        if ( !v61 )
        {
          break;
        }
        v62 = *((_BYTE *)v59 + 1);
        v59 = (__int64 *)((char *)v59 + 2);
        i[1] = v62;
        i += 2;
      }
      while ( v62 );
      *(_WORD *)((char *)&Wnd_sub_56DA8[0x13].sendParam2 + 1) = 0x1C;
      *(_WORD *)((char *)&Wnd_sub_56DA8[0x13].sendParam2 + 3) = 0x49;
      LOWORD(Wnd_sub_56DA8[0x13].children) = 0x1D;
      HIWORD(Wnd_sub_56DA8[0x13].children) = V_Game.planet->size + 5 * V_Game.planet->type;
      sub_56D30(&V_Type3_stru_10AE70, *(_DWORD *)(v72 + 0x63), 0x32, 0xA, 0);
      sub_56B60(&V_Type3_stru_10AE70, 5, 0, 0);
      return 0;
    }
  }
}
// 104684: using guessed type int dword_104684[];

//----- (0003A6BC) --------------------------------------------------------
void __fastcall sub_3A6BC(int a1)
{
  PANE *v1; // esi
  void *ShapeTable_sub_1B084; // eax
  int v3; // eax
  char *sub_1CEA8; // eax
  int byte57; // esi
  int v6; // edx
  int v7; // ebx
  char *v8; // eax
  int v9; // edx
  unsigned __int8 v10; // al
  UWORD production; // cx
  UWORD buildingProgress; // si
  unsigned __int16 PlanetItemCost_sub_3583C; // ax
  int v14; // eax
  UWORD word42; // dx
  UWORD word4A; // bx
  int v17; // eax
  unsigned __int16 v18; // bx
  char v19; // al
  char *v20; // edi
  char *v21; // esi
  char v22; // al
  char v23; // al
  T_Ship *v24; // eax
  char *v25; // eax
  const char *v26; // ebx
  char *v27; // eax
  unsigned __int16 v28; // dx
  UWORD v29; // cx
  UWORD v30; // si
  unsigned __int16 v31; // ax
  int v32; // eax
  int v33; // edx
  char *v34; // edi
  char *v35; // esi
  char v36; // al
  char v37; // al
  int v38; // eax
  char *v39; // eax
  char *v40; // edi
  char *v41; // esi
  char v42; // al
  char v43; // al
  char *v44; // eax
  char *v45; // edi
  char *v46; // esi
  char v47; // al
  char v48; // al
  char *v49; // edi
  char *v50; // esi
  char v51; // al
  char v52; // al
  char *v53; // edi
  char *v54; // esi
  char v55; // al
  char v56; // al
  char *v57; // eax
  char *v58; // eax
  char *v59; // edi
  char *v60; // esi
  char v61; // al
  char v62; // al
  char *v63; // edi
  char *v64; // esi
  char v65; // al
  char v66; // al
  char *v67; // eax
  char *v68; // eax
  char *v69; // ecx
  char *v70; // eax
  int v71; // eax
  char *v72; // eax
  T_ResItem *v73; // [esp-10h] [ebp-1AAh]
  __int16 v74; // [esp-Ch] [ebp-1A6h]
  char *v75; // [esp-Ch] [ebp-1A6h]
  char *v76; // [esp-Ch] [ebp-1A6h]
  char *v77; // [esp-8h] [ebp-1A2h]
  int v78; // [esp-8h] [ebp-1A2h]
  int v79; // [esp-8h] [ebp-1A2h]
  char *v80; // [esp-8h] [ebp-1A2h]
  int v81; // [esp-8h] [ebp-1A2h]
  char *v82; // [esp-4h] [ebp-19Eh]
  char *v83; // [esp-4h] [ebp-19Eh]
  char *v84; // [esp-4h] [ebp-19Eh]
  char *v85; // [esp-4h] [ebp-19Eh]
  int v86; // [esp-4h] [ebp-19Eh]
  int v87; // [esp-4h] [ebp-19Eh]
  int v88; // [esp-4h] [ebp-19Eh]
  char *v89; // [esp-4h] [ebp-19Eh]
  char v90[152]; // [esp+0h] [ebp-19Ah] BYREF
  char v91[100]; // [esp+98h] [ebp-102h] BYREF
  char v92[100]; // [esp+FCh] [ebp-9Eh] BYREF
  char s[52]; // [esp+160h] [ebp-3Ah] BYREF
  char v94[52]; // [esp+194h] [ebp-6h] BYREF
  int v95; // [esp+1C8h] [ebp+2Eh]
  int v96; // [esp+1CCh] [ebp+32h]
  int v97; // [esp+1D0h] [ebp+36h]
  int v98; // [esp+1D4h] [ebp+3Ah]
  int v99; // [esp+1D8h] [ebp+3Eh]
  char v100[20]; // [esp+1DCh] [ebp+42h] BYREF
  char *v101; // [esp+1F0h] [ebp+56h]
  T_ResItem *name; // [esp+1F4h] [ebp+5Ah]
  char *v103; // [esp+1F8h] [ebp+5Eh]
  char *format; // [esp+1FCh] [ebp+62h]
  char *v105; // [esp+200h] [ebp+66h]
  char *v106; // [esp+204h] [ebp+6Ah]
  int v107; // [esp+208h] [ebp+6Eh]
  char *v108; // [esp+20Ch] [ebp+72h]
  _DWORD *v109; // [esp+210h] [ebp+76h]
  int TurnsToComplete_sub_46C20; // [esp+214h] [ebp+7Ah]
  char *v111; // [esp+218h] [ebp+7Eh]

  v109 = (_DWORD *)a1;
  v1 = (PANE *)(a1 + 4);
  sub_552CC(&V_Type3_stru_10AE70, (PANE *)(a1 + 4));
  VFX_pane_wipe(v1, 0xF2);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           (unsigned __int16)word_FFEEA);
  v107 = 0;
  VFX_shape_draw(v1, ShapeTable_sub_1B084, 0, 0, 0);
  v95 = v109[1];
  v96 = v109[2];
  v97 = v109[3];
  v98 = v109[4];
  v99 = v109[5];
  v96 = v109[2] + 0xA;
  v97 = v109[3] + 0xA;
  v108 = 0;
  v3 = v109[2];
  name = 0;
  v106 = 0;
  v98 = v3 + 0x145;
  format = 0;
  TurnsToComplete_sub_46C20 = 0xFFFF;
  v99 = v109[3] + 0xCF;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = v95;
  V_Type3_stru_10AE70.rect.x1 = v96;
  V_Type3_stru_10AE70.rect.y1 = v97;
  V_Type3_stru_10AE70.rect.x2 = v98;
  V_Type3_stru_10AE70.rect.y2 = v99;
  *(_DWORD *)V_Type3_stru_10AE70.Unknown_305E = 0xFF;
  v111 = 0;
  switch ( dword_104684[0] )
  {
    case 0:
      sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x41);// 65: "Research"
      v108 = sub_1CEA8;
      LOWORD(sub_1CEA8) = V_Game.planet->word46;
      byte57 = V_Game.planet->byte57;
      v111 = sub_1CEA8;
      v6 = (unsigned __int16)V_ResTree.a.w1[byte57];
      if ( v6 != 0xFFFF )
      {
        v107 = 0xFFFFFFFF;
        name = &V_ResTree.items[v6];
        v7 = sub_469F0((int)&V_ResTree, byte57);
        TurnsToComplete_sub_46C20 = Q_GetTurnsToComplete_sub_46C20(
                                      V_ResTree.items[v6].cost,
                                      (unsigned __int16)word_106FB4[V_Game.planet->byte57],
                                      v7);
      }
      v106 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x42); // 66: "be discovered"
      format = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x43);// 67: "No progress is being made on %s."
      break;
    case 1:
      v8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x44);   // 68: "Industry"
      HIWORD(v9) = 0;
      v108 = v8;
      LOWORD(v8) = V_Game.planet->production;
      LOWORD(v9) = V_Game.planet->word52;
      v111 = v8;
      v10 = 0xFF;
      if ( (unsigned __int16)v9 != 0xFFFF )
      {
        v10 = *((_BYTE *)V_Game.planet->a + 4 * v9 + 1);
      }
      if ( v10 != 0xFF )
      {
        name = (T_ResItem *)V_PlanetItems.item[v10].name;
        v107 = 0xFFFFFFFF;
        production = V_Game.planet->production;
        buildingProgress = V_Game.planet->buildingProgress;
        PlanetItemCost_sub_3583C = Q_GetPlanetItemCost_sub_3583C(V_Game.planet, v9, 0xFFu);
        TurnsToComplete_sub_46C20 = Q_GetTurnsToComplete_sub_46C20(
                                      PlanetItemCost_sub_3583C,
                                      buildingProgress,
                                      production);
      }
      v106 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x45); // 69: "be completed"
      format = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x43);// 67: "No progress is being made on %s."
      break;
    case 2:
      v108 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x46); // 70: "Prosperity"
      HIWORD(v14) = HIWORD(V_Game.planet);
      LOWORD(v14) = V_Game.planet->word48;
      v111 = (char *)v14;
      name = (T_ResItem *)Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x47);// 71: "Population"
      v106 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x48); // 72: "grow"
      word42 = V_Game.planet->word42;
      word4A = V_Game.planet->word4A;
      v107 = 0xFFFFFFFF;
      if ( word42 >= word4A )
      {
        format = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x4A);// 74: "%s has no more room to grow."
      }
      else
      {
        TurnsToComplete_sub_46C20 = Q_GetTurnsToComplete_sub_46C20(
                                      V_PlanItem50,
                                      (unsigned __int16)V_Game.planet->z6,
                                      (unsigned __int16)V_Game.planet->word48);
        if ( (unsigned __int16)TurnsToComplete_sub_46C20 == 0xFFFF )
        {
          format = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x49);// 73: "%s is not growing."
        }
      }
      break;
    case 3:
      v17 = *(unsigned __int16 *)((char *)v109 + 0xAB);
      if ( (unsigned __int16)v17 != 0xFFFF )
      {
        HIBYTE(v18) = 0;
        v103 = (char *)V_Game.planet->a + 4 * v17;
        LOBYTE(v18) = v103[1];
        v105 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x4B);// 75: "White"
        v19 = *v103;
        v101 = 0;
        switch ( v19 & 7 )
        {
          case 0:
            v105 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x4C);// 76: "Black"
            break;
          case 2:
            v105 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x4D);// 77: "Red"
            v101 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x4E);// 78: "industry"
            break;
          case 3:
            v105 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x4F);// 79: "Green"
            v101 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x50);// 80: "prosperity"
            break;
          case 4:
            v105 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x51);// 81: "Blue"
            v101 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x52);// 82: "research"
            break;
          default:
            break;
        }
        if ( *(_WORD *)((char *)v109 + 0xAB) >= V_Game.planet->word18 )
        {
          v105 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x53);// 83: "Orbital"
        }
        if ( v18 == 0xFF )
        {
          if ( (*v103 & 8) != 0 && byte_104BEA == V_Game.planet->byte57 )
          {
            v40 = v92;
            v41 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x58);// 88: "Xenoarcheological Ruins"
            do
            {
              v42 = *v41;
              *v40 = *v41;
              if ( !v42 )
              {
                break;
              }
              v43 = v41[1];
              v41 += 2;
              v40[1] = v43;
              v40 += 2;
            }
            while ( v43 );
          }
          else
          {
            v84 = v105;
            v44 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x59);// 89: "%s Square"
            sprintf(v92, v44, v84);
          }
          sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0x14, v92, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
          if ( (*v103 & 8) == 0 )
          {
            if ( *(_WORD *)((char *)v109 + 0xAB) < V_Game.planet->word18 )
            {
              if ( (*v103 & 7) == 1 )
              {
                v49 = v90;
                v50 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x5B);// 91: "White squares are ordinary habitable surface squares."
                do
                {
                  v51 = *v50;
                  *v49 = *v50;
                  if ( !v51 )
                  {
                    break;
                  }
                  v52 = v50[1];
                  v50 += 2;
                  v49[1] = v52;
                  v49 += 2;
                }
                while ( v52 );
              }
              else if ( (*v103 & 7) != 0 )
              {
                v85 = v101;
                v77 = v105;
                v57 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x5D);// 93: "%s squares increase the effectiveness of %s-producing structures."
                sprintf(v90, v57, v77, v85);
              }
              else
              {
                v53 = v90;
                v54 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x5C);// 92: "Black squares are uninhabitable.  Most structures cannot be built on them."
                do
                {
                  v55 = *v54;
                  *v53 = *v54;
                  if ( !v55 )
                  {
                    break;
                  }
                  v56 = v54[1];
                  v54 += 2;
                  v53[1] = v56;
                  v53 += 2;
                }
                while ( v56 );
              }
            }
            else
            {
              v45 = v90;
              v46 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x5A);// 90: "Orbital squares are used for building orbital structures such as 
                                                       // Shipyards and Ships."
              do
              {
                v47 = *v46;
                *v45 = *v46;
                if ( !v47 )
                {
                  break;
                }
                v48 = v46[1];
                v46 += 2;
                v45[1] = v48;
                v45 += 2;
              }
              while ( v48 );
            }
            sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0xA, 0x50, v90, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
          }
        }
        else
        {
          v20 = s;
          v21 = V_PlanetItems.item[v18].name;
          do
          {
            v22 = *v21;
            *v20 = *v21;
            if ( !v22 )
            {
              break;
            }
            v23 = v21[1];
            v21 += 2;
            v20[1] = v23;
            v20 += 2;
          }
          while ( v23 );
          if ( v18 == 0x17 )
          {
            v24 = sub_35A70(V_Game.planet, *(_WORD *)((char *)v109 + 0xAB));
            sprintf(s, "%s \"%s\"", V_PlanetItems.item[0x17].name, v24->name);
          }
          if ( (*((_WORD *)v103 + 1) & 2) != 0 )
          {
            v25 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x54);// 84: "Automated "
          }
          else
          {
            v25 = (char *)&unk_920AA;
          }
          v26 = v25;
          qmemcpy(v94, &unk_968A8, 0x32u);
          if ( *(_WORD *)((char *)v109 + 0xAB) < V_Game.planet->word18 )
          {
            v82 = v105;
            v27 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x55);// 85: " on %s Square"
            sprintf(v94, v27, v82);
          }
          sprintf(v91, "%s%s%s", v26, s, v94);
          sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0xF, v91, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
          v28 = *(_WORD *)((char *)v109 + 0xAB);
          if ( !*((_WORD *)V_Game.planet->a + 2 * v28 + 1) )
          {
            v29 = V_Game.planet->production;
            v30 = V_Game.planet->buildingProgress;
            v31 = Q_GetPlanetItemCost_sub_3583C(V_Game.planet, v28, 0xFFu);
            v32 = Q_GetTurnsToComplete_sub_46C20(v31, v30, v29);
            v33 = v32;
            if ( v32 == 0xFFFF )
            {
              v34 = v91;
              v35 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x56);// 86: "No progress"
              do
              {
                v36 = *v35;
                *v34 = *v35;
                if ( !v36 )
                {
                  break;
                }
                v37 = v35[1];
                v35 += 2;
                v34[1] = v37;
                v34 += 2;
              }
              while ( v37 );
            }
            else
            {
              if ( v32 == 1 )
              {
                v38 = 0x1C;                            // 28: ""
              }
              else
              {
                v38 = 0x1D;                            // 29: "s"
              }
              v83 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v38);
              v39 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x57);// 87: "%d day%s until completion"
              sprintf(v91, v39, v33, v83);
            }
            sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0x32, v91, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
          }
        }
      }
      break;
    case 4:
      sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0xF, V_Game.planet->name, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
      v86 = dword_10469C[V_Game.planet->type];
      v78 = dword_104688[V_Game.planet->size];
      v58 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x5E);  // 94: "%s %s Planet"
      sprintf(v92, v58, v78, v86);
      sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0x3C, v92, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
      v59 = v100;
      v60 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x5F);  // 95: "No One"
      do
      {
        v61 = *v60;
        *v59 = *v60;
        if ( !v61 )
        {
          break;
        }
        v62 = v60[1];
        v60 += 2;
        v59[1] = v62;
        v59 += 2;
      }
      while ( v62 );
      if ( V_Game.planet->byte57 != 0xFF )
      {
        v63 = v100;
        v64 = V_SpecNames[V_Game.races[V_Game.planet->byte57].Unknown_01];
        do
        {
          v65 = *v64;
          *v63 = *v64;
          if ( !v65 )
          {
            break;
          }
          v66 = v64[1];
          v64 += 2;
          v63[1] = v66;
          v63 += 2;
        }
        while ( v66 );
      }
      v79 = 4 * V_Game.races[V_Game.planet->byte57].Unknown_02 + 0x13;
      v67 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x60);  // 96: "Owned by |%d|%s"
      sprintf(v92, v67, v79, v100);
      sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0x5A, v92, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
      v87 = V_Game.planet->word4A;
      v68 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x61);  // 97: "Maximum Population  %d"
      sprintf(v92, v68, v87);
      sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0x78, v92, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
      if ( V_Game.planet->byte57 == byte_104BEA && V_Game.planet->z7 == 0xFFFFFFFF )
      {
        v74 = 4 * V_Game.races[byte_104BEA].Unknown_02 + 0x13;
        v69 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x62);// 98: "Self Managed"
        sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0x96, v69, 2, v74, 0xFFFFFFFF, 0);
      }
      break;
    default:
      break;
  }
  if ( v108 )
  {
    v88 = (unsigned __int16)v111;
    v80 = v108;
    v75 = V_Game.planet->name;
    v70 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x63);    // 99: "%s %s: %d per day"
    sprintf(v92, v70, v75, v80, v88);
    sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0xF, v92, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
    if ( v107 )
    {
      if ( (unsigned __int16)TurnsToComplete_sub_46C20 == 0xFFFF )
      {
        sprintf(v92, format, name);
      }
      else
      {
        if ( (unsigned __int16)TurnsToComplete_sub_46C20 == 1 )
        {
          v71 = 0x1C;                                  // 28: ""
        }
        else
        {
          v71 = 0x1D;                                  // 29: "s"
        }
        v89 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v71);
        v81 = (unsigned __int16)TurnsToComplete_sub_46C20;
        v76 = v106;
        v73 = name;
        v72 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x64);// 100: "%s will %s in %d day%s."
        sprintf(v92, v72, v73, v76, v81, v89);
      }
      sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0x50, v92, 2, 0xFFFFFFFF, 0xFFFFFFFF, 0);
    }
  }
  if ( *(_WORD *)((char *)v109 + 0x6B) )
  {
    sub_2D218(v109);
  }
}
// 9684C: using guessed type int V_PlanItem50;
// 104684: using guessed type int dword_104684[];
// 104688: using guessed type int dword_104688[4];
// 10469C: using guessed type int dword_10469C[10];
// 106FB4: using guessed type __int16 word_106FB4[7];

//----- (0003B120) --------------------------------------------------------
void __fastcall sub_3B120(P_Race pRace)
{
  char *v2; // edx
  int v3; // ebx
  char *v4; // edi
  char *pSpecname; // esi
  char v6; // al
  char v7; // al

  v2 = V_SpecNames[0];
  v3 = 0x65;                                           // 101: "Minions"
  do
  {
    v4 = v2;
    pSpecname = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v3);
    do
    {
      v6 = *pSpecname;
      *v4 = *pSpecname;
      if ( !v6 )
      {
        break;
      }
      v7 = pSpecname[1];
      pSpecname += 2;
      v4[1] = v7;
      v4 += 2;
    }
    while ( v7 );
    v2 += 20;
    ++v3;
  }
  while ( v2 != V_SpecNames[21] );
  pRace->Unknown_01 = 0xFF;
  pRace->Unknown_00 = 0xFF;
  pRace->star = 0;
  sub_3B188(pRace);
}

//----- (0003B188) --------------------------------------------------------
void __fastcall sub_3B188(P_Race pRace)
{
  P_Race v1; // esi
  P_Race v2; // edx
  T_Race *v3; // ebx

  v1 = pRace;
  pRace->Unknown_1AA = 0x12;
  pRace->Unknown_1AC = 0x16;
  pRace->Unknown_1AE = 0;
  pRace->Unknown_19B = 0;
  pRace->Unknown_1D9 = 0;
  pRace->Unknown_1DB = 0;
  pRace->Unknown_1E9 = 0xE;
  v2 = pRace;
  pRace->Unknown_1EA = 0;
  v3 = (T_Race *)&pRace->z1[3];
  do
  {
    pRace = (P_Race)((char *)pRace + 2);
    v2->Unknown_1C0[0] = 0;
    v2 = (P_Race)((char *)v2 + 1);
    pRace->Unknown_1B0 = 0;
  }
  while ( pRace != v3 );
  *(_DWORD *)v1->z = 0;
}

//----- (0003B1FC) --------------------------------------------------------
int __fastcall sub_3B1FC(_BYTE *a1, char a2, __int16 a3)
{
  int result; // eax

  sub_3B188((P_Race)a1);
  *a1 = a2;
  result = (unsigned __int8)a1[1];
  if ( result != a3 )
  {
    a1[1] = a3;
    return Q_RACENEG_CPP_sub_43C80((int)a1);
  }
  return result;
}

//----- (0003B220) --------------------------------------------------------
char __fastcall sub_3B220(int a1, int a2, int a3, int a4)
{
  int v4; // ebp
  __int16 v5; // di
  int v6; // esi
  int v7; // eax
  int v8; // ebx
  __int16 v9; // dx
  int v10; // ebx
  int v11; // edx
  int v12; // eax
  UBYTE v13; // dl
  int v14; // ecx
  int v16[107]; // [esp+0h] [ebp-1CCh] BYREF
  size_t v17; // [esp+1ACh] [ebp-20h]
  int v18; // [esp+1B0h] [ebp-1Ch]

  v4 = a1;
  if ( *(_DWORD *)(a1 + 3) != 0xFFFFFFFF )
  {
    v18 = sub_3EFE0(a1);
    if ( v18 < 0 )
    {
      v5 = 0;
      v17 = sub_40224((unsigned __int8 *)v4, v16, 0) - 1;
      while ( v5 < -v18 )
      {
        v6 = v16[v17 - v5];
        if ( *(_BYTE *)v4 == byte_104BEA )
        {
          a4 = 0;
          sub_55AEC(&V_Type3_stru_10AE70, 0xB, *(char *)(v6 + 0xAA), 0);
        }
        sub_49940(v6);
        ++v5;
      }
    }
    v7 = sub_40224((unsigned __int8 *)v4, v16, 0);
    sub_3C1C0((unsigned __int8 *)v4, v16, v7);
    v8 = sub_40224((unsigned __int8 *)v4, v16, 0);
    if ( !v8 && !sub_402E0((_BYTE *)v4) )
    {
      v9 = 0xA;
      LOBYTE(v8) = *(_BYTE *)v4;
      *(_DWORD *)(v4 + 3) = 0xFFFFFFFF;
LABEL_19:
      LOBYTE(a1) = sub_55AEC(&V_Type3_stru_10AE70, v9, v8, 0);
      return a1;
    }
    if ( v8 > 0 )
    {
      v10 = 4 * v8;
      v11 = 0;
      do
      {
        v12 = v16[v11 / 4u];
        v11 += 4;
        sub_4A6AC(v12, v11, v10, a4);
      }
      while ( v11 < v10 );
    }
    v8 = 0;
    dword_10509C = 0;
    sub_3B5B8((unsigned __int8 *)v4);
    sub_405F4((_BYTE *)v4);
    LOBYTE(a1) = *(_BYTE *)(*(_DWORD *)(v4 + 7) + 0x14) & 0x80;
    if ( (_BYTE)a1 )
    {
      v13 = byte_104BEA;
      v14 = *(_DWORD *)(v4 + 0x19E) + 1;
      LOBYTE(a1) = *(_BYTE *)v4;
      *(_DWORD *)(v4 + 0x19E) = v14;
      if ( (_BYTE)a1 == v13 )
      {
        if ( v14 )
        {
          a1 = (unsigned __int16)word_968E8[*(char *)(v4 + 0x19D)];
          if ( a1 == v14 )
          {
            v9 = 0x18;
            goto LABEL_19;
          }
        }
      }
    }
  }
  return a1;
}
// 968E8: using guessed type __int16 word_968E8[21];
// 10509C: using guessed type int dword_10509C;
// 3B220: using guessed type int var_1CC[107];

//----- (0003B38C) --------------------------------------------------------
char __fastcall Q_NC_sub_3B38C(unsigned __int8 *a1)
{
  unsigned __int8 *v1; // esi
  int v2; // ecx
  int v3; // ebp
  int v4; // ebp
  __int16 i; // di
  T_Race *v6; // eax
  int v7; // eax
  __int16 v8; // di
  int v9; // eax
  int v10; // ecx
  _DWORD v12[142]; // [esp+0h] [ebp-5D0h] BYREF
  _DWORD v13[215]; // [esp+250h] [ebp-380h] BYREF
  int v14; // [esp+5C4h] [ebp-Ch]
  int v15; // [esp+5C8h] [ebp-8h]
  __int16 j; // [esp+5CCh] [ebp-4h]

  v1 = a1;
  LOBYTE(a1) = *a1;
  if ( (_BYTE)a1 == byte_104BEA && V_FlashPopExists_dword_A0D00 != 0xFFFFFFFF )
  {
    v2 = 0;
    LOWORD(a1) = 0;
    if ( V_Game.racesNum > 0 )
    {
      v3 = 0;
      do
      {
        if ( (__int16)a1 != *v1 && !v1[(__int16)a1 + 0x1C0] )
        {
          ++v3;
          ++v2;
          v13[v3 + 0xD5] = (__int16)a1;
        }
        LOWORD(a1) = (_WORD)a1 + 1;
      }
      while ( (__int16)a1 < V_Game.racesNum );
    }
    if ( v2 )
    {
      memset(v12, 0, 0x250u);
      v4 = 0;
      for ( i = 0; i < v2; ++i )
      {
        v6 = &V_Game.races[v13[i + 0xD6]];
        v4 += sub_40224(&v6->Unknown_00, &v13[v4 + 0x6B], 0);
      }
      v14 = sub_40224(v1, v13, 0);
      for ( j = 0; ; ++j )
      {
        LOBYTE(a1) = j;
        if ( j >= v14 )
        {
          break;
        }
        v7 = v13[j];
        if ( *(_BYTE *)(v7 + 0x58) == 5 )
        {
          v15 = *(_DWORD *)(v7 + 0x59);
          if ( !v12[(v15 - (int)V_Game.t15) / 0x27] )
          {
            v8 = 0;
            v12[(v15 - (int)V_Game.t15) / 0x27] = 0xFFFFFFFF;
            while ( v8 < v4 )
            {
              v9 = v13[v8 + 0x6B];
              if ( v15 == *(_DWORD *)(v9 + 0x59) )
              {
                v10 = *(__int16 *)(v9 + 0x56);
                if ( !v1[v10 + 0x1C0] )
                {
                  v1[v10 + 0x1C0] = 1;
                  *(_WORD *)&v1[2 * v10 + 0x1B2] = *(_WORD *)(v1 + 0x1D5);
                  V_Game.races[v10].Unknown_1C0[*v1] = 1;
                  V_Game.races[v10].Unknown_1B2[*v1] = V_Game.races[v10].Unknown_1D5;
                  sub_55AEC(&V_Type3_stru_10AE70, 0x17, v13[j], v10);
                }
              }
              ++v8;
            }
          }
        }
      }
    }
  }
  return (char)a1;
}
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;

//----- (0003B56C) --------------------------------------------------------
int __fastcall sub_3B56C(unsigned __int8 *a1, __int16 *a2)
{
  int v3; // edi
  __int16 i; // dx
  int result; // eax
  int v6; // eax
  int v7[111]; // [esp+0h] [ebp-1BCh] BYREF

  v3 = sub_1D794(a2, v7);
  for ( i = 0; ; ++i )
  {
    result = i;
    if ( i >= v3 )
    {
      break;
    }
    v6 = v7[i];
    if ( v6 )
    {
      if ( *(_WORD *)(v6 + 0x56) == *a1 )
      {
        sub_4A5B8(v6);
      }
    }
  }
  return result;
}
// 3B56C: using guessed type int var_1BC[111];

//----- (0003B5B8) --------------------------------------------------------
void __fastcall sub_3B5B8(unsigned __int8 *eax0)
{
  int v1; // ebx
  int v2; // edi
  __int16 i; // bx
  T_Star *stars; // edi
  WORD j; // dx
  int v6; // ecx
  int v7; // eax
  int v8; // ecx
  int v9; // eax
  int v10; // ecx
  int v11; // eax
  int v12; // ebp
  int v13; // ecx
  int v14; // eax
  int v15; // ebx
  int v16; // eax
  double v17; // st7
  double v18; // st7
  double v19; // st7
  __int16 k; // si
  int v21; // ecx
  __int16 v22; // dx
  int v23; // eax
  int v24; // eax
  __int16 v25; // di
  int v26; // edx
  T_Star *v27; // ebp
  WORD m; // si
  T_Star *v29; // edi
  WORD n; // bx
  int v31; // eax
  int v32; // eax
  int v33; // eax
  int v34; // ebp
  int v35; // ecx
  __int16 v36; // si
  int starIndex; // ecx
  __int16 v38; // si
  signed int v39; // ebp
  T_Planet *v40; // ecx
  int v41; // edi
  int v42; // edx
  WORD ii; // bx
  T_Planet *v44; // edx
  int v45[107]; // [esp+0h] [ebp-214h] BYREF
  int v46; // [esp+1ACh] [ebp-68h]
  int v47; // [esp+1B0h] [ebp-64h]
  float v48; // [esp+1B4h] [ebp-60h]
  int v49; // [esp+1B8h] [ebp-5Ch]
  int v50; // [esp+1BCh] [ebp-58h]
  int v51; // [esp+1C0h] [ebp-54h]
  int v52; // [esp+1C4h] [ebp-50h]
  _BYTE *eax0a; // [esp+1C8h] [ebp-4Ch]
  float v54; // [esp+1CCh] [ebp-48h]
  int v55; // [esp+1D0h] [ebp-44h]
  int v56; // [esp+1D4h] [ebp-40h]
  P_Planet a1; // [esp+1D8h] [ebp-3Ch]
  int v58; // [esp+1DCh] [ebp-38h]
  float v59; // [esp+1E0h] [ebp-34h]
  float v60; // [esp+1E4h] [ebp-30h]
  float v61; // [esp+1E8h] [ebp-2Ch]
  float v62; // [esp+1ECh] [ebp-28h]
  int v63; // [esp+1F0h] [ebp-24h]
  int v64; // [esp+1F4h] [ebp-20h]
  unsigned __int8 v65; // [esp+1F8h] [ebp-1Ch]

  eax0a = eax0;
  v49 = sub_40224(eax0, v45, 0);
  if ( *eax0a != byte_104BEA || V_FlashPopExists_dword_A0D00 == 0xFFFFFFFF )
  {
    sub_3C670(eax0a);
    v1 = v49;
    sub_3C968((int)eax0a);
    sub_44080(eax0a);
    sub_3C2E8(eax0a, v45, v1);
  }
  if ( sub_40590(eax0a) != 0xFFFFFFFF
    && (byte_104BEA != *eax0a || V_FlashPopExists_dword_A0D00 || dword_106FC2 == 0xFFFFFFFF)
    && (unsigned __int16)V_ResTree.a.w1[(unsigned __int8)*eax0a] == 0xFFFF )
  {
    sub_3EA7C(eax0a);
  }
  if ( byte_104BEA != *eax0a || V_FlashPopExists_dword_A0D00 == 0xFFFFFFFF )
  {
    sub_434E4(eax0a, 1);
  }
  v2 = v49;
  for ( i = 0; i < v2; ++i )
  {
    if ( byte_104BEA != *eax0a || V_FlashPopExists_dword_A0D00 == 0xFFFFFFFF )
    {
      sub_3EBDC(eax0a, v45[i]);
    }
  }
  if ( byte_104BEA != *eax0a || V_FlashPopExists_dword_A0D00 == 0xFFFFFFFF )
  {
    LOWORD(v64) = sub_3EFE0((int)eax0a);
    if ( (__int16)v64 > 0xA )
    {
      LOWORD(v64) = 0xA;
    }
    if ( (__int16)v64 > 0 )
    {
      v61 = 0.0;
      v59 = 0.0;
      v60 = 0.0;
      stars = V_Game.stars;
      v65 = sub_43374(eax0a, 0xFFFFFFFF);
      for ( j = 0; j < V_Game.starsNum; ++stars )
      {
        if ( (stars->Unknown_14 & v65) != 0 )
        {
          v10 = *((char *)&dword_104F6D + j + 3);
          v11 = dword_104BEC[j];
          v58 = v11;
          if ( v10 > 1 )
          {
            v58 = v11 >> (v10 - 1);
          }
          v12 = j;
          v13 = *((char *)&dword_104F09 + j + 3);
          v14 = dword_104D7C[v12];
          v15 = dword_104BEC[v12];
          v59 = (double)v58 + v59;
          v16 = v15 + v14;
          v58 = v16;
          if ( v13 > 0 )
          {
            v58 = v16 >> v13;
          }
          v61 = (double)v58 + v61;
        }
        else if ( (stars->Unknown_15 & v65) != 0 )
        {
          v6 = *((char *)&dword_104F09 + j + 3);
          v7 = dword_104D7C[j];
          v52 = v7;
          if ( v6 > 0 )
          {
            v52 = v7 >> v6;
          }
          v61 = (double)v52 + v61;
        }
        else
        {
          if ( *((char *)&dword_104FD1 + j + 3) <= 0 )
          {
            v60 = (double)dword_104BEC[j] + v60;
          }
          v8 = *((char *)&dword_104F09 + j + 3);
          v9 = dword_104D7C[j];
          v51 = v9;
          if ( v8 > 0 )
          {
            v51 = v9 >> v8;
          }
          v61 = (double)v51 + v61;
        }
        ++j;
      }
      v60 = v60 * flt_920F0;
      v17 = v59 * dbl_920F4;
      v59 = v17;
      v48 = v17 + v61 + v60;
      if ( v48 <= 0.0 )
      {
        v47 = (__int16)v64 / 3;
        v60 = (float)v47;
        v61 = v60;
        v59 = (double)(__int16)v64 - v60 - v60;
      }
      else
      {
        v18 = (double)(__int16)v64;
        v59 = v59 * v18;
        v61 = v61 * v18;
        v60 = v18 * v60;
        v19 = 1.0 / v48;
        v59 = v59 * v19;
        v61 = v61 * v19;
        v60 = v19 * v60;
      }
      for ( k = 0; k < v49; ++k )
      {
        v21 = v45[k];
        if ( !v21 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x22A);
        }
        if ( *(_BYTE *)(v21 + 0x58) == 1 )
        {
          if ( *(_DWORD *)(v21 + 0x28) && v60 > 0.0 )
          {
            v60 = v60 - 1.0;
          }
          else if ( sub_4A534(v45[k], 0x49) && v59 > 0.0 )
          {
            v59 = v59 - 1.0;
          }
          else if ( v61 > 0.0 )
          {
            v61 = v61 - 1.0;
          }
        }
      }
      v22 = 0;
      while ( 1 )
      {
        v23 = v22;
        if ( v22 >= 0x64 )
        {
          break;
        }
        ++v22;
        dword_1046E8[v23] = 0;
        dword_104878[v23] = 0;
        dword_104A08[v23] = 0;
      }
      v24 = 0;
      if ( (__int16)v64 > 0 )
      {
        v25 = v64;
        do
        {
          v26 = (__int16)v24++;
          dword_104B98[v26] = 0xFFFFFFFF;
        }
        while ( (__int16)v24 < v25 );
      }
      v27 = V_Game.stars;
      for ( m = 0; m < V_Game.starsNum; ++v27 )
      {
        if ( ((1 << *eax0a) & (unsigned __int8)v27->Unknown_14) != 0 )
        {
          v29 = V_Game.stars;
          for ( n = 0; n < V_Game.starsNum; ++v29 )
          {
            if ( ((1 << *eax0a) & (unsigned __int8)v29->Unknown_16) != 0 )
            {
              v47 = 1 / ((__int16)sub_1DA04((int)v29, (int)v27) / 0x19 + 1);
              v62 = (float)v47;
              v54 = v62;
              if ( (v27->Unknown_14 & v65) != 0 )
              {
                v33 = *(int *)((char *)&dword_104F6D + n) >> 0x18;
                v50 = (int)((double)dword_104BEC[n] * v62);
                if ( v33 >= 1 )
                {
                  if ( v33 < 2 )
                  {
                    dword_104A08[m] += v50 / 2;
                  }
                }
                else
                {
                  dword_104A08[m] += v50;
                }
                if ( *((char *)&dword_104F09 + n + 3) < 1 )
                {
                  dword_104878[m] += v50;
                }
              }
              else if ( (v27->Unknown_15 & v65) != 0 )
              {
                v47 = dword_104BEC[n] + dword_104D7C[n];
                v31 = *((char *)&dword_104F09 + n + 3);
                v55 = (int)((double)v47 * v62);
                if ( v31 < 1 )
                {
                  dword_104878[m] += v55;
                }
              }
              else
              {
                if ( *((char *)&dword_104FD1 + n + 3) < 1 )
                {
                  dword_1046E8[m] = (int)((double)dword_104BEC[n] * v62 * flt_920F0 + (double)dword_1046E8[m]);
                }
                v32 = *(int *)((char *)&dword_104F09 + n) >> 0x18;
                v46 = (int)((double)dword_104D7C[n] * v54);
                if ( v32 < 1 )
                {
                  dword_104878[m] += v46;
                }
              }
            }
            ++n;
          }
        }
        ++m;
      }
      a1 = V_Game.planets;
      LOWORD(v63) = 0;
      if ( V_Game.planetsNum > 0 )
      {
        do
        {
          if ( a1->buildingPlanetItemIndex == 0xFF && sub_35930(a1, 0x16) != 0xFFFF && a1->byte57 == *eax0a )
          {
            starIndex = a1->starIndex;
            if ( starIndex >= 0x64 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x2A1);
            }
            v56 = (dword_104878[starIndex] + dword_1046E8[starIndex] + dword_104A08[starIndex]) / 0xA;
            v34 = 0;
            v36 = 0;
            v35 = dword_104BC0[0];
            v56 *= a1->production;
            if ( (__int16)v64 > 0 )
            {
              while ( 1 )
              {
                if ( v36 >= 0xA )
                {
                  Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x2B1);
                }
                if ( dword_104B98[v36] == 0xFFFFFFFF )
                {
                  break;
                }
                if ( v35 > dword_104BC0[v36] )
                {
                  v34 = v36;
                  v35 = dword_104BC0[v36];
                }
                if ( ++v36 >= (__int16)v64 )
                {
                  goto LABEL_96;
                }
              }
              v34 = v36;
            }
LABEL_96:
            if ( v56 > dword_104BC0[v34] || dword_104B98[v34] == 0xFFFFFFFF )
            {
              dword_104B98[v34] = (__int16)v63;
              dword_104BC0[v34] = v56;
            }
          }
          LOWORD(v63) = v63 + 1;
          ++a1;
        }
        while ( (__int16)v63 < V_Game.planetsNum );
      }
      v38 = 0;
      if ( (__int16)v64 > 0 )
      {
        while ( 1 )
        {
          v39 = dword_104B98[v38];
          if ( v39 <= (int)0xFFFFFFFF || V_Game.planetsNum <= v39 )
          {
            goto LABEL_117;
          }
          v40 = &V_Game.planets[v39];
          if ( !v40 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x2D9);
          }
          v41 = v40->starIndex;
          if ( v41 >= 0x64 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x2DD);
          }
          if ( v60 > 0.0 )
          {
            v42 = dword_1046E8[v41];
            if ( v42 > dword_104878[v41] && v42 > dword_104A08[v41] )
            {
              break;
            }
          }
          if ( v61 > 0.0 && dword_104878[v41] > dword_104A08[v41] )
          {
LABEL_116:
            sub_3CB60(eax0a, &V_Game.planets[v39], 1u);
            v61 = v61 - 1.0;
            goto LABEL_117;
          }
          if ( v59 <= 0.0 )
          {
            if ( v60 > 0.0 )
            {
              break;
            }
            if ( v61 > 0.0 )
            {
              goto LABEL_116;
            }
          }
          else
          {
            sub_3CB60(eax0a, &V_Game.planets[v39], 2u);
            v59 = v59 - 1.0;
          }
LABEL_117:
          if ( ++v38 >= (__int16)v64 )
          {
            goto LABEL_128;
          }
        }
        sub_3CB60(eax0a, &V_Game.planets[v39], 0);
        v60 = v60 - 1.0;
        goto LABEL_117;
      }
    }
  }
LABEL_128:
  for ( ii = 0; ii < V_Game.planetsNum; ++ii )
  {
    v44 = &V_Game.planets[ii];
    if ( v44->byte57 == *eax0a
      && (*eax0a != byte_104BEA || v44->z7 || V_FlashPopExists_dword_A0D00)
      && v44->buildingPlanetItemIndex == 0xFF )
    {
      sub_3D8F0((int)eax0a, v44);
    }
  }
}
// 920F0: using guessed type float flt_920F0;
// 920F4: using guessed type double dbl_920F4;
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;
// 1046E8: using guessed type int dword_1046E8[100];
// 104878: using guessed type int dword_104878[100];
// 104A08: using guessed type int dword_104A08[100];
// 104B98: using guessed type int dword_104B98[];
// 104BC0: using guessed type int dword_104BC0[9];
// 104BEC: using guessed type int dword_104BEC[100];
// 104D7C: using guessed type int dword_104D7C[99];
// 104F09: using guessed type int dword_104F09;
// 104F6D: using guessed type int dword_104F6D;
// 104FD1: using guessed type int dword_104FD1;
// 106FC2: using guessed type int dword_106FC2;
// 3B5B8: using guessed type int var_214[107];

//----- (0003C12C) --------------------------------------------------------
unsigned int __fastcall sub_3C12C(unsigned __int8 *a1, _DWORD *a2)
{
  int v3; // ebp
  int v4; // esi
  char v5; // al
  int weaponDamage; // ebx

  v3 = *(_DWORD *)((char *)a2 + 0x15A) - *(_DWORD *)((char *)a2 + 0x15E);
  v4 = 0;
  v5 = sub_4A36C((int)a2, 0, *a1);
  if ( v5 <= (char)0xFFFFFFFF || v5 >= 0x4C )
  {
    weaponDamage = 0;
  }
  else
  {
    weaponDamage = V_Gizmos[v5].weaponDamage;
  }
  if ( 3 * v3 > *(_DWORD *)((char *)a2 + 0x15A)
    || !a2[0xA] && !sub_4A534((int)a2, 0x49) && weaponDamage > *a2
    || sub_4A8CC((int)a2) >= 1 && sub_4A1CC((int)a2, *a1) >= 0xF )
  {
    return 0xFFFFFFFF;
  }
  return v4;
}

//----- (0003C1C0) --------------------------------------------------------
char __fastcall sub_3C1C0(unsigned __int8 *a1, int *a2, int a3)
{
  int *v4; // esi
  signed int v5; // eax
  int v6; // ecx
  __int16 v7; // ax
  int i; // edi
  int v9; // ecx
  char v10; // dl
  char v11; // bl

  v4 = a2;
  v5 = sub_3EFE0((int)a1);
  if ( v5 < 2 )
  {
    if ( a2 )
    {
      if ( a3 > 0 )
      {
        LOBYTE(v5) = *a1;
        if ( *a1 != byte_104BEA || V_FlashPopExists_dword_A0D00 == 0xFFFFFFFF )
        {
          v6 = 1 << *a1;
          v7 = 0;
          if ( (v6 & (char)V_ResTree.items[1].z2[0]) != 0 )
          {
            v7 = 1;
            if ( (v6 & (char)V_ResTree.items[0x13].z2[0]) != 0 )
            {
              v7 = 2;
              if ( (v6 & (char)V_ResTree.items[0x1F].z2[0]) != 0 )
              {
                v7 = 3;
              }
            }
          }
          if ( !v7 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x365);
          }
          for ( i = 0; i < a3; ++i )
          {
            if ( !v4 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x36B);
            }
            v9 = *v4;
            if ( !*v4 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x36F);
            }
            v10 = *(_BYTE *)(v9 + 0x58);
            if ( v10 != 1 && v10 != 2 )
            {
              v11 = *(_BYTE *)(v9 + 0x5D);
              if ( v11 != 2 && v11 != 5 && v11 != 6 && sub_3C12C(a1, (_DWORD *)*v4) )
              {
                sub_49940(v9);
              }
            }
            LOBYTE(v5) = a3;
            ++v4;
          }
        }
      }
    }
  }
  return v5;
}
// 3C265: conditional instruction was optimized away because ebx.4>=1
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;

//----- (0003C2E8) --------------------------------------------------------
int __fastcall sub_3C2E8(unsigned __int8 *a1, int *a2, int a3)
{
  T_Star *stars; // edi
  int v4; // ebx
  WORD starsNum; // si
  int v6; // esi
  int v7; // eax
  __int16 i; // si
  int v9; // edi
  int v10; // ebx
  int v11; // edi
  int v12; // ebx
  int result; // eax
  int v14; // ecx
  char v15; // al
  __int16 v18; // [esp+Ch] [ebp-18h]
  char v19; // [esp+10h] [ebp-14h]

  v19 = sub_43374(a1, 0xFFFFFFFF);
  stars = V_Game.stars;
  sub_1FD90((int)&V_Game, (int)&dword_105035 + 3, *a1);
  v18 = 0;
  if ( V_Game.starsNum > 0 )
  {
    do
    {
      v6 = v18;
      dword_104BEC[v6] = sub_1DA4C((int)stars, *a1, (int)a2, a3);
      dword_104D7C[v6] = sub_1DB70(stars, *a1, a2, a3);
      v7 = *((char *)&dword_105035 + v18 + 3);
      if ( v7 > 0 && (stars->Unknown_15 & (unsigned __int8)v19) != 0 )
      {
        dword_104D7C[v18] = 2 * dword_104D7C[v18] + 0x12C + 0x96 * v7;
      }
      v4 = v18;
      starsNum = V_Game.starsNum;
      ++stars;
      ++v18;
      *((_BYTE *)&dword_104F09 + v4 + 3) = 0;
      *((_BYTE *)&dword_104F6D + v4 + 3) = 0;
      *((_BYTE *)&dword_104FD1 + v4 + 3) = 0;
    }
    while ( v18 < starsNum );
  }
  for ( i = 0; ; ++i )
  {
    result = i;
    if ( i >= a3 )
    {
      break;
    }
    v14 = a2[i];
    if ( !v14 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x3B3);
    }
    v15 = *(_BYTE *)(v14 + 0x58);
    v12 = 0xFFFFFFFF;
    if ( v15 == 4 )
    {
      v11 = *(_DWORD *)(v14 + 0x59);
      if ( !v11 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x3BB);
      }
      goto LABEL_16;
    }
    if ( v15 == 3 )
    {
      v9 = *(_DWORD *)(v14 + 0x59);
      if ( !v9 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x3C3);
      }
      v10 = *(_DWORD *)(v9 + 0xA);
      goto LABEL_17;
    }
    if ( v15 == 5 && *(_BYTE *)(v14 + 0x5D) == 1 )
    {
      v11 = *(_DWORD *)(v14 + 0x5E);
      if ( !v11 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x3CC);
      }
LABEL_16:
      v10 = *(_DWORD *)(v11 + 2);
LABEL_17:
      v12 = v10 >> 0x10;
    }
    if ( v12 > (int)0xFFFFFFFF && v12 < V_Game.starsNum )
    {
      if ( *(_DWORD *)(v14 + 0x28) )
      {
        ++*((_BYTE *)&dword_104FD1 + v12 + 3);
      }
      else if ( sub_4A534(v14, 0x49) )
      {
        ++*((_BYTE *)&dword_104F6D + v12 + 3);
      }
      else
      {
        ++*((_BYTE *)&dword_104F09 + v12 + 3);
      }
    }
  }
  return result;
}
// 104BEC: using guessed type int dword_104BEC[100];
// 104D7C: using guessed type int dword_104D7C[99];
// 104F09: using guessed type int dword_104F09;
// 104F6D: using guessed type int dword_104F6D;
// 104FD1: using guessed type int dword_104FD1;
// 105035: using guessed type int dword_105035;

//----- (0003C4EC) --------------------------------------------------------
T_Star *__fastcall Q_NC_sub_3C4EC(T_Star *a1, int a2)
{
  T_Star *v2; // esi
  __int16 v3; // ax
  int v4; // edx
  T_Star *stars; // edi
  int v6; // ebx
  int v7; // eax
  WORD i; // cx
  int v9; // edx
  T_Star *v10; // edx
  WORD j; // bx
  int k; // edx
  int v13; // ebx
  __int16 v14; // bx

  v2 = a1;
  if ( a2 )
  {
    *(_WORD *)((char *)&a1[4].Unknown_18 + 3) = 0;
    if ( ((1 << LOBYTE(a1->a)) & *(unsigned __int8 *)(*(_DWORD *)((char *)&a1->Unknown_6 + 1) + 0x14)) != 0 )
    {
      stars = V_Game.stars;
      v6 = 0;
      v7 = 0;
      for ( i = 0; i < V_Game.starsNum; ++stars )
      {
        if ( ((1 << LOBYTE(v2->a)) & (unsigned __int8)stars->Unknown_16) != 0 )
        {
          v9 = dword_104D7C[i] + dword_104BEC[i];
          if ( i >= a2 )
          {
            if ( v9 > v7 )
            {
              v6 = v9 + v6 - v7;
              v7 = v6 / a2;
            }
          }
          else
          {
            v6 += v9;
          }
        }
        ++i;
      }
      v10 = V_Game.stars;
      for ( j = 0; j < V_Game.starsNum; ++v10 )
      {
        if ( ((1 << LOBYTE(v2->a)) & (unsigned __int8)v10->Unknown_16) != 0 && dword_104D7C[j] + dword_104BEC[j] >= v7 )
        {
          *(_DWORD *)((char *)&v2->v.x + 4 * *(__int16 *)((char *)&v2[4].Unknown_18 + 3) + 3) = v10;
        }
        ++j;
      }
      a1 = (T_Star *)*(__int16 *)((char *)&v2[4].Unknown_18 + 3);
      if ( !*(_WORD *)((char *)&v2[4].Unknown_18 + 3) )
      {
        a1 = V_Game.stars;
        for ( k = 0; (__int16)k < V_Game.starsNum; ++a1 )
        {
          v13 = 1 << LOBYTE(v2->a);
          if ( ((unsigned __int8)v13 & a1->Unknown_14) != 0 && ((unsigned __int8)v13 & a1->Unknown_15) == 0 )
          {
            v14 = *(_WORD *)((char *)&v2[4].Unknown_18 + 3);
            *(_WORD *)((char *)&v2[4].Unknown_18 + 3) = v14 + 1;
            *(_DWORD *)((char *)&v2->v.x + 4 * v14 + 3) = a1;
          }
          ++k;
        }
      }
    }
    else
    {
      v3 = *(_WORD *)((char *)&a1[4].Unknown_18 + 3);
      v4 = v3;
      *(_WORD *)((char *)&v2[4].Unknown_18 + 3) = v3 + 1;
      a1 = *(T_Star **)((char *)&v2->Unknown_6 + 1);
      *(_DWORD *)((char *)&v2->v.x + 4 * v4 + 3) = a1;
    }
  }
  return a1;
}
// 104BEC: using guessed type int dword_104BEC[100];
// 104D7C: using guessed type int dword_104D7C[99];

//----- (0003C670) --------------------------------------------------------
char __fastcall sub_3C670(_BYTE *a1)
{
  _BYTE *v1; // ebp
  T_Star *stars; // eax
  int i; // edx
  __int16 v4; // bx
  T_Race *v5; // ecx
  __int16 v6; // si
  int v7; // eax
  int v8; // edx
  int v9; // ecx
  int v10; // eax
  int v11; // edx
  bool v12; // zf
  int v13; // edx
  int v14; // ecx
  unsigned __int8 v15; // dl
  int v17; // [esp+0h] [ebp-34h]
  __int16 v18; // [esp+4h] [ebp-30h]
  int v19; // [esp+8h] [ebp-2Ch]
  int v20; // [esp+Ch] [ebp-28h]
  unsigned __int8 v21; // [esp+10h] [ebp-24h]
  unsigned __int8 v22; // [esp+14h] [ebp-20h]
  unsigned __int8 v23; // [esp+18h] [ebp-1Ch]

  v1 = a1;
  LOWORD(v20) = 0;
  if ( V_Game.racesNum > 0 )
  {
    while ( 1 )
    {
      LOBYTE(a1) = v20;
      v14 = (unsigned __int8)*v1;
      if ( (__int16)v20 != v14 && v1[(__int16)v20 + 0x1C0] && *(_DWORD *)V_Game.races[(__int16)v20].z != 0xFFFFFFFF )
      {
        break;
      }
LABEL_54:
      LOWORD(v20) = v20 + 1;
      if ( (__int16)v20 >= V_Game.racesNum )
      {
        return (char)a1;
      }
    }
    v15 = v1[(__int16)v20 + 0x1C0];
    v4 = 0;
    if ( v15 < 2u )
    {
      v12 = v15 == 1;
    }
    else
    {
      if ( v15 <= 2u )
      {
        v4 = *(_WORD *)&V_Game.Unknown_D8A[6 * (__int16)v20] - *(_WORD *)&V_Game.Unknown_D8A[6 * v14];
        if ( v4 >= 0 )
        {
          if ( v4 > 3 )
          {
            v4 = 3;
          }
        }
        else
        {
          v4 = 0;
        }
        goto LABEL_34;
      }
      v12 = v15 == 3;
    }
    if ( v12 )
    {
      if ( v1[(__int16)v20 + 0x1C0] == 1 )
      {
        stars = V_Game.stars;
        for ( i = 0; i < V_Game.starsNum; ++i )
        {
          if ( ((1 << *v1) & (unsigned __int8)stars->Unknown_14) != 0
            && ((1 << v20) & (unsigned __int8)stars->Unknown_15) != 0 )
          {
            v17 = unk_96912;
            v18 = *((_WORD *)&unk_96912 + 2);
            v4 += *((_WORD *)&v17 + V_Game.Unknown_D8A[0x2A]);
          }
          ++stars;
        }
      }
      v5 = &V_Game.races[(__int16)v20];
      v21 = sub_43374(&v5->Unknown_00, 0xFFFFFFFF);
      v22 = v21;
      v23 = sub_43374(&v5->Unknown_00, 0xFFFFFFFF);
      if ( v23 != v21 )
      {
        v6 = 0;
        v7 = 0;
        v8 = 0;
        v19 = 0;
        while ( v7 < V_Game.racesNum )
        {
          if ( v7 != (__int16)v20 && v7 != (unsigned __int8)*v1 )
          {
            if ( ((1 << v7) & v22) != 0 )
            {
              v6 += *(_WORD *)&V_Game.Unknown_D8A[v8 + 2];
            }
            v9 = 1 << v7;
            if ( (v23 & (1 << v7)) != 0 )
            {
              LOWORD(v9) = *(_WORD *)&V_Game.Unknown_D8A[v8 + 2];
              v19 += v9;
            }
          }
          v8 += 6;
          ++v7;
        }
        if ( v6 <= (__int16)v19 )
        {
          v4 += 3;
        }
        else
        {
          --v4;
        }
        if ( v1[(__int16)v20 + 0x1C0] == 1 )
        {
          v10 = *(__int16 *)&V_Game.Unknown_D8A[6 * (__int16)v20];
          v11 = *(__int16 *)&V_Game.Unknown_D8A[6 * (unsigned __int8)*v1];
          if ( v10 - v11 <= 1 )
          {
            if ( v11 - v10 > 1 )
            {
              v4 += 4;
            }
          }
          else
          {
            v4 -= 2;
          }
        }
      }
    }
LABEL_34:
    LOBYTE(a1) = byte_104BEA;
    if ( (__int16)v20 == byte_104BEA && !V_FlashPopExists_dword_A0D00 )
    {
      if ( v4 < 0 )
      {
        LOBYTE(a1) = V_Game.Unknown_D8A[0x2A];
        if ( V_Game.Unknown_D8A[0x2A] )
        {
          if ( V_Game.Unknown_D8A[0x2A] <= 1u )
          {
            v4 *= 2;
          }
          else if ( V_Game.Unknown_D8A[0x2A] == 2 )
          {
            v4 *= 3;
          }
        }
      }
      else
      {
        LOBYTE(a1) = V_Game.Unknown_D8A[0x2A];
        if ( V_Game.Unknown_D8A[0x2A] )
        {
          if ( V_Game.Unknown_D8A[0x2A] <= 1u )
          {
            LOWORD(a1) = v4 / 2;
            v4 /= 2;
          }
          else if ( V_Game.Unknown_D8A[0x2A] == 2 )
          {
            LOWORD(a1) = v4 / 3;
            v4 /= 3;
          }
        }
      }
    }
    if ( v4 )
    {
      a1 = &v1[2 * (__int16)v20];
      *((_WORD *)a1 + 0xD9) += v4;
      v13 = *((__int16 *)a1 + 0xD9);
      if ( v13 >= 0x32 )
      {
        if ( v13 > 0x3B6 )
        {
          *((_WORD *)a1 + 0xD9) = 0x3B6;
        }
      }
      else
      {
        *((_WORD *)a1 + 0xD9) = 0x32;
      }
    }
    goto LABEL_54;
  }
  return (char)a1;
}
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;

//----- (0003C968) --------------------------------------------------------
int __fastcall sub_3C968(int a1)
{
  int result; // eax
  double v3; // st7
  float v4; // edx
  double v5; // st7
  double v6; // [esp+8h] [ebp-34h]
  double v7; // [esp+8h] [ebp-34h]
  double v8; // [esp+8h] [ebp-34h]
  double v9; // [esp+10h] [ebp-2Ch]
  double v10; // [esp+10h] [ebp-2Ch]
  float v11; // [esp+18h] [ebp-24h]
  float v12; // [esp+1Ch] [ebp-20h]
  float v13; // [esp+20h] [ebp-1Ch]
  float v14; // [esp+24h] [ebp-18h]
  float v15; // [esp+24h] [ebp-18h]
  float v16; // [esp+24h] [ebp-18h]

  result = V_Game.day / 0xA;
  if ( V_Game.day % 0xA )
  {
    return result;
  }
  v13 = (double)(V_Game.day % *(__int16 *)(a1 + 0x1D7)) / (double)*(__int16 *)(a1 + 0x1D7) * dbl_92150;
  if ( (LODWORD(v13) & 0x7FFFFFFF) == 0 )
  {
    v13 = 0.0099999998;
  }
  v6 = *(float *)(a1 + 0x1DD);
  v7 = sin(v13) * v6;
  v9 = *(float *)(a1 + 0x1E1);
  v10 = sin(v13 * flt_92158) * v9 + v7;
  v8 = *(float *)(a1 + 0x1E5);
  v14 = sin(v13 * flt_9215C) * v8 + v10;
  if ( v14 >= 0.0 )
  {
    v3 = v14 + flt_92158;
  }
  else
  {
    v3 = v14 + flt_92160;
  }
  v15 = v3;
  v11 = (float)*(__int16 *)(a1 + 0x1D9);
  if ( v15 > (double)v11 )
  {
    v4 = (float)*(__int16 *)(a1 + 0x1D9);
LABEL_11:
    v15 = v4;
    goto LABEL_12;
  }
  v12 = (float)*(__int16 *)(a1 + 0x1DB);
  if ( v15 < (double)v12 )
  {
    v4 = (float)*(__int16 *)(a1 + 0x1DB);
    goto LABEL_11;
  }
LABEL_12:
  if ( *(_BYTE *)a1 == byte_104BEA )
  {
    word_104BE8 = (int)v15;
  }
  if ( V_Game.Unknown_D8A[0x2A] == 2 )
  {
    v5 = v15 + flt_9216C;
  }
  else if ( V_Game.Unknown_D8A[0x2A] )
  {
    v5 = v15 + flt_92164;
  }
  else
  {
    v5 = v15 + flt_92168;
  }
  for ( result = 0; (__int16)result < V_Game.racesNum; ++result )
  {
    if ( *(_BYTE *)((__int16)result + a1 + 0x1C0) )
    {
      if ( !*(_DWORD *)V_Game.races[(__int16)result].z )
      {
        v16 = v5;
        *(_WORD *)(a1 + 2 * (__int16)result + 0x1B2) = (int)((double)*(__int16 *)(a1 + 2 * (__int16)result + 0x1B2) + v16);
      }
    }
  }
  return result;
}
// 92150: using guessed type double dbl_92150;
// 92158: using guessed type float flt_92158;
// 9215C: using guessed type float flt_9215C;
// 92160: using guessed type float flt_92160;
// 92164: using guessed type float flt_92164;
// 92168: using guessed type float flt_92168;
// 9216C: using guessed type float flt_9216C;
// 104BE8: using guessed type __int16 word_104BE8;

//----- (0003CB60) --------------------------------------------------------
int __fastcall sub_3CB60(unsigned __int8 *a1, T_Planet *a2, unsigned __int8 a3)
{
  T_Ship *v5; // eax
  int v6; // ebp
  int v7; // [esp+0h] [ebp-14h]

  if ( a2->production )
  {
    if ( sub_35930(a2, 0x16) == 0xFFFF )
    {
      if ( (V_Game.day > 0xAA || V_Game.Unknown_D8A[0x2A] == 2)
        && ((1 << *a1) & (char)V_ResTree.items[V_PlanetItems.item[0x16].resReq].z2[0]) != 0 )
      {
        if ( !sub_34AE4(a2, 0x16u, 0) )
        {
          return 2;
        }
        return 1;
      }
    }
    else if ( sub_362E0(a2) && (a2->byte57 != byte_104BEA || V_FlashPopExists_dword_A0D00 == 0xFFFFFFFF) )
    {
      v7 = sub_34AE4(a2, 0x17u, 0);
      if ( v7 != 0xFFFF )
      {
        v5 = sub_40144(a1, (int)a2);
        v6 = (int)v5;
        if ( !v5 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x537);
        }
        sub_3F060(a1, v5, (int)a2, a3);
        sub_35B04((int)a2, v7, v6);
        return 1;
      }
    }
  }
  return 0;
}
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;

//----- (0003CC90) --------------------------------------------------------
unsigned int __fastcall Q_NC_sub_3CC90(_BYTE *a1, unsigned __int8 a2)
{
  if ( a2 < 39u && ((1 << *a1) & (char)V_ResTree.items[V_PlanetItems.item[a2].resReq].z2[0]) != 0 )
  {
    return 0xFFFFFFFF;
  }
  else
  {
    return 0;
  }
}

//----- (0003CCE4) --------------------------------------------------------
unsigned int __fastcall sub_3CCE4(_BYTE *a1, P_Planet a2_1)
{
  unsigned int v4; // ebp
  int v5; // edi
  int production; // ebx
  int word46; // ebx
  int v8; // ecx
  int v9; // edx
  char v10; // al
  __int16 v11; // ax
  int a; // eax
  T_PlanetItem *v13; // ebx
  unsigned __int8 *v14; // edi
  int ind; // eax
  int v16; // edi
  signed __int8 pros; // al
  int v18; // edi
  unsigned __int8 *v19; // eax
  signed __int8 res; // ah
  int v21; // edi
  unsigned __int8 *v22; // eax
  char *v23; // edi
  int v24; // eax
  int v25; // edx
  int resReq; // ebx
  char v27; // bl
  UBYTE v28; // bh
  _DWORD v30[3]; // [esp+0h] [ebp-F8h]
  int v31; // [esp+Ch] [ebp-ECh]
  int v32; // [esp+10h] [ebp-E8h]
  int v33; // [esp+18h] [ebp-E0h]
  int v34; // [esp+1Ch] [ebp-DCh]
  int v35; // [esp+20h] [ebp-D8h]
  int v36; // [esp+24h] [ebp-D4h]
  int v37; // [esp+28h] [ebp-D0h]
  int v38; // [esp+2Ch] [ebp-CCh]
  int v39; // [esp+30h] [ebp-C8h]
  int v40; // [esp+34h] [ebp-C4h]
  int v41; // [esp+38h] [ebp-C0h]
  int v42; // [esp+3Ch] [ebp-BCh]
  int v43; // [esp+44h] [ebp-B4h]
  int v44; // [esp+48h] [ebp-B0h]
  int v45; // [esp+4Ch] [ebp-ACh]
  int v46; // [esp+50h] [ebp-A8h]
  int v47; // [esp+9Ch] [ebp-5Ch]
  int v48; // [esp+A0h] [ebp-58h]
  int v49; // [esp+A4h] [ebp-54h]
  int v50; // [esp+A8h] [ebp-50h]
  float v51; // [esp+ACh] [ebp-4Ch]
  float v52; // [esp+B0h] [ebp-48h]
  int a3; // [esp+B4h] [ebp-44h]
  float v54; // [esp+B8h] [ebp-40h]
  int v55; // [esp+BCh] [ebp-3Ch]
  float v56; // [esp+C0h] [ebp-38h]
  float v57; // [esp+C4h] [ebp-34h]
  int v58; // [esp+C8h] [ebp-30h]
  int v59; // [esp+CCh] [ebp-2Ch]
  int v60; // [esp+D0h] [ebp-28h]
  int v61; // [esp+D4h] [ebp-24h]
  int v62; // [esp+D8h] [ebp-20h]
  float v63; // [esp+DCh] [ebp-1Ch]
  int a2; // [esp+E0h] [ebp-18h]
  int v65; // [esp+E4h] [ebp-14h]
  int v66; // [esp+E8h] [ebp-10h]
  int v67; // [esp+ECh] [ebp-Ch]
  int v68; // [esp+F0h] [ebp-8h]
  unsigned __int8 v69; // [esp+F4h] [ebp-4h]

  v4 = 0;
  v55 = 0;
  v58 = 0xFFFFFFFF;
  v56 = 0.0;
  v54 = 1.0;
  v51 = 1.0;
  v57 = 1.0;
  *(float *)&a3 = 1.0;
  v52 = 1.0;
  v47 = 0;
  v67 = 0;
  v50 = 0;
  v65 = 0;
  a2 = 0;
  v5 = sub_36158(a2_1);
  if ( V_PlanetItems.item[0x13].resReq == 0xFF
    || ((1 << a2_1->byte57) & (char)V_ResTree.items[V_PlanetItems.item[0x13].resReq].z2[0]) != 0 )
  {
    a2 = 0xFFFFFFFF;
  }
  if ( V_PlanetItems.item[0x13].resReq == 0xFF
    || ((1 << a2_1->byte57) & (char)V_ResTree.items[V_PlanetItems.item[0x13].resReq].z2[0]) != 0 )
  {
    v65 = 0xFFFFFFFF;
  }
  if ( a2_1->word4A - a2_1->word42 > 0 )
  {
    v47 = 0xFFFFFFFF;
  }
  if ( sub_40590(a1) )
  {
    v55 = 0xFFFFFFFF;
  }
  if ( (unsigned __int16)a2_1->word48 < 2u )
  {
    v67 = 0xFFFFFFFF;
    v57 = 2.0;
    v4 = 4;
  }
  if ( a2_1->word1C || a2_1->word4A - a2_1->word42 <= 3 || !v65 )
  {
    if ( (unsigned __int16)a2_1->word1C > 1u && a2_1->word4A - a2_1->word42 < 2 )
    {
      v4 = 8;
      if ( v47 == 0xFFFFFFFF )
      {
        *(float *)&a3 = 0.0;
      }
    }
  }
  else
  {
    *(float *)&a3 = 0.5;
    v50 = 0xFFFFFFFF;
  }
  if ( v5 < 4 )
  {
    v52 = 2.0;
    if ( !v4 )
    {
      v4 = 0x10;
    }
  }
  if ( v55 )
  {
    v51 = 0.0;
  }
  if ( a2_1->word42 - (unsigned __int16)a2_1->word4C <= (unsigned __int16)a2_1->word48
    || (unsigned __int16)a2_1->word48 >= 3u )
  {
    if ( a2_1->word42 - (unsigned __int16)a2_1->word4C < (unsigned __int16)a2_1->word48
      || (unsigned __int16)a2_1->word48 > 5u )
    {
      v57 = 0.5;
    }
  }
  else
  {
    v57 = 2.0;
    if ( !v4 )
    {
      v4 = 4;
    }
  }
  production = a2_1->production;
  if ( (unsigned __int16)production < 0x19u )
  {
    if ( a2_1->production )
    {
      v48 = 0x19 / production;
      v54 = (float)(0x19 / production);
    }
    else
    {
      v54 = 25.0;
    }
    if ( !v4 )
    {
      v4 = 2;
    }
  }
  if ( !v55 )
  {
    word46 = a2_1->word46;
    if ( (unsigned __int16)word46 < 0x19u )
    {
      if ( a2_1->word46 )
      {
        v48 = 0x19 / word46;
        v54 = (float)(0x19 / word46);
      }
      else
      {
        v54 = 25.0;
      }
      if ( !v4 )
      {
        v4 = 1;
      }
    }
  }
  if ( 5 * v5 < 2 * a2_1->word18 )
  {
    v52 = 1.5;
    if ( !v4 )
    {
      v4 = 0x10;
    }
  }
  v8 = 0;
  v9 = 0;
  while ( v8 < a2_1->word18 )
  {
    a = (int)a2_1->a;
    LOBYTE(a) = *(_BYTE *)(v9 + a + 1);
    v61 = 0;
    v60 = 0;
    v62 = 0;
    v59 = 0;
    v49 = 0;
    v13 = &V_PlanetItems.item[(unsigned __int8)a];
    if ( (_BYTE)a != 0xFF
      && (_BYTE)a != 4
      && (_BYTE)a != 6
      && (_BYTE)a != 7
      && (_BYTE)a != 8
      && (_BYTE)a != 0x13
      && (_BYTE)a != 5
      && (_BYTE)a != 0xB
      && (_BYTE)a != 0xC
      && (_BYTE)a != 0xD
      && (_BYTE)a != 0xE
      && (_BYTE)a != 0xF
      && (_BYTE)a != 0x11
      && (_BYTE)a != 0x10
      && ((_BYTE)a != 0x12 || a2 && (v4 == 0x10 || !v4))
      && ((_BYTE)a != 3 || v50)
      && ((_BYTE)a != 0x14 || v47)
      && ((_BYTE)a != 9 && (_BYTE)a != 0xA || v55) )
    {
      v14 = (unsigned __int8 *)a2_1->a + v9;
      LOWORD(a) = *((_WORD *)v14 + 1) & 1;
      v68 = a;
      HIWORD(ind) = 0;
      if ( (_WORD)v68 )
      {
        if ( v13->ind )
        {
          ind = (char)v13->ind;
          v16 = *v14;
          v61 += ind;
          if ( v16 == 2 )
          {
            ++v61;
          }
        }
        pros = v13->pros;
        if ( pros )
        {
          v18 = pros + v62;
          v19 = (unsigned __int8 *)a2_1->a;
          v62 = v18;
          ind = v19[v9];
          if ( ind == 3 )
          {
            ind = v18 + 1;
            v62 = v18 + 1;
          }
        }
        res = v13->res;
        if ( res )
        {
          v21 = res + v60;
          v22 = (unsigned __int8 *)a2_1->a;
          v60 = v21;
          ind = v22[v9];
          if ( ind == 4 )
          {
            v60 = v21 + 1;
          }
        }
        v23 = (char *)a2_1->a + v9;
        if ( v23[1] != (char)0xFF )
        {
          LOWORD(ind) = *((_WORD *)v23 + 1) & 1;
          v68 = ind;
          if ( (_BYTE)ind )
          {
            v10 = v23[1];
            if ( (unsigned __int8)v10 >= 0x12u )
            {
              if ( (unsigned __int8)v10 <= 0x12u )
              {
                v49 += 2;
              }
              else if ( v10 == 0x13 )
              {
                v49 += 4;
              }
            }
          }
        }
        v59 += (char)v13->mpop;
      }
      v63 = (double)v61 * v54;
      v63 = (double)v60 * v51 + v63;
      v63 = (double)v62 * v57 + v63;
      v11 = *(_WORD *)((char *)a2_1->a + v9 + 2);
      v63 = (double)v59 * *(float *)&a3 + v63;
      v63 = (double)v49 * v52 + v63;
      if ( (v11 & 2) != 0 )
      {
        v63 = v63 + v57;
      }
      if ( v58 == 0xFFFFFFFF || v63 < (double)v56 )
      {
        v58 = v8;
        v56 = v63;
      }
    }
    v9 += 4;
    ++v8;
  }
  if ( v58 == 0xFFFFFFFF )
  {
    return 0;
  }
  v66 = rand() % 0x64;
  v24 = 0;
  v25 = 0;
  do
  {
    resReq = V_PlanetItems.item[v25].resReq;
    if ( resReq == 0xFF || ((1 << a2_1->byte57) & (char)V_ResTree.items[resReq].z2[0]) != 0 )
    {
      v30[v24] = 0xFFFFFFFF;
    }
    else
    {
      v30[v24] = 0;
    }
    ++v24;
    ++v25;
  }
  while ( v24 != 0x27 );
  v69 = 0xFF;
  v27 = *((_BYTE *)a2_1->a + 4 * v58 + 1);
  v28 = v27;
  if ( (v27 == 2 || v27 == 9 || v27 == 0xA) && v55 == 0xFFFFFFFF )
  {
    if ( v67 == 0xFFFFFFFF )
    {
      v27 = 1;
    }
    else if ( v66 >= 0x19 )
    {
      v27 = 0;
    }
    else
    {
      v27 = 0x12;
    }
  }
  if ( v4 < 2 )
  {
    if ( !v4 )
    {
      goto LABEL_222;
    }
    if ( !v55 )
    {
      v27 = 2;
      goto LABEL_222;
    }
LABEL_123:
    v27 = 0;
    goto LABEL_222;
  }
  if ( v4 <= 2 )
  {
    goto LABEL_123;
  }
  if ( v4 < 8 )
  {
    v27 = 1;
  }
  else if ( v4 <= 8 )
  {
    v27 = 0x14;
  }
  else
  {
    v27 = 0x12;
  }
LABEL_222:
  if ( (unsigned __int8)v27 < 2u )
  {
    if ( v27 )
    {
      if ( sub_35930(a2_1, 0xD) == 0xFFFF && v40 )
      {
        v69 = 0xD;
        goto LABEL_136;
      }
      if ( !v67 && sub_35930(a2_1, 0xF) == 0xFFFF && v42 )
      {
        v69 = 0xF;
        goto LABEL_136;
      }
      if ( !v67 && sub_35930(a2_1, 0x11) == 0xFFFF && v43 )
      {
        v69 = 0x11;
        goto LABEL_136;
      }
      if ( !v67 && sub_35930(a2_1, 0xB) == 0xFFFF && v38 )
      {
        v69 = 0xB;
        goto LABEL_136;
      }
      if ( v32 && v34 )
      {
        if ( v66 < 0x32 && !v55 )
        {
          v69 = 4;
          goto LABEL_136;
        }
      }
      else
      {
        if ( v32 && !v55 )
        {
          v69 = 4;
          goto LABEL_136;
        }
        if ( !v34 )
        {
          if ( !v36 || v55 )
          {
            if ( v28 != v27 && v30[1] )
            {
              v69 = 1;
            }
          }
          else
          {
            v69 = 9;
          }
          goto LABEL_136;
        }
      }
      v69 = 7;
      goto LABEL_136;
    }
    if ( sub_35930(a2_1, 0xC) == 0xFFFF && v39 )
    {
      v69 = 0xC;
      goto LABEL_136;
    }
    if ( sub_35930(a2_1, 0x11) == 0xFFFF && v43 )
    {
      v69 = 0x11;
      goto LABEL_136;
    }
    if ( sub_35930(a2_1, 0xB) == 0xFFFF && v38 )
    {
      v69 = 0xB;
      goto LABEL_136;
    }
    if ( v32 && v33 )
    {
      if ( v66 < 0x32 && !v55 )
      {
        v69 = 4;
        goto LABEL_136;
      }
    }
    else
    {
      if ( v32 && !v55 )
      {
        v69 = 4;
        goto LABEL_136;
      }
      if ( !v33 )
      {
        if ( !v37 || v55 )
        {
          if ( v28 && v30[0] )
          {
            v69 = 0;
          }
        }
        else
        {
          v69 = 0xA;
        }
        goto LABEL_136;
      }
    }
    v69 = 6;
    goto LABEL_136;
  }
  if ( (unsigned __int8)v27 <= 2u )
  {
    if ( sub_35930(a2_1, 0xE) == 0xFFFF && v41 )
    {
      v69 = 0xE;
    }
    else if ( sub_35930(a2_1, 0x11) == 0xFFFF && v43 )
    {
      v69 = 0x11;
    }
    else if ( sub_35930(a2_1, 0xB) == 0xFFFF && v38 )
    {
      v69 = 0xB;
    }
    else if ( v35 )
    {
      v69 = 8;
    }
    else if ( v32 )
    {
      v69 = 4;
    }
    else if ( v37 )
    {
      v69 = 0xA;
    }
    else if ( v36 )
    {
      v69 = 9;
    }
    else if ( v28 != v27 && v30[2] )
    {
      v69 = 2;
    }
  }
  else if ( (unsigned __int8)v27 < 0x12u )
  {
    if ( v27 != 3 )
    {
      return 0;
    }
    if ( v32 )
    {
      v69 = 4;
    }
    else if ( v28 != 3 && v31 )
    {
      v69 = 3;
    }
  }
  else if ( (unsigned __int8)v27 <= 0x12u )
  {
    if ( v45 )
    {
      v69 = 0x13;
    }
    else if ( v28 != v27 && v44 )
    {
      v69 = 0x12;
    }
  }
  else
  {
    if ( v27 != 0x14 )
    {
      return 0;
    }
    if ( v32 )
    {
      v69 = 4;
    }
    else if ( v31 )
    {
      v69 = 3;
    }
    else if ( v28 != 0x14 && v46 )
    {
      v69 = 0x14;
    }
  }
LABEL_136:
  if ( v69 < 0x27u && sub_34B0C(a2_1, (unsigned __int16)v58, v28, 1u) )
  {
    sub_34774(a2_1, v69, v58, 0);
    return 0xFFFFFFFF;
  }
  return 0;
}
// 3D3C4: conditional instruction was optimized away because ebp.4==10
// 3D3FB: conditional instruction was optimized away because ebp.4==4

//----- (0003D8F0) --------------------------------------------------------
void __fastcall sub_3D8F0(int a1, P_Planet a2)
{
  char *v2; // edi
  int v4; // eax
  T_Planet *v5; // eax
  unsigned __int8 v6; // dl
  int word42; // eax
  int v8; // eax
  int v9; // eax
  int v10; // ebp
  UWORD word4C; // ax
  int v12; // ebp
  int v13; // eax
  int v14; // edx
  char v15; // bl
  T_PlanetItem *v16; // ebx
  int upop; // ebx
  int v18; // ebx
  int v19; // ebp
  int v20; // edi
  int v21; // edx
  int resReq; // eax
  UBYTE byte57; // cl
  int ind; // ecx
  T_PlanetItem *v25; // eax
  int v26; // ecx
  __int16 v27; // ax
  int v28; // eax
  int v29; // edi
  int v30; // ebx
  unsigned __int8 *v31; // ecx
  int v32; // edx
  int v33; // eax
  unsigned __int16 v34; // di
  _BYTE v35[176]; // [esp+0h] [ebp-10Ch] BYREF
  int v36; // [esp+C4h] [ebp-48h] BYREF
  int v37; // [esp+C8h] [ebp-44h] BYREF
  int a3; // [esp+CCh] [ebp-40h] BYREF
  int word4A; // [esp+D0h] [ebp-3Ch]
  int v40; // [esp+D4h] [ebp-38h]
  int eax0; // [esp+D8h] [ebp-34h]
  int v42; // [esp+E0h] [ebp-2Ch]
  int v43; // [esp+E4h] [ebp-28h]
  unsigned int v44; // [esp+E8h] [ebp-24h]
  int v45; // [esp+ECh] [ebp-20h]
  int v46; // [esp+F0h] [ebp-1Ch]
  int v47; // [esp+F4h] [ebp-18h]
  int v48; // [esp+F8h] [ebp-14h]
  unsigned __int8 *v49; // [esp+FCh] [ebp-10h]
  int v50; // [esp+100h] [ebp-Ch]
  int v51; // [esp+104h] [ebp-8h]
  unsigned __int8 v52; // [esp+108h] [ebp-4h]

  eax0 = a1;
  v40 = 0;
  v48 = 0;
  sub_34A44(a2, &v37, &v36, &a3);
  if ( sub_40590((_BYTE *)eax0) == 0xFFFFFFFF )
  {
    v36 += v37;
    a3 += v37;
    v37 = 0;
  }
  v4 = sub_358F0(a2);
  if ( v4 < 1 )
  {
    if ( v36 > 0 )
    {
LABEL_5:
      v5 = a2;
      v6 = 0;
      goto LABEL_20;
    }
    goto LABEL_18;
  }
  if ( v4 < 2 )
  {
    if ( a3 <= 0 || a2->production <= 1u )
    {
      goto LABEL_5;
    }
LABEL_18:
    v6 = 1;
    goto LABEL_19;
  }
  if ( v4 >= 3 )
  {
    goto LABEL_21;
  }
  if ( v37 <= 0 || (unsigned __int16)a2->word48 <= 1u || a2->production <= 1u )
  {
    if ( v36 > 0 && (unsigned __int16)a2->word48 > 1u )
    {
      v5 = a2;
      v6 = 0;
      goto LABEL_20;
    }
    goto LABEL_18;
  }
  v6 = 2;
LABEL_19:
  v5 = a2;
LABEL_20:
  if ( sub_34AE4(v5, v6, 0xFFFFFFFF) != 0xFFFF )
  {
    return;
  }
LABEL_21:
  if ( !a2->production )
  {
    return;
  }
  if ( (unsigned __int16)a2->word48 < 2u )
  {
    word42 = a2->word42;
    if ( a2->word4A - (unsigned __int16)word42 < 1 && word42 - (unsigned __int16)a2->word4C < 1 )
    {
      v48 = 0xFFFFFFFF;
    }
  }
  v8 = a2->word42;
  if ( a2->word4A - (unsigned __int16)v8 < 1 && v8 - (unsigned __int16)a2->word4C < 2 )
  {
    v40 = 0xFFFFFFFF;
  }
  v43 = (__int16)sub_3E1CC(eax0, a2);
  if ( v43 == 1 )
  {
    return;
  }
  v47 = (sub_3407C(a2) <= 0) - 1;
  v46 = (sub_3420C(a2) <= 0) - 1;
  v9 = sub_34AE4(a2, 0x26u, 0xFFFFFFFF);
  v10 = (v9 == 0xFFFF) - 1;
  sub_34B0C(a2, (unsigned __int16)v9, 0x26u, 1u);
  if ( !a2->word1C || !v47 && !v46 && !v10 )
  {
    goto LABEL_102;
  }
  if ( v10 == 0xFFFFFFFF )
  {
    sub_3E520(eax0, a2);
    return;
  }
  if ( v47 != 0xFFFFFFFF )
  {
    if ( ((1 << a2->byte57) & (char)V_ResTree.items[V_PlanetItems.item[0x24].resReq].z2[0]) != 0 )
    {
      LOWORD(v42) = sub_35930(a2, 0x15);
      v42 = (unsigned __int16)v42;
      if ( (unsigned __int16)v42 == 0xFFFF )
      {
        if ( sub_34AE4(a2, 0x24u, 0) != 0xFFFF )
        {
          return;
        }
      }
      else
      {
        v34 = v42;
        sub_34B0C(a2, (unsigned __int16)v42, 0x15u, 1u);
        if ( sub_34368(a2, 0x24u, v34) )
        {
          sub_34774(a2, 0x24u, v42, 0);
          return;
        }
      }
      goto LABEL_102;
    }
    if ( a2->word1C > (unsigned int)a2->word20 && v40 != 0xFFFFFFFF && sub_34AE4(a2, 0x15u, 0xFFFFFFFF) != 0xFFFF )
    {
      return;
    }
LABEL_102:
    sub_3CCE4((_BYTE *)eax0, a2);
    return;
  }
  v42 = 0xFFFFFFFF;
  word4C = a2->word4C;
  v12 = 0;
  if ( word4C < a2->word4A )
  {
    if ( word4C >= a2->word42 || v43 == 2 )
    {
      return;
    }
  }
  else
  {
    v13 = 0;
    v14 = 0;
    while ( v13 < a2->word18 )
    {
      v2 = (char *)a2->a + v14;
      v15 = v2[1];
      if ( v15 != (char)0xFF && v15 != 5 )
      {
        v16 = &V_PlanetItems.item[(unsigned __int8)v2[1]];
        if ( !v16->mpop )
        {
          upop = (char)v16->upop;
          if ( upop > v12 )
          {
            v12 = upop;
            v42 = v13;
          }
        }
      }
      v14 += 4;
      ++v13;
    }
    if ( v42 == 0xFFFFFFFF )
    {
      Q_debugbreak_sub_26194();
      sub_37040(a2);
      return;
    }
    sub_34B0C(a2, (unsigned __int16)v42, v2[1], 1u);
    if ( (unsigned int)a2->word4C >= a2->word42 )
    {
      return;
    }
  }
  if ( a2->word42 - (unsigned __int16)a2->word4C <= 0 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x85A);
  }
  if ( v48 || sub_3E520(eax0, a2) != 0xFFFFFFFF )
  {
    v44 = (__int16)sub_3E800((_BYTE *)eax0, (unsigned __int16 *)a2);
    if ( v44 == 0xFFFFFFFF )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x870);
    }
    v18 = 0;
    v19 = 0;
    v20 = 0;
    v21 = 0;
    do
    {
      while ( 1 )
      {
        if ( (_BYTE)v18 != 5 && v18 < V_PlanetItems.num1 )
        {
          resReq = V_PlanetItems.item[v20].resReq;
          if ( resReq == 0xFF
            || (byte57 = a2->byte57, word4A = (char)V_ResTree.items[resReq].z2[0], ((1 << byte57) & word4A) != 0) )
          {
            word4A = a2->word4A;
            if ( (char)V_PlanetItems.item[v20].upop <= word4A - (unsigned __int16)a2->word4C )
            {
              break;
            }
          }
        }
LABEL_64:
        ++v18;
        ++v20;
        if ( v18 >= 0x27 )
        {
          goto LABEL_77;
        }
      }
      HIWORD(ind) = HIWORD(v44);
      v25 = &V_PlanetItems.item[v20];
      if ( v44 <= 3 )
      {
        switch ( (unsigned int)v25 )
        {
          case 0u:
            ind = (char)v25->ind;
            if ( !v25->ind )
            {
              goto LABEL_64;
            }
            *(_WORD *)&v35[v21 + 1] = (char)v25->ind;
            break;
          case 1u:
            ind = (char)v25->res;
            if ( !v25->res )
            {
              goto LABEL_64;
            }
            *(_WORD *)&v35[v21 + 1] = (char)v25->res;
            break;
          case 2u:
            ind = (char)v25->pros;
            if ( !v25->pros )
            {
              goto LABEL_64;
            }
            *(_WORD *)&v35[v21 + 1] = (char)v25->pros;
            break;
          case 3u:
            ind = (char)v25->mpop;
            if ( !v25->mpop )
            {
              goto LABEL_64;
            }
            *(_WORD *)&v35[v21 + 1] = (char)v25->mpop;
            break;
        }
      }
      LOWORD(ind) = (char)v25->mpop;
      v50 = ind;
      LOWORD(ind) = (char)v25->pros;
      v26 = ind + v50;
      v21 += 5;
      v51 = v26;
      LOWORD(v26) = (char)v25->res;
      ++v19;
      v50 = v26;
      v27 = (char)v25->ind;
      LOWORD(v26) = v26 + v51;
      v35[0xFFFFFFFB + v21] = v18;
      *(_WORD *)&v35[0xFFFFFFFE + v21] = v26 + v27;
      ++v18;
      ++v20;
    }
    while ( v18 < 0x27 );
LABEL_77:
    if ( v19 || sub_3CCE4((_BYTE *)eax0, a2) != 0xFFFFFFFF )
    {
      v28 = rand();
      v29 = 0;
      v52 = 0xFF;
      v45 = v28 % 0x64;
      v30 = 0;
      if ( v19 > 0 )
      {
        v31 = v35;
        while ( 1 )
        {
          v32 = *v31;
          v49 = v31;
          if ( sub_35930(a2, v32) == 0xFFFF )
          {
            break;
          }
          if ( v45 <= 0x41 )
          {
            v33 = *(__int16 *)(v31 + 1);
          }
          else
          {
            v33 = *(__int16 *)(v31 + 3);
          }
          if ( v33 > v29 )
          {
            v29 = v33;
            v52 = *v49;
          }
          ++v30;
          v31 += 5;
          if ( v30 >= v19 )
          {
            goto LABEL_90;
          }
        }
        if ( V_PlanetItems.item[*v31].cost / (int)a2->production < 0x46 )
        {
          v52 = *v31;
        }
      }
LABEL_90:
      if ( v52 != 0xFF && sub_34AE4(a2, v52, 0) == 0xFFFF )
      {
        goto LABEL_102;
      }
    }
  }
}
// 3DBF4: variable 'v2' is possibly undefined

//----- (0003E020) --------------------------------------------------------
unsigned int __fastcall sub_3E020(int eax0, P_Planet edx0, unsigned __int8 bl0)
{
  unsigned int result; // eax
  int v5; // ebx
  int v6; // eax
  int v7; // edx
  int word18; // esi
  int v9; // edi
  signed int v10; // eax
  char v11; // cl
  int a3; // [esp+8h] [ebp-18h]
  int a2; // [esp+Ch] [ebp-14h]
  signed int v14; // [esp+10h] [ebp-10h]
  unsigned int v15; // [esp+14h] [ebp-Ch]
  int v16; // [esp+18h] [ebp-8h]

  if ( bl0 > 0x1Eu || bl0 < 0x16u || bl0 == 0x17 )
  {
    return 0;
  }
  v14 = 0;
  v16 = 0xFFFFFFFF;
  a3 = 0;
  v5 = sub_36050(edx0);
  v15 = 0;
  v6 = sub_35FE0(edx0);
  v7 = v6;
  if ( bl0 == 0x1A || bl0 == 0x1B )
  {
    v15 = 0xFFFFFFFF;
  }
  else if ( bl0 == 0x1C || bl0 == 0x1D || bl0 == 0x1E )
  {
    a3 = 0xFFFFFFFF;
  }
  a2 = v6 - 3;
  word18 = edx0->word18;
  v9 = 4 * (unsigned __int16)word18;
  while ( word18 < edx0->word1A )
  {
    v11 = *((_BYTE *)edx0->a + v9 + 1);
    v10 = 0xFFFFFFFF;
    if ( v11 != 0x1A || bl0 == 0x1A )
    {
      if ( v11 != 0x1C || bl0 == 0x1C )
      {
        if ( v11 == 0x1D && bl0 != 0x1D && (!v15 || v7 < v5 - 4) )
        {
          v10 = 4;
          if ( v7 > v5 )
          {
            v10 = 8;
          }
        }
      }
      else if ( !v15 || v7 < v5 - 2 )
      {
        v10 = 2;
        if ( v7 > v5 )
        {
          v10 = 4;
        }
      }
    }
    else if ( !a3 || v5 < a2 )
    {
      v10 = 3;
      if ( v5 > v7 )
      {
        v10 = 6;
      }
    }
    if ( v10 != 0xFFFFFFFF && (v16 == 0xFFFFFFFF || v10 < v14) )
    {
      v16 = word18;
      v14 = v10;
    }
    v9 += 4;
    ++word18;
  }
  if ( v16 == 0xFFFFFFFF )
  {
    return 0;
  }
  result = sub_34B0C(edx0, (unsigned __int16)v16, *((_BYTE *)edx0->a + 4 * v16 + 1), 1u);
  if ( result )
  {
    sub_34774(edx0, bl0, v16, 0);
    return 0xFFFFFFFF;
  }
  return result;
}

//----- (0003E1CC) --------------------------------------------------------
int __fastcall sub_3E1CC(int eax0, P_Planet a2)
{
  unsigned __int8 v4; // ch
  int word46; // ebx
  int v6; // ebp
  int word42; // eax
  int production; // edx
  int v9; // eax
  int v10; // edx
  int v11; // edx
  unsigned int v13; // [esp+0h] [ebp-14h]
  int v14; // [esp+8h] [ebp-Ch]
  unsigned __int8 v15; // [esp+Ch] [ebp-8h]
  unsigned __int8 v16; // [esp+10h] [ebp-4h]

  v4 = 0xFF;
  v13 = 0;
  word46 = a2->word46;
  if ( sub_40590((_BYTE *)eax0) )
  {
    word46 = 0x3E8;
  }
  if ( sub_358F0(a2) < 5 )
  {
    return 0;
  }
  v14 = sub_35FE0(a2);
  v6 = sub_36050(a2);
  v16 = sub_35DA4(a2);
  v15 = sub_35E24(a2);
  if ( (unsigned __int16)a2->word1E < 2u
    || (word42 = a2->word42, a2->word4A - (unsigned __int16)word42 < 1) && word42 - (unsigned __int16)a2->word4C < 2
    || (unsigned __int16)a2->word48 < 2u )
  {
    v13 = 0xFFFFFFFF;
  }
  if ( v14 < 1 && v16 != 0xFF )
  {
    v4 = v16;
  }
  if ( v4 == 0xFF && v6 < 1 && v15 != 0xFF )
  {
    v4 = v15;
  }
  if ( v4 == 0xFF
    && sub_35930(a2, 0x16) == 0xFFFF
    && a2->size > 1u
    && (a2->production >= 4u || (unsigned __int16)a2->word1C - (unsigned __int16)a2->word20 < 5) )
  {
    if ( ((char)V_ResTree.items[V_PlanetItems.item[0x16].resReq].z2[0] & (1 << *(_BYTE *)eax0)) != 0 )
    {
      v4 = 0x16;
    }
  }
  else if ( a2->production < 4u && sub_3407C(a2) > 0 )
  {
    return 0;
  }
  if ( (a2->production < 0x14u || word46 < 0x14)
    && sub_3407C(a2) > 0
    && (v14 > 0 || v16 == 0xFF)
    && (v6 > 0 || v15 == 0xFF) )
  {
    production = a2->production;
    v9 = v6 + v14;
    if ( (unsigned __int16)production <= word46 )
    {
      if ( v9 > production )
      {
        return 0;
      }
    }
    else if ( v9 > word46 )
    {
      return 0;
    }
  }
  v10 = 0;
  if ( &V_Game.stars[a2->starIndex] == (T_Star *)*(T_Game **)(eax0 + 7) )
  {
    v10 = 6;
  }
  if ( v4 != 0xFF || v6 >= v14 || v15 == 0xFF || v6 >= v10 + 6 )
  {
    if ( v4 == 0xFF && v16 != 0xFF && v10 + 6 > v14 )
    {
      v4 = v16;
    }
  }
  else
  {
    v4 = v15;
  }
  v11 = rand() % 0x64;
  if ( v4 == 0xFF && v11 < 0x14 && sub_34368(a2, 0x19u, 0xFFFFu) && sub_35930(a2, 0x19) == 0xFFFF )
  {
    v4 = 0x19;
  }
  if ( v4 != 0xFF || v6 >= v14 || v15 == 0xFF )
  {
    if ( v4 == 0xFF && v16 != 0xFF )
    {
      v4 = v16;
    }
  }
  else
  {
    v4 = v15;
  }
  if ( v4 != 0xFF )
  {
    if ( !v13 && sub_34AE4(a2, v4, 0) != 0xFFFF )
    {
      return 1;
    }
    if ( sub_3E020(eax0, a2, v4) )
    {
      return 1;
    }
    if ( v4 != v16 || v15 == 0xFF )
    {
      if ( v4 == v15 && v16 != 0xFF && sub_3E020(eax0, a2, v16) )
      {
        return 1;
      }
    }
    else if ( sub_3E020(eax0, a2, v15) )
    {
      return 1;
    }
  }
  return 0;
}

//----- (0003E520) --------------------------------------------------------
unsigned int __fastcall sub_3E520(int a1, P_Planet a2)
{
  unsigned int result; // eax
  int v5; // edx
  int word42; // eax
  int v7; // esi
  int word18; // edx
  int v9; // eax
  UWORD word46; // di
  int v11; // edx
  __int16 i; // di
  unsigned __int8 v13; // si
  int v14; // [esp+0h] [ebp-10h]
  char v15; // [esp+4h] [ebp-Ch]
  unsigned __int8 v16; // [esp+8h] [ebp-8h]
  unsigned __int8 v17; // [esp+Ch] [ebp-4h]

  if ( (a2->Unknown_66 & 2) != 0 && sub_34AE4(a2, 0x26u, 0) != 0xFFFF )
  {
    result = 0xFFFFFFFF;
    a2->Unknown_66 &= ~2u;
    return result;
  }
  v5 = 3;
  if ( sub_40590((_BYTE *)a1) == 0xFFFFFFFF )
  {
    v5 = 0;
  }
  if ( a2->production < 3u )
  {
    return 0;
  }
  if ( a2->word46 < v5 )
  {
    return 0;
  }
  if ( (unsigned __int16)a2->word48 < 2u )
  {
    return 0;
  }
  word42 = a2->word42;
  if ( a2->word4A - (unsigned __int16)word42 < 1 && word42 - (unsigned __int16)a2->word4C < 2 )
  {
    return 0;
  }
  if ( (unsigned __int16)a2->word1C - (unsigned __int16)a2->word20 < 3 )
  {
    return 0;
  }
  v7 = sub_36158(a2);
  if ( &V_Game.stars[a2->starIndex] == (T_Star *)*(T_Game **)(a1 + 7) )
  {
    word18 = a2->word18;
  }
  else
  {
    word18 = 2 * a2->word18;
  }
  v9 = word18 / 5;
  if ( word18 / 5 < 4 )
  {
    v9 = 4;
  }
  if ( (a2->production < 0x14u || a2->word46 < 0x14u) && v7 > 0 )
  {
    word46 = a2->word46;
    v11 = 3 * v7;
    if ( a2->production <= word46 )
    {
      if ( v11 <= 2 * a2->production )
      {
        goto LABEL_25;
      }
    }
    else if ( v11 <= 2 * word46 )
    {
      goto LABEL_25;
    }
    v9 = v7;
  }
LABEL_25:
  if ( v7 < v9 )
  {
    v16 = 0xFF;
    if ( sub_34368(a2, 0x13u, 0xFFFFu) )
    {
      v16 = 0x13;
    }
    else if ( sub_34368(a2, 0x12u, 0xFFFFu) )
    {
      v16 = 0x12;
    }
    if ( v16 != 0xFF && sub_34AE4(a2, v16, 0) )
    {
      return 0xFFFFFFFF;
    }
  }
  if ( a2->byte57 % 2
    && a2->production > 0x14u
    && rand() % 0x64 < 4
    && sub_34368(a2, 0xBu, 0xFFFFu)
    && sub_35930(a2, 0xB) == 0xFFFF
    && sub_34AE4(a2, 0xBu, 0) )
  {
    return 0xFFFFFFFF;
  }
  v14 = unk_96918;
  v15 = *((_BYTE *)&unk_96918 + 4);
  for ( i = 0; i < 5; ++i )
  {
    v17 = *((_BYTE *)&v14 + i);
    if ( (v17 != 0x25 || (a2->Unknown_66 & 1) == 0)
      && sub_34368(a2, v17, 0xFFFFu)
      && (sub_40590((_BYTE *)a1) == 0xFFFFFFFF || v17 != 0xE) )
    {
      v13 = v17;
      if ( sub_35930(a2, v17) == 0xFFFF )
      {
        if ( sub_34AE4(a2, v13, 0) )
        {
          return 0xFFFFFFFF;
        }
      }
    }
  }
  return 0;
}

//----- (0003E800) --------------------------------------------------------
int __fastcall sub_3E800(_BYTE *a1, unsigned __int16 *a2)
{
  int v3; // ebx
  int v4; // eax
  int v5; // eax
  int v7; // eax
  int v8; // eax
  int v9; // ebx
  int v10; // ecx
  int v11; // [esp+0h] [ebp-1Ch] BYREF
  int v12; // [esp+4h] [ebp-18h] BYREF
  int v13[5]; // [esp+8h] [ebp-14h] BYREF

  sub_34A44((T_Planet *)a2, &v12, &v11, v13);
  v3 = sub_40590(a1);
  if ( v3 == 0xFFFFFFFF )
  {
    v4 = v12;
    v12 = 0;
    v11 += v4;
    v13[0] += v4;
  }
  v5 = a2[0x21];
  if ( a2[0x25] - (unsigned __int16)v5 >= 2 || v5 - a2[0x26] >= 2 )
  {
    if ( a2[0x22] < 3u && v11 > 0 )
    {
      return 0;
    }
    if ( a2[0x23] < 3u && v12 > 0 && !v3 )
    {
      return 1;
    }
    if ( a2[0x24] < 2u && v13[0] > 0 )
    {
      return 2;
    }
    if ( a2[0x22] < 4u && v11 > 0 )
    {
      return 0;
    }
    if ( a2[0x24] < 3u && v13[0] > 0 )
    {
      return 2;
    }
    if ( a2[0x23] < 5u && v12 > 0 && !v3 )
    {
      return 1;
    }
    if ( !a2[0x24] )
    {
      return 2;
    }
    if ( a2[0x24] < 2u )
    {
      v7 = a2[0x21];
      if ( a2[0x25] - (unsigned __int16)v7 < 1 && v7 - a2[0x26] < 1 )
      {
        return 2;
      }
    }
    if ( v13[0] > 0 && V_PlanItem50 / a2[0x24] > 0xF )
    {
      v8 = a2[0x21];
      if ( a2[0x25] - (unsigned __int16)v8 > 3 && v8 - a2[0x26] != 1 )
      {
        return 2;
      }
    }
    if ( v3 == 0xFFFFFFFF )
    {
      if ( v11 > 0 )
      {
        return 0;
      }
      if ( v13[0] > 0 && a2[0x24] < 5u )
      {
        return 2;
      }
    }
    else
    {
      v9 = a2[0x22];
      v10 = a2[0x23];
      if ( sub_35930((P_Planet)a2, 0xC) != 0xFFFF )
      {
        v10 += v9 >> 1;
      }
      if ( sub_35930((P_Planet)a2, 0xE) != 0xFFF )
      {
        v9 += v10 >> 1;
      }
      if ( (v9 > v10 || v11 <= 0) && v12 > 0 )
      {
        return 1;
      }
      if ( v11 > 0 )
      {
        return 0;
      }
      if ( v13[0] > 0 )
      {
        return 2;
      }
    }
  }
  return 3;
}
// 9684C: using guessed type int V_PlanItem50;
// 3E800: using guessed type int var_14[5];

//----- (0003EA7C) --------------------------------------------------------
__int16 __fastcall sub_3EA7C(_BYTE *a1)
{
  signed __int16 v2; // si
  int v3; // eax
  int v4; // edi
  __int16 i; // si
  __int16 j; // ax
  __int16 v8[32]; // [esp+0h] [ebp-90h]
  __int16 v9[24]; // [esp+40h] [ebp-50h] BYREF
  int v10; // [esp+70h] [ebp-20h]
  int v11; // [esp+74h] [ebp-1Ch]

  v2 = 0;
  v10 = 0;
  while ( 1 )
  {
    LOWORD(v3) = V_ResTree.num;
    if ( v2 >= (int)(unsigned __int16)V_ResTree.num )
    {
      break;
    }
    v4 = (unsigned __int16)v10;
    if ( (unsigned __int16)v10 >= 0x20u )
    {
      break;
    }
    if ( ((1 << *a1) & (char)V_ResTree.items[v2].z2[0]) == 0 )
    {
      if ( sub_4694C((int)&V_ResTree, v2, (unsigned __int8)*a1) )
      {
        v8[v4] = v2;
        v10 = v4 + 1;
      }
    }
    ++v2;
  }
  LOWORD(v11) = 0xFFFF;
  if ( (_WORD)v10 )
  {
    qmemcpy(v9, &unk_9691E, 0x2Eu);
    if ( ((1 << *a1) & (char)V_ResTree.items[5].z2[0]) != 0 && rand() % 0x64 < 0x2D )
    {
      LOWORD(v11) = 0xFFFE;
    }
    for ( i = 0; i < (int)(unsigned __int16)v10 && (__int16)v11 == 0xFFFFFFFF; ++i )
    {
      for ( j = 0; j < 0x17 && (__int16)v11 == 0xFFFFFFFF; ++j )
      {
        if ( v9[j] == v8[i] )
        {
          LOWORD(v11) = v8[i];
        }
      }
    }
    if ( (v11 & 0x8000u) != 0 )
    {
      LOWORD(v11) = v8[rand() % (unsigned __int16)v10];
    }
    v3 = (unsigned __int8)*a1;
    V_ResTree.a.w1[v3] = v11;
  }
  return v3;
}
// 3EA7C: using guessed type __int16 var_90[32];
// 3EA7C: using guessed type __int16 var_50[24];

//----- (0003EBDC) --------------------------------------------------------
char __fastcall sub_3EBDC(unsigned __int8 *a1, int a2)
{
  unsigned __int8 *v2; // ecx
  char v3; // ah
  int v4; // esi
  int v5; // eax
  int v6; // eax
  int v7; // eax
  int v8; // ebx
  int v9; // esi
  int v10; // eax
  int v11; // ecx
  double v12; // st7
  double v13; // st7
  double v14; // st7
  int Unknown_14; // eax
  unsigned __int8 *v17; // [esp+4h] [ebp-40h]
  int v18; // [esp+8h] [ebp-3Ch]
  float v19; // [esp+Ch] [ebp-38h]
  unsigned int v20; // [esp+10h] [ebp-34h]
  int Unknown_15; // [esp+14h] [ebp-30h]
  T_Star *stars; // [esp+1Ch] [ebp-28h]
  float v23; // [esp+20h] [ebp-24h]
  float v24; // [esp+20h] [ebp-24h]
  __int16 v25; // [esp+24h] [ebp-20h]
  __int16 v26; // [esp+28h] [ebp-1Ch]
  unsigned __int8 v27; // [esp+2Ch] [ebp-18h]

  v2 = a1;
  v3 = *(_BYTE *)(a2 + 0x58);
  if ( v3 != 1 && v3 != 2 && v3 != 5 )
  {
    LOBYTE(a1) = byte_104BEA;
    if ( *(_WORD *)(a2 + 0x56) == byte_104BEA && !V_FlashPopExists_dword_A0D00 )
    {
      *(_BYTE *)(a2 + 0x5D) = 0;
      *(_DWORD *)(a2 + 0x5E) = 0;
      return (char)a1;
    }
    if ( *(_BYTE *)(a2 + 0x58) == 4 && *(_BYTE *)(a2 + 0x5D) == 1 )
    {
      v4 = *(_DWORD *)(a2 + 0x59);
      if ( !v4 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xBBC);
      }
      if ( *(_DWORD *)(a2 + 0x28) )
      {
        v5 = *(__int16 *)(v4 + 4);
        if ( *((char *)&dword_104FD1 + v5 + 3) > 0 )
        {
          --*((_BYTE *)&dword_104FD1 + v5 + 3);
        }
      }
      else if ( sub_4A534(a2, 0x49) )
      {
        v6 = *(__int16 *)(v4 + 4);
        if ( *((char *)&dword_104F6D + v6 + 3) > 0 )
        {
          --*((_BYTE *)&dword_104F6D + v6 + 3);
        }
      }
      else
      {
        v7 = *(__int16 *)(v4 + 4);
        if ( *((char *)&dword_104F09 + v7 + 3) > 0 )
        {
          --*((_BYTE *)&dword_104F09 + v7 + 3);
        }
      }
      *(_BYTE *)(a2 + 0x5D) = 0;
      *(_DWORD *)(a2 + 0x5E) = 0;
    }
    LOBYTE(a1) = *(_BYTE *)(a2 + 0x5D);
    if ( !(_BYTE)a1 )
    {
      if ( *(_BYTE *)(a2 + 0x58) == 3 && sub_35C38(*(T_Planet **)(a2 + 0x59), (T_Ship *)a2) != 0xFFFFFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xBE7);
      }
      if ( *(_BYTE *)(a2 + 0x58) != 4 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xBEB);
      }
      a1 = *(unsigned __int8 **)(a2 + 0x59);
      v17 = a1;
      if ( !a1 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xBEF);
      }
      if ( *(_DWORD *)(a2 + 0x28) == 0xFFFFFFFF )
      {
        a1 = (unsigned __int8 *)sub_403C0(v2, *(_DWORD *)(a2 + 0x59));
        if ( a1 )
        {
          *(_BYTE *)(a2 + 0x5D) = 2;
          *(_DWORD *)(a2 + 0x5E) = a1;
          return (char)a1;
        }
      }
      if ( *(int *)(a2 + 8) > 0 || *(int *)(a2 + 0xC) > 0 )
      {
        v8 = 0;
        v9 = 0;
        v19 = 0.0;
        v25 = 0;
        v18 = 0;
        v20 = sub_4A534(a2, 0x49);
        stars = V_Game.stars;
        v27 = sub_43374(v2, 0xFFFFFFFF);
        while ( 1 )
        {
          if ( v9 >= V_Game.starsNum )
          {
            LOBYTE(a1) = v18;
            if ( v18 )
            {
              if ( (unsigned __int8 *)v18 != v17 )
              {
                a1 = (unsigned __int8 *)sub_4AA78(a2, v18);
                if ( (int)a1 > 0 )
                {
                  LOBYTE(a1) = v25;
                  if ( v25 != *((_WORD *)v17 + 2) )
                  {
                    if ( *(_DWORD *)(a2 + 0x28) )
                    {
                      LOBYTE(a1) = v25;
                      ++*((_BYTE *)&dword_104FD1 + v25 + 3);
                    }
                    else
                    {
                      LOBYTE(a1) = v25;
                      if ( v20 )
                      {
                        ++*((_BYTE *)&dword_104F6D + v25 + 3);
                      }
                      else
                      {
                        ++*((_BYTE *)&dword_104F09 + v25 + 3);
                      }
                    }
                  }
                }
              }
            }
            return (char)a1;
          }
          if ( dword_104BEC[v8] > 0 || dword_104D7C[v8] > 0 )
          {
            break;
          }
LABEL_56:
          ++v8;
          ++v9;
          ++stars;
        }
        v26 = sub_4AA78(a2, (int)stars);
        Unknown_14 = (unsigned __int8)stars->Unknown_14;
        Unknown_15 = (unsigned __int8)stars->Unknown_15;
        if ( ((Unknown_14 | Unknown_15) & v27) != 0 )
        {
          if ( *(_DWORD *)(a2 + 0x28) )
          {
            if ( ((unsigned __int8)Unknown_14 & v27) != 0 && (v27 & (unsigned __int8)Unknown_15) == 0 )
            {
              if ( *((char *)&dword_104FD1 + v9 + 3) <= 0 )
              {
                v13 = (double)dword_104BEC[v8];
                goto LABEL_53;
              }
LABEL_35:
              v23 = 0.0;
              goto LABEL_54;
            }
LABEL_36:
            v23 = 0.0;
            goto LABEL_54;
          }
          if ( v20 )
          {
            if ( ((unsigned __int8)Unknown_14 & v27) == 0 )
            {
              goto LABEL_35;
            }
            v10 = *((char *)&dword_104F6D + v9 + 3);
            v23 = (float)dword_104BEC[v8];
            if ( v10 <= 1 )
            {
              goto LABEL_54;
            }
            LOBYTE(v11) = v10 - 1;
          }
          else
          {
            if ( ((unsigned __int8)Unknown_14 & v27) != 0 )
            {
              v12 = (double)(dword_104D7C[v8] + dword_104BEC[v8]);
            }
            else
            {
              v12 = (double)dword_104D7C[v8];
            }
            v23 = v12;
            if ( *((char *)&dword_104F09 + v9 + 3) <= 0 )
            {
              goto LABEL_54;
            }
            LOBYTE(v11) = *((_BYTE *)&dword_104F09 + v9 + 3);
          }
        }
        else
        {
          if ( *(_DWORD *)(a2 + 0x28) )
          {
            if ( *((char *)&dword_104FD1 + v9 + 3) > 0 )
            {
              goto LABEL_36;
            }
            v13 = (double)dword_104BEC[v8];
LABEL_53:
            v23 = v13;
            goto LABEL_54;
          }
          if ( v20 )
          {
            v23 = *(float *)(a2 + 0x28);
            goto LABEL_54;
          }
          v11 = *((char *)&dword_104F09 + v9 + 3);
          v23 = (float)dword_104D7C[v8];
          if ( v11 <= 0 )
          {
LABEL_54:
            v14 = v23 / (double)(v26 / 0x19 + 1);
            if ( v14 > v19 )
            {
              v18 = (int)stars;
              v25 = v9;
              v24 = v14;
              v19 = v24;
            }
            goto LABEL_56;
          }
        }
        v13 = v23 / (double)(1 << v11);
        goto LABEL_53;
      }
    }
  }
  return (char)a1;
}
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;
// 104BEC: using guessed type int dword_104BEC[100];
// 104D7C: using guessed type int dword_104D7C[99];
// 104F09: using guessed type int dword_104F09;
// 104F6D: using guessed type int dword_104F6D;
// 104FD1: using guessed type int dword_104FD1;

//----- (0003EFE0) --------------------------------------------------------
size_t __fastcall sub_3EFE0(int a1)
{
  int v2; // ebx
  T_Star *stars; // edx
  size_t v4; // ebp
  int i; // eax
  size_t result; // eax

  v2 = 1;
  stars = V_Game.stars;
  v4 = sub_40224((unsigned __int8 *)a1, 0, 0);
  for ( i = 0; (__int16)i < V_Game.starsNum; ++stars )
  {
    if ( (unsigned __int8)stars->Unknown_14 == 1 << *(_BYTE *)a1 )
    {
      ++v2;
    }
    ++i;
  }
  result = v2 - v4;
  if ( ((1 << *(_BYTE *)a1) & *(unsigned __int8 *)(*(_DWORD *)(a1 + 7) + 0x14)) != 0 )
  {
    ++result;
  }
  return result;
}

//----- (0003F060) --------------------------------------------------------
__int16 __fastcall sub_3F060(unsigned __int8 *a1, _DWORD *a2, int a3, unsigned __int8 a4)
{
  int v6; // eax
  __int16 v7; // cx
  int v8; // edx
  char v9; // bl
  char v10; // bh
  __int16 result; // ax
  int v12; // [esp+0h] [ebp-26h]
  __int16 v13; // [esp+6h] [ebp-20h]
  char v14; // [esp+Ah] [ebp-1Ch]
  char v15; // [esp+Eh] [ebp-18h]
  char v16; // [esp+12h] [ebp-14h]

  if ( !a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xCD0);
  }
  v13 = 0;
  v6 = 1 << *a1;
  if ( (v6 & (char)V_ResTree.items[1].z2[0]) != 0 )
  {
    v13 = 1;
    if ( (v6 & (char)V_ResTree.items[0x13].z2[0]) != 0 )
    {
      v13 = 2;
      if ( (v6 & (char)V_ResTree.items[0x1F].z2[0]) != 0 )
      {
        v13 = 3;
      }
    }
  }
  if ( !v13 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xCE2);
  }
  HIWORD(v12) = V_Game.day / 0xFA;
  v7 = v13;
  if ( SHIWORD(v12) >= 1 )
  {
    if ( SHIWORD(v12) > 8 )
    {
      HIWORD(v12) = 8;
    }
  }
  else
  {
    HIWORD(v12) = 1;
  }
  while ( v7 >= 0 )
  {
    sub_49148((P_Ship)a2, v7);
    v8 = sub_4A18C((int)a2) + *(_DWORD *)((char *)a2 + 0x15A) * (v12 >> 0x10);
    if ( !*(_WORD *)(a3 + 0x44) )
    {
      *(_WORD *)(a3 + 0x44) = 1;
    }
    if ( v8 / *(unsigned __int16 *)(a3 + 0x44) + 1 < *((__int16 *)a1 + 0xD8) )
    {
      break;
    }
    --v7;
  }
  if ( v7 < 0 )
  {
    v7 = 0;
  }
  sub_49148((P_Ship)a2, v7);
  v15 = sub_4A36C((int)a2, 0, *a1);
  v14 = sub_4A36C((int)a2, 4, *a1);
  v16 = sub_4A36C((int)a2, 2, *a1);
  v9 = sub_4A36C((int)a2, 1, *a1);
  v10 = 0x2B;
  if ( sub_4A404((int)a2, 0x2C) )
  {
    v10 = 0x2C;
  }
  if ( v14 == (char)0xFF )
  {
    v14 = 0x1B;
  }
  if ( v16 == (char)0xFF )
  {
    v16 = 0x10;
  }
  if ( v15 == (char)0xFF )
  {
    v15 = 0;
  }
  if ( v9 == (char)0xFF )
  {
    v9 = 0xA;
  }
  result = v7;
  switch ( v7 )
  {
    case 0:
      result = sub_3F324((int)a1, v14, v16, v15, v9, v10, a2, a4);
      break;
    case 1:
      result = sub_3F3F8(a1, v14, v16, v15, v9, v10, a2, a4);
      break;
    case 2:
      result = sub_3F784((int)a1, v14, v16, v15, v9, v10, a2, a4);
      break;
    case 3:
      result = sub_3FBAC((int)a1, v14, v16, v15, v9, v10, a2, a4);
      break;
    default:
      return result;
  }
  return result;
}
// 3F0F5: conditional instruction was optimized away because %var_20.2 is in (1..3)
// 3F15C: variable 'v12' is possibly undefined

//----- (0003F324) --------------------------------------------------------
unsigned int __fastcall sub_3F324(int a1, char a2, char a3, char a4, int a5, char a6, _DWORD *a7, unsigned __int8 a8)
{
  sub_492AC(a7, a2, 0);
  sub_492AC(a7, a3, 1);
  sub_492AC(a7, a6, 2);
  if ( a8 )
  {
    if ( a8 > 1u && a8 == 2 )
    {
      sub_492AC(a7, 0x49, 3);
      return sub_492AC(a7, 0x49, 4);
    }
    else
    {
      sub_492AC(a7, a4, 3);
      return sub_492AC(a7, a4, 4);
    }
  }
  else
  {
    sub_492AC(a7, 0x47, 3);
    return sub_492AC(a7, 0x47, 4);
  }
}

//----- (0003F3F8) --------------------------------------------------------
unsigned int __fastcall sub_3F3F8(
        unsigned __int8 *a1,
        char a2,
        char a3,
        char a4,
        char a5,
        char a6,
        _DWORD *a7,
        unsigned __int8 a8)
{
  int v9; // ecx
  int v10; // edi
  int v11; // ecx
  int v12; // ecx
  unsigned int result; // eax
  int v14; // edx
  char v15; // edx^3
  int v16; // ebx
  int v17; // ebx
  int v18; // ebx
  int v19; // ecx
  int v20; // ecx
  int v21; // ebx
  int v22; // ebx
  int v23; // ecx
  int v24; // edx
  char v25; // edx^3
  int v26; // ebx
  int v27; // ecx
  int v28; // ebx
  int v29; // ecx
  int v30; // ebx
  int v31; // ecx
  int v32; // edx
  char v33; // edx^3
  int v34; // ebx

  sub_492AC(a7, a2, 0);
  sub_492AC(a7, a2, 1);
  sub_492AC(a7, a3, 2);
  sub_492AC(a7, a6, 3);
  v9 = 4;
  if ( (int)a7[6] < 8 )
  {
    v9 = 5;
    sub_492AC(a7, a2, 4);
  }
  v10 = v9 + 1;
  if ( !a8 )
  {
    sub_492AC(a7, 0x47, v9);
    sub_492AC(a7, 0x47, v10);
    sub_492AC(a7, 0x47, v9 + 2);
    sub_492AC(a7, 0x49, v9 + 3);
    v12 = v9 + 5;
    result = sub_492AC(a7, a6, v10 + 3);
    if ( v10 + 4 >= 0xA )
    {
      return result;
    }
    while ( 1 )
    {
      v14 = rand() % 0x64;
      if ( v14 > 0x4B )
      {
        break;
      }
      if ( v14 > 0x32 )
      {
        v15 = a5;
        goto LABEL_17;
      }
      if ( v14 <= 0x19 )
      {
        v15 = a6;
        goto LABEL_17;
      }
      result = sub_492AC(a7, 0x47, v12++);
LABEL_18:
      if ( v12 >= 0xA )
      {
        return result;
      }
    }
    v15 = a2;
LABEL_17:
    v16 = v12++;
    result = sub_492AC(a7, v15, v16);
    goto LABEL_18;
  }
  if ( a8 > 1u && a8 == 2 )
  {
    if ( a4 == 5 || !sub_4A404((int)a7, 5) )
    {
      v28 = v9;
      v27 = v9 + 1;
      sub_492AC(a7, a4, v28);
    }
    else
    {
      sub_492AC(a7, 5, v9);
      v27 = v9 + 1;
    }
    sub_492AC(a7, 0x49, v27);
    v29 = v27 + 1;
    sub_492AC(a7, 0x49, v29++);
    sub_492AC(a7, 0x49, v29);
    v30 = v29 + 1;
    v31 = v29 + 2;
    result = sub_492AC(a7, a5, v30);
    if ( v31 >= 0xA )
    {
      return result;
    }
    while ( 1 )
    {
      v32 = rand() % 0x64;
      if ( v32 > 0x4B )
      {
        break;
      }
      if ( v32 > 0x32 )
      {
        v33 = a5;
        goto LABEL_48;
      }
      if ( v32 <= 0x19 )
      {
        v33 = a6;
        goto LABEL_48;
      }
      result = sub_492AC(a7, 0x49, v31++);
LABEL_49:
      if ( v31 >= 0xA )
      {
        return result;
      }
    }
    v33 = a2;
LABEL_48:
    v34 = v31++;
    result = sub_492AC(a7, v33, v34);
    goto LABEL_49;
  }
  if ( a4 == 5 || !sub_4A404((int)a7, 5) )
  {
    v17 = v9;
    v11 = v9 + 1;
    sub_492AC(a7, a4, v17);
  }
  else
  {
    sub_492AC(a7, 5, v9);
    v11 = v9 + 1;
  }
  v18 = v11;
  v19 = v11 + 1;
  sub_492AC(a7, a4, v18);
  sub_492AC(a7, a4, v19++);
  sub_492AC(a7, a5, v19);
  v20 = v19 + 1;
  if ( sub_4A404((int)a7, 0x24) )
  {
    sub_492AC(a7, 0x24, v20++);
  }
  if ( a6 == 0x2B || V_Game.day > 0x320 || *(__int16 *)&V_Game.Unknown_D8A[6 * *a1] >= 3 )
  {
    v21 = v20++;
    sub_492AC(a7, a6, v21);
  }
  sub_492AC(a7, a5, v20);
  v22 = v20 + 1;
  v23 = v20 + 2;
  result = sub_492AC(a7, 0x49, v22);
  if ( v23 < 0xA )
  {
    while ( 1 )
    {
      v24 = rand() % 0x64;
      if ( v24 > 0x42 )
      {
        break;
      }
      if ( v24 <= 0x21 )
      {
        v25 = a5;
        goto LABEL_33;
      }
      result = sub_492AC(a7, 0x49, v23++);
LABEL_34:
      if ( v23 >= 0xA )
      {
        return result;
      }
    }
    v25 = a2;
LABEL_33:
    v26 = v23++;
    result = sub_492AC(a7, v25, v26);
    goto LABEL_34;
  }
  return result;
}

//----- (0003F784) --------------------------------------------------------
unsigned int __fastcall sub_3F784(int a1, char a2, char a3, char a4, char a5, char a6, _DWORD *a7, unsigned __int8 a8)
{
  int v8; // esi
  int v9; // ebp
  int v10; // esi
  int v11; // esi
  int v12; // esi
  unsigned int result; // eax
  int v14; // edx
  int v15; // ebx
  int v16; // ebx
  char v17; // dl
  int v18; // ebx
  int v19; // esi
  int v20; // ebx
  int v21; // esi
  int v22; // esi
  int v23; // ecx
  int v24; // esi
  char v25; // dl
  int v26; // esi
  int v27; // ebx
  int v28; // esi
  int v29; // ebx
  int v30; // esi
  int v31; // edx
  int v32; // ebx
  int v33; // ebx
  char v34; // dl

  sub_492AC(a7, a2, 0);
  sub_492AC(a7, a2, 1);
  sub_492AC(a7, a2, 2);
  sub_492AC(a7, a3, 3);
  sub_492AC(a7, a6, 4);
  sub_492AC(a7, a6, 5);
  v8 = 6;
  if ( (int)a7[6] < 0x10 )
  {
    v8 = 7;
    sub_492AC(a7, a2, 6);
  }
  v9 = v8 + 1;
  if ( a8 )
  {
    if ( a8 <= 1u || a8 != 2 )
    {
      sub_492AC(a7, a4, v8);
      v10 = v8 + 1;
      if ( a4 == 7 || !sub_4A404((int)a7, 7) )
      {
        v18 = v10;
        v11 = v10 + 1;
        sub_492AC(a7, a4, v18);
      }
      else
      {
        sub_492AC(a7, 7, v10);
        v11 = v10 + 1;
      }
      if ( a4 == 5 || !sub_4A404((int)a7, 5) )
      {
        v20 = v11;
        v19 = v11 + 1;
        sub_492AC(a7, a4, v20);
      }
      else
      {
        sub_492AC(a7, 5, v11);
        v19 = v11 + 1;
      }
      sub_492AC(a7, a5, v19);
      v21 = v19 + 1;
      if ( a6 == 0x2B )
      {
        sub_492AC(a7, 0x2B, v21++);
      }
      sub_492AC(a7, 0x49, v21);
      v22 = v21 + 1;
      if ( sub_4A404((int)a7, 0x39) )
      {
        sub_492AC(a7, 0x39, v22++);
      }
      if ( sub_4A404((int)a7, 0x24) )
      {
        sub_492AC(a7, 0x24, v22++);
      }
      if ( sub_4A404((int)a7, 0x41) )
      {
        sub_492AC(a7, 0x41, v22++);
      }
      v23 = v22 + 2;
      sub_492AC(a7, 0x46, v22);
      v24 = v22 + 1;
      if ( sub_4A404((int)a7, 0x23) )
      {
        v25 = 0x23;
      }
      else
      {
        if ( !sub_4A404((int)a7, 0x21) )
        {
          return sub_40084(a1, a7, v24, a2);
        }
        v25 = 0x21;
      }
      sub_492AC(a7, v25, v24);
      v24 = v23;
      return sub_40084(a1, a7, v24, a2);
    }
    if ( a4 == 5 || !sub_4A404((int)a7, 5) )
    {
      v27 = v8;
      v26 = v8 + 1;
      sub_492AC(a7, a4, v27);
    }
    else
    {
      sub_492AC(a7, 5, v8);
      v26 = v8 + 1;
    }
    sub_492AC(a7, 0x49, v26);
    v28 = v26 + 1;
    sub_492AC(a7, 0x49, v28++);
    sub_492AC(a7, 0x49, v28++);
    sub_492AC(a7, 0x49, v28++);
    sub_492AC(a7, a5, v28);
    v29 = v28 + 1;
    v30 = v28 + 2;
    result = sub_492AC(a7, a6, v29);
    while ( v30 < 0xF )
    {
      v31 = rand() % 0x64;
      if ( v31 <= 0x4B )
      {
        if ( v31 <= 0x32 )
        {
          if ( v31 <= 0x19 )
          {
            v33 = v30;
            v34 = a6;
          }
          else
          {
            v34 = 0x49;
            v33 = v30;
          }
        }
        else
        {
          v33 = v30;
          v34 = a5;
        }
        result = sub_492AC(a7, v34, v33);
        ++v30;
      }
      else
      {
        v32 = v30++;
        result = sub_492AC(a7, a2, v32);
      }
    }
  }
  else
  {
    sub_492AC(a7, 0x47, v8);
    sub_492AC(a7, 0x47, v9);
    sub_492AC(a7, 0x47, v8 + 2);
    sub_492AC(a7, 0x47, v8 + 3);
    sub_492AC(a7, 0x49, v8 + 4);
    sub_492AC(a7, a5, v8 + 5);
    v12 = v8 + 7;
    result = sub_492AC(a7, a6, v9 + 5);
    if ( v9 + 6 < 0xF )
    {
      do
      {
        v14 = rand() % 0x64;
        if ( v14 <= 0x50 )
        {
          if ( v14 <= 0x3C )
          {
            if ( v14 <= 0x28 )
            {
              if ( v14 <= 0x14 )
              {
                v16 = v12;
                v17 = a6;
              }
              else
              {
                v17 = 0x47;
                v16 = v12;
              }
            }
            else
            {
              v17 = 0x49;
              v16 = v12;
            }
          }
          else
          {
            v16 = v12;
            v17 = a5;
          }
          result = sub_492AC(a7, v17, v16);
          ++v12;
        }
        else
        {
          v15 = v12++;
          result = sub_492AC(a7, a2, v15);
        }
      }
      while ( v12 < 0xF );
    }
  }
  return result;
}

//----- (0003FBAC) --------------------------------------------------------
unsigned int __fastcall sub_3FBAC(int a1, char a2, char a3, char a4, char a5, char a6, _DWORD *a7, unsigned __int8 a8)
{
  int v8; // esi
  int v9; // ebp
  int v10; // ebx
  int v11; // esi
  int v12; // esi
  int v13; // esi
  unsigned int result; // eax
  int v15; // edx
  int v16; // ebx
  int v17; // ebx
  char v18; // dl
  int v19; // ebx
  int v20; // esi
  int v21; // ebx
  int v22; // esi
  int v23; // ebx
  int v24; // esi
  int v25; // esi
  int v26; // ebp
  int v27; // esi
  int v28; // esi
  char v29; // dl
  int v30; // esi
  int v31; // ebx
  int v32; // esi
  int v33; // ebx
  int v34; // esi
  int v35; // edx
  int v36; // ebx
  int v37; // ebx
  char v38; // dl

  sub_492AC(a7, a2, 0);
  sub_492AC(a7, a2, 1);
  sub_492AC(a7, a2, 2);
  sub_492AC(a7, a2, 3);
  sub_492AC(a7, a3, 4);
  sub_492AC(a7, a3, 5);
  sub_492AC(a7, a6, 6);
  sub_492AC(a7, a6, 7);
  sub_492AC(a7, a5, 8);
  v8 = 9;
  if ( (int)a7[6] < 0x18 )
  {
    v8 = 0xA;
    sub_492AC(a7, a2, 9);
  }
  if ( a6 == 0x2B )
  {
    sub_492AC(a7, 0x2B, v8++);
  }
  v9 = v8 + 1;
  if ( a8 )
  {
    if ( a8 <= 1u || a8 != 2 )
    {
      v10 = v8;
      v11 = v8 + 1;
      sub_492AC(a7, a4, v10);
      if ( a4 == 7 || !sub_4A404((int)a7, 7) )
      {
        v19 = v11;
        v12 = v11 + 1;
        sub_492AC(a7, a4, v19);
      }
      else
      {
        sub_492AC(a7, 7, v11);
        v12 = v11 + 1;
      }
      if ( a4 == 5 || !sub_4A404((int)a7, 5) )
      {
        v21 = v12;
        v20 = v12 + 1;
        sub_492AC(a7, a4, v21);
      }
      else
      {
        sub_492AC(a7, 5, v12);
        v20 = v12 + 1;
      }
      if ( a4 == 8 || !sub_4A404((int)a7, 8) )
      {
        v23 = v20;
        v22 = v20 + 1;
        sub_492AC(a7, a4, v23);
      }
      else
      {
        sub_492AC(a7, 8, v20);
        v22 = v20 + 1;
      }
      sub_492AC(a7, 0x49, v22);
      v24 = v22 + 1;
      sub_492AC(a7, 0x49, v24);
      v25 = v24 + 1;
      if ( sub_4A404((int)a7, 0x39) )
      {
        sub_492AC(a7, 0x39, v25++);
      }
      if ( sub_4A404((int)a7, 0x24) )
      {
        sub_492AC(a7, 0x24, v25++);
      }
      if ( sub_4A404((int)a7, 0x41) )
      {
        sub_492AC(a7, 0x41, v25++);
      }
      v26 = v25 + 4;
      sub_492AC(a7, 0x46, v25);
      v27 = v25 + 1;
      sub_492AC(a7, 0x46, v27++);
      sub_492AC(a7, a6, v27);
      v28 = v27 + 1;
      if ( sub_4A404((int)a7, 0x23) )
      {
        v29 = 0x23;
      }
      else
      {
        if ( !sub_4A404((int)a7, 0x21) )
        {
          return sub_40084(a1, a7, v28, a2);
        }
        v29 = 0x21;
      }
      sub_492AC(a7, v29, v28);
      v28 = v26;
      return sub_40084(a1, a7, v28, a2);
    }
    if ( a4 == 5 || !sub_4A404((int)a7, 5) )
    {
      v31 = v8;
      v30 = v8 + 1;
      sub_492AC(a7, a4, v31);
    }
    else
    {
      sub_492AC(a7, 5, v8);
      v30 = v8 + 1;
    }
    sub_492AC(a7, 0x49, v30);
    v32 = v30 + 1;
    sub_492AC(a7, 0x49, v32++);
    sub_492AC(a7, 0x49, v32++);
    sub_492AC(a7, 0x49, v32++);
    sub_492AC(a7, 0x49, v32++);
    sub_492AC(a7, 0x49, v32++);
    sub_492AC(a7, 0x49, v32++);
    sub_492AC(a7, a5, v32);
    v33 = v32 + 1;
    v34 = v32 + 2;
    result = sub_492AC(a7, a6, v33);
    while ( v34 < 0x19 )
    {
      v35 = rand() % 0x64;
      if ( v35 <= 0x4B )
      {
        if ( v35 <= 0x32 )
        {
          if ( v35 <= 0x19 )
          {
            v37 = v34;
            v38 = a6;
          }
          else
          {
            v38 = 0x49;
            v37 = v34;
          }
        }
        else
        {
          v37 = v34;
          v38 = a5;
        }
        result = sub_492AC(a7, v38, v37);
        ++v34;
      }
      else
      {
        v36 = v34++;
        result = sub_492AC(a7, a2, v36);
      }
    }
  }
  else
  {
    sub_492AC(a7, 0x47, v8);
    sub_492AC(a7, 0x47, v9);
    sub_492AC(a7, 0x47, v8 + 2);
    sub_492AC(a7, 0x47, v8 + 3);
    sub_492AC(a7, 0x47, v8 + 4);
    sub_492AC(a7, 0x49, v8 + 5);
    v13 = v8 + 7;
    result = sub_492AC(a7, a5, v9 + 5);
    if ( v9 + 6 < 0x19 )
    {
      do
      {
        v15 = rand() % 0x64;
        if ( v15 <= 0x50 )
        {
          if ( v15 <= 0x3C )
          {
            if ( v15 <= 0x28 )
            {
              if ( v15 <= 0x14 )
              {
                v17 = v13;
                v18 = a6;
              }
              else
              {
                v18 = 0x47;
                v17 = v13;
              }
            }
            else
            {
              v18 = 0x49;
              v17 = v13;
            }
          }
          else
          {
            v17 = v13;
            v18 = a5;
          }
          result = sub_492AC(a7, v18, v17);
          ++v13;
        }
        else
        {
          v16 = v13++;
          result = sub_492AC(a7, a2, v16);
        }
      }
      while ( v13 < 0x19 );
    }
  }
  return result;
}

//----- (00040084) --------------------------------------------------------
int __fastcall sub_40084(int a1, _DWORD *a2, int a3, char a4)
{
  __int16 v4; // cx
  __int16 v5; // bx
  int v6; // eax
  int v7; // esi
  int v8; // edi
  char v9; // al
  int result; // eax
  int v11; // ebx
  char v12[28]; // [esp+4h] [ebp-44h]
  char v13[20]; // [esp+20h] [ebp-28h] BYREF
  int v14; // [esp+34h] [ebp-14h]
  char v15; // [esp+38h] [ebp-10h]

  v14 = a3;
  v15 = a4;
  v4 = 0;
  v5 = 0;
  qmemcpy(v13, "E?2.-&%\"/74@62&%B=01", sizeof(v13));
  while ( v5 < 0x14 )
  {
    if ( sub_4A404((int)a2, v13[v5]) )
    {
      v6 = v4++;
      v12[v6] = v13[v5];
    }
    ++v5;
  }
  while ( v14 < *(_DWORD *)((char *)a2 + 0x15A) && v4 )
  {
    v7 = rand() % v4;
    v8 = v14 + 1;
    --v4;
    sub_492AC(a2, v12[v7], v14);
    v9 = v12[v4];
    v14 = v8;
    v12[v7] = v9;
  }
  while ( 1 )
  {
    result = v14;
    if ( v14 >= *(_DWORD *)((char *)a2 + 0x15A) )
    {
      break;
    }
    v11 = v14++;
    sub_492AC(a2, v15, v11);
  }
  return result;
}
// 40084: using guessed type char var_28[20];
// 40084: using guessed type char var_44[28];

//----- (00040144) --------------------------------------------------------
T_Ship *__fastcall sub_40144(unsigned __int8 *a1, int a2)
{
  T_Ship *v5; // eax
  T_Ship *v6; // ecx
  unsigned __int16 v7; // di
  int day; // edx
  unsigned __int16 v9; // [esp+0h] [ebp-14h]

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xF3C);
  }
  if ( (int)sub_3EFE0((int)a1) > 0 )
  {
    v5 = sub_20684((int)&V_Game, *a1);
    v6 = v5;
    if ( !v5 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xF45);
    }
    v9 = sub_4A18C((int)v5);
    if ( !v9 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xF51);
    }
    v7 = *(_WORD *)(a2 + 0x44);
    if ( !v7 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0xF54);
    }
    day = V_Game.day;
    v6->Unknown_58 = 1;
    v6->Unknown_59 = a2;
    v6->Unknown_52 = day + v9 / (int)v7 + 1;
    return v6;
  }
  else
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\race.cpp", 0xF40);
    return 0;
  }
}
// 401AC: conditional instruction was optimized away because eax.4!=0

//----- (00040218) --------------------------------------------------------
int __fastcall compar(const void *a1, const void *a2)
{
  return *(_DWORD *)(*(_DWORD *)a1 + 0x52) - *(_DWORD *)(*(_DWORD *)a2 + 0x52);
}

//----- (00040224) --------------------------------------------------------
size_t __fastcall sub_40224(unsigned __int8 *a1, _DWORD *a2, _DWORD *a3)
{
  T_Ship *ships; // eax
  int v5; // esi
  __int16 i; // cx
  _DWORD *base; // [esp+4h] [ebp-1Ch]
  size_t nmemb; // [esp+8h] [ebp-18h]
  int raceIndex; // [esp+Ch] [ebp-14h]

  base = a2;
  ships = V_Game.ships;
  v5 = 0;
  nmemb = 0;
  if ( a3 )
  {
    *a3 = 0;
  }
  for ( i = 0; i < 0x6B && v5 < V_Game.shipsNum; ++i )
  {
    raceIndex = ships->raceIndex;
    if ( raceIndex != 0xFFFFFFFF )
    {
      ++v5;
      if ( raceIndex == *a1 )
      {
        if ( base )
        {
          *a2 = ships;
        }
        ++a2;
        ++nmemb;
        if ( a3 )
        {
          *a3 += ships->Unknown_AA[0] + 1;
        }
      }
    }
    ++ships;
  }
  if ( base )
  {
    qsort(base, nmemb, 4u, compar);
  }
  return nmemb;
}

//----- (000402E0) --------------------------------------------------------
int __fastcall sub_402E0(_BYTE *a1)
{
  int v2; // ebx
  int v3; // eax
  int v4; // edx

  v2 = 0;
  v3 = 0;
  v4 = 0;
  while ( v3 < V_Game.planetsNum )
  {
    if ( V_Game.planets[v4].byte57 == *a1 )
    {
      ++v2;
    }
    ++v4;
    ++v3;
  }
  return v2;
}

//----- (000403C0) --------------------------------------------------------
int __fastcall sub_403C0(unsigned __int8 *a1, int a2)
{
  __int16 v3; // bx
  __int16 v4; // cx
  int i; // ebp
  int v6; // ebx
  unsigned __int16 v7; // ax
  int *v8; // ecx
  int v9; // ebx
  __int16 v10; // ax
  int v11; // ebx
  int v14; // [esp+0h] [ebp-28h]
  unsigned __int16 v15; // [esp+4h] [ebp-24h]
  unsigned __int16 v16; // [esp+8h] [ebp-20h]
  __int16 v17; // [esp+Ch] [ebp-1Ch]

  v16 = 0;
  v3 = 0;
  v14 = 0;
  if ( V_Game.racesNum > 0 )
  {
    while ( *(_DWORD *)V_Game.races[v3].z == 0xFFFFFFFF
         || v3 == *a1
         || a1[v3 + 0x1C0] != 3
         || ((1 << v3) & *(unsigned __int8 *)(a2 + 0x14)) == 0 )
    {
      if ( ++v3 >= V_Game.racesNum )
      {
        goto LABEL_9;
      }
    }
    return 0;
  }
LABEL_9:
  v4 = 0;
  for ( i = (a1[0x19D] != 2) - 1; v4 < *(__int16 *)(a2 + 0x5A); ++v4 )
  {
    v6 = *(_DWORD *)(a2 + 4 * v4 + 0x46);
    if ( *(unsigned __int8 *)(v6 + 0x57) == 0xFF )
    {
      sub_3636C(*(_DWORD *)(a2 + 4 * v4 + 0x46), i);
      if ( (*(_BYTE *)(v6 + 0x66) & 2) != 0 )
      {
        v7 += 0x28;
      }
      if ( v7 > v16 )
      {
        v16 = v7;
        v14 = v6;
      }
    }
  }
  v15 = 0x46;
  if ( *(_BYTE *)(a2 + 0x14) )
  {
    v10 = 0;
    if ( V_Game.racesNum > 0 )
    {
      while ( 1 )
      {
        if ( a1[v10 + 0x1C0] == 2 )
        {
          v11 = *(unsigned __int8 *)(a2 + 0x14);
          if ( ((1 << v10) & v11) != 0 && ((1 << *a1) & v11) == 0 )
          {
            break;
          }
        }
        if ( ++v10 >= V_Game.racesNum )
        {
          goto LABEL_34;
        }
      }
      v15 = 0;
    }
  }
  else
  {
    v15 = 0x23;
    v17 = 0;
    if ( *(__int16 *)(a2 + 0x44) > 0 )
    {
      while ( 1 )
      {
        v8 = *(int **)(a2 + 4 * v17 + 0x2C);
        if ( !v8 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x100E);
        }
        v9 = *v8;
        if ( a2 == *v8 )
        {
          v9 = v8[1];
        }
        if ( ((1 << *a1) & *(unsigned __int8 *)(v9 + 0x14)) != 0 )
        {
          break;
        }
        if ( ++v17 >= *(__int16 *)(a2 + 0x44) )
        {
          goto LABEL_34;
        }
      }
      v15 = 0x11;
    }
  }
LABEL_34:
  if ( v16 <= v15 )
  {
    return 0;
  }
  return v14;
}
// 40480: variable 'v7' is possibly undefined

//----- (00040590) --------------------------------------------------------
int __fastcall sub_40590(_BYTE *a1)
{
  int v2; // edx
  int v3; // eax

  if ( !dword_10509C )
  {
    v2 = 0;
    v3 = 0;
    dword_1050A0 = 0xFFFFFFFF;
    while ( v2 < (unsigned __int16)V_ResTree.num )
    {
      if ( ((1 << *a1) & (char)V_ResTree.items[v3].z2[0]) == 0 )
      {
        dword_1050A0 = 0;
        break;
      }
      ++v3;
      ++v2;
    }
    dword_10509C = 0xFFFFFFFF;
  }
  return dword_1050A0;
}
// 10509C: using guessed type int dword_10509C;
// 1050A0: using guessed type int dword_1050A0;

//----- (000405F4) --------------------------------------------------------
unsigned int __fastcall sub_405F4(_BYTE *a1)
{
  unsigned int v2; // esi
  WORD i; // dx
  T_Planet *v4; // eax
  UBYTE byte57; // cl

  v2 = 0;
  if ( sub_40590(a1) )
  {
    for ( i = 0; i < V_Game.planetsNum; ++i )
    {
      v4 = &V_Game.planets[i];
      byte57 = v4->byte57;
      if ( byte57 == *a1 && (byte57 != byte_104BEA || v4->z7 || V_FlashPopExists_dword_A0D00) )
      {
        if ( sub_3623C(v4) )
        {
          v2 = 0xFFFFFFFF;
        }
      }
    }
  }
  return v2;
}
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;

//----- (00040664) --------------------------------------------------------
int __fastcall sub_40664(_BYTE *a1)
{
  int v2; // ebx
  int v3; // edx
  int v4; // eax

  v2 = 0;
  v3 = 0;
  v4 = 0;
  while ( v3 < (unsigned __int16)V_ResTree.num )
  {
    if ( ((1 << *a1) & (char)V_ResTree.items[v4].z2[0]) != 0 )
    {
      ++v2;
    }
    ++v4;
    ++v3;
  }
  return v2;
}

//----- (000406C4) --------------------------------------------------------
int __fastcall sub_406C4(unsigned __int8 *a1, __int16 *a2, int a3)
{
  unsigned __int8 v4; // cl
  __int16 v5; // cx
  int v6; // ebp
  int v7; // esi
  __int16 v8; // bx
  char v9; // dh
  __int16 v10; // ax
  __int16 *v11; // ecx
  int v12; // edx
  int v13; // ebx
  char v14; // cl
  int v15; // eax
  unsigned int v16; // ebx
  char v17; // ch
  __int16 v18; // si
  int v19; // ebx
  unsigned int v20; // eax
  int result; // eax
  __int16 v22; // dx
  unsigned __int8 v23; // al
  unsigned int v24; // ebp
  int v25; // ebx
  __int16 *v26; // esi
  __int16 i; // ax
  int v28; // ebx
  int v29; // esi
  __int16 v30; // cx
  __int16 j; // bx
  int v32; // edx
  unsigned int v33; // eax
  unsigned int v34; // eax
  int v35; // edx
  int v36; // ebx
  unsigned __int8 v37; // al
  __int16 v38; // dx
  __int16 v39; // di
  int v40; // ecx
  int v41; // eax
  int v42; // eax
  int v43; // eax
  int v44; // eax
  char v45; // dl
  int v46; // eax
  int v47; // eax
  int v48; // eax
  T_Planet *v49; // ecx
  char v50; // bl
  T_Planet *v51; // eax
  int v52; // eax
  unsigned __int8 v53; // al
  __int16 v54; // cx
  int v55; // eax
  __int16 v56; // bx
  __int16 v57; // ax
  int v58[107]; // [esp+0h] [ebp-3CCh] BYREF
  int v59[107]; // [esp+1ACh] [ebp-220h] BYREF
  int v60[5]; // [esp+358h] [ebp-74h] BYREF
  __int16 v61[8]; // [esp+36Ch] [ebp-60h] BYREF
  int v62; // [esp+37Ch] [ebp-50h]
  int v63; // [esp+380h] [ebp-4Ch]
  int v64; // [esp+384h] [ebp-48h]
  int v65; // [esp+388h] [ebp-44h]
  int v66; // [esp+38Ch] [ebp-40h]
  int v67; // [esp+390h] [ebp-3Ch]
  __int16 *v68; // [esp+394h] [ebp-38h]
  int v69; // [esp+398h] [ebp-34h]
  int v70; // [esp+39Ch] [ebp-30h]
  __int16 v71; // [esp+3A0h] [ebp-2Ch]
  __int16 v72; // [esp+3A4h] [ebp-28h]
  int v73; // [esp+3A8h] [ebp-24h]
  int v74; // [esp+3ACh] [ebp-20h]
  int v75; // [esp+3B0h] [ebp-1Ch]
  int v76; // [esp+3B4h] [ebp-18h]
  unsigned __int8 v77; // [esp+3B8h] [ebp-14h]

  v68 = a2;
  v64 = a3;
  if ( !a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1081);
  }
  v4 = *a1;
  v77 = *((_BYTE *)v68 + 0x14) | *((_BYTE *)v68 + 0x15);
  if ( ((1 << v4) & v77) == 0 )
  {
    return 0;
  }
  sub_3B56C(a1, v68);
  v5 = 0;
  LOWORD(v76) = 0;
  LOWORD(v73) = 0;
  LOWORD(v74) = 0;
  LOWORD(v70) = 0;
  v65 = 0;
  v6 = sub_1D794(v68, v58);
  while ( v5 < v6 )
  {
    v7 = v58[v5];
    if ( !v7 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x10AC);
    }
    if ( *(_WORD *)(v7 + 0x56) == *a1 && *(int *)(v7 + 0x88) > 0 && *(_BYTE *)(v7 + 0x58) != 1 )
    {
      v8 = *(_WORD *)(v7 + 0x94) + v70;
      LOWORD(v74) = *(_WORD *)(v7 + 0x88) + v74;
      v59[(__int16)v76] = v7;
      LOWORD(v70) = v8;
      v9 = *(_BYTE *)(v7 + 0x5D);
      LOWORD(v76) = v76 + 1;
      if ( v9 )
      {
        v65 = 0xFFFFFFFF;
      }
    }
    ++v5;
  }
  v10 = 0;
  if ( v68[0x2D] > 0 )
  {
    v11 = v68;
    do
    {
      v12 = *(_DWORD *)&v11[2 * v10 + 0x23];
      if ( *(_BYTE *)(v12 + 0x57) == *a1 )
      {
        v13 = (__int16)v73;
        LOWORD(v73) = v73 + 1;
        v60[v13] = v12;
      }
      ++v10;
    }
    while ( v10 < v68[0x2D] );
  }
  if ( !(_WORD)v76 && !(_WORD)v73 )
  {
    return 0;
  }
  if ( v68 == *(__int16 **)(a1 + 7)
    || !(_WORD)v76
    || byte_104BEA == *a1
    || ((1 << *a1) & (char)V_ResTree.items[(unsigned __int8)V_Gizmos[0x24].resReq].z2[0]) == 0 )
  {
    goto LABEL_39;
  }
  v14 = sub_43374(a1, 0xFFFFFFFF);
  v15 = *(_DWORD *)(a1 + 7);
  v16 = 0;
  v17 = *(_BYTE *)(v15 + 0x14);
  if ( (v17 & 0x7F) == 0 )
  {
    v16 = 0xFFFFFFFF;
  }
  if ( !v16 )
  {
    v16 = 0;
    if ( ((unsigned __int8)v14 & (unsigned __int8)(v17 | *(_BYTE *)(v15 + 0x15))) != 0 )
    {
      v16 = 0xFFFFFFFF;
    }
  }
  if ( v16 && (v18 = 0, (__int16)v76 > 0) )
  {
    while ( 1 )
    {
      v19 = v59[v18];
      if ( *(_BYTE *)(v19 + 0x58) == 4 )
      {
        if ( *(_DWORD *)(v19 + 0x88) )
        {
          v20 = sub_4937C(v59[v18], 0x24);
          if ( v20 != 0xFFFFFFFF )
          {
            *(_BYTE *)(v19 + 0x62) = 1;
            *(_DWORD *)(v19 + 0x63) = 7 * v20 + v19 + 0xAB;
            *(_BYTE *)(v19 + 0x67) = 5;
            if ( (sub_49B3C(v19, 0) & 1) != 0 )
            {
              break;
            }
          }
        }
      }
      if ( ++v18 >= (__int16)v76 )
      {
        goto LABEL_39;
      }
    }
    *(_BYTE *)v64 = 3;
    *(_DWORD *)(v64 + 1) = v59[v18];
    return 0xFFFFFFFF;
  }
  else
  {
LABEL_39:
    v22 = 0;
    v23 = 1;
    v24 = 0;
    LOWORD(v75) = 0;
    v62 = 0;
    while ( v22 < 7 )
    {
      v66 = v23;
      if ( (v23 & v77) != 0 )
      {
        v25 = (__int16)v75;
        v26 = v68;
        v61[v25] = v22;
        if ( ((unsigned __int8)v66 & *((_BYTE *)v26 + 0x15)) != 0 )
        {
          LOBYTE(v61[v25]) |= 8u;
        }
        if ( (v23 & (_BYTE)v68[0xA]) != 0 )
        {
          LOBYTE(v61[(__int16)v75]) |= 0x10u;
        }
        if ( a1[v22 + 0x1C0] == 2 )
        {
          if ( byte_104BEA != *a1 || V_FlashPopExists_dword_A0D00 == 0xFFFFFFFF || (*((_BYTE *)v68 + 0x15) & v23) != 0 )
          {
            v24 = 0xFFFFFFFF;
            LOBYTE(v61[(__int16)v75]) |= 0x20u;
          }
        }
        else if ( *a1 != byte_104BEA && v22 == byte_104BEA && ((1 << *a1) & (unsigned __int8)byte_D8460[v68[2]]) != 0 )
        {
          v24 = 0xFFFFFFFF;
          LOBYTE(v61[(__int16)v75]) |= 0x20u;
        }
        LOWORD(v75) = v75 + 1;
      }
      ++v22;
      v23 *= 2;
    }
    if ( (__int16)v75 <= 0 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1133);
    }
    if ( (__int16)v75 == 1 )
    {
      v62 = 0xFFFFFFFF;
    }
    if ( !v62 && !v24 && (*a1 != byte_104BEA || V_FlashPopExists_dword_A0D00 == 0xFFFFFFFF) )
    {
      LOWORD(v69) = 0;
      do
      {
        v71 = v61[(__int16)v69] & 7;
        if ( a1[(unsigned __int8)v71 + 0x1C0] == 3 )
        {
          for ( i = 0; i < (__int16)v75; ++i )
          {
            v28 = v61[i] & 7;
            if ( V_Game.races[v71].Unknown_1C0[(unsigned __int8)v28] == 2 && a1[v28 + 0x1C0] != 3 )
            {
              v24 = 0xFFFFFFFF;
              LOBYTE(v61[i]) |= 0x20u;
            }
          }
        }
        LOWORD(v69) = v69 + 1;
      }
      while ( (__int16)v69 < (__int16)v75 );
    }
    if ( v24 != 0xFFFFFFFF
      || byte_104BEA == *a1
      && V_FlashPopExists_dword_A0D00 != 0xFFFFFFFF
      && *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] != 0x10
      || (result = sub_41268(
                     a1,
                     v75,
                     (__int16)v76,
                     (int)v61,
                     (int)v68,
                     (int)v59,
                     v73,
                     (int)v60,
                     (__int16)v74,
                     (__int16)v70,
                     (int)v68,
                     v64),
          result != 0xFFFFFFFF) )
    {
      if ( byte_104BEA == *a1 && !v65 && !V_FlashPopExists_dword_A0D00 )
      {
        return 0;
      }
      v29 = 0;
      v30 = 0;
      for ( j = 0; j < (__int16)v76; ++j )
      {
        if ( !*(_BYTE *)(v59[j] + 0x5D) && (*a1 != byte_104BEA || V_FlashPopExists_dword_A0D00 == 0xFFFFFFFF) )
        {
          sub_3EBDC(a1, v59[j]);
        }
        v32 = v59[j];
        if ( v30 < *(_DWORD *)(v32 + 0x88) && *(_BYTE *)(v32 + 0x5D) )
        {
          v29 = v59[j];
          v30 = *(_WORD *)(v32 + 0x88);
        }
      }
      if ( !v29 )
      {
        return 0;
      }
      switch ( *(_BYTE *)(v29 + 0x5D) )
      {
        case 1:
          if ( *(_BYTE *)(v29 + 0x58) == 3 )
          {
            sub_35C38(*(T_Planet **)(v29 + 0x59), (T_Ship *)v29);
          }
          if ( *(_BYTE *)(v29 + 0x58) != 4 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1188);
          }
          if ( *a1 != byte_104BEA
            && sub_1D834((int)v68, *a1) == 0xFFFFFFFF
            && *(_DWORD *)(v29 + 0x28) != 0xFFFFFFFF
            && sub_4A534(v29, 0x49) == 0xFFFFFFFF )
          {
            return 0;
          }
          v33 = *(_DWORD *)(v29 + 0x5E);
          if ( (__int16 *)v33 != v68 )
          {
            v36 = *(_DWORD *)(v29 + 0x5E);
            v37 = V_Game.z10000[0x64 * v68[2] + *(__int16 *)(v33 + 4)];
            v38 = 0;
            v63 = 0;
            v39 = v68[0x22];
            v72 = v37;
            if ( v39 > 0 )
            {
              while ( 1 )
              {
                v67 = *(_DWORD *)&v68[2 * v38 + 0x16];
                if ( v68 == *(__int16 **)v67 )
                {
                  v41 = 0x64 * *(__int16 *)(*(_DWORD *)(v67 + 4) + 4);
                  v40 = *(__int16 *)(v36 + 4);
                }
                else
                {
                  v40 = 0x64 * *(__int16 *)(*(_DWORD *)v67 + 4);
                  v41 = *(__int16 *)(v36 + 4);
                }
                if ( (unsigned __int8)V_Game.z10000[v40 + v41] == v72 - 1 )
                {
                  break;
                }
                if ( ++v38 >= v68[0x22] )
                {
                  goto LABEL_115;
                }
              }
              v63 = 0xFFFFFFFF;
            }
LABEL_115:
            if ( v63 != 0xFFFFFFFF )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x11CC);
            }
            if ( (*(_BYTE *)(v67 + 0x23) & 2) != 0 && sub_4A480(v29, 0, v67) )
            {
              v42 = v64;
              *(_BYTE *)v64 = 3;
              *(_DWORD *)(v42 + 1) = v29;
            }
            else
            {
              *(_BYTE *)(v29 + 0x62) = 0;
              v43 = v67;
              *(_DWORD *)(v29 + 0x63) = 0;
              *(_DWORD *)(v29 + 0x68) = v43;
              v44 = v64;
              *(_BYTE *)(v29 + 0x67) = 2;
              *(_BYTE *)v44 = 3;
              *(_DWORD *)(v44 + 1) = v29;
            }
            goto LABEL_121;
          }
          v34 = (unsigned int)v68 ^ v33;
          v35 = *(__int16 *)(v29 + 0x56);
          LOBYTE(v34) = byte_104BEA;
          *(_BYTE *)(v29 + 0x5D) = 0;
          if ( v35 != v34 || V_FlashPopExists_dword_A0D00 == 0xFFFFFFFF )
          {
            sub_3EBDC(a1, v29);
          }
          result = 0xFFFFFFFF;
          break;
        case 2:
          v49 = *(T_Planet **)(v29 + 0x5E);
          if ( !*(_DWORD *)(v29 + 0x28) )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x123F);
          }
          if ( v49->byte57 == 0xFF )
          {
            v50 = *(_BYTE *)(v29 + 0x58);
            if ( v50 == 3 )
            {
              v51 = *(T_Planet **)(v29 + 0x59);
              if ( v49 == v51 )
              {
                v52 = sub_4937C(v29, 0x47);
                if ( v52 == 0xFFFFFFFF )
                {
                  Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x125A);
                }
                sub_492F8((_DWORD *)v29, v52);
                v53 = *a1;
                v49->word42 = 2;
                v49->byte57 = v53;
                v49->Unknown_67 = V_Game.day;
                sub_34AE4(v49, 5u, 0xFFFFFFFF);
                --*(_DWORD *)(v29 + 0x88);
                *((_BYTE *)v68 + 0x14) |= 1 << *a1;
                v54 = v74 - 1;
                *(_BYTE *)(v29 + 0x5D) = 0;
                LOWORD(v74) = v54;
              }
              else
              {
                sub_35C38(v51, (T_Ship *)v29);
                if ( *(_BYTE *)(v29 + 0x58) != 4 )
                {
                  Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1252);
                }
              }
            }
            else
            {
              if ( v50 != 4 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x126C);
              }
              *(_BYTE *)(v29 + 0x62) = 0;
              *(_DWORD *)(v29 + 0x63) = 0;
              *(_BYTE *)(v29 + 0x67) = 1;
              v55 = v64;
              *(_DWORD *)(v29 + 0x68) = v49;
              *(_BYTE *)v55 = 3;
              *(_DWORD *)(v55 + 1) = v29;
            }
          }
          else
          {
            *(_BYTE *)(v29 + 0x5D) = 0;
          }
          goto LABEL_121;
        case 3:
          if ( *(_WORD *)(v29 + 0x56) != byte_104BEA )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x11F3);
          }
          v45 = *(_BYTE *)(v29 + 0x58);
          if ( v45 == 3 )
          {
            if ( *(_DWORD *)(v29 + 0x59) != *(_DWORD *)(v29 + 0x5E) )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x11F7);
            }
            v46 = *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596];
            *(_BYTE *)(v29 + 0x5D) = 0;
            if ( v46 != 0x10 )
            {
              sub_55AEC(&V_Type3_stru_10AE70, 0x10, v29, *(_DWORD *)(v29 + 0x5E));
            }
          }
          else if ( v45 == 4 )
          {
            *(_BYTE *)(v29 + 0x62) = 0;
            *(_DWORD *)(v29 + 0x63) = 0;
            *(_DWORD *)(v29 + 0x68) = *(_DWORD *)(v29 + 0x5E);
            v47 = v64;
            *(_BYTE *)(v29 + 0x67) = 1;
            *(_BYTE *)v47 = 3;
            *(_DWORD *)(v47 + 1) = v29;
          }
          else
          {
            *(_BYTE *)(v29 + 0x5D) = 0;
          }
          goto LABEL_121;
        case 7:
          if ( *(_WORD *)(v29 + 0x56) != byte_104BEA )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x121D);
          }
          if ( *(_BYTE *)(v29 + 0x58) != 4 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x121E);
          }
          if ( (*(_BYTE *)(v29 + 0x84) & 8) != 0 )
          {
            *(_BYTE *)(v29 + 0x5D) = 0;
          }
          else if ( *(_BYTE *)(v29 + 0x62) )
          {
            *(_BYTE *)(v29 + 0x5D) = 0;
          }
          else
          {
            v48 = v64;
            *(_BYTE *)(v29 + 0x67) = 3;
            *(_BYTE *)v48 = 3;
            *(_DWORD *)(v48 + 1) = v29;
          }
          goto LABEL_121;
        default:
          v56 = v74;
          v57 = *(_WORD *)(v29 + 0x88);
          *(_DWORD *)(v29 + 0x94) = 0;
          *(_DWORD *)(v29 + 0x88) = 0;
          LOWORD(v74) = v56 - v57;
LABEL_121:
          if ( (__int16)v74 <= 0 )
          {
            return 0;
          }
          return 0xFFFFFFFF;
      }
    }
  }
  return result;
}
// 40BBE: conditional instruction was optimized away because %var_1C.2>=1
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;
// 406C4: using guessed type int var_3CC[107];
// 406C4: using guessed type int var_220[107];
// 406C4: using guessed type int var_74[5];

//----- (00041268) --------------------------------------------------------
int __userpurge sub_41268@<eax>(
        unsigned __int8 *a1@<eax>,
        __int16 a2@<dx>,
        int a3@<ecx>,
        int a4@<ebx>,
        int a5@<ebp>,
        int a6,
        __int16 a7,
        int a8,
        int a9,
        int a10,
        int a11,
        int a12)
{
  __int16 v13; // ax
  _BYTE *v14; // edx
  int v15; // edi
  __int16 j; // ax
  int v17; // edx
  int v18; // esi
  char v19; // cl
  int v20; // edx
  int v21; // eax
  int v22; // edx
  int v23; // ebx
  int v24; // edx
  int v26; // ecx
  unsigned int v27; // eax
  unsigned int v28; // eax
  int v29; // edx
  int v30; // edx
  int v31; // esi
  __int16 n; // cx
  int v33; // ebx
  int v34; // esi
  int v35; // eax
  char v36; // bh
  __int16 v37; // bx
  int v38; // edx
  int v39; // ebp
  float *v40; // ebx
  __int16 ii; // si
  int v42; // edx
  char v43; // cl
  int v44; // ecx
  double v45; // st7
  double v46; // st7
  int v47; // edx
  __int16 v48; // bx
  __int16 v49; // cx
  int v50; // eax
  int v51; // edx
  T_Planet *v52; // edi
  unsigned __int8 *v53; // ebp
  signed __int16 kk; // cx
  T_Ship *v55; // esi
  int v56; // eax
  int v57; // ecx
  __int16 mm; // ax
  __int16 v59; // bx
  int *v60; // eax
  int v61; // ecx
  unsigned int v62; // eax
  unsigned int v63; // eax
  int v64; // ebp
  int v65; // ecx
  double v66; // st7
  char v67; // cl
  int v68; // ebp
  int v69; // edx
  int v70; // ebx
  int v71; // ebp
  int v72; // ebx
  int v73; // edi
  unsigned int v74; // eax
  unsigned int v75; // eax
  int v76; // edx
  int v77; // edx
  int *v78; // eax
  int v79; // eax
  int v80; // ecx
  __int16 v81; // ax
  char v82; // dl
  int v83; // esi
  int v84; // eax
  __int16 i2; // bx
  int v86; // edx
  char v87; // cl
  int v88; // eax
  int v89[107]; // [esp+8h] [ebp-40Ch] BYREF
  char v90; // [esp+1B4h] [ebp-260h]
  int v91; // [esp+1B5h] [ebp-25Fh]
  char v92; // [esp+1B9h] [ebp-25Bh]
  int v93; // [esp+1BAh] [ebp-25Ah]
  int v94; // [esp+1BEh] [ebp-256h]
  int v95; // [esp+1C2h] [ebp-252h]
  int v96; // [esp+1C6h] [ebp-24Eh]
  int v97; // [esp+1CAh] [ebp-24Ah]
  int v98; // [esp+1CEh] [ebp-246h]
  int v99; // [esp+1D2h] [ebp-242h]
  int v100; // [esp+1D6h] [ebp-23Eh]
  char v101; // [esp+1DCh] [ebp-238h]
  int v102; // [esp+1DDh] [ebp-237h]
  char v103; // [esp+1E1h] [ebp-233h]
  int v104; // [esp+1E2h] [ebp-232h]
  int v105; // [esp+1E6h] [ebp-22Eh]
  int v106; // [esp+1EAh] [ebp-22Ah]
  int v107; // [esp+1EEh] [ebp-226h]
  int v108; // [esp+1F2h] [ebp-222h]
  int v109; // [esp+1F6h] [ebp-21Eh]
  int v110; // [esp+1FAh] [ebp-21Ah]
  int v111; // [esp+1FEh] [ebp-216h]
  int v112[3]; // [esp+204h] [ebp-210h] BYREF
  float v113; // [esp+210h] [ebp-204h] BYREF
  float v114; // [esp+214h] [ebp-200h]
  float v115; // [esp+218h] [ebp-1FCh]
  float v116; // [esp+21Ch] [ebp-1F8h]
  int v117; // [esp+220h] [ebp-1F4h]
  int v118; // [esp+224h] [ebp-1F0h]
  float v119; // [esp+228h] [ebp-1ECh]
  int v120; // [esp+22Ch] [ebp-1E8h]
  int v121; // [esp+230h] [ebp-1E4h]
  int v122[3]; // [esp+234h] [ebp-1E0h] BYREF
  float v123; // [esp+240h] [ebp-1D4h]
  float v124; // [esp+244h] [ebp-1D0h]
  float v125; // [esp+248h] [ebp-1CCh]
  int v126[3]; // [esp+24Ch] [ebp-1C8h] BYREF
  int v127[3]; // [esp+258h] [ebp-1BCh] BYREF
  float v128; // [esp+264h] [ebp-1B0h]
  float v129; // [esp+268h] [ebp-1ACh]
  float v130; // [esp+26Ch] [ebp-1A8h]
  float v131; // [esp+270h] [ebp-1A4h]
  float v132; // [esp+274h] [ebp-1A0h]
  float v133; // [esp+278h] [ebp-19Ch]
  int v134[3]; // [esp+27Ch] [ebp-198h] BYREF
  int v135[3]; // [esp+288h] [ebp-18Ch] BYREF
  float v136; // [esp+294h] [ebp-180h]
  float v137; // [esp+298h] [ebp-17Ch]
  float v138; // [esp+29Ch] [ebp-178h]
  float v139; // [esp+2A0h] [ebp-174h]
  float v140; // [esp+2A4h] [ebp-170h]
  float v141; // [esp+2A8h] [ebp-16Ch]
  float v142; // [esp+2ACh] [ebp-168h]
  float v143; // [esp+2B0h] [ebp-164h]
  float v144; // [esp+2B4h] [ebp-160h]
  float v145; // [esp+2B8h] [ebp-15Ch] BYREF
  float v146; // [esp+2BCh] [ebp-158h]
  float v147; // [esp+2C0h] [ebp-154h]
  float v148; // [esp+2C4h] [ebp-150h]
  float v149; // [esp+2C8h] [ebp-14Ch]
  float v150; // [esp+2CCh] [ebp-148h]
  float v151; // [esp+2D0h] [ebp-144h]
  float v152; // [esp+2D4h] [ebp-140h]
  float v153; // [esp+2D8h] [ebp-13Ch]
  int v154[3]; // [esp+2DCh] [ebp-138h] BYREF
  float v155; // [esp+2E8h] [ebp-12Ch]
  float v156; // [esp+2ECh] [ebp-128h]
  float v157; // [esp+2F0h] [ebp-124h]
  float v158; // [esp+2F4h] [ebp-120h]
  float v159; // [esp+2F8h] [ebp-11Ch]
  float v160; // [esp+2FCh] [ebp-118h]
  float v161; // [esp+300h] [ebp-114h]
  float v162; // [esp+304h] [ebp-110h]
  float v163; // [esp+308h] [ebp-10Ch]
  int v164[5]; // [esp+30Ch] [ebp-108h] BYREF
  int v165; // [esp+320h] [ebp-F4h]
  int v166; // [esp+324h] [ebp-F0h]
  unsigned __int8 *v167; // [esp+328h] [ebp-ECh]
  float v168; // [esp+32Ch] [ebp-E8h]
  int v169; // [esp+330h] [ebp-E4h] BYREF
  int v170; // [esp+334h] [ebp-E0h]
  int v171; // [esp+338h] [ebp-DCh]
  int v172; // [esp+33Ch] [ebp-D8h]
  int v173; // [esp+340h] [ebp-D4h]
  int *v174; // [esp+344h] [ebp-D0h]
  float v175; // [esp+348h] [ebp-CCh]
  unsigned int v176; // [esp+34Ch] [ebp-C8h]
  int v177; // [esp+350h] [ebp-C4h]
  float v178; // [esp+354h] [ebp-C0h]
  float v179; // [esp+358h] [ebp-BCh]
  int *v180; // [esp+35Ch] [ebp-B8h]
  int v181; // [esp+360h] [ebp-B4h]
  float v182; // [esp+364h] [ebp-B0h]
  int *v183; // [esp+368h] [ebp-ACh]
  float v184; // [esp+36Ch] [ebp-A8h]
  int *v185; // [esp+370h] [ebp-A4h]
  int *v186; // [esp+374h] [ebp-A0h]
  int *v187; // [esp+378h] [ebp-9Ch]
  unsigned int v188; // [esp+37Ch] [ebp-98h] BYREF
  int v189; // [esp+380h] [ebp-94h]
  float v190; // [esp+384h] [ebp-90h]
  int v191; // [esp+388h] [ebp-8Ch]
  float v192; // [esp+38Ch] [ebp-88h]
  float *v193; // [esp+390h] [ebp-84h]
  int *v194; // [esp+394h] [ebp-80h]
  float v195; // [esp+398h] [ebp-7Ch]
  int v196; // [esp+39Ch] [ebp-78h]
  int *v197; // [esp+3A0h] [ebp-74h]
  int v198; // [esp+3A4h] [ebp-70h]
  unsigned int v199; // [esp+3A8h] [ebp-6Ch]
  float v200; // [esp+3ACh] [ebp-68h]
  float v201; // [esp+3B0h] [ebp-64h]
  int v202; // [esp+3B4h] [ebp-60h]
  int v203; // [esp+3B8h] [ebp-5Ch]
  int v204; // [esp+3BCh] [ebp-58h] BYREF
  int v205; // [esp+3C0h] [ebp-54h]
  __int16 i1; // [esp+3C4h] [ebp-50h]
  int v207; // [esp+3C8h] [ebp-4Ch]
  __int16 nn; // [esp+3CCh] [ebp-48h]
  int v209; // [esp+3D0h] [ebp-44h]
  int v210; // [esp+3D4h] [ebp-40h]
  int v211; // [esp+3D8h] [ebp-3Ch]
  int v212; // [esp+3DCh] [ebp-38h]
  __int16 m; // [esp+3E0h] [ebp-34h]
  int v214; // [esp+3E4h] [ebp-30h]
  int v215; // [esp+3E8h] [ebp-2Ch]
  __int16 v216; // [esp+3ECh] [ebp-28h]
  __int16 v217; // [esp+3F0h] [ebp-24h]
  __int16 jj; // [esp+3F4h] [ebp-20h]
  __int16 v219; // [esp+3F8h] [ebp-1Ch]
  __int16 k; // [esp+3FCh] [ebp-18h]
  int v221; // [esp+400h] [ebp-14h]
  unsigned __int8 i; // [esp+404h] [ebp-10h]

  v167 = a1;
  v207 = a3;
  sub_45958(a1, 2, (__int16 *)a11, &v169);
  sub_45958(v167, 3, (__int16 *)a11, &v204);
  sub_1DA4C(a11, *v167, 0, 0xFFFFFFFF);
  sub_1DB70((T_Star *)a11, *v167, 0, 0xFFFFFFFF);
  v219 = 1;
  if ( ((1 << byte_104BEA) & (*(unsigned __int8 *)(a11 + 0x14) | *(unsigned __int8 *)(a11 + 0x15))) == 0 )
  {
    v219 = 1;
  }
  if ( *v167 == byte_104BEA && !V_FlashPopExists_dword_A0D00 )
  {
    v219 = 1;
  }
  v13 = 0;
  for ( i = 0; v13 < a2; ++v13 )
  {
    v14 = (_BYTE *)(a4 + 2 * v13);
    if ( (*(_WORD *)v14 & 0x20) != 0 )
    {
      i |= 1 << (*v14 & 7);
    }
  }
  v15 = sub_1D794((__int16 *)a11, v89);
  v170 = 0;
  for ( j = 0; j < v15; ++j )
  {
    v17 = v89[j];
    if ( *(_BYTE *)(v17 + 0x58) == 4 && ((1 << *(_WORD *)(v17 + 0x56)) & i) != 0 )
    {
      v170 = 0xFFFFFFFF;
      break;
    }
  }
  if ( !v170 && byte_104BEA == *v167 && !V_FlashPopExists_dword_A0D00 )
  {
    return 2;
  }
  if ( (_WORD)v207 )
  {
    v18 = 0;
    v171 = 0;
    v181 = 0;
    if ( v219 == 1 )
    {
      if ( v170 )
      {
        v105 = 0;
        v106 = 0;
        v172 = 0;
        v107 = 0;
        v173 = 0;
        v108 = 0;
        v109 = 0;
        v110 = 0;
        LOWORD(v210) = 0;
        if ( (__int16)v207 > 0 )
        {
          do
          {
            v19 = *(_BYTE *)(*(_DWORD *)(a6 + 4 * (__int16)v210) + 0x58);
            v191 = *(_DWORD *)(a6 + 4 * (__int16)v210);
            if ( v19 == 4 )
            {
              for ( k = 0; k < v15; ++k )
              {
                v176 = 4 * k;
                v177 = v89[v176 / 4];
                if ( (i & (1 << *(_WORD *)(v177 + 0x56))) != 0 )
                {
                  v101 = *(_BYTE *)(v177 + 0x62);
                  v102 = *(_DWORD *)(v177 + 0x63);
                  v103 = *(_BYTE *)(v177 + 0x67);
                  v104 = *(_DWORD *)(v177 + 0x68);
                  v105 = *(_DWORD *)(v177 + 0x6C);
                  v106 = *(_DWORD *)(v177 + 0x70);
                  v107 = *(_DWORD *)(v177 + 0x74);
                  v108 = *(_DWORD *)(v177 + 0x78);
                  v109 = *(_DWORD *)(v177 + 0x7C);
                  v110 = *(_DWORD *)(v177 + 0x80);
                  v111 = *(_DWORD *)(v177 + 0x84);
                  if ( sub_4A480(v177, 3u, v191) )
                  {
                    sub_49A40(v191, 0xFFFFFFFF);
                    v173 = v191;
                    v172 = v89[v176 / 4];
                  }
                  v20 = v89[k];
                  *(_BYTE *)(v20 + 0x62) = v101;
                  *(_DWORD *)(v20 + 0x63) = v102;
                  *(_BYTE *)(v20 + 0x67) = v103;
                  v20 += 0x62;
                  *(_DWORD *)(v20 + 6) = v104;
                  *(_DWORD *)(v20 + 0xA) = v105;
                  *(_DWORD *)(v20 + 0xE) = v106;
                  *(_DWORD *)(v20 + 0x12) = v107;
                  *(_DWORD *)(v20 + 0x16) = v108;
                  *(_DWORD *)(v20 + 0x1A) = v109;
                  *(_DWORD *)(v20 + 0x1E) = v110;
                  *(_DWORD *)(v20 + 0x22) = v111;
                }
              }
              if ( v173 != v191 )
              {
                sub_49A40(v191, 0);
              }
            }
            LOWORD(v210) = v210 + 1;
          }
          while ( (__int16)v210 < (__int16)v207 );
        }
        LOWORD(v205) = 0;
        if ( (__int16)v207 > 0 )
        {
          do
          {
            v21 = *(_DWORD *)(a6 + 4 * (__int16)v205);
            v22 = *(_DWORD *)(v21 + 0x28);
            v203 = v21;
            if ( (!v22 || sub_4A534(v21, 0x49)) && *(_BYTE *)(v203 + 0x58) == 4 && *(_DWORD *)(v203 + 0x88) )
            {
              if ( sub_4A564(v203) )
              {
                for ( m = 0; m < v15; ++m )
                {
                  v23 = v89[m];
                  if ( (i & (1 << *(_WORD *)(v23 + 0x56))) != 0 )
                  {
                    if ( sub_4A480(v203, 3u, v23) )
                    {
                      v24 = v203;
                      *(_BYTE *)a12 = 3;
                      *(_DWORD *)(a12 + 1) = v24;
                      return 0xFFFFFFFF;
                    }
                    v181 = v203;
                  }
                }
              }
              else
              {
                v171 = v203;
              }
            }
            LOWORD(v205) = v205 + 1;
          }
          while ( (__int16)v205 < (__int16)v207 );
        }
        v26 = v181;
        if ( v181 )
        {
          v27 = sub_4937C(v181, 0x39);
          if ( v27 != 0xFFFFFFFF && (*(_WORD *)(v26 + 0x9C) & 4) == 0 && *(int *)(v26 + 0x88) > 0xC )
          {
            *(_BYTE *)(v26 + 0x62) = 1;
            *(_BYTE *)(v26 + 0x67) = 5;
            *(_DWORD *)(v26 + 0x63) = 7 * v27 + v26 + 0xAB;
            *(_BYTE *)a12 = 3;
            *(_DWORD *)(a12 + 1) = v26;
            sub_49B3C(v26, 0);
            if ( (*(_BYTE *)(v26 + 0x84) & 1) != 0 )
            {
              return 0xFFFFFFFF;
            }
          }
        }
        if ( v171 )
        {
          v28 = sub_4937C(v171, 0x41);
          if ( v28 != 0xFFFFFFFF )
          {
            v29 = v171;
            if ( *(int *)(v171 + 0x88) > 0xD )
            {
              *(_BYTE *)(v171 + 0x62) = 1;
              *(_BYTE *)(v29 + 0x67) = 5;
              v30 = v171;
              *(_DWORD *)(v171 + 0x63) = 7 * v28 + v171 + 0xAB;
              *(_BYTE *)a12 = 3;
              *(_DWORD *)(a12 + 1) = v30;
              sub_49B3C(v171, 0);
              if ( (*(_BYTE *)(v171 + 0x84) & 1) != 0 )
              {
                return 0xFFFFFFFF;
              }
            }
          }
        }
        v202 = v173;
        if ( v173 && sub_43184((int)v167, v173, v172) )
        {
          *(_BYTE *)a12 = 3;
          *(_DWORD *)(a12 + 1) = v173;
          return 0xFFFFFFFF;
        }
        v31 = 0;
        for ( n = 0; n < (__int16)v207; ++n )
        {
          v33 = *(_DWORD *)(a6 + 4 * n);
          if ( (!*(_DWORD *)(v33 + 0x28) || sub_4A534(*(_DWORD *)(a6 + 4 * n), 0x49))
            && *(_BYTE *)(v33 + 0x58) == 4
            && *(_DWORD *)(v33 + 0x88) * *(_DWORD *)v33 * *(_DWORD *)(v33 + 0x8C) > v31 )
          {
            v31 = *(_DWORD *)(v33 + 0x88) * *(_DWORD *)v33 * *(_DWORD *)(v33 + 0x8C);
            v202 = v33;
          }
        }
        if ( !v202 )
        {
          return 0;
        }
        if ( !a7 || (v148 = 0.0, v149 = 0.0, v150 = 0.0, LOWORD(v215) = 0, a7 <= 0) )
        {
LABEL_101:
          v39 = 0;
          v145 = 0.0;
          v146 = 0.0;
          v147 = 0.0;
          v175 = 99999.0;
          v40 = (float *)(v202 + 0x9E);
          for ( ii = 0; ii < v15; ++ii )
          {
            v42 = v89[ii];
            if ( (i & (1 << *(_WORD *)(v42 + 0x56))) != 0 )
            {
              v183 = v135;
              v151 = 0.0;
              v152 = 0.0;
              v153 = 0.0;
              v151 = *(float *)(v42 + 0x9E) - *v40;
              v152 = *(float *)(v42 + 0xA2) - v40[1];
              v153 = *(float *)(v42 + 0xA6) - v40[2];
              *(float *)v135 = v151;
              *(float *)&v135[1] = v152;
              *(float *)&v135[2] = v153;
              v145 = v151;
              v146 = v152;
              v147 = v153;
              v184 = sqrt(v152 * v152 + v151 * v151 + v153 * v153);
              v43 = *(_BYTE *)(v42 + 0x58);
              v192 = v184;
              if ( v43 != 4 )
              {
                v192 = v184 + flt_92338;
              }
              if ( v192 < (double)v175 && v192 > (double)flt_9233C )
              {
                v39 = v42;
                v175 = v192;
              }
            }
          }
          v44 = v202;
          if ( v202 && v39 )
          {
            v185 = v122;
            v155 = 0.0;
            v156 = 0.0;
            v157 = 0.0;
            v155 = *v40 - *(float *)(v39 + 0x9E);
            v156 = v40[1] - *(float *)(v39 + 0xA2);
            v45 = v40[2] - *(float *)(v39 + 0xA6);
            *(float *)v122 = v155;
            v157 = v45;
            *(float *)&v122[1] = v156;
            *(float *)&v122[2] = v157;
            v158 = 0.0;
            v145 = v155;
            v159 = 0.0;
            v146 = v156;
            v160 = 0.0;
            v147 = v157;
            v196 = rand() % 0xC8 + 0x64;
            v158 = (float)v196;
            v196 = rand() % 0xC8 + 0x64;
            v159 = (float)v196;
            v196 = rand() % 0xC8 + 0x64;
            v160 = (float)v196;
            v186 = v164;
            v116 = v145 + v158;
            *(float *)v164 = v116;
            *(float *)&v117 = v146 + v159;
            v164[1] = v117;
            *(float *)&v118 = v147 + v160;
            v164[2] = v118;
            v145 = v116;
            v146 = *(float *)&v117;
            v147 = *(float *)&v118;
            v196 = sub_49B68(v44, 1);
            v195 = (float)v196;
            if ( v195 < 0.0 )
            {
              v196 = sub_49B68(v39, 1);
              v195 = (double)v196 * dbl_9232C;
            }
            if ( v195 >= 0.0 )
            {
              sub_53054(&v145, v195);
            }
            v187 = v154;
            v128 = 0.0;
            v129 = 0.0;
            v130 = 0.0;
            v128 = v145 + *(float *)(v39 + 0x9E);
            v129 = v146 + *(float *)(v39 + 0xA2);
            v46 = v147 + *(float *)(v39 + 0xA6);
            *(float *)v154 = v128;
            v130 = v46;
            *(float *)&v154[1] = v129;
            *(float *)&v154[2] = v130;
            v145 = v128;
            v146 = v129;
            v147 = v130;
            v47 = v202;
            *(_BYTE *)a12 = 3;
            *(_DWORD *)(a12 + 1) = v47;
            *(_BYTE *)(v47 + 0x62) = 0;
            *(_BYTE *)(v47 + 0x67) = 3;
            *(_DWORD *)(v47 + 0x63) = 0;
            *(_DWORD *)(v47 + 0x68) = 0;
            *(float *)(v47 + 0x6C) = v145;
            *(float *)(v47 + 0x70) = v146;
            *(float *)(v47 + 0x74) = v147;
            return 0xFFFFFFFF;
          }
          return 0;
        }
LABEL_79:
        v34 = *(_DWORD *)(a8 + 4 * (__int16)v215);
        for ( jj = 0; ; ++jj )
        {
          if ( jj >= (int)*(unsigned __int16 *)(v34 + 0x1A) )
          {
            LOWORD(v215) = v215 + 1;
            if ( (__int16)v215 >= a7 )
            {
              goto LABEL_101;
            }
            goto LABEL_79;
          }
          v35 = 4 * jj + *(_DWORD *)(v34 + 0x10);
          v36 = *(_BYTE *)(v35 + 1);
          if ( v36 != (char)0xFF
            && (*(_WORD *)(v35 + 2) & 1) != 0
            && (V_PlanetItems.item[*(unsigned __int8 *)(v35 + 1)].flags & 4) != 0
            && (v36 != 0x11 || *(_BYTE *)(v34 + 0x58)) )
          {
            v37 = 0;
            v178 = 99999.0;
            while ( v37 < v15 )
            {
              v38 = v89[v37];
              if ( (i & (1 << *(_WORD *)(v38 + 0x56))) != 0 )
              {
                v180 = v112;
                v131 = 0.0;
                v132 = 0.0;
                v133 = 0.0;
                v131 = *(float *)v34 - *(float *)(v38 + 0x9E);
                v132 = *(float *)(v34 + 4) - *(float *)(v38 + 0xA2);
                v133 = *(float *)(v34 + 8) - *(float *)(v38 + 0xA6);
                *(float *)v112 = v131;
                *(float *)&v112[1] = v132;
                *(float *)&v112[2] = v133;
                v148 = v131;
                v149 = v132;
                v150 = v133;
                v182 = sqrt(v132 * v132 + v131 * v131 + v133 * v133);
                v179 = v182;
                if ( *(_BYTE *)(v38 + 0x58) != 4 )
                {
                  v179 = v182 + flt_92338;
                }
                if ( v179 < (double)v178 )
                {
                  a5 = v38;
                  v178 = v179;
                }
              }
              ++v37;
            }
            if ( *(_BYTE *)(*(_DWORD *)(v34 + 0x10) + 4 * jj + 1) != 0x11 || v178 >= (double)flt_92334 )
            {
              if ( !a5 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x13E7);
              }
              *(_DWORD *)(v34 + 0x6B) = 4 * jj + *(_DWORD *)(v34 + 0x10);
              *(_DWORD *)(v34 + 0x6F) = a5;
              sub_3676C((T_Planet *)v34, 0);
              if ( (*(_BYTE *)(v34 + 0x73) & 1) != 0 )
              {
                break;
              }
            }
          }
        }
        *(_BYTE *)a12 = 2;
        *(_DWORD *)(a12 + 1) = v34;
        return 0xFFFFFFFF;
      }
      else
      {
        v48 = *(_WORD *)(a11 + 0x5A);
        LOWORD(v212) = 0;
        if ( v48 <= 0 )
        {
          return 0;
        }
        while ( 1 )
        {
          v50 = *(_DWORD *)(a11 + 4 * (__int16)v212 + 0x46);
          v51 = *(unsigned __int8 *)(v50 + 0x57);
          if ( v51 != 0xFF
            && (_BYTE)v51 != *v167
            && (v167[v51 + 0x1C0] == 2
             || byte_104BEA == *(_BYTE *)(v50 + 0x57)
             && ((1 << *v167) & (unsigned __int8)byte_D8460[*(__int16 *)(a11 + 4)]) != 0) )
          {
            v52 = *(T_Planet **)(a11 + 4 * (__int16)v212 + 0x46);
            if ( !v50 )
            {
              return 0;
            }
            v53 = v167;
            for ( kk = *(_WORD *)(v50 + 0x18); kk < (int)v52->word1A; ++kk )
            {
              if ( *((_BYTE *)v52->a + 4 * kk + 1) == 0x17 && sub_35A70(v52, kk)->raceIndex == *v53 )
              {
                v55 = sub_35A70(v52, kk);
                if ( v55->raceIndex != *v53 )
                {
                  Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1468);
                }
                sub_36CD4(v52, kk, (int *)&v188);
                if ( v55 != sub_35A70(v52, kk) )
                {
                  Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x146C);
                }
                v188 = sub_35C38(v52, v55);
                if ( v188 != 0xFFFFFFFF )
                {
                  Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x146E);
                }
                return 0xFFFFFFFF;
              }
            }
            v189 = sub_361B8(v52);
            if ( !v189 )
            {
              LOWORD(v211) = 0;
              if ( (__int16)v207 > 0 )
              {
                do
                {
                  if ( v18 )
                  {
                    break;
                  }
                  v56 = a6 + 4 * (__int16)v211;
                  v57 = *(_DWORD *)v56;
                  if ( *(_BYTE *)(*(_DWORD *)v56 + 0x58) == 4 )
                  {
                    for ( mm = 0; mm < *(_DWORD *)(v57 + 0x15A); ++mm )
                    {
                      if ( *(_BYTE *)(v57 + 7 * mm + 0xAB) == 0x49 )
                      {
                        v18 = v57;
                        break;
                      }
                    }
                  }
                  LOWORD(v211) = v211 + 1;
                }
                while ( (__int16)v211 < (__int16)v207 );
              }
              if ( v18 )
              {
                *(_BYTE *)a12 = 3;
                *(_DWORD *)(a12 + 1) = v18;
                *(_BYTE *)(v18 + 0x62) = 0;
                *(_DWORD *)(v18 + 0x63) = 0;
                *(_BYTE *)(v18 + 0x67) = 1;
                *(_DWORD *)(v18 + 0x68) = v52;
                return 0xFFFFFFFF;
              }
              v59 = 0;
              if ( (__int16)v207 > 0 )
              {
                while ( 1 )
                {
                  v60 = (int *)(a6 + 4 * v59);
                  v61 = *v60;
                  if ( !*(_DWORD *)(*v60 + 0x28) || sub_4A534(*v60, 0x49) )
                  {
                    v62 = 0;
                    if ( *(_BYTE *)(v61 + 0x5D) == 1 && *(_DWORD *)(v61 + 0x5E) == a11 )
                    {
                      v62 = 0xFFFFFFFF;
                    }
                    if ( *(_BYTE *)(v61 + 0x58) == 4 && !v62 && sub_4A534(v61, 0x46) )
                    {
                      break;
                    }
                  }
                  if ( ++v59 >= (__int16)v207 )
                  {
                    goto LABEL_162;
                  }
                }
                if ( sub_4A480(v61, 1u, (int)v52) )
                {
                  v18 = v61;
                }
              }
LABEL_162:
              if ( v18 )
              {
                *(_BYTE *)a12 = 3;
                *(_DWORD *)(a12 + 1) = v18;
                return 0xFFFFFFFF;
              }
            }
            v63 = 0;
            if ( v52->word1A - v52->word18 > (unsigned __int16)v52->word1E )
            {
              v63 = 0xFFFFFFFF;
            }
            if ( v189 == 0xFFFFFFFF || v63 == 0xFFFFFFFF )
            {
              break;
            }
          }
          v49 = *(_WORD *)(a11 + 0x5A);
          LOWORD(v212) = v212 + 1;
          if ( (__int16)v212 >= v49 )
          {
            return 0;
          }
        }
        v64 = 0;
        LOWORD(v214) = 0;
        if ( (__int16)v207 > 0 )
        {
          do
          {
            if ( v18 )
            {
              break;
            }
            v65 = *(_DWORD *)(a6 + 4 * (__int16)v214);
            if ( (!*(_DWORD *)(v65 + 0x28) || sub_4A534(*(_DWORD *)(a6 + 4 * (__int16)v214), 0x49))
              && *(_BYTE *)(v65 + 0x58) == 4
              && (sub_4A564(v65) || sub_4A534(v65, 0x46)) )
            {
              v64 = v65;
              if ( sub_4A480(v65, 1u, (int)v52) )
              {
                v18 = v65;
              }
            }
            LOWORD(v214) = v214 + 1;
          }
          while ( (__int16)v214 < (__int16)v207 );
        }
        if ( v18 )
        {
          *(_BYTE *)a12 = 3;
          *(_DWORD *)(a12 + 1) = v18;
          return 0xFFFFFFFF;
        }
        if ( !v64 )
        {
          return v18;
        }
        v136 = 0.0;
        v137 = 0.0;
        v138 = 0.0;
        v193 = &v113;
        v136 = *(float *)(v64 + 0x9E) - v52->v.x;
        v137 = *(float *)(v64 + 0xA2) - v52->v.y;
        v138 = *(float *)(v64 + 0xA6) - v52->v.z;
        v113 = v136;
        v123 = 0.0;
        v124 = 0.0;
        v114 = v137;
        v125 = 0.0;
        v115 = v138;
        v196 = rand() % 0x64 + 0x14;
        v123 = (float)v196;
        v196 = rand() % 0x64 + 0x14;
        v124 = (float)v196;
        v196 = rand() % 0x64 + 0x14;
        v125 = (float)v196;
        v194 = v126;
        v119 = v113 + v123;
        *(float *)v126 = v119;
        *(float *)&v120 = v114 + v124;
        v126[1] = v120;
        *(float *)&v121 = v115 + v125;
        v126[2] = v121;
        v113 = v119;
        v114 = *(float *)&v120;
        v115 = *(float *)&v121;
        v196 = sub_49B68(v64, 2);
        v190 = (float)v196;
        if ( v190 < 0.0 )
        {
          v196 = sub_35ED8(v52);
          v190 = (double)v196 * dbl_9232C;
        }
        if ( v190 >= 0.0 )
        {
          sub_53054(&v113, v190);
        }
        v197 = v134;
        v142 = 0.0;
        v143 = 0.0;
        v144 = 0.0;
        v142 = v113 + v52->v.x;
        v143 = v114 + v52->v.y;
        v66 = v115 + v52->v.z;
        *(float *)v134 = v142;
        v144 = v66;
        *(float *)&v134[1] = v143;
        *(float *)&v134[2] = v144;
        v113 = v142;
        v114 = v143;
        v115 = v144;
        *(_BYTE *)a12 = 3;
        *(_DWORD *)(a12 + 1) = v64;
        *(_BYTE *)(v64 + 0x62) = 0;
        *(_BYTE *)(v64 + 0x67) = 3;
        *(_DWORD *)(v64 + 0x63) = 0;
        *(_DWORD *)(v64 + 0x68) = 0;
        *(float *)(v64 + 0x6C) = v113;
        *(float *)(v64 + 0x70) = v114;
        *(float *)(v64 + 0x74) = v115;
        return 0xFFFFFFFF;
      }
    }
    else
    {
      v94 = 0;
      v95 = 0;
      v96 = 0;
      v97 = 0;
      v98 = 0;
      v99 = 0;
      LOWORD(v221) = 0;
      if ( (__int16)v207 > 0 )
      {
        do
        {
          if ( v18 )
          {
            break;
          }
          v67 = *(_BYTE *)(*(_DWORD *)(a6 + 4 * (__int16)v221) + 0x58);
          v166 = *(_DWORD *)(a6 + 4 * (__int16)v221);
          if ( v67 == 4 )
          {
            for ( nn = 0; nn < v15 && !v18; ++nn )
            {
              v68 = v89[nn];
              v199 = 4 * nn;
              if ( (i & (1 << *(_WORD *)(v68 + 0x56))) != 0 )
              {
                v90 = *(_BYTE *)(v68 + 0x62);
                v91 = *(_DWORD *)(v68 + 0x63);
                v92 = *(_BYTE *)(v68 + 0x67);
                v93 = *(_DWORD *)(v68 + 0x68);
                v94 = *(_DWORD *)(v68 + 0x6C);
                v95 = *(_DWORD *)(v68 + 0x70);
                v96 = *(_DWORD *)(v68 + 0x74);
                v97 = *(_DWORD *)(v68 + 0x78);
                v98 = *(_DWORD *)(v68 + 0x7C);
                v99 = *(_DWORD *)(v68 + 0x80);
                v100 = *(_DWORD *)(v68 + 0x84);
                if ( sub_4A480(v68, 3u, v166) )
                {
                  v18 = v166;
                  v198 = v89[v199 / 4];
                }
                v69 = v89[nn];
                *(_BYTE *)(v69 + 0x62) = v90;
                *(_DWORD *)(v69 + 0x63) = v91;
                *(_BYTE *)(v69 + 0x67) = v92;
                v69 += 0x62;
                *(_DWORD *)(v69 + 6) = v93;
                *(_DWORD *)(v69 + 0xA) = v94;
                *(_DWORD *)(v69 + 0xE) = v95;
                *(_DWORD *)(v69 + 0x12) = v96;
                *(_DWORD *)(v69 + 0x16) = v97;
                *(_DWORD *)(v69 + 0x1A) = v98;
                *(_DWORD *)(v69 + 0x1E) = v99;
                *(_DWORD *)(v69 + 0x22) = v100;
              }
            }
          }
          LOWORD(v221) = v221 + 1;
        }
        while ( (__int16)v221 < (__int16)v207 );
      }
      if ( v18 )
      {
        v70 = v198;
        sub_49A40(v18, 0xFFFFFFFF);
        if ( sub_43184((int)v167, v18, v70) )
        {
          *(_BYTE *)a12 = 3;
          *(_DWORD *)(a12 + 1) = v18;
          return 0xFFFFFFFF;
        }
      }
      LOWORD(v209) = 0;
      if ( (__int16)v207 > 0 )
      {
        do
        {
          if ( v18 )
          {
            break;
          }
          v71 = *(_DWORD *)(a6 + 4 * (__int16)v209);
          if ( *(_BYTE *)(v71 + 0x58) == 4 && *(_DWORD *)(v71 + 0x88) )
          {
            if ( sub_4A564(*(_DWORD *)(a6 + 4 * (__int16)v209)) )
            {
              for ( i1 = 0; i1 < v15; ++i1 )
              {
                v72 = v89[i1];
                if ( (i & (1 << *(_WORD *)(v72 + 0x56))) != 0 )
                {
                  if ( sub_4A480(v71, 3u, v72) )
                  {
                    *(_BYTE *)a12 = 3;
                    *(_DWORD *)(a12 + 1) = v71;
                    return 0xFFFFFFFF;
                  }
                  v181 = v71;
                }
              }
            }
            else
            {
              v171 = v71;
            }
          }
          LOWORD(v209) = v209 + 1;
        }
        while ( (__int16)v209 < (__int16)v207 );
      }
      v73 = v181;
      if ( v181 )
      {
        v74 = sub_4937C(v181, 0x39);
        if ( v74 != 0xFFFFFFFF && (*(_WORD *)(v73 + 0x9C) & 4) == 0 && *(int *)(v73 + 0x88) > 0xC )
        {
          *(_BYTE *)(v73 + 0x62) = 1;
          *(_BYTE *)(v73 + 0x67) = 5;
          *(_DWORD *)(v73 + 0x63) = 7 * v74 + v73 + 0xAB;
          *(_BYTE *)a12 = 3;
          *(_DWORD *)(a12 + 1) = v73;
          sub_49B3C(v73, 0);
          if ( (*(_BYTE *)(v73 + 0x84) & 1) != 0 )
          {
            return 0xFFFFFFFF;
          }
        }
      }
      if ( v171 )
      {
        v75 = sub_4937C(v171, 0x41);
        if ( v75 != 0xFFFFFFFF )
        {
          v76 = v171;
          if ( *(int *)(v171 + 0x88) > 0xD )
          {
            *(_BYTE *)(v171 + 0x62) = 1;
            *(_BYTE *)(v76 + 0x67) = 5;
            *(_DWORD *)(v171 + 0x63) = 7 * v75 + v171 + 0xAB;
            v77 = v171;
            *(_BYTE *)a12 = 3;
            *(_DWORD *)(a12 + 1) = v77;
            sub_49B3C(v171, 0);
            if ( (*(_BYTE *)(v171 + 0x84) & 1) != 0 )
            {
              return 0xFFFFFFFF;
            }
          }
        }
      }
      v78 = *(int **)(a11 + 0x2C);
      if ( *v78 == a11 )
      {
        v79 = v78[1];
      }
      else
      {
        v79 = *v78;
      }
      v80 = v79;
      v81 = 0;
      if ( (__int16)v207 > 0 )
      {
        while ( 1 )
        {
          v18 = *(_DWORD *)(a6 + 4 * v81);
          v82 = *(_BYTE *)(v18 + 0x58);
          if ( v82 == 3 )
          {
            break;
          }
          if ( v82 != 4 )
          {
            ++v81;
            v18 = 0;
            if ( v81 < (__int16)v207 )
            {
              continue;
            }
          }
          goto LABEL_240;
        }
        sub_35C38(*(T_Planet **)(v18 + 0x59), *(T_Ship **)(a6 + 4 * v81));
        if ( *(_BYTE *)(v18 + 0x58) != 4 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x15E4);
        }
      }
LABEL_240:
      if ( !v18 )
      {
        return v18;
      }
      if ( *(_BYTE *)(v18 + 0x58) != 4 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x15EF);
      }
      *(_BYTE *)(v18 + 0x5D) = 1;
      *(_DWORD *)(v18 + 0x5E) = v80;
      return 2;
    }
  }
  else
  {
    if ( !a7 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x15FD);
    }
    if ( !v170 )
    {
      return 0;
    }
    v161 = 0.0;
    v162 = 0.0;
    v163 = 0.0;
    v217 = 0;
    if ( a7 > 0 )
    {
      while ( 2 )
      {
        v216 = 0;
        v83 = *(_DWORD *)(a8 + 4 * v217);
        while ( v216 < (int)*(unsigned __int16 *)(v83 + 0x1A) )
        {
          v84 = 4 * v216 + *(_DWORD *)(v83 + 0x10);
          if ( *(_BYTE *)(v84 + 1) != 0xFF
            && (*(_WORD *)(v84 + 2) & 1) != 0
            && (V_PlanetItems.item[*(unsigned __int8 *)(v84 + 1)].flags & 4) != 0
            && (*(_BYTE *)(v84 + 1) != 0x11 || *(_BYTE *)(v83 + 0x58)) )
          {
            v200 = 99999.0;
            for ( i2 = 0; i2 < v15; ++i2 )
            {
              v86 = v89[i2];
              if ( (i & (1 << *(_WORD *)(v86 + 0x56))) != 0 )
              {
                v174 = v127;
                v139 = 0.0;
                v140 = 0.0;
                v141 = 0.0;
                v139 = *(float *)v83 - *(float *)(v86 + 0x9E);
                v140 = *(float *)(v83 + 4) - *(float *)(v86 + 0xA2);
                v141 = *(float *)(v83 + 8) - *(float *)(v86 + 0xA6);
                *(float *)v127 = v139;
                *(float *)&v127[1] = v140;
                *(float *)&v127[2] = v141;
                v161 = v139;
                v162 = v140;
                v163 = v141;
                v168 = sqrt(v140 * v140 + v139 * v139 + v141 * v141);
                v87 = *(_BYTE *)(v86 + 0x58);
                v201 = v168;
                if ( v87 != 4 )
                {
                  v201 = v168 + flt_92338;
                }
                if ( v201 < (double)v200 )
                {
                  v165 = v86;
                  v200 = v201;
                }
              }
            }
            if ( *(_BYTE *)(*(_DWORD *)(v83 + 0x10) + 4 * v216 + 1) != 0x11 || v200 >= (double)flt_92334 )
            {
              if ( !v165 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1633);
              }
              v88 = v165;
              *(_DWORD *)(v83 + 0x6B) = 4 * v216 + *(_DWORD *)(v83 + 0x10);
              *(_DWORD *)(v83 + 0x6F) = v88;
              sub_3676C((T_Planet *)v83, 0);
              if ( (*(_BYTE *)(v83 + 0x73) & 1) != 0 )
              {
                *(_BYTE *)a12 = 2;
                *(_DWORD *)(a12 + 1) = v83;
                return 0xFFFFFFFF;
              }
            }
          }
          ++v216;
        }
        if ( ++v217 < a7 )
        {
          continue;
        }
        break;
      }
      return 0;
    }
    else
    {
      return 0;
    }
  }
}
// 42437: conditional instruction was optimized away because esi.4==0
// 9232C: using guessed type double dbl_9232C;
// 92334: using guessed type float flt_92334;
// 92338: using guessed type float flt_92338;
// 9233C: using guessed type float flt_9233C;
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;
// 41268: using guessed type int var_40C[107];

//----- (00043184) --------------------------------------------------------
unsigned int __fastcall sub_43184(int a1, int a2, int a3)
{
  __int16 v4; // di
  __int16 i; // bx
  int v6; // esi
  char v8[12]; // [esp+0h] [ebp-2Ch] BYREF
  _DWORD v9[2]; // [esp+Ch] [ebp-20h]
  __int16 v10; // [esp+14h] [ebp-18h]
  int v11; // [esp+18h] [ebp-14h]

  strcpy(v8, "E?2.-&%#!");
  v9[0] = unk_9696C;
  v9[1] = *((_DWORD *)&unk_9696C + 1);
  v10 = *((_WORD *)&unk_9696C + 4);
  if ( sub_4A8FC(a2) / 2 < *(_DWORD *)(a2 + 0x88) )
  {
    *(_BYTE *)(a2 + 0x62) = 1;
    v4 = 0;
    v11 = a2 + 0xAB;
    while ( v4 < *(_DWORD *)(a2 + 0x15A) )
    {
      if ( V_Gizmos[*(char *)(a2 + 7 * v4 + 0xAB)].cat == 5 )
      {
        for ( i = 0; i < 0xA; ++i )
        {
          v6 = 7 * v4;
          if ( *(_BYTE *)(a2 + v6 + 0xAB) == v8[i] )
          {
            *(_DWORD *)(a2 + 0x63) = v6 + v11;
            *(_BYTE *)(a2 + 0x67) = *((_BYTE *)v9 + i);
            *(_DWORD *)(a2 + 0x68) = a3;
            sub_49B3C(a2, 0);
            if ( (*(_BYTE *)(a2 + 0x84) & 1) != 0 )
            {
              return 0xFFFFFFFF;
            }
          }
        }
      }
      ++v4;
    }
  }
  return 0;
}

//----- (00043374) --------------------------------------------------------
char __fastcall sub_43374(unsigned __int8 *a1, int a2)
{
  char v3; // ch
  __int16 i; // bx

  v3 = 0;
  for ( i = 0; i < V_Game.racesNum; ++i )
  {
    if ( i != *a1
      && *(_DWORD *)V_Game.races[i].z != 0xFFFFFFFF
      && a1[i + 0x1C0] == 2
      && (a2 == 0xFFFFFFFF || sub_43B7C((int)a1, i) > a2) )
    {
      v3 |= 1 << i;
    }
  }
  return v3;
}

//----- (000433E0) --------------------------------------------------------
unsigned int __fastcall sub_433E0(int a1, __int16 a2, int a3)
{
  int v6; // eax
  __int16 v7; // dx
  int v8; // ebx
  int v9; // eax
  __int16 v10; // si
  __int16 v11; // bx

  if ( a2 < 0 || a2 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1705);
  }
  if ( !a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\race.cpp", 0x1706);
  }
  v6 = a1 + a2;
  if ( *(_BYTE *)(v6 + 0x1C0) == 2 )
  {
    return 0;
  }
  v7 = 0xA * (V_Game.Unknown_D8A[0x2A] + 1);
  if ( *(_BYTE *)(v6 + 0x1C0) == 3 )
  {
    v7 = 0x14 * (V_Game.Unknown_D8A[0x2A] + 1);
  }
  v8 = a2;
  v9 = a1 + 2 * a2;
  v10 = *(_WORD *)(v9 + 0x1B2) - v7;
  *(_WORD *)(v9 + 0x1B2) = v10;
  if ( *(_BYTE *)(a1 + v8 + 0x1C0) == 3 )
  {
    v11 = *(_WORD *)(a1 + 0x1CF);
    if ( v10 > v11 )
    {
      *(_WORD *)(v9 + 0x1B2) = v11 - 0xA;
    }
  }
  byte_D8460[*(__int16 *)(a3 + 4)] |= 1 << *(_BYTE *)a1;
  return 0xFFFFFFFF;
}

//----- (000434E4) --------------------------------------------------------
int __fastcall sub_434E4(char *a1, int a2)
{
  int v3; // eax
  int v4; // ebx
  signed int v6; // eax
  int v7; // ecx
  int v8; // eax
  int v9; // edx
  T_Race *races; // eax
  int i; // edx
  char *v12; // ecx
  int v13; // ebx
  signed int v14; // eax
  int v15; // ebx
  int v16; // eax
  int v17; // edx
  T_Star *stars; // edi
  int v19; // eax
  unsigned int v20; // ecx
  int v21; // edx
  int v22; // eax
  P_Star star; // esi
  int v24; // eax
  int v25; // edi
  int v26; // eax
  int v27; // edx
  T_Planet *planets; // eax
  unsigned __int16 v29; // cx
  int k; // edx
  unsigned __int16 word42; // si
  _BYTE *a; // ecx
  int m; // ebx
  T_Ship *ships; // edi
  int n; // esi
  int *Unknown_59; // edx
  int v37; // ecx
  int ii; // eax
  int v39; // edx
  __int16 v40; // bx
  unsigned __int16 v41; // dx
  T_Planet *v42; // eax
  int jj; // edx
  T_Planet *v44; // edx
  int kk; // edi
  T_Star *v46; // esi
  int mm; // edi
  T_Star *v48; // edx
  int nn; // eax
  int v50; // ecx
  int i1; // edi
  T_Race *v52; // edx
  int v53; // eax
  char *v54; // ecx
  int v55; // ebx
  int v56; // edx
  T_Planet *v57; // eax
  int i2; // edx
  char v59; // al
  int v60[107]; // [esp+0h] [ebp-6F8h] BYREF
  int v61[107]; // [esp+1ACh] [ebp-54Ch] BYREF
  int v62[107]; // [esp+358h] [ebp-3A0h] BYREF
  int v63[107]; // [esp+504h] [ebp-1F4h] BYREF
  _DWORD v64[3]; // [esp+6B0h] [ebp-48h]
  int j; // [esp+6BCh] [ebp-3Ch]
  char *v66; // [esp+6C0h] [ebp-38h]
  int v67; // [esp+6C4h] [ebp-34h]
  int v68; // [esp+6C8h] [ebp-30h]
  int v69; // [esp+6CCh] [ebp-2Ch]
  T_Planet *v70; // [esp+6D0h] [ebp-28h]
  unsigned int v71; // [esp+6D4h] [ebp-24h]
  int v72; // [esp+6D8h] [ebp-20h]
  __int16 *v73; // [esp+6DCh] [ebp-1Ch]
  int v74; // [esp+6E0h] [ebp-18h]

  v3 = a1[0x19D];
  v4 = 0;
  v67 = 0;
  if ( (unsigned __int16)word_968E8[v3] <= *(int *)(a1 + 0x19E) )
  {
    v67 = 0xFFFFFFFF;
    if ( a2 != 1 )
    {
      return v67;
    }
    v59 = a1[0x19D] - 5;
    v68 = 0;
    switch ( v59 )
    {
      case 0:
        v6 = sub_40224((unsigned __int8 *)a1, v62, 0);
        if ( v6 > 0 )
        {
          v7 = 4 * v6;
          v8 = 0;
          do
          {
            v9 = v62[v8 / 4u];
            v8 += 4;
            *(_DWORD *)(v9 + 0x8C) = *(_DWORD *)(v9 + 0x98);
          }
          while ( v8 < v7 );
        }
        break;
      case 1:
        races = V_Game.races;
        for ( i = 0; i < V_Game.racesNum; ++i )
        {
          if ( races != (T_Race *)a1 )
          {
            v12 = (char *)races + 2 * (unsigned __int8)*a1;
            v13 = races->Unknown_1C7[3] + 0x14;
            if ( *((__int16 *)v12 + 0xD9) < v13 )
            {
              *((_WORD *)v12 + 0xD9) = v13;
            }
          }
          ++races;
        }
        break;
      case 2:
        v14 = sub_40224((unsigned __int8 *)a1, v60, 0);
        if ( v14 > 0 )
        {
          v15 = 4 * v14;
          v16 = 0;
          do
          {
            v17 = v60[v16 / 4u];
            v16 += 4;
            *(_DWORD *)(v17 + 0x88) *= 2;
          }
          while ( v16 < v15 );
        }
        break;
      case 3:
        stars = V_Game.stars;
        for ( j = 0; V_Game.starsNum > j; ++j )
        {
          if ( ((1 << *a1) & (unsigned __int8)stars->Unknown_14) != 0 )
          {
            v19 = sub_1D794((__int16 *)stars, v61);
            if ( v19 > 0 )
            {
              v20 = 0;
              v74 = 4 * v19;
              do
              {
                v21 = v61[v20 / 4];
                v22 = *(__int16 *)(v21 + 0x56);
                if ( v22 != (unsigned __int8)*a1 && *(_BYTE *)(v21 + 0x58) == 4 )
                {
                  star = V_Game.races[v22].star;
                  sub_1D538((int)stars, v21);
                  sub_1D3E8((int)star, v61[v20 / 4], 0);
                }
                v20 += 4;
              }
              while ( (int)v20 < v74 );
            }
          }
          ++stars;
        }
        break;
      case 4:
        v72 = 0;
        v73 = (__int16 *)V_Game.stars;
        while ( V_Game.starsNum > v72 )
        {
          if ( ((1 << *a1) & *((unsigned __int8 *)v73 + 0x15)) != 0 )
          {
            v24 = sub_1D794(v73, v63);
            if ( v24 > 0 )
            {
              v25 = 4 * v24;
              v26 = 0;
              do
              {
                v27 = v63[v26 / 4u];
                if ( *(_WORD *)(v27 + 0x56) != (unsigned __int8)*a1 )
                {
                  *(_DWORD *)(v27 + 0x88) = 0;
                }
                v26 += 4;
              }
              while ( v26 < v25 );
            }
          }
          ++v72;
          v73 += 0x30;
        }
        break;
      case 5:
        planets = V_Game.planets;
        v29 = 0xFFFF;
        v70 = 0;
        for ( k = 0; k < V_Game.planetsNum; ++k )
        {
          if ( planets->byte57 == *a1 && planets->type != 0xA )
          {
            word42 = planets->word42;
            if ( v29 > word42 )
            {
              v70 = planets;
              v29 = word42;
            }
          }
          ++planets;
        }
        if ( v70 )
        {
          a = v70->a;
          for ( m = 0; m < v70->word18; ++m )
          {
            if ( !*a || *a == 1 )
            {
              v64[0] = unk_96994;
              v64[1] = *((_DWORD *)&unk_96994 + 1);
              v64[2] = *((_DWORD *)&unk_96994 + 2);
              *a = v64[rand() % 3];
            }
            a += 4;
          }
        }
        break;
      case 6:
        ships = V_Game.ships;
        for ( n = 0; n < V_Game.shipsNum; ++n )
        {
          if ( ships->raceIndex != 0xFFFFFFFF && ships->Unknown_58 == 5 )
          {
            Unknown_59 = (int *)ships->Unknown_59;
            v37 = *Unknown_59;
            if ( (ships->Unknown_A2 & 0x7FFFFFFF) == 0 )
            {
              v37 = Unknown_59[1];
            }
            sub_1D3E8(v37, (int)ships, 0);
          }
          ++ships;
        }
        break;
      case 7:
        v69 = 0;
        v71 = 0;
        while ( (unsigned __int16)V_ResTree.num > v69 )
        {
          v39 = 0;
          for ( ii = 0; ii < V_Game.racesNum; ++ii )
          {
            if ( ((1 << ii) & (char)V_ResTree.items[v71 / 0x4B].z2[0]) != 0 )
            {
              ++v39;
            }
          }
          if ( v39 >= 2 )
          {
            V_ResTree.items[v71 / 0x4B].z2[0] |= 1 << *a1;
            v40 = v69;
            v41 = V_ResTree.a.w1[(unsigned __int8)*a1];
            if ( v41 == v69 )
            {
              V_ResTree.a.w1[(unsigned __int8)*a1] = 0xFFFF;
              word_106FB4[(unsigned __int8)*a1] = v40 ^ v41;
            }
          }
          v71 += 0x4B;
          ++v69;
        }
        break;
      case 8:
        v42 = V_Game.planets;
        for ( jj = 0; jj < V_Game.planetsNum; ++jj )
        {
          if ( v42->byte57 == *a1 )
          {
            v42->Unknown_62 = 0xFFFFFFFF;
          }
          ++v42;
        }
        v68 = *(_DWORD *)(a1 + 0x19E) - (unsigned __int16)word_968E8[a1[0x19D]];
        break;
      case 9:
        v44 = V_Game.planets;
        for ( kk = 0; kk < V_Game.planetsNum; ++kk )
        {
          if ( v44->byte57 == *a1 )
          {
            v44->word55 += 2;
            sub_34E70(v44);
          }
          ++v44;
        }
        break;
      case 0xB:
        v46 = V_Game.stars;
        for ( mm = 0; mm < V_Game.starsNum; ++mm )
        {
          if ( ((1 << *a1) & (unsigned __int8)v46->Unknown_14) != 0 )
          {
            v48 = v46;
            for ( nn = 0; nn < v46->Unknown_44; *(_BYTE *)(v50 + 0x23) |= 2u )
            {
              v50 = *(_DWORD *)v48->Unknown_2C;
              v48 = (T_Star *)((char *)v48 + 4);
              ++nn;
            }
          }
          ++v46;
        }
        break;
      case 0xC:
        v66 = a1;
        for ( i1 = 0; i1 < V_Game.racesNum; ++i1 )
        {
          if ( i1 != (unsigned __int8)*a1 && v66[0x1C0] == 2 )
          {
            v52 = V_Game.races;
            v53 = 0;
            v54 = (char *)V_Game.races + v4;
            while ( v53 < V_Game.racesNum )
            {
              if ( v53 != i1 && v53 != (unsigned __int8)*a1 && *((_WORD *)v54 + 0xD9) > v52->Unknown_1C7[1] )
              {
                *((_WORD *)v54 + 0xD9) = v52->Unknown_1C7[1];
              }
              ++v53;
              v54 += 0x1EE;
              ++v52;
            }
          }
          v4 += 2;
          ++v66;
        }
        break;
      case 0xE:
        LOBYTE(v4) = *a1;
        v55 = v4;
        v56 = (unsigned __int16)V_ResTree.a.w1[v55];
        if ( (unsigned __int16)v56 != 0xFFFF )
        {
          word_106FB4[v55] = V_ResTree.items[v56].cost;
        }
        break;
      case 0xF:
        v57 = V_Game.planets;
        for ( i2 = 0; i2 < V_Game.planetsNum; ++i2 )
        {
          if ( v57->byte57 == *a1 && v57->buildingPlanetItemIndex != 0xFF )
          {
            v57->buildingProgress += 0x64;
          }
          ++v57;
        }
        break;
      default:
        break;
    }
    *(_DWORD *)(a1 + 0x19E) = v68;
  }
  return v67;
}
// 968E8: using guessed type __int16 word_968E8[21];
// 106FB4: using guessed type __int16 word_106FB4[7];

//----- (00043B7C) --------------------------------------------------------
int __fastcall sub_43B7C(int a1, __int16 a2)
{
  int v2; // ebx
  int v3; // edx

  v2 = *(__int16 *)(a1 + 0x1D1) - *(__int16 *)(a1 + 2 * a2 + 0x1B2);
  if ( v2 <= 0 )
  {
    v3 = 0x64;
  }
  else
  {
    v3 = 0x64 * v2 / (*(__int16 *)(a1 + 0x1D1) - *(__int16 *)(a1 + 0x1C9));
  }
  if ( v3 > 0x64 )
  {
    return 0x64;
  }
  return v3;
}

//----- (00043BDC) --------------------------------------------------------
void __fastcall Q_ReadWriteRace_sub_43BDC(P_Race pRace, P_FileInfo fi, int read)
{
  int star; // eax
  T_Race vRace; // [esp+0h] [ebp-1F4h] BYREF
  T_FileInfo *v6; // [esp+1F0h] [ebp-4h]

  v6 = fi;
  sub_3B120(&vRace);
  if ( read == TRUE )
  {
    Q_ReadFile_sub_1BF94(v6, &vRace, 0x1EEu);
    qmemcpy(pRace, &vRace, 0x1ECu);
    HIWORD(pRace->Unknown_1EA) = HIWORD(vRace.Unknown_1EA);
    star = (int)pRace->star;
    pRace->Unknown_19B = 0;
    pRace->star = &V_Game.stars[star];
  }
  else
  {
    qmemcpy(&vRace, pRace, sizeof(vRace));
    vRace.star = (P_Star)vRace.star->index;
    Q_CFILE_CPP_dos_write_sub_1C098(&v6->fh, &vRace, 0x1EEu);
  }
}

//----- (00043C80) --------------------------------------------------------
int __fastcall Q_RACENEG_CPP_sub_43C80(int a1)
{
  FILE *v2; // ecx
  __int16 v3; // ax
  __int16 v4; // dx
  __int16 v5; // ax
  __int16 v6; // bx
  __int16 v7; // ax
  __int16 v8; // di
  __int16 v9; // ax
  __int16 v10; // dx
  __int16 v11; // ax
  __int16 v12; // bx
  int v14; // [esp-4h] [ebp-108h]
  char v15[184]; // [esp+0h] [ebp-104h] BYREF
  char v16[32]; // [esp+CCh] [ebp-38h] BYREF
  __int16 v17; // [esp+100h] [ebp-4h] BYREF

  v14 = *(unsigned __int8 *)(a1 + 1);
  V_Day1 = -10;
  V_Day2 = -10;
  V_Day3 = -10;
  sprintf(v16, "RACE%02d.DIP", v14);
  v2 = Q_OpenFile_sub_1BB10(v16, 0);
  if ( !v2 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\raceneg.cpp", 0x55);
  }
  v15[0] = 0;
  while ( strncmp(v15, "DIPVALUES", 9u) )
  {
    Q_HELPWIN_CPP_FgetsLine_sub_2FE58(v2, v15);
  }
  fscanf(v2, "%s %d", v15, &v17);
  *(_WORD *)(a1 + 0x1C9) = v17;
  fscanf(v2, "%s %d", v15, &v17);
  v3 = v17;
  v4 = *(_WORD *)(a1 + 0x1C9);
  *(_WORD *)(a1 + 0x1CB) = v17;
  if ( v3 <= v4 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x64);
  }
  fscanf(v2, "%s %d", v15, &v17);
  v5 = v17;
  v6 = *(_WORD *)(a1 + 0x1CB);
  *(_WORD *)(a1 + 0x1CD) = v17;
  if ( v5 <= v6 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x68);
  }
  fscanf(v2, "%s %d", v15, &v17);
  v7 = v17;
  v8 = *(_WORD *)(a1 + 0x1CD);
  *(_WORD *)(a1 + 0x1CF) = v17;
  if ( v7 <= v8 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x6C);
  }
  fscanf(v2, "%s %d", v15, &v17);
  v9 = v17;
  v10 = *(_WORD *)(a1 + 0x1CF);
  *(_WORD *)(a1 + 0x1D1) = v17;
  if ( v9 <= v10 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x70);
  }
  fscanf(v2, "%s %d", v15, &v17);
  v11 = v17;
  v12 = *(_WORD *)(a1 + 0x1D1);
  *(_WORD *)(a1 + 0x1D3) = v17;
  if ( v11 <= v12 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x74);
  }
  fscanf(v2, "%s %d", v15, &v17);
  *(_WORD *)(a1 + 0x1D5) = v17;
  fscanf(v2, "%s %d", v15, &v17);
  *(_WORD *)(a1 + 0x1B0) = v17;
  fscanf(v2, "%s %d", v15, &v17);
  *(_WORD *)(a1 + 0x1D7) = v17;
  fscanf(v2, "%s %d", v15, &v17);
  *(_WORD *)(a1 + 0x1D9) = v17;
  fscanf(v2, "%s %d", v15, &v17);
  *(_WORD *)(a1 + 0x1DB) = v17;
  fscanf(v2, "%s %d", v15, &v17);
  *(float *)(a1 + 0x1DD) = (float)v17;
  fscanf(v2, "%s %d", v15, &v17);
  *(float *)(a1 + 0x1E1) = (float)v17;
  fscanf(v2, "%s %d", v15, &v17);
  *(float *)(a1 + 0x1E5) = (float)v17;
  fscanf(v2, "%s %d", v15, &v17);
  *(_WORD *)(a1 + 0x1C7) = v17;
  *(_BYTE *)(a1 + 0x19D) = *(_BYTE *)(a1 + 1);
  *(_DWORD *)(a1 + 0x19E) = 0;
  return fclose(v2);
}
// 105248: using guessed type int V_Day1;
// 10524C: using guessed type int V_Day2;
// 105250: using guessed type int V_Day3;

//----- (00044024) --------------------------------------------------------
unsigned int __fastcall sub_44024(_BYTE *a1, char a2)
{
  int v3; // eax
  int v4; // edi
  T_Star *stars; // edx
  int Unknown_17; // ebx
  int v8; // [esp+0h] [ebp-18h]

  v3 = 0;
  v8 = 0;
  v4 = 1 << a2;
  stars = V_Game.stars;
  while ( v3 < V_Game.starsNum )
  {
    Unknown_17 = (unsigned __int8)stars->Unknown_17;
    if ( ((1 << *a1) & Unknown_17) != 0 && (v4 & Unknown_17) != 0 )
    {
      return 0xFFFFFFFF;
    }
    ++v3;
    ++stars;
  }
  return v8;
}

//----- (00044080) --------------------------------------------------------
T_Race *__fastcall sub_44080(unsigned __int8 *a1)
{
  unsigned __int8 *v2; // ebp
  int v3; // edi
  char v4; // al
  T_Race *result; // eax
  unsigned __int8 v6; // al
  int v7; // ecx
  int v8; // ebx
  char v9; // [esp+0h] [ebp-2Ch]
  int v10; // [esp+4h] [ebp-28h] BYREF
  int v11; // [esp+8h] [ebp-24h] BYREF
  T_Race *races; // [esp+Ch] [ebp-20h]
  unsigned __int8 *v13; // [esp+10h] [ebp-1Ch]

  if ( *a1 == byte_104BEA && V_FlashPopExists_dword_A0D00 != 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0xCD);
  }
  v13 = a1;
  v2 = a1;
  a1[0x1E9] = 0xE;
  v3 = 0;
  races = V_Game.races;
  do
  {
    if ( v3 != *a1 && *(_DWORD *)V_Game.races[v3].z != 0xFFFFFFFF )
    {
      if ( (v3 != byte_104BEA || V_FlashPopExists_dword_A0D00 == 0xFFFFFFFF)
        && !v2[0x1C0]
        && sub_44024(a1, v3) == 0xFFFFFFFF )
      {
        *((_WORD *)v13 + 0xD9) = *(_WORD *)(a1 + 0x1D5);
        V_Game.races[v3].Unknown_1B2[*a1] = V_Game.races[v3].Unknown_1D5;
        V_Game.races[v3].Unknown_1C0[*a1] = 1;
        v2[0x1C0] = 1;
      }
      if ( v2[0x1C0] )
      {
        v6 = sub_44434(a1, v3, &v10);
        if ( v6 != 0xE )
        {
          if ( v3 != byte_104BEA || V_FlashPopExists_dword_A0D00 )
          {
            v9 = v6;
            v4 = sub_44BCC((int)races, (__int16 *)*a1, v6, v10, &v11);
            sub_450B0(a1, v3, v9, v4, v10, v11);
          }
          else
          {
            a1[0x1E9] = v6;
            v7 = (char)a1[0x1E9];
            v8 = *a1;
            *(_DWORD *)(a1 + 0x1EA) = v10;
            sub_55AEC(&V_Type3_stru_10AE70, 2, v8, v7);
          }
        }
      }
    }
    ++v2;
    ++v3;
    result = races + 1;
    v13 += 2;
    ++races;
  }
  while ( v3 < 7 );
  return result;
}
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;

//----- (00044238) --------------------------------------------------------
int __fastcall sub_44238(int a1, __int16 a2, _BYTE *a3, __int16 a4)
{
  T_Race *v7; // edi
  int v8; // ecx
  char v9; // kr00_1
  _BYTE *v10; // eax
  int result; // eax
  int v12; // eax
  int v13; // eax
  int v14; // ecx
  int v15; // eax
  int v16; // eax
  int v17; // eax
  int v18; // eax
  int v19; // ecx
  int v20; // eax
  _BYTE *v21; // [esp+4h] [ebp-10h]

  *a3 = 0xE;
  v7 = &V_Game.races[a2];
  v8 = 1;
  v9 = *(_BYTE *)(a1 + a2 + 0x1C0);
  v21 = a3 + 2;
  v10 = a3 + 1;
  switch ( v9 )
  {
    case 0:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\raceneg.cpp", 0x126);
      result = 1;
      break;
    case 1:
      *v10 = 2;
      *v21 = 3;
      v8 = 3;
      if ( V_Game.day - V_Day1 >= 5 )
      {
        v8 = 4;
        a3[3] = 4;
      }
      if ( V_Game.day - V_Day2 >= 5 )
      {
        v12 = (__int16)v8++;
        a3[v12] = 5;
      }
      if ( V_Game.day - V_Day3 >= 5 )
      {
        v13 = (__int16)v8++;
        a3[v13] = 6;
      }
      if ( !*(_BYTE *)(a1 + a4 + 0x1C0) || v7->Unknown_1C0[a4] != 2 )
      {
        goto LABEL_29;
      }
      a3[(__int16)v8] = 7;
      result = v8 + 1;
      break;
    case 2:
      *v10 = 0xD;
      result = 2;
      break;
    case 3:
      *v10 = 8;
      v14 = 2;
      if ( V_Game.day - V_Day1 >= 5 )
      {
        v14 = 3;
        *v21 = 4;
      }
      if ( V_Game.day - V_Day2 >= 5 )
      {
        v15 = (__int16)v14++;
        a3[v15] = 5;
      }
      if ( V_Game.day - V_Day3 >= 5 )
      {
        v16 = (__int16)v14++;
        a3[v16] = 6;
      }
      a3[(__int16)v14] = 0xC;
      v8 = v14 + 1;
      if ( *(_BYTE *)(a1 + a4 + 0x1C0) && v7->Unknown_1C0[a4] == 2 )
      {
        v17 = (__int16)v8++;
        a3[v17] = 7;
      }
      if ( *(_BYTE *)(a1 + a4 + 0x1C0) && v7->Unknown_1C0[a4] == 1 )
      {
        v18 = (__int16)v8;
        v19 = v8 + 1;
        a3[v18] = 9;
        v20 = (__int16)v19;
        v8 = v19 + 1;
        a3[v20] = 0xB;
      }
      if ( !*(_BYTE *)(a1 + a4 + 0x1C0) || v7->Unknown_1C0[a4] != 3 )
      {
        goto LABEL_29;
      }
      a3[(__int16)v8] = 0xA;
      result = v8 + 1;
      break;
    default:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\raceneg.cpp", 0x17E);
LABEL_29:
      result = v8;
      break;
  }
  return result;
}
// 105248: using guessed type int V_Day1;
// 10524C: using guessed type int V_Day2;
// 105250: using guessed type int V_Day3;

//----- (00044434) --------------------------------------------------------
char __fastcall sub_44434(unsigned __int8 *a1, __int16 a2, _DWORD *a3)
{
  char v5; // bh
  unsigned __int8 v6; // bl
  unsigned __int8 *v7; // eax
  unsigned __int8 *v9; // eax
  unsigned __int8 *v10; // eax
  unsigned __int8 *v11; // edx
  unsigned __int8 *v12; // eax
  __int16 v13; // dx
  __int16 v14; // ax
  __int16 v15; // dx
  int v16; // [esp+0h] [ebp-18h]

  if ( *a1 == byte_104BEA && V_FlashPopExists_dword_A0D00 != 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x18D);
  }
  v5 = sub_43374(a1, 0xFFFFFFFF);
  v6 = a1[a2 + 0x1C0];
  v7 = &a1[2 * a2];
  if ( v6 < 2u )
  {
    if ( v6 == 1 )
    {
      if ( V_Game.Unknown_D8A[0x2A] )
      {
        if ( V_Game.Unknown_D8A[0x2A] <= 1u )
        {
          if ( *((_WORD *)v7 + 0xD9) < *(_WORD *)(a1 + 0x1C9) && a2 == byte_104BEA )
          {
            return 2;
          }
        }
        else if ( V_Game.Unknown_D8A[0x2A] == 2 )
        {
          if ( *((_WORD *)v7 + 0xD9) < *(_WORD *)(a1 + 0x1CB) && a2 == byte_104BEA )
          {
            *((_WORD *)v7 + 0xD9) = *(_WORD *)(a1 + 0x1C9) - 1;
            return 2;
          }
          v9 = &a1[2 * a2];
          if ( *(_WORD *)(a1 + 0x1CD) > *((_WORD *)v9 + 0xD9) && a2 == byte_104BEA )
          {
            *((_WORD *)v9 + 0xD9) = *(_WORD *)(a1 + 0x1CB) - 1;
          }
          else
          {
            v10 = &a1[2 * a2];
            if ( *(_WORD *)(a1 + 0x1CF) > *((_WORD *)v10 + 0xD9) && a2 == byte_104BEA )
            {
              *((_WORD *)v10 + 0xD9) = *(_WORD *)(a1 + 0x1CD) - 1;
            }
            else
            {
              v11 = &a1[2 * a2];
              if ( *(_WORD *)(a1 + 0x1D1) > *((_WORD *)v11 + 0xD9) && a2 == byte_104BEA )
              {
                *((_WORD *)v11 + 0xD9) = *(_WORD *)(a1 + 0x1CF) - 1;
              }
              else
              {
                v12 = &a1[2 * a2];
                if ( *(_WORD *)(a1 + 0x1D3) > *((_WORD *)v12 + 0xD9) && a2 == byte_104BEA )
                {
                  *((_WORD *)v12 + 0xD9) = *(_WORD *)(a1 + 0x1D1) - 1;
                }
                else if ( a2 == byte_104BEA )
                {
                  *(_WORD *)&a1[2 * a2 + 0x1B2] = *(_WORD *)(a1 + 0x1D3) - 1;
                }
              }
            }
          }
        }
      }
      else if ( *((_WORD *)v7 + 0xD9) < *(_WORD *)(a1 + 0x1C9)
             && (!v5 || a2 == byte_104BEA)
             && (a2 == byte_104BEA || *(__int16 *)&V_Game.Unknown_D8A[6 * *a1 + 4] > 2) )
      {
        return 2;
      }
      if ( *(_WORD *)(a1 + 0x1D3) < *(_WORD *)&a1[2 * a2 + 0x1B2] )
      {
        return 3;
      }
    }
  }
  else if ( v6 <= 2u )
  {
    if ( *((_WORD *)v7 + 0xD9) > *(_WORD *)(a1 + 0x1CD) )
    {
      return 0xD;
    }
  }
  else
  {
    if ( v6 != 3 )
    {
      goto LABEL_51;
    }
    if ( *((_WORD *)v7 + 0xD9) < *(_WORD *)(a1 + 0x1C9) && !v5 )
    {
      if ( a2 == byte_104BEA || *(__int16 *)&V_Game.Unknown_D8A[6 * *a1 + 4] > 2 )
      {
        return 2;
      }
      return 8;
    }
    if ( *(_WORD *)(a1 + 0x1CF) > *(_WORD *)&a1[2 * a2 + 0x1B2] )
    {
      return 8;
    }
  }
LABEL_51:
  if ( V_Game.day % *(__int16 *)(a1 + 0x1C7) || a2 != byte_104BEA || a1[a2 + 0x1C0] == 2 )
  {
    return 0xE;
  }
  v16 = rand() % 0x64;
  if ( a2 != byte_104BEA )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x212);
  }
  if ( a1[a2 + 0x1C0] != 3 || v16 >= 0x50 )
  {
LABEL_85:
    if ( *(_WORD *)(a1 + 0x1C9) <= *(_WORD *)&a1[2 * a2 + 0x1B2] )
    {
      if ( a1[a2 + 0x1C0] == 3 )
      {
        v16 += 0xF;
      }
      if ( *(__int16 *)&a1[2 * a2 + 0x1B2] > *(__int16 *)(a1 + 0x1CF) + 0xA && v16 >= 0x5D && sub_46208(a1, a2) )
      {
        return 6;
      }
      if ( *(_WORD *)(a1 + 0x1CF) < *(_WORD *)&a1[2 * a2 + 0x1B2] && v16 >= 0x58 && sub_46034(a1, a2) )
      {
        return 5;
      }
      if ( *(__int16 *)&a1[2 * a2 + 0x1B2] > *(__int16 *)(a1 + 0x1D5) + 0x14 && v16 >= 0x50 && sub_45E64(a1, a2) )
      {
        return 4;
      }
    }
    return 0xE;
  }
  v13 = 0;
  if ( V_Game.racesNum > 0 )
  {
    while ( v13 == *a1
         || v13 == a2
         || *(_DWORD *)V_Game.races[v13].z == 0xFFFFFFFF
         || a1[v13 + 0x1C0] != 2
         || V_Game.races[byte_104BEA].Unknown_1C0[v13] != 3 )
    {
      if ( ++v13 >= V_Game.racesNum )
      {
        goto LABEL_67;
      }
    }
    *a3 = v13;
    return 0xA;
  }
  else
  {
LABEL_67:
    v14 = 0;
    if ( V_Game.racesNum > 0 )
    {
      while ( v14 == *a1
           || v14 == a2
           || *(_DWORD *)V_Game.races[v14].z == 0xFFFFFFFF
           || a1[v14 + 0x1C0] != 3
           || V_Game.races[byte_104BEA].Unknown_1C0[v14] != 2 )
      {
        if ( ++v14 >= V_Game.racesNum )
        {
          goto LABEL_76;
        }
      }
      *a3 = v14;
      return 7;
    }
    else
    {
LABEL_76:
      v15 = 0;
      if ( V_Game.racesNum <= 0 )
      {
        goto LABEL_85;
      }
      while ( v15 == *a1
           || v15 == a2
           || *(_DWORD *)V_Game.races[v15].z == 0xFFFFFFFF
           || a1[v15 + 0x1C0] != 2
           || V_Game.races[byte_104BEA].Unknown_1C0[v15] != 1 )
      {
        if ( ++v15 >= V_Game.racesNum )
        {
          goto LABEL_85;
        }
      }
      *a3 = v15;
      return 9;
    }
  }
}
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;

//----- (00044A2C) --------------------------------------------------------
int __fastcall sub_44A2C(_BYTE *a1, int a2, char a3, _BYTE *a4)
{
  _BYTE *v4; // eax
  int result; // eax

  if ( *a1 != byte_104BEA )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x263);
  }
  v4 = a4 + 1;
  switch ( a3 )
  {
    case 0:
      *a4 = 0;
      result = 1;
      break;
    case 1:
      *a4 = 1;
      *v4 = 2;
      result = 2;
      break;
    case 2:
      *a4 = 3;
      result = 1;
      break;
    case 3:
      *a4 = 4;
      *v4 = 5;
      result = 2;
      break;
    case 4:
      *a4 = 6;
      *v4 = 7;
      result = 2;
      break;
    case 5:
      *a4 = 8;
      *v4 = 9;
      result = 2;
      break;
    case 6:
      *a4 = 0xA;
      *v4 = 0xB;
      result = 2;
      break;
    case 7:
      *a4 = 0xC;
      *v4 = 0xD;
      result = 2;
      break;
    case 8:
      *a4 = 0xE;
      result = 1;
      break;
    case 9:
      *a4 = 0xF;
      *v4 = 0x10;
      result = 2;
      break;
    case 0xA:
      *a4 = 0x11;
      *v4 = 0x12;
      result = 2;
      break;
    case 0xB:
      *a4 = 0x13;
      *v4 = 0x14;
      result = 2;
      break;
    case 0xC:
      *a4 = 0x15;
      *v4 = 0x16;
      result = 2;
      break;
    case 0xD:
      *a4 = 0x1B;
      *v4 = 0x1C;
      result = 2;
      break;
    case 0xE:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\raceneg.cpp", 0x2CF);
      result = 0xE;
      break;
    default:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\raceneg.cpp", 0x2D4);
      JUMPOUT(0x44B91);
  }
  return result;
}
// 44B8C: control flows out of bounds to 44B91

//----- (00044BCC) --------------------------------------------------------
char __fastcall sub_44BCC(int a1, __int16 *a2, char a3, int a4, int *a5)
{
  int v7; // ebx
  __int16 v8; // di
  int v9; // ebx
  const char *v10; // edx
  int v11; // [esp+0h] [ebp-1B8h] BYREF

  *(_DWORD *)(a1 + 0x1EA) = a4;
  switch ( a3 )
  {
    case 2:
      return 3;
    case 3:
      if ( *(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) <= *(_WORD *)(a1 + 0x1D1) )
      {
        return 5;
      }
      else
      {
        return 4;
      }
    case 4:
      if ( *(__int16 *)(a1 + 2 * (__int16)a2 + 0x1B2) > *(__int16 *)(a1 + 0x1D5) + 0x14
        && sub_45E64((_BYTE *)a1, (__int16)a2) )
      {
        return 6;
      }
      else
      {
        return 7;
      }
    case 5:
      if ( *(_WORD *)(a1 + 0x1CF) < *(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) && sub_46034((_BYTE *)a1, (__int16)a2) )
      {
        return 8;
      }
      else
      {
        return 9;
      }
    case 6:
      if ( *(__int16 *)(a1 + 2 * (__int16)a2 + 0x1B2) > *(__int16 *)(a1 + 0x1CF) + 0xA
        && sub_46208((_BYTE *)a1, (__int16)a2) )
      {
        return 0xA;
      }
      else
      {
        return 0xB;
      }
    case 7:
      if ( *(_BYTE *)(a4 + a1 + 0x1C0) != 2 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x336);
      }
      if ( *(__int16 *)(a1 + 2 * a4 + 0x1B2)
         + (__int16)(*(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) - V_Game.races[(__int16)a2].Unknown_1C7[5]) <= *(__int16 *)(a1 + 0x1CD) )
      {
        return 0xD;
      }
      else
      {
        return 0xC;
      }
    case 8:
      return 0xE;
    case 9:
      if ( *(_BYTE *)(a1 + (__int16)a2 + 0x1C0) != 3 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x34A);
      }
      if ( *(_BYTE *)(a1 + a4 + 0x1C0) != 1 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x34B);
      }
      if ( (__int16)(*(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) - *(_WORD *)(a1 + 2 * a4 + 0x1B2)) <= *(__int16 *)(a1 + 0x1D5) )
      {
        return 0x10;
      }
      else
      {
        return 0xF;
      }
    case 0xA:
      if ( *(_BYTE *)(a1 + (__int16)a2 + 0x1C0) != 3 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x361);
      }
      if ( *(_BYTE *)(a1 + a4 + 0x1C0) != 3 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x362);
      }
      v7 = a1 + 2 * (__int16)a2;
      v8 = *(_WORD *)(2 * a4 + a1 + 0x1B2);
      if ( (__int16)(*(_WORD *)(v7 + 0x1B2) - v8) <= 0
        || (__int16)(*(_WORD *)(v7 + 0x1B2) - V_Game.races[(__int16)a2].Unknown_1C7[5])
         - (__int16)(v8 - V_Game.races[a4].Unknown_1C7[5]) <= 0 )
      {
        return 0x12;
      }
      else
      {
        return 0x11;
      }
    case 0xB:
      if ( *(_BYTE *)(a1 + (__int16)a2 + 0x1C0) != 3 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x384);
      }
      if ( *(_BYTE *)(a1 + a4 + 0x1C0) != 1 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x385);
      }
      if ( *(__int16 *)(a1 + 2 * a4 + 0x1B2)
         - (__int16)(*(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) - V_Game.races[(__int16)a2].Unknown_1C7[5]) >= *(__int16 *)(a1 + 0x1C9) )
      {
        return 0x14;
      }
      else
      {
        return 0x13;
      }
    case 0xC:
      if ( !a4 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x39D);
      }
      if ( a5 )
      {
        *a5 = a4;
      }
      if ( !sub_45958((unsigned __int8 *)a1, 2, (__int16 *)a4, 0) )
      {
        return 0x18;
      }
      if ( (unsigned __int16)sub_45848((unsigned __int8 *)a1, a4, (int)&v11, a2) )
      {
        if ( ((1 << *(_BYTE *)a1) & *(unsigned __int8 *)(a4 + 0x15)) != 0 )
        {
          return 0x1A;
        }
        else if ( *(_WORD *)(a1 + 0x1D3) >= *(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) )
        {
          return 0x16;
        }
        else
        {
          return 0x15;
        }
      }
      else if ( ((1 << *(_BYTE *)a1) & *(unsigned __int8 *)(a4 + 0x15)) != 0 )
      {
        return 0x19;
      }
      else
      {
        return 0x17;
      }
    case 0xD:
      if ( *(_WORD *)(a1 + 2 * (__int16)a2 + 0x1B2) < *(_WORD *)(a1 + 0x1CB) )
      {
        return 0x1C;
      }
      else
      {
        return 0x1B;
      }
    case 0xE:
      v9 = 0x3CE;
      v10 = "..\\raceneg.cpp";
      break;
    default:
      v9 = 0x3D3;
      v10 = "..\\raceneg.cpp";
      break;
  }
  Q_AssertLogBreakExit_sub_261A8(0, v10, v9);
  JUMPOUT(0x45065);
}
// 45060: control flows out of bounds to 45065

//----- (000450B0) --------------------------------------------------------
void __fastcall sub_450B0(unsigned __int8 *a1, __int16 a2, char a3, char a4, int a5, int a6)
{
  T_Race *v7; // edi
  char *v9; // ebx
  char *v10; // edx
  unsigned __int8 *v11; // eax
  int v12; // eax
  int v13; // edx
  int v14; // eax
  int v15; // edx
  int v16; // eax
  int v17; // edx
  UBYTE *v18; // edi
  int v19; // eax
  int v20; // eax
  int v21; // edx
  unsigned __int8 *v22; // eax
  __int16 v23; // cx
  int v24; // edx
  unsigned __int8 *v25; // eax
  int v26; // edx
  unsigned __int8 *v27; // eax
  __int16 v28; // ax
  _BYTE v29[428]; // [esp+0h] [ebp-1D4h] BYREF
  int v30; // [esp+1ACh] [ebp-28h]
  unsigned int v31; // [esp+1B0h] [ebp-24h]
  int v32; // [esp+1B4h] [ebp-20h]
  int v33; // [esp+1B8h] [ebp-1Ch]
  int v34; // [esp+1BCh] [ebp-18h]
  T_Race *v35; // [esp+1C0h] [ebp-14h]
  __int16 v36; // [esp+1C4h] [ebp-10h]

  v36 = a2;
  v33 = a2;
  v7 = &V_Game.races[a2];
  v32 = (int)v7 + a5;
  v31 = 0x1EE * a5;
  v35 = &V_Game.races[a5];
  v34 = (int)v35 + a2;
  v9 = (char *)v7 + 2 * a5;
  v10 = (char *)v35 + 2 * a2;
  v11 = &a1[2 * v33];
  switch ( a3 )
  {
    case 0:
      v12 = *a1;
      v13 = v36;
      v7->Unknown_1C0[v12] = 1;
      a1[v13 + 0x1C0] = v7->Unknown_1C0[v12];
      *(_WORD *)&a1[2 * v36 + 0x1B2] = *(_WORD *)(a1 + 0x1D5);
      v7->Unknown_1B2[*a1] = v7->Unknown_1D5;
      return;
    case 1:
      if ( a4 == 1 )
      {
        *(_WORD *)&a1[2 * v36 + 0x1B2] += 0x28;
      }
      return;
    case 2:
      v14 = *a1;
      v15 = v36;
      v7->Unknown_1C0[v14] = 2;
      a1[v15 + 0x1C0] = v7->Unknown_1C0[v14];
      v7->Unknown_1B2[*a1] -= 0x28;
      return;
    case 3:
      if ( byte_104BEA == *a1 )
      {
        v7->Unknown_1B2[byte_104BEA] += 3;
      }
      if ( a4 == 4 )
      {
        v16 = *a1;
        v17 = v36;
        v7->Unknown_1C0[v16] = 3;
        a1[v17 + 0x1C0] = v7->Unknown_1C0[v16];
        *(_WORD *)&a1[2 * v17 + 0x1B2] += 0xA;
        v7->Unknown_1B2[*a1] += 0xA;
      }
      else
      {
        *(_WORD *)&a1[2 * v36 + 0x1B2] = *(_WORD *)(a1 + 0x1D1);
      }
      return;
    case 4:
      if ( byte_104BEA == *a1 )
      {
        v7->Unknown_1B2[byte_104BEA] += 5;
        V_Day1 = V_Game.day;
      }
      if ( a4 == 6 )
      {
        sub_45F60(a1, v36, 0);
        *(_WORD *)&a1[2 * v36 + 0x1B2] += 0xA;
        v7->Unknown_1B2[*a1] += 5;
      }
      else
      {
        v21 = v36;
        v22 = &a1[2 * v36];
        v23 = *((_WORD *)v22 + 0xD9) - 2;
        *((_WORD *)v22 + 0xD9) = v23;
        if ( a1[v21 + 0x1C0] == 3 )
        {
          *((_WORD *)v22 + 0xD9) = v23 - 2;
        }
      }
      return;
    case 5:
      if ( byte_104BEA == *a1 )
      {
        v7->Unknown_1B2[byte_104BEA] += 8;
        V_Day2 = V_Game.day;
      }
      if ( a4 == 8 )
      {
        sub_46130(a1, v36, 0);
        *(_WORD *)&a1[2 * v36 + 0x1B2] += 0xA;
        v7->Unknown_1B2[*a1] += 5;
      }
      else
      {
        v24 = v36;
        v25 = &a1[2 * v36];
        *((_WORD *)v25 + 0xD9) -= 3;
        if ( a1[v24 + 0x1C0] == 3 )
        {
          *((_WORD *)v25 + 0xD9) -= 3;
        }
      }
      return;
    case 6:
      if ( byte_104BEA == *a1 )
      {
        v7->Unknown_1B2[byte_104BEA] += 8;
        V_Day3 = V_Game.day;
      }
      if ( a4 == 0xA )
      {
        sub_46304(a1, v36, 0);
        *(_WORD *)&a1[2 * v36 + 0x1B2] += 0xA;
        v7->Unknown_1B2[*a1] += 0xA;
      }
      else
      {
        v26 = v36;
        v27 = &a1[2 * v36];
        *((_WORD *)v27 + 0xD9) -= 2;
        if ( a1[v26 + 0x1C0] == 3 )
        {
          *((_WORD *)v27 + 0xD9) -= 2;
        }
      }
      return;
    case 7:
      if ( a4 != 0xC )
      {
        goto LABEL_54;
      }
      *((_WORD *)v11 + 0xD9) += 5;
      if ( *((__int16 *)v10 + 0xD9) > V_Game.races[v31 / 0x1EE].Unknown_1C7[2] - 0xA )
      {
        *((_WORD *)v11 + 0xD9) += 5;
        *(_BYTE *)(v32 + 0x1C0) = 1;
        *(_BYTE *)(v34 + 0x1C0) = 1;
        *((_WORD *)v9 + 0xD9) += 0xA;
        v7->Unknown_1B2[*a1] += 5;
        *((_WORD *)v10 + 0xD9) += 0xA;
        v35->Unknown_1B2[*a1] += 0xF;
      }
      return;
    case 8:
      v20 = *a1;
      v7->Unknown_1C0[v20] = 1;
      a1[v33 + 0x1C0] = v7->Unknown_1C0[v20];
      v7->Unknown_1B2[*a1] -= 0x1E;
      return;
    case 9:
      if ( a4 == 0xF )
      {
        *((_WORD *)v11 + 0xD9) += 0xA;
        *(_BYTE *)(v32 + 0x1C0) = 2;
        *(_BYTE *)(v34 + 0x1C0) = 2;
        *((_WORD *)v9 + 0xD9) -= 0xF;
        v7->Unknown_1B2[*a1] += 0xA;
        *((_WORD *)v10 + 0xD9) -= 0x14;
        v11 = &v35->Unknown_00 + 2 * *a1;
      }
      goto LABEL_38;
    case 0xA:
      if ( a4 == 0x11 )
      {
        *((_WORD *)v11 + 0xD9) += 0xF;
        *(_BYTE *)(v32 + 0x1C0) = 1;
        *(_BYTE *)(v34 + 0x1C0) = 1;
        *((_WORD *)v9 + 0xD9) -= 5;
        v7->Unknown_1B2[*a1] -= 5;
        *((_WORD *)v10 + 0xD9) -= 0xA;
        v11 = &v35->Unknown_00 + 2 * *a1;
LABEL_41:
        *((_WORD *)v11 + 0xD9) -= 5;
      }
      else
      {
LABEL_38:
        *((_WORD *)v11 + 0xD9) -= 0xA;
      }
      break;
    case 0xB:
      if ( a4 != 0x13 )
      {
        goto LABEL_41;
      }
      *((_WORD *)v11 + 0xD9) += 5;
      v30 = V_Game.races[v31 / 0x1EE].Unknown_1C7[5];
      if ( *((__int16 *)v10 + 0xD9) > v30 - 0xA )
      {
        *((_WORD *)v11 + 0xD9) += 5;
        *(_BYTE *)(v32 + 0x1C0) = 3;
        *(_BYTE *)(v34 + 0x1C0) = 3;
        *((_WORD *)v9 + 0xD9) += 0xA;
        v7->Unknown_1B2[*a1] += 5;
        *((_WORD *)v10 + 0xD9) += 0xF;
        v35->Unknown_1B2[*a1] += 0xA;
      }
      break;
    case 0xC:
      if ( a4 == 0x15 || a4 == 0x1A )
      {
        if ( v36 != byte_104BEA )
        {
          if ( !a5 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x4FA);
          }
          v28 = sub_45848(&v7->Unknown_00, a5, (int)v29, (__int16 *)v7);
          if ( !v28 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x4FD);
          }
          sub_45A0C(v7, a5, (int)v29, v28);
          *(_WORD *)&a1[2 * v36 + 0x1B2] += 0xA;
        }
      }
      else if ( a4 == 0x16 )
      {
LABEL_54:
        *((_WORD *)v11 + 0xD9) -= 5;
      }
      return;
    case 0xD:
      if ( *a1 == byte_104BEA )
      {
        v7->Unknown_1B2[byte_104BEA] += 3;
      }
      if ( a4 == 0x1B )
      {
        v18 = &v7->Unknown_00 + *a1;
        v19 = v36;
        v18[0x1C0] = 1;
        a1[v19 + 0x1C0] = v18[0x1C0];
      }
      else
      {
        *(_WORD *)&a1[2 * v36 + 0x1B2] -= 0x19;
      }
      return;
    case 0xE:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\raceneg.cpp", 0x515);
      return;
    default:
      return;
  }
}
// 105248: using guessed type int V_Day1;
// 10524C: using guessed type int V_Day2;
// 105250: using guessed type int V_Day3;

//----- (00045848) --------------------------------------------------------
int __usercall sub_45848@<eax>(unsigned __int8 *a1@<eax>, int a2@<edx>, int a3@<ebx>, __int16 *a4@<edi>)
{
  __int16 v5; // si
  int v6; // eax
  int v7; // ebx
  int v8; // ebx
  char v9; // al
  int v10; // ebx
  int v12[107]; // [esp+0h] [ebp-1CCh] BYREF
  int v13; // [esp+1ACh] [ebp-20h]
  int v14; // [esp+1B0h] [ebp-1Ch]
  int v15; // [esp+1B4h] [ebp-18h]
  size_t v16; // [esp+1B8h] [ebp-14h]

  v13 = a2;
  v14 = a3;
  LOWORD(v15) = 0;
  v5 = 0;
  v16 = sub_40224(a1, v12, 0);
  if ( (__int16)v16 > 0 )
  {
    do
    {
      v8 = v12[v5];
      v9 = *(_BYTE *)(v8 + 0x58);
      v10 = *(_DWORD *)(v8 + 0x59);
      if ( v9 != 1 && v9 != 2 )
      {
        if ( v9 == 3 )
        {
          a4 = (__int16 *)&V_Game.stars[*(__int16 *)(v10 + 0xC)];
LABEL_8:
          if ( (unsigned __int8)V_Game.z10000[0x64 * a4[2] + *(__int16 *)(v13 + 4)] < 3u )
          {
            v6 = 4 * (__int16)v15;
            v7 = v12[v5];
            LOWORD(v15) = v15 + 1;
            *(_DWORD *)(v14 + v6) = v7;
          }
          goto LABEL_10;
        }
        if ( v9 != 4 )
        {
          if ( v9 == 5 )
          {
            a4 = *(__int16 **)v10;
          }
          goto LABEL_8;
        }
        a4 = (__int16 *)v10;
        if ( !sub_45958(a1, 2, (__int16 *)v10, 0) )
        {
          goto LABEL_8;
        }
      }
LABEL_10:
      ++v5;
    }
    while ( v5 < (__int16)v16 );
  }
  return v15;
}
// 45848: using guessed type int var_1CC[107];

//----- (00045958) --------------------------------------------------------
int __fastcall sub_45958(unsigned __int8 *a1, char a2, __int16 *a3, _DWORD *a4)
{
  int v5; // eax
  __int16 v6; // di
  int v7; // ecx
  __int16 v8; // bx
  int v9; // eax
  int v11[107]; // [esp+0h] [ebp-1C4h] BYREF
  int v12; // [esp+1ACh] [ebp-18h]
  _DWORD *v13; // [esp+1B0h] [ebp-14h]
  char v14; // [esp+1B4h] [ebp-10h]

  v14 = a2;
  v13 = a4;
  if ( !a3 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x54E);
  }
  v5 = sub_1D794(a3, v11);
  v6 = 0;
  v7 = 0;
  v8 = 0;
  v12 = v5;
  while ( v8 < v12 )
  {
    v9 = v11[v8];
    if ( v9 && (*(_WORD *)(v9 + 0x56) == *a1 && v14 == 3 || a1[*(__int16 *)(v9 + 0x56) + 0x1C0] == v14) )
    {
      ++v6;
      v7 += *(_DWORD *)v9 * *(_DWORD *)(v9 + 0x8C);
    }
    ++v8;
  }
  if ( v13 )
  {
    *v13 = v7;
  }
  return v6;
}
// 45958: using guessed type int var_1C4[107];

//----- (00045A0C) --------------------------------------------------------
int __fastcall sub_45A0C(_BYTE *a1, int a2, int a3, __int16 a4)
{
  int result; // eax
  int v6; // edx

  if ( *a1 == byte_104BEA )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x574);
  }
  for ( result = 0; (__int16)result < a4; *(_DWORD *)(v6 + 0x5E) = a2 )
  {
    *(_BYTE *)(*(_DWORD *)(a3 + 4 * (__int16)result) + 0x5D) = 1;
    v6 = *(_DWORD *)(a3 + 4 * (__int16)result++);
  }
  return result;
}

//----- (00045A54) --------------------------------------------------------
unsigned int __fastcall sub_45A54(unsigned __int8 *a1, int a2, int a3)
{
  __int16 v5; // ax
  int v6; // edx
  WORD i; // ax
  T_Race *races; // edi
  WORD j; // si
  __int16 v10; // ax
  int v11; // edx
  __int16 v12; // dx
  UBYTE v13; // cl
  unsigned int v16; // [esp+0h] [ebp-2Ch]
  unsigned int v17; // [esp+4h] [ebp-28h]
  unsigned int v18; // [esp+8h] [ebp-24h]
  unsigned int v19; // [esp+14h] [ebp-18h]
  int v20; // [esp+18h] [ebp-14h]

  if ( *a1 != byte_104BEA )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x58A);
  }
  v19 = 0;
  v17 = 0;
  v18 = 0;
  v16 = 0;
  v20 = 0;
  if ( (byte_D8460[*(__int16 *)(a2 + 4)] & 1) != 0 )
  {
    return 0;
  }
  v5 = 0;
  if ( V_Game.racesNum > 0 )
  {
    while ( v5 == byte_104BEA
         || a1[v5 + 0x1C0]
         || ((1 << v5) & (*(unsigned __int8 *)(a2 + 0x14) | *(unsigned __int8 *)(a2 + 0x15))) == 0 )
    {
      if ( ++v5 >= V_Game.racesNum )
      {
        goto LABEL_11;
      }
    }
    v20 = v5;
    a1[v5 + 0x1C0] = 1;
    v16 = 0xFFFFFFFF;
    *(_WORD *)&a1[2 * v5 + 0x1B2] = *(_WORD *)(a1 + 0x1D5);
    v6 = v5;
    V_Game.races[v6].Unknown_1C0[*a1] = 1;
    V_Game.races[0].Unknown_1B2[*a1 + v6 * 0xF7] = V_Game.races[v5].Unknown_1D5;
  }
LABEL_11:
  if ( !v16 )
  {
    for ( i = 0; i < V_Game.racesNum; ++i )
    {
      if ( i != byte_104BEA && a1[i + 0x1C0] == 2 )
      {
        if ( ((1 << i) & *(unsigned __int8 *)(a2 + 0x15)) != 0 )
        {
          v20 = i;
          v18 = 0xFFFFFFFF;
        }
        if ( !v18 && ((1 << i) & *(unsigned __int8 *)(a2 + 0x14)) != 0 )
        {
          v17 = 0xFFFFFFFF;
          v20 = i;
        }
      }
    }
  }
  if ( !v16 && !v18 && !v17 )
  {
    races = V_Game.races;
    for ( j = 0; j < V_Game.racesNum; ++races )
    {
      if ( j != byte_104BEA )
      {
        v10 = 0;
        if ( V_Game.racesNum > 0 )
        {
          v11 = *(unsigned __int8 *)(a2 + 0x15);
          while ( ((1 << j) & v11) == 0 || ((1 << v10) & v11) == 0 || races->Unknown_1C0[v10] != 2 )
          {
            if ( ++v10 >= V_Game.racesNum )
            {
              goto LABEL_34;
            }
          }
          v19 = 0xFFFFFFFF;
        }
      }
LABEL_34:
      ++j;
    }
  }
  if ( v16 == 0xFFFFFFFF )
  {
    v12 = 4;
  }
  else if ( v18 == 0xFFFFFFFF )
  {
    v12 = 5;
  }
  else if ( v17 == 0xFFFFFFFF )
  {
    v12 = 6;
  }
  else if ( v19 == 0xFFFFFFFF )
  {
    v12 = 7;
  }
  else
  {
    v13 = byte_104BEA;
    *(_BYTE *)(a3 + 0x5D) = 0;
    *(_DWORD *)(a3 + 0x5E) = 0;
    if ( ((1 << v13) & *(unsigned __int8 *)(a2 + 0x17)) != 0 )
    {
      v12 = 3;
    }
    else
    {
      v12 = 0x14;
    }
  }
  byte_D8460[*(__int16 *)(a2 + 4)] |= 1u;
  sub_55AEC(&V_Type3_stru_10AE70, v12, a3, v20);
  return 0xFFFFFFFF;
}
// 45D0F: conditional instruction was optimized away because edx.4 is in (3..7|==14)

//----- (00045D50) --------------------------------------------------------
unsigned int __fastcall sub_45D50(unsigned __int8 *a1, int a2, int a3)
{
  int v6; // ebx
  unsigned int v7; // edx
  unsigned __int8 *v8; // eax
  unsigned __int8 v9; // cl
  __int16 v11; // [esp+2h] [ebp-14h]

  if ( *a1 != byte_104BEA )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\raceneg.cpp", 0x61C);
  }
  v11 = *(_WORD *)(a3 + 0x56);
  v6 = *(unsigned __int8 *)(a2 + 0x15);
  v7 = 0xFFFFFFFF;
  if ( ((1 << v11) & v6) == 0 )
  {
    v8 = &a1[v11];
    v9 = v8[0x1C0];
    if ( v9 )
    {
      if ( v9 == 2 )
      {
        v7 = 9;
      }
    }
    else
    {
      v8[0x1C0] = 1;
      *(_WORD *)&a1[2 * v11 + 0x1B2] = *(_WORD *)(a1 + 0x1D5);
      V_Game.races[v11].Unknown_1C0[*a1] = 1;
      v7 = 8;
      V_Game.races[v11].Unknown_1B2[*a1] = V_Game.races[v11].Unknown_1D5;
    }
  }
  if ( v7 == 0xFFFFFFFF || (byte_D8460[*(__int16 *)(a2 + 4)] & 1) != 0 )
  {
    return 0;
  }
  sub_55AEC(&V_Type3_stru_10AE70, v7, a3, v11);
  byte_D8460[*(__int16 *)(a2 + 4)] |= 1u;
  return 0xFFFFFFFF;
}

//----- (00045E64) --------------------------------------------------------
unsigned int __fastcall sub_45E64(_BYTE *a1, __int16 a2)
{
  unsigned __int8 v2; // al
  int v3; // edx
  T_Type15 *i; // eax
  float v7; // [esp+4h] [ebp-24h]
  __int16 v8; // [esp+8h] [ebp-20h]
  __int16 v9; // [esp+Ch] [ebp-1Ch]
  unsigned __int8 v10; // [esp+10h] [ebp-18h]
  unsigned __int8 v11; // [esp+14h] [ebp-14h]

  if ( a1[a2 + 0x1C0] == 3 )
  {
    return 0xFFFFFFFF;
  }
  v9 = 0;
  v11 = 1 << *a1;
  v8 = 0;
  v2 = 1 << a2;
  v3 = 0;
  v10 = v2;
  for ( i = V_Game.t15; (__int16)v3 < V_Game.t15Num; ++i )
  {
    if ( (v11 & i->Unknown_20[0]) != 0 )
    {
      ++v9;
    }
    if ( (v10 & i->Unknown_20[0]) != 0 )
    {
      ++v8;
    }
    ++v3;
  }
  if ( v9 >= 5 )
  {
    if ( !v8 )
    {
      v8 = 1;
    }
    v7 = (float)v9;
    if ( v7 / (double)V_Game.t15Num > dbl_9259A )
    {
      return 0;
    }
    if ( v7 / (double)v8 > dbl_925A2 )
    {
      return 0;
    }
    return 0xFFFFFFFF;
  }
  return 0;
}
// 9259A: using guessed type double dbl_9259A;
// 925A2: using guessed type double dbl_925A2;

//----- (00045F60) --------------------------------------------------------
void __fastcall sub_45F60(_BYTE *a1, __int16 a2, int a3)
{
  int v5; // ebx
  int v6; // esi
  int v7; // eax
  int v8; // edx
  int v9; // ebp
  __int64 v10; // rtt
  unsigned __int8 v11; // dh
  T_Type15 *t15; // eax
  unsigned __int8 v13; // dl
  int i; // ecx
  int v16; // [esp+4h] [ebp-14h]

  v5 = 0;
  v6 = 0;
  if ( a1[a2 + 0x1C0] == 3 )
  {
    v7 = rand();
    v8 = v7;
    v9 = 6;
  }
  else
  {
    v7 = rand();
    v8 = v7;
    v9 = 3;
  }
  LODWORD(v10) = v7;
  HIDWORD(v10) = v8 >> 0x1F;
  v16 = v10 % v9 + 1;
  v11 = 1 << *a1;
  t15 = V_Game.t15;
  v13 = 1 << V_Game.races[a2].Unknown_00;
  for ( i = 0; (__int16)i < V_Game.t15Num; ++t15 )
  {
    if ( a3 || (v11 & t15->Unknown_20[0]) == 0 )
    {
      if ( (v13 & t15->Unknown_20[0]) != 0 && v5 < v16 && (v11 & t15->Unknown_20[0]) == 0 )
      {
        ++v5;
        t15->Unknown_20[0] |= v11;
      }
    }
    else if ( v6 < v16 && (v13 & t15->Unknown_20[0]) == 0 )
    {
      ++v6;
      t15->Unknown_20[0] |= v13;
    }
    ++i;
  }
}

//----- (00046034) --------------------------------------------------------
unsigned int __fastcall sub_46034(_BYTE *a1, __int16 a2)
{
  unsigned __int8 v2; // al
  int v3; // edx
  T_Star *i; // eax
  float v7; // [esp+4h] [ebp-24h]
  __int16 v8; // [esp+8h] [ebp-20h]
  __int16 v9; // [esp+Ch] [ebp-1Ch]
  unsigned __int8 v10; // [esp+10h] [ebp-18h]
  unsigned __int8 v11; // [esp+14h] [ebp-14h]

  if ( a1[a2 + 0x1C0] == 3 )
  {
    return 0xFFFFFFFF;
  }
  v9 = 0;
  v11 = 1 << *a1;
  v8 = 0;
  v2 = 1 << a2;
  v3 = 0;
  v10 = v2;
  for ( i = V_Game.stars; (__int16)v3 < V_Game.starsNum; ++i )
  {
    if ( (v11 & i->Unknown_17) != 0 )
    {
      ++v9;
    }
    if ( (v10 & i->Unknown_17) != 0 )
    {
      ++v8;
    }
    ++v3;
  }
  if ( v9 >= 3 )
  {
    if ( !v8 )
    {
      v8 = 1;
    }
    v7 = (float)v9;
    if ( v7 / (double)V_Game.starsNum > dbl_925AA )
    {
      return 0;
    }
    if ( v7 / (double)v8 > dbl_925B2 )
    {
      return 0;
    }
    return 0xFFFFFFFF;
  }
  return 0;
}
// 925AA: using guessed type double dbl_925AA;
// 925B2: using guessed type double dbl_925B2;

//----- (00046130) --------------------------------------------------------
void __fastcall sub_46130(_BYTE *a1, __int16 a2, int a3)
{
  int v5; // esi
  int v6; // ebx
  int v7; // eax
  int v8; // edx
  int v9; // ebp
  __int64 v10; // rtt
  unsigned __int8 v11; // dh
  T_Star *stars; // eax
  unsigned __int8 v13; // dl
  int i; // ecx
  int v16; // [esp+4h] [ebp-14h]

  v5 = 0;
  v6 = 0;
  if ( a1[a2 + 0x1C0] == 3 )
  {
    v7 = rand();
    v8 = v7;
    v9 = 4;
  }
  else
  {
    v7 = rand();
    v8 = v7;
    v9 = 2;
  }
  LODWORD(v10) = v7;
  HIDWORD(v10) = v8 >> 0x1F;
  v16 = v10 % v9 + 1;
  v11 = 1 << *a1;
  stars = V_Game.stars;
  v13 = 1 << V_Game.races[a2].Unknown_00;
  for ( i = 0; (__int16)i < V_Game.starsNum; ++stars )
  {
    if ( a3 || (v11 & stars->Unknown_17) == 0 )
    {
      if ( (v13 & stars->Unknown_17) != 0 && v5 < v16 && (v11 & stars->Unknown_17) == 0 )
      {
        stars->Unknown_16 |= v11;
        ++v5;
        stars->Unknown_17 |= v11;
      }
    }
    else if ( v6 < v16 && (v13 & stars->Unknown_17) == 0 )
    {
      stars->Unknown_16 |= v13;
      ++v6;
      stars->Unknown_17 |= v13;
    }
    ++i;
  }
}

//----- (00046208) --------------------------------------------------------
unsigned int __fastcall sub_46208(_BYTE *a1, __int16 a2)
{
  unsigned __int8 v2; // al
  __int16 v3; // dx
  T_ResItem *items; // eax
  float v7; // [esp+0h] [ebp-20h]
  __int16 v8; // [esp+8h] [ebp-18h]
  __int16 v9; // [esp+Ch] [ebp-14h]
  unsigned __int8 v10; // [esp+10h] [ebp-10h]
  unsigned __int8 v11; // [esp+14h] [ebp-Ch]

  if ( a1[a2 + 0x1C0] == 3 )
  {
    return 0xFFFFFFFF;
  }
  v8 = 0;
  v11 = 1 << *a1;
  v9 = 0;
  v2 = 1 << a2;
  v3 = 0;
  v10 = v2;
  items = V_ResTree.items;
  while ( v3 < (int)(unsigned __int16)V_ResTree.num )
  {
    if ( (v11 & items->z2[0]) != 0 )
    {
      ++v8;
    }
    if ( (v10 & items->z2[0]) != 0 )
    {
      ++v9;
    }
    ++v3;
    ++items;
  }
  if ( v8 >= 5 )
  {
    if ( !v9 )
    {
      v9 = 1;
    }
    v7 = (float)v8;
    if ( v7 / (double)(unsigned __int16)V_ResTree.num > dbl_925BA )
    {
      return 0;
    }
    if ( v7 / (double)v9 > dbl_925C2 )
    {
      return 0;
    }
    return 0xFFFFFFFF;
  }
  return 0;
}
// 925BA: using guessed type double dbl_925BA;
// 925C2: using guessed type double dbl_925C2;

//----- (00046304) --------------------------------------------------------
int __fastcall sub_46304(_BYTE *a1, __int16 a2, int a3)
{
  int v4; // ebx
  int v5; // esi
  unsigned __int8 v6; // cl
  __int64 i; // rax
  int v10; // [esp+Ch] [ebp-2Ch]
  __int16 v11; // [esp+18h] [ebp-20h]
  __int16 Unknown_00; // [esp+20h] [ebp-18h]
  unsigned __int8 v13; // [esp+24h] [ebp-14h]

  v4 = 0;
  v5 = 0;
  if ( a1[a2 + 0x1C0] == 3 )
  {
    v10 = rand() % 2 + 1;
  }
  else
  {
    v10 = 1;
  }
  v13 = 1 << *a1;
  v6 = 1 << V_Game.races[a2].Unknown_00;
  v11 = (unsigned __int8)*a1;
  Unknown_00 = V_Game.races[a2].Unknown_00;
  for ( i = (unsigned int)V_ResTree.items; (unsigned __int16)V_ResTree.num > SWORD2(i); LODWORD(i) = i + 0x4B )
  {
    if ( a3 || (*(_BYTE *)(i + 0x48) & v13) == 0 )
    {
      if ( (v6 & *(_BYTE *)(i + 0x48)) != 0 && v4 < v10 && (v13 & *(_BYTE *)(i + 0x48)) == 0 )
      {
        *(_BYTE *)(i + 0x48) |= v13;
        if ( (unsigned __int16)V_ResTree.a.w1[v11] == SWORD2(i) )
        {
          V_ResTree.a.w1[v11] = 0xFFFF;
        }
        ++v4;
      }
    }
    else if ( v5 < v10 && (*(_BYTE *)(i + 0x48) & v6) == 0 )
    {
      *(_BYTE *)(i + 0x48) |= v6;
      if ( (unsigned __int16)V_ResTree.a.w1[Unknown_00] == SWORD2(i) )
      {
        V_ResTree.a.w1[Unknown_00] = 0xFFFF;
      }
      ++v5;
    }
    ++WORD2(i);
  }
  return i;
}

//----- (00046470) --------------------------------------------------------
void sub_46470()
{
  Q_RESEARCH_CPP_LoadResTreeTxt_sub_46480(&V_ResTree, 0);
}

//----- (00046480) --------------------------------------------------------
void __fastcall __spoils<eax,edx> Q_RESEARCH_CPP_LoadResTreeTxt_sub_46480(P_ResTree a1, const char *fname)
{
  P_ResTree v2; // esi
  void *v3; // ebx
  T_ResTree *__shifted(T_ResItem,0x49) v4; // eax
  const char *v5; // eax
  int costMultiplier; // ebp
  T_ResItem *__shifted(T_ResItem,-2) v7; // edi
  FILE *v8; // edx
  int *__shifted(T_ResItem,-2) v9; // ebx
  int m; // edx
  T_ResItem *__shifted(T_ResItem,-2) v11; // ebx
  int i; // eax
  int v13; // eax
  int v14; // ecx
  T_ResItem *__shifted(T_ResItem,-2) v15; // edx
  UBYTE v16; // al
  int k; // edi
  int *__shifted(T_ResItem,-2) v18; // ebp
  int v19; // ecx
  T_Type11 *__shifted(T_Type11,-0x1D4C) v20; // eax
  int v21; // esi
  T_ResItem *name; // [esp+0h] [ebp-20h]
  fpos_t v23; // [esp+4h] [ebp-1Ch] BYREF
  FILE *pos; // [esp+8h] [ebp-18h] BYREF
  int val1; // [esp+Ch] [ebp-14h] BYREF
  int val2; // [esp+10h] [ebp-10h] BYREF
  T_ResItem *__shifted(T_ResItem,-2) v27; // [esp+14h] [ebp-Ch]
  int j; // [esp+18h] [ebp-8h]
  FILE *fp; // [esp+1Ch] [ebp-4h]

  v2 = a1;
  a1->b = 0;
  v3 = &a1->items[99].z2[1];
  a1->c = 0;
  do
  {
    a1 = (P_ResTree)((char *)a1 + 0x4B);
    LOBYTE(a1->num) = 0;
    HIBYTE(a1[0xFFFFFFFF].c) = a1->num;
  }
  while ( a1 != v3 );
  if ( !V_ResTreeTxtLoaded )
  {
    v4 = v2;
    do
    {
      v4 = (T_ResTree *__shifted(T_ResItem,0x49))((char *)v4 + 0x4B);
      ADJ(v4)->next[0] = 0xFF;
    }
    while ( v4 != (T_ResTree *__shifted(T_ResItem,0x49))&v2->items[0x63].z2[1] );
    v2->num = 0;
    if ( fname )
    {
      v5 = fname;
    }
    else
    {
      v5 = "restree.txt";
    }
    fp = Q_OpenFile_sub_1BB10(v5, &v23);
    if ( fp )
    {
      fscanf(fp, "%d", &val1);
      v2->num = val1;
      if ( (unsigned __int16)v2->num > 100u )
      {
        v2->num = 100;
      }
      costMultiplier = -20;
      j = 0;
      name = v2->items;
      v7 = (T_ResItem *__shifted(T_ResItem,-2))v2;
      while ( (unsigned __int16)v2->num > j )
      {
        v8 = fp;
        fscanf(fp, "%s", name);
        fscanf(v8, "%d %d", &val1, &val2);
        ADJ(v7)->type = val1;
        if ( j > 10 )
        {
          val2 *= costMultiplier;
        }
        if ( val2 > 65000 )
        {
          val2 = 65000;
        }
        v9 = (int *__shifted(T_ResItem,-2))v7;
        m = 0;
        ADJ(v7)->cost = val2;
        do
        {
          fscanf(fp, "%d", &val1);
          ADJ(v9)->preq[0] = val1;
          if ( val1 == 0xFF )
          {
            v11 = v7;
            i = 0;
            goto LABEL_25;
          }
          ++m;
          v9 = (int *__shifted(T_ResItem,-2))((char *)v9 + 1);
        }
        while ( m < 5 );
        v11 = v7;
        for ( i = 0; i < 0x3C; ++i )
        {
LABEL_25:
          if ( ADJ(v11)->name[i] == '^' )
          {
            ADJ(v11)->name[i] = ' ';
          }
        }
        costMultiplier += 2;
        ++v7;
        ++name;
        ++j;
      }
      v27 = (T_ResItem *__shifted(T_ResItem,-2))v2;
      for ( j = 0; (unsigned __int16)v2->num > j; ++j )
      {
        v18 = (int *__shifted(T_ResItem,-2))v27;
        for ( k = 0; k < 5; ++k )
        {
          v19 = ADJ(v18)->preq[0];
          if ( v19 == 0xFF )
          {
            break;
          }
          v13 = 0;
          v14 = 0x4B * v19;
          while ( 1 )
          {
            v15 = (T_ResItem *__shifted(T_ResItem,-2))((char *)v2 + v14 + v13);
            if ( ADJ(v15)->next[0] == 0xFF )
            {
              break;
            }
            if ( ++v13 >= 4 )
            {
              goto LABEL_31;
            }
          }
          v16 = j;
          ADJ(v15)->next[1] = 0xFF;
          ADJ(v15)->next[0] = v16;
LABEL_31:
          v18 = (int *__shifted(T_ResItem,-2))((char *)v18 + 1);
        }
        ++v27;
      }
      fgetpos(fp, (fpos_t *)&pos);
      if ( (int)pos >= v23 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\research.cpp", 0x86);
      }
      fclose(fp);
    }
    V_ResTreeTxtLoaded = TRUE;
  }
  v20 = (T_Type11 *__shifted(T_Type11,-0x1D4C))v2;
  v21 = (int)&v2->items[0].name[0xC];
  do
  {
    v20 = (T_Type11 *__shifted(T_Type11,-0x1D4C))((char *)v20 + 2);
    ADJ(v20)->w1[0] = 0xFFFF;
    ADJ(v20)->w2[0] = 0;
  }
  while ( v20 != (T_Type11 *__shifted(T_Type11,-0x1D4C))v21 );
}
// 105254: using guessed type int V_ResTreeTxtLoaded;

//----- (000466FC) --------------------------------------------------------
int __fastcall sub_466FC(unsigned int a1)
{
  int v2; // esi
  int v3; // ecx
  T_Planet *i; // esi
  int byte57; // eax
  int v6; // ebx
  unsigned int j; // esi
  int result; // eax
  int v9; // eax
  int v10; // eax
  int v11; // ebx
  char v12; // dl
  int v13; // edx
  int v14; // eax
  __int64 v15[3]; // [esp+8h] [ebp-3Ch]
  int v16; // [esp+20h] [ebp-24h]
  int v17; // [esp+24h] [ebp-20h]
  int v18; // [esp+28h] [ebp-1Ch]

  v2 = 0;
  v18 = 0;
  while ( V_Game.racesNum > v18 )
  {
    v2 += 2;
    ++v18;
    *(_WORD *)((char *)v15 + v2 + 6) = 0;
  }
  v3 = 0;
  for ( i = V_Game.planets; ; ++i )
  {
    v18 = v3;
    if ( V_Game.planetsNum <= v3 )
    {
      break;
    }
    byte57 = i->byte57;
    if ( byte57 < V_Game.racesNum )
    {
      if ( (_BYTE)byte57 != byte_104BEA && V_Game.Unknown_D8A[0x2A] == 2 && i->word46 < 0xFu )
      {
        ++*((_WORD *)&v15[1] + byte57);
      }
      *((_WORD *)&v15[1] + i->byte57) += i->word46;
    }
    v3 = v18 + 1;
  }
  v6 = 0;
  for ( j = a1; ; j += 2 )
  {
    v18 = v6;
    result = V_Game.racesNum;
    if ( V_Game.racesNum <= v6 )
    {
      break;
    }
    if ( *(unsigned __int16 *)(j + 0x1D4E) == 0xFFFF )
    {
      *(_WORD *)(j + 0x1D5C) = 0;
    }
    else
    {
      v9 = *((unsigned __int16 *)&v15[1] + v6);
      v17 = (unsigned __int16)v9;
      if ( (_WORD)v9 )
      {
        v16 = v9 + 1;
        v17 = (int)pow((double)(v9 + 1), 0.85);
      }
      v10 = 0x4B * *(unsigned __int16 *)(j + 0x1D4E);
      *(_WORD *)(j + 0x1D5C) += v17;
      if ( *(_WORD *)(j + 0x1D5C) >= *(_WORD *)(a1 + v10 + 0x3E) )
      {
        v11 = *(unsigned __int16 *)(j + 0x1D4E);
        v12 = 1 << v18;
        *(_BYTE *)(a1 + 0x4B * (unsigned __int16)v11 + 0x4A) |= 1 << v18;
        *(_BYTE *)(a1 + 0x4B * *(unsigned __int16 *)(j + 0x1D4E) + 0x4B) |= v12;
        v13 = v18;
        *(_WORD *)(j + 0x1D4E) = 0xFFFF;
        v14 = byte_104BEA;
        *(_WORD *)(j + 0x1D5C) = 0;
        if ( v14 == v13 )
        {
          sub_55AEC(&V_Type3_stru_10AE70, 0, v11, 0);
          sub_468BC(a1);
        }
      }
    }
    v6 = v18 + 1;
  }
  return result;
}

//----- (000468BC) --------------------------------------------------------
unsigned int __fastcall sub_468BC(unsigned int result)
{
  unsigned int v1; // esi

  v1 = result;
  if ( !*(_DWORD *)(result + 0x1D6E) )
  {
    result = sub_46900((char *)result, byte_104BEA);
    if ( result == 0xFFFFFFFF )
    {
      result = sub_55AEC(&V_Type3_stru_10AE70, 0x15, 0, 0);
      *(_DWORD *)(v1 + 0x1D6E) = 0xFFFFFFFF;
    }
  }
  return result;
}

//----- (00046900) --------------------------------------------------------
unsigned int __fastcall sub_46900(char *a1, char a2)
{
  int v2; // edx

  v2 = 1 << a2;
  if ( (v2 & a1[0x4A]) != 0 && (v2 & a1[0x95]) != 0 && (v2 & a1[0xE0]) != 0 && (v2 & a1[0x12B]) != 0 )
  {
    return 0xFFFFFFFF;
  }
  else
  {
    return 0;
  }
}

//----- (0004694C) --------------------------------------------------------
unsigned int __fastcall sub_4694C(int a1, unsigned __int16 a2, __int16 a3)
{
  char v4; // di
  unsigned int v5; // ebp
  int i; // eax

  v4 = a3;
  if ( a3 == 0xFFFFFFFF )
  {
    v4 = byte_104BEA;
  }
  v5 = 0xFFFFFFFF;
  if ( ((1 << v4) & *(char *)(a1 + 0x4B * a2 + 0x4A)) == 0 )
  {
    for ( i = 0; i < 5; ++i )
    {
      if ( *(unsigned __int8 *)(a1 + 0x4B * a2 + i + 0x40) == 0xFF )
      {
        break;
      }
      if ( ((1 << v4) & *(char *)(a1 + 0x4B * *(unsigned __int8 *)(a1 + 0x4B * a2 + i + 0x40) + 0x4A)) == 0 )
      {
        v5 = 0;
      }
    }
  }
  return v5;
}

//----- (000469F0) --------------------------------------------------------
int __fastcall sub_469F0(int a1, unsigned __int16 a2)
{
  int v3; // edx
  T_Planet *planets; // eax
  int byte57; // ebx
  int v7; // [esp+14h] [ebp-10h]

  if ( a2 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\research.cpp", 0x116);
  }
  v3 = 0;
  planets = V_Game.planets;
  v7 = 0;
  while ( v3 < V_Game.planetsNum )
  {
    byte57 = planets->byte57;
    if ( byte57 == a2 )
    {
      LOWORD(byte57) = planets->word46;
      v7 += byte57;
    }
    ++planets;
    ++v3;
  }
  if ( v7 )
  {
    return (int)pow((double)(v7 + 1), 0.85);
  }
  return v7;
}

//----- (00046A94) --------------------------------------------------------
__int16 __fastcall sub_46A94(unsigned __int16 *a1, unsigned __int16 a2, int a3)
{
  unsigned __int16 *v4; // ebx
  unsigned __int16 v5; // dx
  int i; // eax
  unsigned __int16 v7; // cx
  int v8; // edi
  char *v9; // esi
  char v10; // dl
  __int16 v12[100]; // [esp+0h] [ebp-E0h]
  int v13; // [esp+C8h] [ebp-18h]
  int v14; // [esp+CCh] [ebp-14h]

  LOWORD(v14) = a2;
  v13 = a3;
  if ( a2 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\research.cpp", 0x12D);
  }
  v4 = a1;
  v5 = 0;
  for ( i = 0; i < *a1; ++i )
  {
    if ( i != a1[(unsigned __int16)v14 + 0xEA7] && ((1 << v14) & (char)v4[0x25]) == 0 )
    {
      v7 = v5++;
      v12[v7] = i;
    }
    v4 = (unsigned __int16 *)((char *)v4 + 0x4B);
  }
  if ( v5 )
  {
    v8 = (unsigned __int16)v12[rand() % v5];
    v9 = (char *)a1 + 0x4B * (unsigned __int16)v8;
    v10 = (1 << v14) | v9[0x4B];
    v9[0x4A] |= 1 << v14;
    v9[0x4B] = v10;
    LOWORD(i) = v14;
    if ( (unsigned __int16)v14 == byte_104BEA )
    {
      LOWORD(i) = sub_55AEC(&V_Type3_stru_10AE70, 0x16, v8, v13);
    }
  }
  return i;
}
// 46A94: using guessed type __int16 var_E0[100];

//----- (00046BB0) --------------------------------------------------------
void __fastcall Q_ReadWriteResTree_sub_46BB0(P_ResTree a1, P_FileInfo a2, int read)
{
  T_ResTree v5; // [esp+0h] [ebp-1D80h] BYREF

  if ( read == TRUE )
  {
    Q_RESEARCH_CPP_LoadResTreeTxt_sub_46480(&v5, 0);
    Q_ReadFile_sub_1BF94(a2, &v5, sizeof(T_ResTree));
    qmemcpy(a1, &v5, 0x1D70u);
    HIWORD(a1->c) = HIWORD(v5.c);
  }
  else
  {
    Q_CFILE_CPP_dos_write_sub_1C098(&a2->fh, a1, sizeof(T_ResTree));
  }
}
// 46BE0: CONTAINING_RECORD: too small offset 7536 for struct 'T_ResTree'

//----- (00046C10) --------------------------------------------------------
void __fastcall __spoils<> sub_46C10(P_ResTree a1)
{
  Q_RESEARCH_CPP_LoadResTreeTxt_sub_46480(a1, 0);
}

//----- (00046C20) --------------------------------------------------------
int __fastcall Q_GetTurnsToComplete_sub_46C20(int cost, int done, int production)
{
  int result; // eax

  result = 0xFFFF;
  if ( production > 0 )
  {
    result = (cost - done - 1) / production + 1;
  }
  if ( result < 1 )
  {
    return 1;
  }
  return result;
}

//----- (00046C48) --------------------------------------------------------
void *__fastcall sub_46C48(int a1, char a2)
{
  void *v3; // eax
  int v5; // eax
  int v6; // eax
  int v7; // eax
  void *v8; // eax
  void *v9; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_96004);
    operator delete[](v3);
    return (void *)a1;
  }
  else
  {
    v5 = a1 + 0x143;
    *(_DWORD *)(v5 - 0x9C) = off_96018;
    v6 = sub_1A9E0(v5);
    v7 = ((int (__fastcall *)(int, _DWORD, int))locret_1B66C)(v6 - 0x98, 0, a1);
    v8 = (void *)sub_2C848(v7 - 0xAB, 1);
    v9 = v8;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v8);
    }
    return v9;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 96018: using guessed type int (*off_96018[5])();

//----- (00046CAC) --------------------------------------------------------
int __fastcall sub_46CAC(int a1, int edx0, int a3, int a4)
{
  int v5; // eax
  double v6; // st7
  int v7; // ebx
  int v8; // ebx
  FILE *v9; // eax
  FILE *v10; // esi
  int v11; // edx
  int v12; // ebx
  int v13; // eax
  int j; // eax
  int v15; // esi
  int v16; // edi
  int v17; // ecx
  int v18; // eax
  int i; // ebx
  int v20; // edx
  int v21; // edx
  int v22; // edx
  int v23; // ebp
  T_Vector3D *v24; // ebx
  int v25; // edi
  int v26; // ecx
  float v27; // [esp-4h] [ebp-124h]
  char v28[100]; // [esp+0h] [ebp-120h] BYREF
  char s[100]; // [esp+64h] [ebp-BCh] BYREF
  int v30; // [esp+C8h] [ebp-58h] BYREF
  int v31; // [esp+CCh] [ebp-54h] BYREF
  int v32; // [esp+D0h] [ebp-50h] BYREF
  int v33; // [esp+D4h] [ebp-4Ch]
  int v34; // [esp+D8h] [ebp-48h]
  int v35; // [esp+DCh] [ebp-44h]
  float *result; // [esp+E0h] [ebp-40h]
  int v37; // [esp+E4h] [ebp-3Ch]
  int v38; // [esp+E8h] [ebp-38h]
  int v39; // [esp+ECh] [ebp-34h]
  int v40; // [esp+F0h] [ebp-30h]
  int v41; // [esp+F4h] [ebp-2Ch]
  int v42; // [esp+F8h] [ebp-28h]
  int v43; // [esp+FCh] [ebp-24h]
  float a2; // [esp+100h] [ebp-20h]
  int v45; // [esp+104h] [ebp-1Ch]

  v5 = a1 + 0x143;
  *(_WORD *)(v5 + 0x898) = 0xFFFF;
  v39 = 0;
  do
  {
    *(_DWORD *)v5 = 0;
    v6 = (double)v39;
    *(_DWORD *)(v5 + 8) = 0;
    v7 = v39;
    *(float *)(v5 + 4) = v6;
    v8 = v7 + 1;
    v5 += 0xC;
    v39 = v8;
  }
  while ( v8 < 0x64 );
  sub_1B808((_DWORD *)(a1 + 0xAB), 0, v8, a4, 0x41F00000, 0x3F800000, 0x47C35000, 0x140);
  *(_DWORD *)(a1 + 0xDF) = 0;
  *(_DWORD *)(a1 + 0xE3) = 0;
  *(_DWORD *)(a1 + 0xE7) = 0xC3160000;
  v9 = Q_OpenFile_sub_1BB10("reswin.txt", 0);
  v10 = v9;
  if ( v9 )
  {
    fscanf(v9, "%d", &v30);
    if ( (unsigned __int16)V_ResTree.num == v30 )
    {
      v11 = a1 + 0x143;
      v12 = 0;
      while ( v12 < (unsigned __int16)V_ResTree.num )
      {
        v11 += 0xC;
        fscanf(v10, "%d %d %d", &v30, &v31, &v32);
        ++v12;
        v33 = v31;
        v13 = v32;
        *(float *)(v11 - 0xC) = (float)v30;
        v34 = v13;
        *(float *)(v11 - 8) = (float)v33;
        *(float *)(v11 - 4) = (float)v34;
      }
    }
    return fclose(v10);
  }
  else
  {
    if ( V_ResTreeTxtLoaded != 0xFFFFFFFF )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\reswin.cpp", 0x76);
    }
    memset(s, 0xFF, sizeof(s));
    v15 = 0;
    do
    {
      v16 = 0;
      v41 = 0xFFFFFFFF;
      v45 = 0;
      while ( v16 < (unsigned __int16)V_ResTree.num )
      {
        if ( (unsigned __int8)s[v16] == 0xFF )
        {
          v17 = v45;
          v18 = 0;
          for ( i = 0; i < 5; ++i )
          {
            v20 = V_ResTree.items[0].preq[v17];
            if ( v20 == 0xFF )
            {
              break;
            }
            v21 = (unsigned __int8)s[v20];
            if ( v21 == 0xFF )
            {
              v41 = 0;
              LOBYTE(v18) = 0xFF;
              break;
            }
            if ( v21 >= v18 )
            {
              v18 = v21 + 1;
              if ( v21 + 1 >= v15 )
              {
                v15 = v21 + 2;
              }
            }
            ++v17;
          }
          s[v16] = v18;
        }
        ++v16;
        v45 += 0x4B;
      }
    }
    while ( !v41 );
    memset(v28, 0, sizeof(v28));
    for ( j = 0; j < (unsigned __int16)V_ResTree.num; ++j )
    {
      v22 = (unsigned __int8)s[j];
      ++v28[v22];
    }
    v42 = 0;
    if ( v15 > 0 )
    {
      v38 = 0;
      result = (float *)(a1 + 0x143);
      v37 = 0xF0;
      do
      {
        v43 = 4;
        a2 = (float)v37;
        v23 = (unsigned __int8)v28[v42];
        if ( v42 % 2 && (unsigned __int8)v28[v42] > 2u )
        {
          --v23;
        }
        else if ( (unsigned __int8)v28[v42] > 1u )
        {
          v43 = 0x17;
        }
        v24 = (T_Vector3D *)result;
        v25 = 0;
        v26 = 0;
        v40 = v38;
        while ( v26 < (unsigned __int16)V_ResTree.num )
        {
          if ( (unsigned __int8)s[v26] == v42 )
          {
            v35 = 0xF * (v25 & 1) + v40;
            v24->y = (float)v35;
            v24->z = (float)v43;
            v27 = a2;
            v24->x = 0.0;
            Q_RotateVectorY_sub_532AC(v24, v27);
            v35 = 0x168 / v23;
            ++v25;
            v43 = 0x17;
            a2 = (double)(0x168 / v23) + a2;
          }
          ++v24;
          ++v26;
        }
        j = v42 + 1;
        v37 += 0x1E;
        v38 += 0x1E;
        v42 = j;
      }
      while ( v15 > j );
    }
  }
  return j;
}
// 105254: using guessed type int V_ResTreeTxtLoaded;
// 46CAC: using guessed type char s[100];
// 46CAC: using guessed type char var_120[100];

//----- (00047088) --------------------------------------------------------
int __fastcall sub_47088(int a1)
{
  int v1; // ebp
  int v2; // ecx
  int v3; // edi
  int v4; // esi
  int v5; // eax
  int v6; // edx
  int v7; // eax
  int result; // eax
  int v10; // [esp+4h] [ebp-20h]
  int v11; // [esp+8h] [ebp-1Ch]

  v11 = 0xFFFF;
  v1 = V_Mouse.x - *(_DWORD *)(a1 + 8);
  v2 = (unsigned __int16)V_ResTree.num - 1;
  v10 = V_Mouse.y - *(_DWORD *)(a1 + 0xC);
  if ( v2 >= 0 )
  {
    v3 = a1 + 2 * v2;
    while ( 1 )
    {
      v4 = *(unsigned __int16 *)(v3 + 0x913);
      if ( sub_4694C((int)&V_ResTree, v4, 0xFFFFFFFF) )
      {
        v5 = a1 + 2 * v4;
        v6 = *(__int16 *)(v5 + 0x5F3);
        if ( v1 > v6 - 0x19 && v1 < v6 + 0x19 )
        {
          v7 = *(__int16 *)(v5 + 0x6BB);
          if ( v7 - 0x19 < v10 && v7 + 0x19 > v10 )
          {
            break;
          }
        }
      }
      --v2;
      v3 -= 2;
      if ( v2 < 0 )
      {
        goto LABEL_12;
      }
    }
    v11 = v4;
  }
LABEL_12:
  result = v11;
  if ( (_WORD)v11 != *(_WORD *)(a1 + 0x9DB) )
  {
    *(_WORD *)(a1 + 0x9DB) = v11;
    dword_106FD0 = 0xFFFFFFFF;
    dword_106FD4 = 0xFFFFFFFF;
  }
  return result;
}
// 106FD0: using guessed type int dword_106FD0;
// 106FD4: using guessed type int dword_106FD4;

//----- (00047224) --------------------------------------------------------
unsigned int __fastcall sub_47224(int a1, unsigned __int16 a2, int a3, unsigned int a4)
{
  int v8; // edx
  char v9; // cl
  int v10; // eax
  UBYTE v11; // bh
  int v12; // edx
  char v13; // cl
  int v14; // eax
  UBYTE v15; // ch
  int v16; // eax
  UBYTE v17; // cl
  int v18; // eax
  int v19; // edx
  char v20; // cl
  int v21; // eax
  UBYTE v22; // bh
  int v23; // ebx
  int v24; // ebx
  int v25; // eax
  double v26; // st7
  int v27; // edx
  int v28; // edx
  WORD v29; // ax
  float v31; // [esp+10h] [ebp-14h]
  float v32; // [esp+10h] [ebp-14h]
  float v33; // [esp+14h] [ebp-10h]
  int v34; // [esp+14h] [ebp-10h]

  if ( a2 < 6u )
  {
    if ( a2 < 2u )
    {
      if ( a2 != 1 )
      {
        return sub_2F424(a1, a2, a3, a4);
      }
      Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFED8);
      Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEDC);
      Q_CACHE_CPP_GetShapeTable_sub_1B084(
        (unsigned int)&V_Type3_stru_10AE70.t13,
        (unsigned __int16)word_FFEBC[byte_104BEA]);
      Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEDE);
      dword_106FD8 = 0;
      dword_106FCC = 0xFFFFFFFF;
      dword_106FD0 = 0xFFFFFFFF;
      *(_WORD *)(a1 + 0x9DB) = 0xFFFF;
      sub_2F424(a1, 1, a3, a4);
      sub_56400(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0x3A, 0, 0, 0);
      return 0;
    }
    if ( a2 <= 2u )
    {
      v8 = 0;
      v9 = 1 << byte_104BEA;
      v10 = 0;
      while ( v8 < (unsigned __int16)V_ResTree.num )
      {
        v11 = V_ResTree.items[v10++].z2[1];
        ++v8;
        *((_BYTE *)&V_ResTree.num + v10 * 0x4B) = ~v9 & v11;
      }
      sub_2F424(a1, a2, a3, a4);
      sub_564C0(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 0xFFFFFFFF);
      return 0;
    }
    if ( a2 > 3u )
    {
      if ( !*(_DWORD *)(a1 + 0x35) )
      {
        return 0;
      }
      HIWORD(v28) = 0;
      sub_47088(a1);
      LOWORD(v28) = *(_WORD *)(a1 + 0x9DB);
      if ( (unsigned __int16)v28 == 0xFFFF
        || ((1 << byte_104BEA) & (char)V_ResTree.items[v28].z2[0]) != 0
        || !sub_4694C((int)&V_ResTree, v28, 0xFFFFFFFF) )
      {
        return 0;
      }
      Q_StartSample_sub_4FB90(&V_SoundSystem, 0);
      dword_106FD4 = 0xFFFFFFFF;
      v29 = *(_WORD *)(a1 + 0x9DB);
      dword_106FD0 = 0xFFFFFFFF;
      V_ResTree.a.w1[byte_104BEA] = v29;
      return 0;
    }
    if ( a4 < 0x2E )
    {
      if ( a4 < 0xD )
      {
        if ( a4 == 0xC && *(float *)V_Type3_stru_10AE70.j > dbl_92664 )
        {
          *(float *)V_Type3_stru_10AE70.j = *(float *)V_Type3_stru_10AE70.j * dbl_9266C;
          sub_47088(a1);
          return 0;
        }
        goto LABEL_60;
      }
      if ( a4 <= 0xD )
      {
        if ( *(float *)V_Type3_stru_10AE70.j < (double)flt_92658 )
        {
          *(float *)V_Type3_stru_10AE70.j = *(float *)V_Type3_stru_10AE70.j * dbl_9265C;
          sub_47088(a1);
          return 0;
        }
        goto LABEL_60;
      }
      if ( a4 >= 0x20 )
      {
        if ( a4 <= 0x20 )
        {
          if ( !V_NougatLfExists_dword_A0CFC )
          {
            goto LABEL_60;
          }
          v12 = 0;
          v13 = 1 << byte_104BEA;
          v14 = 0;
          while ( v12 < (unsigned __int16)V_ResTree.num )
          {
            v15 = V_ResTree.items[v14++].z2[0];
            ++v12;
            *((_BYTE *)&V_ResTreeTxtLoaded + v14 * 0x4B + 3) = v13 | v15;
          }
        }
        else
        {
          if ( a4 != 0x21 || !V_NougatLfExists_dword_A0CFC )
          {
            goto LABEL_60;
          }
          v19 = 0;
          v20 = 1 << byte_104BEA;
          v21 = 0;
          while ( v19 < (unsigned __int16)V_ResTree.num )
          {
            v22 = V_ResTree.items[v21++].z2[0];
            ++v19;
            *((_BYTE *)&V_ResTreeTxtLoaded + v21 * 0x4B + 3) = ~v20 & v22;
          }
        }
        v16 = byte_104BEA;
        V_ResTree.a.w1[byte_104BEA] = 0xFFFF;
        word_106FB4[v16] = 0;
        sub_47088(a1);
        return 0;
      }
    }
    else
    {
      if ( a4 > 0x2E )
      {
        if ( a4 < 0x49 )
        {
          if ( a4 < 0x32 )
          {
            goto LABEL_60;
          }
          if ( a4 <= 0x32 )
          {
            dword_106FC2 = ~dword_106FC2;
            Q_Proc_sub_5A320(0x14);
            dword_106FCC = 0xFFFFFFFF;
            dword_106FD4 = 0xFFFFFFFF;
            sub_47088(a1);
            return 0;
          }
          if ( a4 != 0x47 )
          {
            goto LABEL_60;
          }
        }
        else if ( a4 > 0x49 )
        {
          if ( a4 >= 0x4F && (a4 <= 0x4F || a4 == 0x51) )
          {
            v24 = *(_DWORD *)(a1 + 0xA7);
            *(_DWORD *)(a1 + 0xE3) = 0x49742400;
            (*(void (__fastcall **)(int, _DWORD))(v24 + 0xC))(a1, 0);
            sub_47088(a1);
            return 0;
          }
          goto LABEL_60;
        }
        v23 = *(_DWORD *)(a1 + 0xA7);
        *(_DWORD *)(a1 + 0xE3) = 0xC2C80000;
        (*(void (__fastcall **)(int, _DWORD))(v23 + 0xC))(a1, 0);
        sub_47088(a1);
        return 0;
      }
      if ( V_NougatLfExists_dword_A0CFC && (unsigned __int16)V_ResTree.a.w1[byte_104BEA] != 0xFFFF )
      {
        v17 = byte_104BEA;
        v18 = (unsigned __int16)V_ResTree.a.w1[byte_104BEA];
        V_ResTree.items[v18].z2[0] |= 1 << byte_104BEA;
        V_ResTree.a.w1[v17] = 0xFFFF;
        word_106FB4[v17] = 0;
        sub_47088(a1);
        return 0;
      }
    }
LABEL_60:
    sub_47088(a1);
    return 0;
  }
  if ( a2 <= 6u )
  {
    sub_567BC(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 8);
    sub_47088(a1);
    if ( (*(_DWORD *)(a1 + 0x3D) & *(_DWORD *)(a1 + 0x35) & *(_DWORD *)(a1 + 0x39)) == 0xFFFFFFFF )
    {
      (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0xC))();
    }
    return 0xFFFFFFFF;
  }
  if ( a2 < 0x32u )
  {
    if ( a2 <= 7u )
    {
      sub_56728((int)&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 4, 8, 0, 0);
      sub_47088(a1);
      if ( (*(_DWORD *)(a1 + 0x3D) & *(_DWORD *)(a1 + 0x35) & *(_DWORD *)(a1 + 0x39)) == 0xFFFFFFFF )
      {
        (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0x10))();
      }
      return 0xFFFFFFFF;
    }
    if ( a2 != 8 )
    {
      return sub_2F424(a1, a2, a3, a4);
    }
    goto LABEL_60;
  }
  if ( a2 <= 0x35u )
  {
    if ( a2 == 0x32 )
    {
      if ( (dword_106FD8 & 4) != 0 )
      {
        if ( (dword_106FD8 & 8) != 0 )
        {
          LOBYTE(dword_106FD8) = dword_106FD8 & 0xF7;
        }
        else
        {
          LOBYTE(dword_106FD8) = dword_106FD8 & 0xFB;
        }
      }
      else
      {
        LOBYTE(dword_106FD8) = dword_106FD8 & 0xF3 | 4;
      }
    }
    if ( a2 == 0x33 )
    {
      if ( (dword_106FD8 & 4) != 0 )
      {
        if ( (dword_106FD8 & 8) != 0 )
        {
          LOBYTE(dword_106FD8) = dword_106FD8 & 0xFB;
        }
        else
        {
          LOBYTE(dword_106FD8) = dword_106FD8 | 8;
        }
      }
      else
      {
        LOBYTE(dword_106FD8) = dword_106FD8 | 0xC;
      }
    }
    if ( a2 == 0x34 )
    {
      if ( (dword_106FD8 & 1) != 0 )
      {
        if ( (dword_106FD8 & 2) != 0 )
        {
          LOBYTE(dword_106FD8) = dword_106FD8 & 0xFD;
        }
        else
        {
          LOBYTE(dword_106FD8) = dword_106FD8 & 0xFE;
        }
      }
      else
      {
        LOBYTE(dword_106FD8) = dword_106FD8 & 0xFC | 1;
      }
    }
    if ( a2 == 0x35 )
    {
      if ( (dword_106FD8 & 1) != 0 )
      {
        if ( (dword_106FD8 & 2) != 0 )
        {
          LOBYTE(dword_106FD8) = dword_106FD8 & 0xFE;
        }
        else
        {
          LOBYTE(dword_106FD8) = dword_106FD8 | 2;
        }
      }
      else
      {
        LOBYTE(dword_106FD8) = dword_106FD8 | 3;
      }
    }
    if ( a3 != 4 )
    {
      return 0;
    }
    v25 = 4;
    if ( a2 == 0x34 || a2 == 0x35 )
    {
      v25 = 1;
    }
    sub_56728((int)&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 1, 0x38, v25, 0);
    return 0;
  }
  else
  {
    if ( a2 < 0x38u )
    {
      return sub_2F424(a1, a2, a3, a4);
    }
    if ( a2 > 0x38u )
    {
      if ( a2 != 0x3A )
      {
        return sub_2F424(a1, a2, a3, a4);
      }
      if ( (dword_106FD8 & 4) != 0 )
      {
        v33 = 3.0;
        if ( (dword_106FD8 & 8) != 0 )
        {
          v33 = -3.0;
        }
        *(float *)&v34 = v33 * *(float *)V_Type3_stru_10AE70.j;
        sub_53564((float *)(a1 + 0x11F), a2, a3, 0xFFFFFFFF, v34);
        dword_106FD4 = 0xFFFFFFFF;
      }
      if ( (dword_106FD8 & 1) != 0 )
      {
        v31 = -2.0;
        if ( (dword_106FD8 & 2) != 0 )
        {
          v31 = 2.0;
        }
        v32 = v31 * *(float *)V_Type3_stru_10AE70.j;
        v26 = *(float *)(a1 + 0xE3) + v32;
        dword_106FD4 = 0xFFFFFFFF;
        *(float *)(a1 + 0xE3) = v26;
      }
      if ( dword_106FD4 == 0xFFFFFFFF )
      {
        (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
        return 0;
      }
      return 0;
    }
    v27 = *(_DWORD *)(a1 + 0x41);
    dword_106FD8 &= ~a3;
    sub_567BC(&V_Type3_stru_10AE70, v27, 0xFFFFFFFF);
    return 0;
  }
}
// 92658: using guessed type float flt_92658;
// 9265C: using guessed type double dbl_9265C;
// 92664: using guessed type double dbl_92664;
// 9266C: using guessed type double dbl_9266C;
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// FFEBC: using guessed type __int16 word_FFEBC[7];
// 105254: using guessed type int V_ResTreeTxtLoaded;
// 106FB4: using guessed type __int16 word_106FB4[7];
// 106FC2: using guessed type int dword_106FC2;
// 106FCC: using guessed type int dword_106FCC;
// 106FD0: using guessed type int dword_106FD0;
// 106FD4: using guessed type int dword_106FD4;
// 106FD8: using guessed type int dword_106FD8;

//----- (00047A64) --------------------------------------------------------
int __fastcall sub_47A64(const void *a1, const void *a2)
{
  unsigned __int16 v2; // si
  BOOL v3; // edx

  v2 = *(_WORD *)a2;
  v3 = *(float *)(dword_106FDC + 4 * *(unsigned __int16 *)a2) > (double)*(float *)(dword_106FDC
                                                                                 + 4 * *(unsigned __int16 *)a1);
  if ( *(float *)(dword_106FDC + 4 * v2) < (double)*(float *)(dword_106FDC + 4 * *(unsigned __int16 *)a1) )
  {
    return 0xFFFFFFFF;
  }
  return v3;
}
// 106FDC: using guessed type int dword_106FDC;

//----- (00047ABC) --------------------------------------------------------
void __fastcall sub_47ABC(int a1)
{
  PANE *v2; // esi
  int v3; // ecx
  int v4; // edx
  int v5; // ebx
  float v6; // eax
  float *v7; // ecx
  int v8; // esi
  int v9; // edi
  int v10; // ebx
  int v11; // edx
  int v12; // eax
  char v13; // bl
  unsigned __int16 v14; // dx
  int v15; // edx
  int v16; // eax
  int v17; // esi
  int v18; // edi
  int v19; // ecx
  __int16 v20; // ax
  void *ShapeTable_sub_1B084; // eax
  LONG v22; // esi
  unsigned __int16 v23; // dx
  int v24; // eax
  void *v25; // eax
  int v26; // ebx
  char *sub_1CEA8; // eax
  int v28; // esi
  void *v29; // eax
  void *v30; // eax
  LONG v31; // ebx
  unsigned __int16 v32; // di
  void *v33; // eax
  int v34; // edi
  int v35; // esi
  int v36; // eax
  int v37; // edx
  int v38; // ebx
  int TurnsToComplete_sub_46C20; // eax
  int v40; // edx
  char *v41; // edi
  char *v42; // esi
  char v43; // al
  char v44; // al
  int v45; // eax
  char *v46; // eax
  int v47; // esi
  char *v48; // eax
  char *name; // eax
  int v50; // esi
  unsigned __int16 v51; // dx
  unsigned __int16 v52; // ax
  LONG v53; // ebp
  void *v54; // eax
  void *v55; // eax
  T_Gizmo *v56; // edi
  char *v57; // eax
  int v58; // esi
  int v59; // ebp
  void *v60; // esi
  char *v61; // eax
  unsigned __int16 v62; // di
  __int16 v63; // dx
  char *v64; // eax
  int v65; // esi
  unsigned __int16 v66; // dx
  void *v67; // eax
  void *v68; // eax
  int v69; // esi
  char *v70; // eax
  char *v71; // eax
  LONG v72; // [esp-20h] [ebp-170h]
  LONG v73; // [esp-1Ch] [ebp-16Ch]
  LONG v74; // [esp-1Ch] [ebp-16Ch]
  LONG v75; // [esp-1Ch] [ebp-16Ch]
  LONG v76; // [esp-18h] [ebp-168h]
  LONG v77; // [esp-18h] [ebp-168h]
  LONG v78; // [esp-18h] [ebp-168h]
  LONG v79; // [esp-Ch] [ebp-15Ch]
  __int16 v80; // [esp-Ch] [ebp-15Ch]
  __int16 v81; // [esp-Ch] [ebp-15Ch]
  LONG v82; // [esp-Ch] [ebp-15Ch]
  __int16 v83; // [esp-Ch] [ebp-15Ch]
  __int16 v84; // [esp-Ch] [ebp-15Ch]
  __int16 v85; // [esp-Ch] [ebp-15Ch]
  LONG v86; // [esp-8h] [ebp-158h]
  LONG v87; // [esp-8h] [ebp-158h]
  LONG v88; // [esp-8h] [ebp-158h]
  LONG v89; // [esp-8h] [ebp-158h]
  LONG v90; // [esp-8h] [ebp-158h]
  char *v91; // [esp-8h] [ebp-158h]
  int v92; // [esp-4h] [ebp-154h]
  UBYTE *v93; // [esp-4h] [ebp-154h]
  LONG v94; // [esp-4h] [ebp-154h]
  LONG v95; // [esp-4h] [ebp-154h]
  LONG v96; // [esp-4h] [ebp-154h]
  char *v97; // [esp-4h] [ebp-154h]
  char *v98; // [esp-4h] [ebp-154h]
  char v99[100]; // [esp+0h] [ebp-150h]
  char s[80]; // [esp+64h] [ebp-ECh] BYREF
  PANE v101; // [esp+B4h] [ebp-9Ch] BYREF
  PANE v102; // [esp+C8h] [ebp-88h] BYREF
  int v103[2]; // [esp+DCh] [ebp-74h] BYREF
  int v104; // [esp+E4h] [ebp-6Ch]
  LONG hotX; // [esp+E8h] [ebp-68h] BYREF
  LONG hotY; // [esp+ECh] [ebp-64h] BYREF
  float v107; // [esp+F0h] [ebp-60h]
  int v108; // [esp+F4h] [ebp-5Ch]
  int a2; // [esp+F8h] [ebp-58h]
  int v110; // [esp+FCh] [ebp-54h]
  int v111; // [esp+100h] [ebp-50h]
  float *v112; // [esp+104h] [ebp-4Ch]
  float v113; // [esp+108h] [ebp-48h]
  LONG x_scale; // [esp+10Ch] [ebp-44h]
  int v115; // [esp+110h] [ebp-40h]
  int v116; // [esp+114h] [ebp-3Ch]
  int v117; // [esp+118h] [ebp-38h]
  int v118; // [esp+11Ch] [ebp-34h]
  int v119; // [esp+120h] [ebp-30h]
  int v120; // [esp+124h] [ebp-2Ch]
  LONG v121; // [esp+128h] [ebp-28h]
  int v122; // [esp+12Ch] [ebp-24h]
  PANE *pane; // [esp+130h] [ebp-20h]
  int v124; // [esp+134h] [ebp-1Ch]
  LONG shape_number; // [esp+138h] [ebp-18h]

  v101 = *(PANE *)(a1 + 4);
  v2 = (PANE *)(a1 + 4);
  VFX_pane_wipe((PANE *)(a1 + 4), 0);
  sub_552CC(&V_Type3_stru_10AE70, v2);
  v3 = a1;
  v4 = 0;
  v113 = *(float *)(a1 + 0x147);
  v107 = v113;
  for ( a2 = 0; ; ++a2 )
  {
    v5 = a2;
    if ( (unsigned __int16)V_ResTree.num <= a2 )
    {
      break;
    }
    v4 = (unsigned __int16)a2;
    if ( sub_4694C((int)&V_ResTree, a2, 0xFFFFFFFF) )
    {
      if ( *(float *)(v3 + 0x147) < (double)v107 )
      {
        v107 = *(float *)(v3 + 0x147);
      }
      if ( *(float *)(v3 + 0x147) > (double)v113 )
      {
        v113 = *(float *)(v3 + 0x147);
      }
    }
    v3 += 0xC;
  }
  if ( *(float *)(a1 + 0xE3) >= (double)v107 )
  {
    if ( *(float *)(a1 + 0xE3) <= (double)v113 )
    {
      goto LABEL_14;
    }
    v6 = v113;
  }
  else
  {
    v6 = v107;
  }
  *(float *)(a1 + 0xE3) = v6;
LABEL_14:
  sub_1B864(a1 + 0xAB, v4, v5, v3);
  a2 = 0;
  v7 = (float *)(a1 + 0x143);
  v8 = a1 + 0x6BB;
  v9 = a1 + 0x5F3;
  v112 = (float *)(a1 + 0xEB);
  v117 = a1;
  v115 = a1;
  while ( (unsigned __int16)V_ResTree.num > a2 )
  {
    v103[0] = 0;
    v103[1] = 0;
    v104 = 0;
    sub_53384(v7, v112, (float *)v103);
    v92 = v8;
    v10 = a2;
    v7 += 3;
    v8 += 2;
    *(_DWORD *)(v115 + 0x783) = v104;
    v11 = v117;
    sub_533D4((float *)v103, *(float *)(a1 + 0xD3), 0xEB, 0xF0, v9, v92);
    *(_WORD *)(v11 + 0x913) = a2;
    v9 += 2;
    a2 = v10 + 1;
    v117 = v11 + 2;
    v115 += 4;
  }
  dword_106FDC = a1 + 0x783;
  qsort((void *)(a1 + 0x913), (unsigned __int16)V_ResTree.num, 2u, sub_47A64);
  v12 = a1;
  a2 = 0;
  while ( (unsigned __int16)V_ResTree.num > a2 )
  {
    v13 = a2;
    v14 = *(_WORD *)(v12 + 0x913);
    v12 += 2;
    ++a2;
    v99[v14] = v13;
  }
  v124 = (unsigned __int16)V_ResTree.a.w1[byte_104BEA];
  a2 = 0;
  pane = (PANE *)(a1 + 4);
  v116 = a1;
  while ( (unsigned __int16)V_ResTree.num > a2 )
  {
    v121 = *(unsigned __int16 *)(v116 + 0x913);
    if ( sub_4694C((int)&V_ResTree, v121, 0xFFFFFFFF) )
    {
      v118 = (int)((*(float *)(a1 + 4 * v121 + 0x783) + *(float *)(a1 + 0xE7)) * flt_92697);
      if ( v118 >= (int)0xFFFFFFFD )
      {
        if ( v118 > 3 )
        {
          v118 = 3;
        }
      }
      else
      {
        v118 = 0xFFFFFFFD;
      }
      v93 = (*V_Type6_stru_D8654.hazeTables)[v118 + 4];
      v118 += 3;
      VFX_shape_lookaside(v93);
      v119 = 0;
      if ( ((1 << byte_104BEA) & (char)V_ResTree.items[v121].z2[0]) != 0 )
      {
        v119 = 0x14;
      }
      else if ( (unsigned __int16)v124 == v121 )
      {
        v15 = v121 ^ (unsigned __int16)v124;
        LOBYTE(v15) = byte_104BEA;
        v16 = 0x12 * (unsigned __int16)word_106FB4[v15] / V_ResTree.items[v121].cost + 2;
        v119 = v16;
        if ( v16 >= (int)0xFFFFFFEF )
        {
          if ( v16 > 0x11 )
          {
            v119 = 0x11;
          }
        }
        else
        {
          v119 = 0xFFFFFFEF;
        }
      }
      v17 = 0x4B * v121;
      v120 = 2 * v121 + a1;
      v18 = 0;
      v122 = 4 * v121 + a1;
      while ( 1 )
      {
        v19 = V_ResTree.items[0].preq[v17];
        if ( v19 == 0xFF )
        {
          break;
        }
        if ( sub_4694C((int)&V_ResTree, V_ResTree.items[0].preq[v17], 0xFFFFFFFF) )
        {
          v110 = (int)(((*(float *)(v122 + 0x783) + *(float *)(a1 + 4 * v19 + 0x783)) * flt_9269B + *(float *)(a1 + 0xE7))
                     * flt_92697);
          if ( v110 <= 3 )
          {
            if ( v110 < (int)0xFFFFFFFD )
            {
              v110 = 0xFFFFFFFD;
            }
          }
          else
          {
            v110 = 3;
          }
          v20 = 0x6B - v110;
          if ( v19 == *(unsigned __int16 *)(a1 + 0x9DB) )
          {
            v20 = 0xF3;
          }
          VFX_line_draw(
            pane,
            *(__int16 *)(v120 + 0x5F3),
            *(__int16 *)(v120 + 0x6BB) - 0x1B,
            *(__int16 *)(a1 + 2 * v19 + 0x5F3),
            *(__int16 *)(a1 + 2 * v19 + 0x6BB) + 0x1B,
            0,
            v20);
          ++v18;
          ++v17;
          if ( v18 >= 5 )
          {
            break;
          }
        }
        else
        {
          ++v18;
          ++v17;
          if ( v18 >= 5 )
          {
            break;
          }
        }
      }
      if ( v119 )
      {
        v119 = (v119 << 0x10) / 0x14;
        v86 = v119;
        v79 = v119;
        v76 = *(__int16 *)(a1 + 2 * v121 + 0x6BB);
        v73 = *(__int16 *)(a1 + 2 * v121 + 0x5F3);
        v72 = v121;
        ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                                 (unsigned int)&V_Type3_stru_10AE70.t13,
                                 (unsigned __int16)word_FFEDE);
        VFX_shape_transform(pane, ShapeTable_sub_1B084, v72, v73, v76, V_BigBuffer, 0, v79, v86, 1);
      }
      v22 = 1;
      if ( (unsigned __int16)v124 == v121 && ((1 << byte_104BEA) & (char)V_ResTree.items[v121].z2[0]) == 0 )
      {
        v22 = 0;
      }
      if ( ((1 << byte_104BEA) & (char)V_ResTree.items[v121].z2[1]) != 0 )
      {
        v22 = 3;
      }
      if ( *(unsigned __int16 *)(a1 + 0x9DB) == v121 )
      {
        v22 = 2;
      }
      v23 = sub_1B270(&V_Type3_stru_10AE70.t13, "data\\resring.shp", 0xFFFFFFFF);
      v24 = a1 + 2 * v121;
      v94 = *(__int16 *)(v24 + 0x6BB);
      v87 = *(__int16 *)(v24 + 0x5F3);
      v25 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, v23);
      if ( v22 == 2 )
      {
        VFX_shape_draw(pane, v25, 2, v87, v94);
      }
      else
      {
        VFX_shape_translate_draw(pane, v25, v22, v87, v94);
      }
    }
    v116 += 2;
    ++a2;
  }
  v26 = dword_106FD0;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = *(_DWORD *)(a1 + 4);
  V_Type3_stru_10AE70.rect.x1 = *(_DWORD *)(a1 + 8);
  V_Type3_stru_10AE70.rect.y1 = *(_DWORD *)(a1 + 0xC);
  V_Type3_stru_10AE70.rect.x2 = *(_DWORD *)(a1 + 0x10);
  V_Type3_stru_10AE70.rect.y2 = *(_DWORD *)(a1 + 0x14);
  if ( v26 == 0xFFFFFFFF )
  {
    v101.y1 = 0x1AA;
    v101.x0 = 0x1E5;
    v101.y0 = 7;
    v101.x1 = 0x278;
    VFX_pane_wipe(&v101, 0);
    sub_552CC(&V_Type3_stru_10AE70, &v101);
    shape_number = 0xFFFF;
    if ( (unsigned __int16)v124 != 0xFFFF )
    {
      shape_number = (unsigned __int16)v124;
    }
    if ( *(unsigned __int16 *)(a1 + 0x9DB) != 0xFFFF )
    {
      shape_number = *(unsigned __int16 *)(a1 + 0x9DB);
    }
    if ( (unsigned __int16)shape_number != 0xFFFF )
    {
      *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = v101;
      v108 = 0xFFFFFFFF;
      v102 = v101;
      if ( (_WORD)shape_number == (_WORD)v124 )
      {
        if ( (_WORD)shape_number != *(_WORD *)(a1 + 0x9DB) )
        {
          v108 = 4 * V_Game.races[byte_104BEA].Unknown_02 + 0x13;
        }
        v80 = v108;
        sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7A);// 122: "Current Project:"
        sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0xA, sub_1CEA8, 2, v80, 0xFFFFFFFF, 0x82);
      }
      v28 = (unsigned __int16)shape_number;
      v111 = 0x46;
      v102.y1 = 0x78;
      v29 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEDE);
      Q_GSYSTEM_CPP_sub_2BC40(&v102, v29, (unsigned __int16)v28, &hotX, &hotY);
      v95 = hotY;
      v88 = hotX;
      v30 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEDE);
      VFX_shape_draw(&v102, v30, (unsigned __int16)v28, v88, v95);
      v31 = 1;
      v32 = sub_1B270(&V_Type3_stru_10AE70.t13, "data\\resring.shp", 0xFFFFFFFF);
      if ( (_WORD)v28 == (_WORD)v124 && ((1 << byte_104BEA) & (char)V_ResTree.items[v28].z2[0]) == 0 )
      {
        v31 = 0;
      }
      if ( ((1 << byte_104BEA) & (char)V_ResTree.items[(unsigned __int16)shape_number].z2[1]) != 0 )
      {
        v31 = 3;
      }
      if ( (_WORD)shape_number == *(_WORD *)(a1 + 0x9DB) )
      {
        v31 = 2;
      }
      v96 = hotY;
      v89 = hotX;
      v33 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, v32);
      VFX_shape_draw(&v102, v33, v31, v89, v96);
      v35 = (unsigned __int16)shape_number;
      v111 += 0x19;
      v34 = v111;
      v36 = sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, v111, V_ResTree.items[v35].name, 2, v108, 0xFFFFFFFF, 0x82);
      v37 = (char)V_ResTree.items[v35].z2[0];
      v111 = v34 + v36;
      if ( ((1 << byte_104BEA) & v37) == 0 )
      {
        v38 = sub_469F0((int)&V_ResTree, byte_104BEA);
        TurnsToComplete_sub_46C20 = Q_GetTurnsToComplete_sub_46C20(
                                      V_ResTree.items[v35].cost,
                                      (unsigned __int16)word_106FB4[byte_104BEA],
                                      v38);
        v40 = TurnsToComplete_sub_46C20;
        if ( TurnsToComplete_sub_46C20 == 0xFFFF )
        {
          v41 = s;
          v42 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7B);// 123: "(No Progress)"
          do
          {
            v43 = *v42;
            *v41 = *v42;
            if ( !v43 )
            {
              break;
            }
            v44 = v42[1];
            v42 += 2;
            v41[1] = v44;
            v41 += 2;
          }
          while ( v44 );
        }
        else
        {
          if ( TurnsToComplete_sub_46C20 == 1 )
          {
            v45 = 0x1C;                                // 28: ""
          }
          else
          {
            v45 = 0x1D;                                // 29: "s"
          }
          v97 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v45);
          v46 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7C);// 124: "(%d day%s)"
          sprintf(s, v46, v40, v97);
        }
        sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, v111, s, 2, v108, 0xFFFFFFFF, 0x82);
      }
      v47 = 0x8E;
      for ( a2 = 0; a2 < 0x27; ++a2 )
      {
        if ( V_PlanetItems.item[a2].resReq == (unsigned __int16)shape_number )
        {
          if ( v47 == 0x8E )
          {
            v81 = v108;
            v48 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7D);// 125: "Allows"
            v47 = sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0x8E, v48, 2, v81, 0xFFFFFFFF, 0x82) + 0x98;
          }
          name = V_PlanetItems.item[a2].name;
          if ( (_BYTE)a2 == 0x17 )
          {
            name = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7E);// 126: "Ships: Small and Medium Hulls"
          }
          v50 = sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, v47, name, 2, v108, 0xFFFFFFFF, 0x82) + v47;
          x_scale = (LONG)sub_10000;
          v102.y0 = v50 + 1;
          v51 = word_FFEDC;
          v102.y1 = v50 + 0x48;
          v52 = a2;
          if ( (_BYTE)a2 == 0x17 )
          {
            x_scale = 0x8000;
            v51 = word_FFEBC[byte_104BEA];
            v52 = 0;
          }
          v53 = v52;
          v54 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, v51);
          Q_GSYSTEM_CPP_sub_2BC40(&v102, v54, v53, &hotX, &hotY);
          v90 = x_scale;
          v82 = x_scale;
          v77 = hotY;
          v74 = hotX;
          v55 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, v51);
          v47 = v50 + 0x48;
          VFX_shape_transform(&v102, v55, v53, v74, v77, V_BigBuffer, 0, v82, v90, 0);
        }
      }
      v56 = V_Gizmos;
      for ( a2 = 0; a2 < 0x4C; ++a2 )
      {
        if ( (unsigned __int8)V_Gizmos[a2].resReq == (unsigned __int16)shape_number )
        {
          if ( v47 == 0x8E )
          {
            v83 = v108;
            v57 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7D);// 125: "Allows"
            v47 = sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0x8E, v57, 2, v83, 0xFFFFFFFF, 0x82) + 0x98;
          }
          v58 = sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, v47, v56->name, 2, v108, 0xFFFFFFFF, 0x82) + v47;
          v102.y0 = v58 + 1;
          v59 = v58 + 0x48;
          v102.y1 = v58 + 0x48;
          v60 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                  (unsigned int)&V_Type3_stru_10AE70.t13,
                  (unsigned __int16)word_FFED8);
          Q_GSYSTEM_CPP_sub_2BC40(&v102, v60, a2, &hotX, &hotY);
          VFX_shape_draw(&v102, v60, a2, hotX, hotY);
          v47 = v59;
        }
        ++v56;
      }
      if ( (unsigned __int16)shape_number == 0x13 || (unsigned __int16)shape_number == 0x1F )
      {
        if ( v47 == 0x8E )
        {
          v84 = v108;
          v61 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7D);// 125: "Allows"
          v47 = sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0x8E, v61, 2, v84, 0xFFFFFFFF, 0x82) + 0x98;
        }
        v62 = 2;
        v63 = shape_number;
        v64 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x7F);// 127: "Large Ship Hull"
        if ( v63 == 0x1F )
        {
          v62 = 3;
          v64 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x80);// 128: "Gigantic Ship Hull"
        }
        v65 = sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, v47, v64, 2, v108, 0xFFFFFFFF, 0x82) + v47;
        v102.y0 = v65 + 1;
        v66 = word_FFEBC[byte_104BEA];
        v102.y1 = v65 + 0x48;
        v67 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, v66);
        Q_GSYSTEM_CPP_sub_2BC40(&v102, v67, v62, &hotX, &hotY);
        v78 = hotY;
        v75 = hotX;
        v68 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, v66);
        VFX_shape_transform(&v102, v68, v62, v75, v78, V_BigBuffer, 0, 0x8000, 0x8000, 0);
      }
    }
    dword_106FD0 = 0;
  }
  v69 = dword_106FCC;
  if ( dword_106FCC == 0xFFFFFFFF )
  {
    v101.x0 = 7;
    v101.x1 = 0x1DC;
    v101.y1 = 0x25;
    v101.y0 = 7;
    sub_552CC(&V_Type3_stru_10AE70, &v101);
    Q_WINMGR_CPP_sub_53E38(&v101, 3, 3, byte_104BEA);
    v70 = (char *)&unk_92696;
    if ( dword_106FC2 == v69 )
    {
      v70 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x81);  // 129: "(Self Managed)"
    }
    v98 = v70;
    v91 = V_SpecNames[V_Game.races[byte_104BEA].Unknown_01];
    v71 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x82);    // 130: "%s Knowledge %s"
    sprintf(s, v71, v91, v98);
    v85 = 4 * V_Game.races[byte_104BEA].Unknown_02 + 0x13;
    *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = v101;
    sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0, s, 3, v85, 0xFF, 0);
    dword_106FCC = 0;
  }
  dword_106FD4 = 0;
}
// 10000: using guessed type void __noreturn sub_10000();
// 92697: using guessed type float flt_92697;
// 9269B: using guessed type float flt_9269B;
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEBC: using guessed type __int16 word_FFEBC[7];
// 106FB4: using guessed type __int16 word_106FB4[7];
// 106FC2: using guessed type int dword_106FC2;
// 106FCC: using guessed type int dword_106FCC;
// 106FD0: using guessed type int dword_106FD0;
// 106FD4: using guessed type int dword_106FD4;
// 106FDC: using guessed type int dword_106FDC;
// 47ABC: using guessed type char var_150[100];

//----- (00048B14) --------------------------------------------------------
int __fastcall sub_48B14(int a1, unsigned int count, int a3)
{
  void *v5; // edx

  v5 = (void *)(a1 + 0xAB);
  if ( a3 == 0xFFFFFFFF )
  {
    return Q_ReadFile_sub_1BF94((P_FileInfo)count, v5, 0x98u);
  }
  else
  {
    return Q_CFILE_CPP_dos_write_sub_1C098((int *)count, v5, 0x98u);
  }
}

//----- (00048B40) --------------------------------------------------------
int __fastcall sub_48B40(T_TypeA2 *a1, int a2, int a3, int a4)
{
  _DWORD *v4; // eax
  int v5; // edx

  Q_A2_sub_2C830(a1);
  v4 = sub_1B4F0(&a1[1].a1.magic12345678);
  v5 = _wcpp_2_ctor_array_(v4 + 0x26, 0x64, &unk_959D8) - 0x143;
  *(_DWORD *)(v5 + 0xA7) = off_96018;
  sub_46CAC(v5, v5, (int)&unk_959D8, a4);
  return v5;
}
// 77394: using guessed type int __fastcall _wcpp_2_ctor_array_(_DWORD, _DWORD, _DWORD);
// 96018: using guessed type int (*off_96018[5])();

//----- (00048B90) --------------------------------------------------------
void __fastcall sub_48B90(P_Ship pShip)
{
  pShip->Unknown_6C = 0;
  pShip->Unknown_70 = 0;
  pShip->Unknown_74 = 0;
  pShip->Unknown_78 = 0;
  pShip->Unknown_7C = 0;
  pShip->Unknown_80 = 0;
  pShip->Unknown_9E = 0;
  pShip->Unknown_A2 = 0;
  pShip->Unknown_A6 = 0;
  sub_48C5C(pShip, 0);
}

//----- (00048C5C) --------------------------------------------------------
void __fastcall sub_48C5C(P_Ship pShip, char a2)
{
  sub_48EAC(pShip);
  sub_49148(pShip, a2);
}

//----- (00048C84) --------------------------------------------------------
void Q_SHIP_CPP_LoadGizmosTxt_sub_48C84()
{
  FILE *fp; // esi
  MACRO_VFX_BOOL found; // ecx
  P_Gizmo pGizmo; // edx
  int i; // ebp
  signed int v4; // ebx
  unsigned int v5; // kr04_4
  P_Gizmo v6; // eax
  int zero; // eax
  char buf[200]; // [esp+0h] [ebp-104h] BYREF
  char val1; // [esp+C8h] [ebp-3Ch] BYREF
  int val2; // [esp+CCh] [ebp-38h] BYREF
  int val3; // [esp+D0h] [ebp-34h] BYREF
  int val4; // [esp+D4h] [ebp-30h] BYREF
  int val5; // [esp+D8h] [ebp-2Ch] BYREF
  int val6; // [esp+DCh] [ebp-28h] BYREF
  int val7; // [esp+E0h] [ebp-24h] BYREF
  int val8; // [esp+E4h] [ebp-20h] BYREF
  int val9; // [esp+E8h] [ebp-1Ch] BYREF

  fp = Q_OpenFile_sub_1BB10("gizmos.txt", 0);
  if ( fp )
  {
    found = FALSE;
    do
    {
      fgets(buf, 200, fp);
      if ( buf[0] == '#' )
      {
        found = TRUE;
      }
    }
    while ( found == FALSE );
    pGizmo = V_Gizmos;
    for ( i = 0; i < 76; ++i )
    {
      fscanf(fp, "%s", pGizmo);
      v4 = 0;
      v5 = strlen(pGizmo->name) + 1;
      if ( (int)(v5 - 1) > 0 )
      {
        v6 = pGizmo;
        do
        {
          if ( v6->name[0] == '^' )
          {
            v6->name[0] = ' ';
          }
          ++v4;
          v6 = (P_Gizmo)((char *)v6 + 1);
        }
        while ( v4 < (int)(v5 - 1) );
      }
      fscanf(fp, "%d %d %d %d %d %d %d %d %d", &val1, &val2, &val3, &val4, &val5, &val6, &val7, &val8, &val9);
      pGizmo->cat = val1;
      pGizmo->power = val2;
      pGizmo->range = val3;
      pGizmo->level = val4;
      pGizmo->numUses = val5;
      pGizmo->industry = val6;
      pGizmo->special1 = val7;
      pGizmo->special2 = val8;
      pGizmo->resReq = val9;
      fscanf(fp, "%d", &val9);
      pGizmo->flags = 0;
      while ( val9 != 0xFF )
      {
        LOWORD(v4) = pGizmo->flags;
        v4 |= 1 << val9;
        pGizmo->flags = v4;
        fscanf(fp, "%d", &val9);
      }
      pGizmo->generatorPower = 0;
      zero = pGizmo->generatorPower;
      pGizmo->scannerRangePerTurn = zero;
      pGizmo->driveMaxDistance = zero;
      pGizmo->Unknown_5A = zero;
      pGizmo->shieldStrength = zero;
      pGizmo->weaponDamage = zero;
      switch ( pGizmo->cat )
      {
        case ASCEND_GIZMO_CAT_WEAPON:
          pGizmo->weaponDamage = pGizmo->level;
          break;
        case ASCEND_GIZMO_CAT_SHIELD:
          pGizmo->shieldStrength = pGizmo->level;
          break;
        case ASCEND_GIZMO_CAT_DRIVE:
          pGizmo->driveMaxDistance = pGizmo->level;
          break;
        case ASCEND_GIZMO_CAT_SCANNER:
          pGizmo->scannerRangePerTurn = pGizmo->level;
          break;
        case ASCEND_GIZMO_CAT_GENERATOR:
          pGizmo->generatorPower = pGizmo->power;
          break;
        default:
          break;
      }
      ++pGizmo;
    }
    fclose(fp);
  }
  else
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\ship.cpp", 0xBE);
  }
}
// 48C84: using guessed type char buf[200];

//----- (00048EAC) --------------------------------------------------------
void __fastcall sub_48EAC(P_Ship pShip)
{
  P_Ship v1; // ebx
  T_Gizmo *v2; // ebx
  int v3; // ecx
  T_Gizmo *v4; // edi
  char *sub_1CEA8; // esi
  char v6; // al
  char v7; // al
  int i; // ebp
  char v9; // dl
  int v10; // esi
  int v11; // ebx
  char v12; // di
  int v13; // ecx
  char v14; // dl
  int v15; // ebp
  int v16; // esi
  double v17; // st7
  int v18; // ebx
  int v19; // [esp+0h] [ebp-3Ch]
  int v20; // [esp+4h] [ebp-38h]
  int v21; // [esp+Ch] [ebp-30h]
  int v22; // [esp+10h] [ebp-2Ch]
  char v23; // [esp+14h] [ebp-28h]
  float v24; // [esp+1Ch] [ebp-20h]
  float v25; // [esp+1Ch] [ebp-20h]
  float v26; // [esp+20h] [ebp-1Ch]

  pShip->Unknown_15E = 0;
  pShip->Unknown_0 = 0;
  pShip->Unknown_4 = 0;
  pShip->Unknown_8 = 0;
  pShip->Unknown_10 = 0;
  pShip->Unknown_20 = 0;
  pShip->Unknown_24 = 0;
  pShip->Unknown_18 = 0;
  pShip->Unknown_1C = 0;
  pShip->Unknown_30 = 0;
  pShip->Unknown_28 = 0;
  pShip->Unknown_2C = 0;
  pShip->name[0] = 0;
  pShip->raceIndex = 0xFFFF;
  pShip->Unknown_58 = 0;
  pShip->Unknown_90 = 0;
  pShip->Unknown_8C = 1;
  pShip->Unknown_5D = 0;
  pShip->Unknown_5E = 0;
  pShip->Unknown_88 = pShip->Unknown_90;
  v1 = pShip;
  pShip->Unknown_98 = pShip->Unknown_8C;
  do
  {
    v1 = (P_Ship)((char *)v1 + 7);
    BYTE2(v1->Unknown_A2) = 0xFF;
    *(_WORD *)((char *)&v1->Unknown_A2 + 3) = 0;
    *(int *)((char *)&v1->Unknown_A6 + 1) = 0;
  }
  while ( v1 != (P_Ship)&pShip->Unknown_AA[5] );
  if ( !dword_10701C )
  {
    v2 = &V_Gizmos[76];
    v3 = 0x83;                                         // 131: "Small"
    do
    {
      v4 = v2;
      sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v3);
      do
      {
        v6 = *sub_1CEA8;
        v4->name[0] = *sub_1CEA8;
        if ( !v6 )
        {
          break;
        }
        v7 = sub_1CEA8[1];
        sub_1CEA8 += 2;
        v4->name[1] = v7;
        v4 = (T_Gizmo *)((char *)v4 + 2);
      }
      while ( v7 );
      v2 = (T_Gizmo *)((char *)v2 + 0x14);
      ++v3;
    }
    while ( v2 != (T_Gizmo *)((char *)&V_Gizmos[76].special2 + 2) );
    Q_SHIP_CPP_LoadGizmosTxt_sub_48C84();
    word_107018 = 0;
    for ( i = 0; i < 14; ++i )
    {
      v9 = 1;
      v10 = (unsigned __int8)byte_969B8[i];
      v11 = 0;
      if ( byte_969B8[i] )
      {
        v12 = byte_969C8[i];
        do
        {
          if ( ((unsigned __int8)v9 & (unsigned __int8)v12) != 0 )
          {
            ++word_107018;
          }
          ++v11;
          v9 *= 2;
        }
        while ( v11 < v10 );
      }
    }
    v22 = 0;
    v21 = 0;
    do
    {
      v13 = *(__int16 *)((char *)&off_9699E + v21 + 2);
      v24 = (float)word_107018;
      v20 = 0;
      v25 = v24 / (double)(v13 - 1);
      v19 = 0;
      v26 = v25;
      do
      {
        if ( v13 <= 0 )
        {
          break;
        }
        v14 = 1;
        v15 = (unsigned __int8)byte_969B8[v20];
        v16 = 0;
        if ( byte_969B8[v20] )
        {
          v23 = byte_969C8[v20];
          do
          {
            if ( ((unsigned __int8)v23 & (unsigned __int8)v14) != 0 )
            {
              v17 = v26 + 1.0;
              v18 = v22 + v19;
              v26 = v17;
              if ( v17 < v25 )
              {
                if ( v13 == 1 && v25 + flt_926DB < v26 )
                {
                  v13 = 0;
                  byte_106FE0[v18] |= v14;
                }
              }
              else
              {
                --v13;
                v26 = v26 - v25;
                byte_106FE0[v18] |= v14;
              }
            }
            ++v16;
            v14 *= 2;
          }
          while ( v16 < v15 );
        }
        v19 += 4;
        ++v20;
      }
      while ( v20 < 0xE );
      v21 += 2;
      ++v22;
    }
    while ( v22 < 4 );
    dword_10701C = 0xFFFFFFFF;
  }
}
// 926DB: using guessed type float flt_926DB;
// 9699E: using guessed type void *off_9699E;
// 107018: using guessed type __int16 word_107018;
// 10701C: using guessed type int dword_10701C;

//----- (00049148) --------------------------------------------------------
void __fastcall sub_49148(P_Ship pShip, char a2)
{
  char *name; // edi
  char *v4; // esi
  char v5; // al
  char v6; // al
  int raceIndex; // edx

  pShip->Unknown_AA[0] = a2;
  if ( a2 >= 4 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\ship.cpp", 0x131);
  }
  pShip->Unknown_15A = *((__int16 *)&off_9699E + pShip->Unknown_AA[0] + 1);
  if ( !pShip->name[0] || pShip->raceIndex != byte_104BEA )
  {
    name = pShip->name;
    v4 = &V_Gizmos[0x4C].name[0x14 * pShip->Unknown_AA[0]];
    do
    {
      v5 = *v4;
      *name = *v4;
      if ( !v5 )
      {
        break;
      }
      v6 = v4[1];
      v4 += 2;
      name[1] = v6;
      name += 2;
    }
    while ( v6 );
  }
  raceIndex = pShip->raceIndex;
  pShip->Unknown_8C = 0xA * (pShip->Unknown_AA[0] + 1);
  pShip->Unknown_14 = 0;
  if ( V_Game.races[raceIndex].Unknown_19D == 1 )
  {
    pShip->Unknown_8C *= 2;
  }
  pShip->Unknown_98 = pShip->Unknown_8C;
}
// 9699E: using guessed type void *off_9699E;

//----- (000492AC) --------------------------------------------------------
unsigned int __fastcall sub_492AC(_DWORD *a1, char a2, int a3)
{
  char v3; // ch

  if ( a3 > *(_DWORD *)((char *)a1 + 0x15A) )
  {
    return 0;
  }
  v3 = *((_BYTE *)a1 + 7 * a3 + 0xAB);
  if ( a2 == v3 )
  {
    return 0;
  }
  if ( v3 == (char)0xFF )
  {
    ++*(_DWORD *)((char *)a1 + 0x15E);
  }
  *((_BYTE *)a1 + 7 * a3 + 0xAB) = a2;
  sub_496E0(a1);
  return 0xFFFFFFFF;
}

//----- (000492F8) --------------------------------------------------------
unsigned int __fastcall sub_492F8(_DWORD *a1, int a2)
{
  char *v2; // edx

  v2 = (char *)a1 + 7 * a2;
  if ( v2[0xAB] == (char)0xFF )
  {
    return 0;
  }
  --*(_DWORD *)((char *)a1 + 0x15E);
  v2[0xAB] = 0xFF;
  sub_496E0(a1);
  return 0xFFFFFFFF;
}

//----- (00049328) --------------------------------------------------------
unsigned int __fastcall sub_49328(int a1, char a2)
{
  int v2; // esi
  unsigned int v4; // edi
  int v5; // edx

  v2 = a1;
  v4 = 0xFFFFFFFF;
  v5 = 0;
  if ( *(int *)(a1 + 0x15A) > 0 )
  {
    while ( *(_BYTE *)(a1 + 0xAB) == 0xFF || a2 != V_Gizmos[*(char *)(a1 + 0xAB)].cat )
    {
      ++v5;
      a1 += 7;
      if ( v5 >= *(_DWORD *)(v2 + 0x15A) )
      {
        return v4;
      }
    }
    return v5;
  }
  return v4;
}

//----- (0004937C) --------------------------------------------------------
unsigned int __fastcall sub_4937C(int a1, char a2)
{
  unsigned int v4; // esi
  int v5; // edx
  int v6; // eax
  int i; // edx

  v4 = 0xFFFFFFFF;
  v5 = *(_DWORD *)(a1 + 0x15A);
  v6 = 0;
  if ( v5 > 0 )
  {
    for ( i = a1; a2 != *(_BYTE *)(i + 0xAB); i += 7 )
    {
      if ( ++v6 >= *(_DWORD *)(a1 + 0x15A) )
      {
        return v4;
      }
    }
    return v6;
  }
  return v4;
}

//----- (000493BC) --------------------------------------------------------
void __fastcall sub_493BC(T_Ship *a1, char a2)
{
  int v3; // edi
  int v4; // esi
  T_Ship *v5; // ebp
  char v6; // bl
  char *name; // edi
  char *v8; // esi
  char v9; // al
  char v10; // al

  if ( a2 != a1->Unknown_AA[0] && *((__int16 *)&off_9699E + a2 + 1) >= a1->Unknown_15E )
  {
    v3 = 0;
    v4 = 0;
    if ( a1->Unknown_15A > 0 )
    {
      v5 = a1;
      do
      {
        v6 = v5->Unknown_AA[1];
        if ( v6 != (char)0xFF )
        {
          sub_492F8(a1, v4);
          sub_492AC(a1, v6, v3++);
        }
        ++v4;
        v5 = (T_Ship *)((char *)v5 + 7);
      }
      while ( v4 < a1->Unknown_15A );
    }
    sub_49148(a1, a2);
    name = a1->name;
    v8 = &V_Gizmos[0x4C].name[0x14 * a1->Unknown_AA[0]];
    do
    {
      v9 = *v8;
      *name = *v8;
      if ( !v9 )
      {
        break;
      }
      v10 = v8[1];
      v8 += 2;
      name[1] = v10;
      name += 2;
    }
    while ( v10 );
    sub_496E0(a1);
  }
  JUMPOUT(0x4948C);
}
// 4948B: control flows out of bounds to 4948C
// 9699E: using guessed type void *off_9699E;

//----- (00049494) --------------------------------------------------------
void __fastcall sub_49494(int a1, float *a2)
{
  double v3; // st7
  unsigned int v4; // eax
  int v5; // eax
  int v6[3]; // [esp+0h] [ebp-3Ch] BYREF
  float v7; // [esp+Ch] [ebp-30h]
  float v8; // [esp+10h] [ebp-2Ch]
  float v9; // [esp+14h] [ebp-28h]
  float v10; // [esp+18h] [ebp-24h] BYREF
  float v11; // [esp+1Ch] [ebp-20h]
  float v12; // [esp+20h] [ebp-1Ch]
  int v13; // [esp+24h] [ebp-18h]
  int *v14; // [esp+28h] [ebp-14h]

  if ( sub_35BB4((T_Planet *)a2, a1) )
  {
    v4 = sub_4937C(a1, 0x43);
    if ( v4 != 0xFFFFFFFF )
    {
      v5 = a1 + 7 * v4;
      if ( *(_WORD *)(v5 + 0xAC) )
      {
        *(_DWORD *)(a1 + 0x88) += V_Gizmos[0x43].special1;
        --*(_WORD *)(v5 + 0xAC);
      }
    }
    if ( *(_WORD *)(a1 + 0x56) == byte_104BEA && *(_BYTE *)(a1 + 0x5D) == 3 )
    {
      if ( *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] != 0x10 )
      {
        sub_55AEC(&V_Type3_stru_10AE70, 0x10, a1, *(_DWORD *)(a1 + 0x5E));
      }
      *(_BYTE *)(a1 + 0x5D) = 0;
      *(_DWORD *)(a1 + 0x5E) = 0;
    }
  }
  else
  {
    *(_BYTE *)(a1 + 0x58) = 4;
    v10 = (float)(rand() % 0x3E8 - 0x1F4);
    v11 = (float)(rand() % 0x3E8 - 0x1F4);
    v13 = rand() % 0x3E8 - 0x1F4;
    v12 = (float)v13;
    sub_53054(&v10, 250.0);
    v7 = 0.0;
    v8 = 0.0;
    v9 = 0.0;
    v14 = v6;
    v7 = *a2 + v10;
    v8 = a2[1] + v11;
    v3 = a2[2];
    *(float *)v6 = v7;
    v9 = v3 + v12;
    *(float *)&v6[1] = v8;
    *(float *)&v6[2] = v9;
    sub_496BC(a1, v6);
  }
}

//----- (0004960C) --------------------------------------------------------
unsigned int __fastcall sub_4960C(int a1, int a2)
{
  if ( *(_DWORD *)(a1 + 0xC) + *(_DWORD *)(a1 + 8) <= 0 && V_Game.races[*(__int16 *)(a1 + 0x56)].Unknown_19D != 0x12
    || (*(_BYTE *)(a2 + 0x23) & 2) != 0 )
  {
    return 0;
  }
  else
  {
    return 0xFFFFFFFF;
  }
}

//----- (00049648) --------------------------------------------------------
unsigned int __fastcall sub_49648(int a1, __int16 **a2)
{
  unsigned int result; // eax
  __int16 *v4; // esi

  result = sub_4960C(a1, (int)a2);
  if ( result )
  {
    if ( *(_BYTE *)(a1 + 0x58) == 3 )
    {
      v4 = (__int16 *)&V_Game.stars[*(__int16 *)(*(_DWORD *)(a1 + 0x59) + 0xC)];
    }
    else
    {
      v4 = *(__int16 **)(a1 + 0x59);
    }
    result = sub_1D538((int)v4, a1);
    *(_BYTE *)(a1 + 0x58) = 5;
    *(_DWORD *)(a1 + 0x9E) = 0;
    *(_DWORD *)(a1 + 0x59) = a2;
    if ( v4 == *a2 )
    {
      *(_DWORD *)(a1 + 0xA2) = 0x3F800000;
    }
    else
    {
      *(_DWORD *)(a1 + 0xA2) = 0;
    }
  }
  return result;
}

//----- (000496BC) --------------------------------------------------------
void __fastcall sub_496BC(int a1, _DWORD *a2)
{
  int v2; // eax

  *(_DWORD *)(a1 + 0x9E) = *a2;
  v2 = a1 + 0x9E;
  *(_DWORD *)(v2 + 4) = a2[1];
  *(_DWORD *)(v2 + 8) = a2[2];
  sub_53440((T_Vector3D *)v2);
}

//----- (000496E0) --------------------------------------------------------
void __fastcall sub_496E0(_DWORD *a1)
{
  int v2; // eax
  int v3; // esi
  int v4; // edi
  _DWORD *v5; // ebx
  T_Gizmo *v6; // eax
  char v7; // al
  int v8; // [esp+8h] [ebp-20h]
  int v9; // [esp+Ch] [ebp-1Ch]

  *a1 = 0;
  a1[1] = 0;
  v2 = a1[5];
  a1[8] = 0;
  a1[9] = 0;
  a1[6] = 0;
  a1[7] = 0;
  a1[0xA] = 0;
  v3 = 0;
  a1[0xB] = 0;
  v9 = 0;
  a1[0xC] = 0;
  v8 = 0;
  v4 = *(_DWORD *)((char *)a1 + 0x15A);
  a1[4] = v2;
  if ( v4 > 0 )
  {
    v5 = a1;
    do
    {
      if ( *((_BYTE *)v5 + 0xAB) != 0xFF )
      {
        v6 = &V_Gizmos[*((char *)v5 + 0xAB)];
        *a1 += v6->weaponDamage;
        a1[1] += v6->shieldStrength;
        a1[4] += v6->driveMaxDistance;
        a1[8] += v6->scannerRangePerTurn;
        a1[6] += v6->generatorPower;
        if ( v6->cat == 2 )
        {
          a1[7] += v6->power;
        }
        v7 = *((_BYTE *)v5 + 0xAB);
        switch ( v7 )
        {
          case 'G':
            a1[0xA] = 0xFFFFFFFF;
            break;
          case '+':
            ++v9;
            break;
          case ',':
            ++v8;
            break;
          case '*':
            ++a1[9];
            break;
        }
      }
      ++v3;
      v5 = (_DWORD *)((char *)v5 + 7);
    }
    while ( v3 < *(_DWORD *)((char *)a1 + 0x15A) );
  }
  a1[2] = (int)(sqrt((double)v9) * dbl_926EB);
  a1[3] = (int)(sqrt((double)v8) * dbl_926F3);
}
// 926EB: using guessed type double dbl_926EB;
// 926F3: using guessed type double dbl_926F3;

//----- (00049828) --------------------------------------------------------
int __fastcall sub_49828(T_Ship *a1)
{
  int Unknown_59; // ecx
  __int16 v3; // dx
  int v4; // eax
  int v5; // ecx
  int v6; // edx

  if ( a1->Unknown_58 != 1 && a1->Unknown_58 != 2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x260);
  }
  if ( !a1->Unknown_59 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x261);
  }
  Unknown_59 = a1->Unknown_59;
  if ( a1->raceIndex != *(unsigned __int8 *)(Unknown_59 + 0x57) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x265);
  }
  if ( a1->Unknown_58 == 1 )
  {
    a1->Unknown_52 = V_Game.day;
    if ( a1->raceIndex == byte_104BEA && *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] != 0x11 )
    {
      v3 = 0x11;
LABEL_15:
      sub_55AEC(&V_Type3_stru_10AE70, v3, (int)a1, Unknown_59);
    }
  }
  else if ( a1->raceIndex == byte_104BEA && *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] != 0x11 )
  {
    v3 = 0x12;
    goto LABEL_15;
  }
  v4 = a1->Unknown_59;
  a1->Unknown_58 = 3;
  v5 = *(__int16 *)(v4 + 0xC);
  sub_1D3E8((int)&V_Game.stars[v5], (int)a1, 0);
  v6 = a1->Unknown_AA[0];
  sub_49148(a1, v6);
  return sub_4A6AC((int)a1, v6, 0, v5);
}

//----- (00049940) --------------------------------------------------------
__int16 __fastcall sub_49940(int a1)
{
  int v2; // esi
  int v3; // eax
  T_Star *v4; // eax
  int v5; // eax

  if ( !*(_BYTE *)(a1 + 0x58) )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\ship.cpp", 0x288);
  }
  switch ( *(_BYTE *)(a1 + 0x58) )
  {
    case 1:
    case 2:
      v2 = *(_DWORD *)(a1 + 0x59);
      if ( *(_WORD *)(v2 + 0x52) >= *(_WORD *)(v2 + 0x1A) )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x297);
      }
      if ( sub_35A70(*(P_Planet *)(a1 + 0x59), *(_WORD *)(v2 + 0x52)) != (T_Ship *)a1 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x29A);
      }
      v3 = *(__int16 *)(v2 + 0xC);
      *(_BYTE *)(a1 + 0x58) = 4;
      v4 = &V_Game.stars[v3];
      *(_DWORD *)(a1 + 0x59) = v4;
      sub_1D538((int)v4, a1);
      v5 = *(unsigned __int16 *)(v2 + 0x52);
      *(_BYTE *)(v2 + 0x54) = 0xFF;
      if ( (unsigned __int16)v5 != 0xFFFF )
      {
        *(_BYTE *)(*(_DWORD *)(v2 + 0x10) + 4 * v5 + 1) = 0xFF;
        *(_WORD *)(v2 + 0x52) = 0xFFFF;
      }
      break;
    case 3:
      sub_35C38(*(T_Planet **)(a1 + 0x59), (T_Ship *)a1);
      if ( *(_BYTE *)(a1 + 0x58) != 4 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x2B0);
      }
      goto LABEL_12;
    case 4:
LABEL_12:
      sub_1D538(*(_DWORD *)(a1 + 0x59), a1);
      break;
    default:
      return sub_20720((int)&V_Game, a1);
  }
  return sub_20720((int)&V_Game, a1);
}

//----- (00049A40) --------------------------------------------------------
int __fastcall sub_49A40(int a1, int a2)
{
  char *v3; // ebx
  __int16 i; // si
  int result; // eax

  v3 = (char *)(a1 + 0xAB);
  for ( i = 0; ; ++i )
  {
    result = i;
    if ( i >= *(_DWORD *)(a1 + 0x15A) )
    {
      break;
    }
    if ( *v3 != (char)0xFF && V_Gizmos[*v3].cat == 1 && a2 != *(_DWORD *)(v3 + 3) )
    {
      sub_49A8C(a1, v3);
    }
    v3 += 7;
  }
  return result;
}

//----- (00049A8C) --------------------------------------------------------
T_Gizmo *__fastcall sub_49A8C(int a1, char *a2)
{
  T_Gizmo *result; // eax
  int v5; // edi
  int v6; // edx
  int power; // ebx

  if ( *a2 == (char)0xFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x2D3);
  }
  result = &V_Gizmos[*a2];
  if ( (result->flags & 0x20) != 0 )
  {
    if ( *(_DWORD *)(a2 + 3) == 0xFFFFFFFF )
    {
      *(_DWORD *)(a1 + 0x88) += result->power;
      if ( result->cat == 1 )
      {
        result = (T_Gizmo *)result->shieldStrength;
        v5 = *(_DWORD *)(a1 + 0x90) - (_DWORD)result;
        *(_DWORD *)(a1 + 0x90) = v5;
        if ( v5 < 0 )
        {
          *(_DWORD *)(a1 + 0x90) = 0;
        }
      }
      *(_DWORD *)(a2 + 3) = 0;
    }
    else
    {
      v6 = *(_DWORD *)(a1 + 0x88);
      power = result->power;
      if ( v6 >= power )
      {
        *(_DWORD *)(a1 + 0x88) = v6 - power;
        if ( result->cat == 1 )
        {
          result = (T_Gizmo *)result->shieldStrength;
          *(_DWORD *)(a1 + 0x90) += result;
        }
        *(_DWORD *)(a2 + 3) = 0xFFFFFFFF;
      }
    }
  }
  return result;
}

//----- (00049B3C) --------------------------------------------------------
int __fastcall sub_49B3C(int a1, int a2)
{
  char v3; // cl
  int result; // eax

  v3 = *(_BYTE *)(a1 + 0x62);
  result = 0;
  if ( v3 )
  {
    if ( v3 == 1 )
    {
      result = sub_4A0D0(a1, a2);
    }
  }
  else
  {
    result = sub_49CC4(a1, a2);
  }
  *(_DWORD *)(a1 + 0x84) = result;
  return result;
}

//----- (00049B68) --------------------------------------------------------
int __fastcall sub_49B68(int a1, int a2)
{
  __int16 i; // dx
  bool v5; // zf
  int v6; // ebx
  char v7; // al
  float v9; // [esp+8h] [ebp-20h]
  float v10; // [esp+10h] [ebp-18h]

  v10 = -1.0;
  for ( i = 0; i < *(_DWORD *)(a1 + 0x15A); ++i )
  {
    v6 = a1 + 7 * i;
    v7 = *(_BYTE *)(v6 + 0xAB);
    v9 = -1.0;
    if ( v7 != (char)0xFF && v7 < 0x4C && (!V_Gizmos[v7].numUses || *(_WORD *)(v6 + 0xAC)) )
    {
      if ( v7 > (char)0xFFFFFFFF && v7 < 9 )
      {
LABEL_35:
        v9 = (double)(0x20 * V_Gizmos[v7].range) * dbl_9275B;
        goto LABEL_25;
      }
      if ( a2 != 1 )
      {
        if ( a2 != 2 || (unsigned __int8)v7 < 0x2Fu )
        {
          goto LABEL_25;
        }
        if ( (unsigned __int8)v7 > 0x2Fu )
        {
          v5 = v7 == 0x46;
          goto LABEL_24;
        }
LABEL_4:
        v9 = (double)(0x20 * V_Gizmos[v7].range) * dbl_92763;
        goto LABEL_25;
      }
      if ( (unsigned __int8)v7 < 0x30u )
      {
        if ( (unsigned __int8)v7 < 0x25u )
        {
          if ( (unsigned __int8)v7 >= 0x21u && (unsigned __int8)v7 <= 0x23u )
          {
            goto LABEL_35;
          }
        }
        else
        {
          if ( (unsigned __int8)v7 <= 0x26u )
          {
            goto LABEL_35;
          }
          if ( v7 == 0x2F )
          {
            goto LABEL_4;
          }
        }
      }
      else
      {
        if ( (unsigned __int8)v7 <= 0x32u )
        {
          goto LABEL_35;
        }
        if ( (unsigned __int8)v7 < 0x3Du )
        {
          v5 = v7 == 0x36;
LABEL_24:
          if ( v5 )
          {
            goto LABEL_35;
          }
        }
        else
        {
          if ( (unsigned __int8)v7 <= 0x3Du )
          {
            goto LABEL_35;
          }
          if ( (unsigned __int8)v7 >= 0x40u )
          {
            if ( (unsigned __int8)v7 <= 0x40u )
            {
              goto LABEL_35;
            }
            v5 = v7 == 0x42;
            goto LABEL_24;
          }
        }
      }
LABEL_25:
      if ( v9 > (double)v10 )
      {
        v10 = v9;
      }
      continue;
    }
  }
  return (int)v10;
}
// 9275B: using guessed type double dbl_9275B;
// 92763: using guessed type double dbl_92763;

//----- (00049CC4) --------------------------------------------------------
int __fastcall sub_49CC4(int a1, int a2)
{
  char v4; // dh
  int v5; // ebx
  int *v6; // edx
  int *v7; // edx
  float *v8; // edx
  double v9; // st7
  double v10; // st7
  int v11; // eax
  double v12; // st6
  char v13; // dl
  int v15[6]; // [esp+8h] [ebp-C0h] BYREF
  int v16[3]; // [esp+20h] [ebp-A8h] BYREF
  float v17; // [esp+2Ch] [ebp-9Ch]
  float v18; // [esp+30h] [ebp-98h]
  float v19; // [esp+34h] [ebp-94h]
  T_Vector3D v20; // [esp+38h] [ebp-90h]
  T_Vector3D v21; // [esp+44h] [ebp-84h] BYREF
  T_Vector3D v22; // [esp+50h] [ebp-78h] BYREF
  float v23; // [esp+5Ch] [ebp-6Ch]
  float v24; // [esp+60h] [ebp-68h]
  float v25; // [esp+64h] [ebp-64h]
  float v26; // [esp+68h] [ebp-60h]
  int v27; // [esp+6Ch] [ebp-5Ch]
  int v28; // [esp+70h] [ebp-58h]
  float v29; // [esp+74h] [ebp-54h]
  int v30; // [esp+78h] [ebp-50h]
  int v31; // [esp+7Ch] [ebp-4Ch]
  float v32; // [esp+80h] [ebp-48h] BYREF
  float v33; // [esp+84h] [ebp-44h]
  float v34; // [esp+88h] [ebp-40h]
  int *v35; // [esp+8Ch] [ebp-3Ch]
  int *v36; // [esp+90h] [ebp-38h]
  T_Vector3D *v37; // [esp+94h] [ebp-34h]
  T_Vector3D *v38; // [esp+98h] [ebp-30h]
  float *v39; // [esp+9Ch] [ebp-2Ch]
  float v40; // [esp+A4h] [ebp-24h]
  float v41; // [esp+A8h] [ebp-20h]
  int v42; // [esp+ACh] [ebp-1Ch]
  float v43; // [esp+B0h] [ebp-18h]

  if ( *(_BYTE *)(a1 + 0x58) != 4 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x370);
  }
  v17 = 0.0;
  v18 = 0.0;
  v19 = 0.0;
  v4 = *(_BYTE *)(a1 + 0x67);
  v5 = 1;
  switch ( v4 )
  {
    case 3:
      v17 = *(float *)(a1 + 0x6C);
      v18 = *(float *)(a1 + 0x70);
      v19 = *(float *)(a1 + 0x74);
      break;
    case 1:
      v6 = *(int **)(a1 + 0x68);
      v17 = *(float *)v6;
      v18 = *((float *)v6 + 1);
      v19 = *((float *)v6 + 2);
      break;
    case 2:
      v7 = *(int **)(a1 + 0x68);
      v17 = *((float *)v7 + 5);
      v18 = *((float *)v7 + 6);
      v19 = *((float *)v7 + 7);
      v8 = *(float **)(a1 + 0x68);
      if ( *(_DWORD *)(a1 + 0x59) == *(_DWORD *)v8 )
      {
        v17 = v8[2];
        v18 = v8[3];
        v19 = v8[4];
      }
      break;
    default:
      v5 = 0;
      break;
  }
  if ( (v5 & 1) != 0 )
  {
    v38 = &v21;
    memset(&v15[3], 0, 0xC);
    *(float *)&v15[3] = v17 - *(float *)(a1 + 0x9E);
    *(float *)&v15[4] = v18 - *(float *)(a1 + 0xA2);
    *(float *)&v15[5] = v19 - *(float *)(a1 + 0xA6);
    v21 = *(T_Vector3D *)&v15[3];
    v43 = sqrt(
            *(float *)&v15[4] * *(float *)&v15[4]
          + *(float *)&v15[3] * *(float *)&v15[3]
          + *(float *)&v15[5] * *(float *)&v15[5])
        * flt_92777;
    v41 = (float)*(int *)(a1 + 0x94);
    v40 = v43;
    if ( v43 > (double)v41 )
    {
      v43 = v41;
    }
    v42 = (int)((double)*(int *)(a1 + 0x1C) * (v43 + 1.0) / (double)*(int *)(a1 + 0x10));
    if ( v42 < 1 )
    {
      v42 = 1;
    }
    if ( v42 > *(_DWORD *)(a1 + 0x88) )
    {
      v9 = (double)*(int *)(a1 + 0x88) * v43 / (double)v42;
      v42 = *(_DWORD *)(a1 + 0x88);
      v43 = v9;
    }
    if ( v43 == v40 )
    {
      LOBYTE(v5) = v5 | 8;
    }
    Q_NormVector3D_sub_53000(&v21);
    v35 = v15;
    v29 = v21.x * v43;
    *(float *)v15 = v29;
    *(float *)&v30 = v21.y * v43;
    v15[1] = v30;
    *(float *)&v31 = v43 * v21.z;
    v15[2] = v31;
    v26 = v29 * flt_9277B;
    v36 = v16;
    *(float *)&v27 = *(float *)&v30 * flt_9277B;
    *(float *)v16 = v26;
    *(float *)&v28 = flt_9277B * *(float *)&v31;
    v16[1] = v27;
    v16[2] = v28;
    v20.x = v26 * flt_9277F;
    v37 = &v22;
    v20.y = *(float *)&v27 * flt_9277F;
    v22 = v20;
    v20.z = flt_9277F * *(float *)&v28;
    v21 = v20;
    v23 = 0.0;
    v24 = 0.0;
    v25 = 0.0;
    v39 = &v32;
    v23 = *(float *)(a1 + 0x9E) + v20.x;
    v24 = *(float *)(a1 + 0xA2) + v20.y;
    v10 = *(float *)(a1 + 0xA6);
    v32 = v23;
    v25 = v10 + v20.z;
    v33 = v24;
    v34 = v25;
    *(float *)(a1 + 0x78) = v23;
    *(float *)(a1 + 0x7C) = v33;
    *(float *)(a1 + 0x80) = v34;
    sub_53440((T_Vector3D *)(a1 + 0x78));
    if ( a2 == 1 )
    {
      v11 = v42;
      *(float *)(a1 + 0x9E) = *(float *)(a1 + 0x78);
      *(_DWORD *)(a1 + 0xA2) = *(_DWORD *)(a1 + 0x7C);
      *(_DWORD *)(a1 + 0xA6) = *(_DWORD *)(a1 + 0x80);
      v12 = (double)*(int *)(a1 + 0x94) - v43;
      *(_DWORD *)(a1 + 0x88) -= v11;
      *(_DWORD *)(a1 + 0x94) = (int)v12;
      if ( (v5 & 8) != 0 )
      {
        v13 = *(_BYTE *)(a1 + 0x67);
        if ( v13 == 1 )
        {
          sub_49494(a1, *(float **)(a1 + 0x68));
        }
        else if ( v13 == 2 )
        {
          sub_49648(a1, *(__int16 ***)(a1 + 0x68));
        }
      }
    }
  }
  return v5;
}
// 92777: using guessed type float flt_92777;
// 9277B: using guessed type float flt_9277B;
// 9277F: using guessed type float flt_9277F;

//----- (0004A0D0) --------------------------------------------------------
int __fastcall sub_4A0D0(int a1, int a2)
{
  char *v2; // ecx
  unsigned int v3; // esi
  int v4; // ebx
  char v5; // cl

  v2 = *(char **)(a1 + 0x63);
  v3 = 0xFFFFFFFF;
  v4 = 0;
  if ( V_Gizmos[*v2].numUses )
  {
    if ( *(_WORD *)(v2 + 1) )
    {
      if ( a2 == 1 )
      {
        --*(_WORD *)(v2 + 1);
      }
    }
    else
    {
      v3 = 0;
    }
  }
  if ( v3 == 0xFFFFFFFF )
  {
    v5 = *(_BYTE *)(a1 + 0x67);
    switch ( v5 )
    {
      case 0:
        return sub_4B944(a1, a2);
      case 2:
        return sub_4CAB8(a1, a2);
      case 1:
        return sub_4C7FC(a1, a2);
      case 5:
        return sub_4CDF8(a1, a2);
    }
  }
  return v4;
}

//----- (0004A144) --------------------------------------------------------
int __fastcall sub_4A144(int a1)
{
  int v2; // ebx
  unsigned __int16 i; // ax
  int v4; // edx

  v2 = 0;
  for ( i = 0; i < *(int *)(a1 + 0x15A); ++i )
  {
    v4 = a1 + 7 * i;
    if ( *(_BYTE *)(v4 + 0xAB) != 0xFF )
    {
      v2 += V_Gizmos[*(char *)(v4 + 0xAB)].industry;
    }
  }
  return v2;
}

//----- (0004A18C) --------------------------------------------------------
int __fastcall sub_4A18C(int a1)
{
  int v1; // edx
  int v3[7]; // [esp+0h] [ebp-1Ch]

  v3[0] = dword_969D8[0];
  v3[1] = dword_969D8[1];
  v3[2] = dword_969D8[2];
  v3[3] = dword_969D8[3];
  v1 = v3[*(char *)(a1 + 0xAA)];
  return v1 + sub_4A144(a1);
}
// 969D8: using guessed type _DWORD dword_969D8[4];
// 4A18C: using guessed type int var_1C[7];

//----- (0004A1CC) --------------------------------------------------------
int __fastcall sub_4A1CC(int a1, __int16 a2)
{
  int v3; // ecx
  int v4; // edi
  unsigned __int16 i; // dx
  int level; // eax
  int v7; // ebp
  char v10; // [esp+6h] [ebp-28h]
  char v11; // [esp+Ah] [ebp-24h]
  char v12; // [esp+Eh] [ebp-20h]
  char v13; // [esp+12h] [ebp-1Ch]
  char v14; // [esp+16h] [ebp-18h]

  if ( a2 < 0 || a2 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x408);
  }
  v10 = sub_4A36C(a1, 0, a2);
  v11 = sub_4A36C(a1, 4, a2);
  v14 = sub_4A36C(a1, 2, a2);
  v3 = 0;
  v13 = sub_4A36C(a1, 1, a2);
  v12 = 0x2B;
  v4 = 0;
  if ( sub_4A404(a1, 0x2C) )
  {
    v12 = 0x2C;
  }
  for ( i = 0; i < *(int *)(a1 + 0x15A); ++i )
  {
    if ( *(_BYTE *)(a1 + 7 * i + 0xAB) != 0xFF )
    {
      level = 0xFFFFFFFF;
      switch ( V_Gizmos[i].cat )
      {
        case 0:
          level = V_Gizmos[v10].level;
          break;
        case 1:
          level = V_Gizmos[v13].level;
          break;
        case 2:
          level = V_Gizmos[v14].level;
          break;
        case 4:
          level = V_Gizmos[v11].level;
          break;
        default:
          break;
      }
      if ( *(_BYTE *)(a1 + 7 * i + 0xAB) == 0x2B && v12 == 0x2C )
      {
        ++v4;
        ++v3;
      }
      else if ( level != 0xFFFFFFFF )
      {
        v7 = V_Gizmos[*(char *)(a1 + 7 * i + 0xAB)].level;
        ++v4;
        if ( level > v7 )
        {
          v3 += level - v7;
        }
      }
    }
  }
  if ( v4 <= 0 )
  {
    return 0;
  }
  else
  {
    return 0xA * v3 / v4;
  }
}

//----- (0004A36C) --------------------------------------------------------
char __fastcall sub_4A36C(int a1, char a2, __int16 a3)
{
  char v3; // di
  __int16 level; // bx
  __int16 i; // ax
  char v7; // [esp+4h] [ebp-14h]

  v3 = a3;
  if ( a3 < 0 || a3 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x45F);
  }
  level = 0;
  v7 = 0xFF;
  for ( i = 0; i < 0x4C; ++i )
  {
    if ( V_Gizmos[i].cat == a2
      && ((1 << v3) & (char)V_ResTree.items[(unsigned __int8)V_Gizmos[i].resReq].z2[0]) != 0
      && level <= V_Gizmos[i].level )
    {
      v7 = i;
      level = V_Gizmos[i].level;
    }
  }
  return v7;
}

//----- (0004A404) --------------------------------------------------------
int __fastcall sub_4A404(int a1, char a2)
{
  if ( V_Game.racesNum <= *(__int16 *)(a1 + 0x56) || *(__int16 *)(a1 + 0x56) < 0 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x476);
  }
  return (((1 << *(_WORD *)(a1 + 0x56)) & (char)V_ResTree.items[(unsigned __int8)V_Gizmos[a2].resReq].z2[0]) == 0) - 1;
}

//----- (0004A480) --------------------------------------------------------
_BYTE *__fastcall sub_4A480(int a1, unsigned __int16 a2, int a3)
{
  _BYTE *v5; // ecx
  int v6; // edi
  __int16 i; // bx

  if ( !*(_DWORD *)(a1 + 0x88) )
  {
    return 0;
  }
  v5 = (_BYTE *)(a1 + 0xAB);
  *(_BYTE *)(a1 + 0x62) = 1;
  v6 = 0;
  if ( a2 )
  {
    if ( a2 <= 2u )
    {
      *(_BYTE *)(a1 + 0x67) = 1;
      *(_DWORD *)(a1 + 0x68) = a3;
    }
    else
    {
      if ( a2 != 3 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x4A3);
      }
      *(_BYTE *)(a1 + 0x67) = 0;
      *(_DWORD *)(a1 + 0x68) = a3;
    }
  }
  else
  {
    *(_BYTE *)(a1 + 0x67) = 2;
    *(_DWORD *)(a1 + 0x68) = a3;
  }
  for ( i = 0; i < *(_DWORD *)(a1 + 0x15A); ++i )
  {
    if ( *v5 != 0xFF && (!V_Gizmos[(char)*v5].cat || *(_BYTE *)(a1 + 0x67) == 1 && *v5 == 0x46) )
    {
      *(_DWORD *)(a1 + 0x63) = v5;
      if ( (sub_49B3C(a1, 0) & 1) != 0 )
      {
        return v5;
      }
    }
    v5 += 7;
  }
  return (_BYTE *)v6;
}

//----- (0004A534) --------------------------------------------------------
unsigned int __fastcall sub_4A534(int a1, char a2)
{
  __int16 i; // ax

  for ( i = 0; i < *(_DWORD *)(a1 + 0x15A); ++i )
  {
    if ( a2 == *(_BYTE *)(7 * i + a1 + 0xAB) )
    {
      return 0xFFFFFFFF;
    }
  }
  return 0;
}

//----- (0004A564) --------------------------------------------------------
unsigned int __fastcall sub_4A564(int a1)
{
  __int16 i; // ax
  int v3; // edx

  for ( i = 0; i < *(_DWORD *)(a1 + 0x15A); ++i )
  {
    v3 = a1 + 7 * i;
    if ( !V_Gizmos[*(char *)(v3 + 0xAB)].cat && (!V_Gizmos[*(char *)(v3 + 0xAB)].numUses || *(_WORD *)(v3 + 0xAC)) )
    {
      return 0xFFFFFFFF;
    }
  }
  return 0;
}

//----- (0004A5B8) --------------------------------------------------------
int __fastcall sub_4A5B8(int result)
{
  int v1; // edx
  char *v2; // ebx
  int i; // esi
  T_Gizmo *v4; // edx
  int v5; // ecx
  int power; // edi

  if ( (*(_WORD *)(result + 0x9C) & 1) != 0 )
  {
    *(_DWORD *)(result + 0x94) = 0;
  }
  else
  {
    if ( (*(_WORD *)(result + 0x9C) & 2) != 0 )
    {
      v1 = V_Gizmos[0x3F].special1 + *(_DWORD *)(result + 0x10);
    }
    else
    {
      v1 = *(_DWORD *)(result + 0x10);
    }
    *(_DWORD *)(result + 0x94) = v1;
  }
  *(_DWORD *)(result + 0x90) = 0;
  v2 = (char *)(result + 0xAB);
  for ( i = 0; i < *(_DWORD *)(result + 0x15A); v2 += 7 )
  {
    if ( *v2 != (char)0xFF )
    {
      v4 = &V_Gizmos[*v2];
      if ( (v4->flags & 0x20) != 0 && *(_DWORD *)(v2 + 3) == 0xFFFFFFFF )
      {
        v5 = *(_DWORD *)(result + 0x88);
        power = v4->power;
        if ( v5 >= power )
        {
          *(_DWORD *)(result + 0x88) = v5 - power;
          if ( v4->cat == 1 )
          {
            *(_DWORD *)(result + 0x90) += v4->shieldStrength;
          }
        }
      }
    }
    ++i;
  }
  if ( (*(_WORD *)(result + 0x9C) & 8) != 0 )
  {
    *(_DWORD *)(result + 0x90) = 0;
  }
  return result;
}

//----- (0004A6AC) --------------------------------------------------------
int __fastcall sub_4A6AC(int a1, int a2, int a3, int a4)
{
  int v5; // eax
  int v6; // edx
  int v7; // ebx
  char *v8; // eax
  int v9; // edx
  float *v10; // eax
  float *v11; // ebx
  double v12; // st7
  int v13; // eax
  double v14; // st7
  int v15; // edi
  T_Race *v16; // eax
  float v18; // [esp+8h] [ebp-3Ch]
  int v19; // [esp+Ch] [ebp-38h]
  int v20; // [esp+10h] [ebp-34h]
  int v21[5]; // [esp+14h] [ebp-30h] BYREF
  float v22; // [esp+28h] [ebp-1Ch]
  float v23; // [esp+2Ch] [ebp-18h]

  *(_WORD *)(a1 + 0x9C) = 0;
  v5 = sub_4A8FC(a1);
  v6 = 0;
  v7 = *(_DWORD *)(a1 + 0x15A);
  *(_DWORD *)(a1 + 0x88) = v5;
  v8 = (char *)(a1 + 0xAB);
  if ( v7 > 0 )
  {
    do
    {
      if ( *v8 != (char)0xFF )
      {
        *(_WORD *)(v8 + 1) = V_Gizmos[*v8].numUses;
      }
      ++v6;
      v8 += 7;
    }
    while ( v6 < *(_DWORD *)(a1 + 0x15A) );
  }
  if ( *(_BYTE *)(a1 + 0x58) == 5 )
  {
    v9 = *(_DWORD *)(a1 + 0x59);
    v10 = *(float **)(v9 + 4);
    v11 = *(float **)v9;
    v21[3] = (int)v21;
    v18 = v11[2] - v10[2];
    *(float *)&v19 = v11[3] - v10[3];
    *(float *)&v20 = v11[4] - v10[4];
    *(float *)v21 = v18;
    v21[1] = v19;
    v21[2] = v20;
    v12 = sqrt(*(float *)&v19 * *(float *)&v19 + v18 * v18 + *(float *)&v20 * *(float *)&v20);
    v13 = *(_DWORD *)(a1 + 0xC) + *(_DWORD *)(a1 + 8);
    v22 = v12;
    v21[4] = v13;
    LOBYTE(v11) = *(_BYTE *)(v9 + 0x23);
    v23 = (float)v13;
    if ( ((unsigned __int8)v11 & 1) != 0 )
    {
      v23 = v23 * flt_927BF;
    }
    if ( V_Game.races[*(__int16 *)(a1 + 0x56)].Unknown_19D == 0x12 )
    {
      if ( v23 < 1.0 )
      {
        v23 = 1.0;
      }
      v23 = v23 * flt_927C3;
    }
    v14 = *(float *)(a1 + 0x9E) + v23;
    *(float *)(a1 + 0x9E) = v14;
    if ( v14 > v22 )
    {
      *(float *)(a1 + 0x9E) = v22;
    }
    if ( *(float *)(a1 + 0x9E) == v22 )
    {
      if ( (*(_DWORD *)(a1 + 0xA2) & 0x7FFFFFFF) != 0 )
      {
        v15 = *(_DWORD *)(*(_DWORD *)(a1 + 0x59) + 4);
      }
      else
      {
        v15 = **(_DWORD **)(a1 + 0x59);
      }
      v16 = &V_Game.races[byte_104BEA];
      if ( *(_WORD *)(a1 + 0x56) == byte_104BEA )
      {
        sub_45A54(&v16->Unknown_00, v15, a1);
      }
      else if ( ((1 << byte_104BEA) & (*(unsigned __int8 *)(v15 + 0x14) | *(unsigned __int8 *)(v15 + 0x15))) != 0 )
      {
        sub_45D50(&v16->Unknown_00, v15, a1);
      }
      sub_1D3E8(v15, a1, 0);
      if ( *(_BYTE *)(a1 + 0x58) != 4 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x55A);
      }
    }
  }
  return sub_4A5B8(a1);
}
// 927BF: using guessed type float flt_927BF;
// 927C3: using guessed type float flt_927C3;

//----- (0004A8CC) --------------------------------------------------------
int __fastcall sub_4A8CC(int a1)
{
  int result; // eax

  result = (V_Game.day - *(_DWORD *)(a1 + 0x52)) / 0x64;
  if ( result < 0 )
  {
    return 0;
  }
  if ( result > 0xA )
  {
    return 0xA;
  }
  return result;
}

//----- (0004A8FC) --------------------------------------------------------
int __fastcall sub_4A8FC(int a1)
{
  int v2; // [esp+4h] [ebp-Ch]
  float v3; // [esp+8h] [ebp-8h]

  v2 = *(_DWORD *)(a1 + 0x18);
  v3 = (double)sub_4A8CC(a1) * flt_927C7 + 1.0;
  if ( v3 >= 1.0 )
  {
    if ( v3 > (double)flt_927CB )
    {
      v3 = 2.0;
    }
  }
  else
  {
    v3 = 1.0;
  }
  return (int)((double)v2 * v3);
}
// 927C7: using guessed type float flt_927C7;
// 927CB: using guessed type float flt_927CB;

//----- (0004A988) --------------------------------------------------------
int __fastcall sub_4A988(int a1)
{
  int v1; // ebx
  int v2; // esi
  int v3; // ecx
  T_Gizmo *v4; // edx

  v1 = 0;
  v2 = 0;
  if ( *(int *)(a1 + 0x15A) > 0 )
  {
    v3 = a1;
    do
    {
      if ( *(_WORD *)(v3 + 0xAC) == 1 && *(_BYTE *)(v3 + 0xAB) != 0xFF )
      {
        v4 = &V_Gizmos[*(char *)(v3 + 0xAB)];
        v1 += v4->industry;
        switch ( v4->cat )
        {
          case 0:
            v1 += v4->range / 5 + 0xA * v4->level;
            break;
          case 1:
            v1 += 5 * v4->level;
            break;
          case 2:
            v1 += 2 * v4->level;
            break;
          case 3:
            v1 += v4->level;
            break;
          case 5:
            v1 += v4->range / 5 + 5 * v4->level;
            break;
          default:
            break;
        }
      }
      ++v2;
      v3 += 7;
    }
    while ( v2 < *(_DWORD *)(a1 + 0x15A) );
  }
  return (4 * *(_DWORD *)(a1 + 0x8C) + 0xA * sub_4A8FC(a1) + v1) / 0xA;
}

//----- (0004AA78) --------------------------------------------------------
int __fastcall sub_4AA78(int a1, int a2)
{
  int v3; // eax

  if ( !a2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x5B6);
  }
  if ( *(_BYTE *)(a1 + 0x58) != 4 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x5B7);
  }
  v3 = *(_DWORD *)(a1 + 0x59);
  if ( a2 == v3 )
  {
    return 0;
  }
  *(_BYTE *)(a1 + 0x5D) = 1;
  *(_DWORD *)(a1 + 0x5E) = a2;
  return (unsigned __int8)V_Game.z10000[0x64 * *(__int16 *)(v3 + 4) + *(__int16 *)(a2 + 4)];
}

//----- (0004AAEC) --------------------------------------------------------
int __fastcall sub_4AAEC(int a1, int a2)
{
  int v2; // eax
  unsigned int v3; // ebp
  int v4; // eax
  int v5; // esi
  int v6; // ecx
  double v7; // st7
  int v8; // edx
  _BYTE *i; // edx
  int v10; // eax
  int v11; // ebx
  unsigned int v12; // eax
  int v13; // edi
  int v14; // ecx
  float *v15; // esi
  int v16; // eax
  T_Planet *v17; // ebx
  int v18; // eax
  int v20[107]; // [esp+8h] [ebp-218h] BYREF
  float v21; // [esp+1B4h] [ebp-6Ch]
  float v22; // [esp+1B8h] [ebp-68h]
  float v23; // [esp+1BCh] [ebp-64h]
  float v24; // [esp+1C0h] [ebp-60h]
  float v25; // [esp+1C4h] [ebp-5Ch]
  float v26; // [esp+1C8h] [ebp-58h]
  int v27[3]; // [esp+1CCh] [ebp-54h] BYREF
  int v28[3]; // [esp+1D8h] [ebp-48h] BYREF
  int v29; // [esp+1E4h] [ebp-3Ch]
  int v30; // [esp+1E8h] [ebp-38h]
  int *v31; // [esp+1ECh] [ebp-34h]
  int v32; // [esp+1F0h] [ebp-30h]
  int v33; // [esp+1F4h] [ebp-2Ch]
  int *v34; // [esp+1F8h] [ebp-28h]
  float v35; // [esp+1FCh] [ebp-24h]
  int v36; // [esp+200h] [ebp-20h]
  float *v37; // [esp+204h] [ebp-1Ch]
  float v38; // [esp+208h] [ebp-18h]

  v29 = a1;
  v36 = a2;
  v30 = 0;
  if ( *(_BYTE *)(a1 + 0x58) == 4 )
  {
    v2 = sub_1D794(*(__int16 **)(a1 + 0x59), v20);
    if ( v2 > 0 )
    {
      v3 = 0;
      v32 = 4 * v2;
      v37 = (float *)(v29 + 0x9E);
      while ( 1 )
      {
        v4 = v20[v3 / 4];
        if ( *(__int16 *)(v4 + 0x56) == v36 && *(_BYTE *)(v4 + 0x58) == 4 )
        {
          v5 = 0;
          v31 = v27;
          v21 = 0.0;
          v22 = 0.0;
          v23 = 0.0;
          v21 = *v37 - *(float *)(v4 + 0x9E);
          v22 = v37[1] - *(float *)(v4 + 0xA2);
          v23 = v37[2] - *(float *)(v4 + 0xA6);
          *(float *)v27 = v21;
          *(float *)&v27[1] = v22;
          *(float *)&v27[2] = v23;
          v6 = 0;
          v7 = sqrt(v22 * v22 + v21 * v21 + v23 * v23);
          v8 = v20[v3 / 4];
          v38 = v7;
          for ( i = (_BYTE *)(v8 + 0xAB); ; i += 7 )
          {
            v10 = v20[v3 / 4];
            if ( v6 >= *(_DWORD *)(v10 + 0x15A) )
            {
              break;
            }
            if ( *i != 0xFF )
            {
              v11 = (char)*i;
              if ( V_Gizmos[v11].cat == 3 )
              {
                v33 = 0x20 * V_Gizmos[(char)*i].range;
                if ( (double)v33 >= v38 )
                {
                  v5 += V_Gizmos[v11].scannerRangePerTurn;
                }
              }
            }
            ++v6;
          }
          if ( v5 > 0 && v5 > 2 * *(_DWORD *)(v29 + 0x24) )
          {
            v12 = sub_4937C(v10, 0x29);
            v30 = 1;
            if ( v12 != 0xFFFFFFFF )
            {
              break;
            }
          }
        }
        v3 += 4;
        if ( (int)v3 >= v32 )
        {
          goto LABEL_20;
        }
      }
      v30 = 2;
    }
LABEL_20:
    if ( !v30 )
    {
      v13 = 0;
      v14 = 0;
      v15 = (float *)(v29 + 0x9E);
      while ( 1 )
      {
        v16 = *(_DWORD *)(v29 + 0x59);
        if ( v13 >= *(__int16 *)(v16 + 0x5A) )
        {
          break;
        }
        v17 = *(T_Planet **)(v14 + v16 + 0x46);
        if ( v17->byte57 == v36 )
        {
          v34 = v28;
          v24 = 0.0;
          v25 = 0.0;
          v26 = 0.0;
          v24 = *v15 - v17->v.x;
          v25 = v15[1] - v17->v.y;
          v26 = v15[2] - v17->v.z;
          *(float *)v28 = v24;
          *(float *)&v28[1] = v25;
          *(float *)&v28[2] = v26;
          v35 = sqrt(v25 * v25 + v24 * v24 + v26 * v26);
          v18 = sub_35930(v17, 0x10);
          if ( v18 != 0xFFFF && (*((_WORD *)v17->a + 2 * v18 + 1) & 1) != 0 && v35 < (double)flt_927E7 )
          {
            return 1;
          }
        }
        v14 += 4;
        ++v13;
      }
    }
  }
  return v30;
}
// 927E7: using guessed type float flt_927E7;

//----- (0004AE8C) --------------------------------------------------------
void __fastcall Q_ReadWriteShip_sub_4AE8C(P_Ship pShip, P_FileInfo pfi, int read)
{
  int *v4; // edx
  __int8 Unknown_58; // al
  int Unknown_59; // ebp
  int v7; // ebp
  T_Ship vShip; // [esp+0h] [ebp-3BCh] BYREF
  T_Ship vShipa; // [esp+164h] [ebp-258h] BYREF
  char v10[105]; // [esp+2C8h] [ebp-F4h] BYREF
  char v11[105]; // [esp+334h] [ebp-88h] BYREF
  __int8 *v12; // [esp+3A0h] [ebp-1Ch]
  int *p_Unknown_9E; // [esp+3A4h] [ebp-18h]
  P_FileInfo vfi; // [esp+3A8h] [ebp-14h]

  vfi = pfi;
  v12 = &pShip->Unknown_AA[1];
  p_Unknown_9E = &pShip->Unknown_9E;
  if ( read == TRUE )
  {
    sub_48B90(&vShipa);
    Q_ReadFile_sub_1BF94(vfi, &vShipa, 0x162u);
    pShip->Unknown_0 = vShipa.Unknown_0;
    pShip->Unknown_4 = vShipa.Unknown_4;
    pShip->Unknown_8 = vShipa.Unknown_8;
    pShip->Unknown_C = vShipa.Unknown_C;
    pShip->Unknown_10 = vShipa.Unknown_10;
    pShip->Unknown_14 = vShipa.Unknown_14;
    pShip->Unknown_18 = vShipa.Unknown_18;
    pShip->Unknown_1C = vShipa.Unknown_1C;
    pShip->Unknown_20 = vShipa.Unknown_20;
    pShip->Unknown_24 = vShipa.Unknown_24;
    pShip->Unknown_28 = vShipa.Unknown_28;
    pShip->Unknown_2C = vShipa.Unknown_2C;
    pShip->Unknown_30 = vShipa.Unknown_30;
    qmemcpy(pShip->name, vShipa.name, sizeof(pShip->name));
    pShip->Unknown_50 = vShipa.Unknown_50;
    pShip->Unknown_52 = vShipa.Unknown_52;
    pShip->raceIndex = vShipa.raceIndex;
    pShip->Unknown_58 = vShipa.Unknown_58;
    pShip->Unknown_59 = vShipa.Unknown_59;
    pShip->Unknown_5D = vShipa.Unknown_5D;
    pShip->Unknown_5E = vShipa.Unknown_5E;
    pShip->Unknown_62 = vShipa.Unknown_62;
    pShip->Unknown_63 = vShipa.Unknown_63;
    pShip->Unknown_67 = vShipa.Unknown_67;
    pShip->Unknown_68 = vShipa.Unknown_68;
    pShip->Unknown_6C = vShipa.Unknown_6C;
    pShip->Unknown_70 = vShipa.Unknown_70;
    pShip->Unknown_74 = vShipa.Unknown_74;
    pShip->Unknown_78 = vShipa.Unknown_78;
    pShip->Unknown_7C = vShipa.Unknown_7C;
    pShip->Unknown_80 = vShipa.Unknown_80;
    pShip->Unknown_84 = vShipa.Unknown_84;
    pShip->Unknown_88 = vShipa.Unknown_88;
    pShip->Unknown_8C = vShipa.Unknown_8C;
    pShip->Unknown_90 = vShipa.Unknown_90;
    pShip->Unknown_94 = vShipa.Unknown_94;
    pShip->Unknown_98 = vShipa.Unknown_98;
    pShip->Unknown_9C = vShipa.Unknown_9C;
    v4 = p_Unknown_9E;
    *p_Unknown_9E = vShipa.Unknown_9E;
    v4[1] = vShipa.Unknown_A2;
    v4[2] = vShipa.Unknown_A6;
    pShip->Unknown_AA[0] = vShipa.Unknown_AA[0];
    _wcpp_2_assign_array_(sub_4B780);
    pShip->Unknown_15A = vShipa.Unknown_15A;
    pShip->Unknown_15E = vShipa.Unknown_15E;
    switch ( pShip->Unknown_5D )
    {
      case 0:
      case 7:
        pShip->Unknown_5E = 0;
        break;
      case 1:
        pShip->Unknown_5E = (int)&V_Game.stars[pShip->Unknown_5E];
        break;
      case 2:
      case 3:
        pShip->Unknown_5E = (int)&V_Game.planets[pShip->Unknown_5E];
        break;
      case 4:
      case 5:
      case 6:
        Q_AssertLogBreakExit_sub_261A8(0, "..\\ship.cpp", 0x642);
        break;
      default:
        Q_AssertLogBreakExit_sub_261A8(0, "..\\ship.cpp", 0x647);
        break;
    }
    Unknown_58 = pShip->Unknown_58;
    if ( (unsigned __int8)Unknown_58 < 3u )
    {
      if ( !Unknown_58 )
      {
LABEL_16:
        qmemcpy(v11, "InVoid", sizeof(v11));
        sub_2620C("Bad m_LocationType: %s", (char)&v11[0xF * pShip->Unknown_58]);
        sub_261B8(0, "..\\ship.cpp", 0x67A);
        return;
      }
    }
    else
    {
      if ( (unsigned __int8)Unknown_58 > 4u )
      {
        if ( Unknown_58 == 5 )
        {
          pShip->Unknown_59 = (int)&V_Game.t15[pShip->Unknown_59];
          return;
        }
        goto LABEL_16;
      }
      if ( Unknown_58 == 4 )
      {
        pShip->Unknown_59 = (int)&V_Game.stars[pShip->Unknown_59];
        return;
      }
    }
    pShip->Unknown_59 = (int)&V_Game.planets[pShip->Unknown_59];
    return;
  }
  vShip.Unknown_0 = pShip->Unknown_0;
  vShip.Unknown_4 = pShip->Unknown_4;
  vShip.Unknown_8 = pShip->Unknown_8;
  vShip.Unknown_C = pShip->Unknown_C;
  vShip.Unknown_10 = pShip->Unknown_10;
  vShip.Unknown_14 = pShip->Unknown_14;
  vShip.Unknown_18 = pShip->Unknown_18;
  vShip.Unknown_1C = pShip->Unknown_1C;
  vShip.Unknown_20 = pShip->Unknown_20;
  vShip.Unknown_24 = pShip->Unknown_24;
  vShip.Unknown_28 = pShip->Unknown_28;
  vShip.Unknown_2C = pShip->Unknown_2C;
  vShip.Unknown_30 = pShip->Unknown_30;
  qmemcpy(vShip.name, pShip->name, 0x6Au);
  vShip.Unknown_9E = *p_Unknown_9E;
  vShip.Unknown_A2 = p_Unknown_9E[1];
  vShip.Unknown_A6 = p_Unknown_9E[2];
  vShip.Unknown_AA[0] = pShip->Unknown_AA[0];
  _wcpp_2_copy_array_((int)&vShip.Unknown_AA[1], (int)v12, 0x19, (int)&unk_96038);
  vShip.Unknown_15A = pShip->Unknown_15A;
  vShip.Unknown_15E = pShip->Unknown_15E;
  switch ( pShip->Unknown_5D )
  {
    case 0:
    case 7:
      break;
    case 1:
      vShip.Unknown_5E = *(__int16 *)(pShip->Unknown_5E + 4);
      break;
    case 2:
    case 3:
      vShip.Unknown_5E = (pShip->Unknown_5E - (int)V_Game.planets) / 0x7B;
      break;
    case 4:
    case 5:
    case 6:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\ship.cpp", 0x6A7);
      break;
    default:
      Q_AssertLogBreakExit_sub_261A8(0, "..\\ship.cpp", 0x6AC);
      break;
  }
  switch ( pShip->Unknown_58 )
  {
    case 1:
    case 2:
      vShip.Unknown_59 = (pShip->Unknown_59 - (int)V_Game.planets) / 0x7B;
      break;
    case 3:
      Unknown_59 = pShip->Unknown_59;
      if ( !Unknown_59 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x6C0);
      }
      vShip.Unknown_59 = (Unknown_59 - (int)V_Game.planets) / 0x7B;
      break;
    case 4:
      vShip.Unknown_59 = *(__int16 *)(pShip->Unknown_59 + 4);
      break;
    case 5:
      v7 = pShip->Unknown_59;
      if ( !v7 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ship.cpp", 0x6CF);
      }
      vShip.Unknown_59 = (v7 - (int)V_Game.t15) / 0x27;
      break;
    default:
      qmemcpy(v10, "InVoid", sizeof(v10));
      sub_2620C("Bad m_LocationType: %s", (char)&v10[0xF * pShip->Unknown_58]);
      sub_261B8(0, "..\\ship.cpp", 0x6EE);
      break;
  }
  Q_CFILE_CPP_dos_write_sub_1C098(&vfi->fh, &vShip, 0x162u);
}
// 78B30: using guessed type _DWORD __stdcall _wcpp_2_assign_array_(_DWORD);

//----- (0004B5C0) --------------------------------------------------------
int __fastcall sub_4B5C0(int result, int a2)
{
  *(_BYTE *)result = *(_BYTE *)a2;
  *(_WORD *)(result + 1) = *(_WORD *)(a2 + 1);
  *(_DWORD *)(result + 3) = *(_DWORD *)(a2 + 3);
  return result;
}

//----- (0004B5E0) --------------------------------------------------------
int __fastcall sub_4B5E0(_DWORD *a1, int a2)
{
  char *v2; // eax
  int v3; // eax
  int result; // eax

  *a1 = *(_DWORD *)a2;
  a1[1] = *(_DWORD *)(a2 + 4);
  a1[2] = *(_DWORD *)(a2 + 8);
  a1[3] = *(_DWORD *)(a2 + 0xC);
  a1[4] = *(_DWORD *)(a2 + 0x10);
  a1[5] = *(_DWORD *)(a2 + 0x14);
  a1[6] = *(_DWORD *)(a2 + 0x18);
  a1[7] = *(_DWORD *)(a2 + 0x1C);
  a1[8] = *(_DWORD *)(a2 + 0x20);
  a1[9] = *(_DWORD *)(a2 + 0x24);
  a1[0xA] = *(_DWORD *)(a2 + 0x28);
  a1[0xB] = *(_DWORD *)(a2 + 0x2C);
  a1[0xC] = *(_DWORD *)(a2 + 0x30);
  qmemcpy(a1 + 0xD, (const void *)(a2 + 0x34), 0x29u);
  v2 = (char *)a1 + 0x59;
  v2[4] = *(_BYTE *)(a2 + 0x5D);
  v2 += 4;
  *(_DWORD *)(v2 + 1) = *(_DWORD *)(a2 + 0x5E);
  v2[5] = *(_BYTE *)(a2 + 0x62);
  *(_DWORD *)(v2 + 6) = *(_DWORD *)(a2 + 0x63);
  v2[0xA] = *(_BYTE *)(a2 + 0x67);
  *(_DWORD *)(v2 + 0xB) = *(_DWORD *)(a2 + 0x68);
  *(_DWORD *)(v2 + 0xF) = *(_DWORD *)(a2 + 0x6C);
  *(_DWORD *)(v2 + 0x13) = *(_DWORD *)(a2 + 0x70);
  *(float *)(v2 + 0x17) = *(float *)(a2 + 0x74);
  *(_DWORD *)(v2 + 0x1B) = *(_DWORD *)(a2 + 0x78);
  *(_DWORD *)(v2 + 0x1F) = *(_DWORD *)(a2 + 0x7C);
  *(_DWORD *)(v2 + 0x23) = *(_DWORD *)(a2 + 0x80);
  *(_DWORD *)(v2 + 0x27) = *(_DWORD *)(a2 + 0x84);
  v2 += 0xFFFFFFA3;
  *((_DWORD *)v2 + 0x22) = *(_DWORD *)(a2 + 0x88);
  *((_DWORD *)v2 + 0x23) = *(_DWORD *)(a2 + 0x8C);
  *((_DWORD *)v2 + 0x24) = *(_DWORD *)(a2 + 0x90);
  *((_DWORD *)v2 + 0x25) = *(_DWORD *)(a2 + 0x94);
  *((_DWORD *)v2 + 0x26) = *(_DWORD *)(a2 + 0x98);
  *((_WORD *)v2 + 0x4E) = *(_WORD *)(a2 + 0x9C);
  v2 += 0x9E;
  *(_DWORD *)v2 = *(_DWORD *)(a2 + 0x9E);
  *((_DWORD *)v2 + 1) = *(_DWORD *)(a2 + 0xA2);
  *((_DWORD *)v2 + 2) = *(_DWORD *)(a2 + 0xA6);
  v2 += 0xFFFFFF62;
  v2[0xAA] = *(_BYTE *)(a2 + 0xAA);
  v3 = _wcpp_2_copy_array_((int)(v2 + 0xAB), a2 + 0xAB, 0x19, (int)&unk_96038);
  *(_DWORD *)(v3 + 0xAF) = *(_DWORD *)(a2 + 0x15A);
  result = v3 - 0xAB;
  *(_DWORD *)(result + 0x15E) = *(_DWORD *)(a2 + 0x15E);
  return result;
}

//----- (0004B780) --------------------------------------------------------
int __fastcall sub_4B780(int result, int a2)
{
  *(_BYTE *)result = *(_BYTE *)a2;
  *(_WORD *)(result + 1) = *(_WORD *)(a2 + 1);
  *(_DWORD *)(result + 3) = *(_DWORD *)(a2 + 3);
  return result;
}

//----- (0004B7A0) --------------------------------------------------------
int __fastcall sub_4B7A0(int a1, int a2, int a3, __int16 a4)
{
  int v5; // edi
  int v6; // ebp
  int v7; // ebx
  char v8; // dh
  T_Star *v9; // ecx
  int v10; // ebx
  int v11; // ebx
  int v12; // edx
  int v13; // ebx
  int v16; // [esp+Ch] [ebp-14h]

  v16 = 0;
  if ( a4 < 0 || a4 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0x2F);
  }
  if ( *(__int16 *)(a1 + 0x56) < 0 || V_Game.racesNum <= *(__int16 *)(a1 + 0x56) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0x30);
  }
  v5 = a3;
  v6 = 0;
  if ( (*(_WORD *)(a1 + 0x9C) & 0x10) != 0 )
  {
    v5 = 0;
  }
  v7 = *(_DWORD *)(a1 + 0x90);
  if ( v5 > v7 )
  {
    v5 = *(_DWORD *)(a1 + 0x90);
    v6 = a3 - v7;
    LOBYTE(v16) = 2;
  }
  if ( v6 >= *(_DWORD *)(a1 + 0x8C) )
  {
    v6 = *(_DWORD *)(a1 + 0x8C);
    LOBYTE(v16) = v16 | 4;
  }
  if ( a2 == 1 )
  {
    v8 = *(_BYTE *)(a1 + 0x58);
    v9 = 0;
    if ( v8 == 4 )
    {
      v9 = *(T_Star **)(a1 + 0x59);
    }
    else if ( v8 == 3 || v8 == 1 || v8 == 2 )
    {
      v9 = &V_Game.stars[*(__int16 *)(*(_DWORD *)(a1 + 0x59) + 0xC)];
    }
    if ( !v9 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0x53);
    }
    sub_433E0((int)&V_Game.races[*(__int16 *)(a1 + 0x56)], a4, (int)v9);
    v10 = *(_DWORD *)(a1 + 0x8C) - v6;
    *(_DWORD *)(a1 + 0x90) -= v5;
    *(_DWORD *)(a1 + 0x8C) = v10;
    if ( v10 < 1 )
    {
      v11 = *(_DWORD *)(a1 + 0xA7);
      v12 = *(_DWORD *)(a1 + 0x54);
      sub_49940(a1);
      v13 = v11 >> 0x18;
      if ( v12 >> 0x10 == byte_104BEA && *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] != 0x10 )
      {
        sub_55AEC(&V_Type3_stru_10AE70, 0xC, v13, (int)v9);
      }
    }
  }
  return v16;
}

//----- (0004B944) --------------------------------------------------------
int __fastcall sub_4B944(int a1, int a2)
{
  _BYTE *v3; // eax
  unsigned int v4; // ecx
  T_Gizmo *v5; // edi
  int v6; // esi
  double v7; // st7
  __int16 v8; // ax
  BOOL v9; // eax
  int weaponDamage; // ebx
  int v11; // eax
  double v13; // st7
  double v14; // st7
  double v15; // st7
  double v16; // st7
  double v17; // st7
  int v18; // eax
  unsigned int v19; // edx
  int v20; // ebx
  double v21; // st7
  double v22; // st7
  double v23; // st7
  int v24; // ebx
  int special1; // eax
  int v26; // esi
  int v27; // eax
  int v28; // eax
  int v29; // ebp
  float *v30; // ebx
  unsigned int v31; // edx
  int v32; // ecx
  double v33; // st7
  double v34; // st7
  int v35; // ecx
  int v36; // ebx
  int v37; // ebp
  int v38; // eax
  int v39; // edx
  int v40; // ebx
  char v41; // cl
  _BYTE *v42; // eax
  int v43; // ebp
  int i; // edx
  int v45; // eax
  char v46; // ch
  _BYTE *v47; // edx
  int v48; // ebp
  int v49; // eax
  int v50; // ebx
  char v51; // bh
  int v52; // edi
  int v53; // ebx
  _BYTE *v54; // ecx
  char v55; // dh
  int v56; // edx
  char v57; // al
  float *v58; // ebx
  float *v59; // edx
  char v60; // ch
  float x_4; // [esp+4h] [ebp-524h]
  int v62[107]; // [esp+8h] [ebp-520h] BYREF
  int v63[132]; // [esp+1B4h] [ebp-374h] BYREF
  float v64; // [esp+3C4h] [ebp-164h] BYREF
  float v65; // [esp+3C8h] [ebp-160h]
  float v66; // [esp+3CCh] [ebp-15Ch]
  float v67; // [esp+3D0h] [ebp-158h] BYREF
  float v68; // [esp+3D4h] [ebp-154h]
  float v69; // [esp+3D8h] [ebp-150h]
  float v70; // [esp+3DCh] [ebp-14Ch] BYREF
  float v71; // [esp+3E0h] [ebp-148h]
  float v72; // [esp+3E4h] [ebp-144h]
  float v73; // [esp+3E8h] [ebp-140h]
  float v74; // [esp+3ECh] [ebp-13Ch]
  float v75; // [esp+3F0h] [ebp-138h]
  float v76; // [esp+3F4h] [ebp-134h] BYREF
  float v77; // [esp+3F8h] [ebp-130h]
  float v78; // [esp+3FCh] [ebp-12Ch]
  float v79; // [esp+400h] [ebp-128h]
  float v80; // [esp+404h] [ebp-124h]
  float v81; // [esp+408h] [ebp-120h]
  float v82; // [esp+40Ch] [ebp-11Ch] BYREF
  float v83; // [esp+410h] [ebp-118h]
  float v84; // [esp+414h] [ebp-114h]
  float v85; // [esp+418h] [ebp-110h]
  float v86; // [esp+41Ch] [ebp-10Ch]
  float v87; // [esp+420h] [ebp-108h]
  float v88; // [esp+424h] [ebp-104h] BYREF
  float v89; // [esp+428h] [ebp-100h]
  float v90; // [esp+42Ch] [ebp-FCh]
  float v91; // [esp+430h] [ebp-F8h]
  float v92; // [esp+434h] [ebp-F4h]
  float v93; // [esp+438h] [ebp-F0h]
  float v94; // [esp+43Ch] [ebp-ECh]
  float v95; // [esp+440h] [ebp-E8h]
  float v96; // [esp+444h] [ebp-E4h]
  int v97[3]; // [esp+448h] [ebp-E0h] BYREF
  float v98; // [esp+454h] [ebp-D4h]
  float v99; // [esp+458h] [ebp-D0h]
  float v100; // [esp+45Ch] [ebp-CCh]
  float v101; // [esp+460h] [ebp-C8h] BYREF
  float v102; // [esp+464h] [ebp-C4h]
  float v103; // [esp+468h] [ebp-C0h]
  float v104; // [esp+46Ch] [ebp-BCh]
  float v105; // [esp+470h] [ebp-B8h]
  float v106; // [esp+474h] [ebp-B4h]
  float v107; // [esp+478h] [ebp-B0h]
  float v108; // [esp+47Ch] [ebp-ACh]
  float v109; // [esp+480h] [ebp-A8h]
  float v110; // [esp+484h] [ebp-A4h]
  float v111; // [esp+488h] [ebp-A0h]
  float v112; // [esp+48Ch] [ebp-9Ch]
  float v113; // [esp+490h] [ebp-98h] BYREF
  float v114; // [esp+494h] [ebp-94h]
  float v115; // [esp+498h] [ebp-90h]
  float v116; // [esp+49Ch] [ebp-8Ch]
  int v117; // [esp+4A0h] [ebp-88h]
  int v118; // [esp+4A4h] [ebp-84h]
  int *v119; // [esp+4A8h] [ebp-80h]
  float *v120; // [esp+4ACh] [ebp-7Ch]
  float *v121; // [esp+4B0h] [ebp-78h]
  float *v122; // [esp+4B4h] [ebp-74h]
  float *v123; // [esp+4B8h] [ebp-70h]
  float *v124; // [esp+4BCh] [ebp-6Ch]
  float *v125; // [esp+4C0h] [ebp-68h]
  float *v126; // [esp+4C8h] [ebp-60h]
  float *v127; // [esp+4CCh] [ebp-5Ch]
  int v128; // [esp+4D0h] [ebp-58h]
  int v129; // [esp+4D4h] [ebp-54h]
  int power; // [esp+4D8h] [ebp-50h]
  float v131; // [esp+4DCh] [ebp-4Ch]
  float v132; // [esp+4E0h] [ebp-48h]
  float v133; // [esp+4E4h] [ebp-44h]
  int v134; // [esp+4E8h] [ebp-40h]
  int v135; // [esp+4ECh] [ebp-3Ch]
  int v136; // [esp+4F0h] [ebp-38h]
  float v137; // [esp+4F4h] [ebp-34h]
  float v138; // [esp+4F8h] [ebp-30h]
  float v139; // [esp+4FCh] [ebp-2Ch]
  float v140; // [esp+500h] [ebp-28h]
  int v141; // [esp+508h] [ebp-20h]
  char v142; // [esp+50Ch] [ebp-1Ch]
  char v143; // [esp+510h] [ebp-18h]

  v129 = a2;
  v3 = *(_BYTE **)(a1 + 0x63);
  v134 = 0;
  v128 = 0xFFFFFFFF;
  v4 = 0xFFFFFFFF;
  LOBYTE(v3) = *v3;
  power = 0;
  v142 = (char)v3;
  if ( (_BYTE)v3 == 0xFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0xA2);
  }
  v5 = &V_Gizmos[v142];
  if ( v5->power > *(_DWORD *)(a1 + 0x88) )
  {
    v128 = 0;
  }
  else
  {
    power = v5->power;
  }
  v6 = *(_DWORD *)(a1 + 0x68);
  if ( !v6 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0xAD);
  }
  if ( *(_BYTE *)(a1 + 0x58) != 4 || *(_BYTE *)(v6 + 0x58) != 4 || *(_DWORD *)(a1 + 0x59) != *(_DWORD *)(v6 + 0x59) )
  {
    goto LABEL_18;
  }
  if ( v5->range )
  {
    v119 = v97;
    v104 = 0.0;
    v105 = 0.0;
    v106 = 0.0;
    v104 = *(float *)(v6 + 0x9E) - *(float *)(a1 + 0x9E);
    v105 = *(float *)(v6 + 0xA2) - *(float *)(a1 + 0xA2);
    v106 = *(float *)(v6 + 0xA6) - *(float *)(a1 + 0xA6);
    *(float *)v97 = v104;
    *(float *)&v97[1] = v105;
    *(float *)&v97[2] = v106;
    v7 = sqrt(v105 * v105 + v104 * v104 + v106 * v106);
    v141 = 0x20 * v5->range;
    v8 = *(_WORD *)(a1 + 0x9C);
    v131 = v7;
    v133 = (float)v141;
    if ( (v8 & 4) != 0 )
    {
      v133 = v133 * flt_928C7;
    }
    if ( v131 > (double)v133 )
    {
      v4 = 0;
    }
    if ( v142 == 0x2F && v133 * dbl_928CB > v131 )
    {
LABEL_18:
      v4 = 0;
    }
  }
  v9 = v128 && v4 && v6 != a1 && (v5->flags & 1) != 0;
  v134 |= v9;
  if ( (v134 & 1) == 0 )
  {
    return v134;
  }
  *(_DWORD *)(a1 + 0x78) = *(_DWORD *)(v6 + 0x9E);
  *(_DWORD *)(a1 + 0x7C) = *(_DWORD *)(v6 + 0xA2);
  *(_DWORD *)(a1 + 0x80) = *(_DWORD *)(v6 + 0xA6);
  weaponDamage = 0;
  if ( !v5->cat )
  {
    weaponDamage = v5->weaponDamage;
  }
  if ( v142 == 0x2F )
  {
    weaponDamage = v5->special1;
  }
  if ( weaponDamage )
  {
    v11 = sub_4B7A0(v6, v129, weaponDamage, *(_WORD *)(a1 + 0x56));
    v134 |= v11;
  }
  else
  {
    LOBYTE(v134) = v134 | 0x10;
  }
  if ( v129 != 1 )
  {
    return v134;
  }
  v56 = *(_DWORD *)(a1 + 0x88) - power;
  v57 = v142;
  *(_DWORD *)(a1 + 0x88) = v56;
  if ( (unsigned __int8)v57 < 0x32u )
  {
    if ( (unsigned __int8)v57 < 0x25u )
    {
      if ( (unsigned __int8)v57 >= 0x22u )
      {
        if ( (unsigned __int8)v57 <= 0x22u )
        {
          *(_DWORD *)(v6 + 0x52) = V_Game.day;
          return v134;
        }
        else
        {
          if ( v57 == 0x23 )
          {
            *(_DWORD *)(v6 + 0x88) = 0;
          }
          return v134;
        }
      }
      if ( v57 == 0x21 )
      {
        v55 = *(_BYTE *)(v6 + 0x9C);
        *(_DWORD *)(v6 + 0x94) = 0;
        *(_BYTE *)(v6 + 0x9C) = v55 | 1;
        return v134;
      }
      return v134;
    }
    if ( (unsigned __int8)v57 > 0x25u )
    {
      if ( (unsigned __int8)v57 < 0x2Du )
      {
        if ( v57 != 0x28 )
        {
          return v134;
        }
        v28 = sub_1D794(*(__int16 **)(a1 + 0x59), v62);
        v29 = 0;
        if ( v28 > 0 )
        {
          v30 = (float *)(v6 + 0x9E);
          v31 = 0;
          v135 = 4 * v28;
          do
          {
            v32 = v62[v31 / 4];
            if ( v6 != v32 )
            {
              v125 = &v82;
              v79 = 0.0;
              v80 = 0.0;
              v81 = 0.0;
              v79 = *(float *)(v32 + 0x9E) - *v30;
              v80 = *(float *)(v32 + 0xA2) - *(float *)(v6 + 0xA2);
              v81 = *(float *)(v32 + 0xA6) - *(float *)(v6 + 0xA6);
              v82 = v79;
              v83 = v80;
              v84 = v81;
              v33 = sqrt(v80 * v80 + v79 * v79 + v81 * v81);
              v141 = 0x20 * v5->special1;
              v137 = (float)v141;
              if ( v33 < v137 )
              {
                sub_53054(&v82, v137);
                v91 = 0.0;
                v92 = 0.0;
                v93 = 0.0;
                v123 = &v70;
                v91 = *v30 + v82;
                v92 = *(float *)(v6 + 0xA2) + v83;
                v34 = *(float *)(v6 + 0xA6);
                v70 = v91;
                v93 = v34 + v84;
                v71 = v92;
                v35 = v62[v31 / 4];
                v72 = v93;
                *(float *)(v35 + 0x9E) = v91;
                *(float *)(v35 + 0xA2) = v71;
                *(float *)(v35 + 0xA6) = v72;
              }
            }
            v31 += 4;
            ++v29;
          }
          while ( (int)v31 < v135 );
        }
      }
      else
      {
        if ( (unsigned __int8)v57 <= 0x2Du )
        {
          v121 = &v64;
          v94 = 0.0;
          v95 = 0.0;
          v96 = 0.0;
          v94 = *(float *)(v6 + 0x9E) - *(float *)(a1 + 0x9E);
          v95 = *(float *)(v6 + 0xA2) - *(float *)(a1 + 0xA2);
          v13 = *(float *)(v6 + 0xA6) - *(float *)(a1 + 0xA6);
          v64 = v94;
          v96 = v13;
          v65 = v95;
          v66 = v96;
          v141 = 0x20 * v5->special1;
          x_4 = (float)v141;
          sub_53054(&v64, x_4);
          v120 = &v76;
          v110 = 0.0;
          v111 = 0.0;
          v112 = 0.0;
          v110 = *(float *)(v6 + 0x9E) + v64;
          v111 = *(float *)(v6 + 0xA2) + v65;
          v14 = *(float *)(v6 + 0xA6) + v66;
          v76 = v110;
          v112 = v14;
          v77 = v111;
          v78 = v112;
          *(float *)(v6 + 0x9E) = v110;
          *(float *)(v6 + 0xA2) = v77;
          *(float *)(v6 + 0xA6) = v78;
          return v134;
        }
        if ( (unsigned __int8)v57 >= 0x30u )
        {
          if ( (unsigned __int8)v57 > 0x30u )
          {
            v60 = *(_BYTE *)(v6 + 0x9C);
            *(_DWORD *)(v6 + 0x90) = 0;
            *(_BYTE *)(v6 + 0x9C) = v60 | 8;
            return v134;
          }
          v52 = *(_DWORD *)(v6 + 0x15A);
          v53 = 0;
          v54 = (_BYTE *)(v6 + 0xAB);
          while ( v53 < v52 )
          {
            if ( *v54 == 0x47 || *v54 == 0x49 )
            {
              sub_492F8((_DWORD *)v6, v53);
            }
            ++v53;
            v52 = *(_DWORD *)(v6 + 0x15A);
            v54 += 7;
          }
        }
      }
      return v134;
    }
LABEL_84:
    v143 = 0;
    if ( v142 == 0x42 )
    {
      v143 = 5;
    }
    v47 = (_BYTE *)(v6 + 0xAB);
    v48 = 0;
    v49 = 0;
    if ( *(int *)(v6 + 0x15A) > 0 )
    {
      v50 = 0;
      do
      {
        if ( *v47 != 0xFF && V_Gizmos[(char)*v47].cat == v143 )
        {
          ++v50;
          ++v48;
          v63[v50 + 0x6A] = v49;
        }
        ++v49;
        v47 += 7;
      }
      while ( v49 < *(_DWORD *)(v6 + 0x15A) );
    }
    if ( v48 )
    {
      sub_492F8((_DWORD *)v6, v63[V_Game.day % v48 + 0x6B]);
      return v134;
    }
    return v134;
  }
  if ( (unsigned __int8)v57 <= 0x32u )
  {
LABEL_74:
    v41 = 5;
    if ( v142 == 0x32 )
    {
      v41 = 0;
    }
    v42 = (_BYTE *)(v6 + 0xAB);
    v43 = 0;
    for ( i = 0; i < *(_DWORD *)(v6 + 0x15A); v42 += 7 )
    {
      if ( *v42 != 0xFF && v41 == V_Gizmos[(char)*v42].cat )
      {
        ++v43;
      }
      ++i;
    }
    v45 = *(_DWORD *)(v6 + 0x8C) - v43;
    *(_DWORD *)(v6 + 0x8C) = v45;
    if ( v45 < 1 )
    {
      v46 = v134 | 4;
      sub_49940(v6);
      LOBYTE(v134) = v46;
      return v134;
    }
    return v134;
  }
  v58 = (float *)(v6 + 0x9E);
  if ( (unsigned __int8)v57 < 0x3Du )
  {
    v59 = (float *)(a1 + 0x9E);
    if ( (unsigned __int8)v57 < 0x36u )
    {
      if ( v57 != 0x34 )
      {
        return v134;
      }
      v126 = &v113;
      v73 = 0.0;
      v74 = 0.0;
      v75 = 0.0;
      v73 = *v58 - *v59;
      v74 = *(float *)(v6 + 0xA2) - *(float *)(a1 + 0xA2);
      v75 = *(float *)(v6 + 0xA6) - *(float *)(a1 + 0xA6);
      v113 = v73;
      v114 = v74;
      v115 = v75;
      v15 = sqrt(v74 * v74 + v73 * v73 + v75 * v75);
      v141 = 0x20 * v5->special1;
      v16 = v15 - (double)v141;
      v132 = v16;
      if ( v16 < flt_928D3 )
      {
        v132 = 64.0;
      }
      sub_53054(&v113, v132);
      v98 = 0.0;
      v99 = 0.0;
      v100 = 0.0;
      v127 = &v101;
      v98 = *(float *)(a1 + 0x9E) + v113;
      v99 = *(float *)(a1 + 0xA2) + v114;
      v17 = *(float *)(a1 + 0xA6);
      v101 = v98;
      v100 = v17 + v115;
      v102 = v99;
      v103 = v100;
      *(float *)(v6 + 0x9E) = v98;
      *(float *)(v6 + 0xA2) = v102;
      *(float *)(v6 + 0xA6) = v103;
      return v134;
    }
    if ( (unsigned __int8)v57 > 0x36u )
    {
      if ( (unsigned __int8)v57 <= 0x37u )
      {
        v116 = *v59;
        v117 = *(_DWORD *)(a1 + 0xA2);
        v118 = *(_DWORD *)(a1 + 0xA6);
        *v59 = *v58;
        *(_DWORD *)(a1 + 0xA2) = *(_DWORD *)(v6 + 0xA2);
        *(_DWORD *)(a1 + 0xA6) = *(_DWORD *)(v6 + 0xA6);
        *v58 = v116;
        *(_DWORD *)(v6 + 0xA2) = v117;
        *(_DWORD *)(v6 + 0xA6) = v118;
        return v134;
      }
      if ( v57 != 0x3B )
      {
        return v134;
      }
      special1 = *(_DWORD *)(v6 + 0x98) - *(_DWORD *)(v6 + 0x8C);
      if ( special1 > v5->special1 )
      {
        special1 = v5->special1;
      }
      *(_DWORD *)(v6 + 0x8C) += special1;
      v26 = *(_DWORD *)(a1 + 0x8C) - special1;
      *(_DWORD *)(a1 + 0x8C) = v26;
      if ( v26 < 1 )
      {
        sub_49940(a1);
        return v134;
      }
      return v134;
    }
    goto LABEL_74;
  }
  if ( (unsigned __int8)v57 <= 0x3Du )
  {
    sub_49940(v6);
    v51 = v134 | 4;
    sub_492F8((_DWORD *)a1, (*(_DWORD *)(a1 + 0x63) - (a1 + 0xAB)) / 7);
    LOBYTE(v134) = v51;
    return v134;
  }
  if ( (unsigned __int8)v57 < 0x42u )
  {
    if ( v57 != 0x40 )
    {
      return v134;
    }
    v36 = *(_DWORD *)(v6 + 0x15E);
    if ( !v36 )
    {
      return v134;
    }
    v37 = V_Game.day % v36;
    v38 = 0;
    v39 = 0;
    if ( *(int *)(v6 + 0x15A) <= 0 )
    {
      return v134;
    }
    v40 = v6;
    do
    {
      if ( *(_BYTE *)(v40 + 0xAB) != 0xFF )
      {
        if ( v39 == v37 )
        {
          sub_492F8((_DWORD *)v6, v38);
          return v134;
        }
        ++v39;
      }
      ++v38;
      v40 += 7;
    }
    while ( v38 < *(_DWORD *)(v6 + 0x15A) );
    return v134;
  }
  if ( (unsigned __int8)v57 <= 0x42u )
  {
    goto LABEL_84;
  }
  if ( (unsigned __int8)v57 < 0x44u )
  {
    return v134;
  }
  if ( (unsigned __int8)v57 > 0x44u )
  {
    if ( v57 != 0x4A )
    {
      return v134;
    }
    v18 = sub_1D794(*(__int16 **)(a1 + 0x59), v63);
    if ( v18 > 0 )
    {
      v19 = 0;
      v136 = 4 * v18;
      do
      {
        v20 = v63[v19 / 4];
        if ( v6 != v20 )
        {
          v122 = &v88;
          v107 = 0.0;
          v108 = 0.0;
          v109 = 0.0;
          v107 = *(float *)(v20 + 0x9E) - *(float *)(v6 + 0x9E);
          v108 = *(float *)(v20 + 0xA2) - *(float *)(v6 + 0xA2);
          v109 = *(float *)(v20 + 0xA6) - *(float *)(v6 + 0xA6);
          v88 = v107;
          v89 = v108;
          v90 = v109;
          v21 = sqrt(v108 * v108 + v107 * v107 + v109 * v109);
          v141 = 0x20 * v5->special2;
          v138 = v21;
          v139 = (float)v141;
          if ( v138 > (double)v139 )
          {
            v141 = 0x20 * v5->special1;
            v22 = v138 - (double)v141;
            v140 = v22;
            if ( v22 < v139 )
            {
              v140 = v139;
            }
            sub_53054(&v88, v140);
            v124 = &v67;
            v85 = 0.0;
            v86 = 0.0;
            v87 = 0.0;
            v85 = *(float *)(v6 + 0x9E) + v88;
            v86 = *(float *)(v6 + 0xA2) + v89;
            v23 = *(float *)(v6 + 0xA6);
            v67 = v85;
            v87 = v23 + v90;
            v68 = v86;
            v24 = v63[v19 / 4];
            v69 = v87;
            *(float *)(v24 + 0x9E) = v85;
            *(float *)(v24 + 0xA2) = v68;
            *(float *)(v24 + 0xA6) = v69;
          }
        }
        v19 += 4;
      }
      while ( (int)v19 < v136 );
    }
    return v134;
  }
  v27 = *(_DWORD *)(v6 + 0x18) - *(_DWORD *)(v6 + 0x88);
  if ( v27 > v56 )
  {
    v27 = v56;
  }
  *(_DWORD *)(v6 + 0x88) += v27;
  *(_DWORD *)(a1 + 0x88) -= v27;
  return v134;
}
// 928C7: using guessed type float flt_928C7;
// 928CB: using guessed type double dbl_928CB;
// 928D3: using guessed type float flt_928D3;

//----- (0004C7FC) --------------------------------------------------------
int __fastcall sub_4C7FC(int a1, int a2)
{
  char v2; // cl
  T_Gizmo *v3; // esi
  unsigned int v4; // edi
  int v5; // ebp
  int power; // eax
  T_Planet *v7; // ebp
  float *v8; // edx
  double v9; // st7
  __int16 v10; // ax
  BOOL v11; // eax
  unsigned __int8 *a; // esi
  int v14; // edi
  float x; // [esp+8h] [ebp-60h]
  float y; // [esp+Ch] [ebp-5Ch]
  float z; // [esp+10h] [ebp-58h]
  int v18[3]; // [esp+14h] [ebp-54h] BYREF
  float v19; // [esp+20h] [ebp-48h]
  float v20; // [esp+24h] [ebp-44h]
  float v21; // [esp+28h] [ebp-40h]
  int *v22; // [esp+2Ch] [ebp-3Ch]
  int v23; // [esp+30h] [ebp-38h]
  int v24; // [esp+34h] [ebp-34h]
  float v25; // [esp+38h] [ebp-30h]
  int v26; // [esp+3Ch] [ebp-2Ch]
  int v27; // [esp+40h] [ebp-28h]
  float v28; // [esp+44h] [ebp-24h]
  int v29; // [esp+48h] [ebp-20h]
  _DWORD *v30; // [esp+4Ch] [ebp-1Ch]
  int v31; // [esp+50h] [ebp-18h]

  v30 = (_DWORD *)a1;
  v24 = a2;
  v2 = **(_BYTE **)(a1 + 0x63);
  v29 = 0;
  v26 = 0;
  v3 = &V_Gizmos[v2];
  v4 = 0xFFFFFFFF;
  v5 = *(_DWORD *)(a1 + 0x88);
  power = v3->power;
  v27 = 0xFFFFFFFF;
  if ( power > v5 )
  {
    v27 = 0;
  }
  else
  {
    v26 = power;
  }
  v7 = (T_Planet *)v30[0x1A];
  if ( !v7 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0x217);
  }
  x = v7->v.x;
  y = v7->v.y;
  v8 = (float *)v30;
  z = v7->v.z;
  v30[0x1E] = LODWORD(v7->v.x);
  v8[0x1F] = y;
  v8[0x20] = z;
  if ( v3->range )
  {
    v22 = v18;
    v19 = 0.0;
    v20 = 0.0;
    v21 = 0.0;
    v19 = x - *(float *)((char *)v30 + 0x9E);
    v20 = y - *(float *)((char *)v30 + 0xA2);
    v21 = z - *(float *)((char *)v30 + 0xA6);
    *(float *)v18 = v19;
    *(float *)&v18[1] = v20;
    *(float *)&v18[2] = v21;
    v9 = sqrt(v20 * v20 + v19 * v19 + v21 * v21);
    v23 = 0x20 * v3->range;
    v10 = *((_WORD *)v30 + 0x4E);
    v25 = v9;
    v28 = (float)v23;
    if ( (v10 & 4) != 0 )
    {
      v28 = v28 * flt_928E6;
    }
    if ( v25 > (double)v28 )
    {
      v4 = 0;
    }
    if ( v2 == 0x2F && v28 * dbl_928EA > v25 )
    {
      v4 = 0;
    }
  }
  v11 = v27 && v4 && (v3->flags & 0xC) != 0;
  v29 |= v11;
  if ( (v29 & 1) == 0 || v24 != 1 )
  {
    return v29;
  }
  v30[0x22] -= v26;
  if ( !v3->cat )
  {
    sub_36A5C(v7, v3->weaponDamage, *((_WORD *)v30 + 0x2B));
    return v29;
  }
  if ( v2 != 0x46 )
  {
    return v29;
  }
  a = (unsigned __int8 *)v7->a;
  v14 = 0;
  v31 = 0;
  while ( v14 < v7->word18 && v31 < 5 )
  {
    if ( *a != 0xFF
      && (*((_WORD *)a + 1) & 1) != 0
      && !V_PlanetItems.item[a[1]].mpop
      && sub_34B0C(v7, (unsigned __int16)v14, 0xFFu, 1u) == 0xFFFFFFFF )
    {
      ++v31;
    }
    ++v14;
    a += 4;
  }
  sub_492F8(v30, (*(_DWORD *)((char *)v30 + 0x63) - ((int)v30 + 0xAB)) / 7);
  return v29;
}
// 928E6: using guessed type float flt_928E6;
// 928EA: using guessed type double dbl_928EA;

//----- (0004CAB8) --------------------------------------------------------
int __fastcall sub_4CAB8(int a1, int a2)
{
  unsigned __int8 v3; // cl
  T_Gizmo *v4; // ebp
  int v5; // edx
  int power; // eax
  int v7; // esi
  double v8; // st7
  int range; // eax
  BOOL v10; // eax
  float *v12; // eax
  float *v13; // edx
  float *v14; // eax
  int v15; // ebx
  int v16; // edx
  T_Ship *ships; // eax
  int v18; // ecx
  int v19[3]; // [esp+8h] [ebp-78h] BYREF
  int v20[3]; // [esp+14h] [ebp-6Ch] BYREF
  float v21; // [esp+20h] [ebp-60h]
  float v22; // [esp+24h] [ebp-5Ch]
  float v23; // [esp+28h] [ebp-58h]
  float v24; // [esp+2Ch] [ebp-54h]
  float v25; // [esp+30h] [ebp-50h]
  float v26; // [esp+34h] [ebp-4Ch]
  float v27; // [esp+38h] [ebp-48h]
  float v28; // [esp+3Ch] [ebp-44h]
  float v29; // [esp+40h] [ebp-40h]
  int *v30; // [esp+44h] [ebp-3Ch]
  int v31; // [esp+48h] [ebp-38h]
  int *v32; // [esp+4Ch] [ebp-34h]
  float v33; // [esp+50h] [ebp-30h]
  int v34; // [esp+54h] [ebp-2Ch]
  int v35; // [esp+58h] [ebp-28h]
  int v36; // [esp+5Ch] [ebp-24h]
  int v37; // [esp+60h] [ebp-20h]
  int v38; // [esp+64h] [ebp-1Ch]
  int v39; // [esp+68h] [ebp-18h]

  v34 = a2;
  v3 = **(_BYTE **)(a1 + 0x63);
  v38 = 0;
  v37 = 0xFFFFFFFF;
  v4 = &V_Gizmos[(char)v3];
  v35 = 0;
  v5 = *(_DWORD *)(a1 + 0x88);
  power = v4->power;
  v36 = 0xFFFFFFFF;
  if ( power > v5 )
  {
    v36 = 0;
  }
  else
  {
    v35 = power;
  }
  v7 = *(_DWORD *)(a1 + 0x68);
  if ( !v7 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0x275);
  }
  v27 = *(float *)(v7 + 0x14);
  v28 = *(float *)(v7 + 0x18);
  v29 = *(float *)(v7 + 0x1C);
  if ( *(_DWORD *)v7 == *(_DWORD *)(a1 + 0x59) )
  {
    v27 = *(float *)(v7 + 8);
    v28 = *(float *)(v7 + 0xC);
    v29 = *(float *)(v7 + 0x10);
  }
  *(float *)(a1 + 0x78) = v27;
  *(float *)(a1 + 0x7C) = v28;
  *(float *)(a1 + 0x80) = v29;
  v24 = 0.0;
  v25 = 0.0;
  v26 = 0.0;
  v30 = v19;
  v24 = v27 - *(float *)(a1 + 0x9E);
  v25 = v28 - *(float *)(a1 + 0xA2);
  v26 = v29 - *(float *)(a1 + 0xA6);
  *(float *)v19 = v24;
  *(float *)&v19[1] = v25;
  *(float *)&v19[2] = v26;
  v8 = sqrt(v25 * v25 + v24 * v24 + v26 * v26);
  range = v4->range;
  v33 = v8;
  if ( range )
  {
    v31 = 0x20 * range;
    if ( (double)(0x20 * range) < v33 )
    {
      v37 = 0;
    }
  }
  v10 = v36 && v37 && (v4->flags & 2) != 0;
  v38 |= v10;
  if ( v34 != 1 || (v38 & 1) == 0 )
  {
    return v38;
  }
  *(_DWORD *)(a1 + 0x88) -= v35;
  if ( !v4->cat && v4->weaponDamage > 1 )
  {
    *(_BYTE *)(v7 + 0x23) &= ~2u;
    return v38;
  }
  if ( v3 < 0x33u )
  {
    if ( v3 == 0x20 )
    {
      *(_BYTE *)(v7 + 0x23) |= 2u;
      return v38;
    }
    return v38;
  }
  if ( v3 <= 0x33u )
  {
    v13 = *(float **)(v7 + 4);
    v14 = *(float **)v7;
    v32 = v20;
    v15 = 0;
    v21 = 0.0;
    v22 = 0.0;
    v23 = 0.0;
    v21 = v14[2] - v13[2];
    v22 = v14[3] - v13[3];
    v23 = v14[4] - v13[4];
    *(float *)v20 = v21;
    *(float *)&v20[1] = v22;
    *(float *)&v20[2] = v23;
    v16 = 0;
    *(float *)&v39 = sqrt(v22 * v22 + v21 * v21 + v23 * v23);
    ships = V_Game.ships;
    do
    {
      if ( v16 >= V_Game.shipsNum )
      {
        break;
      }
      if ( ships->raceIndex != 0xFFFFFFFF )
      {
        if ( ships->Unknown_58 == 5 && v7 == ships->Unknown_59 )
        {
          ships->Unknown_9E = v39;
        }
        ++v16;
      }
      ++v15;
      ++ships;
    }
    while ( v15 < 0x6B );
    goto LABEL_37;
  }
  if ( v3 < 0x3Cu )
  {
    return v38;
  }
  if ( v3 <= 0x3Cu )
  {
    v18 = *(_DWORD *)v7;
    if ( *(_DWORD *)v7 == *(_DWORD *)(a1 + 0x59) )
    {
      v18 = *(_DWORD *)(v7 + 4);
    }
    sub_1D538(*(_DWORD *)(a1 + 0x59), a1);
    *(_BYTE *)(a1 + 0x58) = 5;
    *(_DWORD *)(a1 + 0x59) = v7;
    sub_1D3E8(v18, a1, 0);
LABEL_37:
    sub_492F8((_DWORD *)a1, (*(_DWORD *)(a1 + 0x63) - (a1 + 0xAB)) / 7);
    return v38;
  }
  if ( v3 != 0x3E )
  {
    return v38;
  }
  v12 = *(float **)v7;
  if ( *(_DWORD *)v7 == *(_DWORD *)(a1 + 0x59) )
  {
    v12 = *(float **)(v7 + 4);
  }
  *((_BYTE *)v12 + 0x17) |= 1 << *(_BYTE *)(a1 + 0x56);
  return v38;
}

//----- (0004CDF8) --------------------------------------------------------
int __fastcall sub_4CDF8(int a1, int a2)
{
  unsigned __int8 *v3; // ecx
  int power; // ebp
  unsigned __int8 v5; // cl
  T_Gizmo *v6; // edi
  double v8; // st7
  int v9; // eax
  int v10; // ebx
  unsigned int v11; // edx
  int v12; // eax
  double v13; // st7
  double v14; // st7
  int v15; // edi
  int v16; // ebp
  P_Star star; // eax
  int v18; // eax
  unsigned int v19; // ebp
  int v20; // edx
  double v21; // st7
  int v22; // edx
  int v23; // ecx
  int i; // edx
  char *v25; // eax
  char v26; // bh
  int v27; // ebx
  int v28; // eax
  int v29; // ebp
  int v30; // eax
  int v31; // ecx
  int v32; // edx
  int v33; // ebp
  int v34; // eax
  float *v35; // edx
  unsigned int v36; // ebx
  int v37; // ecx
  double v38; // st7
  double v39; // st7
  int v40; // ecx
  int v41; // eax
  int v42[107]; // [esp+8h] [ebp-770h] BYREF
  int v43[107]; // [esp+1B4h] [ebp-5C4h] BYREF
  int v44[107]; // [esp+360h] [ebp-418h] BYREF
  int v45[107]; // [esp+50Ch] [ebp-26Ch] BYREF
  float v46; // [esp+6B8h] [ebp-C0h]
  float v47; // [esp+6BCh] [ebp-BCh]
  float v48; // [esp+6C0h] [ebp-B8h]
  float v49; // [esp+6C4h] [ebp-B4h] BYREF
  float v50; // [esp+6C8h] [ebp-B0h]
  float v51; // [esp+6CCh] [ebp-ACh]
  float v52; // [esp+6D0h] [ebp-A8h] BYREF
  float v53; // [esp+6D4h] [ebp-A4h]
  float v54; // [esp+6D8h] [ebp-A0h]
  float v55; // [esp+6DCh] [ebp-9Ch] BYREF
  float v56; // [esp+6E0h] [ebp-98h]
  float v57; // [esp+6E4h] [ebp-94h]
  float v58; // [esp+6E8h] [ebp-90h]
  float v59; // [esp+6ECh] [ebp-8Ch]
  float v60; // [esp+6F0h] [ebp-88h]
  float v61; // [esp+6F4h] [ebp-84h]
  float v62; // [esp+6F8h] [ebp-80h]
  float v63; // [esp+6FCh] [ebp-7Ch]
  int v64[3]; // [esp+700h] [ebp-78h] BYREF
  float v65; // [esp+70Ch] [ebp-6Ch]
  float v66; // [esp+710h] [ebp-68h]
  float v67; // [esp+714h] [ebp-64h]
  float *v68; // [esp+718h] [ebp-60h]
  float *v69; // [esp+71Ch] [ebp-5Ch]
  int *v70; // [esp+720h] [ebp-58h]
  float *v71; // [esp+728h] [ebp-50h]
  int v72; // [esp+730h] [ebp-48h]
  int v73; // [esp+734h] [ebp-44h]
  int v74; // [esp+738h] [ebp-40h]
  int v75; // [esp+73Ch] [ebp-3Ch]
  int v76; // [esp+740h] [ebp-38h]
  int v77; // [esp+744h] [ebp-34h]
  int v78; // [esp+748h] [ebp-30h]
  float v79; // [esp+74Ch] [ebp-2Ch]
  float v80; // [esp+750h] [ebp-28h]
  float *v81; // [esp+754h] [ebp-24h]
  float v82; // [esp+758h] [ebp-20h]
  float v83; // [esp+75Ch] [ebp-1Ch]
  int v84; // [esp+760h] [ebp-18h]

  v77 = a2;
  v3 = *(unsigned __int8 **)(a1 + 0x63);
  power = 0;
  v73 = 0;
  v5 = *v3;
  v72 = 0xFFFFFFFF;
  if ( v5 == 0xFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipgiz.cpp", 0x2EA);
  }
  v6 = &V_Gizmos[(char)v5];
  if ( v6->power > *(_DWORD *)(a1 + 0x88) )
  {
    v72 = 0;
  }
  else
  {
    power = v6->power;
  }
  v73 |= v72 != 0;
  if ( (v73 & 1) == 0 )
  {
    return v73;
  }
  if ( v77 != 1 )
  {
    return v73;
  }
  *(_DWORD *)(a1 + 0x88) -= power;
  if ( v5 < 0x39u )
  {
    if ( v5 < 0x27u )
    {
      if ( v5 >= 0x24u )
      {
        if ( v5 <= 0x24u )
        {
          sub_1D538(*(_DWORD *)(a1 + 0x59), a1);
          star = V_Game.races[*(__int16 *)(a1 + 0x56)].star;
          *(_DWORD *)(a1 + 0x59) = star;
          sub_1D3E8((int)star, a1, 0);
          return v73;
        }
        if ( v5 == 0x26 )
        {
          v28 = sub_1D794(*(__int16 **)(a1 + 0x59), v43);
          v78 = 0;
          if ( v28 > 0 )
          {
            v29 = 0;
            v75 = 4 * v28;
            do
            {
              v30 = v43[v29 / 4u];
              v31 = *(__int16 *)(a1 + 0x56);
              v32 = *(__int16 *)(v30 + 0x56);
              if ( v32 != v31 && V_Game.races[v31].Unknown_1C0[v32] == 2 )
              {
                sub_4B7A0(v30, v77, v6->special1, v31);
              }
              v29 += 4;
              ++v78;
            }
            while ( v29 < v75 );
          }
          sub_492F8((_DWORD *)a1, (*(_DWORD *)(a1 + 0x63) - (a1 + 0xAB)) / 7);
          return v73;
        }
      }
    }
    else if ( v5 <= 0x27u )
    {
      v33 = 0;
      v34 = sub_1D794(*(__int16 **)(a1 + 0x59), v42);
      if ( v34 > 0 )
      {
        v35 = (float *)(a1 + 0x9E);
        v36 = 0;
        v76 = 4 * v34;
        do
        {
          v37 = v42[v36 / 4];
          if ( a1 != v37 )
          {
            v71 = &v55;
            v46 = 0.0;
            v47 = 0.0;
            v48 = 0.0;
            v46 = *(float *)(v37 + 0x9E) - *v35;
            v47 = *(float *)(v37 + 0xA2) - *(float *)(a1 + 0xA2);
            v48 = *(float *)(v37 + 0xA6) - *(float *)(a1 + 0xA6);
            v55 = v46;
            v56 = v47;
            v57 = v48;
            v38 = sqrt(v47 * v47 + v46 * v46 + v48 * v48);
            v84 = 0x20 * v6->special1;
            v79 = (float)v84;
            if ( v38 < v79 )
            {
              sub_53054(&v55, v79);
              v58 = 0.0;
              v59 = 0.0;
              v60 = 0.0;
              v68 = &v52;
              v58 = *v35 + v55;
              v59 = *(float *)(a1 + 0xA2) + v56;
              v39 = *(float *)(a1 + 0xA6);
              v52 = v58;
              v60 = v39 + v57;
              v53 = v59;
              v40 = v42[v36 / 4];
              v54 = v60;
              *(float *)(v40 + 0x9E) = v58;
              *(float *)(v40 + 0xA2) = v53;
              *(float *)(v40 + 0xA6) = v54;
            }
          }
          v36 += 4;
          ++v33;
        }
        while ( (int)v36 < v76 );
      }
    }
    else
    {
      if ( v5 < 0x35u )
      {
        if ( v5 == 0x2E )
        {
          v69 = &v49;
          v65 = 0.0;
          v66 = 0.0;
          v67 = 0.0;
          v65 = -*(float *)(a1 + 0x9E);
          v66 = -*(float *)(a1 + 0xA2);
          v8 = -*(float *)(a1 + 0xA6);
          v49 = v65;
          v67 = v8;
          v50 = v66;
          v51 = v67;
          *(float *)(a1 + 0x9E) = v65;
          *(float *)(a1 + 0xA2) = v50;
          *(float *)(a1 + 0xA6) = v51;
        }
        return v73;
      }
      if ( v5 <= 0x35u )
      {
        *(_DWORD *)(a1 + 0x8C) -= v6->special1;
        v23 = *(_DWORD *)(a1 + 0x8C);
        *(_DWORD *)(a1 + 0x88) += v6->special2;
        if ( v23 < 1 )
        {
          goto LABEL_29;
        }
      }
      else
      {
        if ( v5 != 0x38 )
        {
          return v73;
        }
        v9 = sub_1D794(*(__int16 **)(a1 + 0x59), v44);
        if ( v9 > 0 )
        {
          v10 = 4 * v9;
          v11 = 0;
          do
          {
            v12 = v44[v11 / 4];
            if ( *(_BYTE *)(v12 + 0x58) == 4 )
            {
              v13 = sqrt(
                      *(float *)(v12 + 0xA2) * *(float *)(v12 + 0xA2)
                    + *(float *)(v12 + 0x9E) * *(float *)(v12 + 0x9E)
                    + *(float *)(v12 + 0xA6) * *(float *)(v12 + 0xA6));
              v84 = 0x20 * v6->special2;
              v80 = v13;
              v82 = (float)v84;
              if ( v80 > (double)v82 )
              {
                v84 = 0x20 * v6->special1;
                v14 = v80 - (double)v84;
                v83 = v14;
                if ( v14 < v82 )
                {
                  v83 = v82;
                }
                sub_53054((float *)(v44[v11 / 4] + 0x9E), v83);
              }
            }
            v11 += 4;
          }
          while ( (int)v11 < v10 );
        }
      }
    }
    return v73;
  }
  if ( v5 <= 0x39u )
  {
    *(_BYTE *)(a1 + 0x9C) |= 4u;
    return v73;
  }
  if ( v5 < 0x41u )
  {
    if ( v5 <= 0x3Au )
    {
      v15 = v6->special1 + *(_DWORD *)(a1 + 0x8C);
      v16 = *(_DWORD *)(a1 + 0x98);
      *(_DWORD *)(a1 + 0x8C) = v15;
      if ( v15 > v16 )
      {
        *(_DWORD *)(a1 + 0x8C) = v16;
        return v73;
      }
    }
    else
    {
      if ( v5 != 0x3F )
      {
        return v73;
      }
      v41 = sub_49328(a1, 2);
      if ( v41 != 0xFFFFFFFF )
      {
        sub_492F8((_DWORD *)a1, v41);
        *(_BYTE *)(a1 + 0x9C) |= 2u;
        return v73;
      }
    }
    return v73;
  }
  v25 = (char *)(a1 + 0xAB);
  if ( v5 <= 0x41u )
  {
    for ( i = 0; i < *(_DWORD *)(a1 + 0x15A); v25 += 7 )
    {
      v26 = *v25;
      if ( *v25 != (char)0xFF && v26 != 0x41 )
      {
        v27 = v26;
        if ( V_Gizmos[v27].numUses )
        {
          *(_WORD *)(v25 + 1) = V_Gizmos[v27].numUses;
        }
      }
      ++i;
    }
    return v73;
  }
  if ( v5 >= 0x48u )
  {
    if ( v5 > 0x48u )
    {
      if ( v5 == 0x4B )
      {
        v22 = *(_DWORD *)(a1 + 0x63);
        *(_DWORD *)(a1 + 0x88) += v6->special1;
        sub_492F8((_DWORD *)a1, (v22 - (int)v25) / 7);
      }
      return v73;
    }
    v18 = sub_1D794(*(__int16 **)(a1 + 0x59), v45);
    if ( v18 > 0 )
    {
      v19 = 0;
      v81 = (float *)(a1 + 0x9E);
      v74 = 4 * v18;
      do
      {
        v20 = v45[v19 / 4];
        if ( a1 != v20 )
        {
          v61 = 0.0;
          v62 = 0.0;
          v63 = 0.0;
          v70 = v64;
          v61 = *(float *)(v20 + 0x9E) - *v81;
          v62 = *(float *)(v20 + 0xA2) - v81[1];
          v63 = *(float *)(v20 + 0xA6) - v81[2];
          *(float *)v64 = v61;
          *(float *)&v64[1] = v62;
          *(float *)&v64[2] = v63;
          v21 = sqrt(v62 * v62 + v61 * v61 + v63 * v63);
          v84 = 0x20 * v6->range;
          if ( (double)v84 >= v21 )
          {
            sub_4B7A0(v45[v19 / 4], v77, v6->special1, *(_WORD *)(a1 + 0x56));
          }
        }
        v19 += 4;
      }
      while ( (int)v19 < v74 );
    }
LABEL_29:
    sub_49940(a1);
    return v73;
  }
  if ( v5 == 0x45 )
  {
    *(_BYTE *)(a1 + 0x9C) |= 0x10u;
    sub_492F8((_DWORD *)a1, (*(_DWORD *)(a1 + 0x63) - (int)v25) / 7);
  }
  return v73;
}

//----- (0004D700) --------------------------------------------------------
void sub_4D700()
{
  _wcpp_2_mod_register_(&unk_96AC0);
  sub_48B90((P_Ship)((char *)&V_Gizmos[0x4C].special2 + 2));
  dword_96AC8 = 1;
}
// 786DA: using guessed type int __fastcall _wcpp_2_mod_register_(_DWORD);
// 96AC8: using guessed type int dword_96AC8;

//----- (0004D724) --------------------------------------------------------
int __fastcall sub_4D724(T_Type5 *a1, int a2, LONG a3, int a4)
{
  void *ShapeTable_sub_1B084; // eax
  T_Rect *p_rect; // esi

  if ( a4 )
  {
    VFX_pane_wipe((PANE *)a1, 0x96);
  }
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           (unsigned __int16)word_FFED8);
  if ( !ShapeTable_sub_1B084 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x34);
  }
  VFX_shape_draw((PANE *)a1, ShapeTable_sub_1B084, a3, 0x3F, 0x2D);
  V_Type3_stru_10AE70.pane.window = &a1->a->window;
  p_rect = &a1->rect;
  V_Type3_stru_10AE70.pane.x0 = p_rect->x1;
  p_rect = (T_Rect *)((char *)p_rect + 4);
  V_Type3_stru_10AE70.pane.y0 = p_rect->x1;
  p_rect = (T_Rect *)((char *)p_rect + 4);
  V_Type3_stru_10AE70.pane.x1 = p_rect->x1;
  V_Type3_stru_10AE70.pane.y1 = p_rect->y1;
  return sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0x3F, 2, V_Gizmos[a3].name, 8, 0xFFFFFFFF, 0xFF, 0x7A);
}

//----- (0004D7A8) --------------------------------------------------------
unsigned int __fastcall sub_4D7A8(int a1, int a2, int a3)
{
  unsigned int v3; // ebx
  __int64 v4; // rtt
  int v5; // edi
  char v6; // al
  int i; // edx
  char v8; // al
  int v9; // edx
  int v12; // [esp+4h] [ebp-20h]
  int v13; // [esp+Ch] [ebp-18h]
  int v14; // [esp+10h] [ebp-14h]

  v3 = 0xFFFFFFFF;
  if ( a2 - 0x94 > 0 )
  {
    LODWORD(v4) = (a2 - 0x94 - (a1 - 0x16F) / 2 + 0x12) / 2;
    HIDWORD(v4) = v4;
    v13 = v4 / 0x12;
    v12 = (unsigned __int8)byte_969A8[v13];
    if ( v13 < 0xE
      && !byte_969A8[v13]
      && v12 + (unsigned __int8)byte_969B8[v13] > 0
      && ((1 << -(char)v12) & (unsigned __int8)byte_106FE0[4 * v13 + a3]) != 0 )
    {
      v5 = 0;
      if ( v13 > 0 )
      {
        v14 = a3;
        do
        {
          v6 = 1;
          for ( i = 0; i < (unsigned __int8)byte_969B8[v5]; ++i )
          {
            if ( ((unsigned __int8)v6 & (unsigned __int8)byte_106FE0[v14]) != 0 )
            {
              ++v3;
            }
            v6 *= 2;
          }
          ++v5;
          v14 += 4;
        }
        while ( v5 < v13 );
      }
      v8 = 1;
      v9 = 0;
      if ( !byte_969A8[v13] )
      {
        do
        {
          if ( ((unsigned __int8)v8 & (unsigned __int8)byte_106FE0[4 * v13 + a3]) != 0 )
          {
            ++v3;
          }
          ++v9;
          v8 *= 2;
        }
        while ( v9 <= -v12 );
      }
    }
  }
  return v3;
}

//----- (0004D92C) --------------------------------------------------------
char *__fastcall sub_4D92C(int a1)
{
  int v1; // eax
  int v2; // edx

  Q_A2_sub_2C830((P_TypeA2)a1);
  sub_48B90((P_Ship)(a1 + 0xCD));
  v2 = v1 - 0xCD;
  *(_DWORD *)(v2 + 0xA7) = off_9607C;
  *(_BYTE *)(v2 + 0xBB) = 0xFF;
  *(_BYTE *)(v2 + 0xBC) = 0;
  *(_DWORD *)(v2 + 0xBD) = 0xFFFFFFFF;
  *(_DWORD *)(v2 + 0xC1) = 0xFFFFFFFF;
  *(_DWORD *)(v2 + 0xC5) = 0;
  *(_DWORD *)(v2 + 0xAB) = 0;
  *(_DWORD *)(v2 + 0xC9) = 0;
  sub_4DA5C(v1 - 0xCD);
  return (char *)v2;
}
// 4D93E: variable 'v1' is possibly undefined
// 9607C: using guessed type int (*off_9607C[5])();

//----- (0004DA08) --------------------------------------------------------
void *__fastcall sub_4DA08(int a1, char a2, int a3, int a4)
{
  void *v5; // eax
  int v7; // eax
  void *v8; // eax
  void *v9; // ebx

  if ( (a2 & 4) != 0 )
  {
    v5 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_96068);
    operator delete[](v5);
    return (void *)a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_9607C;
    v7 = sub_48C58();
    v8 = (void *)sub_2C848(v7 - 0xCD, 1);
    v9 = v8;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v8);
    }
    return v9;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 9607C: using guessed type int (*off_9607C[5])();

//----- (0004DA5C) --------------------------------------------------------
int __fastcall sub_4DA5C(int result)
{
  if ( dword_96ACC )
  {
    *(_DWORD *)(result + 0xB7) = 0x4C;
    dword_96ACC = 0;
  }
  return result;
}
// 96ACC: using guessed type int dword_96ACC;

//----- (0004DA7C) --------------------------------------------------------
int __fastcall sub_4DA7C(int a1, int a2, int a3, int a4)
{
  int result; // eax
  int v6; // [esp+8h] [ebp-10h]

  sub_4DA5C(a1);
  *(_DWORD *)(a1 + 0xAB) = a2;
  *(_DWORD *)(a1 + 0xC9) = a3;
  if ( a3 == 0xFFFFFFFF )
  {
    v6 = *(_DWORD *)(a1 + 0xAB);
    *(_DWORD *)(a1 + 0xCD) = *(_DWORD *)v6;
    *(_DWORD *)(a1 + 0xD1) = *(_DWORD *)(v6 + 4);
    *(_DWORD *)(a1 + 0xD5) = *(_DWORD *)(v6 + 8);
    *(_DWORD *)(a1 + 0xD9) = *(_DWORD *)(v6 + 0xC);
    *(_DWORD *)(a1 + 0xDD) = *(_DWORD *)(v6 + 0x10);
    *(_DWORD *)(a1 + 0xE1) = *(_DWORD *)(v6 + 0x14);
    *(_DWORD *)(a1 + 0xE5) = *(_DWORD *)(v6 + 0x18);
    *(_DWORD *)(a1 + 0xE9) = *(_DWORD *)(v6 + 0x1C);
    *(_DWORD *)(a1 + 0xED) = *(_DWORD *)(v6 + 0x20);
    *(_DWORD *)(a1 + 0xF1) = *(_DWORD *)(v6 + 0x24);
    *(_DWORD *)(a1 + 0xF5) = *(_DWORD *)(v6 + 0x28);
    *(_DWORD *)(a1 + 0xF9) = *(_DWORD *)(v6 + 0x2C);
    *(_DWORD *)(a1 + 0xFD) = *(_DWORD *)(v6 + 0x30);
    qmemcpy((void *)(a1 + 0x101), (const void *)(v6 + 0x34), 0x29u);
    *(_DWORD *)(a1 + 0x126) = *(_DWORD *)(v6 + 0x59);
    *(_DWORD *)(a1 + 0x126) = *(_DWORD *)(v6 + 0x59);
    *(_BYTE *)(a1 + 0x12A) = *(_BYTE *)(v6 + 0x5D);
    *(_DWORD *)(a1 + 0x12B) = *(_DWORD *)(v6 + 0x5E);
    *(_BYTE *)(a1 + 0x12F) = *(_BYTE *)(v6 + 0x62);
    *(_DWORD *)(a1 + 0x130) = *(_DWORD *)(v6 + 0x63);
    *(_BYTE *)(a1 + 0x134) = *(_BYTE *)(v6 + 0x67);
    *(_DWORD *)(a1 + 0x135) = *(_DWORD *)(v6 + 0x68);
    *(_DWORD *)(a1 + 0x135) = *(_DWORD *)(v6 + 0x68);
    *(_DWORD *)(a1 + 0x135) = *(_DWORD *)(v6 + 0x68);
    *(_DWORD *)(a1 + 0x135) = *(_DWORD *)(v6 + 0x68);
    *(_DWORD *)(a1 + 0x139) = *(_DWORD *)(v6 + 0x6C);
    *(_DWORD *)(a1 + 0x13D) = *(_DWORD *)(v6 + 0x70);
    *(_DWORD *)(a1 + 0x141) = *(_DWORD *)(v6 + 0x74);
    *(float *)(a1 + 0x145) = *(float *)(v6 + 0x78);
    *(_DWORD *)(a1 + 0x149) = *(_DWORD *)(v6 + 0x7C);
    *(float *)(a1 + 0x14D) = *(float *)(v6 + 0x80);
    *(_DWORD *)(a1 + 0x151) = *(_DWORD *)(v6 + 0x84);
    *(_DWORD *)(a1 + 0x155) = *(_DWORD *)(v6 + 0x88);
    *(_DWORD *)(a1 + 0x159) = *(_DWORD *)(v6 + 0x8C);
    *(_DWORD *)(a1 + 0x15D) = *(_DWORD *)(v6 + 0x90);
    *(_DWORD *)(a1 + 0x161) = *(_DWORD *)(v6 + 0x94);
    *(_DWORD *)(a1 + 0x165) = *(_DWORD *)(v6 + 0x98);
    *(_WORD *)(a1 + 0x169) = *(_WORD *)(v6 + 0x9C);
    *(float *)(a1 + 0x16B) = *(float *)(v6 + 0x9E);
    *(_DWORD *)(a1 + 0x16F) = *(_DWORD *)(v6 + 0xA2);
    *(float *)(a1 + 0x173) = *(float *)(v6 + 0xA6);
    *(_BYTE *)(a1 + 0x177) = *(_BYTE *)(v6 + 0xAA);
    _wcpp_2_assign_array_(sub_4B780);
    *(_DWORD *)(a1 + 0x227) = *(_DWORD *)(v6 + 0x15A);
    *(_DWORD *)(a1 + 0x22B) = *(_DWORD *)(v6 + 0x15E);
  }
  result = a4;
  *(_DWORD *)(a1 + 0x233) = a4;
  return result;
}
// 78B30: using guessed type _DWORD __stdcall _wcpp_2_assign_array_(_DWORD);

//----- (0004DD14) --------------------------------------------------------
char __fastcall sub_4DD14(int a1)
{
  int v2; // eax
  int v3; // edi
  int v4; // ebp
  int resReq; // eax
  int v6; // edx
  unsigned __int16 v7; // ax

  LOBYTE(v2) = sub_2ED4C(*(_DWORD *)(a1 + 0xC5));
  v3 = 0;
  if ( *(int *)(a1 + 0xB7) > 0 )
  {
    v4 = 0;
    do
    {
      LOBYTE(v2) = V_Gizmos[v4].cat;
      if ( (_BYTE)v2 == *(_BYTE *)(a1 + 0xBC) )
      {
        resReq = (unsigned __int8)V_Gizmos[v4].resReq;
        if ( resReq == 0xFF
          || (v6 = (char)V_ResTree.items[resReq].z2[0], v2 = 1 << byte_104BEA, ((1 << byte_104BEA) & v6) != 0) )
        {
          v7 = sub_2EA8C(*(_DWORD *)(a1 + 0xC5), (const char *)a1, 0xFFFFFFFF, 0);
          LOBYTE(v2) = sub_2EC50(*(_DWORD *)(a1 + 0xC5), v7, v3);
        }
      }
      ++v3;
      ++v4;
    }
    while ( v3 < *(_DWORD *)(a1 + 0xB7) );
  }
  return v2;
}

//----- (0004DDB0) --------------------------------------------------------
unsigned int __fastcall sub_4DDB0(int a1, __int16 a2, int a3, int a4)
{
  char v5; // al
  int v6; // ebx
  int v7; // ebx
  unsigned int result; // eax
  T_TypeA1 *Wnd_sub_56DA8; // eax
  int v10; // ecx
  double v11; // st7
  double v12; // st7
  int i; // esi
  int v14; // edi
  int v15; // edx
  int v16; // ebx
  int v17; // edx
  int v18; // ebx

  if ( (unsigned __int16)a2 < 0x32u )
  {
    if ( (unsigned __int16)a2 >= 5u )
    {
      if ( (unsigned __int16)a2 <= 5u )
      {
        if ( *(_DWORD *)(a1 + 0x35)
          && a3 >= *(_DWORD *)(a1 + 8)
          && a3 <= *(_DWORD *)(a1 + 0x10)
          && a4 >= *(_DWORD *)(a1 + 0xC)
          && a4 <= *(_DWORD *)(a1 + 0x14) )
        {
          if ( *(_DWORD *)(a1 + 0x233) == 0xFFFFFFFF )
          {
            return 0xFFFFFFFF;
          }
          if ( dword_96AD0 >= 0 )
          {
            if ( !*(_DWORD *)(a1 + 0xAB) )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x1D8);
            }
            if ( sub_492F8(*(_DWORD **)(a1 + 0xAB), dword_96AD0) )
            {
              v17 = *(__int16 *)(a1 + 0x59);
              if ( v17 != 0xFFFFFFFF )
              {
                Q_StartSample_sub_4FB90(&V_SoundSystem, v17);
              }
              *(_DWORD *)(a1 + 0xBD) = 0xFFFFFFFF;
              v18 = *(_DWORD *)(a1 + 0xA7);
              *(_DWORD *)(a1 + 0x22F) = 0xFFFFFFFF;
              (*(void (**)(void))(v18 + 0xC))();
            }
          }
          return 0xFFFFFFFF;
        }
      }
      else
      {
        if ( (unsigned __int16)a2 < 7u )
        {
          if ( *(_DWORD *)(a1 + 0x233) == 0xFFFFFFFF )
          {
            return 0xFFFFFFFF;
          }
          sub_567BC(&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 8);
          if ( *(_DWORD *)(a1 + 0x39) && *(_DWORD *)(a1 + 0x35) && (dword_96AD0 >= 0 || *(_DWORD *)(a1 + 0x3D)) )
          {
            dword_96AD0 = 0xFFFFFFFF;
            (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
          }
          else
          {
            dword_96AD0 = 0xFFFFFFFF;
          }
          return 0xFFFFFFFF;
        }
        if ( (unsigned __int16)a2 <= 7u )
        {
          if ( *(_DWORD *)(a1 + 0x233) == 0xFFFFFFFF )
          {
            return 0xFFFFFFFF;
          }
          sub_56728((int)&V_Type3_stru_10AE70, *(_DWORD *)(a1 + 0x41), 4, 8, 0, 0);
          if ( (*(_DWORD *)(a1 + 0x3D) & *(_DWORD *)(a1 + 0x35) & *(_DWORD *)(a1 + 0x39)) == 0xFFFFFFFF )
          {
            (*(void (**)(void))(*(_DWORD *)(a1 + 0xA7) + 0x10))();
          }
          return 0xFFFFFFFF;
        }
        if ( a2 != 8 )
        {
          return sub_2F424(a1, a2, a3, a4);
        }
        if ( *(_DWORD *)(a1 + 0x233) != 0xFFFFFFFF )
        {
          if ( !*(_DWORD *)(a1 + 0xAB) )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x13D);
          }
          dword_96AD0 = sub_4D7A8(a3, a4, *(char *)(*(_DWORD *)(a1 + 0xAB) + 0xAA));
          (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
          return 0;
        }
      }
      return 0;
    }
    if ( (unsigned __int16)a2 < 2u )
    {
      if ( a2 == 1 )
      {
        if ( *(_DWORD *)(a1 + 0xAB) )
        {
          sub_4DA5C(a1);
        }
        else
        {
          *(_DWORD *)(a1 + 0xAB) = (char *)&V_Gizmos[0x4C].special2 + 2;
        }
        *(_DWORD *)(a1 + 0xC1) = 0xFFFFFFFF;
        *(_DWORD *)(a1 + 0x22F) = 0;
        Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "GIZLIST", 0);
        *(_DWORD *)(a1 + 0xC5) = Wnd_sub_56DA8;
        if ( !Wnd_sub_56DA8 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x153);
        }
        *(_DWORD *)(*(_DWORD *)(a1 + 0xC5) + 0xAB) = 0;
        sub_2F1C8(*(_DWORD *)(a1 + 0xC5), (int)sub_4D724);
        *(_WORD *)(*(_DWORD *)(a1 + 0xC5) + 0x8C9) = 0x40;
        sub_2E9CC(*(_DWORD *)(a1 + 0xC5), 0);
        *(_BYTE *)(*(_DWORD *)(a1 + 0xC5) + 0xC6) = 0xF2;
        if ( *(_BYTE *)(a1 + 0xBB) == 0xFF )
        {
          sub_4E644(a1, 4, 0, a4);
        }
        else
        {
          sub_4DD14(a1);
        }
        *(_DWORD *)(a1 + 0xBD) = 0xFFFFFFFF;
        *(_DWORD *)(a1 + 0x39) = 0xFFFFFFFF;
        *(_DWORD *)(a1 + 0x35) = 0xFFFFFFFF;
        (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
        sub_2D258(a1, a2);
        return 0;
      }
    }
    else
    {
      if ( (unsigned __int16)a2 <= 2u )
      {
        *(_DWORD *)(a1 + 0x39) = 0;
        *(_DWORD *)(a1 + 0x35) = 0;
        v10 = *(_DWORD *)(a1 + 0xAB);
        dword_96AD0 = 0xFFFFFFFF;
        if ( (int *)((char *)&V_Gizmos[0x4C].special2 + 2) != (int *)v10 )
        {
          *(_QWORD *)((char *)&V_Gizmos[0x4C].special2 + 2) = *(_QWORD *)v10;
          *(_QWORD *)((char *)&V_Gizmos[0x4C].shieldStrength + 2) = *(_QWORD *)(v10 + 8);
          *(_QWORD *)((char *)&V_Gizmos[0x4C].driveMaxDistance + 2) = *(_QWORD *)(v10 + 0x10);
          *(int *)((char *)&V_Gizmos[0x4C].generatorPower + 2) = *(_DWORD *)(v10 + 0x18);
          *(_DWORD *)&V_Gizmos[0x4D].name[2] = *(_DWORD *)(v10 + 0x1C);
          *(_DWORD *)&V_Gizmos[0x4D].name[6] = *(_DWORD *)(v10 + 0x20);
          *(_DWORD *)&V_Gizmos[0x4D].name[0xA] = *(_DWORD *)(v10 + 0x24);
          *(_DWORD *)&V_Gizmos[0x4D].name[0xE] = *(_DWORD *)(v10 + 0x28);
          *(_DWORD *)&V_Gizmos[0x4D].name[0x12] = *(_DWORD *)(v10 + 0x2C);
          *(_DWORD *)&V_Gizmos[0x4D].name[0x16] = *(_DWORD *)(v10 + 0x30);
          qmemcpy(&V_Gizmos[0x4D].name[0x1A], (const void *)(v10 + 0x34), 0x1Eu);
          *(int *)((char *)&V_Gizmos[0x4D].power + 2) = *(_DWORD *)(v10 + 0x52);
          HIWORD(V_Gizmos[0x4D].range) = *(_WORD *)(v10 + 0x56);
          LOBYTE(V_Gizmos[0x4D].level) = *(_BYTE *)(v10 + 0x58);
          *(int *)((char *)&V_Gizmos[0x4D].level + 1) = *(_DWORD *)(v10 + 0x59);
          *(int *)((char *)&V_Gizmos[0x4D].level + 1) = *(_DWORD *)(v10 + 0x59);
          *(int *)((char *)&V_Gizmos[0x4D].level + 1) = *(_DWORD *)(v10 + 0x59);
          BYTE1(V_Gizmos[0x4D].numUses) = *(_BYTE *)(v10 + 0x5D);
          *(int *)((char *)&V_Gizmos[0x4D].numUses + 2) = *(_DWORD *)(v10 + 0x5E);
          BYTE2(V_Gizmos[0x4D].industry) = *(_BYTE *)(v10 + 0x62);
          *(int *)((char *)&V_Gizmos[0x4D].industry + 3) = *(_DWORD *)(v10 + 0x63);
          HIBYTE(V_Gizmos[0x4D].special1) = *(_BYTE *)(v10 + 0x67);
          V_Gizmos[0x4D].special2 = *(_DWORD *)(v10 + 0x68);
          V_Gizmos[0x4D].special2 = *(_DWORD *)(v10 + 0x68);
          V_Gizmos[0x4D].special2 = *(_DWORD *)(v10 + 0x68);
          V_Gizmos[0x4D].special2 = *(_DWORD *)(v10 + 0x68);
          V_Gizmos[0x4D].weaponDamage = *(int *)(v10 + 0x6C);
          V_Gizmos[0x4D].shieldStrength = *(_DWORD *)(v10 + 0x70);
          V_Gizmos[0x4D].Unknown_5A = *(int *)(v10 + 0x74);
          V_Gizmos[0x4D].driveMaxDistance = *(int *)(v10 + 0x78);
          V_Gizmos[0x4D].scannerRangePerTurn = *(_DWORD *)(v10 + 0x7C);
          v11 = *(float *)(v10 + 0x80);
          dword_10906C = *(_DWORD *)(v10 + 0x84);
          unk_109070 = *(_DWORD *)(v10 + 0x88);
          unk_109074 = *(_DWORD *)(v10 + 0x8C);
          unk_109078 = *(_DWORD *)(v10 + 0x90);
          unk_10907C = *(_DWORD *)(v10 + 0x94);
          unk_109080 = *(_DWORD *)(v10 + 0x98);
          unk_109084 = *(_WORD *)(v10 + 0x9C);
          *(float *)&V_Gizmos[0x4D].generatorPower = v11;
          unk_109086 = *(float *)(v10 + 0x9E);
          unk_10908A = *(_DWORD *)(v10 + 0xA2);
          v12 = *(float *)(v10 + 0xA6);
          unk_109092 = *(_BYTE *)(v10 + 0xAA);
          unk_10908E = v12;
          _wcpp_2_assign_array_(sub_4B780);
          unk_109142 = *(_DWORD *)(v10 + 0x15A);
          unk_109146 = *(_DWORD *)(v10 + 0x15E);
        }
        for ( i = 0; (__int16)i < *(__int16 *)(a1 + 0x6B); ++i )
        {
          v14 = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4 * (__int16)i) + 0xA7);
          (*(void (**)(void))(v14 + 8))();
        }
        if ( !*(_DWORD *)(a1 + 0x22F) )
        {
          *(_DWORD *)(a1 + 0xAB) = 0;
          return 0;
        }
        return 0;
      }
      if ( a2 == 4 )
      {
        result = *(_DWORD *)(a1 + 0x35);
        if ( !result )
        {
          return result;
        }
        if ( a3 >= *(_DWORD *)(a1 + 8)
          && a3 <= *(_DWORD *)(a1 + 0x10)
          && a4 >= *(_DWORD *)(a1 + 0xC)
          && a4 <= *(_DWORD *)(a1 + 0x14) )
        {
          if ( *(_DWORD *)(a1 + 0x233) == 0xFFFFFFFF )
          {
            return 0xFFFFFFFF;
          }
          if ( dword_96AD0 >= 0 )
          {
            if ( !*(_DWORD *)(a1 + 0xAB) )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x1B2);
            }
            if ( sub_492AC(*(_DWORD **)(a1 + 0xAB), *(_BYTE *)(a1 + 0xBB), dword_96AD0) )
            {
              v15 = *(__int16 *)(a1 + 0x59);
              if ( v15 != 0xFFFFFFFF )
              {
                Q_StartSample_sub_4FB90(&V_SoundSystem, v15);
              }
              *(_DWORD *)(a1 + 0xBD) = 0xFFFFFFFF;
              v16 = *(_DWORD *)(a1 + 0xA7);
              *(_DWORD *)(a1 + 0x22F) = 0xFFFFFFFF;
              (*(void (**)(void))(v16 + 0xC))();
            }
          }
          return 0xFFFFFFFF;
        }
        return 0;
      }
    }
    return sub_2F424(a1, a2, a3, a4);
  }
  if ( (unsigned __int16)a2 <= 0x32u )
  {
    if ( *(_DWORD *)(a1 + 0x233) != 0xFFFFFFFF )
    {
      if ( sub_4E69C(a1) )
      {
        *(_DWORD *)(a1 + 0xC1) = 0xFFFFFFFF;
      }
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
      return 0;
    }
    return 0;
  }
  if ( (unsigned __int16)a2 >= 0x36u )
  {
    if ( (unsigned __int16)a2 <= 0x36u )
    {
      sub_4E644(a1, 2, a3, a4);
      return 0;
    }
    if ( (unsigned __int16)a2 < 0x39u )
    {
      if ( a2 == 0x37 )
      {
        sub_4E644(a1, 4, a3, a4);
        return 0;
      }
      return sub_2F424(a1, a2, a3, a4);
    }
    if ( (unsigned __int16)a2 <= 0x39u )
    {
      sub_4E644(a1, 5, a3, a4);
      return 0;
    }
    if ( (unsigned __int16)a2 < 0x1C01u )
    {
      return sub_2F424(a1, a2, a3, a4);
    }
    if ( (unsigned __int16)a2 > 0x1C01u )
    {
      if ( a2 == 0x1C02 )
      {
        v7 = (char)sub_2ECA4(*(_DWORD *)(a1 + 0xC5), a3);
        sub_56B60(&V_Type3_stru_10AE70, 5, v7, 4);
        return 0xFFFFFFFF;
      }
      return sub_2F424(a1, a2, a3, a4);
    }
    v5 = sub_2ECA4(*(_DWORD *)(a1 + 0xC5), a3);
    if ( v5 != *(_BYTE *)(a1 + 0xBB) )
    {
      v6 = *(_DWORD *)(a1 + 0xA7);
      *(_BYTE *)(a1 + 0xBB) = v5;
      (*(void (__fastcall **)(int, _DWORD))(v6 + 0xC))(a1, 0);
    }
    return 0;
  }
  if ( (unsigned __int16)a2 < 0x34u )
  {
    sub_4E644(a1, 0, a3, a4);
    return 0;
  }
  else
  {
    if ( (unsigned __int16)a2 <= 0x34u )
    {
      sub_4E644(a1, 1, a3, a4);
    }
    else
    {
      sub_4E644(a1, 3, a3, a4);
    }
    return 0;
  }
}
// 78B30: using guessed type _DWORD __stdcall _wcpp_2_assign_array_(_DWORD);
// 96AD0: using guessed type int dword_96AD0;
// 10906C: using guessed type int dword_10906C;

//----- (0004E644) --------------------------------------------------------
int __fastcall sub_4E644(int result, char a2, int a3, int a4)
{
  int v4; // ebx
  int v5; // eax

  v4 = result;
  if ( a2 >= 0 && a2 < 6 && a2 != *(_BYTE *)(result + 0xBC) )
  {
    *(_BYTE *)(result + 0xBC) = a2;
    sub_4DD14(result);
    v5 = *(_DWORD *)(v4 + 0xC5);
    *(_BYTE *)(v4 + 0xBB) = 0xFF;
    if ( *(_WORD *)(v5 + 0x8C7) )
    {
      *(_BYTE *)(v4 + 0xBB) = sub_2ECA4(v5, 0);
    }
    return (*(int (**)(void))(*(_DWORD *)(v4 + 0xA7) + 0xC))();
  }
  return result;
}

//----- (0004E69C) --------------------------------------------------------
unsigned int __fastcall sub_4E69C(int a1)
{
  unsigned int v2; // ebp
  int v3; // ebx
  unsigned int v4; // esi
  T_Ship *v5; // eax
  int v6; // eax

  v2 = 0;
  v3 = *(char *)(*(_DWORD *)(a1 + 0xAB) + 0xAA);
  v4 = 0;
  if ( !*(_DWORD *)(a1 + 0xC9) )
  {
    while ( !v4 )
    {
      if ( ++v3 >= 4 )
      {
        v3 = 0;
      }
      if ( (v3 != 2 || ((1 << byte_104BEA) & (char)V_ResTree.items[0x13].z2[0]) != 0)
        && (v3 != 3 || ((1 << byte_104BEA) & (char)V_ResTree.items[0x1F].z2[0]) != 0) )
      {
        v5 = *(T_Ship **)(a1 + 0xAB);
        if ( v3 == v5->Unknown_AA[0] )
        {
          v4 = 0xFFFFFFFF;
          v2 = 0;
        }
        else
        {
          sub_493BC(v5, v3);
          if ( v6 )
          {
            v4 = 0xFFFFFFFF;
            v2 = 0xFFFFFFFF;
            *(_DWORD *)(a1 + 0xBD) = 0xFFFFFFFF;
          }
        }
      }
    }
  }
  return v2;
}
// 4E739: variable 'v6' is possibly undefined

//----- (0004E758) --------------------------------------------------------
void __fastcall sub_4E758(_DWORD *a1)
{
  int v1; // esi
  int v2; // eax
  int v3; // edi
  int v4; // esi
  int v5; // eax
  unsigned __int16 v6; // dx
  unsigned __int16 v7; // ax
  char v8; // bh
  void *ShapeTable_sub_1B084; // eax
  void *v10; // eax
  void *v11; // ecx
  _DWORD *v12; // ebx
  T_Planet *planet; // edx
  int v14; // eax
  int TurnsToComplete_sub_46C20; // eax
  int v16; // eax
  char *sub_1CEA8; // eax
  int v18; // eax
  int v19; // eax
  int v20; // edx
  int v21; // edi
  int v22; // esi
  LONG v23; // [esp-Ch] [ebp-7Eh]
  LONG v24; // [esp-Ch] [ebp-7Eh]
  __int16 v25; // [esp-Ch] [ebp-7Eh]
  LONG v26; // [esp-8h] [ebp-7Ah]
  int v27; // [esp-8h] [ebp-7Ah]
  LONG v28; // [esp-8h] [ebp-7Ah]
  LONG v29; // [esp-4h] [ebp-76h]
  char s[52]; // [esp+0h] [ebp-72h] BYREF
  char v31[52]; // [esp+34h] [ebp-3Eh] BYREF
  PANE pane; // [esp+68h] [ebp-Ah] BYREF
  PANE v33; // [esp+7Ch] [ebp+Ah] BYREF
  int v34[5]; // [esp+90h] [ebp+1Eh]
  PANE a2; // [esp+A4h] [ebp+32h] BYREF
  _DWORD *v36; // [esp+B8h] [ebp+46h]
  int v37; // [esp+BCh] [ebp+4Ah]
  int v38; // [esp+C0h] [ebp+4Eh]
  int v39; // [esp+C4h] [ebp+52h]
  LONG v40; // [esp+C8h] [ebp+56h]
  int v41; // [esp+CCh] [ebp+5Ah]
  unsigned int v42; // [esp+D0h] [ebp+5Eh]
  int i; // [esp+D4h] [ebp+62h]
  void *shape_table; // [esp+D8h] [ebp+66h]
  LONG shape_number; // [esp+DCh] [ebp+6Ah]
  int v46; // [esp+E0h] [ebp+6Eh]
  int v47; // [esp+E4h] [ebp+72h]
  LONG hotY; // [esp+E8h] [ebp+76h]
  int v49; // [esp+ECh] [ebp+7Ah]
  unsigned __int8 v50; // [esp+F0h] [ebp+7Eh]

  v36 = a1;
  if ( !*(_DWORD *)((char *)a1 + 0xAB) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x24A);
  }
  v1 = *(char *)(*(_DWORD *)((char *)v36 + 0xAB) + 0xAA);
  pane.window = (WINDOW *)&V_Type6_stru_D8654;
  pane.x0 = 0x14A;
  pane.y0 = 0x72;
  pane.x1 = 0x1DC;
  pane.y1 = 0x1D8;
  v41 = v1;
  VFX_pane_wipe(&pane, 0);
  pane.y1 = 0x1D8;
  pane.x1 = 0x149;
  pane.x0 = 7;
  pane.y0 = 0x159;
  v2 = VFX_pane_wipe(&pane, 0);
  LOWORD(v2) = word_FFED8;
  v38 = 0;
  v49 = v2;
  for ( i = 0; i < 0xE; ++i )
  {
    v3 = 0x12 * (i + (unsigned __int8)byte_969A8[i]) + 0xA6;
    v4 = 0x24 * ((unsigned __int8)byte_969A8[i] - i) + 0x193;
    v5 = (unsigned __int8)byte_969B8[i];
    v50 = 1;
    v47 = v5;
    v37 = 0;
    if ( v5 > 0 )
    {
      v46 = v41;
      v39 = 7 * v38;
      while ( (v50 & (unsigned __int8)byte_106FE0[v46]) == 0 )
      {
LABEL_12:
        v50 *= 2;
        v4 += 0x24;
        v3 += 0x12;
        if ( ++v37 >= v47 )
        {
          goto LABEL_4;
        }
      }
      if ( dword_96AD0 >= 0 && dword_96AD0 == v38 )
      {
        if ( *((_BYTE *)v36 + 0xBB) != 0xFF )
        {
          v29 = v3;
          v26 = v4;
          v23 = *((char *)v36 + 0xBB);
          v6 = v49;
LABEL_23:
          ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, v6);
          VFX_shape_draw(&V_Type6_stru_D8654.pane, ShapeTable_sub_1B084, v23, v26, v29);
          v39 += 7;
          ++v38;
          goto LABEL_12;
        }
        v29 = v3;
        v26 = v4;
        v7 = *((_WORD *)v36 + 0xC);
        v23 = 1;
      }
      else
      {
        if ( !*(_DWORD *)((char *)v36 + 0xAB) )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x28D);
        }
        v8 = *(_BYTE *)(v39 + *(_DWORD *)((char *)v36 + 0xAB) + 0xAB);
        if ( v8 != (char)0xFF )
        {
          if ( v8 >= 0x4C )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x291);
          }
          v29 = v3;
          v26 = v4;
          v23 = *(char *)(v39 + *(_DWORD *)((char *)v36 + 0xAB) + 0xAB);
          v6 = v49;
          goto LABEL_23;
        }
        v29 = v3;
        v26 = v4;
        v7 = *((_WORD *)v36 + 0xC);
        v23 = 0;
      }
      v6 = v7;
      goto LABEL_23;
    }
LABEL_4:
    v41 += 4;
  }
  sub_55274(&V_Type3_stru_10AE70, v36[2], v36[3], v36[4], v36[5]);
  if ( *((_BYTE *)v36 + 0xBB) != 0xFF )
  {
    a2.window = (WINDOW *)&V_Type6_stru_D8654;
    a2.y1 = 105;
    a2.x0 = 315;
    a2.y0 = 7;
    a2.x1 = 476;
    VFX_pane_wipe(&a2, 0xF2);
    v27 = (a2.x1 - a2.x0) >> 1;
    v24 = *((char *)v36 + 0xBB);
    v10 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v49);
    VFX_shape_draw(&a2, v10, v24, v27, 0x3A);
    V_Type3_stru_10AE70.pane = a2;
    sprintf(s, "%s", V_Gizmos[*((char *)v36 + 0xBB)].name);
    sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 3, 3, s, 0x42, 0xF3, 0xFF, 0);
    sub_552CC(&V_Type3_stru_10AE70, &a2);
  }
  if ( *(_DWORD *)((char *)v36 + 0xC1) )
  {
    pane.window = (WINDOW *)&V_Type6_stru_D8654;
    pane.x1 = 321;
    pane.x0 = 7;
    pane.y0 = 114;
    pane.y1 = 336;
    VFX_pane_wipe(&pane, 0);
    v11 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
            (unsigned int)&V_Type3_stru_10AE70.t13,
            (unsigned __int16)word_FFECA[byte_104BEA]);
    if ( !v11 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\shipwin.cpp", 0x2CB);
    }
    VFX_shape_draw(&pane, v11, *(char *)(*(_DWORD *)((char *)v36 + 0xAB) + 0xAA), 0, 0);
    *(_DWORD *)((char *)v36 + 0xC1) = 0;
  }
  if ( *(_DWORD *)((char *)v36 + 0xBD) )
  {
    pane.window = (WINDOW *)&V_Type6_stru_D8654;
    pane.x1 = 304;
    pane.x0 = 7;
    pane.y0 = 7;
    pane.y1 = 102;
    VFX_pane_wipe(&pane, 0);
    sub_552CC(&V_Type3_stru_10AE70, &pane);
    Q_WINMGR_CPP_sub_53E38(&pane, 3, 3, byte_104BEA);
    qmemcpy(v31, &unk_96AD4, 0x32u);
    if ( *(T_Gizmo **)((char *)v36 + 0xAB) != (T_Gizmo *)((char *)&V_Gizmos[0x4C].special2 + 2)
      && *(_DWORD *)((char *)v36 + 0x22F) == 0xFFFFFFFF )
    {
      v12 = v36;
      planet = V_Game.planet;
      v14 = sub_4A18C(*(_DWORD *)((char *)v36 + 0xAB));
      if ( *(_DWORD *)((char *)v12 + 0xC9) == 0xFFFFFFFF )
      {
        v14 = sub_4EE00((int)v12);
      }
      TurnsToComplete_sub_46C20 = Q_GetTurnsToComplete_sub_46C20(v14, planet->buildingProgress, planet->production);
      if ( TurnsToComplete_sub_46C20 != 0xFFFF )
      {
        if ( TurnsToComplete_sub_46C20 == 1 )
        {
          v16 = 0x1C;                                  // 28: ""
        }
        else
        {
          v16 = 0x1D;                                  // 29: "s"
        }
        Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v16);
        sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x87);// 135: " (%d Day%s)"
        sprintf(v31, sub_1CEA8);
      }
    }
    sprintf(
      s,
      "%s \"%s\"%s",
      V_SpecNames[V_Game.races[byte_104BEA].Unknown_01],
      (const char *)(*(_DWORD *)((char *)v36 + 0xAB) + 0x34),
      v31);
    v25 = 4 * V_Game.races[byte_104BEA].Unknown_02 + 0x13;
    *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = pane;
    sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 3, s, 2, v25, 0xFFFFFFFF, 0);
    shape_table = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                    (unsigned int)&V_Type3_stru_10AE70.t13,
                    (unsigned __int16)word_FFEE6);
    v34[0] = **(_DWORD **)((char *)v36 + 0xAB);
    v34[1] = *(_DWORD *)(*(_DWORD *)((char *)v36 + 0xAB) + 4);
    v34[2] = *(_DWORD *)(*(_DWORD *)((char *)v36 + 0xAB) + 0x10);
    v34[3] = *(_DWORD *)(*(_DWORD *)((char *)v36 + 0xAB) + 0x20);
    v18 = *(_DWORD *)((char *)v36 + 0xAB);
    v40 = 7;
    v19 = *(_DWORD *)(v18 + 0x18);
    v33 = pane;
    v34[4] = v19;
    hotY = 0x14;
    v42 = 0;
    do
    {
      v33.x1 = v33.x0 + 0x27;
      v20 = v34[v42 / 4];
      v21 = 0x28;
      if ( v20 > 0 )
      {
        v33.x1 += 0xE * v20 / 4;
      }
      v22 = 0;
      shape_number = v40;
      do
      {
        v28 = v21;
        ++v22;
        v21 += 0xE;
        VFX_shape_draw(&v33, shape_table, shape_number, v28, hotY);
      }
      while ( v22 < 0xF );
      hotY += 0xE;
      v42 += 4;
      ++v40;
    }
    while ( v42 != 0x14 );
    *(_DWORD *)((char *)v36 + 0xBD) = 0;
  }
  sub_2D218(v36);
}
// 96AD0: using guessed type int dword_96AD0;
// FFECA: using guessed type __int16 word_FFECA[7];

//----- (0004EE00) --------------------------------------------------------
int __fastcall sub_4EE00(int a1)
{
  int v2; // ebx
  int v3; // ecx
  int v4; // ecx

  v2 = 0x2710;
  if ( *(_DWORD *)(a1 + 0xC9) == 0xFFFFFFFF )
  {
    if ( *(_DWORD *)(a1 + 0xAB) )
    {
      v3 = sub_4A144(*(_DWORD *)(a1 + 0xAB));
      v4 = v3 - sub_4A144(a1 + 0xCD);
      v2 = 0x1E;
      if ( v4 > 0 )
      {
        return v4 + 0x1E;
      }
    }
  }
  return v2;
}

//----- (0004EE50) --------------------------------------------------------
char *sub_4EE50()
{
  char *result; // eax

  _wcpp_2_mod_register_(&unk_96B08);
  result = (char *)sub_4EE74(&V_SoundSystem);
  dword_96B10 = 1;
  return result;
}
// 786DA: using guessed type int __fastcall _wcpp_2_mod_register_(_DWORD);
// 96B10: using guessed type int dword_96B10;

//----- (0004EE74) --------------------------------------------------------
P_SoundSystem __fastcall sub_4EE74(P_SoundSystem a1)
{
  T_FileInfo *p_fileinfo; // eax
  P_SoundSystem v2; // ecx
  P_SoundSystem result; // eax

  p_fileinfo = &a1->fileinfo;
  Q_InitFileInfo_sub_1BB78(p_fileinfo);
  v2 = (P_SoundSystem)&p_fileinfo[0xFFFFFFFD].fname[0xF8];
  v2->MDI_installed = 0;
  v2->DIG_installed = 0;
  v2->AIL_started = 0;
  v2->_notstarted1 = 0;
  v2->_notstarted2 = 0;
  v2->a = 0;
  v2->playing = 0;
  v2->c = 0xFFFFFFFF;
  v2->z1[0] = 0;
  v2->z1[0xFF] = 0;
  v2->z1[0x1FE] = 0;
  v2->mdidrv = 0;
  v2->digdrv = 0;
  v2->digitalMusicBuf1 = 0;
  v2->digitalMusicBuf2 = 0;
  *(_WORD *)&p_fileinfo[1].fname[0x20] = 0;
  *(_WORD *)&p_fileinfo[9].fname[0xB0] = 0;
  *(_WORD *)&p_fileinfo[9].fname[0xB2] = 0;
  memset(&p_fileinfo[8].fname[0xD0], 0, 0x84u);
  memset(&v2->z4[0x568], 0, 0x40u);
  memset(v2->files, 0, sizeof(v2->files));
  v2->tracks = 0;
  v2->volume = 0x64;
  v2->volume2 = 0x7F;
  *(_WORD *)v2->z4 = 0;
  result = v2;
  *(_WORD *)&v2->z4[0x4B2] = 0;
  return result;
}

//----- (0004EF94) --------------------------------------------------------
int __fastcall sub_4EF94(T_SoundSystem *a1)
{
  int v2; // eax

  Q_StopSoundSystem_sub_4FE8C(a1);
  Q_CloseFileAndDelete_sub_1BBC8(&a1->fileinfo);
  return v2 - 0x240;
}
// 4EFA9: variable 'v2' is possibly undefined

//----- (0004EFB0) --------------------------------------------------------
LONG __fastcall Q_StartSoundSystem_sub_4EFB0(T_SoundSystem *a1, int aDIG, int aMDI)
{
  LONG result; // eax

  AIL_startup();
  a1->AIL_started = TRUE;
  if ( aDIG == TRUE )
  {
    result = AIL_install_DIG_INI();
    a1->digdrv = (DIG_DRIVER *)result;
    if ( !result )
    {
      return result;
    }
    Q_AllocateSamples_sub_4F5E8(a1, 8);
    sub_4FF94(a1);
    a1->DIG_installed = TRUE;
  }
  if ( aMDI == TRUE )
  {
    result = AIL_install_MDI_INI();
    a1->mdidrv = (MDI_DRIVER *)result;
    if ( !result )
    {
      return result;
    }
    sub_4F184(a1, 8);
    a1->MDI_installed = TRUE;
  }
  return TRUE;
}

//----- (0004F088) --------------------------------------------------------
HMDIDRIVER __fastcall sub_4F088(char *path, char *a2, char *a3, char *a4)
{
  char *v7; // edi
  char v8; // al
  char v9; // al
  const char *v10; // esi
  char *v11; // edi
  char v12; // al
  char v13; // al
  char *v15; // edi
  char v16; // al
  char v17; // al
  char *v18; // esi
  char *v19; // edi
  char v20; // al
  char v21; // al
  HMDIDRIVER result; // eax
  IO_PARMS v24; // [esp+0h] [ebp-24h] BYREF

  v7 = path;
  do
  {
    v8 = *a2;
    *v7 = *a2;
    if ( !v8 )
    {
      break;
    }
    v9 = a2[1];
    a2 += 2;
    v7[1] = v9;
    v7 += 2;
  }
  while ( v9 );
  v10 = "\\";
  v11 = &path[strlen(path)];
  do
  {
    v12 = *v10;
    *v11 = *v10;
    if ( !v12 )
    {
      break;
    }
    v13 = v10[1];
    v10 += 2;
    v11[1] = v13;
    v11 += 2;
  }
  while ( v13 );
  v15 = &path[strlen(path)];
  do
  {
    v16 = *a3;
    *v15 = *a3;
    if ( !v16 )
    {
      break;
    }
    v17 = a3[1];
    a3 += 2;
    v15[1] = v17;
    v15 += 2;
  }
  while ( v17 );
  v18 = a4;
  v19 = path + 0x1FE;
  do
  {
    v20 = *v18;
    *v19 = *v18;
    if ( !v20 )
    {
      break;
    }
    v21 = v18[1];
    v18 += 2;
    v19[1] = v21;
    v19 += 2;
  }
  while ( v21 );
  AIL_set_GTL_filename_prefix(path + 0x1FE);
  memset(&v24, 0, sizeof(v24));
  v24.IO = 0x240;
  v24.IRQ = 9;
  result = AIL_install_MDI_driver_file(path, &v24);
  *(_DWORD *)(path + 0x21B) = result;
  if ( result )
  {
    sub_4F184((P_SoundSystem)path, 8);
    result = (HMDIDRIVER)0xFFFFFFFF;
    *(_DWORD *)(path + 0x207) = 0xFFFFFFFF;
  }
  return result;
}

//----- (0004F184) --------------------------------------------------------
int __fastcall sub_4F184(P_SoundSystem a1, int a2)
{
  __int16 i; // si
  HSEQUENCE sequence_handle; // edx
  char *v6; // eax

  if ( *(_WORD *)&a1->z4[0x5A8] )
  {
    return 0;
  }
  if ( a2 > 8 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0xDA);
  }
  for ( i = 0; i < a2; ++i )
  {
    sequence_handle = AIL_allocate_sequence_handle(a1->mdidrv);
    v6 = &a1->z1[8 * i];
    *((_DWORD *)v6 + 0x31A) = sequence_handle;
    if ( !sequence_handle )
    {
      break;
    }
    *((_DWORD *)v6 + 0x31B) = 0;
  }
  *(_WORD *)&a1->z4[0x5A8] = i;
  return *(__int16 *)&a1->z4[0x5A8];
}

//----- (0004F32C) --------------------------------------------------------
void __fastcall sub_4F32C(int a1, __int16 a2, int a3)
{
  int v4; // [esp+0h] [ebp-14h]

  if ( *(_DWORD *)(a1 + 0x217) != 0xFFFFFFFF && *(_DWORD *)(a1 + 0x207) )
  {
    if ( a2 < 0 || a2 >= *(__int16 *)(a1 + 0xCA8) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x12A);
    }
    if ( !*(_DWORD *)(a1 + 8 * a2 + 0xC6C) )
    {
      sprintf("Thank you for playing Ascendancy.", "Attempt play Sequence Track %d with NULL data.\n\n", a2);
      Q_debugbreak_exit_sub_2624C();
    }
    v4 = a1 + 8 * a2;
    if ( AIL_sequence_status(*(HSEQUENCE *)(v4 + 0xC68)) == 4 )
    {
      if ( a3 != 0xFFFFFFFF )
      {
        return;
      }
      AIL_stop_sequence(*(HSEQUENCE *)(v4 + 0xC68));
    }
    AIL_start_sequence(*(HSEQUENCE *)(a1 + 8 * a2 + 0xC68));
  }
}
// 4F3A4: conditional instruction was optimized away because ecx.4!=0

//----- (0004F45C) --------------------------------------------------------
void __fastcall sub_4F45C(int a1, __int16 a2)
{
  int v2; // esi

  if ( a2 < 0 || a2 >= *(__int16 *)(a1 + 0xCA8) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x152);
  }
  v2 = 8 * a2 + a1;
  if ( *(_DWORD *)(v2 + 0xC6C) )
  {
    AIL_end_sequence(*(HSEQUENCE *)(v2 + 0xC68));
  }
}

//----- (0004F4D4) --------------------------------------------------------
void __fastcall sub_4F4D4(int a1, __int16 a2)
{
  int v2; // esi

  if ( a2 < 0 || a2 >= *(__int16 *)(a1 + 0xCA8) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x166);
  }
  v2 = a1 + 8 * a2;
  if ( *(_DWORD *)(v2 + 0xC6C) )
  {
    AIL_end_sequence(*(HSEQUENCE *)(v2 + 0xC68));
    if ( *(_DWORD *)(v2 + 0xC6C) )
    {
      MEM_free(*(void **)(v2 + 0xC6C));
    }
  }
}

//----- (0004F534) --------------------------------------------------------
HDIGDRIVER __fastcall sub_4F534(_DWORD *a1, char *a2, char *a3)
{
  BYTE *v5; // edx
  char *v6; // edi
  char v7; // al
  char v8; // al
  const char *v9; // esi
  char *v10; // edi
  char v11; // al
  char v12; // al
  char *v14; // edi
  char v15; // al
  char v16; // al
  HDIGDRIVER result; // eax
  const char *v18; // [esp-4h] [ebp-14h]

  v5 = (char *)a1 + 0xFF;
  v6 = (char *)a1 + 0xFF;
  v18 = (char *)a1 + 0xFF;
  do
  {
    v7 = *a2;
    *v6 = *a2;
    if ( !v7 )
    {
      break;
    }
    v8 = a2[1];
    a2 += 2;
    v6[1] = v8;
    v6 += 2;
  }
  while ( v8 );
  v9 = "\\";
  v10 = (char *)&v18[strlen(v18)];
  do
  {
    v11 = *v9;
    *v10 = *v9;
    if ( !v11 )
    {
      break;
    }
    v12 = v9[1];
    v9 += 2;
    v10[1] = v12;
    v10 += 2;
  }
  while ( v12 );
  v14 = (char *)&v18[strlen(v18)];
  do
  {
    v15 = *a3;
    *v14 = *a3;
    if ( !v15 )
    {
      break;
    }
    v16 = a3[1];
    a3 += 2;
    v14[1] = v16;
    v14 += 2;
  }
  while ( v16 );
  result = AIL_install_DIG_driver_file(v5, 0);
  *(_DWORD *)((char *)a1 + 0x21F) = result;
  if ( result )
  {
    Q_AllocateSamples_sub_4F5E8((P_SoundSystem)a1, 8);
    sub_4FF94((P_SoundSystem)a1);
    result = (HDIGDRIVER)0xFFFFFFFF;
    *(_DWORD *)((char *)a1 + 0x20B) = 0xFFFFFFFF;
  }
  return result;
}

//----- (0004F5E8) --------------------------------------------------------
int __fastcall Q_AllocateSamples_sub_4F5E8(P_SoundSystem a1, int a2)
{
  WORD i; // si
  SAMPLE *sample_handle; // eax

  if ( a1->smplCnt )
  {
    return 0;
  }
  if ( a2 > 8 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x199);
  }
  for ( i = 0; i < a2; ++i )
  {
    sample_handle = AIL_allocate_sample_handle(a1->digdrv);
    a1->smpl[i] = sample_handle;
    if ( !sample_handle )
    {
      break;
    }
  }
  a1->smplCnt = i;
  return a1->smplCnt;
}

//----- (0004F65C) --------------------------------------------------------
unsigned int __fastcall Q_LoadMusic_sub_4F65C(P_SoundSystem a1, const char *aMusicFName)
{
  SAMPLE *smpl; // esi
  void *pBuf; // eax
  int v7; // edx
  void *digitalMusicBuf1; // ebx
  __int16 i; // si
  int v10; // ecx
  int v11; // eax
  DIG_DRIVER *digdrv; // [esp-Ch] [ebp-80h]
  char fname[80]; // [esp+0h] [ebp-74h] BYREF
  int lines; // [esp+50h] [ebp-24h] BYREF
  int bufSize; // [esp+54h] [ebp-20h]
  T_OpenedFile *files; // [esp+58h] [ebp-1Ch]
  FILE *fp; // [esp+5Ch] [ebp-18h]

  if ( a1->DIG_installed != TRUE )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x1B4);
  }
  if ( a1->smplCnt <= 0 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x1B5);
  }
  if ( !a1->DIG_installed || a1->smplCnt < 8 )
  {
    return 0;
  }
  if ( a1->a == 0xFFFFFFFF )
  {
    return 0xFFFFFFFF;
  }
  smpl = a1->smpl[0];
  AIL_init_sample(smpl);
  AIL_set_sample_type(smpl, 0, 0);
  AIL_set_sample_playback_rate(smpl, 22050);
  digdrv = a1->digdrv;
  bufSize = 0xC800;
  if ( AIL_minimum_sample_buffer_size(digdrv, 22050, 0) >= 0xC800 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x1C9);
  }
  pBuf = Q_Allocate_sub_2628C(2 * bufSize, 4, "DigitalMusicBuf");
  v7 = bufSize;
  a1->digitalMusicBuf1 = pBuf;
  digitalMusicBuf1 = a1->digitalMusicBuf1;
  a1->digitalMusicBuf2 = (char *)pBuf + v7;
  if ( !digitalMusicBuf1 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x1D0);
  }
  if ( !a1->digitalMusicBuf1 )
  {
    return 0;
  }
  if ( aMusicFName )
  {
    fp = Q_OpenFile_sub_1BB10(aMusicFName, 0);
    if ( !fp )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x1DB);
    }
    fscanf(fp, "%d", &lines);
    if ( lines > 0x20 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x1E2);
    }
    i = 0;
    files = a1->files;
    while ( i < lines )
    {
      fscanf(fp, "%s", fname);
      if ( strlen(fname) >= 0x18 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x1E8);
      }
      v10 = i;
      strncpy(files[v10].fname, fname, 0x18u);
      a1->files[v10].fname[0x17] = 0;
      ++i;
      a1->files[v10].fpos = 0;
    }
    a1->tracks = lines;
    fclose(fp);
  }
  a1->a = 0xFFFFFFFF;
  a1->c = 0;
  *(_DWORD *)&a1->z2[4] = 0;
  v11 = bufSize;
  a1->z2[8] = 0;
  *(_DWORD *)a1->z2 = v11;
  return 0xFFFFFFFF;
}
// 4F738: conditional instruction was optimized away because eax.4<C800

//----- (0004F8CC) --------------------------------------------------------
MACRO_VFX_BOOL __fastcall sub_4F8CC(P_SoundSystem a1, __int16 track, int setpos)
{
  MACRO_VFX_BOOL result; // eax
  SAMPLE *v5; // ebp

  if ( a1->c == 0xFFFFFFFF || !a1->DIG_installed )
  {
    return FALSE;
  }
  if ( track < 0 || track >= a1->tracks )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x200);
  }
  if ( a1->current != 0xFFFFFFFF )
  {
    a1->files[a1->current].fpos = Q_GetFilePos_sub_1BEA0(&a1->fileinfo);
  }
  Q_StopSample_sub_4FA1C(a1);
  v5 = a1->smpl[0];
  AIL_init_sample(v5);
  AIL_set_sample_type(v5, 0, 0);
  AIL_set_sample_playback_rate(v5, 22050);
  Q_SetVolume_sub_4FF4C(a1, a1->volume);
  if ( Q_OpenFile_sub_1BBFC(&a1->fileinfo, a1->files[track].fname, O_BINARY, 0) )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x214);
  }
  if ( setpos == TRUE )
  {
    Q_SetFilePos_sub_1BF0C(&a1->fileinfo, a1->files[track].fpos);
  }
  a1->playing = TRUE;
  result = TRUE;
  a1->current = track;
  return result;
}

//----- (0004FA1C) --------------------------------------------------------
void __fastcall Q_StopSample_sub_4FA1C(P_SoundSystem a1)
{
  SAMPLE *v2; // [esp-10h] [ebp-14h]

  if ( a1->playing == TRUE )
  {
    v2 = a1->smpl[0];
    a1->playing = FALSE;
    AIL_stop_sample(v2);
    a1->files[a1->current].fpos = Q_GetFilePos_sub_1BEA0(&a1->fileinfo);
  }
}

//----- (0004FAB4) --------------------------------------------------------
void __fastcall sub_4FAB4(int a1)
{
  SAMPLE *v2; // edi
  LONG v3; // eax
  signed int v4; // ebx
  int File_sub_1BF94; // eax
  ULONG v6; // edx

  if ( *(_DWORD *)(a1 + 0x22B) != 0xFFFFFFFF && *(_DWORD *)(a1 + 0x20B) )
  {
    v2 = *(SAMPLE **)(a1 + 0x358);
    v3 = AIL_sample_buffer_ready(v2);
    if ( v3 != 0xFFFFFFFF )
    {
      *(_DWORD *)(a1 + 0x233) = 0;
      *(_BYTE *)(a1 + 0x237) = v3;
    }
    v4 = *(_DWORD *)(a1 + 0x22F) - *(_DWORD *)(a1 + 0x233);
    if ( v4 > 0x1400 )
    {
      v4 = 0x1400;
    }
    if ( v4 )
    {
      File_sub_1BF94 = Q_ReadFile_sub_1BF94(
                         (P_FileInfo)(a1 + 0x240),
                         (void *)(*(_DWORD *)(a1 + 0x233) + *(_DWORD *)(a1 + 4 * *(char *)(a1 + 0x237) + 0x238)),
                         v4);
      v6 = File_sub_1BF94 + *(_DWORD *)(a1 + 0x233);
      *(_DWORD *)(a1 + 0x233) = v6;
      if ( File_sub_1BF94 )
      {
        AIL_load_sample_buffer(v2, *(char *)(a1 + 0x237), *(void **)(a1 + 4 * *(char *)(a1 + 0x237) + 0x238), v6);
      }
      else
      {
        sub_1BECC((int *)(a1 + 0x240), 0, 0);
        Q_StopSample_sub_4FA1C((P_SoundSystem)a1);
      }
    }
  }
}

//----- (0004FB90) --------------------------------------------------------
void __fastcall Q_StartSample_sub_4FB90(P_SoundSystem a1, __int16 a2)
{
  int v2; // ebp
  char *v3; // edi
  SAMPLE *v4; // esi
  int v5; // edx
  char *v6; // eax
  char *v7; // [esp+0h] [ebp-1Ch]

  if ( a1->_notstarted1 != 0xFFFFFFFF )
  {
    if ( a1->DIG_installed )
    {
      v7 = sub_50140(a1, a2);
      if ( v7 )
      {
        v2 = 1;
        v3 = &a1->z1[4];
        while ( v2 < a1->smplCnt )
        {
          v4 = (SAMPLE *)*((_DWORD *)v3 + 0xD6);
          if ( AIL_sample_status(v4) != 4 )
          {
            AIL_init_sample(v4);
            AIL_set_sample_type(v4, *((__int16 *)v7 + 8), 0);
            AIL_set_sample_address(v4, *((void **)v7 + 2), *((_DWORD *)v7 + 3));
            AIL_set_sample_playback_rate(v4, *((__int16 *)v7 + 9));
            AIL_set_sample_volume(v4, a1->volume2);
            AIL_set_sample_loop_count(v4, 1);
            AIL_start_sample(v4);
            v5 = 0;
            *(_DWORD *)v7 = v4;
            v6 = &a1->z4[0x4B4];
            do
            {
              if ( v6 != v7 && v4 == *(SAMPLE **)v6 )
              {
                *(_DWORD *)v6 = 0;
              }
              ++v5;
              v6 += 0x16;
            }
            while ( v5 < 6 );
            return;
          }
          ++v2;
          v3 += 4;
        }
      }
    }
  }
}

//----- (0004FE8C) --------------------------------------------------------
void __fastcall Q_StopSoundSystem_sub_4FE8C(P_SoundSystem a1)
{
  __int16 i; // bx
  P_SoundSystem v3; // edi
  int j; // ebp
  SAMPLE *v5; // [esp-4h] [ebp-1Ch]

  if ( a1->AIL_started == 0xFFFFFFFF )
  {
    for ( i = 0; i < *(__int16 *)&a1->z4[0x5A8]; ++i )
    {
      sub_4F4D4((int)a1, i);
    }
    v3 = a1;
    for ( j = 0; j < a1->smplCnt; ++j )
    {
      v5 = v3->smpl[0];
      v3 = (P_SoundSystem)((char *)v3 + 4);
      AIL_stop_sample(v5);
    }
    sub_262CC(*(void **)&a1->z4[0x4B8]);
    AIL_shutdown();
    a1->AIL_started = 0;
  }
}

//----- (0004FF08) --------------------------------------------------------
void __fastcall Q_SetNoSound_sub_4FF08(P_SoundSystem a1)
{
  sub_4FF1C(a1);
  sub_4FF28(a1);
}

//----- (0004FF1C) --------------------------------------------------------
void __fastcall sub_4FF1C(P_SoundSystem a1)
{
  a1->_notstarted2 = TRUE;
}

//----- (0004FF28) --------------------------------------------------------
void __fastcall sub_4FF28(P_SoundSystem a1)
{
  a1->_notstarted1 = TRUE;
}

//----- (0004FF4C) --------------------------------------------------------
void __fastcall Q_SetVolume_sub_4FF4C(P_SoundSystem a1, char a2)
{
  if ( a2 >= 0 )
  {
    a1->volume = a2;
  }
  AIL_set_sample_volume(a1->smpl[0], a1->volume);
}

//----- (0004FF94) --------------------------------------------------------
int __fastcall sub_4FF94(P_SoundSystem a1)
{
  P_SoundSystem v1; // ecx
  int v2; // esi
  int v3; // edi
  FILE *fp; // ebp
  char *sub_2628C; // eax
  P_SoundSystem v6; // edx
  char *v7; // ecx
  int v8; // ebx
  P_SoundSystem v9; // edi
  char *v10; // eax
  P_SoundSystem v11; // edx
  P_SoundSystem v12; // ecx
  P_SoundSystem v13; // esi
  int v14; // edx
  char *v15; // ebx
  char *v17; // [esp-4h] [ebp-2Ch]
  int v18; // [esp+0h] [ebp-28h] BYREF
  int v19; // [esp+4h] [ebp-24h] BYREF
  P_SoundSystem v20; // [esp+8h] [ebp-20h]
  int v21; // [esp+Ch] [ebp-1Ch]

  v20 = a1;
  v1 = a1;
  v2 = 0;
  v3 = 0;
  fp = Q_OpenFile_sub_1BB10("soundfx.txt", 0);
  v21 = 0;
  do
  {
    fscanf(fp, "%d %d", &v18, &v19);
    *(_DWORD *)&v1->z4[0x550] = v2;
    *(_DWORD *)&v1->z4[0x55C] = v2 + v18 - 1;
    *(_DWORD *)&v1->z4[0x544] = v19;
    v21 += v19 * v18;
    if ( v3 > 0 && *(_DWORD *)&v1->z4[0x544] < *(_DWORD *)&v1->z4[0x540] )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x347);
    }
    v1 = (P_SoundSystem)((char *)v1 + 4);
    ++v3;
    v2 += v18;
  }
  while ( v3 < 3 );
  if ( v2 != 6 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x34D);
  }
  sub_2628C = (char *)Q_Allocate_sub_2628C(v21, 1, "SFX CACHE");
  v6 = v20;
  v7 = sub_2628C;
  v8 = 0;
  v9 = v20;
  v10 = &v20->z4[0x4B4];
  do
  {
    *(_DWORD *)v10 = 0;
    *((_WORD *)v10 + 8) = 0;
    *((_WORD *)v10 + 9) = 0x5622;
    *((_WORD *)v10 + 0xA) = 0xFFFF;
    if ( v8 > *(_DWORD *)&v6->z4[0x55C] )
    {
      v6 = (P_SoundSystem)((char *)v6 + 4);
    }
    *(_DWORD *)&v9->z4[0x4B8] = v7;
    v9 = (P_SoundSystem)((char *)v9 + 0x16);
    ++v8;
    v10 += 0x16;
    v7 += *(_DWORD *)&v6->z4[0x544];
  }
  while ( v8 < 6 );
  fscanf(fp, "%d", &v18);
  v11 = v20;
  *(_WORD *)v20->z4 = v18;
  if ( *(unsigned __int16 *)v11->z4 >= 0x64u )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x369);
  }
  v12 = v20;
  v13 = v20;
  v14 = 0;
  v15 = &v20->z4[2];
  while ( v14 < *(unsigned __int16 *)v13->z4 )
  {
    v17 = v15;
    v12 = (P_SoundSystem)((char *)v12 + 2);
    ++v14;
    v15 += 0xA;
    fscanf(fp, "%s", v17);
    *(_WORD *)&v12->z4[0x3E8] = 0xFFFF;
  }
  return fclose(fp);
}

//----- (00050140) --------------------------------------------------------
char *__fastcall sub_50140(P_SoundSystem a1, __int16 a2)
{
  int v4; // edx
  P_SoundSystem v5; // ecx
  int k; // eax
  char *m; // ecx
  int v8; // edi
  int v9; // ecx
  P_SoundSystem v10; // eax
  unsigned int v11; // edx
  int v12; // edx
  int v13; // ecx
  char *v14; // ebp
  char *v15; // eax
  int v16; // ebp
  int v17; // edi
  char *v18; // eax
  int v19; // ebp
  P_SoundSystem v20; // ecx
  int i; // eax
  char *j; // ecx
  unsigned __int16 v23; // di
  char *v24; // edx
  T_FileInfo v25; // [esp+0h] [ebp-178h] BYREF
  char s[52]; // [esp+118h] [ebp-60h] BYREF
  int v27; // [esp+14Ch] [ebp-2Ch]
  char *v28; // [esp+150h] [ebp-28h]
  int v29; // [esp+154h] [ebp-24h]
  int FileLength_sub_1BE28; // [esp+158h] [ebp-20h]
  P_SoundSystem v31; // [esp+15Ch] [ebp-1Ch]
  int v32; // [esp+160h] [ebp-18h]

  LOWORD(v32) = a2;
  if ( a1->_notstarted1 == TRUE || !a1->DIG_installed )
  {
    return 0;
  }
  if ( (v32 & 0x8000u) != 0 || (__int16)v32 >= (int)*(unsigned __int16 *)a1->z4 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x37B);
  }
  v28 = 0;
  if ( (v32 & 0x8000u) != 0 || (__int16)v32 >= (int)*(unsigned __int16 *)a1->z4 )
  {
    return v28;
  }
  v4 = *(__int16 *)&a1->z4[2 * (__int16)v32 + 0x3EA];
  if ( v4 == 0xFFFFFFFF )
  {
    sprintf(s, "data\\%s.voc", &a1->z4[0xA * (__int16)v32 + 2]);
    Q_InitFileInfo_sub_1BB78(&v25);
    Q_OpenFile_sub_1BBFC(&v25, s, 0x200, 0);
    v11 = 0;
    FileLength_sub_1BE28 = Q_GetFileLength_sub_1BE28(&v25);
    v9 = 0;
    v10 = a1;
    while ( FileLength_sub_1BE28 >= *(_DWORD *)&v10->z4[0x544] )
    {
      ++v9;
      v10 = (P_SoundSystem)((char *)v10 + 4);
      if ( v9 >= 3 )
      {
        goto LABEL_23;
      }
    }
    v11 = 0xFFFFFFFF;
LABEL_23:
    if ( v11 != 0xFFFFFFFF )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\ssystem.cpp", 0x3AD);
    }
    v12 = v9;
    v13 = *(_DWORD *)&a1->z4[4 * v9 + 0x550];
    v27 = 0xFFFFFFFF;
    v14 = &a1->z1[4 * v12];
    v15 = &a1->z1[0x16 * v13];
    if ( v13 <= *((_DWORD *)v14 + 0x317) )
    {
      while ( *((__int16 *)v15 + 0x5E4) != 0xFFFFFFFF )
      {
        ++v13;
        v15 += 0x16;
        if ( v13 > *((_DWORD *)v14 + 0x317) )
        {
          goto LABEL_30;
        }
      }
      v27 = v13;
    }
LABEL_30:
    if ( v27 == 0xFFFFFFFF )
    {
      v31 = a1;
      v16 = 0;
      v29 = 4 * v12;
      while ( v16 < *(unsigned __int16 *)&a1->z4[0x4B2] )
      {
        v17 = *(__int16 *)&a1->z4[2 * *(unsigned __int16 *)&v31->z4[0x538] + 0x3EA];
        if ( v17 >= *(_DWORD *)&a1->z4[v29 + 0x550] && v17 <= *(_DWORD *)&a1->z4[v29 + 0x55C] )
        {
          v18 = &a1->z1[0x16 * v17];
          if ( !*((_DWORD *)v18 + 0x2ED) || AIL_sample_status(*((HSAMPLE *)v18 + 0x2ED)) != 4 )
          {
            v27 = v17;
            break;
          }
        }
        ++v16;
        v31 = (P_SoundSystem)((char *)v31 + 2);
      }
    }
    if ( v27 != 0xFFFFFFFF )
    {
      v19 = *(__int16 *)&a1->z4[0x16 * v27 + 0x4C8];
      v28 = &a1->z4[0x16 * v27 + 0x4B4];
      if ( v19 != 0xFFFFFFFF )
      {
        v20 = a1;
        for ( i = 0; i < *(unsigned __int16 *)&a1->z4[0x4B2] && *(unsigned __int16 *)&v20->z4[0x538] != v19; ++i )
        {
          v20 = (P_SoundSystem)((char *)v20 + 2);
        }
        for ( j = &a1->z1[2 * i]; ; *((_WORD *)j + 0x61B) = *((_WORD *)j + 0x61C) )
        {
          v23 = *(_WORD *)&a1->z4[0x4B2];
          if ( i >= v23 )
          {
            break;
          }
          j += 2;
          ++i;
        }
        *(_WORD *)&a1->z4[0x4B2] = v23 - 1;
        *(_WORD *)&a1->z4[2 * v19 + 0x3EA] = 0xFFFF;
      }
      Q_CfileLoad_sub_1BF1C(&v25, *((void **)v28 + 1));
      v24 = v28;
      *((_DWORD *)v28 + 2) = *((_DWORD *)v28 + 1) + 0x2A;
      *((_DWORD *)v24 + 3) = FileLength_sub_1BE28 - 0x2B;
      *((_WORD *)v24 + 0xA) = v32;
      *(_WORD *)&a1->z4[2 * (__int16)v32 + 0x3EA] = v27;
      LOWORD(v24) = *(_WORD *)&a1->z4[0x4B2];
      *(_WORD *)&a1->z4[0x4B2] = (_WORD)v24 + 1;
      *(_WORD *)&a1->z4[2 * (unsigned __int16)v24 + 0x538] = v32;
    }
    Q_CloseFileAndDelete_sub_1BBC8(&v25);
    return v28;
  }
  v5 = a1;
  v28 = &a1->z4[0x16 * v4 + 0x4B4];
  for ( k = 0; k < *(unsigned __int16 *)&a1->z4[0x4B2] && *(unsigned __int16 *)&v5->z4[0x538] != (__int16)v32; ++k )
  {
    v5 = (P_SoundSystem)((char *)v5 + 2);
  }
  for ( m = &a1->z1[2 * k]; ; *((_WORD *)m + 0x61B) = *((_WORD *)m + 0x61C) )
  {
    v8 = *(unsigned __int16 *)&a1->z4[0x4B2];
    if ( k >= (unsigned __int16)v8 )
    {
      break;
    }
    m += 2;
    ++k;
  }
  *(_WORD *)&a1->z4[2 * v8 + 0x536] = v32;
  return v28;
}

//----- (00050530) --------------------------------------------------------
UWORD __fastcall sub_50530(T_Type5 *a1, P_Planet pPlanet, int a3, int a4)
{
  T_Star *v6; // esi
  void *ShapeTable_sub_1B084; // eax
  void *v8; // ecx
  int Unknown_14; // edi
  char *Name; // ecx
  __int16 v11; // ax
  LONG *p_x0; // esi
  LONG *v13; // esi
  int v14; // edx
  char *sub_1CEA8; // eax
  LONG *v16; // esi
  int z7; // ebx
  PANE *v18; // esi
  __int16 v19; // cx
  char *v20; // eax
  unsigned int DaysToCompletePlanetItem_sub_358BC; // edx
  char *v22; // edi
  char *v23; // esi
  char v24; // al
  char v25; // al
  int v26; // eax
  char *v27; // eax
  char *v28; // eax
  char *v29; // edi
  char *v30; // esi
  char v31; // al
  char v32; // al
  char *v33; // esi
  char *v34; // edi
  char v35; // al
  char v36; // al
  int v37; // ebx
  LONG *v38; // esi
  int v39; // esi
  unsigned __int16 v40; // di
  int v41; // eax
  void *v42; // eax
  void *v43; // eax
  int v44; // eax
  void *v45; // eax
  int v46; // eax
  void *v47; // eax
  LONG v48; // edi
  int v49; // eax
  int i; // esi
  UWORD result; // ax
  void *v52; // eax
  LONG v53; // [esp-10h] [ebp-F4h]
  LONG v54; // [esp-10h] [ebp-F4h]
  LONG v55; // [esp-10h] [ebp-F4h]
  LONG v56; // [esp-10h] [ebp-F4h]
  LONG v57; // [esp-8h] [ebp-ECh]
  __int16 x_4; // [esp+4h] [ebp-E0h]
  __int16 x_4a; // [esp+4h] [ebp-E0h]
  __int16 x_4b; // [esp+4h] [ebp-E0h]
  LONG x_4c; // [esp+4h] [ebp-E0h]
  __int64 v62; // [esp+8h] [ebp-DCh]
  unsigned __int64 v63; // [esp+8h] [ebp-DCh]
  __int64 v64; // [esp+8h] [ebp-DCh]
  LONG v65; // [esp+Ch] [ebp-D8h]
  char s[100]; // [esp+10h] [ebp-D4h] BYREF
  char v67[60]; // [esp+74h] [ebp-70h] BYREF
  LONG v68; // [esp+B0h] [ebp-34h]
  LONG hotY; // [esp+B4h] [ebp-30h]
  int v70; // [esp+B8h] [ebp-2Ch]
  int v71; // [esp+BCh] [ebp-28h]
  PANE *pane; // [esp+C0h] [ebp-24h]
  int v73; // [esp+C4h] [ebp-20h]
  char *string; // [esp+C8h] [ebp-1Ch]
  char a2[4]; // [esp+CCh] [ebp-18h]
  int v76; // [esp+D0h] [ebp-14h]
  LONG shape_number; // [esp+D4h] [ebp-10h]

  pane = (PANE *)a1;
  v6 = &V_Game.stars[pPlanet->starIndex];
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           (unsigned __int16)word_96B2A);
  if ( !ShapeTable_sub_1B084 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x41);
  }
  VFX_shape_draw(pane, ShapeTable_sub_1B084, v6->a, 0x4B, 0x4B);
  v8 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_96B2C);
  if ( !v8 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x45);
  }
  VFX_shape_draw(pane, v8, pPlanet->size + 5 * pPlanet->type, 0xC8, 0x4B);
  v73 = 4 * V_Game.races[byte_104BEA].Unknown_02 + 0x13;
  v70 = v73;
  if ( a4 )
  {
    if ( V_Mouse.x >= 0x96 )
    {
      v73 = 0xF3;
    }
    else
    {
      v70 = 0xF3;
    }
  }
  Unknown_14 = (unsigned __int8)v6->Unknown_14;
  if ( Unknown_14 == 1 << byte_104BEA || v6 == V_Game.races[byte_104BEA].star && ((1 << byte_104BEA) & Unknown_14) != 0 )
  {
    Q_WINMGR_CPP_sub_53E38(pane, 4, 0xA, byte_104BEA);
  }
  Name = V_Game.stars[pPlanet->starIndex].Name;
  v11 = v70;
  V_Type3_stru_10AE70.pane.window = pane->window;
  p_x0 = &pane->x0;
  V_Type3_stru_10AE70.pane.x0 = pane->x0;
  V_Type3_stru_10AE70.pane.y0 = *++p_x0;
  V_Type3_stru_10AE70.pane.x1 = *++p_x0;
  V_Type3_stru_10AE70.pane.y1 = p_x0[1];
  sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0x78, 0x12, Name, 0, v11, 0xFF, 0);
  string = pPlanet->name;
  x_4 = v73;
  v71 = (__int16)v73;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = pane->window;
  v13 = &pane->x0;
  V_Type3_stru_10AE70.rect.x1 = pane->x0;
  V_Type3_stru_10AE70.rect.y1 = *++v13;
  V_Type3_stru_10AE70.rect.x2 = *++v13;
  V_Type3_stru_10AE70.rect.y2 = v13[1];
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0x113, 0xF, pPlanet->name, 0, x_4, 0xFF, 0);
  v14 = sub_2B4F4(&V_Type3_stru_10AE70.z1cc[4], string) + 0x127;
  HIDWORD(v62) = dword_10469C[pPlanet->type];
  LODWORD(v62) = dword_104688[pPlanet->size];
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x88);// 136: "(%s %s Planet)"
  sprintf(s, sub_1CEA8, v62);
  x_4a = v71;
  V_Type3_stru_10AE70.pane.window = pane->window;
  v16 = &pane->x0;
  V_Type3_stru_10AE70.pane.x0 = pane->x0;
  V_Type3_stru_10AE70.pane.y0 = *++v16;
  V_Type3_stru_10AE70.pane.x1 = *++v16;
  V_Type3_stru_10AE70.pane.y1 = v16[1];
  sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, v14, 0x10, s, 0, x_4a, 0xFF, 0);
  z7 = pPlanet->z7;
  v68 = 0x1E;
  if ( z7 == 0xFFFFFFFF )
  {
    v18 = pane;
    v19 = v71;
    v20 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x89);    // 137: "Self-Managed"
    V_Type3_stru_10AE70.pane.window = v18->window;
    v18 = (PANE *)((char *)v18 + 4);
    V_Type3_stru_10AE70.pane.x0 = (LONG)v18->window;
    v18 = (PANE *)((char *)v18 + 4);
    V_Type3_stru_10AE70.pane.y0 = (LONG)v18->window;
    v18 = (PANE *)((char *)v18 + 4);
    V_Type3_stru_10AE70.pane.x1 = (LONG)v18->window;
    V_Type3_stru_10AE70.pane.y1 = v18->x0;
    v68 = 0x27;
    sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0x113, 0x1E, v20, 0, v19, 0xFF, 0);
  }
  if ( pPlanet->buildingPlanetItemIndex == 0xFF )
  {
    v29 = s;
    v30 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x8D);    // 141: "No Project"
    do
    {
      v31 = *v30;
      *v29 = *v30;
      if ( !v31 )
      {
        break;
      }
      v32 = v30[1];
      v30 += 2;
      v29[1] = v32;
      v29 += 2;
    }
    while ( v32 );
    if ( pPlanet->word42 == pPlanet->word4C )
    {
      v33 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x8E);  // 142: "   (No Free Population)"
      v34 = &s[strlen(s)];
      do
      {
        v35 = *v33;
        *v34 = *v33;
        if ( !v35 )
        {
          break;
        }
        v36 = v33[1];
        v33 += 2;
        v34[1] = v36;
        v34 += 2;
      }
      while ( v36 );
    }
    v73 = 0xF3;
  }
  else
  {
    qmemcpy(v67, &unk_96B30, sizeof(v67));
    if ( (V_PlanetItems.item[pPlanet->buildingPlanetItemIndex].flags & 2) == 0 )
    {
      DaysToCompletePlanetItem_sub_358BC = (unsigned __int16)Q_GetDaysToCompletePlanetItem_sub_358BC(pPlanet);
      if ( (unsigned __int16)DaysToCompletePlanetItem_sub_358BC == 0xFFFF )
      {
        v22 = v67;
        v23 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x8A);// 138: " - No Progress"
        do
        {
          v24 = *v23;
          *v22 = *v23;
          if ( !v24 )
          {
            break;
          }
          v25 = v23[1];
          v23 += 2;
          v22[1] = v25;
          v22 += 2;
        }
        while ( v25 );
      }
      else
      {
        if ( DaysToCompletePlanetItem_sub_358BC == 1 )
        {
          v26 = 0x1C;                                  // 28: ""
        }
        else
        {
          v26 = 0x1D;                                  // 29: "s"
        }
        v63 = __PAIR64__((unsigned int)Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v26), DaysToCompletePlanetItem_sub_358BC);
        v27 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x8B);// 139: " - %d day%s until completion"
        sprintf(v67, v27, v63);
      }
    }
    HIDWORD(v64) = v67;
    LODWORD(v64) = V_PlanetItems.item[pPlanet->buildingPlanetItemIndex].name;
    v28 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x8C);    // 140: "Building %s%s"
    sprintf(s, v28, v64);
  }
  v37 = v68;
  x_4b = v73;
  V_Type3_stru_10AE70.pane.window = pane->window;
  v38 = &pane->x0;
  V_Type3_stru_10AE70.pane.x0 = pane->x0;
  V_Type3_stru_10AE70.pane.y0 = *++v38;
  V_Type3_stru_10AE70.pane.x1 = *++v38;
  V_Type3_stru_10AE70.pane.y1 = v38[1];
  sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0x113, v37, s, 0, x_4b, 0xFF, 0);
  v39 = 0;
  v68 = 0x19;
  v40 = word_FFEDC;
  *(_DWORD *)a2 = (unsigned __int16)word_96B6C;
  do
  {
    v41 = sub_35930(pPlanet, a2[v39]);
    if ( v41 != 0xFFFF )
    {
      v41 = *((_WORD *)pPlanet->a + 2 * v41 + 1) & 1;
      if ( v41 )
      {
        v57 = v68;
        v53 = (unsigned __int8)a2[v39];
        v42 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, v40);
        VFX_shape_transform(pane, v42, v53, 0xF5, v57, V_BigBuffer, 0, 0x4000, 0x4000, 0);
        v68 += 0x19;
      }
    }
    ++v39;
  }
  while ( v39 < 2 );
  LOWORD(v41) = word_FFEEC;
  v76 = v41;
  string = (char *)pPlanet->word46;
  string = (char *)(int)pow((double)(int)string, 0.75);
  shape_number = (LONG)string;
  if ( (unsigned __int16)string > 0x14u )
  {
    shape_number = 0x14;
  }
  v54 = (unsigned __int16)shape_number;
  v43 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v76);
  VFX_shape_transform(pane, v43, v54, 0x118, 0x3C, V_BigBuffer, 0, 0x8000, 0x8000, 0);
  LOWORD(v44) = word_FFEEE;
  v76 = v44;
  string = (char *)pPlanet->production;
  string = (char *)(int)pow((double)(int)string, 0.75);
  shape_number = (LONG)string;
  if ( (unsigned __int16)string > 0x14u )
  {
    shape_number = 0x14;
  }
  v55 = (unsigned __int16)shape_number;
  v45 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v76);
  VFX_shape_transform(pane, v45, v55, 0x15E, 0x3C, V_BigBuffer, 0, 0x8000, 0x8000, 0);
  LOWORD(v46) = word_FFEF0;
  v76 = v46;
  LOWORD(v46) = pPlanet->word48;
  shape_number = v46;
  if ( (unsigned __int16)v46 > 0x14u )
  {
    shape_number = 0x14;
  }
  v56 = (unsigned __int16)shape_number;
  v47 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v76);
  v48 = 0x1EA;
  VFX_shape_transform(pane, v47, v56, 0x1A4, 0x3C, V_BigBuffer, 0, 0x8000, 0x8000, 0);
  LOWORD(v49) = word_FFEF8;
  hotY = 0x3C;
  v76 = v49;
  shape_number = 6;
  for ( i = 0; ; ++i )
  {
    result = pPlanet->word4A;
    if ( i >= result )
    {
      break;
    }
    if ( i == (unsigned __int16)pPlanet->word4C )
    {
      shape_number = 7;
    }
    if ( i == pPlanet->word42 )
    {
      shape_number = 8;
    }
    v65 = hotY;
    x_4c = (unsigned __int16)shape_number;
    v52 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v76);
    VFX_shape_draw(pane, v52, x_4c, v48, v65);
    v48 += 5;
    if ( i % 0xA == 9 )
    {
      v48 = 0x1EA;
      hotY += 5;
    }
  }
  return result;
}
// 50A78: variable 'v41' is possibly undefined
// 50B38: variable 'v44' is possibly undefined
// 50BF8: variable 'v46' is possibly undefined
// 50C99: variable 'v49' is possibly undefined
// 96B6C: using guessed type __int16 word_96B6C;
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];
// FFEEC: using guessed type __int16 word_FFEEC;
// FFEEE: using guessed type __int16 word_FFEEE;
// FFEF0: using guessed type __int16 word_FFEF0;
// 104688: using guessed type int dword_104688[4];
// 10469C: using guessed type int dword_10469C[10];
// 50530: using guessed type char s[100];

//----- (00050D70) --------------------------------------------------------
void __fastcall sub_50D70(_DWORD *a1, int a2, int a3, int a4)
{
  void *ShapeTable_sub_1B084; // eax
  int v6; // esi
  char *v7; // eax
  void *v8; // eax
  LONG *v9; // ecx
  char *v10; // eax
  void *v11; // eax
  int v12; // edx
  float *v13; // esi
  float *v14; // eax
  int v15; // ebx
  double v16; // st7
  char v17; // ah
  char *v18; // edi
  unsigned int v19; // esi
  float *v20; // eax
  int v21; // eax
  char *v22; // eax
  int v23; // esi
  char *sub_1CEA8; // eax
  void *v25; // eax
  int v26; // esi
  char *v27; // eax
  void *v28; // eax
  char v29; // bh
  int v30; // edx
  char *v31; // eax
  char *v32; // esi
  char *v33; // edi
  char v34; // al
  char v35; // al
  int v36; // edi
  int v37; // esi
  int v38; // eax
  LONG v39; // ecx
  void *v40; // eax
  int v41; // edi
  int v42; // esi
  int v43; // edi
  void *v44; // eax
  LONG v45; // edi
  int v46; // eax
  int v47; // ebx
  __int16 v48; // si
  void *v49; // eax
  __int16 v50; // [esp-4h] [ebp-174h]
  LONG v51; // [esp-4h] [ebp-174h]
  LONG v52; // [esp-4h] [ebp-174h]
  unsigned __int64 x; // [esp+0h] [ebp-170h]
  LONG xa; // [esp+0h] [ebp-170h]
  __int16 x_4; // [esp+4h] [ebp-16Ch]
  LONG x_4a; // [esp+4h] [ebp-16Ch]
  LONG x_4b; // [esp+4h] [ebp-16Ch]
  char s[200]; // [esp+8h] [ebp-168h] BYREF
  PANE pane; // [esp+D0h] [ebp-A0h] BYREF
  int v60[5]; // [esp+E4h] [ebp-8Ch]
  int v61[3]; // [esp+F8h] [ebp-78h] BYREF
  float v62; // [esp+104h] [ebp-6Ch]
  float v63; // [esp+108h] [ebp-68h]
  float v64; // [esp+10Ch] [ebp-64h]
  LONG v65[2]; // [esp+110h] [ebp-60h]
  int v66[2]; // [esp+118h] [ebp-58h]
  int v67[3]; // [esp+120h] [ebp-50h]
  int v68; // [esp+12Ch] [ebp-44h]
  float v69; // [esp+130h] [ebp-40h]
  float v70; // [esp+134h] [ebp-3Ch]
  int v71; // [esp+138h] [ebp-38h]
  int v72; // [esp+13Ch] [ebp-34h]
  LONG v73; // [esp+140h] [ebp-30h]
  LONG x1; // [esp+144h] [ebp-2Ch]
  unsigned int v75; // [esp+148h] [ebp-28h]
  unsigned int v76; // [esp+14Ch] [ebp-24h]
  LONG shape_number; // [esp+150h] [ebp-20h]
  LONG hotY; // [esp+154h] [ebp-1Ch]
  unsigned int v79; // [esp+158h] [ebp-18h]
  int v80; // [esp+15Ch] [ebp-14h]
  int v81; // [esp+160h] [ebp-10h]

  v72 = a2;
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           (unsigned __int16)word_96B6E);
  VFX_shape_draw((PANE *)a1, ShapeTable_sub_1B084, *(char *)(a2 + 0xAA), 0x41, 0x32);
  v80 = 4 * V_Game.races[byte_104BEA].Unknown_02 + 0x13;
  if ( a4 )
  {
    v80 = 0xF3;
  }
  switch ( *(_BYTE *)(v72 + 0x58) )
  {
    case 1:
      v23 = *(_DWORD *)(v72 + 0x59);
      sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x93);// 147: "Under Construction at %s"
      sprintf(s, sub_1CEA8, v23 + 0x24);
      v25 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_96B72);
      VFX_shape_draw(
        (PANE *)a1,
        v25,
        *(unsigned __int16 *)(v23 + 0x14) + 5 * *(unsigned __int16 *)(v23 + 0x16),
        0x24E,
        0x31);
      break;
    case 2:
      v26 = *(_DWORD *)(v72 + 0x59);
      v27 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x94);  // 148: "Being Refitted at %s"
      sprintf(s, v27, v26 + 0x24);
      v28 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_96B72);
      VFX_shape_draw(
        (PANE *)a1,
        v28,
        5 * *(unsigned __int16 *)(v26 + 0x16) + *(unsigned __int16 *)(v26 + 0x14),
        0x24E,
        0x31);
      break;
    case 3:
      v6 = *(_DWORD *)(v72 + 0x59);
      v7 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x8F);   // 143: "Orbiting %s"
      sprintf(s, v7, v6 + 0x24);
      v8 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_96B72);
      VFX_shape_draw(
        (PANE *)a1,
        v8,
        *(unsigned __int16 *)(v6 + 0x14) + 5 * *(unsigned __int16 *)(v6 + 0x16),
        0x24E,
        0x31);
      break;
    case 4:
      v9 = *(LONG **)(v72 + 0x59);
      v10 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x90);  // 144: "in %s System"
      sprintf(s, v10, v9 + 7);
      v11 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_96B70);
      VFX_shape_draw((PANE *)a1, v11, *v9, 0x24E, 0x31);
      break;
    case 5:
      v12 = *(_DWORD *)(v72 + 0x59);
      v13 = *(float **)(v12 + 4);
      v14 = *(float **)v12;
      v67[2] = (int)v61;
      v62 = 0.0;
      v63 = 0.0;
      v64 = 0.0;
      v62 = v14[2] - v13[2];
      v63 = v14[3] - v13[3];
      v64 = v14[4] - v13[4];
      *(float *)v61 = v62;
      *(float *)&v61[1] = v63;
      *(float *)&v61[2] = v64;
      v15 = v72;
      v16 = sqrt(v63 * v63 + v62 * v62 + v64 * v64);
      v68 = *(_DWORD *)(v15 + 0xC) + *(_DWORD *)(v72 + 8);
      v69 = v16;
      v17 = *(_BYTE *)(v12 + 0x23);
      v70 = (float)v68;
      if ( (v17 & 1) != 0 )
      {
        v70 = v70 * flt_92C3A;
      }
      if ( V_Game.races[*(__int16 *)(v72 + 0x56)].Unknown_19D == 0x12 )
      {
        if ( v70 < 1.0 )
        {
          v70 = 1.0;
        }
        v70 = v70 * flt_92C3E;
      }
      v68 = (int)((v69 - *(float *)(v72 + 0x9E)) / v70);
      v18 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x91);  // 145: "Unknown"
      if ( (*(_DWORD *)(v72 + 0xA2) & 0x7FFFFFFF) != 0 )
      {
        v20 = *(float **)(v12 + 4);
      }
      else
      {
        v20 = *(float **)v12;
      }
      if ( ((1 << byte_104BEA) & *((unsigned __int8 *)v20 + 0x17)) != 0 )
      {
        v18 = (char *)(v20 + 7);
      }
      if ( v68 )
      {
        v21 = 0x1D;                                    // 29: "s"
      }
      else
      {
        v21 = 0x1C;                                    // 28: ""
      }
      v19 = v68 + 1;
      x = __PAIR64__((unsigned int)Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v21), v19);
      v22 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x92);  // 146: "In Starlane to %s System\nETA - %d Day%s"
      sprintf(s, v22, v18, x);
      break;
    default:
      sprintf(s, "Bad m_LocationType");
      break;
  }
  v29 = *(_BYTE *)(v72 + 0x5D);
  if ( v29 && v29 != 7 && *(_BYTE *)(v72 + 0x58) == 4 )
  {
    v30 = v72;
    v31 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x95);    // 149: "\nMoving to Planet"
    if ( *(_BYTE *)(v30 + 0x5D) == 1 )
    {
      v31 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x96);  // 150: "\nMoving to Starlane"
    }
    v32 = v31;
    v33 = &s[strlen(s)];
    do
    {
      v34 = *v32;
      *v33 = *v32;
      if ( !v34 )
      {
        break;
      }
      v35 = v32[1];
      v32 += 2;
      v33[1] = v35;
      v33 += 2;
    }
    while ( v35 );
  }
  v68 = (__int16)v80;
  V_Type3_stru_10AE70.pane = *(PANE *)a1;
  sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0x17C, 5, s, 0, v80, 0xFF, 0x8E);
  sprintf(s, "%s", (const char *)(v72 + 0x34));
  v50 = v68;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = *a1;
  V_Type3_stru_10AE70.rect.x1 = a1[1];
  V_Type3_stru_10AE70.rect.y1 = a1[2];
  V_Type3_stru_10AE70.rect.x2 = a1[3];
  V_Type3_stru_10AE70.rect.y2 = a1[4];
  v36 = 0x103;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0x96, 5, s, 0, v50, 0xFF, 0);
  v37 = 0;
  v71 = sub_4A8CC(v72);
  do
  {
    if ( v37 >= v71 )
    {
      break;
    }
    x_4 = *(_WORD *)(v72 + 0x56);
    v39 = v36;
    ++v37;
    v40 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEE6);
    v36 += 9;
    sub_53EB8((PANE *)a1, v40, 6, v39, 6, x_4);
  }
  while ( v37 < 9 );
  v60[0] = *(_DWORD *)v72;
  v60[1] = *(_DWORD *)(v72 + 4);
  v60[2] = *(_DWORD *)(v72 + 0x10);
  v60[3] = *(_DWORD *)(v72 + 0x20);
  v38 = *(_DWORD *)(v72 + 0x18);
  hotY = 0x19;
  v60[4] = v38;
  v75 = 0;
  pane = *(PANE *)a1;
  LOWORD(v38) = word_FFEE6;
  v81 = v38;
  v73 = 7;
  do
  {
    pane.x1 = pane.x0 + 0x95;
    v41 = v60[v75 / 4];
    v42 = 0x96;
    if ( v41 > 0 )
    {
      pane.x1 += 0xE * v41 / 4;
    }
    v43 = 0;
    shape_number = v73;
    do
    {
      x_4a = hotY;
      xa = v42;
      v51 = shape_number;
      v44 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v81);
      ++v43;
      v42 += 0xE;
      VFX_shape_draw(&pane, v44, v51, xa, x_4a);
    }
    while ( v43 < 0xE );
    hotY += 0xE;
    v75 += 4;
    ++v73;
  }
  while ( v75 != 0x14 );
  v67[0] = *(_DWORD *)(v72 + 0x8C);
  v45 = 0x15E;
  v67[1] = *(_DWORD *)(v72 + 0x88);
  v46 = *(_DWORD *)(v72 + 0x98);
  v76 = 0;
  v66[0] = v46;
  x1 = 0x16B;
  v66[1] = sub_4A8FC(v72);
  v65[1] = 0xB;
  v65[0] = 8;
  do
  {
    if ( v66[v76 / 4] > 0 )
    {
      if ( v67[v76 / 4] >= 0 )
      {
        v47 = v66[v76 / 4];
        if ( v67[v76 / 4] > v47 )
        {
          v67[v76 / 4] = v47;
        }
      }
      else
      {
        v67[v76 / 4] = 0;
      }
      v48 = 0;
      v79 = v76;
      while ( v48 < 7 )
      {
        x_4b = 0xE * v48 + 5;
        v52 = *(LONG *)((char *)v65 + v79);
        v49 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)v81);
        ++v48;
        VFX_shape_draw((PANE *)a1, v49, v52, v45, x_4b);
      }
      sub_2BB74(
        (PANE *)a1,
        v45,
        4,
        x1,
        0x66 - 0x62 * *(int *)((char *)v67 + v79) / *(int *)((char *)v66 + v79),
        0,
        0xFFFFFFFF);
    }
    v45 += 0xE;
    x1 += 0xE;
    v76 += 4;
  }
  while ( v76 != 8 );
}
// 92C3A: using guessed type float flt_92C3A;
// 92C3E: using guessed type float flt_92C3E;
// 50D70: using guessed type char s[200];

//----- (00051610) --------------------------------------------------------
void __fastcall sub_51610(T_Type5 *a1, LONG a2, int a3, int a4)
{
  void *ShapeTable_sub_1B084; // eax
  void *v6; // eax

  if ( a4 == 0xFFFFFFFF )
  {
    VFX_pane_wipe((PANE *)a1, 0x96);
  }
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           (unsigned __int16)word_FFEF4);
  VFX_shape_draw((PANE *)a1, ShapeTable_sub_1B084, a2, 0x38, 0x37);
  v6 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEE2);
  VFX_shape_draw((PANE *)a1, v6, 7, 0x38, 0x37);
}

//----- (00051674) --------------------------------------------------------
T_TypeA2 *__fastcall sub_51674(T_TypeA2 *a1)
{
  Q_A2_sub_2C830(a1);
  a1->b = (int)off_96128;
  sub_516D4((int)a1);
  return a1;
}
// 96128: using guessed type int (*off_96128[5])();

//----- (00051690) --------------------------------------------------------
int __fastcall sub_51690(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_960E4);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_96128;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 96128: using guessed type int (*off_96128[5])();

//----- (000516D4) --------------------------------------------------------
int __fastcall sub_516D4(int result)
{
  *(_DWORD *)(result + 0xAB) = 0;
  return result;
}

//----- (000516E0) --------------------------------------------------------
void __fastcall sub_516E0(_DWORD *a1)
{
  T_Star *stars; // eax
  int v2; // ebx
  int i; // edx
  int v4; // eax
  int v5; // eax
  char *v6; // eax
  UBYTE Unknown_02; // al
  int *v8; // esi
  char *v9; // [esp-14h] [ebp-6Ch]
  int v10; // [esp-10h] [ebp-68h]
  char *v11; // [esp-Ch] [ebp-64h]
  char *sub_1CEA8; // [esp-4h] [ebp-5Ch]
  char s[80]; // [esp+0h] [ebp-58h] BYREF
  PANE *p_x0; // [esp+50h] [ebp-8h]
  _DWORD *v15; // [esp+54h] [ebp-4h]

  v15 = a1;
  stars = V_Game.stars;
  v2 = 0;
  for ( i = 0; (__int16)i < V_Game.starsNum; ++stars )
  {
    if ( (unsigned __int8)stars->Unknown_14 == 1 << byte_104BEA && stars != V_Game.races[byte_104BEA].star )
    {
      ++v2;
    }
    ++i;
  }
  if ( ((1 << byte_104BEA) & (unsigned __int8)V_Game.races[byte_104BEA].star->Unknown_14) != 0 )
  {
    ++v2;
  }
  if ( v2 == 1 )
  {
    v4 = 0x1C;
  }
  else
  {
    v4 = 0x1D;
  }
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v4);
  if ( *(_WORD *)(*(_DWORD *)((char *)v15 + 0xAB) + 0x8C7) == 1 )
  {
    v5 = 0x1C;
  }
  else
  {
    v5 = 0x1D;
  }
  v11 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v5);
  v10 = *(unsigned __int16 *)(*(_DWORD *)((char *)v15 + 0xAB) + 0x8C7);
  v9 = V_SpecNames[V_Game.races[byte_104BEA].Unknown_01];
  v6 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x97);
  sprintf(s, v6, v9, v10, v11, v2, sub_1CEA8);
  Unknown_02 = V_Game.races[byte_104BEA].Unknown_02;
  p_x0 = (PANE *)&CONTAINING_RECORD(v15, PANE, window)->x0;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = v15[1];
  v8 = v15 + 2;
  V_Type3_stru_10AE70.rect.x1 = v15[2];
  V_Type3_stru_10AE70.rect.y1 = *++v8;
  V_Type3_stru_10AE70.rect.x2 = *++v8;
  V_Type3_stru_10AE70.rect.y2 = v8[1];
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0x19, 9, s, 2, 4 * Unknown_02 + 0x13, 0xFF, 0);
  Q_WINMGR_CPP_sub_53E38(p_x0, 3, 3, byte_104BEA);
  sub_2D218(v15);
}

//----- (00051894) --------------------------------------------------------
unsigned int __fastcall sub_51894(int a1, __int16 a2, __int16 a3, int a4)
{
  T_TypeA1 *Wnd_sub_56DA8; // eax
  WORD i; // di
  T_Planet *v8; // esi
  unsigned __int16 v9; // ax
  T_Planet *v10; // eax

  if ( (unsigned __int16)a2 < 2u )
  {
    if ( a2 != 1 )
    {
      return sub_2F424(a1, a2, a3, a4);
    }
    if ( !*(_DWORD *)(a1 + 0xAB) )
    {
      Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "STATPLANLST", 0);
      *(_DWORD *)(a1 + 0xAB) = Wnd_sub_56DA8;
      if ( !Wnd_sub_56DA8 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x1CB);
      }
      *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0xAB) = 0;
      *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8C9) = 0x8D;
      sub_2F1C8(*(_DWORD *)(a1 + 0xAB), (int)sub_50530);
      sub_2F1D8(*(_DWORD *)(a1 + 0xAB), (int)sub_10A14);
      *(_BYTE *)(*(_DWORD *)(a1 + 0xAB) + 0xC5) = 0;
      *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0xBB) = 0xFFFFFFFF;
    }
    if ( (unsigned __int16)word_96B2C == 0xFFFF )
    {
      LOWORD(word_96B2C) = sub_1B270(&V_Type3_stru_10AE70.t13, "DATA\\planets.shp", 0);
      if ( (unsigned __int16)word_96B2C == 0xFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x1D9);
      }
    }
    if ( (unsigned __int16)word_96B2A == 0xFFFF )
    {
      LOWORD(word_96B2A) = sub_1B270(&V_Type3_stru_10AE70.t13, "DATA\\suns.shp", 0);
      if ( (unsigned __int16)word_96B2A == 0xFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x1E0);
      }
    }
    sub_2ED4C(*(_DWORD *)(a1 + 0xAB));
    for ( i = 0; i < V_Game.planetsNum; ++i )
    {
      v8 = &V_Game.planets[i];
      if ( v8->byte57 == byte_104BEA )
      {
        v9 = sub_2EA8C(*(_DWORD *)(a1 + 0xAB), (const char *)v8, 0x96, 0);
        sub_2EC50(*(_DWORD *)(a1 + 0xAB), v9, v8->Unknown_67);
      }
    }
    sub_2F1E0(*(_DWORD *)(a1 + 0xAB));
    sub_2ECDC(*(_DWORD *)(a1 + 0xAB), *(_WORD *)(a1 + 0xAF));
    return sub_2F424(a1, a2, a3, a4);
  }
  else if ( (unsigned __int16)a2 <= 2u )
  {
    *(_WORD *)(a1 + 0xAF) = *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8CD);
    return sub_2F424(a1, a2, a3, a4);
  }
  else
  {
    if ( a2 != 0x1C01 )
    {
      return sub_2F424(a1, a2, a3, a4);
    }
    v10 = (T_Planet *)sub_2ED14(*(_DWORD *)(a1 + 0xAB), a3);
    if ( V_Mouse.x <= 0x96 )
    {
      V_Game.h1 = (char *)&V_Game.stars[v10->starIndex];
      sub_56B60(&V_Type3_stru_10AE70, 1, 0x10, 1);
    }
    else
    {
      V_Game.planet = v10;
      sub_56B60(&V_Type3_stru_10AE70, 1, 0x11, 1);
    }
    *(_WORD *)(a1 + 0xAF) = *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8CD);
    return 0;
  }
}

//----- (00051B64) --------------------------------------------------------
T_TypeA2 *__fastcall sub_51B64(T_TypeA2 *a1)
{
  Q_A2_sub_2C830(a1);
  a1->b = (int)off_96110;
  sub_516D4((int)a1);
  return a1;
}
// 96110: using guessed type int (*off_96110[5])();

//----- (00051B80) --------------------------------------------------------
int __fastcall sub_51B80(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_960D0);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_96110;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 96110: using guessed type int (*off_96110[5])();

//----- (00051BC4) --------------------------------------------------------
void __fastcall sub_51BC4(_DWORD *a1)
{
  signed int v1; // eax
  int v2; // edx
  const char *v3; // eax
  char *sub_1CEA8; // eax
  UBYTE Unknown_02; // al
  int *v6; // esi
  char *v7; // [esp-10h] [ebp-68h]
  int v8; // [esp-Ch] [ebp-64h]
  const char *v9; // [esp-8h] [ebp-60h]
  char s[80]; // [esp+0h] [ebp-58h] BYREF
  _DWORD *v11; // [esp+50h] [ebp-8h]
  PANE *p_x0; // [esp+54h] [ebp-4h]

  v11 = a1;
  v1 = sub_3EFE0((int)&V_Game.races[byte_104BEA]);
  v2 = v1;
  if ( v1 >= 0 )
  {
    if ( v1 > 0x64 )
    {
      v2 = 0x64;
    }
  }
  else
  {
    v2 = 0;
  }
  if ( *(_WORD *)(*(_DWORD *)((char *)v11 + 0xAB) + 0x8C7) == 1 )
  {
    v3 = (const char *)&unk_92C97;
  }
  else
  {
    v3 = "s";
  }
  v9 = v3;
  v8 = *(unsigned __int16 *)(*(_DWORD *)((char *)v11 + 0xAB) + 0x8C7);
  v7 = V_SpecNames[V_Game.races[byte_104BEA].Unknown_01];
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x98);// Static text 152
  sprintf(s, sub_1CEA8, v7, v8, v9, v2);
  Unknown_02 = V_Game.races[byte_104BEA].Unknown_02;
  p_x0 = (PANE *)&CONTAINING_RECORD(v11, PANE, window)->x0;
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = v11[1];
  v6 = v11 + 2;
  V_Type3_stru_10AE70.rect.x1 = v11[2];
  V_Type3_stru_10AE70.rect.y1 = *++v6;
  V_Type3_stru_10AE70.rect.x2 = *++v6;
  V_Type3_stru_10AE70.rect.y2 = v6[1];
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0x19, 9, s, 2, 4 * Unknown_02 + 0x13, 0xFF, 0);
  Q_WINMGR_CPP_sub_53E38(p_x0, 3, 3, byte_104BEA);
  sub_2D218(v11);
}

//----- (00051D24) --------------------------------------------------------
unsigned int __fastcall sub_51D24(int a1, __int16 a2, int a3, int a4)
{
  unsigned int result; // eax
  T_TypeA1 *Wnd_sub_56DA8; // eax
  signed int v7; // ebp
  int v8; // esi
  unsigned __int16 v9; // ax
  int v10; // ecx
  int v11; // ebx
  __int16 v12; // dx
  int v13; // eax
  int v14; // esi
  T_TypeA1 *v15; // eax
  int v16[107]; // [esp+0h] [ebp-1C8h] BYREF
  int v17; // [esp+1ACh] [ebp-1Ch]
  int v18; // [esp+1B0h] [ebp-18h]
  __int16 v19; // [esp+1B4h] [ebp-14h]
  __int16 i; // [esp+1B8h] [ebp-10h]

  v19 = a2;
  v18 = a3;
  v17 = a4;
  if ( (unsigned __int16)a2 < 2u )
  {
    if ( a2 != 1 )
    {
      return sub_2F424(a1, v19, v18, v17);
    }
    if ( !*(_DWORD *)(a1 + 0xAB) )
    {
      Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "STATSHIPLST", 0);
      *(_DWORD *)(a1 + 0xAB) = Wnd_sub_56DA8;
      if ( !Wnd_sub_56DA8 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x259);
      }
      *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0xAB) = 0;
      *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8C9) = 0x6A;
      sub_2F1C8(*(_DWORD *)(a1 + 0xAB), (int)sub_50D70);
      sub_2F1D8(*(_DWORD *)(a1 + 0xAB), (int)sub_10A14);
      *(_BYTE *)(*(_DWORD *)(a1 + 0xAB) + 0xC5) = 0;
    }
    LOWORD(word_96B6E) = word_FFEBC[byte_104BEA];
    if ( (unsigned __int16)word_96B72 == 0xFFFF )
    {
      LOWORD(word_96B72) = sub_1B270(&V_Type3_stru_10AE70.t13, "DATA\\planets.shp", 0);
      if ( (unsigned __int16)word_96B72 == 0xFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x269);
      }
    }
    if ( (unsigned __int16)word_96B70 == 0xFFFF )
    {
      LOWORD(word_96B70) = sub_1B270(&V_Type3_stru_10AE70.t13, "DATA\\suns.shp", 0);
      if ( (unsigned __int16)word_96B70 == 0xFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x270);
      }
    }
    sub_2ED4C(*(_DWORD *)(a1 + 0xAB));
    v7 = sub_40224(&V_Game.races[byte_104BEA].Unknown_00, v16, 0);
    for ( i = 0; i < v7; ++i )
    {
      v8 = v16[i];
      v9 = sub_2EA8C(*(_DWORD *)(a1 + 0xAB), (const char *)v8, 0x64, 0);
      sub_2EC50(*(_DWORD *)(a1 + 0xAB), v9, *(_DWORD *)(v8 + 0x52));
    }
    v10 = v17;
    sub_2F1E0(*(_DWORD *)(a1 + 0xAB));
    v11 = v18;
    sub_2ECDC(*(_DWORD *)(a1 + 0xAB), *(_WORD *)(a1 + 0xAF));
    return sub_2F424(a1, v19, v11, v10);
  }
  else if ( (unsigned __int16)a2 <= 2u )
  {
    v12 = v19;
    *(_WORD *)(a1 + 0xAF) = *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8CD);
    return sub_2F424(a1, v12, a3, a4);
  }
  else
  {
    if ( a2 != 0x1C01 )
    {
      return sub_2F424(a1, v19, v18, v17);
    }
    v13 = sub_2ED14(*(_DWORD *)(a1 + 0xAB), v18);
    v14 = v13;
    if ( a4 == 5 )
    {
      v15 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "SHIPDESSCREEN", 0);
      sub_4DA7C((int)v15, v14, 0, 0xFFFFFFFF);
      sub_56B60(&V_Type3_stru_10AE70, 1, 8, 1);
      *(_WORD *)(a1 + 0xAF) = *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8CD);
      return 0xFFFFFFFF;
    }
    else
    {
      switch ( *(_BYTE *)(v13 + 0x58) )
      {
        case 1:
        case 2:
        case 3:
          V_Game.planet = *(T_Planet **)(v13 + 0x59);
          sub_56B60(&V_Type3_stru_10AE70, 1, 0x11, 1);
          *(_WORD *)(a1 + 0xAF) = *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8CD);
          result = 0xFFFFFFFF;
          break;
        case 4:
          V_Game.h1 = *(char **)(v13 + 0x59);
          sub_56B60(&V_Type3_stru_10AE70, 1, 0x10, 1);
          *(_WORD *)(a1 + 0xAF) = *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8CD);
          result = 0xFFFFFFFF;
          break;
        case 5:
          sub_56B60(&V_Type3_stru_10AE70, 3, 0, 0);
          result = 0xFFFFFFFF;
          break;
        default:
          result = 0;
          break;
      }
    }
  }
  return result;
}
// FFEBC: using guessed type __int16 word_FFEBC[7];
// 51D24: using guessed type int var_1C8[107];

//----- (000520EC) --------------------------------------------------------
T_TypeA2 *__fastcall sub_520EC(T_TypeA2 *a1)
{
  Q_A2_sub_2C830(a1);
  a1->b = (int)off_960F8;
  sub_5214C((int)a1);
  return a1;
}
// 960F8: using guessed type int (*off_960F8[5])();

//----- (00052108) --------------------------------------------------------
int __fastcall sub_52108(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_960BC);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_960F8;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 960F8: using guessed type int (*off_960F8[5])();

//----- (0005214C) --------------------------------------------------------
int __fastcall sub_5214C(int result)
{
  *(_DWORD *)(result + 0xAF) = 0;
  *(_DWORD *)(result + 0xAB) = 0;
  *(_WORD *)(result + 0xB3) = 0;
  *(_WORD *)(result + 0xB5) = 0;
  return result;
}

//----- (00052174) --------------------------------------------------------
int __fastcall sub_52174(int a1)
{
  char *v1; // ecx
  int v2; // esi
  FILE *v3; // edi

  *(_DWORD *)(a1 + 0xAF) = &unk_109DF8;
  v1 = *(char **)(a1 + 0xAF);
  v2 = 0;
  v3 = Q_OpenFile_sub_1BB10("newgame.txt", 0);
  do
  {
    fgets(v1, 0xC7, v3);
    ++v2;
    v1 += 0xC8;
  }
  while ( v2 < 0x15 );
  return fclose(v3);
}

//----- (000521C0) --------------------------------------------------------
void __fastcall sub_521C0(int a1, int edx0)
{
  char *sub_1CEA8; // eax
  int v4; // edi
  void *ShapeTable_sub_1B084; // ecx
  void *v6; // ecx
  unsigned __int16 v7; // ax
  void *v8; // eax
  int v9; // ebx
  char *v10; // eax
  int v11; // eax
  int v12; // edx
  int i; // ebx
  char *v14; // eax
  int v15; // ebx
  int j; // edx
  char *v17; // eax
  int v18; // ebx
  int k; // edx
  char *v20; // eax
  char *v21; // eax
  __int16 m; // si
  LONG v23; // ebx
  void *v24; // eax
  LONG v25; // [esp-Ch] [ebp-15Ch]
  int v26; // [esp-Ch] [ebp-15Ch]
  int v27; // [esp-8h] [ebp-158h]
  int v28; // [esp-4h] [ebp-154h]
  int v29; // [esp-4h] [ebp-154h]
  char s[280]; // [esp+0h] [ebp-150h] BYREF
  PANE pane; // [esp+118h] [ebp-38h] BYREF
  int a2[3]; // [esp+12Ch] [ebp-24h]
  int v33; // [esp+138h] [ebp-18h]

  v33 = edx0;
  sub_52714(a1);
  pane.window = *(WINDOW **)(a1 + 4);
  pane.x0 = 0x1F6;
  pane.y0 = 7;
  pane.x1 = 0x278;
  pane.y1 = 0x24;
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x99);// 153: "Player Species"
  sprintf(s, sub_1CEA8);
  *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = pane;
  v4 = v33;
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0, s, 3, 0xF3, 0xFF, 0x6E);
  if ( !v4 )
  {
    pane = *(PANE *)(a1 + 4);
    VFX_pane_wipe((PANE *)(a1 + 4), 0);
    pane.y1 = 0x23;
    *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = pane;
    sub_2B8A8(
      (int)&V_Type3_stru_10AE70.z1cc[4],
      0,
      0,
      V_SpecNames[*(__int16 *)(a1 + 0xB3)],
      3,
      (unsigned __int8)byte_96779[*(__int16 *)(a1 + 0xB5)],
      0xFF,
      0);
    ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                             (unsigned int)&V_Type3_stru_10AE70.t13,
                             (unsigned __int16)word_FFEF4);
    if ( !ShapeTable_sub_1B084 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x325);
    }
    VFX_shape_draw((PANE *)(a1 + 4), ShapeTable_sub_1B084, *(__int16 *)(a1 + 0xB3), 0x4B, 0x55);
    v6 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEE2);
    if ( !v6 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x329);
    }
    VFX_shape_draw((PANE *)(a1 + 4), v6, *(__int16 *)(a1 + 0xB5), 0x4B, 0x55);
    v7 = sub_1B270(&V_Type3_stru_10AE70.t13, "DATA\\smhome.shp", 0xFFFFFFFF);
    if ( v7 == 0xFFFF )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x334);
    }
    v25 = *(__int16 *)(a1 + 0xB3);
    v8 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, v7);
    VFX_shape_draw((PANE *)(a1 + 4), v8, v25, 0x48, 0xCD);
    Q_WINMGR_CPP_sub_53E38((PANE *)(a1 + 4), 0x6B, 0xC1, byte_104BEA);
    if ( !*(_DWORD *)(a1 + 0xAF) )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x340);
    }
    if ( *(__int16 *)(a1 + 0xB3) >= 0x15 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x341);
    }
    v9 = *(__int16 *)(a1 + 0xB3);
    v28 = *(_DWORD *)(a1 + 0xAF) + 0xC8 * v9;
    v10 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x9A);    // 154: "The %s %s"
    sprintf(s, v10, V_SpecNames[v9], v28);
    pane.y0 = 0x109;
    pane.y1 = *(_DWORD *)(a1 + 0x14);
    v11 = *(__int16 *)(a1 + 0xB5);
    V_Type3_stru_10AE70.pane = pane;
    sub_2B8A8((int)V_Type3_stru_10AE70.z1ccc, 0, 0, s, 0, (unsigned __int8)byte_96779[v11], 0xFF, 0x96);
    v12 = 0x9B;                                        // 155: "Vacuous"
    for ( i = 0; i != 0x14; *(_DWORD *)&s[i + 0xEC] = v14 )
    {
      i += 4;
      v14 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v12++);
    }
    v15 = 0xA0;                                        // 160: "Peaceful"
    for ( j = 0; j != 0xC; *(LONG *)((char *)&pane.y1 + j) = (LONG)v17 )
    {
      j += 4;
      v17 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v15++);
    }
    v18 = 0xA3;                                        // 163: "Three"
    for ( k = 0; k != 0x14; *(_DWORD *)&s[k + 0x100] = v20 )
    {
      k += 4;
      v20 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(v18++);
    }
    pane.x0 = 0x11;
    pane.y0 = 0x145;
    pane.x1 = 0x144;
    pane.y1 = 0x172;
    v29 = a2[*(__int16 *)(a1 + 0xBB)];
    v27 = *(_DWORD *)&s[4 * *(__int16 *)(a1 + 0xB9) + 0xF8];
    v26 = *(_DWORD *)&s[4 * *(__int16 *)(a1 + 0xB7) + 0xF0];
    v21 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xA8);    // 168: "%s Star Cluster\n%s Species\n%s Atmosphere"
    sprintf(s, v21, v26, v27, v29);
    *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = pane;
    sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0, s, 0x82, 0xFFFFFFFF, 0, 0xFA);
    sub_552CC(&V_Type3_stru_10AE70, (PANE *)(a1 + 4));
    pane.window = V_Type6_stru_D8654.pane.window;
    pane.x1 = 0x18B;
    pane.y1 = 0x1CF;
    pane.x0 = 0x17D;
    pane.y0 = 0x1B1;
    for ( m = 0; m < 7; ++m )
    {
      v23 = *(__int16 *)(a1 + 0xB3);
      v24 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEE0);
      sub_53F40((T_Type5 *)&pane, v24, v23, 0, 0, m);
      if ( m == *(_WORD *)(a1 + 0xB5) )
      {
        sub_2BB74(&pane, 0, 0, 0xE, 0x18, 0xF3u, 0);
      }
      pane.x0 += 0x10;
      pane.x1 += 0x10;
    }
    sub_55274(&V_Type3_stru_10AE70, 0x17B, 0x1A4, 0x1ED, 0x1D8);
  }
}
// 521C0: using guessed type int a2[3];

//----- (000526D8) --------------------------------------------------------
unsigned int sub_526D8()
{
  if ( V_Mouse.x <= 0x1F6 || V_Mouse.x >= 0x278 || V_Mouse.y <= 0x17D || V_Mouse.y >= 0x1D8 )
  {
    return 0;
  }
  else
  {
    return 0xFFFFFFFF;
  }
}

//----- (00052714) --------------------------------------------------------
int __fastcall sub_52714(int a1)
{
  LONG v1; // edx
  int v2; // eax
  int v3; // edi
  char *v4; // esi
  int v5; // ecx
  int v6; // edx
  int v7; // ebx
  char v8; // ah
  _DWORD *v9; // ebp
  void *ShapeTable_sub_1B084; // eax
  void *v11; // eax
  char *sub_1CEA8; // eax
  LONG v14; // [esp-20h] [ebp-60h]
  PANE pane; // [esp+0h] [ebp-40h] BYREF
  int v16; // [esp+14h] [ebp-2Ch]
  int v17; // [esp+18h] [ebp-28h]
  T_TypeA1 *v18; // [esp+1Ch] [ebp-24h]
  int v19; // [esp+20h] [ebp-20h]
  int i; // [esp+24h] [ebp-1Ch]

  v16 = a1;
  pane.window = V_Type6_stru_D8654.pane.window;
  pane.x0 = 0x1F6;
  pane.y0 = 0x17D;
  pane.x1 = 0x278;
  v1 = 0xF2;
  pane.y1 = 0x1D8;
  if ( sub_526D8() == 0xFFFFFFFF )
  {
    v1 = 0x96;
  }
  VFX_pane_wipe(&pane, v1);
  sub_55274(&V_Type3_stru_10AE70, 0x1F6, 0x17D, 0x278, 0x1D8);
  v18 = sub_56E18(&V_Type3_stru_10AE70, "COSMOSWnd", 3, 0);
  if ( !v18 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x3BB);
  }
  HIWORD(v2) = HIWORD(v18);
  v3 = 0;
  LOWORD(v2) = *(_WORD *)((char *)&v18[8].j + 1);
  v4 = &v18[2].name[4];
  for ( i = v2; (__int16)v3 < (__int16)i; v4 += 4 )
  {
    v7 = *(_DWORD *)v4;
    v8 = *(_BYTE *)(*(_DWORD *)v4 + 4);
    v19 = (int)(*(float *)(*(_DWORD *)v4 + 0xD) + flt_92D77);
    if ( !v8 )
    {
      v5 = 3;
      v9 = *(_DWORD **)v7;
      if ( v19 <= 0xDC )
      {
        if ( v19 <= 0 )
        {
          if ( v19 > (int)0xFFFFFF24 )
          {
            v5 = 2;
          }
        }
        else
        {
          v5 = 1;
        }
      }
      else
      {
        v5 = 0;
      }
      v6 = *(__int16 *)(v7 + 7);
      v17 = 5;
      VFX_shape_draw(&pane, v18[1].pane.window, 4 * *v9 + v5, *(__int16 *)(v7 + 5) / 5 + 5, v6 / 5 + 5);
    }
    ++v3;
  }
  v14 = *(__int16 *)(v16 + 0xB3);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           (unsigned __int16)word_FFEF4);
  VFX_shape_transform(&pane, ShapeTable_sub_1B084, v14, 0x62, 0x24, V_BigBuffer, 0, 0x8000, 0x8000, 0);
  v11 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEF2);
  sub_53EB8(&pane, v11, 3, 0x62, 0x24, 0);
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xA9);// 169: "Begin New Game"
  *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = pane;
  return sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0x41, 0x50, sub_1CEA8, 0xC, 0xFFFFFFFF, 0xFF, 0);
}
// 92D77: using guessed type float flt_92D77;
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (0005294C) --------------------------------------------------------
unsigned int __fastcall sub_5294C(int a1, __int16 dx0, int a3, int a4)
{
  T_TypeA1 *v6; // eax
  T_TypeA1 *v7; // edx
  T_TypeA1 *v8; // eax
  _DWORD *v9; // eax
  _DWORD *v10; // edx
  T_TypeA1 *v11; // eax
  int v12; // eax
  T_TypeA1 *Wnd_sub_56DA8; // eax
  __int16 i; // si
  int v15; // eax
  int v16; // eax
  int v17; // eax
  __int16 v18; // bx
  __int16 v19; // edx^2
  int v20; // ecx
  int v21; // ebx
  __int16 v22; // dx
  int v23; // ecx
  int v24; // ebx
  int v25; // ebx
  _WORD v26[3]; // [esp+0h] [ebp-42h]
  int v27; // [esp+6h] [ebp-3Ch]
  int v28; // [esp+Ah] [ebp-38h]
  int v29; // [esp+Eh] [ebp-34h]
  int v30; // [esp+12h] [ebp-30h]
  PANE a2; // [esp+16h] [ebp-2Ch] BYREF
  int v32; // [esp+2Ah] [ebp-18h]
  int v33; // [esp+2Eh] [ebp-14h]
  __int16 v34; // [esp+32h] [ebp-10h]

  v34 = dx0;
  v33 = a3;
  v32 = a4;
  *(_DWORD *)&v26[1] = dword_96B74[0];
  v27 = dword_96B74[1];
  v28 = dword_96B74[2];
  v29 = dword_96B74[3];
  v30 = dword_96B74[4];
  if ( (unsigned __int16)dx0 < 0x1F5u )
  {
    if ( (unsigned __int16)dx0 < 2u )
    {
      if ( dx0 == 1 )
      {
        Q_SaveGam_sub_54048("resume.gam");
        dword_96BC0 = 0xFFFFFFFF;
        v12 = *(_DWORD *)(a1 + 0xAB);
        *(_DWORD *)&V_Type3_stru_10AE70.z5[8] = 0;
        if ( !v12 )
        {
          Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "RACELIST", 0);
          *(_DWORD *)(a1 + 0xAB) = Wnd_sub_56DA8;
          if ( !Wnd_sub_56DA8 )
          {
            Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x463);
          }
          *(_DWORD *)(*(_DWORD *)(a1 + 0xAB) + 0xAB) = 0;
          *(_WORD *)(*(_DWORD *)(a1 + 0xAB) + 0x8C9) = 0x6D;
          sub_2F1C8(*(_DWORD *)(a1 + 0xAB), (int)sub_51610);
          sub_2E9CC(*(_DWORD *)(a1 + 0xAB), 0);
          *(_BYTE *)(*(_DWORD *)(a1 + 0xAB) + 0xC6) = 0xF2;
        }
        sub_2ED4C(*(_DWORD *)(a1 + 0xAB));
        for ( i = 0; i < 0x15; ++i )
        {
          sub_2EA8C(*(_DWORD *)(a1 + 0xAB), (const char *)i, 0x73, 0);
        }
        v15 = *(_DWORD *)(a1 + 0x67);
        *(_WORD *)(a1 + 0xB7) = 2;
        *(_DWORD *)(*(_DWORD *)v15 + 0x72) = 2;
        v16 = *(_DWORD *)(a1 + 0x67);
        *(_WORD *)(a1 + 0xB9) = 5;
        *(_DWORD *)(*(_DWORD *)(v16 + 4) + 0x72) = 7;
        v17 = *(_DWORD *)(a1 + 0x67);
        *(_WORD *)(a1 + 0xBB) = 1;
        *(_DWORD *)(*(_DWORD *)(v17 + 8) + 0x72) = 0xB;
        v18 = *(_WORD *)(a1 + 0xB9);
        V_Game.Unknown_D8A[0x2A] = 1;
        *(_WORD *)(a1 + 0xB3) = 0;
        sub_1E10C(&V_Game, v26[2 * *(__int16 *)(a1 + 0xB7) + 1], v18, *(_WORD *)(a1 + 0xB3));
        *(_WORD *)(a1 + 0xB5) = 0;
        byte_104BEA = 0;
        V_Game.races[0].Unknown_01 = 0;
        sub_1EE08(&V_Game, *(_WORD *)(a1 + 0xB5));
        a2.window = *(WINDOW **)(a1 + 4);
        a2.y1 = 0x1D8;
        a2.x0 = 0x17B;
        a2.y0 = 0x1A4;
        a2.x1 = 0x1ED;
        VFX_pane_wipe(&a2, 0xF2);
        sub_552CC(&V_Type3_stru_10AE70, &a2);
        v19 = v34;
        v20 = v32;
        v21 = v33;
        sub_52174(a1);
        return sub_2F424(a1, v19, v21, v20);
      }
    }
    else
    {
      if ( (unsigned __int16)dx0 <= 2u )
      {
        return sub_2F424(a1, v34, a3, a4);
      }
      if ( (unsigned __int16)dx0 >= 4u )
      {
        if ( (unsigned __int16)dx0 <= 5u )
        {
          if ( a3 <= 0x17B || a3 >= 0x1ED || a4 <= 0x1A4 || a4 >= 0x1D8 )
          {
            if ( sub_526D8() == 0xFFFFFFFF )
            {
              Q_StartSample_sub_4FB90(&V_SoundSystem, 0);
              sub_1F404(&V_Game);
              sub_1F038(&V_Game);
              v6 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "BatModeWnd", 0);
              v7 = (T_TypeA1 *)((char *)v6 + 0x190);
              do
              {
                v6 = (T_TypeA1 *)((char *)v6 + 4);
                *(_DWORD *)&v6[0x1D].y[0x22] = 0;
              }
              while ( v6 != v7 );
              v8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "COSMOSWnd", 0);
              sub_2280C((int)v8, (int)"COSMOSWnd", 0, a4);
              v9 = &Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "RESWIN", 0)[1].y[0xB];
              v9[1] = 0;
              v9[2] = 0;
              v10 = v9 + 3;
              *v9 = 0x3F800000;
              v9[3] = 0;
              v9[4] = 0x3F800000;
              v9 += 6;
              v10[2] = 0;
              *v9 = 0;
              v9[1] = 0;
              v9[2] = 0x3F800000;
              v11 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "RACECONTROLS", 0);
              if ( !v11 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\status.cpp", 0x444);
              }
              sub_2DD70((int)v11);
              V_Game.Unknown_D8A[0x2A] = *(_BYTE *)(a1 + 0xBB);
              sub_1EEA4(&V_Game);
              dword_96BC0 = 0;
              sub_56B60(&V_Type3_stru_10AE70, 1, 0xC, 0);
              return 0xFFFFFFFF;
            }
            else
            {
              return 0;
            }
          }
          else
          {
            Q_StartSample_sub_4FB90(&V_SoundSystem, 0);
            *(_WORD *)(a1 + 0xB5) = (a3 - 0x17B) / 0x10;
            sub_1EE08(&V_Game, *(_WORD *)(a1 + 0xB5));
            (*(void (__cdecl **)(_DWORD, int, int, int, int))(*(_DWORD *)(a1 + 0xA7) + 0xC))(
              *(_DWORD *)&v26[1],
              v27,
              v28,
              v29,
              v30);
            return 0xFFFFFFFF;
          }
        }
        if ( dx0 == 0xC )
        {
          if ( a3 > 0x17B && a3 < 0x1ED && a4 > 0x1A4 && a4 < 0x1D8 )
          {
            sub_56B60(&V_Type3_stru_10AE70, 5, (int)"pcolor", 0);
            return 0xFFFFFFFF;
          }
          if ( sub_526D8() == 0xFFFFFFFF )
          {
            sub_56B60(&V_Type3_stru_10AE70, 5, (int)"beghelp", 0);
            return 0xFFFFFFFF;
          }
        }
      }
    }
    return sub_2F424(a1, v34, v33, v32);
  }
  if ( (unsigned __int16)dx0 <= 0x1F5u )
  {
    if ( ++*(_WORD *)(a1 + 0xB7) == 5 )
    {
      *(_WORD *)(a1 + 0xB7) = 0;
    }
    v23 = *(__int16 *)(a1 + 0xB3);
    v24 = *(__int16 *)(a1 + 0xB9);
    sub_1E10C(&V_Game, v26[2 * *(__int16 *)(a1 + 0xB7) + 1], v24, v23);
    sub_24D30((int)V_Type3_stru_10AE70.wnds[dword_96BAC].a1, dword_96BAC, v24, v23);
    (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    *(_DWORD *)(**(_DWORD **)(a1 + 0x67) + 0x72) = *(__int16 *)(a1 + 0xB7);
    (*(void (__cdecl **)(_DWORD, int, int, int, int))(*(_DWORD *)(**(_DWORD **)(a1 + 0x67) + 0xA7) + 0xC))(
      *(_DWORD *)&v26[1],
      v27,
      v28,
      v29,
      v30);
    return 0xFFFFFFFF;
  }
  if ( (unsigned __int16)dx0 < 0x1F9u )
  {
    if ( dx0 == 0x1F7 )
    {
      if ( ++*(_WORD *)(a1 + 0xB9) == 8 )
      {
        *(_WORD *)(a1 + 0xB9) = 3;
      }
      v25 = *(__int16 *)(a1 + 0xB3);
      sub_1E70C(&V_Game, *(_WORD *)(a1 + 0xB9), v25);
      sub_24D30((int)V_Type3_stru_10AE70.wnds[dword_96BAC].a1, dword_96BAC, v25, a4);
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
      *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4) + 0x72) = *(__int16 *)(a1 + 0xB9) + 2;
      (*(void (__cdecl **)(_DWORD, int, int, int, int))(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 4) + 0xA7) + 0xC))(
        *(_DWORD *)&v26[1],
        v27,
        v28,
        v29,
        v30);
      return 0xFFFFFFFF;
    }
    return sub_2F424(a1, v34, v33, v32);
  }
  if ( (unsigned __int16)dx0 <= 0x1F9u )
  {
    if ( ++*(_WORD *)(a1 + 0xBB) == 3 )
    {
      *(_WORD *)(a1 + 0xBB) = 0;
    }
    (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 8) + 0x72) = *(__int16 *)(a1 + 0xBB) + 0xA;
    (*(void (__cdecl **)(_DWORD, int, int, int, int))(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)(a1 + 0x67) + 8) + 0xA7) + 0xC))(
      *(_DWORD *)&v26[1],
      v27,
      v28,
      v29,
      v30);
    return 0xFFFFFFFF;
  }
  else
  {
    if ( (unsigned __int16)dx0 <= 0x1FAu || dx0 != 0x1C01 )
    {
      return sub_2F424(a1, v34, v33, v32);
    }
    if ( *(__int16 *)(a1 + 0xB3) != a3 )
    {
      v22 = *(_WORD *)(a1 + 0xB9);
      *(_WORD *)(a1 + 0xB3) = v33;
      sub_1E70C(&V_Game, v22, *(_WORD *)(a1 + 0xB3));
      (*(void (__cdecl **)(_DWORD, int, int, int, int))(*(_DWORD *)(a1 + 0xA7) + 0xC))(
        *(_DWORD *)&v26[1],
        v27,
        v28,
        v29,
        v30);
    }
    return 0xFFFFFFFF;
  }
}
// 96B74: using guessed type _DWORD dword_96B74[5];
// 96BAC: using guessed type int dword_96BAC;
// 96BC0: using guessed type int dword_96BC0;

//----- (00053000) --------------------------------------------------------
void __fastcall Q_NormVector3D_sub_53000(T_Vector3D *a1)
{
  double v2; // st7
  float len; // [esp+Ch] [ebp-8h]

  len = sqrt(a1->y * a1->y + a1->x * a1->x + a1->z * a1->z);
  if ( len > 0.0 )
  {
    v2 = 1.0 / len;
    a1->x = a1->x * v2;
    a1->y = a1->y * v2;
    a1->z = v2 * a1->z;
  }
}

//----- (00053054) --------------------------------------------------------
void __fastcall sub_53054(float *a1, float a2)
{
  Q_NormVector3D_sub_53000((T_Vector3D *)a1);
  *a1 = *a1 * a2;
  a1[1] = a1[1] * a2;
  a1[2] = a2 * a1[2];
}

//----- (00053078) --------------------------------------------------------
unsigned int __fastcall sub_53078(_DWORD *a1)
{
  if ( (*a1 & 0x7FFFFFFF) != 0 || (a1[1] & 0x7FFFFFFF) != 0 || (a1[2] & 0x7FFFFFFF) != 0 )
  {
    return 0;
  }
  else
  {
    return 0xFFFFFFFF;
  }
}

//----- (0005309C) --------------------------------------------------------
double __fastcall sub_5309C(float *a1, float *a2)
{
  double x; // st7
  float v4; // [esp+8h] [ebp-4h]
  float v5; // [esp+8h] [ebp-4h]

  v4 = a1[1] * a2[1] + *a1 * *a2 + a1[2] * a2[2];
  v5 = v4 / sqrt(a1[1] * a1[1] + *a1 * *a1 + a1[2] * a1[2]);
  x = v5 / sqrt(a2[1] * a2[1] + *a2 * *a2 + a2[2] * a2[2]);
  return acos(x) * flt_96144;
}
// 96144: using guessed type float flt_96144;

//----- (00053114) --------------------------------------------------------
float *__fastcall sub_53114(float *result, float *a2)
{
  float v2; // [esp+0h] [ebp-1Ch]
  float v3; // [esp+4h] [ebp-18h]
  float v4; // [esp+8h] [ebp-14h]

  v2 = *result;
  v3 = result[1];
  v4 = result[2];
  *result = v3 * a2[1] + *result * *a2 + v4 * a2[2];
  result[1] = v3 * a2[4] + v2 * a2[3] + v4 * a2[5];
  result[2] = v3 * a2[7] + v2 * a2[6] + v4 * a2[8];
  return result;
}

//----- (0005323C) --------------------------------------------------------
int __fastcall sub_5323C(int result, float a2)
{
  int v5; // edx
  double v6; // st7
  float v7; // [esp+Ch] [ebp-14h]

  v5 = result;
  if ( (LODWORD(a2) & 0x7FFFFFFF) != 0 )
  {
    v7 = cos(a2 * 0.017453292);
    v6 = sin(a2 * 0.017453292);
    result = *(int *)(v5 + 4);
    *(float *)(v5 + 4) = *(float *)&result * v7 - *(float *)(v5 + 8) * v6;
    *(float *)(v5 + 8) = v6 * *(float *)&result + *(float *)(v5 + 8) * v7;
  }
  return result;
}
// 5323C: could not find valid save-restore pair for esi

//----- (000532AC) --------------------------------------------------------
void __fastcall Q_RotateVectorY_sub_532AC(T_Vector3D *vector, float degrees)
{
  double b; // st7
  float x; // [esp+8h] [ebp-18h]
  float a; // [esp+Ch] [ebp-14h]

  if ( (LODWORD(degrees) & 0x7FFFFFFF) != 0 )
  {
    a = cos(degrees * 0.017453292);
    b = sin(degrees * 0.017453292);
    x = vector->x;
    vector->x = vector->z * b + vector->x * a;
    vector->z = vector->z * a - b * x;
  }
}
// 532AC: could not find valid save-restore pair for esi

//----- (00053318) --------------------------------------------------------
float *__fastcall sub_53318(float *result, float a2)
{
  float *v5; // edx
  double v6; // st7
  float v7; // [esp+8h] [ebp-18h]
  float v8; // [esp+Ch] [ebp-14h]

  v5 = result;
  if ( (LODWORD(a2) & 0x7FFFFFFF) != 0 )
  {
    v8 = cos(a2 * 0.017453292);
    v6 = sin(a2 * 0.017453292);
    result = *(float **)v5;
    v7 = *v5;
    *v5 = *v5 * v8 - v5[1] * v6;
    v5[1] = v6 * v7 + v5[1] * v8;
  }
  return result;
}
// 53318: could not find valid save-restore pair for esi

//----- (00053384) --------------------------------------------------------
float *__fastcall sub_53384(float *result, float *a2, float *a3)
{
  *a3 = a2[1] * result[1] + *a2 * *result + a2[2] * result[2] + a2[3];
  a3[1] = a2[5] * result[1] + a2[4] * *result + a2[6] * result[2] + a2[7];
  a3[2] = a2[9] * result[1] + a2[8] * *result + a2[0xA] * result[2] + a2[0xB];
  return result;
}

//----- (000533D4) --------------------------------------------------------
int __fastcall sub_533D4(float *a1, float a2, int a3, int a4, int a5, int a6)
{
  double v9; // st5
  double v10; // st7
  int result; // eax

  v9 = 1.0 / a1[2];
  v10 = a2 * a1[1] * v9 + dbl_92DD4;
  *(_WORD *)a5 = (int)(*a1 * a2 * v9 + dbl_92DD4);
  *(_WORD *)a6 = (int)v10;
  *(_WORD *)a5 += a3;
  result = a4;
  *(_WORD *)a6 += a4;
  return result;
}
// 92DD4: using guessed type double dbl_92DD4;

//----- (00053440) --------------------------------------------------------
void __fastcall sub_53440(T_Vector3D *a1)
{
  int v1; // ebx
  int v3; // eax
  int v4; // ett
  int v5; // eax
  int v6; // ett
  int v7; // eax
  int v8; // ett

  v1 = dword_96B88;
  if ( a1->x < 0.0 )
  {
    v3 = -dword_96B88;
  }
  else
  {
    v3 = dword_96B88;
  }
  v4 = (int)((double)(v3 / 2) + a1->x);
  a1->x = (float)(dword_96B88 * (v4 / dword_96B88));
  if ( a1->y < 0.0 )
  {
    v5 = -v1;
  }
  else
  {
    v5 = v1;
  }
  v6 = (int)((double)(v5 / 2) + a1->y);
  a1->y = (float)(v1 * (v6 / v1));
  if ( a1->z < 0.0 )
  {
    v7 = -v1;
  }
  else
  {
    v7 = v1;
  }
  v8 = (int)((double)(v7 / 2) + a1->z);
  a1->z = (float)(v1 * (v8 / v1));
  dword_96B88 = v1;
}
// 96B88: using guessed type int dword_96B88;

//----- (0005353C) --------------------------------------------------------
void __fastcall sub_5353C(float *a1, int a2, int a3, int a4, int a5)
{
  if ( (a5 & 0x7FFFFFFF) != 0 )
  {
    sub_5323C((int)(a1 + 6), *(float *)&a5);
    sub_53644(a1, (int)a1, a5, a4);
  }
}

//----- (00053564) --------------------------------------------------------
void __fastcall sub_53564(float *a1, int edx0, int a3, int a4, int a2)
{
  if ( (a2 & 0x7FFFFFFF) != 0 )
  {
    Q_RotateVectorY_sub_532AC((T_Vector3D *)a1 + 2, *(float *)&a2);
    sub_53754(a1, (int)a1, a2, a4);
  }
}

//----- (0005358C) --------------------------------------------------------
void __fastcall sub_5358C(float *a1, int a2, int a3, int a4, int a5)
{
  if ( (a5 & 0x7FFFFFFF) != 0 )
  {
    sub_53318(a1 + 3, *(float *)&a5);
    sub_53864(a1, (int)a1, a5, a4);
  }
}

//----- (000535B4) --------------------------------------------------------
void __fastcall sub_535B4(float *a1, int a2, int a3, int a4, int a5)
{
  if ( (a5 & 0x7FFFFFFF) != 0 )
  {
    sub_5323C((int)(a1 + 6), *(float *)&a5);
    sub_5323C((int)(a1 + 3), *(float *)&a5);
    sub_53864(a1, (int)a1, a5, a4);
  }
}

//----- (000535E4) --------------------------------------------------------
void __fastcall sub_535E4(float *a1, int edx0, int a3, int a4, int a2)
{
  if ( (a2 & 0x7FFFFFFF) != 0 )
  {
    Q_RotateVectorY_sub_532AC((T_Vector3D *)a1 + 2, *(float *)&a2);
    Q_RotateVectorY_sub_532AC((T_Vector3D *)a1 + 1, *(float *)&a2);
    sub_53864(a1, (int)a1, a2, a4);
  }
}

//----- (00053644) --------------------------------------------------------
void __fastcall sub_53644(float *a1, int a2, int a3, int a4)
{
  double v5; // st7
  double v6; // st6
  double v7; // st7
  double v8; // st6
  float v9; // [esp+0h] [ebp-48h]
  float v10; // [esp+4h] [ebp-44h]
  float v11; // [esp+8h] [ebp-40h]
  float v12; // [esp+Ch] [ebp-3Ch] BYREF
  float v13; // [esp+10h] [ebp-38h]
  float v14; // [esp+14h] [ebp-34h]
  float v15; // [esp+18h] [ebp-30h]
  float v16; // [esp+1Ch] [ebp-2Ch]
  float v17; // [esp+20h] [ebp-28h]
  float v18; // [esp+24h] [ebp-24h] BYREF
  float v19; // [esp+28h] [ebp-20h]
  float v20; // [esp+2Ch] [ebp-1Ch]
  float *v21; // [esp+30h] [ebp-18h]
  float *v22; // [esp+34h] [ebp-14h]

  Q_NormVector3D_sub_53000((T_Vector3D *)a1);
  v21 = &v12;
  v15 = 0.0;
  v16 = 0.0;
  v17 = 0.0;
  v15 = a1[7] * a1[2] - a1[8] * a1[1];
  v16 = a1[8] * *a1 - a1[6] * a1[2];
  v5 = a1[6] * a1[1];
  v6 = a1[7] * *a1;
  v12 = v15;
  v17 = v5 - v6;
  v13 = v16;
  v14 = v17;
  a1[3] = v15;
  a1[4] = v13;
  a1[5] = v14;
  Q_NormVector3D_sub_53000((T_Vector3D *)a1 + 1);
  v22 = &v18;
  v9 = a1[1] * a1[5] - a1[2] * a1[4];
  v10 = a1[2] * a1[3] - *a1 * a1[5];
  v7 = *a1 * a1[4];
  v8 = a1[1] * a1[3];
  v18 = v9;
  v11 = v7 - v8;
  v19 = v10;
  v20 = v11;
  a1[6] = v9;
  a1[7] = v19;
  a1[8] = v20;
  Q_NormVector3D_sub_53000((T_Vector3D *)a1 + 2);
}

//----- (00053754) --------------------------------------------------------
void __fastcall sub_53754(float *a1, int a2, int a3, int a4)
{
  float *v5; // edx
  double v6; // st7
  double v7; // st6
  double v8; // st7
  double v9; // st6
  float v10; // [esp+0h] [ebp-48h]
  float v11; // [esp+4h] [ebp-44h]
  float v12; // [esp+8h] [ebp-40h]
  float v13; // [esp+Ch] [ebp-3Ch] BYREF
  float v14; // [esp+10h] [ebp-38h]
  float v15; // [esp+14h] [ebp-34h]
  float v16; // [esp+18h] [ebp-30h]
  float v17; // [esp+1Ch] [ebp-2Ch]
  float v18; // [esp+20h] [ebp-28h]
  float v19; // [esp+24h] [ebp-24h] BYREF
  float v20; // [esp+28h] [ebp-20h]
  float v21; // [esp+2Ch] [ebp-1Ch]
  float *v22; // [esp+30h] [ebp-18h]
  float *v23; // [esp+34h] [ebp-14h]

  v5 = a1 + 3;
  Q_NormVector3D_sub_53000((T_Vector3D *)a1 + 1);
  v16 = 0.0;
  v17 = 0.0;
  v18 = 0.0;
  v22 = &v13;
  v16 = v5[1] * a1[8] - v5[2] * a1[7];
  v17 = v5[2] * a1[6] - *v5 * a1[8];
  v6 = *v5 * a1[7];
  v7 = v5[1] * a1[6];
  v13 = v16;
  v18 = v6 - v7;
  v14 = v17;
  v15 = v18;
  *a1 = v16;
  a1[1] = v14;
  a1[2] = v15;
  Q_NormVector3D_sub_53000((T_Vector3D *)a1);
  v23 = &v19;
  v10 = a1[1] * v5[2] - a1[2] * v5[1];
  v11 = a1[2] * *v5 - *a1 * v5[2];
  v8 = *a1 * v5[1];
  v9 = a1[1] * *v5;
  v19 = v10;
  v12 = v8 - v9;
  v20 = v11;
  v21 = v12;
  a1[6] = v10;
  a1[7] = v20;
  a1[8] = v21;
  Q_NormVector3D_sub_53000((T_Vector3D *)a1 + 2);
}

//----- (00053864) --------------------------------------------------------
void __fastcall sub_53864(float *a1, int a2, int a3, int a4)
{
  float *v5; // edx
  T_Vector3D *v6; // ecx
  double v7; // st7
  double v8; // st6
  double v9; // st7
  double v10; // st6
  float v11; // [esp+0h] [ebp-48h]
  float v12; // [esp+4h] [ebp-44h]
  float v13; // [esp+8h] [ebp-40h]
  float v14; // [esp+Ch] [ebp-3Ch] BYREF
  float v15; // [esp+10h] [ebp-38h]
  float v16; // [esp+14h] [ebp-34h]
  float v17; // [esp+18h] [ebp-30h]
  float v18; // [esp+1Ch] [ebp-2Ch]
  float v19; // [esp+20h] [ebp-28h]
  float v20; // [esp+24h] [ebp-24h] BYREF
  float v21; // [esp+28h] [ebp-20h]
  float v22; // [esp+2Ch] [ebp-1Ch]
  float *v23; // [esp+30h] [ebp-18h]
  float *v24; // [esp+34h] [ebp-14h]

  v5 = a1 + 6;
  v6 = (T_Vector3D *)(a1 + 3);
  Q_NormVector3D_sub_53000((T_Vector3D *)a1 + 2);
  v17 = 0.0;
  v18 = 0.0;
  v19 = 0.0;
  v23 = &v14;
  v17 = v6->y * v5[2] - v6->z * v5[1];
  v18 = v6->z * *v5 - v6->x * v5[2];
  v7 = v6->x * v5[1];
  v8 = v6->y * *v5;
  v14 = v17;
  v19 = v7 - v8;
  v15 = v18;
  v16 = v19;
  *a1 = v17;
  a1[1] = v15;
  a1[2] = v16;
  Q_NormVector3D_sub_53000((T_Vector3D *)a1);
  v24 = &v20;
  v11 = v5[1] * a1[2] - v5[2] * a1[1];
  v12 = v5[2] * *a1 - *v5 * a1[2];
  v9 = *v5 * a1[1];
  v10 = v5[1] * *a1;
  v20 = v11;
  v13 = v9 - v10;
  v21 = v12;
  v22 = v13;
  v6->x = v11;
  v6->y = v21;
  v6->z = v22;
  Q_NormVector3D_sub_53000(v6);
}

//----- (00053B08) --------------------------------------------------------
float *__fastcall sub_53B08(float *result, float *a2, float *a3, float *a4)
{
  *result = a3[1] * a2[1] + *a3 * *a2 + a3[2] * a2[2];
  result[1] = a3[4] * a2[1] + a3[3] * *a2 + a3[5] * a2[2];
  result[2] = a3[7] * a2[1] + a3[6] * *a2 + a3[8] * a2[2];
  result[4] = a3[1] * a2[4] + *a3 * a2[3] + a3[2] * a2[5];
  result[5] = a3[3] * a2[3] + a3[4] * a2[4] + a3[5] * a2[5];
  result[6] = a3[6] * a2[3] + a3[7] * a2[4] + a3[8] * a2[5];
  result[8] = a3[1] * a2[7] + *a3 * a2[6] + a3[2] * a2[8];
  result[9] = a3[3] * a2[6] + a3[4] * a2[7] + a3[5] * a2[8];
  result[0xA] = a3[6] * a2[6] + a3[7] * a2[7] + a3[8] * a2[8];
  result[3] = a4[1] * a2[1] + *a4 * *a2 + a4[2] * a2[2];
  result[7] = a4[1] * a2[4] + *a4 * a2[3] + a4[2] * a2[5];
  result[0xB] = a4[1] * a2[7] + *a4 * a2[6] + a4[2] * a2[8];
  return result;
}

//----- (00053D22) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __cdecl sub_53D22(int a1)
{
  int v5; // edx
  unsigned int v6; // kr00_4
  int result; // eax
  __int16 v8; // [esp-Ah] [ebp-16h]
  void *retaddr; // [esp+10h] [ebp+4h]

  v6 = __readeflags();
  _disable();
  __asm { int     31h; DPMI Services   ax=func xxxxh }
  DMPI_selector_dword_53D1C = v5;
  DMPI_real_mode_segment_base_word_53D0C = 0x100;
  word_53CEA = 0;
  word_53D06 = 0x4F01;
  word_53D02 = a1;
  word_53D0E = 0;
  __asm { pushfw }
  word_53D0A = v8;
  __asm
  {
    int     31h; DPMI Services   ax=func xxxxh
    int     31h; DPMI Services   ax=func xxxxh
  }
  result = 0;
  _ZF = (BYTE1(retaddr) & 2) == 0;
  _disable();
  if ( !_ZF )
  {
    _enable();
  }
  __writeeflags(v6);
  return result;
}
// 53D37: write access to const memory at 53D1C has been detected
// 53D3D: write access to const memory at 53D0C has been detected
// 53D43: write access to const memory at 53CEA has been detected
// 53D51: write access to const memory at 53D06 has been detected
// 53D5A: write access to const memory at 53D02 has been detected
// 53D60: write access to const memory at 53D0E has been detected
// 53D6D: write access to const memory at 53D0A has been detected
// 53D37: variable 'v5' is possibly undefined
// 53D6D: variable 'v8' is possibly undefined
// 53CEA: using guessed type __int16 word_53CEA;
// 53D02: using guessed type __int16 word_53D02;
// 53D06: using guessed type __int16 word_53D06;
// 53D0A: using guessed type __int16 word_53D0A;
// 53D0C: using guessed type __int16 DMPI_real_mode_segment_base_word_53D0C;
// 53D0E: using guessed type __int16 word_53D0E;
// 53D1C: using guessed type int DMPI_selector_dword_53D1C;

//----- (00053DC0) --------------------------------------------------------
int __fastcall sub_53DC0(int a1, int a2, int a3)
{
  int result; // eax

  _wcpp_2_mod_register_(&unk_96B8C);
  result = sub_54344((int)&V_Type3_stru_10AE70, 1, a3);
  dword_96B94 = 1;
  return result;
}
// 786DA: using guessed type int __fastcall _wcpp_2_mod_register_(_DWORD);
// 96B94: using guessed type int dword_96B94;

//----- (00053DE4) --------------------------------------------------------
void __cdecl Q_Timer_sub_53DE4()
{
  ++V_Timer_dword_132B58;
}
// 132B58: using guessed type int V_Timer_dword_132B58;

//----- (00053DEC) --------------------------------------------------------
int Q_CheckFreeMemory_sub_53DEC()
{
  int chunk; // edx
  int largest; // ecx
  MACRO_VFX_BOOL finished; // edi
  void *tmp; // eax

  chunk = 0x2000000;
  largest = 0;
  finished = FALSE;
  do
  {
    tmp = malloc(largest + chunk);
    if ( tmp )
    {
      largest += chunk;
    }
    if ( largest == 0x2000000 || chunk < 0x1000 )
    {
      finished = TRUE;
    }
    free(tmp);
    chunk >>= 1;
  }
  while ( finished == FALSE );
  return largest;
}

//----- (00053E38) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_sub_53E38(PANE *pane, LONG hotX, LONG hotY, __int16 a4)
{
  void *shapeTable; // ebp

  if ( a4 >= V_Game.racesNum )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xD0);
  }
  shapeTable = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, (unsigned __int16)word_FFEE0);
  if ( !shapeTable )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xD5);
  }
  sub_53EB8(pane, shapeTable, V_Game.races[a4].Unknown_01, hotX, hotY, a4);
}

//----- (00053EB8) --------------------------------------------------------
void __fastcall sub_53EB8(PANE *pane, void *shape_table, LONG shape_number, LONG hotX, LONG hotY, __int16 a6)
{
  __int16 v9; // ax
  UBYTE v10; // dl
  int v11; // ecx

  v9 = 0;
  v10 = 4 * V_Game.races[a6].Unknown_02 + 0x13;
  while ( v9 < 4 )
  {
    v11 = 0x13 - v9++;
    (*V_Type3_stru_10AE70.hazeTableMapRaces)[v11] = v10--;
  }
  VFX_shape_lookaside((UBYTE *)V_Type3_stru_10AE70.hazeTableMapRaces);
  VFX_shape_translate_draw(pane, shape_table, shape_number, hotX, hotY);
}

//----- (00053F40) --------------------------------------------------------
void __fastcall sub_53F40(T_Type5 *a1, void *a2, LONG a3, LONG a4, int a5, char a6)
{
  __int16 v8; // ax
  UBYTE v9; // dl
  int v10; // ecx

  v8 = 0;
  v9 = 4 * a6 + 0x13;
  while ( v8 < 4 )
  {
    v10 = 0x13 - v8++;
    (*V_Type3_stru_10AE70.hazeTableMapRaces)[v10] = v9--;
  }
  VFX_shape_lookaside((UBYTE *)V_Type3_stru_10AE70.hazeTableMapRaces);
  VFX_shape_translate_draw((PANE *)a1, a2, a3, a4, a5);
}

//----- (00053FB0) --------------------------------------------------------
void __fastcall Q_LoadGam_sub_53FB0(const char *fname)
{
  char *sub_1CEA8; // eax
  T_FileInfo fi; // [esp+0h] [ebp-18Ch] BYREF
  char buf[116]; // [esp+118h] [ebp-74h] BYREF

  Q_InitFileInfo_sub_1BB78(&fi);
  if ( Q_OpenFile_sub_1BBFC(&fi, fname, O_BINARY, 0) )
  {
    sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xAA);// 170: "Unable to open file."
    Q_ShowMsgBox_sub_556CC(&V_Type3_stru_10AE70, sub_1CEA8);
  }
  else
  {
    Q_ReadFile_sub_1BF94(&fi, buf, 0x74u);
    Q_LoadGam_sub_21AA0(&V_Game, &fi);
    sub_56BE8(&V_Type3_stru_10AE70, 0xD, 0, 0, 0);
    sub_5A294(&V_Type3_stru_10AE70);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&fi);
}

//----- (00054048) --------------------------------------------------------
int __fastcall Q_SaveGam_sub_54048(const char *fname)
{
  int edx2; // edx
  int v2; // ebx
  int v3; // eax
  int v4; // eax
  int v5; // edx
  int v6; // ebx
  int v7; // eax
  int v8; // edx
  int v9; // ebx
  int result; // eax
  char *v1; // eax
  T_FileInfo fi; // [esp-118h] [ebp-198h] BYREF
  T_SavBlock0Header v13; // [esp+0h] [ebp-80h] BYREF

  Q_InitFileInfo_sub_1BB78(&fi);
  if ( Q_OpenFile_sub_1BCA8(&fi, fname) )
  {
    v1 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0xAA);     // 170: "Unable to open file."
    Q_ShowMsgBox_sub_556CC(&V_Type3_stru_10AE70, v1);
    Q_CloseFileAndDelete_sub_1BBC8(&fi);
  }
  else
  {
    v13.day = V_Game.day;
    v13.races = V_Game.racesNum;
    edx2 = 0;
    v2 = 0;
    v13.Unknonwn_08 = byte_104BEA;
    v3 = 0;
    while ( edx2 < V_Game.racesNum )
    {
      v3 += 0x1EE;
      v2 += 4;
      ++edx2;
      *(int *)((char *)&v13.Unknonwn_08 + v2) = (unsigned __int8)V_StaticStrings_dword_A0D04.buffer[v3 + 0x1D61];
    }
    v4 = 0;
    v5 = 0;
    v6 = 0;
    while ( v4 < V_Game.racesNum )
    {
      v6 += 0x1EE;
      ++v5;
      ++v4;
      v13.z2[v5 - 1] = (unsigned __int8)V_StaticStrings_dword_A0D04.buffer[v6 + 0x1D62];
    }
    v7 = 0;
    v8 = 0;
    while ( v7 < V_Game.racesNum )
    {
      v9 = (char)V_Game.races[byte_104BEA].Unknown_1C0[v7];
      ++v8;
      ++v7;
      v13.z3[v8 - 1] = v9;
    }
    v13.Unknown_60 = sub_40224(&V_Game.races[byte_104BEA].Unknown_00, 0, 0);
    v13.Unknown_64 = sub_402E0(&V_Game.races[byte_104BEA].Unknown_00);
    v13.Unknown_68 = sub_40664(&V_Game.races[byte_104BEA].Unknown_00);
    Q_CFILE_CPP_dos_write_sub_1C098(&fi.fh, &v13, 0x74u);
    Q_SaveGam_sub_21374(&V_Game, &fi);
    sub_5A294(&V_Type3_stru_10AE70);
    Q_CloseFileAndDelete_sub_1BBC8(&fi);
  }
  return result;
}

//----- (00054208) --------------------------------------------------------
LONG __fastcall sub_54208(PANE *a1, int a2, int a3, int a4)
{
  LONG result; // eax
  UBYTE *v5; // [esp+0h] [ebp-3Ch] BYREF
  LONG v6; // [esp+4h] [ebp-38h]
  LONG v7; // [esp+8h] [ebp-34h]
  int v8; // [esp+Ch] [ebp-30h]
  int v9; // [esp+10h] [ebp-2Ch]
  PANE target; // [esp+14h] [ebp-28h] BYREF

  v5 = V_BigBuffer;
  v6 = a1->x1 - a1->x0;
  v7 = a1->y1 - a1->y0;
  v8 = 0;
  v9 = 0;
  if ( v7 * v6 >= (int)&loc_27100 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x13E);
  }
  target.x1 = v6;
  target.y1 = v7;
  target.window = (WINDOW *)&v5;
  target.x0 = 0;
  target.y0 = 0;
  result = VFX_pane_copy(a1, 0, 0, &target, 0, 0, 0xFFFFFFFF);
  if ( result )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x147);
  }
  return result;
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (000542B0) --------------------------------------------------------
LONG __fastcall Q_WINMGR_CPP_sub_542B0(PANE *target)
{
  UBYTE *v2; // [esp+0h] [ebp-3Ch] BYREF
  LONG v3; // [esp+4h] [ebp-38h]
  LONG v4; // [esp+8h] [ebp-34h]
  int v5; // [esp+Ch] [ebp-30h]
  int v6; // [esp+10h] [ebp-2Ch]
  PANE source; // [esp+14h] [ebp-28h] BYREF

  v2 = V_BigBuffer;
  v3 = target->x1 - target->x0;
  v4 = target->y1 - target->y0;
  v5 = 0;
  v6 = 0;
  if ( v4 * v3 >= 160000 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x158);
  }
  source.x1 = v3;
  source.y1 = v4;
  source.window = (WINDOW *)&v2;
  source.x0 = 0;
  source.y0 = 0;
  return VFX_pane_copy(&source, 0, 0, target, 0, 0, 0xFFFFFFFF);
}
// D8DA0: using guessed type UBYTE V_BigBuffer[94816];

//----- (00054344) --------------------------------------------------------
int __fastcall sub_54344(int a1, int a2, int a3)
{
  _DWORD *v4; // eax
  int v5; // eax

  v4 = (_DWORD *)(a1 + 0x3026);
  sub_2B2C0(v4);
  v4 += 8;
  sub_2B2C0(v4);
  v5 = sub_1ACC0((int)v4 + 0x21D6A, a1, a3);
  return (unsigned __int64)sub_54448(v5 - 0x24DB0) >> 0x20;
}

//----- (00054374) --------------------------------------------------------
char *__fastcall sub_54374(T_Type3 *eax0)
{
  __int16 i; // cx
  void **v3; // eax
  T_TypeA1 *a1; // eax
  __int16 j; // dx
  char *v6; // eax
  int v7; // edx
  T_Type3 *v8; // eax
  int v9; // eax
  void **v10; // eax

  for ( i = 0; i < 0x400; ++i )
  {
    v3 = (void **)&eax0->wnds[i];
    if ( v3[1] )
    {
      sub_2627C(v3[1]);
    }
    a1 = eax0->wnds[i].a1;
    if ( a1 )
    {
      (*(void (**)(void))a1[1].magic12345678)();
    }
  }
  for ( j = 0; j < 6; ++j )
  {
    v6 = (char *)eax0 + 4 * j;
    if ( *(_DWORD *)(v6 + 0x300E) )
    {
      sub_2627C(*(void **)(v6 + 0x300E));
    }
    operator delete[](*(void **)&eax0->z1c[4 * j]);
  }
  if ( eax0->aaa == 0xFFFFFFFF )
  {
    v7 = 0xFFFFFFFF;
    v8 = eax0;
LABEL_17:
    sub_59934(v8, v7);
    goto LABEL_18;
  }
  if ( eax0->bbb == 0xFFFFFFFF )
  {
    v8 = eax0;
    v7 = 0;
    goto LABEL_17;
  }
LABEL_18:
  sub_54664((int)eax0);
  v9 = sub_1ACF4((int)eax0->t13.z1);
  v10 = sub_2B2E0((void **)(v9 - 0x21D6A));
  return (char *)sub_2B2E0(v10 + 0xFFFFFFF8) + 0xFFFFCFDA;
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);

//----- (00054448) --------------------------------------------------------
__int64 __fastcall sub_54448(int a1)
{
  int v2; // eax
  __int16 i; // ax
  int v4; // edx

  v2 = a1 + 0x3066;
  *(_WORD *)(v2 + 0x11C0) = 0;
  *(_WORD *)(v2 - 0x66) = 0;
  *(_WORD *)(v2 + 0x11C2) = 0xFFFF;
  *(_WORD *)(v2 + 0x16F0) = 0;
  *(_WORD *)(v2 + 0x16F2) = 0;
  *(_WORD *)(v2 + 0x1446) = 0;
  *(_WORD *)(v2 + 0x15A8) = 0;
  *(_WORD *)(v2 + 0x16CA) = 0;
  *(_DWORD *)(v2 - 0x64) = 0xFFFFFFFF;
  *(_DWORD *)(v2 + 0x16CC) = 0xFFFFFFFF;
  *(_WORD *)(v2 + 0x16F4) = 0;
  *(_WORD *)(v2 + 0x16F6) = 0;
  *(_DWORD *)((char *)&loc_21D46 + v2) = 0x3F800000;
  V_Timer_dword_132B58 = 0;
  memset((void *)v2, 0, 0x11C0u);
  memset((void *)a1, 0, 0x3000u);
  memset((void *)(a1 + 0x44AE), 0, 0x160u);
  memset((void *)(a1 + 0x4610), 0, 0x120u);
  memset((void *)(a1 + 0x300E), 0, 0x18u);
  memset((void *)(a1 + 0x4736), 0xFFFFFFFF, 0x20u);
  for ( i = 0; i < 0x20; ++i )
  {
    v4 = 0x8E * i;
    *(_WORD *)(a1 + v4 + 0x3066) = 0xFFFF;
    *(_WORD *)(a1 + v4 + 0x30EA) = 0xFFFF;
  }
  *(_DWORD *)(a1 + 0x489E) = 0;
  *(_DWORD *)(a1 + 0x48A2) = 0;
  *(_DWORD *)(a1 + 0x24D9C) = 0;
  *(_DWORD *)(a1 + 0x24DA0) = 0;
  *(_DWORD *)((char *)&loc_24DA4 + a1) = 0;
  *(_DWORD *)(a1 + 0x24DA8) = 0xFFFFFFFF;
  *(_DWORD *)(a1 + 0x48A6) = 0;
  *(_DWORD *)(a1 + 0x48AA) = 0;
  *(_DWORD *)(a1 + 0x48AE) = 0;
  memset((void *)(a1 + 0x21D82), 0x10, 0);
  *(_DWORD *)(a1 + 0x21D82) = 0x3C;
  *(_WORD *)(a1 + 0x24D96) = 0;
  return (unsigned int)memset((char *)&loc_21D96 + a1, 0, 0x3000u);
}
// 132B58: using guessed type int V_Timer_dword_132B58;

//----- (000545EC) --------------------------------------------------------
unsigned int __fastcall Q_WINMGR_CPP_StartTimer_sub_545EC(P_Type3 a1)
{
  HTIMER timer; // ebx
  HTIMER v3; // eax
  HTIMER v4; // edi

  timer = a1->timer;
  V_Timer_dword_132B58 = 0;
  if ( timer == 0xFFFFFFFF )
  {
    v3 = AIL_register_timer((AILTIMERCB)Q_Timer_sub_53DE4);
    a1->timer = v3;
    if ( v3 == 0xFFFFFFFF )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x1E5);
    }
    v4 = a1->timer;
    if ( v4 == 0xFFFFFFFF )
    {
      return 0;
    }
    AIL_set_timer_frequency(v4, 100u);
    AIL_start_timer(a1->timer);
  }
  return 0xFFFFFFFF;
}
// 132B58: using guessed type int V_Timer_dword_132B58;

//----- (00054664) --------------------------------------------------------
void __fastcall sub_54664(int a1)
{
  if ( *(_DWORD *)(a1 + 0x4732) != 0xFFFFFFFF )
  {
    AIL_stop_timer(*(_DWORD *)(a1 + 0x4732));
    AIL_release_timer_handle(*(_DWORD *)(a1 + 0x4732));
    *(_DWORD *)(a1 + 0x4732) = 0xFFFFFFFF;
  }
}

//----- (0005469C) --------------------------------------------------------
int __fastcall sub_5469C(T_Type3 *a1)
{
  int x; // ecx
  int Shift; // edi
  int v4; // eax
  int v5; // edx
  T_TypeA2 *Wnd_sub_56DA8; // ecx
  LONG right; // eax
  unsigned int v8; // eax
  int leftClicked; // ebx
  __int16 v10; // ax
  int v11; // eax
  int aaa; // edx
  int v13; // eax
  unsigned int v14; // esi
  int v15; // ebx
  char v16; // dl
  int result; // eax
  int v18; // [esp-4h] [ebp-30h]
  char s[44]; // [esp+0h] [ebp-2Ch] BYREF

  if ( a1->aaa == 0xFFFFFFFF || a1->bbb == 0xFFFFFFFF )
  {
    ++a1->z3[2];
  }
  Shift = V_Keyboard.Shift;
  a1->z3[1] = 0xFFFFFFFF;
  if ( !Shift || *(_DWORD *)((char *)&loc_24DA4 + (_DWORD)a1) || *(_DWORD *)&a1->z2[0x168] )
  {
    if ( *(_DWORD *)((char *)&loc_24DA4 + (_DWORD)a1) )
    {
      if ( !V_Keyboard.Shift )
      {
        *(_DWORD *)((char *)&loc_24DA4 + (_DWORD)a1) = 0;
        Q_GSYSTEM_CPP_sub_2C7D0(&V_Type6_stru_D8654, 0, 0);
        x = *(_DWORD *)a1->z1aa;
        if ( x != 0xFFFFFFFF )
        {
          sub_56D30(a1, x, 6, 0, 0);
          x = 0;
          sub_56D30(a1, *(_DWORD *)a1->z1aa, 7, 0, 0);
        }
      }
    }
  }
  else
  {
    *(_DWORD *)((char *)&loc_24DA4 + (_DWORD)a1) = 0xFFFFFFFF;
    Q_GSYSTEM_CPP_sub_2C7D0(&V_Type6_stru_D8654, 1, 0);
  }
  v4 = 0xFFFFFFFF;
  if ( !*(_DWORD *)((char *)&loc_24DA4 + (_DWORD)a1) && !*(_DWORD *)&a1->z2[0x168] && *(_WORD *)&a1->z1e[0x596] )
  {
    if ( V_Mouse.y )
    {
      if ( V_Mouse.y == 0x1DF )
      {
        x = V_Mouse.x;
        if ( V_Mouse.x )
        {
          if ( V_Mouse.x == 0x27F )
          {
            v4 = 3;
          }
        }
        else
        {
          x = 0;
          v4 = 2;
        }
      }
    }
    else if ( V_Mouse.x )
    {
      if ( V_Mouse.x == 0x27F )
      {
        v4 = 1;
      }
    }
    else
    {
      v4 = 0;
    }
  }
  if ( v4 != a1->i )
  {
    v5 = 0;
    a1->i = v4;
    if ( v4 != 0xFFFFFFFF )
    {
      v5 = v4 + 4;
    }
    x = 0;
    sub_5A270(a1, v5, 0, 0);
  }
  if ( V_Mouse.moved == 0xFFFFFFFF )
  {
    if ( V_Mouse.moved == a1->aaa && a1->z3[1] )
    {
      x = 0;
      sub_59C80(a1, 0, 1, 0, V_Mouse.x, V_Mouse.y, 0);
      a1->z3[1] = 0;
    }
    sub_5691C((int)a1);
  }
  if ( !*(_DWORD *)&a1->z2[0x168] )
  {
    if ( *(_WORD *)&a1->z2a[0x120] )
    {
      sub_56824((int)a1);
    }
    if ( a1->counter1 )
    {
      sub_56694(a1);
    }
  }
  if ( V_Keyboard.Pressed == 0xFFFFFFFF )
  {
    if ( V_Keyboard.Pressed == a1->aaa
      && (!V_Keyboard.Alt || V_Keyboard.ScanCode != 0x13 && V_Keyboard.ScanCode != 0x19) )
    {
      x = V_Keyboard.Flags;
      sub_59C80(
        a1,
        0,
        3,
        V_Keyboard.Flags,
        (unsigned __int16)V_Keyboard.ScanCode,
        (unsigned __int16)V_Keyboard.ASCIIChar,
        V_Keyboard.Alt);
    }
    if ( a1->bbb == 0xFFFFFFFF && V_Keyboard.Ctrl && V_Keyboard.ScanCode == 0x19 )
    {
      v18 = dword_132B1C;
      a1->bbb = 0;
      sprintf(s, "info%02d", v18);
      Wnd_sub_56DA8 = (T_TypeA2 *)Q_FindWnd_sub_56DA8(a1, "HELPWINDOW", 0);
      sub_2FCB0(Wnd_sub_56DA8, byte_132B20, s);
      sub_552F8(a1, Wnd_sub_56DA8, 0);
      V_Keyboard.Alt = 0;
      dword_132B14 = V_Mouse.left;
      right = V_Mouse.right;
      a1->bbb = 0xFFFFFFFF;
      dword_132B18 = right;
      x = 0;
      V_Keyboard.ScanCode = 0;
      ++dword_132B1C;
    }
    v8 = 0xFFFFFFFF;
    if ( V_Keyboard.Alt == 0xFFFFFFFF || V_Keyboard.ScanCode == 1 )
    {
      v8 = sub_54D64(a1);
    }
    if ( v8 == 0xFFFFFFFF )
    {
      x = (unsigned __int16)V_Keyboard.ScanCode;
      sub_56BE8(a1, 3, (unsigned __int16)V_Keyboard.ASCIIChar, (unsigned __int16)V_Keyboard.ScanCode, 0);
    }
  }
  leftClicked = V_Mouse.leftClicked;
  if ( V_Mouse.leftClicked == 0xFFFFFFFF )
  {
    if ( V_Mouse.leftClicked == a1->aaa && !V_Keyboard.Alt )
    {
      v10 = 0;
      if ( V_Mouse.left && V_Keyboard.Shift )
      {
        v10 = 1;
      }
      x = v10;
      leftClicked = 2;
      sub_59C80(a1, 0, 2, v10, 0, V_Mouse.left, 0);
    }
    if ( V_Mouse.left )
    {
      if ( a1->i == 0xFFFFFFFF )
      {
        if ( V_Keyboard.Alt == 0xFFFFFFFF )
        {
          leftClicked = V_Mouse.y;
          x = V_Mouse.x;
          dword_132B10 = VFX_pixel_read(&V_Type6_stru_D8654.pane, V_Mouse.x, V_Mouse.y);
          v11 = *(_DWORD *)&a1->z4[0x1D4D0];
          if ( *(_DWORD *)(v11 + 0x39) )
          {
            x = 0;
            leftClicked = 0;
            (*(void (**)(void))(*(_DWORD *)(v11 + 0xA7) + 8))();
          }
        }
        else if ( *(_DWORD *)((char *)&loc_24DA4 + (_DWORD)a1) != 0xFFFFFFFF || *(_DWORD *)&a1->z2[0x168] )
        {
          x = V_Mouse.y;
          leftClicked = V_Mouse.x;
          sub_56BE8(a1, 4, V_Mouse.x, V_Mouse.y, 0);
        }
        else
        {
          x = V_Mouse.y;
          leftClicked = V_Mouse.x;
          sub_56BE8(a1, 0xC, V_Mouse.x, V_Mouse.y, 0);
        }
      }
      else if ( *(_DWORD *)&a1->z2[0x168] )
      {
        *(_DWORD *)&a1->z2[0x168] = 0;
        *(_DWORD *)&a1->z2[0x16C] = 0xFFFFFFFF;
      }
      else
      {
        Q_StartSample_sub_4FB90(&V_SoundSystem, 0);
        x = 0;
        leftClicked = 0;
        sub_5A270(a1, 0, 0, 0);
        a1->i = 0xFFFFFFFF;
        sub_570AC((int)a1, 0xFFFFFFFF);
      }
    }
  }
  if ( V_Mouse.rightClicked == 0xFFFFFFFF )
  {
    aaa = a1->aaa;
    if ( aaa == V_Mouse.rightClicked )
    {
      x = 0;
      aaa ^= V_Mouse.rightClicked;
      leftClicked = 2;
      sub_59C80(a1, aaa, 2, 0, 1, V_Mouse.right, 0);
    }
    if ( V_Mouse.right )
    {
      if ( *(_DWORD *)((char *)&loc_24DA4 + (_DWORD)a1) == 0xFFFFFFFF )
      {
        *(_DWORD *)((char *)&loc_24DA4 + (_DWORD)a1) = 0;
        Q_GSYSTEM_CPP_PreloadMouseShp_sub_2C744(&V_Type6_stru_D8654, (char *)aaa, leftClicked, x);
      }
      else
      {
        sub_56BE8(a1, 5, V_Mouse.x, V_Mouse.y, 0);
      }
    }
  }
  while ( *(__int16 *)&a1->z1e[0x81A] > 0 )
  {
    sub_55E80((int)a1);
  }
  if ( *(_WORD *)&a1->z2[0x24] && *(_WORD *)&a1->z1e[0x596] == 1 && !*(_DWORD *)&a1->z2[0x168] )
  {
    sub_55B74((int)a1);
  }
  if ( *(int *)((char *)&a1->wnds[0].a + (_DWORD)&loc_24D9B + 1) == 0xFFFFFFFF
    && !*(_WORD *)&a1->z2[0x24]
    && !*(_DWORD *)&a1->z2[0x168] )
  {
    sub_56B60(a1, 7, 0, 0);
  }
  if ( V_SoundSystem.a == 0xFFFFFFFF && !V_SoundSystem.c )
  {
    if ( !V_SoundSystem.playing )
    {
      v13 = *(__int16 *)&a1->z1e[0x596];
      if ( v13 != 7 && v13 != 0xD && v13 != 6 )
      {
        LOWORD(v14) = 0xFFFF;
        v15 = 0;
        if ( word_96BB0 != 0xFFFFFFFF && V_SoundSystem.files[word_96BB0].fpos )
        {
          v15 = 0xFFFFFFFF;
          LOWORD(v14) = word_96BB0;
          dword_96BB4 = 0;
        }
        if ( (__int16)v14 == 0xFFFFFFFF )
        {
          if ( word_96BB0 == 0xFFFFFFFF )
          {
            LOWORD(v14) = 0;
          }
          else
          {
            v14 = (V_Mouse.x + V_Timer_dword_132B58) % 5u;
            if ( (_WORD)v14 == word_96BB0 )
            {
              v14 = (word_96BB0 + 1) % 5;
            }
          }
        }
        sub_4F8CC(&V_SoundSystem, v14, v15);
        word_96BB0 = v14;
      }
    }
    if ( dword_96BB4 != 0xFFFFFFFF )
    {
      v16 = dword_96BB4++;
      Q_SetVolume_sub_4FF4C(&V_SoundSystem, v16);
      if ( dword_96BB4 == 0x64 )
      {
        dword_96BB4 = 0xFFFFFFFF;
      }
    }
  }
  do
  {
    if ( V_SoundSystem.a == 0xFFFFFFFF && V_SoundSystem.a == V_SoundSystem.playing )
    {
      if ( V_SoundSystem.playing == V_SoundSystem.c )
      {
        Q_StopSample_sub_4FA1C(&V_SoundSystem);
      }
      else
      {
        sub_4FAB4((int)&V_SoundSystem);
      }
    }
  }
  while ( (unsigned int)(V_Timer_dword_132B58 - dword_132B34) < 3 );
  result = V_Timer_dword_132B58;
  dword_132B34 = V_Timer_dword_132B58;
  return result;
}
// 54B66: variable 'x' is possibly undefined
// 96BB0: using guessed type __int16 word_96BB0;
// 96BB4: using guessed type int dword_96BB4;
// 132B10: using guessed type int dword_132B10;
// 132B14: using guessed type int dword_132B14;
// 132B18: using guessed type int dword_132B18;
// 132B1C: using guessed type int dword_132B1C;
// 132B34: using guessed type int dword_132B34;
// 132B58: using guessed type int V_Timer_dword_132B58;

//----- (00054D64) --------------------------------------------------------
unsigned int __fastcall sub_54D64(P_Type3 a1)
{
  if ( V_Keyboard.ScanCode >= 0x20u )
  {
    if ( V_Keyboard.ScanCode <= 0x20u )
    {
      if ( V_NougatLfExists_dword_A0CFC == 0xFFFFFFFF )
      {
        dword_132B5C = ~dword_132B5C;
      }
    }
    else
    {
      if ( V_Keyboard.ScanCode >= 0x26u )
      {
        if ( V_Keyboard.ScanCode <= 0x26u )
        {
          if ( !*(_DWORD *)&a1->z2[0x168] && *(_WORD *)&a1->z1e[0x596] != 8 )
          {
            sub_56E9C(a1, 4, 0xFFFFFFFF);
            return 0;
          }
        }
        else
        {
          if ( V_Keyboard.ScanCode >= 0x31u )
          {
            if ( V_Keyboard.ScanCode <= 0x31u )
            {
              V_SoundSystem._notstarted1 = ~V_SoundSystem._notstarted1;
              return 0;
            }
            if ( V_Keyboard.ScanCode == 0x32 )
            {
              V_SoundSystem.c = ~V_SoundSystem.c;
              return 0;
            }
            return 0xFFFFFFFF;
          }
          if ( V_Keyboard.ScanCode != 0x2D )
          {
            return 0xFFFFFFFF;
          }
          if ( !*(_DWORD *)&a1->z2[0x168] )
          {
            Q_GameLoop_dword_96774 = 0;
            return 0;
          }
        }
        return 0;
      }
      if ( V_Keyboard.ScanCode > 0x21u )
      {
        if ( V_Keyboard.ScanCode != 0x22 )
        {
          return 0xFFFFFFFF;
        }
        sub_1B4D0((P_Type3)((char *)a1 + (_DWORD)&loc_24DAD + 3));
        sub_31C18(
          *(int *)((char *)&a1->wnds[0].a + (_DWORD)&loc_27C93 + 1),
          *(int *)((char *)&a1->wnds[0].a + (_DWORD)&loc_27C93 + 5));
        sub_1ACE8((int)a1 + (_DWORD)&loc_24DAD + 3);
        return 0;
      }
      if ( V_NougatLfExists_dword_A0CFC == 0xFFFFFFFF )
      {
        if ( V_NougatLfExists_dword_A0CFC == *(_DWORD *)((char *)&loc_24D98 + (_DWORD)a1) )
        {
          *(_DWORD *)((char *)&loc_24D98 + (_DWORD)a1) = 0;
        }
        else
        {
          *(_DWORD *)((char *)&loc_24D98 + (_DWORD)a1) = V_NougatLfExists_dword_A0CFC;
        }
        return 0;
      }
    }
    return 0;
  }
  if ( V_Keyboard.ScanCode < 0x12u )
  {
    if ( V_Keyboard.ScanCode )
    {
      if ( V_Keyboard.ScanCode > 1u )
      {
        if ( V_Keyboard.ScanCode != 0x11 )
        {
          return 0xFFFFFFFF;
        }
        if ( V_NougatLfExists_dword_A0CFC == 0xFFFFFFFF )
        {
          sub_552F8(a1, *(P_TypeA2 *)((char *)&a1->wnds[0].a + (_DWORD)&loc_21D90 + 2), 0);
          return 0;
        }
        return 0;
      }
      if ( *(_DWORD *)&a1->z2[0x168] )
      {
        *(_DWORD *)&a1->z2[0x168] = 0;
        *(_DWORD *)&a1->z2[0x16C] = 0;
        return 0;
      }
      if ( *(_WORD *)&a1->z1e[0x596] != 0x11 )
      {
        sub_570AC((int)a1, 0xFFFFFFFF);
        return 0;
      }
    }
    return 0xFFFFFFFF;
  }
  if ( V_Keyboard.ScanCode <= 0x12u )
  {
    if ( V_NougatLfExists_dword_A0CFC == 0xFFFFFFFF )
    {
      *(int *)((char *)&a1->wnds[0].a + (_DWORD)&loc_24D9E + 2) = ~*(int *)((char *)&a1->wnds[0].a
                                                                          + (_DWORD)&loc_24D9E
                                                                          + 2);
      return 0;
    }
    return 0;
  }
  if ( V_Keyboard.ScanCode < 0x19u )
  {
    if ( V_Keyboard.ScanCode != 0x13 )
    {
      return 0xFFFFFFFF;
    }
    if ( a1->bbb || V_NougatLfExists_dword_A0CFC != 0xFFFFFFFF )
    {
      return 0;
    }
    if ( a1->aaa )
    {
      sub_59934(a1, V_NougatLfExists_dword_A0CFC);
    }
    else
    {
      srand(0);
      *(int *)((char *)&a1->wnds[0].a + (_DWORD)&loc_24DAA + 2) = 0x3F800000;
      sub_59908((int)a1);
    }
    return 0;
  }
  else
  {
    if ( V_Keyboard.ScanCode > 0x19u )
    {
      if ( V_Keyboard.ScanCode != 0x1F )
      {
        return 0xFFFFFFFF;
      }
      if ( !*(_DWORD *)&a1->z2[0x168] && *(_WORD *)&a1->z1e[0x596] != 8 )
      {
        sub_56E9C(a1, 2, 0xFFFFFFFF);
      }
      return 0;
    }
    if ( a1->aaa || V_NougatLfExists_dword_A0CFC != 0xFFFFFFFF )
    {
      return 0;
    }
    if ( a1->bbb )
    {
      sub_59934(a1, 0);
    }
    else
    {
      sub_59988(a1, "WINEVENT.BIN", 0);
    }
    return 0;
  }
}
// 54D64: could not find valid save-restore pair for esi
// 96774: using guessed type int Q_GameLoop_dword_96774;
// A0CFC: using guessed type int V_NougatLfExists_dword_A0CFC;
// 132B5C: using guessed type int dword_132B5C;

//----- (0005508C) --------------------------------------------------------
void __fastcall sub_5508C(P_Type3 a1)
{
  int v1; // esi
  unsigned int v2; // ebx
  int v3; // ebx
  char s[40]; // [esp+0h] [ebp-2Ch] BYREF
  P_Type3 v5; // [esp+28h] [ebp-4h]

  v5 = a1;
  if ( *(_DWORD *)a1->z5 == 0xFFFFFFFF )
  {
    if ( ++dword_10AE60 == 0xA )
    {
      v1 = dword_10AE68;
      dword_10AE64 = V_Timer_dword_132B58;
      dword_10AE68 = V_Timer_dword_132B58;
      v2 = V_Timer_dword_132B58 - v1;
      dword_10AE60 = 0;
      if ( V_Timer_dword_132B58 == v1 )
      {
        v2 = 1;
      }
      sprintf("FPS DUDE", "FPS %lu  %lu", 0x3E8 / v2, v2);
    }
    sub_2B3E0(&V_Type3_stru_10AE70.z1cc[4], 0x19, 0xA, 0x96, 0x1E);
    sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, 0, "FPS DUDE", 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
  }
  if ( dword_132B5C )
  {
    v3 = 0;
    if ( V_Mouse.y < 0xF0 )
    {
      v3 = 0x1CC;
    }
    sprintf(s, "(%d,%d)", V_Mouse.x, V_Mouse.y);
    *(PANE *)&V_Type3_stru_10AE70.z1cc[0xC] = V_Type6_stru_D8654.pane;
    sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 0, v3, s, 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
  }
  if ( V_Mouse.initialized == 1 )
  {
    MOUSE_pane_list_refresh(*(PANE_LIST **)&v5->z1aa[4]);
  }
  else
  {
    sub_5BA38(*(_DWORD **)&v5->z1aa[4]);
  }
  sub_5B71C(*(_DWORD *)&v5->z1aa[4]);
  if ( dword_132B60 == 0xFFFFFFFF )
  {
    Q_FadePalette_sub_2C5E4(&V_Type6_stru_D8654, dword_132B64);
    if ( ++dword_132B64 > 0x40 )
    {
      dword_132B64 = 0;
      dword_132B60 = 0;
    }
  }
}
// 10AE60: using guessed type int dword_10AE60;
// 10AE64: using guessed type int dword_10AE64;
// 10AE68: using guessed type int dword_10AE68;
// 132B58: using guessed type int V_Timer_dword_132B58;
// 132B5C: using guessed type int dword_132B5C;
// 132B60: using guessed type int dword_132B60;
// 132B64: using guessed type int dword_132B64;

//----- (00055214) --------------------------------------------------------
void __fastcall sub_55214(T_Type3 *a1, LONG x1, LONG y1, LONG x2, int y2)
{
  PANE pane; // [esp+0h] [ebp-18h] BYREF
  P_Type3 v6; // [esp+14h] [ebp-4h]

  v6 = a1;
  pane.x0 = x1;
  pane.y1 = y2;
  pane.y0 = y1;
  pane.x1 = x2;
  pane.window = a1->window;
  VFX_pane_wipe(&pane, 0);
  sub_55274(v6, x1, y1, x2, y2);
}

//----- (00055274) --------------------------------------------------------
void __fastcall sub_55274(P_Type3 a1, int x1, int y1, int x2, int y2)
{
  if ( sub_5B7C2(*(_DWORD **)&a1->z1aa[4], (int)a1->window, x1, y1, x2, y2) == 0xFFFFFFFF )
  {
    sub_5B71C(*(_DWORD *)&a1->z1aa[4]);
    sub_5B7C2(*(_DWORD **)&a1->z1aa[4], (int)a1->window, 0, 0, 639, 479);
  }
}

//----- (000552CC) --------------------------------------------------------
void __fastcall sub_552CC(P_Type3 a1, PANE *a2)
{
  if ( a2 )
  {
    sub_55274(a1, a2->x0, a2->y0, a2->x1, a2->y1);
  }
  else
  {
    sub_55274(a1, 0, 0, 639, 479);
  }
}

//----- (000552F8) --------------------------------------------------------
int __fastcall sub_552F8(P_Type3 a1, P_TypeA2 a2, int a3)
{
  int v4; // ebx
  T_TypeA1 *Wnd_sub_56DA8; // eax
  int magic12345678; // ebx
  int v7; // ecx
  __int16 childrenCnt; // di
  __int16 i; // cx
  __int16 j; // si
  int index; // edx
  int v12; // edi
  int result; // eax
  PANE pane; // [esp+0h] [ebp-20h] BYREF
  int v15; // [esp+14h] [ebp-Ch]
  int v16; // [esp+18h] [ebp-8h]
  P_TypeA2 v17; // [esp+1Ch] [ebp-4h]

  v17 = a2;
  v16 = a3;
  if ( *(_DWORD *)&a1->z2[0x168] )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x4CC);
  }
  v4 = V_FlashPopExists_dword_A0D00;
  v15 = *(_DWORD *)&a1->z5[4];
  *(_DWORD *)&a1->z5[4] = 0;
  if ( !v4 )
  {
    Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(a1, "NEXTTURNCONT", 0);
    magic12345678 = Wnd_sub_56DA8[1].magic12345678;
    Wnd_sub_56DA8[1].pane.window = 0;
    (*(void (**)(void))(magic12345678 + 0xC))();
  }
  v7 = *(_DWORD *)a1->z1aa;
  if ( v7 != 0xFFFFFFFF )
  {
    sub_56D30(a1, v7, 6, 0, 0);
  }
  *(_DWORD *)a1->z1aa = 0xFFFFFFFF;
  memset(byte_132B38, 1, sizeof(byte_132B38));
  sub_56BE8(a1, 0xF, 0, 0, 0xFFFFFFFF);
  if ( dword_96BB8 == 0xFFFFFFFF )
  {
    sub_54208(&v17->a1.pane, 0xF, 0, 0);
  }
  if ( sub_57220(a1, v17->a1.index, *(_WORD *)&a1->z1e[0x596]) != 0xFFFFFFFF )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x4EE);
  }
  childrenCnt = v17->a1.childrenCnt;
  for ( i = 0; i < childrenCnt; ++i )
  {
    if ( sub_57220(a1, (*v17->a1.children)[i]->index, *(_WORD *)&a1->z1e[0x596]) != 0xFFFFFFFF )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x4F4);
    }
  }
  (*(void (__fastcall **)(P_TypeA2, int, _DWORD, _DWORD))(v17->b + 8))(v17, 0xC8, 0, 0);
  (*(void (__fastcall **)(P_TypeA2, int, _DWORD, _DWORD))(v17->b + 8))(v17, 1, 0, 0);
  sub_55618(a1);
  (*(void (__fastcall **)(P_TypeA2, int, _DWORD, _DWORD))(v17->b + 8))(v17, 2, 0, 0);
  for ( j = 0; j < childrenCnt; ++j )
  {
    index = (*v17->a1.children)[j]->index;
    sub_57310(a1, index, *(_WORD *)&a1->z1e[0x596], v16);
  }
  pane = v17->a1.pane;
  sub_57310(a1, v17->a1.index, *(_WORD *)&a1->z1e[0x596], v16);
  v12 = dword_96BB8;
  *(_DWORD *)a1->z1aa = 0xFFFFFFFF;
  if ( v12 == 0xFFFFFFFF )
  {
    Q_WINMGR_CPP_sub_542B0(&pane);
  }
  sub_56BE8(a1, 0xE, 0, 0, 0xFFFFFFFF);
  sub_552CC(a1, 0);
  if ( V_FlashPopExists_dword_A0D00 == 0xFFFFFFFF )
  {
    *(int *)((char *)&a1->wnds[0].a + (_DWORD)&loc_24D9B + 1) = v15;
  }
  result = *(_DWORD *)&a1->z2[0x16C];
  dword_96BB8 = 0xFFFFFFFF;
  return result;
}
// 96BB8: using guessed type int dword_96BB8;
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;

//----- (00055554) --------------------------------------------------------
LONG __fastcall sub_55554(int a1, _DWORD *a2)
{
  int v3; // [esp+0h] [ebp-60h] BYREF
  int v4; // [esp+4h] [ebp-5Ch]
  int v5; // [esp+18h] [ebp-48h]
  int v6; // [esp+1Ch] [ebp-44h]
  int v7; // [esp+30h] [ebp-30h]
  int v8; // [esp+34h] [ebp-2Ch]
  int v9; // [esp+48h] [ebp-18h]
  int v10; // [esp+4Ch] [ebp-14h]

  v5 = 0x27F;
  v7 = 0x27F;
  v8 = 0x1DF;
  v10 = 0x1DF;
  v3 = 0;
  v4 = 0;
  v6 = 0;
  v9 = 0;
  sub_62DA5((WINDOW *)&V_Type6_stru_D8654.pane, 4, (int)&v3, (int)V_Type6_stru_D8654.hazeTables);
  v3 = a2[1] + 0x14;
  v4 = a2[2] + 0x14;
  v5 = a2[3] + 0x14;
  v6 = a2[2] + 0x14;
  v7 = a2[3] + 0x14;
  v8 = a2[4] + 0x14;
  v9 = a2[1] + 0x14;
  v10 = a2[4] + 0x14;
  return sub_62DA5((WINDOW *)&V_Type6_stru_D8654.pane, 4, (int)&v3, (int)(*V_Type6_stru_D8654.hazeTables)[7]);
}

//----- (00055618) --------------------------------------------------------
void __fastcall sub_55618(P_Type3 a1)
{
  int v2; // ebx

  if ( *(_DWORD *)&a1->z2[0x168] )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x57E);
  }
  *(_DWORD *)&a1->z2[0x168] = 0xFFFFFFFF;
  v2 = Q_GameLoop_dword_96774;
  *(_DWORD *)&a1->z2[0x16C] = 0;
  if ( v2 == 0xFFFFFFFF )
  {
    do
    {
      if ( *(_DWORD *)&a1->z2[0x168] != 0xFFFFFFFF )
      {
        break;
      }
      if ( V_Type3_stru_10AE70.bbb == 0xFFFFFFFF )
      {
        sub_59B80(&V_Type3_stru_10AE70);
      }
      else
      {
        Q_ProcessInput_sub_2656C();
      }
      sub_5469C(&V_Type3_stru_10AE70);
      sub_5508C(&V_Type3_stru_10AE70);
      if ( V_Type3_stru_10AE70.bbb )
      {
        sub_59A54(&V_Type3_stru_10AE70);
      }
    }
    while ( Q_GameLoop_dword_96774 == 0xFFFFFFFF );
  }
  V_Mouse.leftClicked = 0;
  V_Mouse.rightClicked = 0;
  V_Keyboard.Pressed = 0;
}
// 96774: using guessed type int Q_GameLoop_dword_96774;

//----- (000556CC) --------------------------------------------------------
void __fastcall Q_ShowMsgBox_sub_556CC(P_Type3 a1, char *a2)
{
  T_TypeA3 *ctrBox; // eax
  T_TypeA3 *v5; // edx
  T_TypeA2 *ctrBox_1; // ecx
  T_TypeA2 *ctrBut; // eax
  P_TypeA2 ctrBut_1; // edx
  char *name; // edi
  char *sub_1CEA8; // esi
  char v11; // al
  char v12; // al
  WINDOW *window; // eax

  ctrBox = (T_TypeA3 *)operator new(0xB3u);
  if ( ctrBox )
  {
    Q_A3_sub_2FA18(ctrBox);
  }
  Q_RegisterData_sub_2625C(ctrBox, 2, "MSGBOX");
  v5 = ctrBox;
  ctrBox_1 = &ctrBox->a2;
  Q_WINMGR_CPP_RegisterWindow_sub_2C978(&ctrBox->a2.a1);
  v5->a2.a1.k = 0;
  v5->a2.a1.pane.y0 = 0x32;
  v5->a2.a1.pane.y1 = 0x12C;
  v5->controls = a2;
  v5->a2.a1.pane.x0 = v5->a2.a1.pane.y0;
  v5->a2.a1.pane.x1 = v5->a2.a1.pane.y1;
  v5->a2.a1.pane.window = a1->window;
  ctrBut = (T_TypeA2 *)operator new(0xABu);
  if ( ctrBut )
  {
    Q_A2_sub_2C830(ctrBut);
  }
  Q_RegisterData_sub_2625C(ctrBut, 2, "MSGBOXBUTTON");
  ctrBut_1 = ctrBut;
  Q_WINMGR_CPP_RegisterWindow_sub_2C978(&ctrBut->a1);
  name = ctrBut_1->a1.name;
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1E);// 30: "OK"
  do
  {
    v11 = *sub_1CEA8;
    *name = *sub_1CEA8;
    if ( !v11 )
    {
      break;
    }
    v12 = sub_1CEA8[1];
    sub_1CEA8 += 2;
    name[1] = v12;
    name += 2;
  }
  while ( v12 );
  ctrBut_1->a1.pane.y0 = 0x104;
  ctrBut_1->a1.pane.y1 = 0x122;
  ctrBut_1->a1.pane.x0 = ctrBut_1->a1.pane.y0;
  ctrBut_1->a1.pane.x1 = ctrBut_1->a1.pane.y1;
  window = a1->window;
  ctrBut_1->a1.k = 0xFFFFFFFF;
  ctrBut_1->a1.sendMessage = 0xC9;
  ctrBut_1->a1.pane.window = window;
  ctrBut_1->a1.parentIndex = ctrBox_1->a1.index;
  Q_GWINDOW_CPP_LinkChild_sub_2C990(&ctrBox_1->a1, &ctrBut_1->a1);
  sub_552F8(a1, ctrBox_1, 0xFFFFFFFF);
}

//----- (000557D4) --------------------------------------------------------
const char *__fastcall sub_557D4(T_Type3 *eax0, char *s2, const char *a3, __int16 a4)
{
  T_TypeA2 *v5; // eax
  T_TypeA2 *v6; // ecx
  T_TypeA2 *v7; // ebp
  int v8; // ebx
  int v9; // eax
  P_Type3 v10; // eax
  T_TypeA2 *v11; // eax
  T_TypeA1 *p_a1; // ebx
  char *name; // edi
  char *sub_1CEA8; // esi
  char v15; // al
  char v16; // al
  char *v17; // eax
  WINDOW *window; // eax
  T_TypeA2 *v19; // eax
  P_TypeA1 v20; // edx
  P_TypeA1 v21; // edx
  LONG v22; // eax
  LONG v23; // ebx
  int v24; // ebx
  int index; // eax
  void *ShapeTable_sub_1B084; // eax
  PANE pane; // [esp+0h] [ebp-3Ch] BYREF
  T_TypeA2 *v29; // [esp+14h] [ebp-28h]
  int v30; // [esp+18h] [ebp-24h]
  const char *v31; // [esp+1Ch] [ebp-20h]
  LONG v32; // [esp+20h] [ebp-1Ch]
  P_Type3 a1; // [esp+24h] [ebp-18h]
  P_TypeA1 v34; // [esp+28h] [ebp-14h]
  __int16 v35; // [esp+2Ch] [ebp-10h]

  a1 = eax0;
  v31 = a3;
  v35 = a4;
  v32 = sub_2B594((int *)&V_Type3_stru_10AE70.z1cc[4]);
  v30 = 5 * v32 + 5;
  v5 = (T_TypeA2 *)operator new(0xABu);
  if ( v5 )
  {
    Q_A2_sub_2C830(v5);
  }
  Q_RegisterData_sub_2625C(v5, 2, "INPUTBOX");
  v6 = v5;
  v7 = v5;
  Q_WINMGR_CPP_RegisterWindow_sub_2C978(&v5->a1);
  strncpy(v6->a1.name, s2, 0x13u);
  v8 = v30;
  v6->a1.pane.x0 = 0xF2;
  v6->a1.pane.x1 = 0x18D;
  v9 = (0x1E0 - v8) / 2;
  v6->a1.name[0x13] = 0;
  v6->a1.s = 0xFFFF;
  v6->a1.pane.y0 = v9;
  v6->a1.pane.y1 = v8 + v9;
  v10 = a1;
  v6->a1.t = 5;
  v6->a1.pane.window = v10->window;
  v11 = (T_TypeA2 *)operator new(0xABu);
  if ( v11 )
  {
    Q_A2_sub_2C830(v11);
  }
  Q_RegisterData_sub_2625C(v11, 2, "MSGBOXBUTTON");
  p_a1 = &v11->a1;
  v29 = v11;
  Q_WINMGR_CPP_RegisterWindow_sub_2C978(&v11->a1);
  name = p_a1->name;
  sub_1CEA8 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1E);// 30: "OK"
  do
  {
    v15 = *sub_1CEA8;
    *name = *sub_1CEA8;
    if ( !v15 )
    {
      break;
    }
    v16 = sub_1CEA8[1];
    sub_1CEA8 += 2;
    name[1] = v16;
    name += 2;
  }
  while ( v16 );
  p_a1->s = 0xFFFF;
  p_a1->t = 2;
  v17 = Q_CORN_CPP_StaticTxtRead_sub_1CEA8(0x1E);      // 30: "OK"
  p_a1->pane.x0 = v7->a1.pane.x1 - sub_2B4F4(&V_Type3_stru_10AE70.z1cc[4], v17) - 0xA;
  p_a1->pane.x1 = v7->a1.pane.x1 - 3;
  p_a1->pane.y0 = v7->a1.pane.y1 - v32 - 5;
  p_a1->pane.y1 = v7->a1.pane.y1 - 2;
  window = a1->window;
  p_a1->k = 0xFFFFFFFF;
  p_a1->u = 0xFFFFFFFF;
  p_a1->sendMessage = 0xC9;
  p_a1->pane.window = window;
  p_a1->parentIndex = v7->a1.index;
  Q_GWINDOW_CPP_LinkChild_sub_2C990(&v7->a1, p_a1);
  v19 = (T_TypeA2 *)operator new(0xC1u);
  if ( v19 )
  {
    v19 = sub_2F48C(v19);
  }
  Q_RegisterData_sub_2625C(v19, 2, "EDITWND");
  v34 = &v19->a1;
  if ( !v19 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x5F7);
  }
  Q_WINMGR_CPP_RegisterWindow_sub_2C978(v34);
  v20 = v34;
  v34->pane.x0 = v7->a1.pane.x0 + 0xF;
  v20->pane.x1 = v7->a1.pane.x1 - 0xF;
  v21 = v34;
  v22 = v32 + v7->a1.pane.y0 + 8;
  v23 = v32;
  v34->pane.y0 = v22;
  v21->pane.y1 = v23 + v22 + 8;
  v21->pane.window = a1->window;
  v24 = v35;
  index = v7->a1.index;
  v21->sendMessage = 0;
  v21->parentIndex = index;
  sub_2F9A4((int)v21, v31, v24);
  Q_GWINDOW_CPP_LinkChild_sub_2C990(&v7->a1, v34);
  pane = v7->a1.pane;
  dword_96BB8 = 0;
  pane.x0 -= 8;
  pane.x1 += 8;
  pane.y0 -= 8;
  pane.y1 += 7;
  sub_54208(&pane, (int)&pane, v24, 0);
  sub_552CC(a1, &pane);
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           (unsigned __int16)word_FFEEA);
  VFX_shape_draw(&pane, ShapeTable_sub_1B084, 1, 0, 0);
  sub_552F8(a1, v7, 0);
  Q_WINMGR_CPP_sub_542B0(&pane);
  sub_552CC(a1, &pane);
  sub_57530((int)a1, v29->a1.index, 0);
  sub_57530((int)a1, v34->index, 0);
  sub_57530((int)a1, v7->a1.index, 0);
  return v31;
}
// 96BB8: using guessed type int dword_96BB8;

//----- (00055AEC) --------------------------------------------------------
unsigned int __fastcall sub_55AEC(P_Type3 a1, __int16 a2, int a3, int a4)
{
  int v6; // edx

  if ( V_FlashPopExists_dword_A0D00 == 0xFFFFFFFF )
  {
    return 0;
  }
  v6 = *(__int16 *)&a1->z2[0x24];
  if ( v6 == 0x20 )
  {
    return 0;
  }
  *(_WORD *)&a1->z2[0xA * v6 + 0x28] = a2;
  *(_DWORD *)&a1->z2[0xA * *(__int16 *)&a1->z2[0x24] + 0x2A] = a3;
  *(_DWORD *)&a1->z2[0xA * (__int16)(*(_WORD *)&a1->z2[0x24])++ + 0x2E] = a4;
  return 0xFFFFFFFF;
}
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;

//----- (00055B74) --------------------------------------------------------
char __fastcall sub_55B74(int a1)
{
  int v1; // esi
  T_TypeA1 *Wnd_sub_56DA8; // eax
  T_TypeA2 *v3; // ebp
  __int16 v4; // di
  int v5; // ebp
  __int16 *v6; // ebp
  int v7; // ebp
  unsigned int v8; // ecx
  bool v9; // zf
  __int16 v10; // dx
  __int16 v11; // bx
  int v13; // [esp+8h] [ebp-20h]
  int v14; // [esp+Ch] [ebp-1Ch]

  v1 = a1;
  if ( dword_10AE6C == 0xFFFFFFFF )
  {
    return a1;
  }
  a1 = *(__int16 *)(a1 + 0x475A);
  if ( !a1 )
  {
    return a1;
  }
  a1 = *(__int16 *)(v1 + 0x4228);
  if ( a1 != 1 )
  {
    return a1;
  }
  Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8((P_Type3)v1, "EVENTWIN", 0);
  v3 = (T_TypeA2 *)Wnd_sub_56DA8;
  if ( !Wnd_sub_56DA8 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x63B);
  }
  sub_26874((int)Wnd_sub_56DA8, (__int16 *)(0xA * *(__int16 *)(v1 + 0x475C) + v1 + 0x475E));
  dword_10AE6C = 0xFFFFFFFF;
  v13 = 0;
  if ( !V_FlashPopExists_dword_A0D00 )
  {
    v13 = sub_552F8((P_Type3)v1, v3, 0);
  }
  v4 = 0;
  dword_10AE6C = 0;
  if ( !v13 )
  {
    LOBYTE(a1) = 0;
    goto LABEL_47;
  }
  v7 = v1 + 0xA * *(__int16 *)(v1 + 0x475C);
  v8 = *(__int16 *)(v7 + 0x475E);
  a1 = *(_DWORD *)(v7 + 0x4760);
  v14 = *(_DWORD *)(v7 + 0x4764);
  if ( v8 < 9 )
  {
    if ( v8 >= 3 )
    {
      goto LABEL_16;
    }
    if ( !*(_WORD *)(v7 + 0x475E) )
    {
      v9 = 1;
      goto LABEL_45;
    }
    if ( v8 > 1 )
    {
      v4 = 0xD;
      byte_968DD = *(_DWORD *)(v7 + 0x4760);
      goto LABEL_47;
    }
    goto LABEL_10;
  }
  if ( v8 <= 9 )
  {
    goto LABEL_16;
  }
  if ( v8 >= 0x14 )
  {
    if ( v8 > 0x14 )
    {
      if ( v8 < 0x17 )
      {
        v9 = v8 == 0x16;
      }
      else
      {
        if ( v8 <= 0x17 )
        {
          LOBYTE(a1) = *(_DWORD *)(v7 + 0x4764);
          v4 = 0xD;
          byte_968DD = a1;
          goto LABEL_47;
        }
        v9 = v8 == 0x19;
      }
LABEL_45:
      if ( v9 )
      {
        v4 = 0x14;
      }
      goto LABEL_47;
    }
LABEL_16:
    v5 = *(_DWORD *)(v7 + 0x4760);
    if ( *(_BYTE *)(a1 + 0x58) != 4 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x6A8);
    }
    LOBYTE(a1) = v14;
    v6 = *(__int16 **)(v5 + 0x59);
    if ( (v8 == 4 || v8 == 8) && v13 != 2 )
    {
      v4 = 0xD;
      if ( sub_45958(&V_Game.races[v14].Unknown_00, 2, v6, 0) )
      {
        V_Game.races[v14].Unknown_1E9 = 1;
        V_Game.races[v14].Unknown_1EA = (int)v6;
      }
      else
      {
        V_Game.races[v14].Unknown_1E9 = 0;
      }
      LOBYTE(a1) = v14;
      byte_968DD = v14;
    }
    else
    {
      v4 = 0x10;
      V_Game.h1 = (char *)v6;
    }
    goto LABEL_47;
  }
  if ( v8 >= 0x10 )
  {
    if ( v8 <= 0x12 )
    {
      v4 = 0x11;
      V_Game.planet = *(T_Planet **)(v7 + 0x4764);
    }
    else if ( v13 == 1 )
    {
      v4 = 0x10;
      V_Game.h1 = *(char **)(v7 + 0x4760);
    }
    else if ( v14 == 7 )
    {
      LOBYTE(a1) = sub_56B60((P_Type3)v1, 7, 0, 0);
    }
    else
    {
      *(_DWORD *)((char *)&loc_24D9B + v1 + 1) = 0xFFFFFFFF;
    }
    goto LABEL_47;
  }
  if ( v8 == 0xF )
  {
LABEL_10:
    v4 = 0x11;
    V_Game.planet = *(T_Planet **)(v7 + 0x4760);
  }
LABEL_47:
  v10 = *(_WORD *)(v1 + 0x475C) + 1;
  v11 = *(_WORD *)(v1 + 0x475A);
  *(_WORD *)(v1 + 0x475C) = v10;
  if ( v10 == v11 )
  {
    *(_WORD *)(v1 + 0x475C) = 0;
    *(_WORD *)(v1 + 0x475A) = 0;
  }
  if ( v4 )
  {
    LOBYTE(a1) = sub_56B60((P_Type3)v1, 1, v4, 1);
  }
  return a1;
}
// 968DD: using guessed type char byte_968DD;
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;
// 10AE6C: using guessed type int dword_10AE6C;

//----- (00055E80) --------------------------------------------------------
void __fastcall sub_55E80(int a1)
{
  char *index; // edx
  __int16 v3; // ax
  int v4; // eax
  int v5; // ecx
  int v6; // ebx
  int v7; // ecx
  __int16 i; // si
  int v9; // eax
  T_TypeA1 *v10; // ecx
  T_TypeA1 *v11; // esi
  char v12; // bl
  char *v13; // edi
  char *v14; // esi
  char v15; // al
  char v16; // al
  int v17; // eax
  T_TypeA1 *v18; // esi
  char v19; // dl
  char *v20; // edi
  char *v21; // esi
  char v22; // al
  char v23; // al
  int v24; // eax
  UBYTE v25; // al
  T_TypeA1 *v26; // eax
  char format[600]; // [esp+0h] [ebp-53Ch] BYREF
  char v28[600]; // [esp+258h] [ebp-2E4h] BYREF
  char s[28]; // [esp+4B0h] [ebp-8Ch] BYREF
  char v30[28]; // [esp+4CCh] [ebp-70h] BYREF
  char v31[28]; // [esp+4E8h] [ebp-54h] BYREF
  LONG *p_sendParam2; // [esp+504h] [ebp-38h]
  LONG *v33; // [esp+508h] [ebp-34h]
  char *v34; // [esp+50Ch] [ebp-30h]
  char *v35; // [esp+510h] [ebp-2Ch]
  int v36; // [esp+514h] [ebp-28h]
  T_TypeA2 *Wnd_sub_56DA8; // [esp+518h] [ebp-24h]
  int v38; // [esp+51Ch] [ebp-20h]
  int v39; // [esp+520h] [ebp-1Ch]

  HIWORD(index) = 0;
  qmemcpy((void *)(a1 + 0x436C), (const void *)(a1 + 0x422C), 0x140u);
  v3 = *(_WORD *)(a1 + 0x44AC);
  LOWORD(v39) = 0;
  v38 = (unsigned __int16)v3;
  *(_WORD *)(a1 + 0x44AC) = 0;
  if ( v3 > 0 )
  {
    do
    {
      v4 = 0xA * (__int16)v39;
      LOWORD(index) = *(_WORD *)(v4 + a1 + 0x436C);
      v5 = *(_DWORD *)(v4 + a1 + 0x436E);
      v36 = *(_DWORD *)(v4 + a1 + 0x4372);
      switch ( (__int16)index )
      {
        case 0:
          break;
        case 1:
          index = (char *)(__int16)v5;
          sub_56E9C((P_Type3)a1, v5, (v36 == 0) - 1);
          break;
        case 2:
          HIWORD(index) = 0;
          Q_GameLoop_dword_96774 = 0;
          break;
        case 3:
          HIWORD(index) = 0xFFFF;
          sub_570AC(a1, 0xFFFFFFFF);
          break;
        case 4:
          if ( !*(_DWORD *)(a1 + 0x48A6) && !*(_DWORD *)(a1 + 0x48AA) )
          {
            index = "WINEVENT.BIN";
            sub_59988((P_Type3)a1, "WINEVENT.BIN", 0xFFFFFFFF);
          }
          break;
        case 5:
          switch ( v36 )
          {
            case 1:
              index = "ABILITYWIN";
              Wnd_sub_56DA8 = (T_TypeA2 *)Q_FindWnd_sub_56DA8((P_Type3)a1, "ABILITYWIN", 0);
              sub_33884(Wnd_sub_56DA8, (int)"ABILITYWIN", 0, v5);
              break;
            case 2:
              v10 = Q_FindWnd_sub_56DA8((P_Type3)a1, "HELPWINDOW", 0);
              Wnd_sub_56DA8 = (T_TypeA2 *)v10;
              sprintf(s, "STATE%02d", *(__int16 *)(a1 + 0x4228));
              index = "help.txt";
              sub_2FCB0(v10, "help.txt", s);
              break;
            case 3:
              index = "help.txt";
              Wnd_sub_56DA8 = (T_TypeA2 *)Q_FindWnd_sub_56DA8((P_Type3)a1, "HELPWINDOW", 0);
              sub_2FCB0(Wnd_sub_56DA8, "help.txt", "NOINTRO");
              break;
            case 4:
              sprintf(v30, "gizmo%02d", v5);
              index = "gizhelp.txt";
              v11 = Q_FindWnd_sub_56DA8((P_Type3)a1, "HELPWINDOW", 0);
              Wnd_sub_56DA8 = (T_TypeA2 *)v11;
              sub_2FCB0(v11, "gizhelp.txt", v30);
              v12 = v11[0x13].name[0x10];
              v35 = &v11[0x13].name[0x10];
              p_sendParam2 = &v11[0x13].sendParam2;
              if ( v12 != 1 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x784);
              }
              if ( *(_BYTE *)p_sendParam2 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x785);
              }
              v13 = format;
              v14 = *(char **)(v35 + 5);
              do
              {
                v15 = *v14;
                *v13 = *v14;
                if ( !v15 )
                {
                  break;
                }
                v16 = v14[1];
                v14 += 2;
                v13[1] = v16;
                v13 += 2;
              }
              while ( v16 );
              sprintf(*(char **)(v35 + 5), format, &V_Gizmos[v5]);
              v17 = (int)p_sendParam2;
              *(_WORD *)((char *)p_sendParam2 + 1) = 0x1C;
              *(_WORD *)(v17 + 3) = v5;
              break;
            case 5:
              sprintf(v31, "plitem%02d", v5);
              v18 = Q_FindWnd_sub_56DA8((P_Type3)a1, "HELPWINDOW", 0);
              Wnd_sub_56DA8 = (T_TypeA2 *)v18;
              sub_2FCB0(v18, "planhelp.txt", v31);
              v19 = v18[0x13].name[0x10];
              v34 = &v18[0x13].name[0x10];
              v33 = &v18[0x13].sendParam2;
              if ( v19 != 1 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x79F);
              }
              if ( *(_BYTE *)v33 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x7A0);
              }
              v20 = v28;
              v21 = *(char **)(v34 + 5);
              do
              {
                v22 = *v21;
                *v20 = *v21;
                if ( !v22 )
                {
                  break;
                }
                v23 = v21[1];
                v21 += 2;
                v20[1] = v23;
                v20 += 2;
              }
              while ( v23 );
              index = *(char **)(v34 + 5);
              sprintf(index, v28, V_PlanetItems.item[v5].name);
              if ( v5 == 0x17 )
              {
                index = (char *)v33;
                v25 = byte_104BEA;
                *(_WORD *)((char *)v33 + 3) = 0;
                *(_WORD *)(index + 1) = v25 + 0xE;
              }
              else
              {
                v24 = (int)v33;
                *(_WORD *)((char *)v33 + 1) = 0x1E;
                *(_WORD *)(v24 + 3) = v5;
              }
              break;
            default:
              index = "HELPWINDOW";
              v26 = Q_FindWnd_sub_56DA8((P_Type3)a1, "HELPWINDOW", 0);
              Wnd_sub_56DA8 = (T_TypeA2 *)v26;
              if ( v5 )
              {
                index = "help.txt";
                sub_2FCB0(v26, "help.txt", (char *)v5);
              }
              break;
          }
          if ( !*(_DWORD *)(a1 + 0x489E) )
          {
            HIWORD(index) = HIWORD(Wnd_sub_56DA8);
            sub_552F8((P_Type3)a1, Wnd_sub_56DA8, 0);
          }
          if ( v36 == 1 )
          {
            index = (char *)Q_FindWnd_sub_56DA8((P_Type3)a1, "COSMOSWnd", 0)->index;
            sub_56D30((P_Type3)a1, (int)index, 0xD, 0, 0);
          }
          break;
        case 6:
          *(_DWORD *)(a1 + 0x489E) = 0;
          *(_DWORD *)(a1 + 0x48A2) = v5;
          break;
        case 7:
          v6 = sub_20B3C((int)&V_Game);
          if ( v6 )
          {
            v7 = 7;
            if ( *(_DWORD *)((char *)&loc_24D9B + a1 + 1) == 0xFFFFFFFF )
            {
              v7 = 8;
            }
            HIWORD(index) = 0;
            sub_55AEC((P_Type3)a1, 0x13, v6, v7);
          }
          else
          {
            sub_20C94((int)&V_Game, (int)index, 0, (T_TypeA1 *)v5);
            if ( *(_DWORD *)((char *)&loc_24D9E + a1 + 2) == 0xFFFFFFFF )
            {
              for ( i = 0; i < V_Game.racesNum; ++i )
              {
                if ( i != byte_104BEA )
                {
                  sub_46130(&V_Game.races[byte_104BEA].Unknown_00, i, 0xFFFFFFFF);
                  sub_45F60(&V_Game.races[byte_104BEA].Unknown_00, i, 0xFFFFFFFF);
                }
              }
            }
            HIWORD(index) = 0;
            sub_56BE8((P_Type3)a1, 0xD, 0, 0, 0);
            sub_5508C((P_Type3)a1);
          }
          break;
        case 8:
          v9 = sub_20B3C((int)&V_Game);
          if ( !v9 || V_FlashPopExists_dword_A0D00 )
          {
            *(_DWORD *)((char *)&loc_24D9B + a1 + 1) = ~*(_DWORD *)((char *)&loc_24D9B + a1 + 1);
          }
          else
          {
            HIWORD(index) = 0;
            sub_55AEC((P_Type3)a1, 0x13, v9, (__int16)index);
          }
          break;
        default:
          index = "..\\winmgr.cpp";
          Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x7D7);
          break;
      }
      LOWORD(v39) = v39 + 1;
    }
    while ( (__int16)v39 < (__int16)v38 );
  }
}
// 96774: using guessed type int Q_GameLoop_dword_96774;
// A0D00: using guessed type int V_FlashPopExists_dword_A0D00;

//----- (00056400) --------------------------------------------------------
void __fastcall sub_56400(T_Type3 *a1, int a2, __int16 a3, int a4, int a5, int a6)
{
  __int16 i; // kr00_2
  int v9; // eax

  if ( a1->counter1 == 0x10 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x7ED);
  }
  if ( a1->aaa == 0xFFFFFFFF || a1->bbb == 0xFFFFFFFF )
  {
    a6 = 0;
  }
  for ( i = 0; i < 0x10; ++i )
  {
    if ( !a1->b1[i].a )
    {
      a1->b1[i].a = a2;
      a1->b1[i].c = a4;
      a1->b1[i].b = a3;
      a1->b1[i].d = a5;
      v9 = V_Timer_dword_132B58;
      a1->b1[i].e = a6;
      a1->b1[i].f = a6 + v9;
      ++a1->counter1;
      break;
    }
  }
  sub_59C80(a1, a2, 4, a3, a4, a5, 0);
}
// 132B58: using guessed type int V_Timer_dword_132B58;

//----- (000564C0) --------------------------------------------------------
void __fastcall sub_564C0(T_Type3 *a1, int a2, __int16 a3)
{
  __int16 i; // dx
  char *v6; // ebx

  for ( i = 0; i < 0x10; ++i )
  {
    v6 = (char *)a1 + 0x16 * i;
    if ( a2 == *(_DWORD *)(v6 + 0x44AE) && (a3 == 0xFFFFFFFF || a3 == *((_WORD *)v6 + 0x2259)) )
    {
      a1->b1[i].a = 0;
      --a1->counter1;
    }
  }
  sub_59C80(a1, a2, 5, a3, 0, 0, 0);
}

//----- (00056528) --------------------------------------------------------
int __fastcall sub_56528(int a1, int a2, __int16 a3)
{
  __int16 i; // ax
  int v6; // edx

  for ( i = 0; i < 0x10; ++i )
  {
    v6 = a1 + 0x16 * i;
    if ( a2 == *(_DWORD *)(v6 + 0x44AE) && a3 == *(_WORD *)(v6 + 0x44B2) )
    {
      return *(_DWORD *)(v6 + 0x44BC);
    }
  }
  return 0xFFFF;
}

//----- (00056564) --------------------------------------------------------
unsigned int __fastcall sub_56564(int a1, int a2, __int16 a3, int a4)
{
  __int16 i; // dx
  int v7; // eax

  for ( i = 0; i < 0x10; ++i )
  {
    v7 = a1 + 0x16 * i;
    if ( a2 == *(_DWORD *)(v7 + 0x44AE) && a3 == *(_WORD *)(v7 + 0x44B2) )
    {
      *(_DWORD *)(v7 + 0x44BC) = a4;
      return 0xFFFFFFFF;
    }
  }
  return 0;
}

//----- (00056694) --------------------------------------------------------
int __fastcall sub_56694(T_Type3 *a1)
{
  T_SomeStruct5 *b1; // eax
  __int16 a; // di
  int result; // eax
  T_SomeStruct5 *v5; // esi
  void (__fastcall *v6)(int, int); // edx
  T_SomeStruct5 *v7; // [esp+4h] [ebp-20h]
  __int16 v8; // [esp+8h] [ebp-1Ch]

  b1 = a1->b1;
  a = b1[0x10].a;
  v8 = 0;
  v7 = b1;
  while ( 1 )
  {
    result = v8;
    if ( v8 >= 0x10 || a <= 0 )
    {
      break;
    }
    v5 = &v7[v8];
    v6 = (void (__fastcall *)(int, int))v5->a;
    if ( v5->a )
    {
      if ( (unsigned int)V_Timer_dword_132B58 >= v5->f )
      {
        if ( v5->b == 0x29A )
        {
          v6(v5->c, v5->d);
        }
        else
        {
          sub_56D30(a1, (int)v6, v5->b, v5->c, v5->d);
        }
        v5->f += v5->e;
      }
      --a;
    }
    ++v8;
  }
  return result;
}
// 132B58: using guessed type int V_Timer_dword_132B58;

//----- (00056728) --------------------------------------------------------
void __fastcall sub_56728(int a1, int a2, int a3, __int16 a4, int a5, int a6)
{
  __int16 i; // kr00_2

  if ( *(_WORD *)(a1 + 0x4730) == 0x10 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x8C6);
  }
  for ( i = 0; i < 0x10; ++i )
  {
    if ( !*(_DWORD *)(a1 + 0x12 * i + 0x4610) )
    {
      *(_DWORD *)(a1 + 0x12 * i + 0x4610) = a2;
      *(_DWORD *)(a1 + 0x12 * i + 0x4614) = a3;
      *(_WORD *)(a1 + 0x12 * i + 0x4618) = a4;
      *(_DWORD *)(a1 + 0x12 * i + 0x461A) = a5;
      *(_DWORD *)(a1 + 0x12 * i + 0x461E) = a6;
      ++*(_WORD *)(a1 + 0x4730);
      break;
    }
  }
  sub_59C80((P_Type3)a1, a2, 6, a4, a5, a6, a3);
}

//----- (000567BC) --------------------------------------------------------
void __fastcall sub_567BC(P_Type3 a1, int a2, __int16 a3)
{
  __int16 i; // dx
  char *v6; // ebx

  for ( i = 0; i < 0x10; ++i )
  {
    v6 = (char *)a1 + 0x12 * i;
    if ( a2 == *((_DWORD *)v6 + 0x1184) && (a3 == 0xFFFFFFFF || a3 == *((_WORD *)v6 + 0x230C)) )
    {
      *(_DWORD *)&a1->z2a[0x12 * i] = 0;
      --*(_WORD *)&a1->z2a[0x120];
    }
  }
  sub_59C80(a1, a2, 7, a3, 0, 0, 0);
}

//----- (00056824) --------------------------------------------------------
void __fastcall sub_56824(int a1)
{
  int v2; // eax
  int v3; // edi
  int v4; // eax
  int v5; // [esp+0h] [ebp-28h]
  int v6; // [esp+4h] [ebp-24h]
  __int16 i; // [esp+8h] [ebp-20h]
  __int16 v8; // [esp+Ch] [ebp-1Ch]

  v8 = *(_WORD *)(a1 + 0x4730);
  v6 = 0;
  v5 = 0;
  if ( V_Mouse.leftClicked == 0xFFFFFFFF )
  {
    v6 = 1;
  }
  if ( V_Mouse.rightClicked == 0xFFFFFFFF )
  {
    LOBYTE(v6) = v6 | 2;
  }
  if ( V_Mouse.moved == 0xFFFFFFFF )
  {
    LOBYTE(v5) = 4;
  }
  for ( i = 0; i < 0x10 && v8 > 0; ++i )
  {
    v2 = a1 + 0x12 * i;
    v3 = *(_DWORD *)(v2 + 0x4610);
    if ( v3 )
    {
      if ( (v6 & *(_DWORD *)(v2 + 0x4614)) != 0 )
      {
        sub_56D30(
          (P_Type3)a1,
          *(_DWORD *)(v2 + 0x4610),
          *(__int16 *)(v2 + 0x4618),
          *(_DWORD *)(v2 + 0x461A),
          *(_DWORD *)(v2 + 0x461E));
      }
      v4 = a1 + 0x12 * i;
      if ( (v5 & *(_DWORD *)(v4 + 0x4614)) != 0 )
      {
        sub_56D30((P_Type3)a1, v3, *(__int16 *)(v4 + 0x4618), V_Mouse.x, V_Mouse.y);
      }
      --v8;
    }
  }
}

//----- (0005691C) --------------------------------------------------------
int __fastcall sub_5691C(int result)
{
  int v1; // esi
  LONG x; // edi
  int v3; // edx
  LONG y; // ebp
  int v5; // ecx
  __int16 v6; // dx
  LONG v7; // ebx
  int v8; // edx
  __int16 v9; // cx
  int v10; // eax
  _DWORD *v11; // edx
  unsigned int v12; // [esp+4h] [ebp-28h]
  int v13; // [esp+8h] [ebp-24h]
  int v14; // [esp+Ch] [ebp-20h]
  __int16 v15; // [esp+10h] [ebp-1Ch]

  v1 = result;
  x = V_Mouse.x;
  v3 = *(_DWORD *)(result + 0x3002);
  y = V_Mouse.y;
  if ( v3 == 0xFFFFFFFF )
  {
    goto LABEL_17;
  }
  v5 = *(_DWORD *)(result + 0xC * v3 + 4);
  if ( V_Mouse.x > *(_DWORD *)(v5 + 0x10)
    || V_Mouse.x < *(_DWORD *)(v5 + 8)
    || V_Mouse.y > *(_DWORD *)(v5 + 0x14)
    || V_Mouse.y < *(_DWORD *)(v5 + 0xC) )
  {
    sub_56D30((P_Type3)result, *(_DWORD *)(result + 0x3002), 8, V_Mouse.x, V_Mouse.y);
    result = sub_56D30((P_Type3)v1, *(_DWORD *)(v1 + 0x3002), 6, 0, 0);
    *(_DWORD *)(v1 + 0x3002) = 0xFFFFFFFF;
LABEL_17:
    v8 = *(__int16 *)(v1 + 0x4228);
    if ( v8 >= 0 )
    {
      v9 = 0x1F;
      v12 = 0;
      v15 = *(_WORD *)(v1 + 0x8E * v8 + 0x3068);
      while ( 1 )
      {
        result = v15;
        if ( v15 <= 0 || v12 )
        {
          break;
        }
        if ( v9 < 0 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x992);
        }
        v10 = *(_DWORD *)(v1 + 0x8E * *(__int16 *)(v1 + 0x4228) + 4 * v9 + 0x306A);
        v13 = v10;
        if ( v10 )
        {
          v11 = *(_DWORD **)(v1 + 0xC * v10 + 4);
          if ( *(_DWORD *)((char *)v11 + 0xA3) == 0xFFFFFFFF
            && x <= v11[4]
            && x >= v11[2]
            && y <= v11[5]
            && y >= v11[3]
            && *(_DWORD *)((char *)v11 + 0x35) == 0xFFFFFFFF )
          {
            v12 = 0xFFFFFFFF;
          }
          --v15;
        }
        --v9;
      }
      if ( v12 == 0xFFFFFFFF )
      {
        *(_DWORD *)(v1 + 0x3002) = v13;
        return sub_56D30((P_Type3)v1, v13, 7, 0, 0);
      }
    }
    return result;
  }
  result = *(__int16 *)(v5 + 0x6B);
  if ( *(_WORD *)(v5 + 0x6B) )
  {
    v6 = 0;
    if ( *(__int16 *)(v5 + 0x6B) > 0 )
    {
      while ( 1 )
      {
        result = *(_DWORD *)(*(_DWORD *)(v5 + 0x67) + 4 * v6);
        v14 = result;
        if ( *(_DWORD *)(result + 0x35) )
        {
          v7 = *(_DWORD *)(result + 0x10);
          result += 4;
          if ( V_Mouse.x <= v7
            && V_Mouse.x >= *(_DWORD *)(result + 4)
            && V_Mouse.y <= *(_DWORD *)(result + 0x10)
            && V_Mouse.y >= *(_DWORD *)(result + 8) )
          {
            break;
          }
        }
        if ( ++v6 >= *(__int16 *)(v5 + 0x6B) )
        {
          return result;
        }
      }
      sub_56D30((P_Type3)v1, *(_DWORD *)(v1 + 0x3002), 8, V_Mouse.x, V_Mouse.y);
      sub_56D30((P_Type3)v1, *(_DWORD *)(v1 + 0x3002), 6, 0, 0);
      sub_56D30((P_Type3)v1, *(_DWORD *)(v14 + 0x41), 7, 0, 0);
      result = *(_DWORD *)(v14 + 0x41);
      *(_DWORD *)(v1 + 0x3002) = result;
    }
  }
  return result;
}
// 56B46: variable 'v13' is possibly undefined

//----- (00056B60) --------------------------------------------------------
int __fastcall sub_56B60(P_Type3 a1, __int16 a2, int a3, int a4)
{
  int v5; // edx
  int result; // eax

  if ( *(_WORD *)&a1->z1e[0x81A] == 0x20 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x9B5);
  }
  *(_WORD *)&a1->z1e[0xA * *(__int16 *)&a1->z1e[0x81A] + 0x59A] = a2;
  *(_DWORD *)&a1->z1e[0xA * *(__int16 *)&a1->z1e[0x81A] + 0x59C] = a3;
  v5 = *(__int16 *)&a1->z1e[0x81A];
  result = 5 * v5;
  *(_DWORD *)&a1->z1e[0xA * v5 + 0x5A0] = a4;
  ++*(_WORD *)&a1->z1e[0x81A];
  return result;
}

//----- (00056BE8) --------------------------------------------------------
void __fastcall sub_56BE8(P_Type3 a1, __int16 a2, int a3, int a4, int a5)
{
  int v6; // edx
  __int16 v7; // si
  int v8; // ecx
  int v9; // eax
  T_TypeA1 *v10; // eax
  unsigned int v11; // edx
  __int16 v13; // [esp+Ch] [ebp-4h]

  v6 = *(__int16 *)&a1->z1e[0x596];
  if ( v6 >= 0 )
  {
    v7 = 0x1F;
    v8 = 0;
    v13 = *(_WORD *)&a1->Unknown_305E[0x8E * v6 + 6];
    while ( v13 > 0 && !v8 )
    {
      v8 = 0;
      if ( v7 < 0 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x9EA);
      }
      v9 = *(_DWORD *)&a1->Unknown_305E[0x8E * *(__int16 *)&a1->z1e[0x596] + 8 + 4 * v7];
      if ( v9 )
      {
        v10 = a1->wnds[v9].a1;
        if ( !a5 || byte_132B38[v7] )
        {
          if ( (v10->i || a2 == 1 || a2 == 0xE) && (!v10->parentIndex || a2 > 2) )
          {
            v11 = 0xFFFFFFFF;
          }
          else
          {
            v11 = 0;
          }
          if ( v11 )
          {
            if ( a5 )
            {
              byte_132B38[v7] = 1;
            }
            v8 = (*(int (**)(void))(v10[1].magic12345678 + 8))();
          }
          else if ( a5 )
          {
            byte_132B38[v7] = 0;
          }
        }
        --v13;
      }
      --v7;
    }
  }
}

//----- (00056D30) --------------------------------------------------------
int __fastcall sub_56D30(P_Type3 a1, int a2, int a3, int a4, int a5)
{
  if ( *(__int16 *)&a1->z1e[0x596] >= 0 )
  {
    return (*(int (**)(void))(a1->wnds[a2].a1[1].magic12345678 + 8))();
  }
  else
  {
    return 0;
  }
}

//----- (00056D70) --------------------------------------------------------
T_TypeA1 *__fastcall sub_56D70(T_Type3 *a1, char *a2, __int16 a3, int a4, int a5)
{
  T_TypeA1 *result; // eax
  int v7; // [esp+0h] [ebp-Eh] BYREF

  result = Q_FindWnd_sub_56DA8(a1, a2, (_WORD *)&v7 + 1);
  if ( result )
  {
    sub_56D30(a1, SHIWORD(v7), a3, a4, a5);
    return (T_TypeA1 *)0xFFFFFFFF;
  }
  return result;
}

//----- (00056DA8) --------------------------------------------------------
T_TypeA1 *__fastcall Q_FindWnd_sub_56DA8(P_Type3 eax0, char *name, _WORD *a3)
{
  WORD j; // si
  __int16 i; // cx
  T_TypeA1 *a1; // edx

  j = 0;
  for ( i = 0; ; ++i )
  {
    if ( i >= 1024 || j > eax0->wndCnt )
    {
      return 0;
    }
    a1 = eax0->wnds[i].a1;
    if ( a1 )
    {
      ++j;
      if ( !strncmp(name, a1->name, 10u) )
      {
        break;
      }
    }
  }
  if ( a3 )
  {
    *a3 = i;
  }
  return eax0->wnds[i].a1;
}

//----- (00056E18) --------------------------------------------------------
T_TypeA1 *__fastcall sub_56E18(P_Type3 eax0, char *s1, __int16 a3, _WORD *a4)
{
  __int16 i; // cx
  __int16 *v7; // eax
  int v8; // edi
  T_TypeA1 *a1; // edx

  if ( a3 < *(__int16 *)&eax0->z1e[0x594] )
  {
    for ( i = 0; ; ++i )
    {
      v7 = (__int16 *)((char *)eax0 + 0x8E * a3);
      if ( i >= v7[0x1834] )
      {
        break;
      }
      v8 = *(_DWORD *)&v7[2 * i + 0x1835];
      a1 = eax0->wnds[v8].a1;
      if ( a1 && !strncmp(s1, a1->name, 0xAu) )
      {
        if ( a4 )
        {
          *a4 = v8;
        }
        return eax0->wnds[v8].a1;
      }
    }
  }
  return 0;
}

//----- (00056E9C) --------------------------------------------------------
P_Type3 __fastcall sub_56E9C(P_Type3 a1, __int16 a2, int a3)
{
  P_Type3 v3; // esi
  int v5; // ebx
  int v6; // edx
  int v7; // edx
  int v8; // ebx
  int v9; // eax
  __int16 v10; // ax
  int v11; // eax
  int v12; // eax

  v3 = a1;
  if ( a2 != *(_WORD *)&a1->z1e[0x596] )
  {
    if ( a2 < 0 || a2 >= 0x20 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xA9B);
    }
    v5 = *(__int16 *)&a1->z1e[0x596];
    if ( v5 >= 0 )
    {
      v6 = *(__int16 *)&a1->Unknown_305E[0x8E * v5 + 4];
      if ( v6 != 0xFFFFFFFF )
      {
        sub_4F45C((int)&V_SoundSystem, v6);
      }
    }
    v7 = *(__int16 *)&v3->Unknown_305E[0x8E * a2 + 4];
    if ( v7 != 0xFFFFFFFF )
    {
      sub_4F32C((int)&V_SoundSystem, v7, 0);
    }
    v8 = *(__int16 *)&v3->z1e[0x596];
    if ( v8 >= 0 && *(_DWORD *)&v3->z1d[v8][4] )
    {
      (*(void (__fastcall **)(_DWORD, char *))&v3->z1d[v8][4])(
        *(__int16 *)&v3->z1e[0x596],
        &v3->Unknown_305E[0x8E * v8 + 4]);
    }
    v9 = *(_DWORD *)v3->z1aa;
    if ( v9 != 0xFFFFFFFF )
    {
      sub_56D30(v3, v9, 6, 0, 0);
    }
    sub_56BE8(v3, 2, 0, 0, 0);
    if ( a3 == 0xFFFFFFFF && *(__int16 *)&v3->z1e[0x596] >= 0 )
    {
      v10 = *(_WORD *)&v3->z2[0x22];
      *(_WORD *)&v3->z2[0x22] = v10 + 1;
      *(_WORD *)&v3->z2[2 * v10] = *(_WORD *)&v3->z1e[0x596];
      if ( *(_WORD *)&v3->z2[0x22] == 0x10 )
      {
        *(_WORD *)&v3->z2[0x22] = 0;
      }
      ++*(_WORD *)&v3->z2[0x20];
    }
    *(_WORD *)&v3->z1e[0x596] = a2;
    if ( !*(_WORD *)&v3->z1e[0x596] && dword_96BC0 == 0xFFFFFFFF && !access("resume.gam", 0) )
    {
      Q_LoadGam_sub_53FB0("resume.gam");
    }
    v11 = *(_DWORD *)&v3->z1aa[4];
    dword_96BC0 = 0;
    sub_5B71C(v11);
    sub_55214(v3, 0, 0, 0x27F, 0x1DF);
    v12 = a2;
    if ( *(_DWORD *)&v3->z1d[v12][0] )
    {
      (*(void (__fastcall **)(_DWORD, char *))&v3->z1d[v12][0])(a2, &v3->Unknown_305E[v12 * 0x8E + 4]);
    }
    sub_56BE8(v3, 1, 0, 0, 0);
    *(_DWORD *)v3->z1aa = 0xFFFFFFFF;
    return (P_Type3)sub_5691C((int)v3);
  }
  return a1;
}
// 96BC0: using guessed type int dword_96BC0;

//----- (000570AC) --------------------------------------------------------
int __fastcall sub_570AC(int a1, int a2)
{
  __int16 v4; // dx
  int v5; // ecx

  if ( !*(_WORD *)(a1 + 0x4756) )
  {
    return 0;
  }
  if ( *(_WORD *)(a1 + 0x4758) )
  {
    v4 = *(_WORD *)(a1 + 0x4758) - 1;
  }
  else
  {
    v4 = 0xF;
  }
  v5 = v4;
  LOWORD(v5) = *(_WORD *)(a1 + 2 * v4 + 0x4736);
  if ( a2 == 0xFFFFFFFF )
  {
    *(_WORD *)(a1 + 0x4758) = v4;
    *(_WORD *)(a1 + 2 * *(__int16 *)(a1 + 0x4758) + 0x4736) = 0xFFFF;
    --*(_WORD *)(a1 + 0x4756);
    sub_56E9C((P_Type3)a1, v5, 0);
  }
  return v5;
}

//----- (000571B8) --------------------------------------------------------
int __fastcall Q_WINMGR_CPP_RegisterWindow_sub_571B8(P_Type3 a1, P_TypeA1 a2)
{
  __int16 i; // dx
  int result; // eax
  T_Type14 *v6; // ebx

  if ( !a2 || a1->wndCnt == 1023 )
  {
    return 0;
  }
  for ( i = 1; ; ++i )
  {
    result = i;
    if ( i >= 1024 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xB37);
    }
    v6 = &a1->wnds[i];
    if ( !v6->a )
    {
      break;
    }
  }
  v6->a = 1;
  v6->a1 = a2;
  ++a1->wndCnt;
  a2->magic12345678 = 0x12345678;
  return result;
}

//----- (00057220) --------------------------------------------------------
unsigned int __fastcall sub_57220(P_Type3 a1, int a2, __int16 a3)
{
  char *v6; // edx
  __int16 v8; // ax
  char *v9; // ebx
  char *v10; // edx

  if ( a3 < 0 || a3 >= 0x20 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xB42);
  }
  if ( a2 >= 0x400 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xB43);
  }
  if ( !a2 )
  {
    return 0;
  }
  v6 = (char *)a1 + 0x8E * a3;
  if ( *((_WORD *)v6 + 0x1834) == 0x20 )
  {
    return 0;
  }
  v8 = 0;
  if ( *((_WORD *)v6 + 0x1834) )
  {
    while ( v8 < 0x20 )
    {
      v9 = (char *)a1 + 0x8E * a3;
      v10 = &v9[4 * v8];
      if ( !*(_DWORD *)(v10 + 0x306A) )
      {
        *(_DWORD *)(v10 + 0x306A) = a2;
        ++*((_WORD *)v9 + 0x1834);
        break;
      }
      ++v8;
    }
  }
  else
  {
    ++*(_WORD *)&a1->z1e[0x594];
    *((_WORD *)v6 + 0x1834) = 1;
    *(_DWORD *)(v6 + 0x306A) = a2;
  }
  ++a1->wnds[a2].a;
  if ( v8 >= 0x20 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xB65);
  }
  return 0xFFFFFFFF;
}

//----- (00057310) --------------------------------------------------------
unsigned int __fastcall sub_57310(P_Type3 a1, int a2, __int16 a3, int a4)
{
  __int16 i; // cx
  char *v9; // edx
  char *v10; // eax
  int v11; // ebx

  if ( a3 < 0 || a3 >= 0x20 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xB75);
  }
  if ( a2 >= 0x400 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xB76);
  }
  if ( !a2 || !*(_WORD *)&a1->Unknown_305E[0x8E * a3 + 6] )
  {
    return 0;
  }
  for ( i = 0; i < 0x20; ++i )
  {
    v9 = (char *)a1 + 0x8E * a3;
    v10 = &v9[4 * i];
    v11 = *(_DWORD *)(v10 + 0x306A);
    if ( a2 == v11 )
    {
      *(_DWORD *)(v10 + 0x306A) = 0;
      --*((_WORD *)v9 + 0x1834);
      --a1->wnds[v11].a;
      if ( a4 )
      {
        sub_57530((int)a1, a2, 0);
      }
      break;
    }
  }
  if ( i < 0x20 )
  {
    return 0xFFFFFFFF;
  }
  else
  {
    return 0;
  }
}

//----- (0005748C) --------------------------------------------------------
unsigned int __fastcall sub_5748C(int a1, __int16 a2, __int16 a3)
{
  int v3; // esi
  unsigned int result; // eax

  if ( a2 < 0 || a2 >= 0x20 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xBA8);
  }
  v3 = 0x8E * a2 + a1;
  if ( *(unsigned __int16 *)(v3 + 0x30EA) != 0xFFFF )
  {
    return 0;
  }
  result = 0xFFFFFFFF;
  *(_WORD *)(v3 + 0x30EA) = a3;
  return result;
}

//----- (000574F0) --------------------------------------------------------
void __fastcall Q_SetProc1_sub_574F0(P_Type3 a1, __int16 index, void *proc)
{
  *(_DWORD *)&a1->z1d[index][0] = proc;
}

//----- (00057510) --------------------------------------------------------
void __fastcall Q_SetProc2_sub_57510(P_Type3 a1, __int16 index, void *proc)
{
  *(_DWORD *)&a1->z1d[index][4] = proc;
}

//----- (00057530) --------------------------------------------------------
int __fastcall sub_57530(int result, int a2, int a3)
{
  int v3; // esi
  int v5; // edx
  int v6; // edx
  int v7; // eax

  v3 = result;
  if ( a2 >= 0x400 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xBDB);
  }
  if ( a2 )
  {
    result = 3 * a2;
    v5 = *(_DWORD *)(v3 + 0xC * a2) - 1;
    *(_DWORD *)(v3 + 0xC * a2) = v5;
    if ( !v5 || a3 )
    {
      v6 = v3 + 0xC * a2;
      sub_2627C(*(void **)(v6 + 4));
      v7 = *(_DWORD *)(v6 + 4);
      if ( v7 )
      {
        (**(void (***)(void))(v7 + 0xA7))();
      }
      result = 3 * a2;
      *(_DWORD *)(v3 + 4 * result + 4) = 0;
      *(_DWORD *)(v3 + 4 * result) = 0;
      --*(_WORD *)(v3 + 0x3000);
    }
  }
  return result;
}

//----- (000575BC) --------------------------------------------------------
FILE *__fastcall sub_575BC(P_Type3 a1)
{
  void *v2; // eax
  T_HazeTable *v3; // ecx
  _BYTE *v4; // edx
  int i; // eax
  void *v6; // eax
  T_HazeTable *v7; // ecx
  _BYTE *v8; // edx
  int j; // eax

  v2 = operator new[](0x100u);
  Q_RegisterData_sub_2625C(v2, 1, "WMGR MAPFOCUS");
  v3 = (T_HazeTable *)v2;
  if ( !v2 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xBF7);
  }
  v4 = v2;
  for ( i = 0; i < 0x100; ++i )
  {
    *v4++ = i;
  }
  (*v3)[0xF2] = 0x96;
  a1->hazeTableMapFocus = v3;
  v6 = operator new[](0x100u);
  Q_RegisterData_sub_2625C(v6, 1, "WMGR MAPRACES");
  v7 = (T_HazeTable *)v6;
  if ( !v6 )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xC01);
  }
  v8 = v6;
  for ( j = 0; j < 0x100; ++j )
  {
    *v8++ = j;
  }
  a1->hazeTableMapRaces = v7;
  *(_DWORD *)&a1->z1aa[4] = sub_5B617(0x80u);
  return Q_WINMGR_CPP_LoadWindowsTxt_sub_57670(a1, "windows.txt");
}

//----- (00057670) --------------------------------------------------------
FILE *__fastcall Q_WINMGR_CPP_LoadWindowsTxt_sub_57670(P_Type3 a1, const char *a2)
{
  FILE *result; // eax
  FILE *v4; // esi
  int largestMem; // ecx
  char *v6; // ebx
  T_TypeA1 *v7; // eax
  int v8; // edx
  char *v9; // ecx
  T_TypeA1 *v10; // edx
  char *v11; // ebp
  T_TypeA1 *v12; // ecx
  T_TypeA1 *v13; // edx
  __int16 mm; // cx
  P_TypeA1 v15; // edx
  __int16 v16; // ax
  P_TypeA1 v17; // edx
  P_TypeA1 v18; // edx
  int y; // ecx
  _BYTE *v20; // ebp
  int v21; // ebx
  T_TypeA9 *v22; // eax
  int v23; // ebp
  char *name; // edx
  T_TypeA1 *Wnd_sub_56DA8; // eax
  int i; // ecx
  int v27; // ebx
  int j; // ecx
  WINDOW *window; // eax
  WORD racesNum; // dx
  int v31; // eax
  WORD v32; // bx
  char v33; // dh
  T_TypeA3 *v34; // eax
  T_TypeA3 *v35; // ebp
  char *v36; // edx
  T_TypeA1 *v37; // eax
  __int16 k; // cx
  __int16 v39; // ax
  T_TypeA2 *v40; // eax
  int v41; // ebp
  char *v42; // edx
  T_TypeA1 *v43; // eax
  int ii; // ecx
  WINDOW *v45; // eax
  __int16 jj; // cx
  __int16 v47; // ax
  T_TypeA2 *v48; // eax
  T_TypeA1 *p_a1; // ebp
  char *v50; // edx
  T_TypeA1 *v51; // eax
  int kk; // ecx
  __int16 v53; // ax
  signed __int16 l; // cx
  unsigned __int16 v55; // bx
  T_TypeA2 *v56; // eax
  T_TypeA2 *v57; // ecx
  WINDOW *v58; // eax
  T_TypeA1 *v59; // eax
  T_TypeA1 *v60; // ebp
  char *v61; // edx
  T_TypeA1 *v62; // eax
  T_TypeA1 *v63; // eax
  char *v64; // edx
  int v65; // ebp
  T_TypeA1 *v66; // eax
  int v67; // [esp-Ch] [ebp-3C8h]
  int v68; // [esp-Ch] [ebp-3C8h]
  int v69; // [esp-4h] [ebp-3C0h]
  int v70; // [esp-4h] [ebp-3C0h]
  char v71[108]; // [esp+0h] [ebp-3BCh] BYREF
  char v72[108]; // [esp+80h] [ebp-33Ch] BYREF
  char bufc2[108]; // [esp+100h] [ebp-2BCh] BYREF
  char v74[108]; // [esp+180h] [ebp-23Ch] BYREF
  char v75[108]; // [esp+200h] [ebp-1BCh] BYREF
  char v76[108]; // [esp+280h] [ebp-13Ch] BYREF
  char v77[32]; // [esp+300h] [ebp-BCh] BYREF
  char bufc1[32]; // [esp+334h] [ebp-88h] BYREF
  _WORD v79[8]; // [esp+368h] [ebp-54h] BYREF
  int bufi; // [esp+378h] [ebp-44h] BYREF
  P_TypeA1 a1a; // [esp+37Ch] [ebp-40h]
  int v82; // [esp+380h] [ebp-3Ch]
  P_Type13 p_t13; // [esp+384h] [ebp-38h]
  P_Type13 v84; // [esp+388h] [ebp-34h]
  void **z1ccc; // [esp+38Ch] [ebp-30h]
  void **v86; // [esp+390h] [ebp-2Ch]
  _BYTE *v87; // [esp+394h] [ebp-28h]
  _BYTE *v88; // [esp+398h] [ebp-24h]
  int m; // [esp+39Ch] [ebp-20h]
  int v90; // [esp+3A0h] [ebp-1Ch] BYREF
  int v91; // [esp+3A4h] [ebp-18h] BYREF
  __int16 v92; // [esp+3A8h] [ebp-14h]
  int v93; // [esp+3ACh] [ebp-10h]
  int v94; // [esp+3B0h] [ebp-Ch]
  __int16 numControls; // [esp+3B4h] [ebp-8h] BYREF
  WORD n; // [esp+3B8h] [ebp-4h]

  result = Q_OpenFile_sub_1BB10(a2, 0);
  v4 = result;
  if ( result )
  {
    fscanf(result, "%s %d", bufc1, &bufi);
    largestMem = Q_CheckFreeMemory_sub_53DEC();
    if ( largestMem <= bufi )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xC27);
    }
    Q_CACHE_CPP_ShapeCache_sub_1AD1C(&a1->t13, largestMem - 200000);
    Q_GWINDOW_CPP_LoadGwshareTxt_sub_2D2CC();
    p_t13 = &a1->t13;
    v86 = (void **)&a1->z1cc[4];
    v84 = &a1->t13;
    z1ccc = (void **)a1->z1ccc;
    while ( 1 )
    {
      fscanf(v4, "%s %d", bufc1, &bufi);
      if ( bufi == 0xFFFFFFFF )
      {
        return (FILE *)fclose(v4);
      }
      v92 = bufi;
      if ( (unsigned int)bufi < 9 )
      {
        if ( (unsigned int)bufi < 3 )
        {
          if ( !bufi )
          {
            goto LABEL_16;
          }
          if ( (unsigned int)bufi <= 1 )
          {
            v22 = (T_TypeA9 *)operator new(0xA09u);
            if ( v22 )
            {
              sub_2AE80(v22);
            }
            Q_RegisterData_sub_2625C(v22, 2, "FLIC");
            v23 = (int)v22;
            name = v22->a.a1.name;
            Q_WINMGR_CPP_RegisterWindow_sub_2C978(&v22->a.a1);
            fscanf(v4, "%s %s", bufc1, name);
            fscanf(v4, "%s", bufc1);
            fscanf(v4, "%s", bufc1);
            if ( strcmp(bufc1, "NONE") )
            {
              Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(a1, bufc1, 0);
              if ( !Wnd_sub_56DA8 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xCF8);
              }
              *(_DWORD *)(v23 + 0x63) = Wnd_sub_56DA8->index;
              Q_GWINDOW_CPP_LinkChild_sub_2C990(Wnd_sub_56DA8, (P_TypeA1)v23);
            }
            fscanf(v4, "%s %d", bufc1, &v90);
            for ( i = 0; (__int16)i < (__int16)v90; ++i )
            {
              fscanf(v4, "%d", &bufi);
              if ( !sub_57220(a1, *(_DWORD *)(v23 + 0x41), bufi) )
              {
                Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xD02);
              }
            }
            fscanf(v4, "%s %d", bufc1, v23 + 8);
            fscanf(v4, "%s %d", bufc1, v23 + 0xC);
            fscanf(v4, "%s %d", bufc1, v23 + 0x10);
            fscanf(v4, "%s %d", bufc1, v23 + 0x14);
            fscanf(v4, "%s %s", bufc1, v76);
            sub_2AF04(v23, v76);
            fscanf(v4, "%s %d", bufc1, &bufi);
            *(_WORD *)(v23 + 0xA01) = bufi;
            fscanf(v4, "%s %d", bufc1, &bufi);
            *(_WORD *)(v23 + 0xA03) = bufi;
            fscanf(v4, "%s %d", bufc1, &bufi);
            *(_WORD *)(v23 + 0xA05) = bufi;
            fscanf(v4, "%s %d", bufc1, &bufi);
            *(_WORD *)(v23 + 0xA07) = bufi;
            fscanf(v4, "%s %d", bufc1, &bufi);
            v27 = bufi;
            if ( bufi != 0xFFFFFFFF )
            {
              *(_DWORD *)(v23 + 0x9E5) = 0xFFFFFFFF;
              *(_DWORD *)(v23 + 0x9E9) = v27;
            }
            fscanf(v4, "%s %d", bufc1, v23 + 0x45);
            fscanf(v4, "%s %d", bufc1, v23 + 0x47);
            fscanf(v4, "%s %d", bufc1, v23 + 0x4B);
            fscanf(v4, "%s %s", bufc1, v23 + 0x4F);
            fscanf(v4, "%s %d", bufc1, &bufi);
            *(_WORD *)(v23 + 0x9F5) = bufi;
            fscanf(v4, "%s %d", bufc1, &bufi);
            if ( bufi )
            {
              *(_DWORD *)(v23 + 0x9F1) = 0xFFFFFFFF;
            }
            *(_DWORD *)(v23 + 4) = a1->window;
          }
          else
          {
            v63 = (T_TypeA1 *)operator new(0x596u);
            if ( v63 )
            {
              v63 = (T_TypeA1 *)sub_224A4((int)v63);
            }
            Q_RegisterData_sub_2625C(v63, 2, "COSW");
            v64 = v63->name;
            v65 = (int)v63;
            Q_WINMGR_CPP_RegisterWindow_sub_2C978(v63);
            dword_96BAC = *(_DWORD *)(v64 + 0x21);
            fscanf(v4, "%s %s", bufc1, v64);
            fscanf(v4, "%s", bufc1);
            fscanf(v4, "%s", bufc1);
            if ( strcmp(bufc1, "NONE") )
            {
              v66 = Q_FindWnd_sub_56DA8(a1, bufc1, 0);
              if ( !v66 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xD41);
              }
              *(_DWORD *)(v65 + 0x63) = v66->index;
              Q_GWINDOW_CPP_LinkChild_sub_2C990(v66, (P_TypeA1)v65);
            }
            fscanf(v4, "%s %d", bufc1, &v90);
            for ( j = 0; (__int16)j < (__int16)v90; ++j )
            {
              fscanf(v4, "%d", &bufi);
              if ( !sub_57220(a1, *(_DWORD *)(v65 + 0x41), bufi) )
              {
                Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xD4B);
              }
            }
            fscanf(v4, "%s %d", bufc1, v65 + 8);
            fscanf(v4, "%s %d", bufc1, v65 + 0xC);
            fscanf(v4, "%s %d", bufc1, v65 + 0x10);
            fscanf(v4, "%s %d", bufc1, v65 + 0x14);
            fscanf(v4, "%s %d", bufc1, &bufi);
            *(_BYTE *)(v65 + 0xBF) = bufi;
            fscanf(v4, "%s %s", bufc1, v71);
            fscanf(v4, "%s %s", bufc1, v72);
            Q_COSWND_CPP_sub_22644(v65, v71, v72);
            fscanf(v4, "%s %d", bufc1, &bufi);
            fscanf(v4, "%s %d", bufc1, &v91);
            fscanf(v4, "%s %d", bufc1, &bufi);
            fscanf(v4, "%s %d", bufc1, &bufi);
            fscanf(v4, "%s %d", bufc1, &bufi);
            fscanf(v4, "%s %d", bufc1, &bufi);
            fscanf(v4, "%s %d", bufc1, &bufi);
            *(_DWORD *)(v65 + 0x57E) = bufi;
            fscanf(v4, "%s %d", bufc1, v65 + 0x45);
            fscanf(v4, "%s %d", bufc1, v65 + 0x47);
            fscanf(v4, "%s %d", bufc1, v65 + 0x4B);
            fscanf(v4, "%s %s", bufc1, v65 + 0x4F);
            window = a1->window;
            *(_WORD *)(v65 + 0x18) = 0xFFFF;
            *(_DWORD *)(v65 + 0x1A) = 0;
            racesNum = V_Game.racesNum;
            *(_BYTE *)(v65 + 0xD9) = 0;
            *(_DWORD *)(v65 + 4) = window;
            v31 = 0;
            if ( racesNum > 0 )
            {
              do
              {
                v32 = V_Game.racesNum;
                v33 = (1 << v31++) | *(_BYTE *)(v65 + 0xD9);
                *(_BYTE *)(v65 + 0xD9) = v33;
              }
              while ( (__int16)v31 < v32 );
            }
          }
        }
        else if ( (unsigned int)bufi <= 3 )
        {
          v34 = (T_TypeA3 *)operator new(0xB3u);
          if ( v34 )
          {
            Q_A3_sub_2D9C4(v34);
          }
          Q_RegisterData_sub_2625C(v34, 2, "CTW");
          v35 = v34;
          v36 = v34->a2.a1.name;
          Q_WINMGR_CPP_RegisterWindow_sub_2DA68(&v34->a2.a1);
          fscanf(v4, "%s %s", bufc1, v36);             // NAME = RACECONTROLS
          fscanf(v4, "%s", bufc1);                     // PARENT
          fscanf(v4, "%s", bufc1);
          if ( strcmp(bufc1, "NONE") )
          {
            v37 = Q_FindWnd_sub_56DA8(a1, bufc1, 0);
            if ( !v37 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xD8D);
            }
            v35->a2.a1.parentIndex = v37->index;
            Q_GWINDOW_CPP_LinkChild_sub_2C990(v37, &v35->a2.a1);
          }
          fscanf(v4, "%s %d", bufc1, &v90);            // STATE
          for ( k = 0; k < (__int16)v90; ++k )
          {
            fscanf(v4, "%d", &bufi);
            if ( !sub_57220(a1, v35->a2.a1.index, bufi) )
            {
              Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xD97);
            }
            if ( !k )
            {
              v39 = *(_WORD *)&a1->Unknown_305E[0x8E * bufi + 0x88];
              v35->a2.a1.e = 0;
              v35->a2.a1.d = v39;
            }
          }
          fscanf(v4, "%s %d", bufc1, &v35->a2.a1.pane.x0);
          fscanf(v4, "%s %d", bufc1, &v35->a2.a1.pane.y0);
          fscanf(v4, "%s %d", bufc1, &v35->a2.a1.pane.x1);
          fscanf(v4, "%s %d", bufc1, &v35->a2.a1.pane.y1);
          fscanf(v4, "%s %d", bufc1, &bufi);
          v35->a2.a1.shapeFrame = bufi;
          v35->a2.a1.r = 0;
          fscanf(v4, "%s %d", bufc1, &v35->a2.a1.sendMessage);
          fscanf(v4, "%s %d", bufc1, &v35->a2.a1.sendParam1);
          fscanf(v4, "%s %d", bufc1, &v35->a2.a1.sendParam2);
          fscanf(v4, "%s %s", bufc1, v35->a2.a1.helpIndex);
          v35->a2.a1.pane.window = a1->window;
          fscanf(v4, "%s %d", bufc1, &numControls);    // NUMCONTROLS
          if ( sub_2DA80(v35, numControls) == FALSE )
          {
            Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xDB9);
          }
          for ( m = 0; (__int16)m < numControls; ++m )
          {
            fscanf(v4, "%s %d", bufc1, &bufi);
            v79[0] = bufi;
            fscanf(v4, "%d", &bufi);
            v79[1] = bufi;
            fscanf(v4, "%d", &bufi);
            v79[3] = bufi;
            fscanf(v4, "%d", &bufi);
            v79[2] = bufi;
            fscanf(v4, "%d", &bufi);
            v79[4] = bufi;
            fscanf(v4, "%d", &bufi);
            v79[5] = bufi;
            fscanf(v4, "%d", &bufi);
            v79[6] = bufi;
            if ( !sub_2DAC8(v35, 0, 0, (int)v79) )
            {
              Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xDD4);
            }
          }
          for ( n = 0; n < V_Game.racesNum; ++n )
          {
            sub_2DAC8(v35, 1 << n, 1, 0);
          }
        }
        else if ( (unsigned int)bufi < 5 )
        {
          v40 = (T_TypeA2 *)operator new(0x504Eu);
          if ( v40 )
          {
            v40 = (T_TypeA2 *)sub_15ED4(v40);
          }
          Q_RegisterData_sub_2625C(v40, 2, "BM");
          v41 = (int)v40;
          v42 = v40->a1.name;
          Q_WINMGR_CPP_RegisterWindow_sub_2C978(&v40->a1);
          fscanf(v4, "%s %s", bufc1, v42);
          fscanf(v4, "%s", bufc1);
          fscanf(v4, "%s", bufc1);
          if ( strcmp(bufc1, "NONE") )
          {
            v43 = Q_FindWnd_sub_56DA8(a1, bufc1, 0);
            if ( !v43 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xDE9);
            }
            *(_DWORD *)(v41 + 0x63) = v43->index;
            Q_GWINDOW_CPP_LinkChild_sub_2C990(v43, (P_TypeA1)v41);
          }
          fscanf(v4, "%s %d", bufc1, &v90);
          for ( ii = 0; (__int16)ii < (__int16)v90; ++ii )
          {
            fscanf(v4, "%d", &bufi);
            if ( !sub_57220(a1, *(_DWORD *)(v41 + 0x41), bufi) )
            {
              Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xDF3);
            }
          }
          fscanf(v4, "%s %d", bufc1, v41 + 8);
          fscanf(v4, "%s %d", bufc1, v41 + 0xC);
          fscanf(v4, "%s %d", bufc1, v41 + 0x10);
          fscanf(v4, "%s %d", bufc1, v41 + 0x14);
          fscanf(v4, "%s %d", bufc1, &bufi);
          *(_BYTE *)(v41 + 0x4F2E) = bufi;
          fscanf(v4, "%s %d", bufc1, &bufi);
          *(_DWORD *)(v41 + 0xB8) = bufi;
          sub_18370(v41);
          fscanf(v4, "%s %d", bufc1, v41 + 0x45);
          fscanf(v4, "%s %d", bufc1, v41 + 0x47);
          fscanf(v4, "%s %d", bufc1, v41 + 0x4B);
          fscanf(v4, "%s %s", bufc1, v41 + 0x4F);
          v45 = a1->window;
          *(_WORD *)(v41 + 0x18) = 0xFFFF;
          *(_DWORD *)(v41 + 0x1A) = 0;
          *(_DWORD *)(v41 + 4) = v45;
        }
        else
        {
          if ( (unsigned int)bufi <= 7 )
          {
            goto LABEL_16;
          }
          v59 = (T_TypeA1 *)operator new(0x237u);
          if ( v59 )
          {
            v59 = (T_TypeA1 *)sub_4D92C((int)v59);
          }
          Q_RegisterData_sub_2625C(v59, 2, "SW");
          v60 = v59;
          v61 = v59->name;
          Q_WINMGR_CPP_RegisterWindow_sub_2C978(v59);
          fscanf(v4, "%s %s", bufc1, v61);
          fscanf(v4, "%s", bufc1);
          fscanf(v4, "%s", bufc1);
          if ( strcmp(bufc1, "NONE") )
          {
            v62 = Q_FindWnd_sub_56DA8(a1, bufc1, 0);
            if ( !v62 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xE21);
            }
            v60->parentIndex = v62->index;
            Q_GWINDOW_CPP_LinkChild_sub_2C990(v62, v60);
          }
          fscanf(v4, "%s %d", bufc1, &v90);
          for ( jj = 0; jj < (__int16)v90; ++jj )
          {
            fscanf(v4, "%d", &bufi);
            if ( !sub_57220(a1, v60->index, bufi) )
            {
              Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xE2B);
            }
            if ( !jj )
            {
              v47 = *(_WORD *)&a1->Unknown_305E[0x8E * bufi + 0x88];
              v60->e = 0;
              v60->d = v47;
            }
          }
          fscanf(v4, "%s %d", bufc1, &bufi);
          if ( bufi )
          {
            v60->k = 0xFFFFFFFF;
          }
          fscanf(v4, "%s %d", bufc1, &v60->pane.x0);
          fscanf(v4, "%s %d", bufc1, &v60->pane.y0);
          fscanf(v4, "%s %d", bufc1, &v60->pane.x1);
          fscanf(v4, "%s %d", bufc1, &v60->pane.y1);
          fscanf(v4, "%s %d", bufc1, &bufi);
          v60->r = bufi;
          fscanf(v4, "%s %d", bufc1, &v60->sendMessage);
          fscanf(v4, "%s %d", bufc1, &v60->sendParam1);
          fscanf(v4, "%s %d", bufc1, &v60->sendParam2);
          fscanf(v4, "%s %s", bufc1, v60->helpIndex);
          v60->pane.window = a1->window;
        }
      }
      else
      {
        if ( (unsigned int)bufi <= 9 )
        {
          goto LABEL_16;
        }
        if ( (unsigned int)bufi < 0xE )
        {
          if ( (unsigned int)bufi < 0xB )
          {
            v48 = (T_TypeA2 *)operator new(0x902u);
            if ( v48 )
            {
              v48 = sub_2E248(v48);
            }
            Q_RegisterData_sub_2625C(v48, 2, "LB");
            p_a1 = &v48->a1;
            v50 = v48->a1.name;
            Q_WINMGR_CPP_RegisterWindow_sub_2E3BC(&v48->a1);
            fscanf(v4, "%s %s", bufc1, v50);
            fscanf(v4, "%s", bufc1);
            fscanf(v4, "%s", bufc1);
            if ( strcmp(bufc1, "NONE") )
            {
              v51 = Q_FindWnd_sub_56DA8(a1, bufc1, 0);
              if ( !v51 )
              {
                Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xE5E);
              }
              p_a1->parentIndex = v51->index;
              Q_GWINDOW_CPP_LinkChild_sub_2C990(v51, p_a1);
            }
            fscanf(v4, "%s %d", bufc1, &v90);
            for ( kk = 0; (__int16)kk < (__int16)v90; ++kk )
            {
              fscanf(v4, "%d", &bufi);
              if ( !sub_57220(a1, p_a1->index, bufi) )
              {
                Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xE68);
              }
            }
            fscanf(v4, "%s %d", bufc1, &bufi);
            if ( bufi )
            {
              p_a1->k = 0xFFFFFFFF;
            }
            fscanf(v4, "%s %d", bufc1, &p_a1->pane.x0);
            fscanf(v4, "%s %d", bufc1, &p_a1->pane.y0);
            fscanf(v4, "%s %d", bufc1, &p_a1->pane.x1);
            fscanf(v4, "%s %d", bufc1, &p_a1->pane.y1);
            fscanf(v4, "%s %d", bufc1, &bufi);
            p_a1->shapeFrame = bufi;
            fscanf(v4, "%s %d", bufc1, &bufi);
            p_a1->r = bufi;
            fscanf(v4, "%s %d", bufc1, &p_a1->sendMessage);
            fscanf(v4, "%s %d", bufc1, &p_a1->sendParam1);
            fscanf(v4, "%s %d", bufc1, &p_a1->sendParam2);
            fscanf(v4, "%s %s", bufc1, p_a1->helpIndex);
            p_a1->pane.window = a1->window;
          }
          else
          {
            if ( (unsigned int)bufi <= 0xC )
            {
              goto LABEL_16;
            }
            v56 = (T_TypeA2 *)operator new(0xC0u);
            if ( v56 )
            {
              v56 = sub_5A594(v56);
            }
            Q_RegisterData_sub_2625C(v56, 2, "DBGWND");
            v57 = v56;
            if ( !v56 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xE8E);
            }
            Q_WINMGR_CPP_RegisterWindow_sub_5A5F4(&v56->a1);
            *(_DWORD *)&a1->z4[0x1D4D0] = v57;
            fscanf(v4, "%s %s", bufc1, v57->a1.name);
            fscanf(v4, "%s %d", bufc1, &v57->a1.pane.x0);
            fscanf(v4, "%s %d", bufc1, &v57->a1.pane.y0);
            fscanf(v4, "%s %d", bufc1, &v57->a1.pane.x1);
            fscanf(v4, "%s %d", bufc1, &v57->a1.pane.y1);
            fscanf(v4, "%s %d", bufc1, &v57[1].a1.pane);
            fscanf(v4, "%s %d", bufc1, &v57[1].a1.pane.x0);
            fscanf(v4, "%s %d", bufc1, &v57[1].a1.pane.y0);
            fscanf(v4, "%s %d", bufc1, &v57[1].a1.pane.x1);
            fscanf(v4, "%s %s", bufc1, v77);
            v57->a1.d = sub_1ADAC(p_t13, v77);
            v58 = a1->window;
            v57->a1.pane.window = v58;
            v57[1].a1.magic12345678 = (int)v58;
          }
        }
        else
        {
          if ( (unsigned int)bufi <= 0x1B )
          {
            goto LABEL_16;
          }
          if ( (unsigned int)bufi < 0x64 )
          {
            if ( (unsigned int)bufi < 0x1D || (unsigned int)bufi > 0x20 )
            {
LABEL_262:
              Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xEF2);
            }
LABEL_16:
            if ( bufi )
            {
              switch ( bufi )
              {
                case 5:
                  v6 = "RW";
                  v7 = (T_TypeA1 *)operator new(0xABu);
                  if ( v7 )
                  {
                    sub_25BF8((P_TypeA2)v7);
                  }
                  v8 = 2;
                  break;
                case 6:
                  v6 = "RSW";
                  v7 = (T_TypeA1 *)operator new(0xB1u);
                  if ( v7 )
                  {
                    v7 = (T_TypeA1 *)sub_25CB8((int)v7);
                  }
                  v8 = 2;
                  break;
                case 7:
                  v6 = "PW";
                  v7 = (T_TypeA1 *)operator new(0x18Cu);
                  if ( v7 )
                  {
                    v7 = (T_TypeA1 *)sub_372B0((T_TypeA2 *)v7, (int)v7, (int)"PW", 2);
                  }
                  v8 = 2;
                  break;
                case 0xB:
                  v6 = "LW";
                  v7 = (T_TypeA1 *)operator new(0xFE0u);
                  if ( v7 )
                  {
                    v7 = (T_TypeA1 *)sub_31200((T_TypeA2 *)v7);
                  }
                  v8 = 2;
                  break;
                case 0xC:
                  v6 = "IW";
                  v7 = (T_TypeA1 *)operator new(0xAFu);
                  if ( v7 )
                  {
                    sub_33598((P_TypeA4)v7);
                  }
                  v8 = 2;
                  break;
                case 9:
                  v7 = (T_TypeA1 *)operator new(0x9DDu);
                  v82 = 2;
                  if ( v7 )
                  {
                    Q_A2_sub_2C830((P_TypeA2)v7);
                    v9 = (char *)sub_1B4F0(&v7[1].pane.window) + 0xFFFFFF55 + 0x143;
                    v10 = (T_TypeA1 *)(_wcpp_2_ctor_array_(v9, 0x64, &unk_959D8) - 0x143);
                    v10[1].magic12345678 = (int)off_96018;
                    sub_46CAC((int)v10, (int)v10, (int)&unk_959D8, (int)v9);
                    v7 = v10;
                  }
                  v8 = v82;
                  v6 = "RW";
                  break;
                case 0xE:
                  v6 = "PSW";
                  v7 = (T_TypeA1 *)operator new(0xADu);
                  if ( v7 )
                  {
                    v7 = (T_TypeA1 *)sub_39D80((T_TypeA2 *)v7);
                  }
                  v8 = 2;
                  break;
                case 0xF:
                  v6 = "NT";
                  v7 = (T_TypeA1 *)operator new(0xAFu);
                  if ( v7 )
                  {
                    v7 = (T_TypeA1 *)sub_2F2F4((T_TypeA2 *)v7);
                  }
                  v8 = 2;
                  break;
                case 0x10:
                  v6 = "SW";
                  v7 = (T_TypeA1 *)operator new(0xB1u);
                  if ( v7 )
                  {
                    v7 = (T_TypeA1 *)sub_51674((T_TypeA2 *)v7);
                  }
                  v8 = 2;
                  break;
                case 0x11:
                  v6 = "FW";
                  v7 = (T_TypeA1 *)operator new(0xB1u);
                  if ( v7 )
                  {
                    v7 = (T_TypeA1 *)sub_51B64((T_TypeA2 *)v7);
                  }
                  v8 = 2;
                  break;
                case 0x12:
                  v6 = "NG";
                  v7 = (T_TypeA1 *)operator new(0xBDu);
                  if ( v7 )
                  {
                    v7 = (T_TypeA1 *)sub_520EC((T_TypeA2 *)v7);
                  }
                  v8 = 2;
                  break;
                case 0x13:
                  v8 = 2;
                  v7 = (T_TypeA1 *)operator new(0x108u);
                  if ( v7 )
                  {
                    Q_A8_sub_10A3C((P_TypeA8)v7);
                  }
                  v6 = "BC";
                  break;
                case 0x14:
                  v6 = "HW";
                  v7 = (T_TypeA1 *)operator new(0xDAFu);
                  if ( v7 )
                  {
                    Q_A2_sub_2FC50((P_TypeA2)v7);
                  }
                  v8 = 2;
                  break;
                case 0x15:
                  v8 = 2;
                  v7 = (T_TypeA1 *)operator new(0xC3u);
                  if ( v7 )
                  {
                    Q_A7_sub_3201C((P_TypeA7)v7);
                  }
                  v6 = "NW";
                  break;
                case 0x16:
                  v6 = "AW";
                  v7 = (T_TypeA1 *)operator new(0xDAFu);
                  if ( v7 )
                  {
                    Q_A6_sub_33830((P_TypeA6)v7);
                  }
                  v8 = 2;
                  break;
                case 0x17:
                  v6 = "EW";
                  v7 = (T_TypeA1 *)operator new(0xDB3u);
                  if ( v7 )
                  {
                    Q_A5_sub_267A0((P_TypeA5)v7);
                  }
                  v8 = 2;
                  break;
                case 0x18:
                  v6 = "EW";
                  v7 = (T_TypeA1 *)operator new(0xABu);
                  if ( v7 )
                  {
                    Q_A2_sub_27BF8((P_TypeA2)v7);
                  }
                  v8 = 2;
                  break;
                case 0x19:
                  v6 = "TW";
                  v7 = (T_TypeA1 *)operator new(0xAFu);
                  if ( v7 )
                  {
                    Q_A4_sub_2D464((P_TypeA4)v7);
                  }
                  v8 = 2;
                  break;
                case 0x1A:
                  v6 = "MW";
                  v7 = (T_TypeA1 *)operator new(0xB3u);
                  if ( v7 )
                  {
                    Q_A3_sub_2FA18((P_TypeA3)v7);
                  }
                  v8 = 2;
                  break;
                case 0x1D:
                  v6 = "GSW";
                  v7 = (T_TypeA1 *)operator new(0xABu);
                  if ( v7 )
                  {
                    Q_A2_sub_395EC((P_TypeA2)v7);
                  }
                  v8 = 2;
                  break;
                case 0x1E:
                  v6 = "EW";
                  v7 = (T_TypeA1 *)operator new(0xABu);
                  if ( v7 )
                  {
                    Q_A2_sub_2712C((T_TypeA2 *)v7);
                  }
                  v8 = 2;
                  break;
                case 0x1F:
                  v6 = "pcw";
                  v8 = 2;
                  v7 = (T_TypeA1 *)operator new(0xABu);
                  if ( v7 )
                  {
                    Q_A2_sub_2C830((P_TypeA2)v7);
                    v7[1].magic12345678 = (int)off_961DC;
                  }
                  break;
                case 0x20:
                  v6 = "miw";
                  v8 = 2;
                  v7 = (T_TypeA1 *)operator new(0xABu);
                  if ( v7 )
                  {
                    Q_A2_sub_2C830((P_TypeA2)v7);
                    v7[1].magic12345678 = (int)off_961C4;
                  }
                  break;
                default:
                  goto LABEL_111;
              }
            }
            else
            {
              v6 = "GW";
              v7 = (T_TypeA1 *)operator new(0xABu);
              if ( v7 )
              {
                Q_A2_sub_2C830((P_TypeA2)v7);
              }
              v8 = 2;
            }
            Q_RegisterData_sub_2625C(v7, v8, v6);
            a1a = v7;
LABEL_111:
            v11 = a1a->name;
            Q_WINMGR_CPP_RegisterWindow_sub_2C978(a1a);
            fscanf(v4, "%s %s", bufc1, v11);
            fscanf(v4, "%s", bufc1);
            fscanf(v4, "%s", bufc1);
            if ( strcmp(bufc1, "NONE") )
            {
              v12 = Q_FindWnd_sub_56DA8(a1, bufc1, 0);
              if ( !v12 )
              {
                sub_2620C("%s bad parent", (char)v11);
                sub_261B8(0, "..\\winmgr.cpp", 0xC8D);
              }
              v13 = a1a;
              a1a->parentIndex = v12->index;
              Q_GWINDOW_CPP_LinkChild_sub_2C990(v12, v13);
            }
            fscanf(v4, "%s %d", bufc1, &v90);
            for ( mm = 0; mm < (__int16)v90; ++mm )
            {
              fscanf(v4, "%d", &bufi);
              if ( !sub_57220(a1, a1a->index, bufi) )
              {
                Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xC97);
              }
              if ( !mm )
              {
                v15 = a1a;
                v16 = *(_WORD *)&a1->Unknown_305E[0x8E * bufi + 0x88];
                a1a->e = 0;
                v15->d = v16;
              }
            }
            fscanf(v4, "%s %d", bufc1, &bufi);
            if ( bufi )
            {
              a1a->k = 0xFFFFFFFF;
            }
            if ( v92 == 0x19 )
            {
              fscanf(v4, "%s %d", bufc1, &bufi);
              if ( bufi )
              {
                a1a[1].pane.window = (WINDOW *)0xFFFFFFFF;
              }
            }
            fscanf(v4, "%s %d", bufc1, &a1a->pane.x0);
            fscanf(v4, "%s %d", bufc1, &a1a->pane.y0);
            fscanf(v4, "%s %d", bufc1, &a1a->pane.x1);
            fscanf(v4, "%s %d", bufc1, &a1a->pane.y1);
            fscanf(v4, "%s %d", bufc1, &bufi);
            v17 = a1a;
            a1a->shapeFrame = bufi;
            if ( v92 == 0xF )
            {
              fscanf(v4, "%s %d", bufc1, &bufi);
              v17[1].pane.window = (WINDOW *)bufi;
            }
            fscanf(v4, "%s %d", bufc1, &bufi);
            v18 = a1a;
            a1a->r = bufi;
            fscanf(v4, "%s %d", bufc1, &v18->sendMessage);
            fscanf(v4, "%s %d", bufc1, &v18->sendParam1);
            fscanf(v4, "%s %d", bufc1, &v18->sendParam2);
            fscanf(v4, "%s %s", bufc1, v18->helpIndex);
            fscanf(v4, "%s %d", bufc1, &bufi);
            y = (int)v18->y;
            v94 = 0;
            v93 = bufi;
            if ( (__int16)bufi > 0 )
            {
              v20 = &v18->y[9];
              v87 = &v18->y[0xB];
              v88 = &v18->y[5];
              do
              {
                fscanf(v4, "%s %d", bufc1, &bufi);
                if ( bufi )
                {
                  if ( bufi == 1 )
                  {
                    v70 = (int)v87;
                    v68 = (int)v88;
                    *(_BYTE *)y = 1;
                    fscanf(v4, "%s %d %d %d", bufc1, v68, v20, v70);
                    *(_DWORD *)(y + 1) = (unsigned __int16)sub_1B270(&V_Type3_stru_10AE70.t13, bufc1, 0xFFFFFFFF);
                  }
                  else
                  {
                    Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xCE1);
                  }
                }
                else
                {
                  v69 = (int)v87;
                  v67 = (int)v88;
                  *(_BYTE *)y = 0;
                  fscanf(v4, "%s %d %d %d", bufc1, v67, v20, v69);
                  *(_DWORD *)(y + 1) = sub_2D334(bufc1);
                }
                v21 = (int)v87;
                sub_2D400((int)a1a, y);
                v20 += 0xD;
                y += 0xD;
                v87 = (_BYTE *)(v21 + 0xD);
                ++v94;
                v88 += 0xD;
              }
              while ( (__int16)v94 < (__int16)v93 );
            }
            a1a->pane.window = a1->window;
          }
          else if ( (unsigned int)bufi <= 0x64 )
          {
            fscanf(v4, "%s %d", bufc1, &bufi);
            fscanf(v4, "%s %s", bufc1, v74);
            v53 = sub_1ADAC(v84, v74);
            if ( !sub_5748C((int)a1, bufi, v53) )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0xECA);
            }
          }
          else
          {
            if ( (unsigned int)bufi < 200 )
            {
              goto LABEL_262;
            }
            if ( (unsigned int)bufi <= 200 )
            {
              fscanf(v4, "%s %d", bufc1, &bufi);
              l = 0;
              Q_AllocateHazeTables_sub_2C08C(&V_Type6_stru_D8654, bufi);
              while ( l < bufi )
              {
                v55 = l;
                fscanf(v4, "%s %s", bufc1, bufc2);
                ++l;
                Q_LoadHazeTables_sub_2C0C0(&V_Type6_stru_D8654, bufc2, v55);
              }
            }
            else
            {
              if ( bufi != 300 )
              {
                goto LABEL_262;
              }
              fscanf(v4, "%s %s", bufc1, v75);
              if ( sub_2B360(z1ccc, v75) != 0xFFFFFFFF )
              {
                Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xEE6);
              }
              *(_DWORD *)a1->z1cc = 0;
              fscanf(v4, "%s %s", bufc1, v75);
              if ( sub_2B360(v86, v75) != 0xFFFFFFFF )
              {
                Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0xEEB);
              }
              *(_DWORD *)a1->Unknown_305E = 0;
            }
          }
        }
      }
    }
  }
  return result;
}
// 77394: using guessed type int __fastcall _wcpp_2_ctor_array_(_DWORD, _DWORD, _DWORD);
// 96018: using guessed type int (*off_96018[5])();
// 961C4: using guessed type int (*off_961C4[5])();
// 961DC: using guessed type int (*off_961DC[5])();
// 96BAC: using guessed type int dword_96BAC;
// 57670: using guessed type char anonymous_3[108];
// 57670: using guessed type char anonymous_4[108];
// 57670: using guessed type char bufc2[108];
// 57670: using guessed type char anonymous_6[108];
// 57670: using guessed type char anonymous_7[108];
// 57670: using guessed type char anonymous_8[32];

//----- (00059828) --------------------------------------------------------
void __fastcall Q_LoadAscendCfg_sub_59828(P_Type3 a1)
{
  T_FileInfo v2; // [esp-124h] [ebp-128h] BYREF

  Q_InitFileInfo_sub_1BB78(&v2);
  if ( !Q_OpenFile_sub_1BBFC(&v2, "ascend.cfg", O_BINARY, 0) )
  {
    Q_ReadFile_sub_1BF94(&v2, &V_SoundSystem._notstarted1, 4u);
    Q_ReadFile_sub_1BF94(&v2, &V_SoundSystem.c, 4u);
    Q_ReadFile_sub_1BF94(&v2, a1->j, 4u);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v2);
}

//----- (0005989C) --------------------------------------------------------
int __fastcall Q_SaveAscendCfg_sub_5989C(P_Type3 a1)
{
  int result; // eax
  T_FileInfo v3; // [esp-120h] [ebp-124h] BYREF

  Q_InitFileInfo_sub_1BB78(&v3);
  if ( !Q_OpenFile_sub_1BCA8(&v3, "ascend.cfg") )
  {
    Q_CFILE_CPP_dos_write_sub_1C098(&v3.fh, &V_SoundSystem._notstarted1, 4u);
    Q_CFILE_CPP_dos_write_sub_1C098(&v3.fh, &V_SoundSystem.c, 4u);
    Q_CFILE_CPP_dos_write_sub_1C098(&v3.fh, a1->j, 4u);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v3);
  return result;
}

//----- (00059908) --------------------------------------------------------
int __fastcall sub_59908(int result)
{
  if ( !*(_DWORD *)(result + 0x48A6) && !*(_DWORD *)(result + 0x48AA) )
  {
    *(_DWORD *)(result + 0x48A6) = 0xFFFFFFFF;
    *(_DWORD *)(result + 0x48BA) = 0;
    *(_DWORD *)(result + 0x48B6) = 0;
  }
  return result;
}

//----- (00059934) --------------------------------------------------------
void __fastcall sub_59934(P_Type3 a1, int a2)
{
  if ( a1->aaa == 0xFFFFFFFF || a1->bbb == 0xFFFFFFFF )
  {
    if ( a1->aaa == 0xFFFFFFFF )
    {
      a1->aaa = 0;
      sub_59DE0(a1);
      if ( a2 )
      {
        sub_59E88(a1, "WINEVENT.BIN", "WINEVENT.TXT");
      }
    }
    a1->bbb = 0;
  }
}

//----- (00059988) --------------------------------------------------------
unsigned int __fastcall sub_59988(P_Type3 a1, char *a2, int a3)
{
  char *v4; // edi
  char v6; // al
  char v7; // al
  const char *v8; // esi
  char *v9; // edi
  char v10; // al
  char v11; // al
  int aaa; // ecx
  unsigned int result; // eax

  v4 = byte_132B20;
  do
  {
    v6 = *a2;
    *v4 = *a2;
    if ( !v6 )
    {
      break;
    }
    v7 = a2[1];
    a2 += 2;
    v4[1] = v7;
    v4 += 2;
  }
  while ( v7 );
  v8 = ".txt";
  v9 = &byte_132B20[strlen(byte_132B20) - 4];
  do
  {
    v10 = *v8;
    *v9 = *v8;
    if ( !v10 )
    {
      break;
    }
    v11 = v8[1];
    v8 += 2;
    v9[1] = v11;
    v9 += 2;
  }
  while ( v11 );
  dword_132B14 = V_Mouse.left;
  aaa = a1->aaa;
  dword_132B18 = V_Mouse.right;
  if ( aaa == 0xFFFFFFFF || a1->bbb == 0xFFFFFFFF )
  {
    return 0;
  }
  result = sub_59CFC(a1, a2);
  if ( result )
  {
    a1->bbb = 0xFFFFFFFF;
    a1->z3[2] = 0;
    result = 0xFFFFFFFF;
    a1->z3[4] = 0;
    a1->z3[0] = a3;
    dword_132B1C = 0;
  }
  return result;
}
// 132B14: using guessed type int dword_132B14;
// 132B18: using guessed type int dword_132B18;
// 132B1C: using guessed type int dword_132B1C;

//----- (00059A54) --------------------------------------------------------
P_Type3 __fastcall sub_59A54(P_Type3 a1)
{
  P_Type3 v1; // ecx
  unsigned int v2; // edi
  LONG y; // ebp
  LONG v4; // eax
  int v5; // eax
  T_TypeA2 *Wnd_sub_56DA8; // esi
  unsigned int v7; // eax
  LONG x; // [esp+0h] [ebp-1Ch]

  v1 = a1;
  if ( a1->bbb )
  {
    x = V_Mouse.x;
    V_Mouse.left = dword_132B14;
    v2 = 0xFFFFFFFF;
    V_Mouse.right = dword_132B18;
    y = V_Mouse.y;
    Q_ProcessInput_sub_2656C();
    if ( V_Keyboard.Pressed == 0xFFFFFFFF
      || V_Mouse.leftClicked == 0xFFFFFFFF && V_Mouse.left
      || V_Mouse.rightClicked == 0xFFFFFFFF && V_Mouse.right )
    {
      v4 = V_Mouse.x;
      v1->bbb = 0;
      y = V_Mouse.y;
      x = v4;
      v5 = 0;
      if ( !*(_DWORD *)&v1->z2[0x168] )
      {
        Wnd_sub_56DA8 = (T_TypeA2 *)Q_FindWnd_sub_56DA8(v1, "HELPWINDOW", 0);
        sub_2FCB0(Wnd_sub_56DA8, "help.txt", "endtut");
        v5 = sub_552F8(v1, Wnd_sub_56DA8, 0);
      }
      if ( v5 )
      {
        v7 = time(0);
        srand(v7);
        v2 = 0;
        *(int *)((char *)&v1->wnds[0].a + (_DWORD)&loc_24DAA + 2) = dword_96BBC;
      }
      else
      {
        v1->bbb = 0xFFFFFFFF;
      }
    }
    if ( v2 )
    {
      V_Mouse.y = y;
      V_Mouse.moved = 0;
      V_Mouse.x = x;
    }
    dword_132B14 = V_Mouse.left;
    a1 = (P_Type3)V_Mouse.right;
    dword_132B18 = V_Mouse.right;
  }
  return a1;
}
// 96BBC: using guessed type int dword_96BBC;
// 132B14: using guessed type int dword_132B14;
// 132B18: using guessed type int dword_132B18;

//----- (00059B80) --------------------------------------------------------
void __fastcall sub_59B80(T_Type3 *a1)
{
  char *z4; // esi
  int v3; // eax
  int v4; // eax
  unsigned __int16 v5; // dx
  int v6; // edx
  int v7; // ebx

  z4 = a1->z4;
  V_Mouse.leftClicked = 0;
  V_Mouse.rightClicked = 0;
  V_Mouse.moved = 0;
  V_Keyboard.Pressed = 0;
  while ( 1 )
  {
    v3 = 0x18 * a1->z3[4];
    if ( a1->z3[2] < *(_DWORD *)&a1->z4[v3] )
    {
      break;
    }
    v4 = (int)&z4[v3];
    v5 = *(_WORD *)(v4 + 8);
    if ( !v5 )
    {
      goto LABEL_5;
    }
    if ( v5 <= 3u )
    {
      sub_265A8(v4);
    }
    else if ( v5 > 7u )
    {
LABEL_5:
      sprintf(
        "Thank you for playing Ascendancy.",
        "\nBad Trace Event: %d of %d\n\nEVENT[%d] HWND[%0d] MSG[%d] P1[%d] P2[%d]\n",
        a1->z3[4],
        a1->z3[3],
        *(__int16 *)(v4 + 8),
        *(_DWORD *)(v4 + 4),
        *(__int16 *)(v4 + 0xA),
        *(_DWORD *)(v4 + 0xC),
        *(_DWORD *)(v4 + 0x10));
      Q_debugbreak_exit_sub_2624C();
    }
    v6 = a1->z3[4] + 1;
    v7 = a1->z3[3];
    a1->z3[4] = v6;
    if ( v6 >= v7 )
    {
      if ( a1->z3[0] != 0xFFFFFFFF )
      {
        sub_59934(a1, 0);
        return;
      }
      a1->z3[4] = 0;
      a1->z3[2] = 0;
    }
  }
}

//----- (00059C80) --------------------------------------------------------
void __fastcall sub_59C80(P_Type3 a1, int a2, __int16 a3, __int16 a4, int a5, int a6, int a7)
{
  char *v8; // edx
  int v9; // edi

  if ( a1->aaa == 0xFFFFFFFF && !a1->bbb )
  {
    v8 = &a1->z4[0x18 * a1->z3[3]];
    *(_DWORD *)v8 = a1->z3[2];
    *((_DWORD *)v8 + 1) = a2;
    *((_WORD *)v8 + 4) = a3;
    *((_WORD *)v8 + 5) = a4;
    *((_DWORD *)v8 + 3) = a5;
    *((_DWORD *)v8 + 4) = a6;
    *((_DWORD *)v8 + 5) = a7;
    v9 = a1->z3[3] + 1;
    a1->z3[3] = v9;
    if ( v9 == 0x1388 )
    {
      sub_59934(a1, 0);
    }
  }
}

//----- (00059CFC) --------------------------------------------------------
unsigned int __fastcall sub_59CFC(P_Type3 a1, const char *a2)
{
  unsigned int v3; // ebx
  unsigned int v4; // eax
  T_FileInfo v6; // [esp+0h] [ebp-124h] BYREF

  Q_InitFileInfo_sub_1BB78(&v6);
  if ( a1->aaa == 0xFFFFFFFF )
  {
    Q_CloseFileAndDelete_sub_1BBC8(&v6);
    return 0;
  }
  else
  {
    if ( Q_OpenFile_sub_1BBFC(&v6, a2, 0x200, 0) )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x104F);
    }
    if ( (unsigned int)Q_GetFileLength_sub_1BE28(&v6) > 0x1D4D0 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x1052);
    }
    Q_ReadFile_sub_1BF94(&v6, &a1->z4[0x1D4C0], 0x10u);
    v4 = Q_ReadFile_sub_1BF94(&v6, a1->z4, 0x1D4C0u);
    a1->z3[3] = v4 / 0x18;
    if ( v4 % 0x18 )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x1059);
    }
    v3 = 0xFFFFFFFF;
    a1->z3[4] = 0;
    Q_CloseFileAndDelete_sub_1BBC8(&v6);
  }
  return v3;
}

//----- (00059DE0) --------------------------------------------------------
void __fastcall sub_59DE0(P_Type3 a1)
{
  T_FileInfo v1; // [esp-124h] [ebp-128h] BYREF

  Q_InitFileInfo_sub_1BB78(&v1);
  if ( a1->aaa != 0xFFFFFFFF )
  {
    if ( Q_OpenFile_sub_1BBFC(&v1, "WINEVENT.BIN", 0x21, 0) )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x106C);
    }
    Q_CFILE_CPP_dos_write_sub_1C098(&v1.fh, &a1->z4[0x1D4C0], 0x10u);
    Q_CFILE_CPP_dos_write_sub_1C098(&v1.fh, a1->z4, 0x18 * a1->z3[3]);
  }
  Q_CloseFileAndDelete_sub_1BBC8(&v1);
}

//----- (00059E88) --------------------------------------------------------
char *__fastcall sub_59E88(P_Type3 a1, char *a2, char *filename)
{
  char *result; // eax
  FILE *v5; // ecx
  __int16 i; // bx
  const char *v7; // eax
  const char *v8; // eax
  const char *v9; // eax
  const char *v10; // eax
  char *v11; // edx
  const char *v12; // [esp-4h] [ebp-8h]

  result = filename;
  if ( !a1->aaa && !a1->bbb )
  {
    v5 = fopen(filename, "w");
    if ( !v5 )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x107D);
    }
    if ( sub_59CFC(a1, a2) != 0xFFFFFFFF )
    {
      Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x1080);
    }
    for ( i = 0; i < a1->z3[3]; ++i )
    {
      v11 = &a1->z4[0x18 * i];
      switch ( *((_WORD *)v11 + 4) )
      {
        case 1:
          fprintf(v5, " TIME[%05lu]  EVT_MOUSE_POS    : ", *(_DWORD *)v11);
          fprintf(v5, " Moved to (%03d,%03d)\n", *((_DWORD *)v11 + 3), *((_DWORD *)v11 + 4));
          break;
        case 2:
          fprintf(v5, " TIME[%05lu]  EVT_MOUSE_BUTTON :  ", *(_DWORD *)v11);
          if ( *((_DWORD *)v11 + 4) )
          {
            v7 = "DOWN";
          }
          else
          {
            v7 = "UP";
          }
          v12 = v7;
          if ( *((_DWORD *)v11 + 3) )
          {
            v8 = "Right";
          }
          else
          {
            v8 = "Left";
          }
          fprintf(v5, "%s Button %s\n", v8, v12);
          break;
        case 3:
          fprintf(v5, " TIME[%05lu]  EVT_KEYBOARD     : ", *(_DWORD *)v11);
          fprintf(v5, " '%c'  (%04d)\n", v11[0x10], *((_DWORD *)v11 + 3));
          break;
        case 4:
        case 5:
          if ( *((_WORD *)v11 + 4) == 4 )
          {
            v9 = "EVT_REQ_CONT";
          }
          else
          {
            v9 = "EVT_CAN_CONT";
          }
          fprintf(v5, " TIME[%05lu]  %-15s: ", *(_DWORD *)v11, v9);
          fprintf(
            v5,
            " HWND[%04d] MSG[%04d] P1[%04d] P2[%04d]\n",
            *((_DWORD *)v11 + 1),
            *((__int16 *)v11 + 5),
            *((_DWORD *)v11 + 3),
            *((_DWORD *)v11 + 4));
          break;
        case 6:
        case 7:
          if ( *((_WORD *)v11 + 4) == 6 )
          {
            v10 = "EVT_REQ_CHANGE";
          }
          else
          {
            v10 = "EVT_CAN_CHANGE";
          }
          fprintf(v5, " TIME[%05lu]  %-15s: ", *(_DWORD *)v11, v10);
          fprintf(
            v5,
            " HWND[%04d] MSG[%04d] P1[%04d] P2[%04d] F[%04d]\n",
            *((_DWORD *)v11 + 1),
            *((__int16 *)v11 + 5),
            *((_DWORD *)v11 + 3),
            *((_DWORD *)v11 + 4),
            *((_DWORD *)v11 + 5));
          break;
        default:
          fprintf(v5, " *** Unrecognized event type : %d\n", *((__int16 *)v11 + 4));
          break;
      }
    }
    return (char *)fclose(v5);
  }
  return result;
}

//----- (0005A094) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_sub_5A094(P_Type3 a1, void *aData, int a3, char *name)
{
  __int16 i; // kr00_2
  char *v6; // edi

  if ( a1->type4counter == 384 )
  {
    Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x10CB);
  }
  for ( i = 0; ; ++i )
  {
    if ( i >= 384 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x10DD);
    }
    if ( !a1->t4[i].pData )
    {
      break;
    }
  }
  a1->t4[i].pData = aData;
  a1->t4[i].a = a3;
  v6 = a1->t4[i].name;
  strncpy(v6, name, 19u);
  a1->t4[i].name[19] = 0;
  strupr(v6);
  a1->t4[i].time = V_Timer_dword_132B58;
  ++a1->type4counter;
}
// 132B58: using guessed type int V_Timer_dword_132B58;

//----- (0005A144) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_sub_5A144(P_Type3 a1, void *a2)
{
  __int16 i; // kr00_2

  if ( a2 )
  {
    for ( i = 0; i < 0x180; ++i )
    {
      if ( a2 == a1->t4[i].pData )
      {
        a1->t4[i].pData = 0;
        --a1->type4counter;
        return;
      }
    }
    Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x10F1);
  }
}

//----- (0005A194) --------------------------------------------------------
char *__fastcall sub_5A194(int a1, int a2, _DWORD *a3, _DWORD *a4)
{
  __int16 v6; // dx
  __int16 v7; // ax
  int v8; // edx

  v6 = *(_WORD *)(a1 + 0x24D96);
  v7 = 0;
  if ( v6 <= 0 )
  {
    return 0;
  }
  while ( 1 )
  {
    v8 = a1 + 0x20 * v7;
    if ( a2 == *(_DWORD *)((char *)&loc_21DB2 + v8) )
    {
      break;
    }
    if ( ++v7 >= *(__int16 *)(a1 + 0x24D96) )
    {
      return 0;
    }
  }
  if ( a3 )
  {
    *a3 = *(_DWORD *)((char *)&loc_21D96 + v8);
  }
  if ( a4 )
  {
    *a4 = *(_DWORD *)(0x20 * v7 + a1 + 0x21D9A);
  }
  return (char *)&loc_21D96 + 0x20 * v7 + a1 + 8;
}

//----- (0005A270) --------------------------------------------------------
void __fastcall sub_5A270(T_Type3 *a1, int a2, int a3, int a4)
{
  if ( !a1->h || a4 == 0xFFFFFFFF )
  {
    Q_GSYSTEM_CPP_sub_2C7D0(&V_Type6_stru_D8654, a2, a3);
  }
}

//----- (0005A294) --------------------------------------------------------
void __fastcall sub_5A294(P_Type3 a1)
{
  P_Type3 v1; // ecx
  WORD *p_wndCnt; // [esp+0h] [ebp-14h]

  v1 = a1;
  p_wndCnt = &a1->wndCnt;
  do
  {
    if ( v1->wnds[0].a )
    {
      (*(void (**)(void))(v1->wnds[0].a1[1].magic12345678 + 0x14))();
    }
    v1 = (P_Type3)((char *)v1 + 0xC);
  }
  while ( v1 != (P_Type3)p_wndCnt );
}

//----- (0005A320) --------------------------------------------------------
void __fastcall Q_Proc_sub_5A320(__int16 a1)
{
  unsigned __int16 v1; // cx
  void *ShapeTable_sub_1B084; // eax

  switch ( a1 )
  {
    case 1:
      v1 = sub_1B270(&V_Type3_stru_10AE70.t13, "DATA\\1starmap.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 2:
    case 4:
    case 0xA:
    case 0xE:
    case 0xF:
    case 0x12:
      v1 = sub_1B270(&V_Type3_stru_10AE70.t13, "DATA\\10status.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 3:
      v1 = sub_1B270(&V_Type3_stru_10AE70.t13, "DATA\\3cfgnew.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 7:
      v1 = sub_1B270(&V_Type3_stru_10AE70.t13, "DATA\\7racesel.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 8:
      v1 = sub_1B270(&V_Type3_stru_10AE70.t13, "DATA\\8shipdes.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 9:
      v1 = sub_1B270(&V_Type3_stru_10AE70.t13, "DATA\\9ENDGAME.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 0xC:
      v1 = sub_1B270(&V_Type3_stru_10AE70.t13, "DATA\\12start.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 0xD:
      v1 = sub_1B270(&V_Type3_stru_10AE70.t13, "DATA\\13negot.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 0x10:
      v1 = sub_1B270(&V_Type3_stru_10AE70.t13, "DATA\\16battle.tmp", 0xFFFFFFFF);
      goto LABEL_12;
    case 0x14:
      v1 = sub_1B270(&V_Type3_stru_10AE70.t13, "DATA\\20res.tmp", 0xFFFFFFFF);
LABEL_12:
      if ( v1 == 0xFFFF )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x1168);
      }
      ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084((unsigned int)&V_Type3_stru_10AE70.t13, v1);
      VFX_shape_draw(&V_Type6_stru_D8654.pane, ShapeTable_sub_1B084, 0, 0, 0);
      break;
    default:
      return;
  }
}

//----- (0005A47C) --------------------------------------------------------
int __fastcall sub_5A47C(T_Type5 *a1, const char *a2, int a3, int a4)
{
  __int16 v5; // ax
  T_Rect *p_rect; // esi
  __int16 v8; // [esp+2h] [ebp-10h]

  v5 = 0xF2;
  v8 = word_96BC4[a3];
  if ( a4 == 0xFFFFFFFF )
  {
    v5 = 0x96;
  }
  VFX_pane_wipe((PANE *)a1, v5);
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = a1->a;
  p_rect = &a1->rect;
  V_Type3_stru_10AE70.rect.x1 = p_rect->x1;
  p_rect = (T_Rect *)((char *)p_rect + 4);
  V_Type3_stru_10AE70.rect.y1 = p_rect->x1;
  p_rect = (T_Rect *)((char *)p_rect + 4);
  V_Type3_stru_10AE70.rect.x2 = p_rect->x1;
  V_Type3_stru_10AE70.rect.y2 = p_rect->y1;
  return sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 1, 1, a2, 0x40, v8, 0xFF, 0);
}
// 96BC4: using guessed type __int16 word_96BC4[8];

//----- (0005A4E4) --------------------------------------------------------
LONG __fastcall sub_5A4E4(_DWORD *a1, LONG a2, int a3, int a4)
{
  __int16 v5; // bx
  __int16 v6; // ax
  PANE v8; // [esp+0h] [ebp-30h] BYREF
  char s[12]; // [esp+14h] [ebp-1Ch] BYREF
  LONG color; // [esp+20h] [ebp-10h]

  v5 = 0xF3;
  color = a2;
  sprintf(s, "%03d", a2);
  v6 = 0xF2;
  if ( a2 == dword_132B10 )
  {
    v6 = 0xFE;
    v5 = 0;
  }
  if ( a4 )
  {
    v6 = 0xF1;
  }
  *(_DWORD *)&V_Type3_stru_10AE70.z1cc[0xC] = *a1;
  V_Type3_stru_10AE70.rect.x1 = a1[1];
  V_Type3_stru_10AE70.rect.y1 = a1[2];
  V_Type3_stru_10AE70.rect.x2 = a1[3];
  V_Type3_stru_10AE70.rect.y2 = a1[4];
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 1, 1, s, 0x40, v5, v6, 0);
  v8 = *(PANE *)a1;
  v8.x0 += 0x23;
  --v8.y1;
  ++v8.y0;
  return VFX_pane_wipe(&v8, color);
}
// 132B10: using guessed type int dword_132B10;

//----- (0005A594) --------------------------------------------------------
T_TypeA2 *__fastcall sub_5A594(T_TypeA2 *result)
{
  Q_A2_sub_2C830(result);
  result->b = (int)off_961AC;
  return result;
}
// 961AC: using guessed type int (*off_961AC[5])();

//----- (0005A5AC) --------------------------------------------------------
int __fastcall sub_5A5AC(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_9615C);
    operator delete[](v3);
    return a1;
  }
  else
  {
    *(_DWORD *)(a1 + 0xA7) = off_961AC;
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);
// 961AC: using guessed type int (*off_961AC[5])();

//----- (0005A5F4) --------------------------------------------------------
void __fastcall Q_WINMGR_CPP_RegisterWindow_sub_5A5F4(P_TypeA1 a1)
{
  a1->index = Q_WINMGR_CPP_RegisterWindow_sub_571B8(&V_Type3_stru_10AE70, a1);
}

//----- (0005A60C) --------------------------------------------------------
unsigned int __fastcall sub_5A60C(int a1, __int16 a2, __int16 a3, int a4)
{
  T_TypeA1 *Wnd_sub_56DA8; // eax
  int v7; // ecx
  T_TypeA1 *v8; // eax
  int v9; // ecx
  T_TypeA1 *v10; // eax
  int v11; // ecx
  T_TypeA1 *v12; // eax
  int v13; // ecx
  T_TypeA1 *v14; // eax
  int v15; // ecx
  char v16; // ah
  T_TypeA1 *v17; // eax
  T_TypeA1 *v18; // eax
  int v19; // ecx

  if ( (unsigned __int16)a2 < 0x3EBu )
  {
    if ( (unsigned __int16)a2 < 0xC8u )
    {
      if ( a2 && ((unsigned __int16)a2 <= 2u || (unsigned __int16)a2 >= 6u && (unsigned __int16)a2 <= 7u) )
      {
        return sub_2F424(a1, a2, a3, a4);
      }
      return 0;
    }
    if ( (unsigned __int16)a2 <= 0xC8u )
    {
      *(_BYTE *)(a1 + 0xBF) = 0;
      Wnd_sub_56DA8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "DBGWNDLIST", 0);
      v7 = (int)Wnd_sub_56DA8;
      if ( !Wnd_sub_56DA8 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x11D1);
      }
      sub_2ED4C((int)Wnd_sub_56DA8);
      *(_DWORD *)(v7 + 0xAB) = 0xFFFFFFFF;
      sub_2F1C8(v7, (int)sub_5A47C);
      if ( !*(_DWORD *)(v7 + 0x8E6) && !sub_2F228(v7, 0x2000u, 0) )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x11D9);
      }
      sub_5AE68(a1, v7);
      return 0;
    }
    else if ( (unsigned __int16)a2 <= 0xCAu )
    {
      sub_56B60(&V_Type3_stru_10AE70, 6, a2, 0);
      return 0xFFFFFFFF;
    }
    else if ( a2 == 0x3EA )
    {
      if ( *(_BYTE *)(a1 + 0xBF) )
      {
        *(_BYTE *)(a1 + 0xBF) = 0;
        v8 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "DBGWNDLIST", 0);
        v9 = (int)v8;
        if ( !v8 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x11F0);
        }
        v8[1].pane.window = (WINDOW *)0xFFFFFFFF;
        sub_2F1C8((int)v8, (int)sub_5A47C);
        sub_2ED4C(v9);
        sub_5AE68(a1, v9);
        (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
      }
      return 0xFFFFFFFF;
    }
    else
    {
      return 0;
    }
  }
  else if ( (unsigned __int16)a2 <= 0x3EBu )
  {
    if ( *(_BYTE *)(a1 + 0xBF) != 1 )
    {
      *(_BYTE *)(a1 + 0xBF) = 1;
      v10 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "DBGWNDLIST", 0);
      v11 = (int)v10;
      if ( !v10 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x1204);
      }
      v10[1].pane.window = (WINDOW *)0xFFFFFFFF;
      sub_2F1C8((int)v10, (int)sub_5A47C);
      sub_2ED4C(v11);
      sub_5AB2C(a1, v11);
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    }
    return 0xFFFFFFFF;
  }
  else if ( (unsigned __int16)a2 < 0x3EEu )
  {
    if ( (unsigned __int16)a2 <= 0x3ECu )
    {
      if ( *(_BYTE *)(a1 + 0xBF) != 2 )
      {
        *(_BYTE *)(a1 + 0xBF) = 2;
        v12 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "DBGWNDLIST", 0);
        v13 = (int)v12;
        if ( !v12 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x1218);
        }
        v12[1].pane.window = (WINDOW *)0xFFFFFFFF;
        sub_2F1C8((int)v12, (int)sub_5A47C);
        sub_2ED4C(v13);
        sub_5AF30(a1, v13);
        (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
      }
      return 0xFFFFFFFF;
    }
    else
    {
      if ( *(_BYTE *)(a1 + 0xBF) != 3 )
      {
        *(_BYTE *)(a1 + 0xBF) = 3;
        v18 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "DBGWNDLIST", 0);
        v19 = (int)v18;
        if ( !v18 )
        {
          Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x122B);
        }
        v18[1].pane.window = 0;
        sub_2F1C8((int)v18, (int)sub_5A4E4);
        sub_2ED4C(v19);
        sub_5B200(a1, v19);
        (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
      }
      return 0xFFFFFFFF;
    }
  }
  else
  {
    if ( (unsigned __int16)a2 > 0x3EEu )
    {
      if ( (unsigned __int16)a2 >= 0x3F1u )
      {
        if ( (unsigned __int16)a2 <= 0x3F1u )
        {
          if ( *(_BYTE *)(a1 + 0xBF) == 3 )
          {
            v17 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "DBGWNDLIST", 0);
            if ( !v17 )
            {
              Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x1262);
            }
            sub_2ECDC((int)v17, dword_132B10);
            (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
          }
          return 0xFFFFFFFF;
        }
        else if ( a2 == 0x1C01 )
        {
          v16 = *(_BYTE *)(a1 + 0xBF);
          if ( v16 == 3 )
          {
            if ( a4 == 5 )
            {
              (*V_Type3_stru_10AE70.hazeTableMapFocus)[0xF2] = a3;
            }
          }
          else if ( v16 == 4 )
          {
            sub_4F8CC(&V_SoundSystem, a3, 0);
          }
          return 0xFFFFFFFF;
        }
        else
        {
          return 0;
        }
      }
      return 0;
    }
    if ( *(_BYTE *)(a1 + 0xBF) != 4 )
    {
      *(_BYTE *)(a1 + 0xBF) = 4;
      v14 = Q_FindWnd_sub_56DA8(&V_Type3_stru_10AE70, "DBGWNDLIST", 0);
      v15 = (int)v14;
      if ( !v14 )
      {
        Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x123E);
      }
      v14[1].pane.window = (WINDOW *)0xFFFFFFFF;
      sub_2F1C8((int)v14, (int)sub_5A47C);
      sub_2ED4C(v15);
      sub_5B244(a1, v15);
      (*(void (__fastcall **)(int, _DWORD))(*(_DWORD *)(a1 + 0xA7) + 0xC))(a1, 0);
    }
    return 0xFFFFFFFF;
  }
}
// 132B10: using guessed type int dword_132B10;

//----- (0005AA08) --------------------------------------------------------
void __fastcall sub_5AA08(int a1)
{
  void *ShapeTable_sub_1B084; // eax
  char v2; // dl
  const char *v3; // esi
  char *v4; // edi
  char v5; // al
  char v6; // al
  char v7[20]; // [esp+0h] [ebp-18h] BYREF
  _DWORD *v8; // [esp+14h] [ebp-4h]

  v8 = (_DWORD *)a1;
  ShapeTable_sub_1B084 = Q_CACHE_CPP_GetShapeTable_sub_1B084(
                           (unsigned int)&V_Type3_stru_10AE70.t13,
                           *(unsigned __int16 *)(a1 + 0x18));
  VFX_shape_draw((PANE *)(v8 + 1), ShapeTable_sub_1B084, 0, 0, 0);
  VFX_pane_wipe((PANE *)((char *)v8 + 0xAB), 0xF2);
  v2 = *((_BYTE *)v8 + 0xBF);
  if ( v2 )
  {
    if ( v2 == 1 )
    {
      v3 = "MEMORY    ";
    }
    else if ( v2 == 2 )
    {
      v3 = "CACHE     ";
    }
    else
    {
      v3 = "PALETTE   ";
    }
  }
  else
  {
    v3 = "WINDOWS   ";
  }
  v4 = v7;
  do
  {
    v5 = *v3;
    *v4 = *v3;
    if ( !v5 )
    {
      break;
    }
    v6 = v3[1];
    v3 += 2;
    v4[1] = v6;
    v4 += 2;
  }
  while ( v6 );
  sub_2B3E0(
    &V_Type3_stru_10AE70.z1cc[4],
    *(_DWORD *)((char *)v8 + 0xAF),
    *(_DWORD *)((char *)v8 + 0xB3),
    *(_DWORD *)((char *)v8 + 0xB7),
    *(_DWORD *)((char *)v8 + 0xB3) + 0x32);
  sub_2B8A8((int)&V_Type3_stru_10AE70.z1cc[4], 1, 1, v7, 0, 0xFFFFFFFF, 0xFFFFFFFF, 0);
  sub_2D218(v8);
}

//----- (0005AB04) --------------------------------------------------------
int __fastcall sub_5AB04(const char **a1, const char **a2)
{
  return strncmp(*a1, *a2, 6u);
}

//----- (0005AB2C) --------------------------------------------------------
void __fastcall sub_5AB2C(int a1, int a2)
{
  int v2; // ebp
  int v3; // edi
  char *v4; // eax
  unsigned __int16 v5; // ax
  __int16 v6; // cx
  unsigned __int16 v7; // ax
  int v8; // edi
  unsigned __int16 v9; // ax
  unsigned __int16 v10; // ax
  int v11; // ecx
  unsigned __int16 v12; // ax
  int v13; // edi
  unsigned __int16 v14; // ax
  unsigned __int16 v15; // ax
  unsigned __int16 v16; // ax
  char s[80]; // [esp+0h] [ebp-98h] BYREF
  struct _heapinfo v18; // [esp+50h] [ebp-48h] BYREF
  int v19; // [esp+60h] [ebp-38h] BYREF
  int v20; // [esp+64h] [ebp-34h] BYREF
  int v21; // [esp+68h] [ebp-30h]
  int v22; // [esp+6Ch] [ebp-2Ch]
  int v23; // [esp+70h] [ebp-28h]
  int v24; // [esp+74h] [ebp-24h]
  int v25; // [esp+78h] [ebp-20h]
  int v26; // [esp+7Ch] [ebp-1Ch]
  __int16 v27; // [esp+80h] [ebp-18h]

  *(_BYTE *)(a1 + 0xBF) = 1;
  v2 = 0;
  v22 = 0;
  v21 = 0;
  v23 = 0;
  LOWORD(v25) = 0;
  LOWORD(v26) = 0;
  v27 = 0;
  LOWORD(v24) = 0;
  if ( heapchk() )
  {
    Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x12A9);
  }
  HIWORD(v18._pentry) = 0;
  LODWORD(v18._pentry) = 0;
  while ( !heapwalk(&v18) )
  {
    if ( v18._useflag )
    {
      v2 += v18._size;
    }
    else
    {
      v3 = LODWORD(v18._pentry) + 4;
      v4 = sub_5A194((int)&V_Type3_stru_10AE70, LODWORD(v18._pentry) + 4, &v19, &v20);
      if ( v4 )
      {
        switch ( v19 )
        {
          case 1:
          case 4:
          case 5:
            sprintf(s, "%06lu S%07lu %s", v20, v18._size, v4);
            v9 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
            sub_2EC50(a2, v9, v19);
            break;
          case 2:
            sprintf(s, "%06lu S%07lu WND[%s]", v20, v18._size, (const char *)(v3 + 0x20));
            v5 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
            v6 = v24;
            sub_2EC50(a2, v5, v19);
            LOWORD(v24) = v6 + 1;
            v21 += v18._size;
            break;
          case 3:
            sprintf(s, "%06lu S%07lu %s", v20, v18._size, v4);
            v7 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
            v8 = v23;
            sub_2EC50(a2, v7, v19);
            v23 = v18._size + v8;
            LOWORD(v25) = v25 + 1;
            break;
          default:
            Q_AssertLogBreakExit_sub_261A8(0, "..\\winmgr.cpp", 0x12E3);
            break;
        }
      }
      else
      {
        ++v27;
      }
      v22 += v18._size;
      LOWORD(v26) = v26 + 1;
    }
  }
  sprintf(s, "** %d WNDS USING %lu BYTES", (__int16)v24, v21);
  v10 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  v11 = v23;
  sub_2EC50(a2, v10, 0);
  sprintf(s, "** %d SHAPES USING %lu BYTES", (__int16)v25, v11);
  v12 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  v13 = v22;
  sub_2EC50(a2, v12, 0);
  sprintf(s, "** %d ITEMS IN HEAP USE %lu BYTES", (__int16)v26, v13);
  v14 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  sub_2EC50(a2, v14, 0);
  sprintf(s, "** %d ITEMS ARE UNIDENTIFIED", v27);
  v15 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  sub_2EC50(a2, v15, 0);
  sprintf(s, "** TOTAL FREE IN HEAP %lu BYTES", v2);
  v16 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  sub_2EC50(a2, v16, 0);
  sub_2F1D8(a2, (int)sub_5AB04);
  sub_2F1E0(a2);
}

//----- (0005AE68) --------------------------------------------------------
int __fastcall sub_5AE68(int eax0, int a2)
{
  int v3; // edx
  __int16 v4; // si
  __int16 v5; // di
  int result; // eax
  int v7; // eax
  T_TypeA1 *a1; // edx
  char v9; // bl
  char s[72]; // [esp+0h] [ebp-48h] BYREF

  v3 = *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596];
  *(_BYTE *)(eax0 + 0xBF) = 0;
  v4 = 0x1F;
  v5 = *(_WORD *)&V_Type3_stru_10AE70.Unknown_305E[0x8E * v3 + 6];
  while ( 1 )
  {
    result = v5;
    if ( v5 <= 0 )
    {
      break;
    }
    if ( v4 < 0 )
    {
      Q_AssertLogBreakExit_sub_26198(0, "..\\winmgr.cpp", 0x131E);
    }
    v7 = *(_DWORD *)&V_Type3_stru_10AE70.Unknown_305E[0x8E * *(__int16 *)&V_Type3_stru_10AE70.z1e[0x596] + 8 + 4 * v4];
    if ( v7 )
    {
      a1 = V_Type3_stru_10AE70.wnds[v7].a1;
      if ( a1->parentIndex )
      {
        v9 = 0x43;
      }
      else
      {
        v9 = 0x20;
      }
      sprintf(s, "%c HWND%03d %s", v9, v7, a1->name);
      --v5;
      sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
    }
    --v4;
  }
  return result;
}

//----- (0005AF30) --------------------------------------------------------
unsigned int __fastcall sub_5AF30(int a1, int a2)
{
  int v3; // edi
  T_Type13 *v4; // ebp
  int v5; // edx
  unsigned __int16 v6; // ax
  int v7; // ecx
  int v8; // ebp
  int v9; // edx
  unsigned __int16 v10; // ax
  unsigned __int16 v11; // ax
  unsigned __int16 v12; // ax
  unsigned __int16 v13; // ax
  unsigned __int16 v14; // ax
  unsigned __int16 v15; // dx
  char s[100]; // [esp+0h] [ebp-94h] BYREF
  T_Type13 *v18; // [esp+64h] [ebp-30h]
  T_Type13 *z4; // [esp+68h] [ebp-2Ch]
  T_Type13 *v20; // [esp+6Ch] [ebp-28h]
  T_Type13 *p_t13; // [esp+70h] [ebp-24h]
  T_Type13 *v22; // [esp+74h] [ebp-20h]
  T_Type13 *v23; // [esp+78h] [ebp-1Ch]
  int v24; // [esp+7Ch] [ebp-18h]

  v3 = 0;
  p_t13 = &V_Type3_stru_10AE70.t13;
  v24 = 0;
  z4 = (T_Type13 *)V_Type3_stru_10AE70.t13.z4;
  v22 = &V_Type3_stru_10AE70.t13;
  v4 = &V_Type3_stru_10AE70.t13;
  while ( p_t13->b > v24 )
  {
    sprintf(
      s,
      "%07d %s",
      V_Type3_stru_10AE70.t13.z2[*(unsigned __int16 *)v4->z3],
      (const char *)z4 + 0x32 * *(unsigned __int16 *)v4->z3);
    v5 = v22->z2[0];
    strupr(s);
    v3 += v5;
    v4 = (T_Type13 *)((char *)v4 + 2);
    v6 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
    v7 = v24;
    sub_2EC50(a2, v6, 1);
    v24 = v7 + 1;
    v22 = (T_Type13 *)((char *)v22 + 4);
  }
  sub_2EA8C(a2, " ", 0xFFFFFFFF, 0);
  v20 = (T_Type13 *)p_t13->z4;
  v8 = 0;
  v18 = p_t13;
  v23 = p_t13;
  do
  {
    if ( v18->z4[0][0] )
    {
      sprintf(s, "%s", (const char *)v20 + 0x32 * v8);
      v9 = v23->z2[0];
      strupr(s);
      v3 += v9;
      v10 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
      sub_2EC50(a2, v10, 0);
    }
    ++v8;
    v18 = (T_Type13 *)((char *)v18 + 0x32);
    v23 = (T_Type13 *)((char *)v23 + 4);
  }
  while ( v8 < 0xC8 );
  sub_2EA8C(a2, " ", 0xFFFFFFFF, 0);
  sprintf(s, "%03d ITEMS IN CACHE", p_t13->a);
  v11 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  sub_2EC50(a2, v11, 0);
  sprintf(s, "%03d ITEMS LOADED", p_t13->b);
  v12 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  sub_2EC50(a2, v12, 0);
  sub_2EA8C(a2, " ", 0xFFFFFFFF, 0);
  sprintf(s, "%07d TOTAL CACHE SIZE", p_t13->size);
  v13 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  sub_2EC50(a2, v13, 0);
  sprintf(s, "%07d USED", v3);
  v14 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  sub_2EC50(a2, v14, 0);
  sprintf(s, "%07d FREE", p_t13->size - v3);
  v15 = sub_2EA8C(a2, s, 0xFFFFFFFF, 0);
  return sub_2EC50(a2, v15, 0);
}

//----- (0005B200) --------------------------------------------------------
int __fastcall sub_5B200(int a1, int a2)
{
  __int16 i; // si
  int result; // eax

  *(_BYTE *)(a1 + 0xBF) = 3;
  for ( i = 0; i < 0x100; result = sub_2EA8C(a2, (const char *)i++, 0xFFFFFFFF, 0) )
  {
    ;
  }
  return result;
}

//----- (0005B244) --------------------------------------------------------
int __fastcall sub_5B244(int result, int a2)
{
  int i; // esi
  char s[96]; // [esp+0h] [ebp-60h] BYREF

  *(_BYTE *)(result + 0xBF) = 4;
  for ( i = 0; (__int16)i < V_SoundSystem.tracks; result = sub_2EA8C(a2, s, 0xFFFFFFFF, 0) )
  {
    sprintf(
      s,
      "%02d. %-24s (%d)",
      (__int16)i,
      V_SoundSystem.files[(__int16)i].fname,
      V_SoundSystem.files[(__int16)i].fpos);
    ++i;
  }
  return result;
}

//----- (0005B2B0) --------------------------------------------------------
int __fastcall sub_5B2B0(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_96184);
    operator delete[](v3);
    return a1;
  }
  else
  {
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return (int)v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (0005B2F0) --------------------------------------------------------
T_TypeA2 *__fastcall sub_5B2F0(T_TypeA2 *result)
{
  Q_A2_sub_2C830(result);
  result->b = (int)off_961C4;
  return result;
}
// 961C4: using guessed type int (*off_961C4[5])();

//----- (0005B300) --------------------------------------------------------
void *__fastcall sub_5B300(int a1, char a2)
{
  void *v3; // eax
  void *v5; // eax
  void *v6; // ebx

  if ( (a2 & 4) != 0 )
  {
    v3 = (void *)_wcpp_2_dtor_array_store_(a1, (int)&unk_96198);
    operator delete[](v3);
    return (void *)a1;
  }
  else
  {
    v5 = (void *)sub_2C848(a1, 1);
    v6 = v5;
    if ( (a2 & 2) != 0 )
    {
      operator delete(v5);
    }
    return v6;
  }
}
// 76D5C: using guessed type void __fastcall operator delete[](void *);
// 76D64: using guessed type void __fastcall operator delete(void *);

//----- (0005B340) --------------------------------------------------------
T_TypeA2 *__fastcall sub_5B340(T_TypeA2 *result)
{
  Q_A2_sub_2C830(result);
  result->b = (int)off_961DC;
  return result;
}
// 961DC: using guessed type int (*off_961DC[5])();

//----- (0005B50C) --------------------------------------------------------
BOOL __fastcall sub_5B50C(_DWORD *a1, _DWORD *a2)
{
  if ( *a1 != *a2 )
  {
    return 0;
  }
  if ( a1[4] < a2[2] )
  {
    return 0;
  }
  if ( a1[2] > a2[4] )
  {
    return 0;
  }
  if ( a1[3] < a2[1] )
  {
    return 0;
  }
  if ( a1[1] > a2[3] )
  {
    return 0;
  }
  if ( a1[1] < a2[1] )
  {
    return 0;
  }
  if ( a1[3] > a2[3] )
  {
    return 0;
  }
  if ( a1[2] >= a2[2] )
  {
    return a1[4] <= a2[4];
  }
  return 0;
}

//----- (0005B617) --------------------------------------------------------
_DWORD *__fastcall sub_5B617(size_t a1)
{
  _DWORD *ptr; // [esp+8h] [ebp-4h]

  ptr = malloc(0xCu);
  if ( !ptr )
  {
    return 0;
  }
  ptr[1] = calloc(a1, 4u);
  if ( ptr[1] )
  {
    *ptr = calloc(a1, 0x14u);
    if ( *ptr )
    {
      ptr[2] = a1;
      sub_5B71C((int)ptr);
      return ptr;
    }
    else
    {
      free((void *)ptr[1]);
      free(ptr);
      return 0;
    }
  }
  else
  {
    free(ptr);
    return 0;
  }
}

//----- (0005B71C) --------------------------------------------------------
unsigned int __fastcall sub_5B71C(int a1)
{
  unsigned int result; // eax
  unsigned int i; // [esp+4h] [ebp-4h]

  for ( i = 0; ; ++i )
  {
    result = i;
    if ( i >= *(_DWORD *)(a1 + 8) )
    {
      break;
    }
    *(_DWORD *)(4 * i + *(_DWORD *)(a1 + 4)) = 0;
  }
  return result;
}

//----- (0005B7C2) --------------------------------------------------------
unsigned int __fastcall sub_5B7C2(_DWORD *a1, int a2, int x1, int y1, int x2, int y2)
{
  int *v9; // [esp+14h] [ebp-10h]
  int *v10; // [esp+18h] [ebp-Ch]
  unsigned int v11; // [esp+1Ch] [ebp-8h]
  unsigned int i; // [esp+20h] [ebp-4h]

  for ( i = 0; i < a1[2] && *(_DWORD *)(4 * i + a1[1]); ++i )
  {
    ;
  }
  if ( i == a1[2] )
  {
    return 0xFFFFFFFF;
  }
  *(_DWORD *)(4 * i + a1[1]) = 1;
  v10 = (int *)(0x14 * i + *a1);
  *v10 = a2;
  v10[1] = x1;
  v10[2] = y1;
  v10[3] = x2;
  v10[4] = y2;
  v11 = 0;
  v9 = (int *)*a1;
  while ( v11 < a1[2] )
  {
    if ( *(_DWORD *)(4 * v11 + a1[1]) && v10 != v9 && sub_5B50C(v10, v9) )
    {
      *(_DWORD *)(4 * i + a1[1]) = 2;
      return i;
    }
    ++v11;
    v9 += 5;
  }
  return i;
}

//----- (0005BA38) --------------------------------------------------------
unsigned int __fastcall sub_5BA38(_DWORD *a1)
{
  unsigned int result; // eax
  unsigned int i; // [esp+8h] [ebp-4h]

  for ( i = 0; ; ++i )
  {
    result = i;
    if ( i >= a1[2] )
    {
      break;
    }
    if ( *(_DWORD *)(4 * i + a1[1]) == 1 )
    {
      VFX_pane_refresh(
        (PANE *)(0x14 * i + *a1),
        *(_DWORD *)(0x14 * i + *a1 + 4),
        *(_DWORD *)(0x14 * i + *a1 + 8),
        *(_DWORD *)(0x14 * i + *a1 + 0xC),
        *(_DWORD *)(0x14 * i + *a1 + 0x10));
    }
  }
  return result;
}

//----- (0005BAC0) --------------------------------------------------------
int __fastcall sub_5BAC0(_DWORD *a1, int a2)
{
  unsigned __int8 *v3; // [esp+14h] [ebp-24h]
  int v4; // [esp+18h] [ebp-20h]
  unsigned int m; // [esp+1Ch] [ebp-1Ch]
  BOOL v6; // [esp+20h] [ebp-18h]
  unsigned int k; // [esp+24h] [ebp-14h]
  unsigned int i; // [esp+28h] [ebp-10h]
  unsigned int j; // [esp+2Ch] [ebp-Ch]
  unsigned int v10; // [esp+30h] [ebp-8h]
  unsigned int v11; // [esp+34h] [ebp-4h]

  v11 = a1[1] + 1;
  v10 = a1[2] + 1;
  v4 = 4 * v10;
  for ( i = 0; i < v10; ++i )
  {
    v3 = (unsigned __int8 *)(i * v11 + *a1);
    for ( j = 0; j < v11; j = k )
    {
      v6 = *v3 == a2;
      for ( k = j + 1; k < v11; ++k )
      {
        if ( (*++v3 == a2) != v6 )
        {
          break;
        }
      }
      for ( m = k - j; m > 0x7F; m -= 0x7F )
      {
        ++v4;
      }
      ++v4;
    }
  }
  return v4;
}

//----- (0005BBE4) --------------------------------------------------------
char *__fastcall sub_5BBE4(void **a1, char *a2, int a3)
{
  int v3; // eax
  char *v4; // eax
  char *v5; // eax
  char *s2; // [esp+Ch] [ebp-34h]
  _DWORD *ptr; // [esp+18h] [ebp-28h]
  char *v11; // [esp+1Ch] [ebp-24h]
  unsigned __int8 *v12; // [esp+20h] [ebp-20h]
  unsigned int m; // [esp+24h] [ebp-1Ch]
  BOOL v14; // [esp+28h] [ebp-18h]
  bool v15; // [esp+28h] [ebp-18h]
  unsigned int k; // [esp+2Ch] [ebp-14h]
  unsigned int i; // [esp+30h] [ebp-10h]
  unsigned int j; // [esp+34h] [ebp-Ch]
  unsigned int v19; // [esp+38h] [ebp-8h]
  unsigned int v20; // [esp+3Ch] [ebp-4h]

  s2 = a2;
  v20 = (unsigned int)a1[1] + 1;
  v19 = (unsigned int)a1[2] + 1;
  if ( a2 == *a1 )
  {
    if ( sub_5BAC0(a1, a3) > v19 * v20 )
    {
      return 0;
    }
  }
  else if ( !a2 )
  {
    v3 = sub_5BAC0(a1, a3);
    s2 = (char *)malloc(v3);
    if ( !s2 )
    {
      return 0;
    }
  }
  ptr = malloc(4 * v19);
  if ( !ptr )
  {
    return 0;
  }
  v11 = s2;
  for ( i = 0; i < v19; ++i )
  {
    v12 = (unsigned __int8 *)*a1 + i * v20;
    ptr[i] = v11 - s2 + 4 * v19;
    for ( j = 0; j < v20; j = k )
    {
      v14 = *v12 == a3;
      for ( k = j + 1; k < v20; ++k )
      {
        if ( (*++v12 == a3) != v14 )
        {
          break;
        }
      }
      v15 = v14 << 7;
      for ( m = k - j; m > 0x7F; m -= 0x7F )
      {
        v4 = v11++;
        *v4 = v15 | 0x7F;
      }
      v5 = v11++;
      *v5 = m | v15;
    }
  }
  memmove(&s2[4 * v19], s2, v11 - s2);
  memmove(s2, ptr, 4 * v19);
  free(ptr);
  return s2;
}

//----- (0005BDDC) --------------------------------------------------------
void __fastcall sub_5BDDC(void *a1)
{
  free(a1);
}

// nfuncs=1979 queued=830 decompiled=830 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 830 function(s)"
